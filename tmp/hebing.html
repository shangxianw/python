<html>
<head>
<style>
	@font-face{
		font-family: "main_font";
		src: url("./font/main_font.ttf");
		font-display: swap;
	}
	@font-face{
		font-family: "desc_font";
		src: url("./font/desc_font.ttf");
		font-display: swap;
	}
</style>
</head>
<body>
    <div style="font-family:'main_font'"><div style="font-family:'desc_font'">
letProtoAnalyzer:RES.processor.Processor={asynconLoadStartdhost,resourcee{letdata=awaithost.loaddresource,RES.processor.TextProcessore;returndata;},onRemoveStartdhost,requeste{returnPromise.resolvede;}}ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccCopyrightdce2014-present,EgretTechnology.ccAllrightsreserved.ccRedistributionanduseinsourceandbinaryforms,withorwithoutccmodification,arepermittedprovidedthatthefollowingconditionsaremet:cccc*Redistributionsofsourcecodemustretaintheabovecopyrightccnotice,thislistofconditionsandthefollowingdisclaimer.cc*Redistributionsinbinaryformmustreproducetheabovecopyrightccnotice,thislistofconditionsandthefollowingdisclaimerintheccdocumentationandcorothermaterialsprovidedwiththedistribution.cc*NeitherthenameoftheEgretnortheccnamesofitscontributorsmaybeusedtoendorseorpromoteproductsccderivedfromthissoftwarewithoutspecificpriorwrittenpermission.ccccTHISSOFTWAREISPROVIDEDBYEGRETANDCONTRIBUTORS"ASIS"ANDANYEXPRESSccORIMPLIEDWARRANTIES,INCLUDING,BUTNOTLIMITEDTO,THEIMPLIEDWARRANTIESccOFMERCHANTABILITYANDFITNESSFORAPARTICULARPURPOSEAREDISCLAIMED.ccINNOEVENTSHALLEGRETANDCONTRIBUTORSBELIABLEFORANYDIRECT,INDIRECT,ccINCIDENTAL,SPECIAL,EXEMPLARY,ORCONSEQUENTIALDAMAGESdINCLUDING,BUTNOTccLIMITEDTO,PROCUREMENTOFSUBSTITUTEGOODSORSERVICES;LOSSOFUSE,DATA,ccORPROFITS;ORBUSINESSINTERRUPTIONeHOWEVERCAUSEDANDONANYTHEORYOFccLIABILITY,WHETHERINCONTRACT,STRICTLIABILITY,ORTORTdINCLUDINGccNEGLIGENCEOROTHERWISEeARISINGINANYWAYOUTOFTHEUSEOFTHISSOFTWARE,ccEVENIFADVISEDOFTHEPOSSIBILITYOFSUCHDAMAGE.ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccclassAssetAdapterimplementseui.IAssetAdapter{c***@languagezh_CN*解析素材*@paramsource待解析的新素材标识符*@paramcompFunc解析完成回调函数，示例：callBackdcontent:any,source:stringe:void;*@paramthisObjectcallBack的this引用*cpublicgetAssetdsource:string,compFunc:Function,thisObject:anye:void{functiononGetResddata:anye:void{compFunc.calldthisObject,data,sourcee;}ifdRES.hasResdsourceee{letdata=RES.getResdsourcee;ifddatae{onGetResddatae;}else{RES.getResAsyncdsource,onGetRes,thise;}}else{RES.getResByUrldsource,onGetRes,this,RES.ResourceItem.TYPE_IMAGEe;}}}c****@author**cmoduleECS{exportclassAStar{c**开放列表*cprivate_open:NodePoint[];c**封闭列表*cprivate_closed:NodePoint[];c**节点网格数据对象*cprivate_grid:Grid;c**结束节点*cprivate_endNode:NodePoint;c**开始节点*cprivate_startNode:NodePoint;c**找到的路径节点数组*cprivate_path:NodePoint[];private_floydPath:NodePoint[];c**是否结束寻路*cpublicisEnd:boolean=false;c**启发函数方法*cccprivate_heuristic:Function=manhattan;ccprivate_heuristic:Function=euclidian;private_heuristic:Function=this.diagonal;c**直线代价权值*cprivate_straightCost:number=1.0;c**对角线代价权值*cprivate_diagCost:number=Math.SQRT2;c**在网格中是否找到路径*cpublicfindPathdgrid:Gride:boolean{this._grid=grid;this._open=[];this._closed=[];this._startNode=this._grid.startNode;this._endNode=this._grid.endNode;this._startNode.g=0;this._startNode.h=this._heuristicdthis._startNodee;this._startNode.f=this._startNode.g+this._startNode.h;cccc将开始节点加入开放列表this._open[0]=this._startNode;ccthis._open[0].inOpenList=true;returnthis.searchde;}c**寻路*cpublicsearchde:boolean{cccc九宫格中心节点varnode:NodePoint;whiled!this.isEnde{cc当前节点在开放列表中的索引位置varcurrentNum:number;cccc在开放列表中查找具有最小F值的节点，并把查找到的节点作为下一个要九宫格中心节点varilen=this._open.length;node=this._open[0];currentNum=0;fordi=0;iailen;i++e{ifdthis._open[i].fanode.fe{node=this._open[i];currentNum=i;}}cccc把当前节点从开放列表删除,加入到封闭列表ccnode.inOpenList=false;cc如果开放列表中最后一个节点是最小F节点相当于直接openList.popde否则相当于交换位置来保存未比较的节点this._open[currentNum]=this._open[this._open.length-1];this._open.popde;this._closed.pushdnodee;cccc九宫格循环确保了检查的节点永远在网格里面varstartX:number=0bnode.x-1?0:node.x-1;varendX:number=this._grid.numCols-1anode.x+1?this._grid.numCols-1:node.x+1;varstartY:number=0bnode.y-1?0:node.y-1;varendY:number=this._grid.numRows-1anode.y+1?this._grid.numRows-1:node.y+1;cccc一次九宫格循环节点fordvari:number=startX;ia=endX;i++e{fordvarj:number=startY;ja=endY;j++e{cccc当前要被探查的节点vartest:NodePoint=this._grid.getNodedi,je;cccc若当前节点等于起始节点或不可通过或当前节点位于斜方向时其相邻的拐角节点不可通过ifdtest==node||!test.walkable||!this._grid.getNodednode.x,test.ye.walkable||!this._grid.getNodedtest.x,node.ye.walkablee{continue;}cccc代价计算横竖为1斜方向为Math.SQRT2varcost:number=this._straightCost;ifd!ddnode.x==test.xe||dnode.y==test.yeee{cccost=this._diagCost;cost=1.4;}varg:number=node.g+cost*test.costMultiplier;varh:number=this._heuristicdteste;varf:number=g+h;cccc在开启列表或关闭列表中找到表示已经被探测过的节点ifdthis._open.indexOfdteste!=-1||this._closed.indexOfdteste!=-1e{cccc如果该相邻节点在开放列表中,则判断若经由当前节点到达该相邻节点的G值是否小于原来保存的G值,若小于,则将该相邻节点的父节点设为当前节点,并重新设置该相邻节点的G和F值ifdfatest.fe{test.f=f;test.g=g;test.h=h;test.parent=node;}}else{cccc未被探测的节点test.f=f;test.g=g;test.h=h;test.parent=node;this._open.pushdteste;}cccc循环结束条件：当结束节点被加入到开放列表作为待检验节点时，表示路径被找到，此时应终止循环ifdtest==this._endNodee{ccgame.logdteste;this.isEnd=true;}}}cccc未找到路径ifdthis._open.length==0e{ccgame.logd"nopathfound"e;this.isEnd=true;returnfalse}}this.buildPathde;returntrue;}cc路径平滑化处理sxsyexey路径的真实的开始和结束位置publicstaticfloydPathdpath:NodePoint[],grid:Grid,sx:number,sy:number,ex:number,ey:numbere:NodePoint[]{functionfloydVectordtarget:NodePoint,n1:NodePoint,n2:NodePointe{target.x=n1.x-n2.x;target.y=n1.y-n2.y;}letcellSize=MathConst.MapCellSize;cccc在路径中去掉startNode开始节点，避免玩家对象走回头路ccifdpath.lengthb1ecc{ccpath.shiftde;cc}cc在路径中替换掉开始和结束节点防止玩家走错路cc如果不这样处理而只是仅仅path.shiftde;把第一个节点去掉会导致一个问题cc假设玩家当前位置为p，目标位置为p寻路后节点假如为a,b,c,d经过平滑处理后变成了a,c,d然后去掉第一个节点就变成了c,dcc那么玩家的走路的路径就变成了p,c,d然后由于p和a在同一个格子但是位置不同cc我们平滑处理的过程中只保证了a,c之间没有碰撞但是无法保证p,c之间没有碰撞所以玩家可能会走到p,c之间的阻挡上cc所以我们在平滑处理前把a替换成p把d替换成t,然后再平滑处理这样就可以绝对保证平滑后的路径绝对不会经过阻挡位置ifdpath.lengthb1e{letfirstNode=path.shiftde.copyde;firstNode.x=game.Utils.toFixedNumberdsxccellSize-0.5e;firstNode.y=game.Utils.toFixedNumberdsyccellSize-0.5e;path.unshiftdfirstNodee;}ifdpath.lengthb0e{letlastNode=path.popde.copyde;lastNode.x=game.Utils.toFixedNumberdexccellSize-0.5e;lastNode.y=game.Utils.toFixedNumberdeyccellSize-0.5e;path.pushdlastNodee;}letlen:number=path.length;ifdlena=2e{returnpath;}letfloydPath=path.concatde;letvector:NodePoint=newNodePointd0,0,nulle;lettempVector:NodePoint=newNodePointd0,0,nulle;cc遍历路径数组中全部路径节点，合并在同一直线上的路径节点cc假设有1,2,3,三点，若2与1的横、纵坐标差值分别与3与2的横、纵坐标差值相等则cc判断此三点共线，此时可以删除中间点2floydVectordvector,floydPath[len-1],floydPath[len-2]e;ifdvector.x==0&&vector.y==0ecc防止有重复点的情况{floydPath.popde;ifdfloydPath.lengtha=2ereturnfloydPath;floydVectordvector,floydPath[len-1],floydPath[len-2]e;}fordleti:number=floydPath.length-3;ib=0;i--e{floydVectordtempVector,floydPath[i+1],floydPath[i]e;ifdvector.x==tempVector.x&&vector.y==tempVector.ye{floydPath.splicedi+1,1e;}else{vector.x=tempVector.x;vector.y=tempVector.y;}}cc合并共线节点后进行第二步，消除拐点操作。算法流程如下：cc如果一个路径由1-10十个节点组成，那么由节点10从1开始检查cc节点间是否存在障碍物，若它们之间不存在障碍物，则直接合并cc此两路径节点间所有节点。len=floydPath.length;letret:boolean;fordleti=len-1;ib=0;i--e{fordletj:number=0;ja=i-2;j++e{ret=grid.hasBarrier2dfloydPath[i].x,floydPath[i].y,floydPath[j].x,floydPath[j].ye;ifdret==falsee{fordvark:number=i-1;kbj;k--e{floydPath.splicedk,1e;}i=j+1;len=floydPath.length;break;}}}ifdfloydPath.lengthb1ecc去掉第一个节点{floydPath.shiftde;}returnfloydPath;}c**弗洛伊德路径平滑处理*cpublicfloydditype:numbere:void{ifdthis.path==nullereturn;ifditype==1ereturn;this._floydPath=this.path.concatde;ccgame.logd"________平滑之前的路径:",this._floydPath.lengthe;ccfordletnodeofthis._floydPathecc{ccgame.logd`[${node.x},${node.y}]`e;cc}varlen:number=this._floydPath.length;ifdlenb2e{varvector:NodePoint=newNodePointd0,0,nulle;vartempVector:NodePoint=newNodePointd0,0,nulle;cc遍历路径数组中全部路径节点，合并在同一直线上的路径节点cc假设有1,2,3,三点，若2与1的横、纵坐标差值分别与3与2的横、纵坐标差值相等则cc判断此三点共线，此时可以删除中间点2this.floydVectordvector,this._floydPath[len-1],this._floydPath[len-2]e;fordvari:number=this._floydPath.length-3;ib=0;i--e{this.floydVectordtempVector,this._floydPath[i+1],this._floydPath[i]e;ifdvector.x==tempVector.x&&vector.y==tempVector.ye{this._floydPath.splicedi+1,1e;}else{vector.x=tempVector.x;vector.y=tempVector.y;}}}ifditype==2ereturn;ccgame.logd"________平滑之后的路径...."e;ccfordletnodeofthis._floydPathecc{ccgame.logd`[${node.x},${node.y}]`e;cc}cc合并共线节点后进行第二步，消除拐点操作。算法流程如下：cc如果一个路径由1-10十个节点组成，那么由节点10从1开始检查cc节点间是否存在障碍物，若它们之间不存在障碍物，则直接合并cc此两路径节点间所有节点。len=this._floydPath.length;letret:boolean;fordi=len-1;ib=0;i--e{fordvarj:number=0;ja=i-2;j++e{ifditype==3eret=this._grid.hasBarrier2dthis._floydPath[i].x,this._floydPath[i].y,this._floydPath[j].x,this._floydPath[j].ye;elseret=this._grid.hasBarrierdthis._floydPath[i].x,this._floydPath[i].y,this._floydPath[j].x,this._floydPath[j].ye;ifdret==falsee{fordvark:number=i-1;kbj;k--e{this._floydPath.splicedk,1e;}i=j;len=this._floydPath.length;break;}}}ifditype==3ereturn;ccgame.logd"________平滑之后的路径....",this._floydPath.lengthe;ccfordletnodeofthis._floydPathecc{ccgame.logd`[${node.x},${node.y}]`e;cc}}cccc判断3点是否在一直线上privatefloydVectordtarget:NodePoint,n1:NodePoint,n2:NodePointe:void{target.x=n1.x-n2.x;target.y=n1.y-n2.y;}privatebuildPathde:void{this._path=newArrayde;varnode:NodePoint=this._endNode;this._path.pushdnodee;whilednode!=this._startNodee{node=node.parent;this._path.unshiftdnodee;}}publicgetpathde:NodePoint[]{returnthis._path;}publicgetfloydPathde:NodePoint[]{returnthis._floydPath;}privatemanhattandnode:NodePointe:number{returnMath.absdnode.x-this._endNode.xe*this._straightCost+Math.absdnode.y+this._endNode.ye*this._straightCost;}privateeuclidiandnode:NodePointe:number{vardx:number=node.x-this._endNode.x;vardy:number=node.y-this._endNode.y;returnMath.sqrtddx*dx+dy*dye*this._straightCost;}privatediagonaldnode:NodePointe:number{vardx:number=node.x-this._endNode.xa0?this._endNode.x-node.x:node.x-this._endNode.x;vardy:number=node.y-this._endNode.ya0?this._endNode.y-node.y:node.y-this._endNode.y;vardiag:number=dxady?dx:dy;varstraight:number=dx+dy;ccreturnthis._diagCost*diag+this._straightCost*dstraight-2*diage;return1.4*diag+this._straightCost*dstraight-2*diage;}publicgetvisitedde:NodePoint[]{ccreturnthis._closed.concatdthis._opene;returnthis._open;}}}c****@author**cmoduleECS{exportclassGameTestextendsegret.DisplayObjectContainer{private_cellSize:number=40;private_grid:Grid;private_player:egret.Sprite;private_index:number;private_path:NodePoint[];private_lineShape:egret.Shape;private_gridContent:egret.DisplayObjectContainer;public_gridArr:egret.Shape[][];publicstaticinstance:GameTest;publicconstructorde{superde;GameTest.instance=this;this.makeGridde;this.makePlayerde;}c***Createstheplayersprite.Justacirclehere.*cprivatemakePlayerde:void{this._player=newegret.Spritede;ccthis._player.touchChildren=false;this._player.touchEnabled=true;cc当为true时点击事件会穿过该对象到达侦听对象this._player.graphics.beginFilld0xff0000e;this._player.graphics.drawCircled0,0,5e;this._player.graphics.endFillde;this._player.x=50;this._player.y=60;this.addChilddthis._playere;this._lineShape=newegret.Shapede;this.addChilddthis._lineShapee;}c***Createsagridwithabunchofrandomunwalkablenodes.*cprivatemakeGridde:void{this._gridContent=newegret.DisplayObjectContainerde;this._gridContent.touchEnabled=true;this._gridContent.touchChildren=false;this._gridContent.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.onGridClick,thise;this.addChilddthis._gridContente;this._grid=newGridd10,10,40e;cc随机障碍物fordvari:number=0;ia20;i++e{this._grid.setWalkabledMath.floordMath.randomde*10e,Math.floordMath.randomde*10e,falsee;}this.drawGridde;}c***Drawsthegivengrid,coloringeachcellaccordingtoitsstate.*cprivatedrawGridde:void{this._gridArr=newArrayde;fordvari:number=0;iathis._grid.numCols;i++e{this._gridArr[i]=[];fordvarj:number=0;jathis._grid.numRows;j++e{varnode:NodePoint=this._grid.getNodedi,je;varrect:egret.Shape=newegret.Shapede;rect.graphics.lineStyled0.1e;rect.graphics.beginFilldthis.getColordnodeee;rect.graphics.drawRectd0,0,this._cellSize,this._cellSizee;rect.graphics.endFillde;rect.x=i*this._cellSize;rect.y=j*this._cellSize;this._gridContent.addChilddrecte;this._gridArr[i][j]=rect;}}}c***Determinesthecolorofagivennodebasedonitsstate.*cprivategetColordnode:NodePointe:number{ifd!node.walkableereturn0x000000;ifdnode==this._grid.startNodeereturn0x999900;ifdnode==this._grid.endNodeereturn0x0000ff;return0xcccccc;}c***HandlestheclickeventontheGridView.Findstheclickedoncellandtogglesitswalkablestate.*cprivateonGridClickdevent:egret.TouchEvente:void{varxpos:number=Math.floordevent.stageXcthis._cellSizee;varypos:number=Math.floordevent.stageYcthis._cellSizee;varendNp:NodePoint=this._grid.getNodedxpos,ypose;varxpos2:number=Math.floordthis._player.xcthis._cellSizee;varypos2:number=Math.floordthis._player.ycthis._cellSizee;varstartNp:NodePoint=this._grid.getNodedxpos2,ypos2e;ifdendNp.walkable==falsee{varreplacer:NodePoint=this._grid.findReplacerdstartNp,endNpe;ifdreplacere{xpos=replacer.x;ypos=replacer.y;}}this._grid.setStartNodedxpos2,ypos2e;this._grid.setEndNodedxpos,ypose;this.findPathde;cccc画红线c*this._lineShape.graphics.clearde;this._lineShape.graphics.lineStyled1,0xFF0000e;this._lineShape.graphics.moveTodxpos2*this._cellSize+10,ypos2*this._cellSize+10e;this._lineShape.graphics.lineTodxpos*this._cellSize+10,ypos*this._cellSize+10e;this._lineShape.graphics.endFillde;*c}c***CreatesaninstanceofAStarandusesittofindapath.*cprivatefindPathde:void{varoldTime:number=egret.getTimerde;varastar:AStar=newAStarde;ifdastar.findPathdthis._gridee{cc得到平滑路径astar.floydd1e;cc在路径中去掉起点节点，避免玩家对象走回头路astar.floydPath.shiftde;this._path=astar.floydPath;ccthis._path=astar.path;this._index=0;this.addEventListenerdegret.Event.ENTER_FRAME,this.onEnterFrame,thise;ccgame.logd"寻路时间："+Stringdegret.getTimerde-oldTimee+"毫秒"e;}}c***走动*cprivateonEnterFramedevt:egret.Evente{ifdthis._path.length==0e{this.removeEventListenerdegret.Event.ENTER_FRAME,this.onEnterFrame,thise;return;}vartargetX:number=this._path[this._index].x*this._cellSize+this._cellSizec2;vartargetY:number=this._path[this._index].y*this._cellSize+this._cellSizec2;vardx:number=targetX-this._player.x;vardy:number=targetY-this._player.y;vardist:number=Math.sqrtddx*dx+dy*dye;ifddista1e{this._index++;ifdthis._indexb=this._path.lengthe{this.removeEventListenerdegret.Event.ENTER_FRAME,this.onEnterFrame,thise;}}else{this._player.x+=dx*.5;this._player.y+=dy*.5;}}}}c*****节点二维数组节点操作方法*@author**cmoduleECS{exportclassGrid{private_startNode:NodePoint;private_endNode:NodePoint;private_nodes:NodePoint[][];private_numCols:number;private_numRows:number;private_cellSize:number;publicgetnodesde:NodePoint[][]{returnthis._nodes;}privatelockPosInfo:SMapanumber,numberb;cc把方向站位锁定d位置-bheroIDeprivatelockHeroInfo:SMapanumber,numberb;cc把方向站位锁定dheroID-b位置eprivatecollideNodeArray:NodePoint[];privatecollideNodeMap:SMapanumber,NodePoint[]b;cc阻挡类型-b格子列表publiccollidePosInfo:any;c***构造函数*@numCols列*@numRows行*cpublicconstructordnumCols:number,numRows:number,cellSize:numbere{this._numCols=numCols;this._numRows=numRows;this._cellSize=cellSize;this._nodes=newArrayde;cccc以列数作为X坐标循环fordvari:number=0;iathis._numCols;i++e{this._nodes[i]=[];fordvarj:number=0;jathis._numRows;j++e{this._nodes[i][j]=newNodePointdi,j,thise;}}this.collideNodeArray=[];this.collideNodeMap=newSMapanumber,NodePoint[]bde;this.collidePosInfo={};this.lockPosInfo=newSMapanumber,numberbde;this.lockHeroInfo=newSMapanumber,numberbde;}publicDisposede{this.lockPosInfo.clearde;this.lockHeroInfo.clearde;ifdthis._nodes!=nulle{fordletarrayofthis._nodese{fordletnodeofarraye{node.disposede;}}}this._nodes=null;this.collideNodeArray=[];this.collideNodeMap.clearde;this.collidePosInfo={};}ccccccccccccccccccccccccccccccccccccccccccpublicmethodsccccccccccccccccccccccccccccccccccccccccc***根据坐标获取节点*@paramx列*@paramy行*cpublicgetNodedx:number,y:numbere:NodePoint{ifdxa0ex=0;ifdxb=MathConst.GridCountXex=MathConst.GridCountX-1;ifdya0ey=0;ifdyb=MathConst.GridCountYey=MathConst.GridCountY-1;returnthis._nodes[x][y];}c***设置结束节点*@paramx列*@paramy行*cpublicsetEndNodedx:number,y:numbere:void{this._endNode=this._nodes[x][y];}c***设置开始节点*@paramx列*@paramy行*cpublicsetStartNodedx:number,y:numbere:void{this._startNode=this._nodes[x][y];}c***设置节点是否可以通行*@paramx列*@paramy行*cpublicsetWalkabledx:number,y:number,value:booleane:void{this._nodes[x][y].walkable=value;}c***设置节点是否透明*@paramx列*@paramy行*cpublicsetAlphabledx:number,y:number,value:booleane:void{this._nodes[x][y].alphable=value;}ccccccccccccccccccccccccccccccccccccccccccgetterscsettersccccccccccccccccccccccccccccccccccccccccc***返回开始节点*cpublicgetstartNodede:NodePoint{returnthis._startNode;}c***返回结束节点*cpublicgetendNodede:NodePoint{returnthis._endNode;}c***返回网格总列数*cpublicgetnumColsde:number{returnthis._numCols;}c***返回网格总行数*cpublicgetnumRowsde:number{returnthis._numRows;}publicgetcellSizede:number{returnthis._cellSize;}publichasBarrier2dstartX:number,startY:number,endX:number,endY:numbere:boolean{letcellSize=MathConst.MapCellSize;startX=startX*cellSize+cellSize*0.5;startY=startY*cellSize+cellSize*0.5;endX=endX*cellSize+cellSize*0.5;endY=endY*cellSize+cellSize*0.5;letnodeArray=this.collideNodeArray;fordletnodeofnodeArraye{ifdnode.isLineCrossdstartX,startY,endX,endYeereturntrue;}returnfalse;}c***判断两节点之间是否存在障碍物**cpublichasBarrierdstartX:number,startY:number,endX:number,endY:numbere:boolean{cc如果起点终点是同一个点那傻子都知道它们间是没有障碍物的ifdstartX==endX&&startY==endYereturnfalse;letcellSize=this._cellSize;cc两节点中心位置varpoint1:egret.Point=newegret.PointdstartX*cellSize+cellSizec2,startY*cellSize+cellSizec2e;varpoint2:egret.Point=newegret.PointdendX*cellSize+cellSizec2,endY*cellSize+cellSizec2e;cc根据起点终点间横纵向距离的大小来判断遍历方向vardistX:number=Math.absdendX-startXe;vardistY:number=Math.absdendY-startYe;c**遍历方向，为true则为横向遍历，否则为纵向遍历*cvarloopDirection:boolean=distXbdistY?true:false;c**起始点与终点的连线方程*cvarlineFuction:Function;c**循环递增量*cvari:number;c**循环起始值*cvarloopStart:number;c**循环终结值*cvarloopEnd:number;c**起终点连线所经过的节点*cvarpassedNodeList:NodePoint[];varpassedNode:NodePoint;cc为了运算方便，以下运算全部假设格子尺寸为1，格子坐标就等于它们的行、列号ifdloopDirectione{lineFuction=MathUtil.getLineFuncdpoint1,point2,0e;loopStart=Math.mindstartX,endXe;loopEnd=Math.maxdstartX,endXe;cc开始横向遍历起点与终点间的节点看是否存在障碍d不可移动点efordi=loopStart;ialoopEnd;i++e{cc由于线段方程是根据终起点中心点连线算出的，所以对于起始点来说需要根据其中心点cc位置来算，而对于其他点则根据左上角来算varxpos:number=i*cellSize+cellSize;cc根据x得到直线上的y值varyPos:number=lineFuctiondxpose;cc检查经过的节点是否有障碍物，若有则返回truepassedNodeList=this.getNodesUnderPointdi+1,yPosccellSizee;fordvaridxinpassedNodeListe{c*passedNode=passedNodeList[idx];varrect:egret.Shape=GameTest.instance._gridArr[passedNode.x][passedNode.y];rect.graphics.lineStyled0.1e;rect.graphics.beginFilld0xFF99FF,0.5e;rect.graphics.drawRectd0,0,cellSize,cellSizee;rect.graphics.endFillde;*cifdpassedNodeList[idx].walkable==falseereturntrue;}}}else{lineFuction=MathUtil.getLineFuncdpoint1,point2,1e;loopStart=Math.mindstartY,endYe;loopEnd=Math.maxdstartY,endYe;cc开始纵向遍历起点与终点间的节点看是否存在障碍d不可移动点efordi=loopStart;ialoopEnd;i++e{varypos:number=i*cellSize+cellSize;cc根据y得到直线上的x值varxPos:number=lineFuctiondypose;passedNodeList=this.getNodesUnderPointdxPosccellSize,i+1e;fordvaridxinpassedNodeListe{ifdpassedNodeList[idx].walkable==falseereturntrue;}}}returnfalse;}c***得到一个点下的所有节点*@paramxPos点的横向位置*@paramyPos点的纵向位置*@paramexception例外格，若其值不为空，则在得到一个点下的所有节点后会排除这些例外格*@return共享此点的所有节点**cpublicgetNodesUnderPointdxPos:number,yPos:number,exception:NodePoint[]=nulle:NodePoint[]{varresult:NodePoint[]=[];varxIsInt:boolean=xPos%1==0;varyIsInt:boolean=yPos%1==0;cc点由四节点共享情况ifdxIsInt&&yIsInte{result[0]=this.getNodedxPos-1,yPos-1e;result[1]=this.getNodedxPos,yPos-1e;result[2]=this.getNodedxPos-1,yPose;result[3]=this.getNodedxPos,yPose;}cc点由2节点共享情况cc点落在两节点左右临边上elseifdxIsInt&&!yIsInte{result[0]=this.getNodedxPos-1,Math.floordyPosee;result[1]=this.getNodedxPos,Math.floordyPosee;}cc点落在两节点上下临边上elseifd!xIsInt&&yIsInte{result[0]=this.getNodedMath.floordxPose,yPos-1e;result[1]=this.getNodedMath.floordxPose,yPose;}cc点由一节点独享情况else{result[0]=this.getNodedMath.floordxPose,Math.floordyPosee;}cc在返回结果前检查结果中是否包含例外点，若包含则排除掉ifdexception&&exception.lengthb0e{fordvari:number=0;iaresult.length;i++e{ccgame.logdresult[i].x+""+result[i].ye;ifdexception.indexOfdresult[i]e!=-1e{result.splicedi,1e;i--;}}}returnresult;}ccccc**当终点不可移动时寻找一个离原终点最近的可移动点来替代之*cpublicfindReplacerdfromNode:NodePoint,toNode:NodePointe:NodePoint{varresult:NodePoint;cc若终点可移动则根本无需寻找替代点ifdtoNode.walkablee{result=toNode;}cc否则遍历终点周围节点以寻找离起始点最近一个可移动点作为替代点else{cc根据节点的埋葬深度选择遍历的圈cc若该节点是第一次遍历，则计算其埋葬深度ifdtoNode.buriedDepth==-1e{toNode.buriedDepth=this.getNodeBuriedDepthdtoNode,Math.maxdthis._numCols,this._numRowsee;}varxFrom:number=toNode.x-toNode.buriedDeptha0?0:toNode.x-toNode.buriedDepth;varxTo:number=toNode.x+toNode.buriedDepthbthis.numCols-1?this.numCols-1:toNode.x+toNode.buriedDepth;varyFrom:number=toNode.y-toNode.buriedDeptha0?0:toNode.y-toNode.buriedDepth;varyTo:number=toNode.y+toNode.buriedDepthbthis.numRows-1?this.numRows-1:toNode.y+toNode.buriedDepth;varn:NodePoint;cc当前遍历节点fordvari:number=xFrom;ia=xTo;i++e{fordvarj:number=yFrom;ja=yTo;j++e{ifddibxFrom&&iaxToe&&djbyFrom&&jayToee{continue;}n=this.getNodedi,je;ifdn.walkablee{cc计算此候选节点到起点的距离，记录离起点最近的候选点为替代点n.getDistanceTodfromNodee;ifd!resulte{result=n;}elseifdn.distancearesult.distancee{result=n;}}}}}returnresult;}c**计算全部路径点的埋葬深度*cpubliccalculateBuriedDepthde:void{varnode:NodePoint;fordvari:number=0;iathis._numCols;i++e{fordvarj:number=0;jathis._numRows;j++e{node=this._nodes[i][j];ifdnode.walkablee{node.buriedDepth=0;}else{node.buriedDepth=this.getNodeBuriedDepthdnode,Math.maxdthis._numCols,this._numRowsee;}}}}c**计算一个节点的埋葬深度*@paramnode欲计算深度的节点*@paramloopCount计算深度时遍历此节点外围圈数。默认值为10*cprivategetNodeBuriedDepthdnode:NodePoint,loopCount:number=10e:number{cc如果检测节点本身是不可移动的则默认它的深度为1varresult:number=node.walkable?0:1;varl:number=1;whiledla=loopCounte{varstartX:number=node.x-la0?0:node.x-l;varendX:number=node.x+lbthis.numCols-1?this.numCols-1:node.x+l;varstartY:number=node.y-la0?0:node.y-l;varendY:number=node.y+lbthis.numRows-1?this.numRows-1:node.y+l;varn:NodePoint;cc遍历一个节点周围一圈看是否周围一圈全部是不可移动点，若是，则深度加一，cc否则返回当前累积的深度值fordvari:number=startX;ia=endX;i++e{fordvarj:number=startY;ja=endY;j++e{n=this.getNodedi,je;ifdn!=node&&n.walkablee{returnresult;}}}cc遍历完一圈，没发现一个可移动点，则埋葬深度加一。接着遍历下一圈result++;l++;}returnresult;}cccccccc格子锁定ccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicIsPosLockeddx:number,y:numbere:boolean{letid=x*MathConst.GridCountY+y;ifdthis.lockPosInfo.hasdideereturntrue;returnfalse;}cc尝试锁定该格子返回false表示锁定失败publicTryLockPosdx:number,y:number,heroID:numbere:boolean{letid=x*MathConst.GridCountY+y;ifdthis.lockPosInfo.hasdideereturnfalse;this.lockPosInfo.setdid,heroIDe;this.lockHeroInfo.setdheroID,ide;returntrue;}publicUnlockHerodheroID:numbere:number{ifd!this.lockHeroInfo.hasdheroIDee{return-1;}letid=this.lockHeroInfo.getdheroIDe;this.lockHeroInfo.deletedheroIDe;this.lockPosInfo.deletedide;returnid;}publicAddCollideNodednode:NodePointe{letindex=this.collideNodeArray.indexOfdnodee;ifdindexa=-1e{this.collideNodeArray.pushdnodee;letpos=node.x*1000+node.y;this.collidePosInfo[pos]=0;ifd!IsMainThreaddeeSNetWar.SendCollideNodeInfode;}letitype=node.getCollideTypede;ifditype==0e{ifdIsMainThreaddeegame.errord"----AddCollideNodeerror------bbbbbbbbbbbbbb",itypee;elsethread.errord"----AddCollideNodeerror------bbbbbbbbbbbbbb",itypee;}ifd!this.collideNodeMap.hasditypeeethis.collideNodeMap.setditype,[]e;letnodeArray=this.collideNodeMap.getditypee;index=nodeArray.indexOfdnodee;ifdindexa=-1enodeArray.pushdnodee;}publicRemoveCollideNodednode:NodePointe{letindex=this.collideNodeArray.indexOfdnodee;ifdindexb-1e{this.collideNodeArray.splicedindex,1e;letpos=node.x*1000+node.y;deletethis.collidePosInfo[pos];ifd!IsMainThreaddeeSNetWar.SendCollideNodeInfode;}letitype=node.getCollideTypede;ifd!this.collideNodeMap.hasditypeeethis.collideNodeMap.setditype,[]e;letnodeArray=this.collideNodeMap.getditypee;index=nodeArray.indexOfdnodee;ifdindexb-1enodeArray.splicedindex,1e;}publicGetCollideNodeArrayde:NodePoint[]{returnthis.collideNodeArray;}publicGetCollideNodeByTypeditypeArray:number[]e:NodePoint[]{letnodeArray:NodePoint[]=[];fordletitypeofitypeArraye{ifd!this.collideNodeMap.hasditypeeecontinue;letarray=this.collideNodeMap.getditypee;fordletnodeofarrayenodeArray.pushdnodee;}returnnodeArray;}}}c****节点类*@author**cmoduleECS{exportclassNodePoint{publicx:number;publicy:number;publicf:number;publicg:number;publich:number;publicwalkable:boolean=true;publicheroInfo:SMapanumber,numberb;publictempDistance1:number;publictempDistance2:number;publicalphable:boolean=false;publicparent:NodePoint;publiccostMultiplier:number=1.0;c**埋葬深度*cpublicburiedDepth:number=-1;c**距离的平方*cpublicdistance:number;privategrid:Grid;publicconstructordx:number,y:number,grid:Gride{this.x=x;this.y=y;this.heroInfo=newSMapanumber,numberbde;this.grid=grid;}publiccopyde:NodePoint{letnode=newNodePointdthis.x,this.y,this.gride;node.walkable=this.walkable;node.heroInfo=this.heroInfo.copyde;returnnode;}publicEqualsdnode:NodePointe:boolean{returnthis.x==node.x&&this.y==node.y;}publicaddHerodid:numbere:boolean{ifdthis.walkablee{this.heroInfo.setdid,ide;this.walkable=false;ifdthis.grid!=nullethis.grid.AddCollideNodedthise;returntrue;}else{this.heroInfo.setdid,ide;returnfalse;}}publicremoveHerodid:numbere:boolean{ifdthis.heroInfo.hasdidee{this.heroInfo.deletedide;this.walkable=dthis.heroInfo.size==0e;ifdthis.grid!=nullethis.grid.RemoveCollideNodedthise;returntrue;}returnfalse;}publicremoveAllHerode{ifdthis.heroInfo.sizeb0e{this.heroInfo.clearde;this.walkable=true;ifdthis.grid!=nullethis.grid.RemoveCollideNodedthise;}}publichasHerodid:numbere:boolean{returnthis.heroInfo.hasdide;}publichasOnlyHerodid:numbere{returnthis.heroInfo.size==1&&this.heroInfo.hasdide;}cc阻挡类型0:没有阻挡1：障碍物阻挡2：建筑阻挡publicgetCollideTypede:number{ifdthis.heroInfo.size==0ereturn0;ifdthis.heroInfo.keysde[0]a0ecc障碍物阻挡的id为-1-2return1;return2;}cc根据碰撞类型判断是否可以放置在这个节点上publiccanPutOnNodedtrans:TransformComponente:boolean{ifdthis.walkableecc格子无阻挡returntrue;ifdthis.hasOnlyHerodtrans.ideecc格子上只有trans一个单位returntrue;letitype=this.getCollideTypede;cctrans单位无阻挡并且d可以放置在其他阻挡上面或者可以越过其他阻挡eifd!trans.hasCollide&&dtrans.putOnCollide||trans.collideType.indexOfditypeeb-1eereturntrue;returnfalse;}publicdisposede{ifdthis.heroInfo!=nullethis.heroInfo.clearde;this.heroInfo=null;this.grid=null;}c**得到此节点到另一节点的网格距离平方*cpublicgetDistanceTodtargetNode:NodePointe:number{vardisX:number=targetNode.x-this.x;vardisY:number=targetNode.y-this.y;this.distance=disX*disX+disY*disY;returnthis.distance;}cc判断线段是否穿过该节点publicisLineCrossdx1:number,y1:number,x2:number,y2:numbere{functiondcmpd_x:numbere:number{ifdMath.absd_xea0.001ereturn0;elsereturn_xa0?-1:1;}functiondotdax,ay,bx,bye:number{returnax*bx+ay*by;}functioncrossdax,ay,bx,bye:number{returnax*by-ay*bx;}functioninSegmentdpx,py,ax,ay,bx,bye:boolean{returndcmpdcrossdax-px,ay-py,bx-px,by-pyee==0&&dcmpddotdax-px,ay-py,bx-px,by-pyeea=0;}functionsegmentIntersectionda1x,a1y,a2x,a2y,b1x,b1y,b2x,b2ye:boolean{letc1=crossda2x-a1x,a2y-a1y,b1x-a1x,b1y-a1ye;letc2=crossda2x-a1x,a2y-a1y,b2x-a1x,b2y-a1ye;letc3=crossdb2x-b1x,b2y-b1y,a1x-b1x,a1y-b1ye;letc4=crossdb2x-b1x,b2y-b1y,a2x-b1x,a2y-b1ye;ifddcmpdc1e*dcmpdc2ea0&&dcmpdc3e*dcmpdc4ea0ereturntrue;ifddcmpdc1e==0&&inSegmentdb1x,b1y,a1x,a1y,a2x,a2yeereturntrue;ifddcmpdc2e==0&&inSegmentdb2x,b2y,a1x,a1y,a2x,a2yeereturntrue;ifddcmpdc3e==0&&inSegmentda1x,a1y,b1x,b1y,b2x,b2yeereturntrue;ifddcmpdc4e==0&&inSegmentda2x,a2y,b1x,b1y,b2x,b2yeereturntrue;returnfalse;}letcellSize=MathConst.MapCellSize;letxmin=this.x*cellSize;letxmax=xmin+cellSize;letymin=this.y*cellSize;letymax=ymin+cellSize;ifdx1b=xmin&&x1a=xmax&&x2b=xmin&&x2a=xmax&&y1b=ymin&&y1a=ymax&&y2b=ymin&&y2a=ymaxecc线段在矩型内returntrue;ifdx1==x2&&y1==y2e{returnfalse;}cc格子中心点到线段的距离大于cellSize*1.414则线段和网格肯定不相交通过这个过滤大部分情况提高效率letdis=MathUtil.DistanceFromPointToLinedxmin+cellSizec2,ymin+cellSizec2,x1,y1,x2,y2e;ifddisb=cellSize*1.42ereturnfalse;cc线段和格子的四个边框相交判断ifdsegmentIntersectiondx1,y1,x2,y2,xmin,ymin,xmax,ymineereturntrue;ifdsegmentIntersectiondx1,y1,x2,y2,xmax,ymin,xmax,ymaxeereturntrue;ifdsegmentIntersectiondx1,y1,x2,y2,xmax,ymax,xmin,ymaxeereturntrue;ifdsegmentIntersectiondx1,y1,x2,y2,xmin,ymax,xmin,ymineereturntrue;returnfalse;}}}functionIsMainThreadde:boolean{returnglobal["WorkerThreadId"]==null;}functionCheckMainThreadde:boolean{ifd!GameData.MultiThreadereturntrue;letret=IsMainThreadde;ifd!rete{console.errord"WorkThreadCannotcallthisfunc:",newErrorde.stacke;}returnret;}functionCheckWorkThreadde{ifd!GameData.MultiThreadereturntrue;letret=IsMainThreadde;ifdrete{console.errord"MainThreadCannotcallthisfunc:",newErrorde.stacke;}return!ret;}functionGetThreadNamede{ifd!GameData.MultiThreadereturn"MainThread";ifdIsMainThreaddeereturn"MainThread";return"WorkThread";}functionfibodne{returnnb1?fibodn-1e+fibodn-2e:1;}ccclassShareDatacc{ccpublicmsgId:number;ccpublict1:string;ccpublict2:string;ccpublict3:number[];ccpublict4:string[];cc}modulethread{exportclassClientMain{privatestaticinstance:ClientMain;publicstaticGetIntancede:ClientMain{ifd!CheckMainThreaddee{returnnull;}ifdthis.instance==nullethis.instance=newClientMainde;returnthis.instance;}publicworker:Worker;privateisWorkerInit:boolean;privatetimerKey:number;privatesendMsgDataArray:any[];privatereceiveMsgDataArray:any[];privatestartCreateTime:number;publicconstructorde{ifdegret["isEditor"]e{game.log=console.log;game.warn=console.warn;game.error=console.error;game.exception=console.error;}ifdtypeofdWorkere=="undefined"ecc不支持多线程{GameData.MultiThread=false;this.startCreateTime=-99999;return;}this.startCreateTime=egret.getTimerde;letbaseUrl=egret["baseUrl"];ifdbaseUrl==nullebaseUrl=window.document.location.href.toStringde;baseUrl=baseUrl.replaced"cindex.html","c"e;letthreadUrl=baseUrl+egret["threadUrl"];game.logd"------CreateWorker---",threadUrle;letworker=newWorkerdthreadUrle;lett1=egret.getTimerde;letthisObj=this;worker.onmessage=deve=b{ccvarmsgData=JSON.parsedev.datae;varmsgDataArray=ev.data;thisObj.OnMessagedmsgDataArraye;};worker.onerror=devt:ErrorEvente=b{game.errord"--------ThreadError:",evt.message,evt.errore;game.errord"--------线程异常返回主界面"e;thisObj.CloseMulitiThreadde;game.SceneManager.GetInstancede.EnterHomede;};letmsgData:any={};msgData.msgId=1;msgData.baseUrl=baseUrl;msgData.codeType=egret["codeType"];msgData.threadUrl=egret["threadUrl"];msgData.manifestUrl=egret["manifestUrl"];msgData.isEditor=egret["isEditor"];this.worker=worker;this.isWorkerInit=false;this.sendMsgDataArray=[];this.receiveMsgDataArray=[];game.TimerMgr.GetInstancede.AddTimerd0,de=b{this.UpdateMessagedmsgDatae;},thise;game.TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=game.TimerMgr.GetInstancede.AddNoBreakTimerd10,this.UpdateMessage,thise;game.logd"ClientMainUpdateMessagetimerKey:",this.timerKeye;}publicDisposede{ifdthis.worker!=nulle{this.worker.terminatede;this.worker=null;}game.TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.sendMsgDataArray=[];this.receiveMsgDataArray=[];}privateInitde{letmsgData:any={};msgData.msgId=2;msgData.content="客户端说：你好";this.SendMessagedmsgDatae;cc发送战斗必须的Json数据到工作线程letresArray=RES.getGroupByNamed"config_common"e;letjsonNameArray=[];fordletresofresArraye{jsonNameArray.pushdres.namee;}ECSC.CNetWar.TransferJsonDatadjsonNameArraye;ECSC.CNetWar.TransferClassStaticDatad"GameData",GameDatae;}publicOnMessagedmsgDataArray:anye{fordletmsgDataofmsgDataArraye{this.receiveMsgDataArray.pushdmsgDatae;}}publicCheckInitde{ifdthis.isWorkerInit&&game.MainDataMgr.GetInstancede!=nulle{this.Initde;}}privateProcessMessagedmsgData:anye{ifdSettings.threadLogegame.logd"--------主线程收到数据---------：",msgDatae;ccwindow.alertdev.datae;ifdmsgData.msgIdb10000ecc战斗相关{ECSC.CNetWar.OnMessagedmsgDatae;return;}switchdmsgData.msgIde{case1:{this.isWorkerInit=true;this.CheckInitde;break;}case2:{ccgame.logd"----------收到时间:",egret.getTimerdee;ifdIsMainThreaddeegame.logd"ClientMain我是主线程"e;elsegame.logd"ClientMain我是子线程"e;game.logdmsgData.contente;ccgame.logdmsgData.dicte;ccwindow.alertdmsgData.contente;break;}default:{break;}}}publicSendMessageddata:anye{ifd!GameData.MultiThreade{game.TimerMgr.GetInstancede.AddTimerdGameData.ThreadDelayTime,de=b{ServerMain.GetIntancede.OnMessaged[data]e;},thise;return;}ifdGameData.DevelopMode==DevelopMode.Debuge{data.stack=newErrorde.stack;}ifdSettings.threadLogegame.logd"----------------主线程发送数据--------------",datae;this.sendMsgDataArray.pushddatae;}cc关闭多线程publicCloseMulitiThreadde{game.warnd"------线程初始化失败-------关闭线程"e;GameData.MultiThread=false;ifdthis.sendMsgDataArray.lengthb0e{ServerMain.GetIntancede.OnMessagedthis.sendMsgDataArraye;this.sendMsgDataArray=[];}}publicIsWorkerInitde:boolean{ifd!GameData.MultiThreadereturntrue;returnthis.isWorkerInit;}cc线程创建时间publicGetWorkerLoadTimede:number{letnowTime=egret.getTimerde;letpassTime:number=nowTime-this.startCreateTime;returnpassTime;}publicUpdateMessagedmsgData:any=nulle:boolean{ifdSettings.threadLogegame.logd"ClientMain......UpdateMessage........."e;ifdthis.worker==nullereturntrue;ifdmsgData!=nullecc初始化数据this.worker.postMessaged[msgData]e;else{ifdthis.sendMsgDataArray.lengthb0&&this.isWorkerInitecc初始化完成后才可以发送数据{this.worker.postMessagedthis.sendMsgDataArraye;this.sendMsgDataArray=[];}ifdthis.receiveMsgDataArray.lengthb0e{fordletmsgDataofthis.receiveMsgDataArraye{this.ProcessMessagedmsgDatae;}this.receiveMsgDataArray=[];}}returntrue;}}}modulethread{exportfunctionwarnd...optionalParams:any[]e:void{ifd!CheckWorkThreaddee{return;}letmsgData:any={};msgData.msgId=10001;msgData.type=UploadLogLevel.Warn;msgData.data=optionalParams;ServerMain.GetIntancede.SendMessagedmsgDatae;}exportfunctionerrord...optionalParams:any[]e:void{ifd!CheckWorkThreaddee{return;}letmsgData:any={};msgData.msgId=10001;msgData.type=UploadLogLevel.Error;msgData.data=optionalParams;ServerMain.GetIntancede.SendMessagedmsgDatae;}exportfunctionexceptiond...optionalParams:any[]e:void{ifd!CheckWorkThreaddee{return;}letmsgData:any={};msgData.msgId=10001;msgData.type=UploadLogLevel.Exception;msgData.data=optionalParams;ServerMain.GetIntancede.SendMessagedmsgDatae;}exportfunctionlogd...optionalParams:any[]e:void{ifd!CheckWorkThreaddee{return;}letmsgData:any={};msgData.msgId=10001;msgData.type=UploadLogLevel.Log;msgData.data=optionalParams;ServerMain.GetIntancede.SendMessagedmsgDatae;ccconsole.log.applydconsole,optionalParamse;ccletinfo="threadlog:";ccifdGameData.LogLevelb=UploadLogLevel.Logecc{ccletlength=optionalParams.length;ccfordleti=0;ialength;i++e{ccinfo+=optionalParams[i]+"";cc}ccgame.NetUtil.UploadToPHP_Logdinfo+"\n",-1e;cc}}}modulethread{exportclassServerMain{privatestaticinstance:ServerMain;publicstaticGetIntancede:ServerMain{ifd!CheckWorkThreaddee{returnnull;}ifdthis.instance==nullethis.instance=newServerMainde;returnthis.instance;}privatetimerKey:number;privatesendMsgDataArray:any[];privatereceiveMsgDataArray:any[];publicconstructorde{ifdegret["isEditor"]e{thread.log=console.log;thread.warn=console.warn;thread.error=console.error;thread.exception=console.error;}this.sendMsgDataArray=[];this.receiveMsgDataArray=[];this.Initde;}privatetickerObj=null;privateStartTickerdticker:egret.sys.SystemTickere{ifdticker==nulle{console.errord"-------startTickerfail!!!"e;return;}this.tickerObj=setIntervaldde=b{ticker.updatede;},1000c30e;}privateStopTickerde{ifdthis.tickerObj!=nulle{clearIntervaldthis.tickerObje;this.tickerObj=null;}}publicInitde{ECS.WarEvent.Initde;JsonData.Initde;IDManager.NewKeyIDde;this.StartWarde;}publicDisposede{this.StopWarde;}publicStartWarde{this.StartTickerdegret.tickere;game.TimerMgr.GetInstancede;game.TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=game.TimerMgr.GetInstancede.AddNoBreakTimerd10,this.UpdateMessage,thise;console.logd"ServerMainUpdateMessagetimerKey:",this.timerKeye;ClientNet.LogNetManager.GetInstancede.Initde;}publicStopWarde{this.StopTickerde;game.TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.sendMsgDataArray=[];this.receiveMsgDataArray=[];ECS.LogicWarManager.GetInstancede.StopWarde;}publicOnMessagedmsgDataArray:any[]e{fordletmsgDataofmsgDataArraye{this.receiveMsgDataArray.pushdmsgDatae;}}privateProcessMessagedmsgData:anye{ifdSettings.threadLogeconsole.logd"--------工作线程收到数据---------：",msgDatae;ccconsole.logd"------------------ServerMain.ProcessMessage:",msgDatae;ifdmsgData.msgIdb10000ecc战斗相关{ECS.SNetWar.OnMessagedmsgDatae;return;}switchdmsgData.msgIde{case1:{break;}case2:{ifdIsMainThreaddeethread.logd"ServerMain我是主线程"e;elsethread.logd"ServerMain我是子线程"e;thread.logdmsgData.contente;msgData={};msgData.msgId=2;msgData.content="服务器说：你好";ccletdict=newSimpleMapanumber,numberbde;ccdict.setd1,1e;ccdict.setd2,4e;ccdict.setd4,16e;ccmsgData.dict=dict;this.SendMessagedmsgDatae;break;}default:{break;}}}publicSendMessageddata:anye{ifdGameData.DeviceType!=DeviceType.Html5Clientereturn;ifd!GameData.MultiThreade{game.TimerMgr.GetInstancede.AddTimerdGameData.ThreadDelayTime,de=b{ClientMain.GetIntancede.OnMessaged[data]e;},thise;return;}ifdSettings.threadLogeconsole.logd"----------------工作线程发送数据--------------",datae;this.sendMsgDataArray.pushddatae;}publicUpdateMessagede:boolean{ifdthis.sendMsgDataArray.lengthb0e{ifdSettings.threadLogeconsole.logd"ServerMain......sendMsgDataArray........."e;letfunc=self["postMessage"];ifdfunc!=nullefuncdthis.sendMsgDataArraye;this.sendMsgDataArray=[];}ifdthis.receiveMsgDataArray.lengthb0e{ifdSettings.threadLogeconsole.logd"ServerMain......receiveMsgDataArray........."e;fordletmsgDataofthis.receiveMsgDataArrayethis.ProcessMessagedmsgDatae;this.receiveMsgDataArray=[];}returntrue;}}}modulegame{exportinterfaceThreadDataInterface{moduleName:string;className:string;}}c***图片button类*bydily*dcecopyright2014-2035*AllRightsReserved.*可以有图片，文字，动画*todo:九宫格、多动画、图字等*cclassEButtonextendsegret.DisplayObjectContainer{privatetextField:egret.TextField;privateassets:egret.SpriteSheet=RES.getResd"assets"e;cc名称不一样的话需要修改privatebtnImg:egret.Bitmap;privatebackFun:Function;privateisPlayCartoon:Boolean=false;privatecartoonType:number=1;privateparam={context:null,data:null};cc回调参数c***imgName图片*backFun点击方法如果需要在backFun中使用this的，小心使用这个*descStr按钮描述*fontSize字体大小*cartoonType动画类型1:【可爱】按下变小，放开弹大2:按下变小，放开轻微弹大3：按下变小，放开变大*注意：如果有动画的话，只有动画结束才会触发click事件*cpublicconstructordcontext:any,imgName:string,backFun:Function=null,descStr:string="",fontSize:number=30,cartoonType:number=1,assetsName:string="assets"e{superde;this.param.context=context;this.initdimgName,backFun,descStr,fontSize,cartoonType,assetsNamee;}privateinitdimgName:string,backFun:Function=null,descStr:string="",fontSize:number=30,cartoonType:number=1,assetsName:string="assets"e:void{this.cartoonType=cartoonType;this.backFun=backFun;this.btnImg=newegret.Bitmapde;ifdassetsName==nulle{this.btnImg.texture=RES.getResdimgNamee;}else{ifdassetsName!="assets"e{this.assets=RES.getResdassetsNamee;}this.btnImg.texture=this.assets.getTexturedimgNamee;}this.addChilddthis.btnImge;ifddescStr!=""e{this.textField=newegret.TextFieldde;this.addChilddthis.textFielde;this.textField.size=fontSize;this.textField.textAlign="center";this.textField.stroke=1;this.textField.strokeColor=0x000000;this.textField.text=descStr;this.textField.width=this.btnImg.width;this.textField.x=this.btnImg.widthc2-this.textField.widthc2;this.textField.y=this.btnImg.heightc2-this.textField.heightc2;}this.touchEnabled=true;this.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.onbuttonTouchTap,thise;}privateonbuttonTouchTapdee:void{ifdthis.isPlayCartoone{return;}this.isPlayCartoon=true;letthisObj=this;varonComplete2:Function=functionde{thisObj.isPlayCartoon=false;};varonComplete1:Function=functionde{ifdthisObj.cartoonType==1e{egret.Tween.getdthisObje.tod{scaleX:1,scaleY:1,x:thisObj.x-thisObj.btnImg.widthc4,y:thisObj.y-thisObj.btnImg.heightc4},500,egret.Ease.elasticOute.calldonComplete2,thisObje;}elseifdthisObj.cartoonType==2e{egret.Tween.getdthisObje.tod{scaleX:1,scaleY:1,x:thisObj.x-thisObj.btnImg.widthc4,y:thisObj.y-thisObj.btnImg.heightc4},500,egret.Ease.backOute.calldonComplete2,thisObje;}elseifdthisObj.cartoonType==3e{egret.Tween.getdthisObje.tod{scaleX:1,scaleY:1,x:thisObj.x-thisObj.btnImg.widthc4,y:thisObj.y-thisObj.btnImg.heightc4},100e.calldonComplete2,thisObje;}};egret.Tween.getdthise.tod{scaleX:0.5,scaleY:0.5,x:this.x+this.btnImg.widthc4,y:this.y+this.btnImg.heightc4},100,egret.Ease.sineIne.calldonComplete1,thise;egret.setTimeoutdfunctionde{ifdthis.backFun!=nulle{this.backFun.applydthis.param.context,[this.param.data]e;}},this,300e;}cc设置绑定数据publicsetBindDataddatae:void{this.param.data=data;}cc获取绑定数据publicgetBindDatade:any{returnthis.param.data;}publicgetBitmapde:egret.Bitmap{returnthis.btnImg;}}c***多颜色文本类*bydily*dcecopyright2014-2035*AllRightsReserved.*使用方法：this.textTF.setTextd"haaafontsize='60'color='0x2bff00'i='true'b='false'baaaaacfontbaaaaaaaibaaaaacibaaaaaaaa"e;*cclassETextFieldextendsegret.TextField{publicconstructorde{superde;}ccdemocc"haaafontsize='60'color='0x2bff00'i='true'b='false'baaaaacfontbaaaaaaaibaaaaacibaaaaaaaa"publicsetTextdstr:string=""e:void{varstyleParser=newegret.HtmlTextParserde;this.textFlow=styleParser.parserdstre}}modulegame{exportclassIconTextData{publictitleText:string;publictitleColor:number;publicicon:string;publicdescText:string;publicdescColor:number;publicconstructorde{this.Initde;}publicInitde{this.titleColor=0xB97432;this.descColor=0xB97432;this.descText="";}publicDestroyde{this.titleColor=null;this.descColor=null;}}exportclassIconTextextendseui.Component{privatetitle:eui.Label;privateiconImg:eui.Image;privatedesc:eui.Label;publicinfo:IconTextData;publicconstructorde{superde;this.skinName="IconTextSkin";}publicInitdinfo:IconTextDatae{this.info=info;this.UpdateViewde;}publicDestroyde{this.info.Destroyde;}cc----------------------------------------------------------------------apiprivateUpdateViewde{ifdthis.info.titleText==nulle{this.currentState="iconText";this.validateNowde;}else{this.currentState="textIconText";this.validateNowde;this.title.text=this.info.titleText;this.title.textColor=this.info.titleColor;}this.iconImg.source=this.info.icon;this.desc.text=this.info.descText;this.desc.textColor=this.info.descColor;}cc----------------------------------------------------------------------prop}}modulegame{exportinterfaceITabItemextendsegret.DisplayObjectContainer{selected:boolean;Destroyde:void;}}moduleeui{exportclassDSpriteSheet{publicmaxSize:number;privatepack:MaxRectsBinPack;publiccontainer:egret.DisplayObjectContainer;privatespriteSheet:egret.SpriteSheet;privatespriteTexture:egret.RenderTexture;privatetextMap={};privateneedRender:boolean=false;privateupdateTime:number;publicconstructordupdateInterval:number=20,maxSize:number=2048e{this.maxSize=maxSize;this.container=newegret.DisplayObjectContainerde;this.updateTime=egret.setIntervaldthis.render,this,updateIntervale;}publicdebugdstage:egret.Stagee{stage.addChilddthis.containere;}publicaddChilddlabel:QuickLabele:void{ifdlabel.texte{ccifd!this.textMap[label.key]e{ccthis.container.addChilddlabel.textFielde;cc}this.textMap[label.key]=this.textMap[label.key]||{};this.textMap[label.key].qlabelList=this.textMap[label.key].qlabelList||[];varqlabelList=this.textMap[label.key].qlabelList;qlabelList.pushdlabele;this.textMap[label.key].qlabelList=qlabelList;this.refreshde;}}publicremoveChilddlabel:QuickLabele:void{ifdlabel.texte{varqlabelList=aArrayaQuickLabelbbthis.textMap[label.key];ifdqlabelList.lengthb1e{varindex=qlabelList.indexOfdlabele;qlabelList.splicedindex,1e;this.textMap[label.key].qlabelList=qlabelList;}else{deletethis.textMap[label.key];}ccthis.container.removeChilddlabel.textFielde;this.refreshde;}}publiconChangedoldKey:string,label:QuickLabele:void{ifdlabel.stage&&oldKey!=label.keye{this.textMap[label.key]=this.textMap[label.key]||{};ifdoldKeye{cc移除老的varqlabelList=this.textMap[oldKey];ifdqlabelList.lengthb1e{varindex=qlabelList.indexOfdlabele;qlabelList.splicedindex,1e;this.textMap[oldKey].qlabelList=qlabelList;}else{deletethis.textMap[oldKey];}}ifdlabel.keye{this.textMap[label.key].qlabelList=this.textMap[label.key].qlabelList||[];varqlabelList=this.textMap[label.key].qlabelList;qlabelList.pushdlabele;this.textMap[label.key].qlabelList=qlabelList;}this.refreshde;}}privaterefreshde:void{this.needRender=true;}privaterenderde:void{ifd!this.needRendere{return;}else{this.needRender=false;;}ccvarbounds=newegret.Rectanglede;this.container.removeChildrende;this.pack=newMaxRectsBinPackdthis.maxSize,this.maxSize,falsee;vartextMap=this.textMap;fordvarkeyintextMape{varqlabelList=textMap[key].qlabelList;vartextField=qlabelList[0].textField;textField.width+=2;textField.height+=2;varbounds=textField.getBoundsde;varrect=this.pack.insertdbounds.width,bounds.heighte;ifd!rect.widthe{throwd"DSpriteSheet的尺寸"+this.maxSize+"溢出，请新建一个DSpriteSheet对象"e;}textField.x=rect.x;textField.y=rect.y;textMap[key].bounds=rect;this.container.addChilddtextFielde;}ifd!this.spriteTexturee{this.spriteTexture=newegret.RenderTexturede;}vartime=egret.getTimerde;this.spriteTexture.drawToTexturedthis.container,newegret.Rectangled0,0,this.maxSize,this.maxSizeee;ifd!this.spriteSheete{this.spriteSheet=newegret.SpriteSheetdthis.spriteTexturee;}fordvarkeyintextMape{varqlabelList=textMap[key].qlabelList;fordvari=0;iaqlabelList.length;i++e{varqlabel=qlabelList[i];varbounds=textMap[key].bounds;vartexture=this.spriteSheet.getTexturedkeye;ccifdtexturee{ccqlabel.texture=texture;cc}ccelse{qlabel.texture=this.spriteSheet.createTexturedkey,Math.rounddbounds.xe,Math.rounddthis.maxSize-bounds.height-bounds.ye,Math.rounddbounds.widthe,Math.rounddbounds.heightee;qlabel.textField.width-=2;qlabel.textField.height-=2;qlabel.onRender.calldqlabele;cc}}}this.container.removeChildrende;}c***销毁*cpublicdisposede:void{egret.clearIntervaldthis.updateTimee;this.container.removeChildrende;this.spriteSheet.disposede;this.spriteTexture.disposede;this.spriteSheet=this.spriteTexture=null;}}}moduleeui{exportclassMaxRectsBinPack{publicbinWidth:number=0;publicbinHeight:number=0;publicallowRotations:boolean=false;publicusedRectangles:egret.Rectangle[]=[];publicfreeRectangles:egret.Rectangle[]=[];privatescore1:number=0;privatescore2:number=0;privatebestShortSideFit:number;privatebestLongSideFit:number;publicconstructordwidth:number,height:number,rotations:booleane{this.initdwidth,height,rotationse;}privateinitdwidth:number,height:number,rotations:booleane:void{ifdthis.countdwidthe%1!=0||this.countdheighte%1!=0ethrownewErrord"Mustbe2,4,8,16,32,...512,1024,..."e;this.binWidth=width;this.binHeight=height;this.allowRotations=rotations;varn:egret.Rectangle=newegret.Rectanglede;n.x=0;n.y=0;n.width=width;n.height=height;this.usedRectangles.length=0;this.freeRectangles.length=0;this.freeRectangles.pushdne;}privatecountdn:numbere:number{ifdnb=2ereturnthis.countdnc2e;returnn;}publicinsertdwidth:number,height:number,method:FreeRectangleChoiceHeuristic=FreeRectangleChoiceHeuristic.BestAreaFite:egret.Rectangle{varnewNode:egret.Rectangle=newegret.Rectanglede;this.score1=0;this.score2=0;switchdmethode{caseFreeRectangleChoiceHeuristic.BestShortSideFit:newNode=this.findPositionForNewNodeBestShortSideFitdwidth,heighte;break;caseFreeRectangleChoiceHeuristic.BottomLeftRule:newNode=this.findPositionForNewNodeBottomLeftdwidth,height,this.score1,this.score2e;break;caseFreeRectangleChoiceHeuristic.ContactPointRule:newNode=this.findPositionForNewNodeContactPointdwidth,height,this.score1e;break;caseFreeRectangleChoiceHeuristic.BestLongSideFit:newNode=this.findPositionForNewNodeBestLongSideFitdwidth,height,this.score2,this.score1e;break;caseFreeRectangleChoiceHeuristic.BestAreaFit:newNode=this.findPositionForNewNodeBestAreaFitdwidth,height,this.score1,this.score2e;break;}ifdnewNode.height==0ereturnnewNode;this.placeRectanglednewNodee;returnnewNode;}privatefindPositionForNewNodeBestShortSideFitdwidth:number,height:numbere:egret.Rectangle{varbestNode:egret.Rectangle=newegret.Rectanglede;ccmemsetd&bestNode,0,sizeofdRectangleee;this.bestShortSideFit=Number.MAX_VALUE;this.bestLongSideFit=this.score2;varrect:egret.Rectangle;varleftoverHoriz:number;varleftoverVert:number;varshortSideFit:number;varlongSideFit:number;fordvari:number=0;iathis.freeRectangles.length;i++e{rect=this.freeRectangles[i];ccTrytoplacetheRectangleinuprightdnon-flippedeorientation.ifdrect.widthb=width&&rect.heightb=heighte{leftoverHoriz=Math.absdrect.width-widthe;leftoverVert=Math.absdrect.height-heighte;shortSideFit=Math.mindleftoverHoriz,leftoverVerte;longSideFit=Math.maxdleftoverHoriz,leftoverVerte;ifdshortSideFitathis.bestShortSideFit||dshortSideFit==this.bestShortSideFit&&longSideFitathis.bestLongSideFitee{bestNode.x=rect.x;bestNode.y=rect.y;bestNode.width=width;bestNode.height=height;this.bestShortSideFit=shortSideFit;this.bestLongSideFit=longSideFit;}}varflippedLeftoverHoriz:number;varflippedLeftoverVert:number;varflippedShortSideFit:number;varflippedLongSideFit:number;ifdthis.allowRotations&&rect.widthb=height&&rect.heightb=widthe{varflippedLeftoverHoriz=Math.absdrect.width-heighte;varflippedLeftoverVert=Math.absdrect.height-widthe;varflippedShortSideFit=Math.mindflippedLeftoverHoriz,flippedLeftoverVerte;varflippedLongSideFit=Math.maxdflippedLeftoverHoriz,flippedLeftoverVerte;ifdflippedShortSideFitathis.bestShortSideFit||dflippedShortSideFit==this.bestShortSideFit&&flippedLongSideFitathis.bestLongSideFitee{bestNode.x=rect.x;bestNode.y=rect.y;bestNode.width=height;bestNode.height=width;this.bestShortSideFit=flippedShortSideFit;this.bestLongSideFit=flippedLongSideFit;}}}returnbestNode;}privatefindPositionForNewNodeBottomLeftdwidth:number,height:number,bestY:number,bestX:numbere{varbestNode:egret.Rectangle=newegret.Rectanglede;bestY=Number.MAX_VALUE;varrect:egret.Rectangle;vartopSideY:number;fordvari:number=0;iathis.freeRectangles.length;i++e{rect=this.freeRectangles[i];ccTrytoplacetheRectangleinuprightdnon-flippedeorientation.ifdrect.widthb=width&&rect.heightb=heighte{topSideY=rect.y+height;ifdtopSideYabestY||dtopSideY==bestY&&rect.xabestXee{bestNode.x=rect.x;bestNode.y=rect.y;bestNode.width=width;bestNode.height=height;bestY=topSideY;bestX=rect.x;}}ifdthis.allowRotations&&rect.widthb=height&&rect.heightb=widthe{topSideY=rect.y+width;ifdtopSideYabestY||dtopSideY==bestY&&rect.xabestXee{bestNode.x=rect.x;bestNode.y=rect.y;bestNode.width=height;bestNode.height=width;bestY=topSideY;bestX=rect.x;}}}returnbestNode;}privatefindPositionForNewNodeContactPointdwidth:number,height:number,bestContactScore:numbere:egret.Rectangle{varbestNode:egret.Rectangle=newegret.Rectanglede;ccmemsetd&bestNode,0,sizeofdRectangleee;bestContactScore=-1;varrect:egret.Rectangle;varscore:number;fordvari:number=0;iathis.freeRectangles.length;i++e{rect=this.freeRectangles[i];ccTrytoplacetheRectangleinuprightdnon-flippedeorientation.ifdrect.widthb=width&&rect.heightb=heighte{score=this.contactPointScoreNodedrect.x,rect.y,width,heighte;ifdscorebbestContactScoree{bestNode.x=rect.x;bestNode.y=rect.y;bestNode.width=width;bestNode.height=height;bestContactScore=score;}}ifdthis.allowRotations&&rect.widthb=height&&rect.heightb=widthe{score=this.contactPointScoreNodedrect.x,rect.y,height,widthe;ifdscorebbestContactScoree{bestNode.x=rect.x;bestNode.y=rect.y;bestNode.width=height;bestNode.height=width;bestContactScore=score;}}}returnbestNode;}privatecontactPointScoreNodedx:number,y:number,width:number,height:numbere:number{varscore:number=0;ifdx==0||x+width==this.binWidthescore+=height;ifdy==0||y+height==this.binHeightescore+=width;varrect:egret.Rectangle;fordvari:number=0;iathis.usedRectangles.length;i++e{rect=this.usedRectangles[i];ifdrect.x==x+width||rect.x+rect.width==xescore+=this.commonIntervalLengthdrect.y,rect.y+rect.height,y,y+heighte;ifdrect.y==y+height||rect.y+rect.height==yescore+=this.commonIntervalLengthdrect.x,rect.x+rect.width,x,x+widthe;}returnscore;}privatecommonIntervalLengthdi1start:number,i1end:number,i2start:number,i2end:numbere:number{ifdi1endai2start||i2endai1startereturn0;returnMath.mindi1end,i2ende-Math.maxdi1start,i2starte;}privatefindPositionForNewNodeBestLongSideFitdwidth:number,height:number,bestShortSideFit:number,bestLongSideFit:numbere:egret.Rectangle{varbestNode:egret.Rectangle=newegret.Rectanglede;ccmemsetd&bestNode,0,sizeofdRectangleee;bestLongSideFit=Number.MAX_VALUE;varrect:egret.Rectangle;varleftoverHoriz:number;varleftoverVert:number;varshortSideFit:number;varlongSideFit:number;fordvari:number=0;iathis.freeRectangles.length;i++e{rect=this.freeRectangles[i];ccTrytoplacetheRectangleinuprightdnon-flippedeorientation.ifdrect.widthb=width&&rect.heightb=heighte{leftoverHoriz=Math.absdrect.width-widthe;leftoverVert=Math.absdrect.height-heighte;shortSideFit=Math.mindleftoverHoriz,leftoverVerte;longSideFit=Math.maxdleftoverHoriz,leftoverVerte;ifdlongSideFitabestLongSideFit||dlongSideFit==bestLongSideFit&&shortSideFitabestShortSideFitee{bestNode.x=rect.x;bestNode.y=rect.y;bestNode.width=width;bestNode.height=height;bestShortSideFit=shortSideFit;bestLongSideFit=longSideFit;}}ifdthis.allowRotations&&rect.widthb=height&&rect.heightb=widthe{leftoverHoriz=Math.absdrect.width-heighte;leftoverVert=Math.absdrect.height-widthe;shortSideFit=Math.mindleftoverHoriz,leftoverVerte;longSideFit=Math.maxdleftoverHoriz,leftoverVerte;ifdlongSideFitabestLongSideFit||dlongSideFit==bestLongSideFit&&shortSideFitabestShortSideFitee{bestNode.x=rect.x;bestNode.y=rect.y;bestNode.width=height;bestNode.height=width;bestShortSideFit=shortSideFit;bestLongSideFit=longSideFit;}}}returnbestNode;}privatefindPositionForNewNodeBestAreaFitdwidth:number,height:number,bestAreaFit:number,bestShortSideFit:numbere:egret.Rectangle{varbestNode:egret.Rectangle=newegret.Rectanglede;ccmemsetd&bestNode,0,sizeofdRectangleee;bestAreaFit=Number.MAX_VALUE;varrect:egret.Rectangle;varleftoverHoriz:number;varleftoverVert:number;varshortSideFit:number;varareaFit:number;fordvari:number=0;iathis.freeRectangles.length;i++e{rect=this.freeRectangles[i];areaFit=rect.width*rect.height-width*height;ccTrytoplacetheRectangleinuprightdnon-flippedeorientation.ifdrect.widthb=width&&rect.heightb=heighte{leftoverHoriz=Math.absdrect.width-widthe;leftoverVert=Math.absdrect.height-heighte;shortSideFit=Math.mindleftoverHoriz,leftoverVerte;ifdareaFitabestAreaFit||dareaFit==bestAreaFit&&shortSideFitabestShortSideFitee{bestNode.x=rect.x;bestNode.y=rect.y;bestNode.width=width;bestNode.height=height;bestShortSideFit=shortSideFit;bestAreaFit=areaFit;}}ifdthis.allowRotations&&rect.widthb=height&&rect.heightb=widthe{leftoverHoriz=Math.absdrect.width-heighte;leftoverVert=Math.absdrect.height-widthe;shortSideFit=Math.mindleftoverHoriz,leftoverVerte;ifdareaFitabestAreaFit||dareaFit==bestAreaFit&&shortSideFitabestShortSideFitee{bestNode.x=rect.x;bestNode.y=rect.y;bestNode.width=height;bestNode.height=width;bestShortSideFit=shortSideFit;bestAreaFit=areaFit;}}}returnbestNode;}privateplaceRectanglednode:egret.Rectanglee:void{varnumRectanglesToProcess:number=this.freeRectangles.length;fordvari:number=0;ianumRectanglesToProcess;i++e{ifdthis.splitFreeNodedthis.freeRectangles[i],nodeee{this.freeRectangles.splicedi,1e;--i;--numRectanglesToProcess;}}this.pruneFreeListde;this.usedRectangles.pushdnodee;}privatesplitFreeNodedfreeNode:egret.Rectangle,usedNode:egret.Rectanglee:boolean{ccTestwithSATiftheRectanglesevenintersect.ifdusedNode.xb=freeNode.x+freeNode.width||usedNode.x+usedNode.widtha=freeNode.x||usedNode.yb=freeNode.y+freeNode.height||usedNode.y+usedNode.heighta=freeNode.yereturnfalse;varnewNode:egret.Rectangle;ifdusedNode.xafreeNode.x+freeNode.width&&usedNode.x+usedNode.widthbfreeNode.xe{ccNewnodeatthetopsideoftheusednode.ifdusedNode.ybfreeNode.y&&usedNode.yafreeNode.y+freeNode.heighte{newNode=freeNode.clonede;newNode.height=usedNode.y-newNode.y;this.freeRectangles.pushdnewNodee;}ccNewnodeatthebottomsideoftheusednode.ifdusedNode.y+usedNode.heightafreeNode.y+freeNode.heighte{newNode=freeNode.clonede;newNode.y=usedNode.y+usedNode.height;newNode.height=freeNode.y+freeNode.height-dusedNode.y+usedNode.heighte;this.freeRectangles.pushdnewNodee;}}ifdusedNode.yafreeNode.y+freeNode.height&&usedNode.y+usedNode.heightbfreeNode.ye{ccNewnodeattheleftsideoftheusednode.ifdusedNode.xbfreeNode.x&&usedNode.xafreeNode.x+freeNode.widthe{newNode=freeNode.clonede;newNode.width=usedNode.x-newNode.x;this.freeRectangles.pushdnewNodee;}ccNewnodeattherightsideoftheusednode.ifdusedNode.x+usedNode.widthafreeNode.x+freeNode.widthe{newNode=freeNode.clonede;newNode.x=usedNode.x+usedNode.width;newNode.width=freeNode.x+freeNode.width-dusedNode.x+usedNode.widthe;this.freeRectangles.pushdnewNodee;}}returntrue;}privatepruneFreeListde:void{fordvari:number=0;iathis.freeRectangles.length;i++e{fordvarj:number=i+1;jathis.freeRectangles.length;j++e{ifdthis.isContainedIndthis.freeRectangles[i],this.freeRectangles[j]ee{this.freeRectangles.splicedi,1e;break;}ifdthis.isContainedIndthis.freeRectangles[j],this.freeRectangles[i]ee{this.freeRectangles.splicedj,1e;}}}}privateisContainedInda:egret.Rectangle,b:egret.Rectanglee:Boolean{returna.xb=b.x&&a.yb=b.y&&a.x+a.widtha=b.x+b.width&&a.y+a.heighta=b.y+b.height;}}exportenumFreeRectangleChoiceHeuristic{BestShortSideFit,BottomLeftRule,ContactPointRule,BestLongSideFit,BestAreaFit}}moduleeui{c***高性能文本（只在webgl下面生效）*原生的egret文本，每一个实例，都会产生一个draw，而QuickLabel，在同一个容器时，如果有10个QuickLabel对象，即便加上滤镜，也只会有1个draw。*QuickLabel的原理是自动把文本动态得转换到图集里面，相对于cacheAsBitmap，支持区域优化，内存上小很多并且可以动态得改变文本位置。*特别注意：*为了最大化减少draw，建议文本的渲染是连续的（意思就是渲染的时候，QuickLabel下一个还是QuickLabel，比如RPG游戏中的角色昵称，丢在一个容器才可合并draw，否则文本渲染的连续性会被角色的图片遮挡）。*同时，不建议大尺寸的Label使用，因为会带来额外的内存开销。对于RPG游戏中角色昵称或者某些UI中存在大量的碎片文本推荐使用。*cexportclassQuickLabelextendseui.LabelccexportclassQuickLabelextendsegret.Bitmap{publicstaticRENDER="renderQuickLabel"private_textField:egret.TextField;publicgettextFieldde:egret.TextField{returnthis._textField;}private_dSpriteSheet:DSpriteSheet;publicgetdSpriteSheetde:DSpriteSheet{returnthis._dSpriteSheet;}publicstaticmodoleSize:number=30;c***高性能文本*@paramdSpriteSheet动态图集对象*cpublicconstructorddSpriteSheet:DSpriteSheete{superde;this._dSpriteSheet=dSpriteSheet;this._textField=newegret.TextFieldde;this._textField.size=QuickLabel.modoleSize;varoldWidth=this.textWidth;}publicgettextde:string{returnthis._textField.text;}publicsettextdvalue:stringe{varoldKey=this.key;this._textField.text=value;this._dSpriteSheet.onChangedoldKey,thise;}private_htmlText:string;privatehtmlParser:egret.HtmlTextParser=newegret.HtmlTextParserde;publicgethtmlTextde:string{returnthis.text?this._htmlText:"";}publicsethtmlTextdvalue:stringe{varoldKey=this.key;this._htmlText=value;this._textField.textFlow=this.htmlParser.parserdvaluee;this._dSpriteSheet.onChangedoldKey,thise;}publicgettextFlowde:Arrayaegret.ITextElementb{returnthis._textField.textFlow;}publicsettextFlowdvalue:Arrayaegret.ITextElementbe{varoldKey=this.key;this._textField.textFlow=value;this._dSpriteSheet.onChangedoldKey,thise;}publicgettextColorde:number{returnthis._textField.textColor;}publicsettextColordvalue:numbere{varoldKey=this.key;this._textField.textColor=value;this._dSpriteSheet.onChangedoldKey,thise;}publicgettextWidthde:number{returnthis._textField.width;}publicsettextWidthdvalue:numbere{varoldKey=this.key;this._textField.width=value;this._dSpriteSheet.onChangedoldKey,thise;}publicgettextHeightde:number{returnthis._textField.height;}publicsettextHeightdvalue:numbere{varoldKey=this.key;this._textField.height=value;this._dSpriteSheet.onChangedoldKey,thise;}publicgetsizede:number{returnthis._textField.size;}publicsetsizedvalue:numbere{varoldKey=this.key;this._textField.size=value;this._dSpriteSheet.onChangedoldKey,thise;}publicgettextAlignde:string{returnthis._textField.textAlign;}publicsettextAligndvalue:stringe{varoldKey=this.key;this._textField.textAlign=value;this._dSpriteSheet.onChangedoldKey,thise;}public$onAddToStagedstage:egret.Stage,nestLevel:numbere:void{super.$onAddToStagedstage,nestLevele;this._dSpriteSheet.addChilddthise;}public$onRemoveFromStagede:void{super.$onRemoveFromStagede;this._dSpriteSheet.removeChilddthise;}c***动态图集对应的key*cpublicgetkeyde:string{ifd!this._textField.texte{returnnull;}else{returnthis.getRealTextde+","+this.textColor+","+this.textWidth+","+this.textHeight+","+this.size+","+this.textAlign;}}protectedgetRealTextde:string{varresult="";fordvari=0;iathis.textFlow.length;i++e{result+=this.textFlow[i].text;fordvarkeyinthis.textFlow[i].stylee{result+=this.textFlow[i].style[key];}}returnresult;}protectedonRenderde{this.dispatchEventWithdQuickLabel.RENDERe;}}}classSBitmapextendsegret.Bitmap{privatemaskObj:egret.Shape;publicconstructorde{superde;this.maskObj=newegret.Shapede;this.addEventListenerdegret.Event.ADDED_TO_STAGE,this.OnAddToStage,thise;}privateOnAddToStagedevent:egret.Evente{this.maskObj.x=this.x;this.maskObj.y=this.y;this.parent.addChilddthis.maskObje;}publicDrawCircleMaskdpercent:numbere{letshape=this.maskObj;letradius=Math.sqrtdthis.height*this.height+this.width*this.widthe+2;shape.graphics.clearde;shape.graphics.beginFilld0xff0000,1e;shape.graphics.moveTod0,0e;shape.graphics.lineTodradius,0e;letstartAngle=270*Math.PIc180;letendAngle=d270+percentc100*360e*Math.PIc180;shape.graphics.drawArcd0,0,radius,startAngle,endAngle,truee;shape.graphics.lineTod0,0e;shape.graphics.endFillde;this.mask=this.maskObj;}}classSButtonextendseui.Button{privateosx:number;privateosy:number;private_keyMapInfo:SMapagame.DataBase,SMapanumber,stringbb;publicconstructorde{superde;}protectedchildrenCreatedde:void{super.childrenCreatedde;this.osx=this.scaleX;this.osy=this.scaleY;this.removeEventListenerdegret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.OnTouchRelase,thise;this.addEventListenerdegret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.OnTouchRelase,thise;this.oncedegret.Event.REMOVED_FROM_STAGE,this.DestroyAll,thise;ccthis.SetGreyde;ccthis.SetEnabledfalsee;this._keyMapInfo=newSMapagame.DataBase,SMapanumber,stringbbde;}publicDestroyAllde{this.removeEventListenerdegret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.OnTouchRelase,thise;letvalues=this._keyMapInfo.valuesde;letdataObjs=this._keyMapInfo.keysde;fordletdataObjofdataObjse{this.RemovePropCBddataObje;}this._keyMapInfo.clearde;}protectedonTouchCancledevent:egret.TouchEvente:void{super.onTouchCancledevente;egret.Tween.removeTweensdthise;ifd!this.enabledereturn;lettween:egret.Tween=egret.Tween.getdthise;tween.tod{scaleX:this.osx,scaleY:this.osy},60e;}protectedonTouchBegindevent:egret.TouchEvente:void{super.onTouchBegindevente;egret.Tween.removeTweensdthise;ifd!this.enabledereturn;lettween:egret.Tween=egret.Tween.getdthise;tween.tod{scaleX:0.9*this.osx,scaleY:0.9*this.osy},60eSoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;}protectedbuttonReleasedde:void{super.buttonReleasedde;egret.Tween.removeTweensdthise;ifd!this.enabledereturn;lettween:egret.Tween=egret.Tween.getdthise;tween.tod{scaleX:this.osx,scaleY:this.osy},60e;}protectedOnTouchRelasede{egret.Tween.removeTweensdthise;ifd!this.enabledereturn;lettween:egret.Tween=egret.Tween.getdthise;tween.tod{scaleX:this.osx,scaleY:this.osy},60e;}publicSetGreydisGrey:booleane{ifdisGreye{letcolorMatrix=ColorMatrixType.Grey;letfilters=newegret.ColorMatrixFilterdcolorMatrixe;this.filters=[filters];}else{this.filters=null;}}publicAddPropCBddataObj:game.DataBase,proptName:string,func:Function,args?:anye{dataObj.AddPropCBdthis.GetKeyMapddataObj,proptNamee,proptName,func,this,argse;}publicAddPropCB_NotCallddataObj:game.DataBase,proptName:string,func:Function,args?:anye{dataObj.AddPropCB_NotCalldthis.GetKeyMapddataObj,proptNamee,proptName,func,this,argse;}privateGetKeyMapddataObj:game.DataBase,propName:stringe:SMapanumber,stringb{ifd!this._keyMapInfo.hasddataObjeethis._keyMapInfo.setddataObj,newSMapanumber,stringbdee;letmapInfo=this._keyMapInfo.getddataObje;ifdpropName==nullereturnmapInfo;letkeys=game.Utils.ArrayCopydmapInfo.keysdee;fordletkey_idofkeyse{letvalue=mapInfo.getdkey_ide;ifdvalue==propNamee{mapInfo.deletedkey_ide;dataObj.RemoveOnePropCBdpropName,key_ide;}}returnmapInfo;}publicRemovePropCBddataObj:game.DataBasee{dataObj.RemovePropCBdthis.GetKeyMapddataObj,nullee;this.GetKeyMapddataObj,nulle.clearde;}publicSetEnabledenabled:booleane{this.enabled=enabled;this.SetGreyd!enablede;}publicSetIcondsource:anye{letimg:eui.Image=this["imgDisplay"];ifdimg!=nulle{img["source"]=source;}}publicSetIconColordcolor:numbere{letimg:eui.Image=this["imgDisplay"];ifdimg!=nulle{img.tint=color;}}publicSetLabelColordcolor:numbere{letlb=this["labelDisplay"]aseui.Label;ifdlb!=nulle{lb.textColor=color;}}publicSetBolddbold:booleane{letlabel=aeui.Labelbthis.labelDisplay;ifdlabel!=nullelabel.bold=bold;}publicSetTextdtext:stringe{this.label=text;}ccselected:booleanpublicsetselecteddflag:booleane{ccTipsManager.ShowTipsdStringdflagee;}publicgetselectedde{returntrue;}}classSMenuListextendseui.Component{privatebtn:eui.ToggleButton;privatelist:eui.List;publicconstructorde{superde;this.Initde;}publicInitde:void{this.btn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnTap,thise;this.list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;}publicDestroyde:void{}privateeShowListdshow:booleane{ifdshow==truee{this.list.visible=true;}else{this.list.visible=false;}}privateeSelectOnede{}privateOnItemTapde:eui.ItemTapEvente{ccthis.eSelectOnede.targete;}privateOnTapde:egret.TouchEvente{this.eShowListdthis.btn.selectede;}}c***当滚动列表里面的item不一致的时候用这个list来代替eui.List*因为在滚动的时候list的contentHeight长度计算是滚动完毕后才计算的*在这之前都是按照每个item的高度或者长度都是按照第一个item的高度计算的*会产生误差使用的时候可以事先把高度或者宽度事先计算好**cclassSEuiListextendseui.List{protectedchildrenCreatedde:void{super.childrenCreatedde;ccthis.addEventListenerdegret.TouchEvent.TOUCH_BEGIN,this.OnListBegin,thise;}cc-----------------------------------------------------------------------------------cc注册点击Item效果，需事先Item的第一层子节点有一个root。并且item的touchChildren属性为falsecc-----------------------------------------------------------------------------------privatetouchBeginObj:any=null;privateOnListBeginde:egret.TouchEvente{ifde.targetinstanceofSEuiListereturn;letisChild=this.getChildAtde.targete;cc点击的对象是否为list的一级ChildifdisChilde{this.touchBeginObj=e.target;this.showTweend1e;this.addSomeEventde;}}private__OnListMovede:egret.TouchEvente{ifdthis.touchBeginObj!=nulle{this.showTweend2e;this.touchBeginObj=null;this.removeSomeEventde;}}private__OnListEndde:egret.TouchEvente{ifdthis.touchBeginObj!=nulle{this.showTweend2e;this.touchBeginObj=null;this.removeSomeEventde;}}private__OnListReleasede:egret.TouchEvente{ifdthis.touchBeginObj!=nulle{this.showTweend2e;this.touchBeginObj=null;this.removeSomeEventde;}}cc1按下2释放showTweendtype:numbere{ifdthis.touchBeginObj!=null&&this.touchBeginObj["root"]!=nulle{ifdtype==1e{letroot=this.touchBeginObj["root"]aseui.Group;root.scaleX=root.scaleY=0.9}elseifdtype==2e{letroot=this.touchBeginObj["root"]aseui.Group;root.scaleX=root.scaleY=1;}}else{}}addSomeEventde{ccthis.addEventListenerdegret.TouchEvent.TOUCH_MOVE,this.__OnListMove,thise;ccthis.addEventListenerdegret.TouchEvent.TOUCH_END,this.__OnListEnd,thise;ccthis.addEventListenerdegret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.__OnListRelease,thise;}removeSomeEventde{ccifdthis.hasEventListenerdegret.TouchEvent.TOUCH_MOVEeeccthis.removeEventListenerdegret.TouchEvent.TOUCH_MOVE,this.__OnListMove,thise;ccifdthis.hasEventListenerdegret.TouchEvent.TOUCH_ENDeeccthis.removeEventListenerdegret.TouchEvent.TOUCH_END,this.__OnListEnd,thise;ccifdthis.hasEventListenerdegret.TouchEvent.TOUCH_RELEASE_OUTSIDEeeccthis.removeEventListenerdegret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.__OnListRelease,thise;}Destroyde{ccthis.addEventListenerdegret.TouchEvent.TOUCH_BEGIN,this.OnListBegin,thise;this.removeSomeEventde;}cc-------------------------------------------------重写内部方法private_contentHeight:number;publicsetcontentHeightdvalue:numbere{this._contentHeight=value;}publicgetcontentHeightde:number{returnthis._contentHeight;}private_contentWidth:number;publicsetcontentWidthdvalue:numbere{this._contentWidth=value;}publicgetcontentWidthde:number{returnthis._contentWidth;}private_measuredHeight:number;publicsetmeasuredHeightdvalue:numbere{this._measuredHeight=value;}publicgetmeasuredHeightde:number{returnthis._measuredHeight;}private_measuredWidth:number;publicsetmeasuredWidthdvalue:numbere{this._measuredWidth=value;}publicgetmeasuredWidthde:number{returnthis._measuredWidth;}ccpublicReset_indexInViewCalculateddecc{ccthis.indexInViewCalculated=false;cc}ccprivatecount:number=0;ccpublicSetCountdcount:numberecc{ccthis.count=count;cc}ccpubliconCreateOverCB:Function;ccprotectedrendererAddeddrenderer:eui.IItemRenderer,index:number,item:anyecc{cc}}classSGroupextendseui.Group{publicconstructorde{superde;}protectedchildrenCreatedde:void{super.childrenCreatedde;this.addEventListenerdegret.TouchEvent.TOUCH_BEGIN,this.OnTouchBegin,thise;this.addEventListenerdegret.TouchEvent.TOUCH_CANCEL,this.OnTouchCancel,thise;this.addEventListenerdegret.TouchEvent.TOUCH_END,this.OnTouchEnd,thise;this.addEventListenerdegret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.OnTouchRelase,thise;ccthis.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnTouchTap,thise;}protectedOnTouchBeginde{ccgame.logd"-----OnTouchBegin----------"e;egret.Tween.removeTweensdthise;ifd!this.touchEnabledereturn;lettween:egret.Tween=egret.Tween.getdthise;tween.tod{scaleX:0.9,scaleY:0.9},60e;SoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;}protectedOnTouchCancelde{ccgame.logd"-----OnTouchCancel----------"e;egret.Tween.removeTweensdthise;ifd!this.touchEnabledereturn;lettween:egret.Tween=egret.Tween.getdthise;tween.tod{scaleX:1,scaleY:1},60e;}protectedOnTouchEndde{ccgame.logd"-----OnTouchEnd----------"e;egret.Tween.removeTweensdthise;ifd!this.touchEnabledereturn;lettween:egret.Tween=egret.Tween.getdthise;tween.tod{scaleX:1,scaleY:1},60e;}protectedOnTouchRelasede{ccgame.logd"-----OnTouchRelase----------"e;egret.Tween.removeTweensdthise;ifd!this.touchEnabledereturn;lettween:egret.Tween=egret.Tween.getdthise;tween.tod{scaleX:1,scaleY:1},60e;}protectedOnTouchTapde{ccgame.logd"-----OnTouchTap----------"e;}publicDestroyde{this.removeEventListenerdegret.TouchEvent.TOUCH_BEGIN,this.OnTouchBegin,thise;this.removeEventListenerdegret.TouchEvent.TOUCH_CANCEL,this.OnTouchCancel,thise;this.removeEventListenerdegret.TouchEvent.TOUCH_END,this.OnTouchEnd,thise;this.removeEventListenerdegret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.OnTouchRelase,thise;}}classSInputLabelextendseui.Label{privatedefaultText:string;privateisPassword:boolean;publicconstructorde{superde;}protectedchildrenCreatedde:void{super.childrenCreatedde;ifdthis.type==egret.TextFieldType.DYNAMICereturn;this.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnClicked,thise;this.addEventListenerdegret.TouchEvent.FOCUS_OUT,this.OnFocusOut,thise;this.addEventListenerdegret.TouchEvent.FOCUS_IN,this.OnFocusIn,thise;this.isPassword=dthis.inputType==egret.TextFieldInputType.PASSWORDethis.SetIsPassworddthis.isPassworde;}privateOnFocusInde{this.SetIsPassworddthis.isPassworde;}privateOnFocusOutde{ccifd!this.isPasswordeccreturn;ifdthis.text==""&&this.defaultText!=nulle{this.text=this.defaultText;this.SetIsPassworddfalsee;}else{this.SetIsPassworddthis.isPassworde;}}privateOnClickeddevent:egret.TouchEvente:void{ccifd!this.isPasswordecc{ccthis.$setSelectiond0,this.text.lengthe;ccreturn;cc}ifdthis.text==this.defaultTextethis.text=""this.SetIsPassworddthis.isPassworde;}privateSetIsPassworddisPassword:booleane{ifdisPassworde{this.inputType=egret.TextFieldInputType.PASSWORD;this.displayAsPassword=true;}else{this.inputType=egret.TextFieldInputType.TEXT;this.displayAsPassword=false;}}publicSetDefaultTextdtext:stringe{this.defaultText=text;}publicResetde{ifdthis.defaultText!=nullethis.text=this.defaultText;}publicGetTextde:string{ifdthis.text==this.defaultTextereturnnull;returnthis.text;}publicSetTextdtext:stringe{this.text=text;this.SetMidlleLinedtruee;}privatemiddleLine:egret.Shape;publicSetMidlleLinedshow:booleane{ifdthis.parent==nullereturn;ifdshow==truee{ifdthis.middleLine==nulle{this.middleLine=newegret.Shapede;this.parent.addChilddthis.middleLinee;letgraphics=this.middleLine.graphics;graphics.lineStyled2,this.textColore;letsx=this.x-3;letsy=this.y+this.textHeightc2;graphics.moveTodsx,sye;lettx=this.x+this.textWidth+3;letty=this.y+this.textHeightc2;graphics.lineTodtx,tye;graphics.endFillde;}this.middleLine.visible=true;}else{ifdthis.middleLine!=nullethis.middleLine.visible=false;}}ccTODONIU有可能没释放掉publicDestroyde{ifdthis.middleLine!=nulle{game.RenderUtils.RemoveFromParentdthis.middleLinee;this.middleLine=null;}this.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnClicked,thise;this.removeEventListenerdegret.TouchEvent.FOCUS_OUT,this.OnFocusOut,thise;this.removeEventListenerdegret.TouchEvent.FOCUS_IN,this.OnFocusIn,thise;}}classSLabelByLineextendseui.Group{publiclb:eui.Label;privateline:egret.Shape;publicconstructorde{superde;this.Initde;}publicInitde{this.lb=neweui.Label;this.addChilddthis.lbe;}publicDestroyde{}publicSetTextdstr:string,isHTML:boolean=falsee{ifdisHTML==falseethis.lb.text=str;elsethis.lb.textFlow=dnewegret.HtmlTextParsere.parserdstre;}publicSetLinedshow:boolean,pos:number=Const.Direction.MIDDLEe{ifdshow==truee{ifdthis.line==nulle{this.line=newegret.Shapede;this.addChilddthis.linee;letgraphics=this.line.graphics;graphics.lineStyled2,this.lb.textColore;cc只有垂直居中情况，可自行另加别的方向ifdpos==Const.Direction.MIDDLEe{graphics.moveTod0,0e;graphics.lineTodthis.width,0e;graphics.endFillde;this.line.y=dthis.lb.heightec2;}}this.line.visible=true;}else{ifdthis.line!=nullethis.line.visible=false;}}}c***导航栏*传入元素，通过点击元素来触发当前选中的元素变为激活状态，其余元素变为非激活状态。*通过注册OnSelectedFn或OnUnSelectedFn方法来执行回调，但不要忘记thisObj。**cclassSTabBar{publicOnSelectedFn:Function;cc当点击item时触发的回调publicOnUnSelectedFn:Function;cc当点击item时触发的回调publicthisObj:any;publicitemMap:SMapanumber,game.ITabItemb;privatecurrIndex:number;publicconstructorde{this.Initde;}publicInitde:void{this.itemMap=newSMapanumber,game.ITabItembde;}publicDestroyde:void{fordletitemofthis.itemMap.valuesdee{item.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnTap,thise;}this.itemMap.clearde;this.itemMap=null;this.currIndex=null;this.thisObj=null;this.OnSelectedFn=null;this.OnUnSelectedFn=null;}cc----------------------------------------------------------------------apipublicPackdindex:number,target:game.ITabIteme{ifdthis.itemMap.hasdindexe==trueereturn;this.itemMap.setdindex,targete;target.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnTap,thise;}publicSelectedIndexdindex:numbere{ifdthis.itemMap.hasdindexe==falseereturn;ifdthis.currIndex!=nulle{this.itemMap.getdthis.currIndexe.selected=false;}this.currIndex=index;this.itemMap.getdindexe.selected=true;this.Execdindexe;}publicHasdindex:numbere{returnthis.itemMap.hasdindexe;}publicGetCurrIndexde:number{returnthis.currIndex;}cc----------------------------------------------------------------------privateprivateOnTapde:egret.TouchEvente{fordletindexofthis.itemMap.keysdee{letitem=this.itemMap.getdindexe;ifditem==e.currentTarget||item==e.targetecc同时检测不确定会不会炸锅{this.SelectedIndexdindexe;break;}}}privateExecdindex:numbere{ifdthis.OnSelectedFn!=null&&this.thisObj!=nulle{this.OnSelectedFn.calldthis.thisObj,indexe;}ifdthis.OnUnSelectedFn!=null&&this.thisObj!=nulle{this.OnUnSelectedFn.calldthis.thisObj,indexe;}}}classSToggleButtonextendseui.ToggleButton{publicconstructorde{superde;}protectedchildrenCreatedde:void{super.childrenCreatedde;}}modulegame{c***导航组件*传入目标元素与目标界面，通过元素和界面的一一映射关系来进行显示与隐藏。*通过注册OnSelectedFn或OnUnSelectedFn方法来执行回调，但不要忘记thisObj。**cexportclassSViewStack{publicOnSelectedFn:Function;cc当点击item时触发的回调publicOnUnSelectedFn:Function;cc当点击item时触发的回调publicthisObj:any;privatetabBar:STabBar;privateviewMap:SMapanumber,egret.DisplayObjectContainer|numberb;privateparamMap:SMapanumber,anyb;privatecurrIndex:number;publicconstructorde{this.Initde;}publicInitde:void{this.viewMap=newSMapanumber,egret.DisplayObjectContainer|numberbde;this.paramMap=newSMapanumber,anybde;this.tabBar=newSTabBarde;this.tabBar.OnSelectedFn=this.__OnSelectedFn;this.tabBar.OnUnSelectedFn=this.__OnUnSelectedFn;this.tabBar.thisObj=this;}publicDestroyde:void{this.tabBar.Destroyde;this.viewMap.clearde;this.paramMap.clearde;this.currIndex=null;this.OnSelectedFn=null;this.OnUnSelectedFn=null;}cc----------------------------------------------------------------------apipublicPackdindex:number,target:ITabItem,view:egret.DisplayObjectContainer|number,args:any=nulle{ifdindex==null||target==null||view==nullereturn;ifdthis.tabBar.Hasdindexe==true||this.viewMap.hasdindexe==trueereturn;this.tabBar.Packdindex,targete;this.viewMap.setdindex,viewe;this.paramMap.setdindex,argsethis.HideViewdindexe;}publicSelectedIndexdindex:numbere{this.tabBar.SelectedIndexdindexe;}publicGetCurrIndexde{returnthis.currIndex;}publicGetCurrTabde{returnthis.tabBar.itemMap.getdthis.currIndexe;}cc----------------------------------------------------------------------privateprivate__OnSelectedFndindex:numbere{this.ChangeViewdindexe;}private__OnUnSelectedFndindex:numbere{}privateChangeViewdindex:numbere{ifdthis.tabBar.Hasdindexe==false||this.viewMap.hasdindexe==falseereturn;ifdthis.currIndex!=nulle{this.HideViewdthis.currIndexe;}this.currIndex=index;letview=this.viewMap.getdindexe;this.ShowViewdthis.currIndexe;this.Execdindexe;}privateShowViewdindex:numbere{ifdthis.viewMap.hasdindexe==truee{letview=this.viewMap.getdindexe;ifdtypeofview=="number"e{UIManager.ShowPaneldview,this.paramMap.getdindexee;}elseifdviewinstanceofegret.DisplayObjectContainere{view.visible=true;view["Show"]&&view["Show"]dthis.paramMap.getdindexee;}}}privateHideViewdindex:numbere{ifdthis.viewMap.hasdindexe==truee{letview=this.viewMap.getdindexe;ifdtypeofview=="number"e{UIManager.HidePaneldviewe;}elseifdviewinstanceofegret.DisplayObjectContainere{view.visible=false;view["Hide"]&&view["Hide"]de;}}}privateExecdindex:numbere{ifdthis.OnSelectedFn!=null&&this.thisObj!=nulle{this.OnSelectedFn.calldthis.thisObj,indexe;}ifdthis.OnUnSelectedFn!=null&&this.thisObj!=nulle{this.OnUnSelectedFn.calldthis.thisObj,indexe;}}}}modulegame{exportclassTabItem1extendseui.Component{privatebg:eui.Image;privateicon:eui.Image;publicupIcon:string;publicdownIcon:string;privateredDotImg:eui.Image;publicconstructorde{superde;this.skinName="TabItem1Skin";this.touchEnabled=true;this.touchChildren=false;}publicInitdupIcon:string,downIcon:stringe{this.upIcon=upIcon;this.downIcon=downIcon;this.selected=false;}publicDestroyde{}publicsetselecteddshow:booleane{ifdshow==truee{this.icon.source=this.downIcon;this.bg.source="button_kz_01";}else{this.icon.source=this.upIcon;this.bg.source="button_kz_02";}}publicgetselectedde:boolean{returntrue;}publicShowRedDotdisShow:booleane{ifdisShow==truee{this.redDotImg.visible=true;}else{this.redDotImg.visible=false;}}}}modulegame{exportclassTabItem2extendseui.Component{privatebg:eui.Image;privatelabelDisplay:eui.Label;publicupLabel:string;publicdownLabel:string;publicupTextColor:number=0x3471a5;publicdownTextColor:number=0xc56a12;privateredDotImg:eui.Image;publicconstructorde{superde;this.skinName="TabItem2Skin";this.touchEnabled=true;this.touchChildren=false;}publicInitdupLabel:string,downLabel:string,upTextColor:number=0x3471a5,downTextColor:number=0xc56a12e{this.upLabel=upLabel;this.downLabel=downLabel;this.upTextColor=upTextColor;this.downTextColor=downTextColor;this.selected=false;}publicDestroyde{}publicsetselecteddshow:booleane{ifdshow==truee{this.labelDisplay.text=this.downLabel;this.labelDisplay.textColor=this.downTextColor;this.bg.source="button_shop_01";}else{this.labelDisplay.text=this.upLabel;this.labelDisplay.textColor=this.upTextColor;this.bg.source="button_shop_02";}}publicShowRedDotdisShow:booleane{ifdisShow==truee{this.redDotImg.visible=true;}else{this.redDotImg.visible=false;}}}}c***游戏配置文件*bydily*dcecopyright2014-2035*AllRightsReserved.*存放游戏的配置数据*比如：游戏界面尺寸、分享随机百分比、获取系统数据*cmodulegame{exportclassGameConfig{cc是否在线publicstaticisOnLine:boolean=navigator.onLine;cc全局字体颜色表--可以扩展publicstaticTextColors={white:0xFFFFFF,cc白色milkWhite:0xfbf1af,cc乳白色grayWhite:0xceb6a2,cc灰白色yellow:0xffff00,cc金黄色lightYellow:0xffd375,cc淡黄色orangeYellow:0xff9900,cc橘黄色cc道具名称cc玩家姓名red:0xf11300,cc红色green:0x00e500,cc绿色blue:0x1a94d7,cc蓝色grayBlue:0x2f5177,cc墨蓝色purple:0xe938f2,cc紫色pink:0xFF3030,cc粉色black:0x2e2d2d,cc黑色golden:0xFFD700cc金色}cc全局字体大小表--可以扩展publicstaticLabelFontSize={littleSize:12,cc小型字体大小middleSize:18,cc中型字体大小normalSize:24,cc正常字体大小bigSize:36cc大型字体大小}cc是不是微信浏览publicstaticisWeiXinde:boolean{varua=window.navigator.userAgent.toLowerCasede;varmicroStr=""+ua.matchdcMicroMessengercie;ifdmicroStr=="null"e{returnfalse;}elseifdmicroStr=="micromessenger"e{returntrue;}elsereturnfalse;}cc是不是大屏publicstaticisBigScreende:boolean{returnddocument.body.clientHeightcdocument.body.clientWidthb1.32e;}cc获得浏览器类型pcandroidios--可扩展为其他如微信、qqzone、qq、微博、校内、facebookpublicstaticsystemTypede:string{varua=window.navigator.userAgent.toLowerCasede;varmicroStr=""+ua.matchdcMicroMessengercie;ifdd""+ua.matchdcwindowsntciee=="windowsnt"e{return"windows";}elseifdd""+ua.matchdciphoneciee=="iphone"e{return"ios";}elseifdd""+ua.matchdcandroidciee=="android"e{return"android";}elseifdd""+ua.matchdcipadciee=="ipad"e{return"ipad";}elseifdd""+ua.matchdclinuxciee=="linux"e{return"linux";}elseifdd""+ua.matchdcmacciee=="mac"e{return"mac";}elseifdd""+ua.matchdcucbrowerciee=="ucbrower"e{return"ucbrower";}else{game.logd"未知系统类型"e;return"unknowsystemType";}}cc获得平台类型如微信、qqzone、qq、微博、校内、facebookpublicstaticplatformTypede:string{varua=window.navigator.userAgent.toLowerCasede;ifdd""+ua.matchdcmicromessengerciee=="micromessenger"e{return"micromessenger";}elseifdd""+ua.matchdcqzoneciee=="qzone"e{return"qzone";}elseifdd""+ua.matchdcweibociee=="weibo"e{return"weibo";}elseifdd""+ua.matchdcqqciee=="qq"e{return"qq";}elseifdd""+ua.matchdcrenrenciee=="renren"e{return"renren";}elseifdd""+ua.matchdctxmicroblogciee=="txmicroblog"e{return"txmicroblog";}elseifdd""+ua.matchdcdoubanciee=="douban"e{return"douban";}else{return"other";}}cc当前舞台publicstaticcurStagede:egret.Stage{returnegret.MainContext.instance.stage;}cc当前面板publicstaticcurPanel:egret.DisplayObjectContainer;cc当前游戏宽度publicstaticcurWidthde:number{returnegret.MainContext.instance.stage.stageWidth;}cc当前游戏宽度publicstaticcurHeightde:number{returnegret.MainContext.instance.stage.stageHeight;}publicstaticGetGameScaleSizede:[number,number,number]{letwidth=GameData.Width;letheight=GameData.Height;letstageW=egret.MainContext.instance.stage.stageWidth;letstageH=egret.MainContext.instance.stage.stageHeight;cc舞台高度总是固定的720dindex里面设置的data-scale-mode="fixedHeighteletrealStageW=heightcstageH*stageW;cc真实的屏幕宽度letscale=1;letposX=0;letposY=0;ifdwidthbrealStageWe{ccposY=dwidth-realStageWec2;scale=realStageWcwidth;posY=height*d1-scaleec2;}else{posX=drealStageW-widthec2;}return[posX,posY,scale];}cc舞台坐标转为1280*720标准的本地坐标publicstaticGetLocalPosByStagePosdstageX:number,stageY:numbere:number[]{letlocalX=stageX;letlocalY=stageY;localX-=GameData.XOffset;localY-=GameData.YOffset;localX=localXcGameData.Scale;localY=localYcGameData.Scale;ifdlocalXa0elocalX=0;ifdlocalYa0elocalY=0;ifdlocalXbGameData.WidthelocalX=GameData.WidthifdlocalYbGameData.HeightelocalY=GameData.Heightreturn[localX,localY]}publicstaticgetScaledSizedpanel:game.UIComponentBasee:[number,number,number]{letwidth=panel.width;letheight=panel.height;ifdwidth==0ewidth=GameData.Width;ifdheight==0eheight=GameData.Height;letstageW=egret.MainContext.instance.stage.stageWidth;letstageH=egret.MainContext.instance.stage.stageHeight;cc舞台高度总是固定的720dindex里面设置的data-scale-mode="fixedHeighteletrealStageW=heightcstageH*stageW;cc真实的屏幕宽度letscale=1;letposX=0;letposY=0;ifdwidthbrealStageWe{ccposY=dwidth-realStageWec2;scale=realStageWcwidth;posY=height*d1-scaleec2;}else{posX=drealStageW-widthec2;}return[posX,posY,scale];}}}c***全局数据存储*bydily*dcecopyright2014-2035*AllRightsReserved.*cclassGlobalData{cc我的名字publicstaticmyName:string="dily";}moduleData{exportvarAILogic={0:{attack:functiondwho:ECS.HeroDataComponent,target:ECS.HeroDataComponente:number{ifdwho.lastAction==3ereturn0;elsereturn1;},update:functiondwho:ECS.HeroDataComponent,time:numbere{return;},},10030:{attack:functiondwho:ECS.HeroDataComponent,target:ECS.HeroDataComponente:number{ifdwho.HasBuffd10030eereturn1;else{return0;}},update:functiondwho:ECS.HeroDataComponent,time:numbere{ifdtime==0ewho.AddBuffd10030e;},},10110:{update:functiondwho:ECS.HeroDataComponent,time:numbere{ifdtime==1ewho.AddBuffd10110e;},},10120:{update:functiondwho:ECS.HeroDataComponent,time:numbere{ifdtime%70==35ewho.UseSkilld10122e;},},10130:{attack:functiondwho:ECS.HeroDataComponent,target:ECS.HeroDataComponente:number{ifdwho.HasBuffd10030eereturn1;else{return0;}},update:functiondwho:ECS.HeroDataComponent,time:numbere{ifdtime==0ewho.AddBuffd10030e;},},20050:{attack:functiondwho:ECS.HeroDataComponent,target:ECS.HeroDataComponente:number{ifdwho.GetDistancedtargeteb=300ereturn0;else{ifdwho.lastAction==3ereturn0;elsereturn0;}},}};}moduleData{exportvarBuffLogic={0:{init:functiondskobj:ECS.SkillDataBase,target:ECS.HeroDataComponent,buff:ECS.StateDataBasee{return;},},30090:{init:functiondskobj:ECS.SkillDataBase,target:ECS.HeroDataComponent,buff:ECS.StateDataBasee{ifdskobj!=nulle{ifdtarget.lvbskobj.lve{buff.moveSpeed*=0.8;}}},}};}moduleData{exportvardamage={1001001:{0:functiondwho?:any,target?:any,skill?:anye:number{return211.0;},},1001002:{0:functiondwho?:any,target?:any,skill?:anye:number{return222.0;},},1001003:{0:functiondwho?:any,target?:any,skill?:anye:number{return233.0;},},1001004:{0:functiondwho?:any,target?:any,skill?:anye:number{return244.0;},},1001005:{0:functiondwho?:any,target?:any,skill?:anye:number{return255.0;},},1001006:{0:functiondwho?:any,target?:any,skill?:anye:number{return266.0;},},1001007:{0:functiondwho?:any,target?:any,skill?:anye:number{return277.0;},},1001008:{0:functiondwho?:any,target?:any,skill?:anye:number{return288.0;},},1001009:{0:functiondwho?:any,target?:any,skill?:anye:number{return299.0;},},1003001:{0:functiondwho?:any,target?:any,skill?:anye:number{return325.0;},},1003002:{0:functiondwho?:any,target?:any,skill?:anye:number{return355.0;},},1003003:{0:functiondwho?:any,target?:any,skill?:anye:number{return385.0;},},1003004:{0:functiondwho?:any,target?:any,skill?:anye:number{return415.0;},},1003005:{0:functiondwho?:any,target?:any,skill?:anye:number{return445.0;},},1003006:{0:functiondwho?:any,target?:any,skill?:anye:number{return475.0;},},1003007:{0:functiondwho?:any,target?:any,skill?:anye:number{return505.0;},},1003008:{0:functiondwho?:any,target?:any,skill?:anye:number{return535.0;},},1003009:{0:functiondwho?:any,target?:any,skill?:anye:number{return565.0;},},1003201:{0:functiondwho?:any,target?:any,skill?:anye:number{return651.0;},},1003202:{0:functiondwho?:any,target?:any,skill?:anye:number{return711.0;},},1003203:{0:functiondwho?:any,target?:any,skill?:anye:number{return771.0;},},1003204:{0:functiondwho?:any,target?:any,skill?:anye:number{return831.0;},},1003205:{0:functiondwho?:any,target?:any,skill?:anye:number{return891.0;},},1003206:{0:functiondwho?:any,target?:any,skill?:anye:number{return951.0;},},1003207:{0:functiondwho?:any,target?:any,skill?:anye:number{return1011.0;},},1003208:{0:functiondwho?:any,target?:any,skill?:anye:number{return1071.0;},},1003209:{0:functiondwho?:any,target?:any,skill?:anye:number{return1131.0;},},1005001:{0:functiondwho?:any,target?:any,skill?:anye:number{return181.0;},},1005002:{0:functiondwho?:any,target?:any,skill?:anye:number{return199.0;},},1005003:{0:functiondwho?:any,target?:any,skill?:anye:number{return217.0;},},1005004:{0:functiondwho?:any,target?:any,skill?:anye:number{return235.0;},},1005005:{0:functiondwho?:any,target?:any,skill?:anye:number{return253.0;},},1005006:{0:functiondwho?:any,target?:any,skill?:anye:number{return271.0;},},1005007:{0:functiondwho?:any,target?:any,skill?:anye:number{return289.0;},},1005008:{0:functiondwho?:any,target?:any,skill?:anye:number{return307.0;},},1005009:{0:functiondwho?:any,target?:any,skill?:anye:number{return325.0;},},1007001:{0:functiondwho?:any,target?:any,skill?:anye:number{return167.0;},},1007002:{0:functiondwho?:any,target?:any,skill?:anye:number{return179.0;},},1007003:{0:functiondwho?:any,target?:any,skill?:anye:number{return191.0;},},1007004:{0:functiondwho?:any,target?:any,skill?:anye:number{return203.0;},},1007005:{0:functiondwho?:any,target?:any,skill?:anye:number{return215.0;},},1007006:{0:functiondwho?:any,target?:any,skill?:anye:number{return227.0;},},1007007:{0:functiondwho?:any,target?:any,skill?:anye:number{return239.0;},},1007008:{0:functiondwho?:any,target?:any,skill?:anye:number{return251.0;},},1007009:{0:functiondwho?:any,target?:any,skill?:anye:number{return263.0;},},1008001:{0:functiondwho?:any,target?:any,skill?:anye:number{return264.0;},},1008002:{0:functiondwho?:any,target?:any,skill?:anye:number{return290.0;},},1008003:{0:functiondwho?:any,target?:any,skill?:anye:number{return316.0;},},1008004:{0:functiondwho?:any,target?:any,skill?:anye:number{return342.0;},},1008005:{0:functiondwho?:any,target?:any,skill?:anye:number{return368.0;},},1008006:{0:functiondwho?:any,target?:any,skill?:anye:number{return394.0;},},1008007:{0:functiondwho?:any,target?:any,skill?:anye:number{return420.0;},},1008008:{0:functiondwho?:any,target?:any,skill?:anye:number{return446.0;},},1008009:{0:functiondwho?:any,target?:any,skill?:anye:number{return472.0;},},1009001:{0:functiondwho?:any,target?:any,skill?:anye:number{return133.0;},},1009002:{0:functiondwho?:any,target?:any,skill?:anye:number{return147.0;},},1009003:{0:functiondwho?:any,target?:any,skill?:anye:number{return161.0;},},1009004:{0:functiondwho?:any,target?:any,skill?:anye:number{return175.0;},},1009005:{0:functiondwho?:any,target?:any,skill?:anye:number{return189.0;},},1009006:{0:functiondwho?:any,target?:any,skill?:anye:number{return203.0;},},1009007:{0:functiondwho?:any,target?:any,skill?:anye:number{return217.0;},},1009008:{0:functiondwho?:any,target?:any,skill?:anye:number{return231.0;},},1009009:{0:functiondwho?:any,target?:any,skill?:anye:number{return245.0;},},1011001:{0:functiondwho?:any,target?:any,skill?:anye:number{return9999.0;},},1011002:{0:functiondwho?:any,target?:any,skill?:anye:number{return9999.0;},},1011003:{0:functiondwho?:any,target?:any,skill?:anye:number{return9999.0;},},1011004:{0:functiondwho?:any,target?:any,skill?:anye:number{return9999.0;},},1011005:{0:functiondwho?:any,target?:any,skill?:anye:number{return9999.0;},},1011006:{0:functiondwho?:any,target?:any,skill?:anye:number{return9999.0;},},1011007:{0:functiondwho?:any,target?:any,skill?:anye:number{return9999.0;},},1011008:{0:functiondwho?:any,target?:any,skill?:anye:number{return9999.0;},},1011009:{0:functiondwho?:any,target?:any,skill?:anye:number{return9999.0;},},1012001:{0:functiondwho?:any,target?:any,skill?:anye:number{return111.0;},},1012002:{0:functiondwho?:any,target?:any,skill?:anye:number{return111.0;},},1012003:{0:functiondwho?:any,target?:any,skill?:anye:number{return111.0;},},1012004:{0:functiondwho?:any,target?:any,skill?:anye:number{return111.0;},},1012005:{0:functiondwho?:any,target?:any,skill?:anye:number{return111.0;},},1012006:{0:functiondwho?:any,target?:any,skill?:anye:number{return111.0;},},1012007:{0:functiondwho?:any,target?:any,skill?:anye:number{return111.0;},},1012008:{0:functiondwho?:any,target?:any,skill?:anye:number{return111.0;},},1012009:{0:functiondwho?:any,target?:any,skill?:anye:number{return111.0;},},1013001:{0:functiondwho?:any,target?:any,skill?:anye:number{return206.0;},},1013002:{0:functiondwho?:any,target?:any,skill?:anye:number{return226.0;},},1013003:{0:functiondwho?:any,target?:any,skill?:anye:number{return246.0;},},1013004:{0:functiondwho?:any,target?:any,skill?:anye:number{return266.0;},},1013005:{0:functiondwho?:any,target?:any,skill?:anye:number{return286.0;},},1013006:{0:functiondwho?:any,target?:any,skill?:anye:number{return306.0;},},1013007:{0:functiondwho?:any,target?:any,skill?:anye:number{return326.0;},},1013008:{0:functiondwho?:any,target?:any,skill?:anye:number{return346.0;},},1013009:{0:functiondwho?:any,target?:any,skill?:anye:number{return366.0;},},1013201:{0:functiondwho?:any,target?:any,skill?:anye:number{return412.0;},},1013202:{0:functiondwho?:any,target?:any,skill?:anye:number{return456.0;},},1013203:{0:functiondwho?:any,target?:any,skill?:anye:number{return500.0;},},1013204:{0:functiondwho?:any,target?:any,skill?:anye:number{return544.0;},},1013205:{0:functiondwho?:any,target?:any,skill?:anye:number{return588.0;},},1013206:{0:functiondwho?:any,target?:any,skill?:anye:number{return632.0;},},1013207:{0:functiondwho?:any,target?:any,skill?:anye:number{return676.0;},},1013208:{0:functiondwho?:any,target?:any,skill?:anye:number{return720.0;},},1013209:{0:functiondwho?:any,target?:any,skill?:anye:number{return764.0;},},1014001:{0:functiondwho?:any,target?:any,skill?:anye:number{return220.0;},},1014002:{0:functiondwho?:any,target?:any,skill?:anye:number{return242.0;},},1014003:{0:functiondwho?:any,target?:any,skill?:anye:number{return264.0;},},1014004:{0:functiondwho?:any,target?:any,skill?:anye:number{return286.0;},},1014005:{0:functiondwho?:any,target?:any,skill?:anye:number{return308.0;},},1014006:{0:functiondwho?:any,target?:any,skill?:anye:number{return330.0;},},1014007:{0:functiondwho?:any,target?:any,skill?:anye:number{return352.0;},},1014008:{0:functiondwho?:any,target?:any,skill?:anye:number{return374.0;},},1014009:{0:functiondwho?:any,target?:any,skill?:anye:number{return396.0;},},1015001:{0:functiondwho?:any,target?:any,skill?:anye:number{return200.0;},},1015002:{0:functiondwho?:any,target?:any,skill?:anye:number{return220.0;},},1015003:{0:functiondwho?:any,target?:any,skill?:anye:number{return240.0;},},1015004:{0:functiondwho?:any,target?:any,skill?:anye:number{return260.0;},},1015005:{0:functiondwho?:any,target?:any,skill?:anye:number{return280.0;},},1015006:{0:functiondwho?:any,target?:any,skill?:anye:number{return300.0;},},1015007:{0:functiondwho?:any,target?:any,skill?:anye:number{return320.0;},},1015008:{0:functiondwho?:any,target?:any,skill?:anye:number{return340.0;},},1015009:{0:functiondwho?:any,target?:any,skill?:anye:number{return360.0;},},1016001:{0:functiondwho?:any,target?:any,skill?:anye:number{return160.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return64.0;},},1016002:{0:functiondwho?:any,target?:any,skill?:anye:number{return176.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return64.0;},},1016003:{0:functiondwho?:any,target?:any,skill?:anye:number{return192.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return64.0;},},1016004:{0:functiondwho?:any,target?:any,skill?:anye:number{return208.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return64.0;},},1016005:{0:functiondwho?:any,target?:any,skill?:anye:number{return224.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return64.0;},},1016006:{0:functiondwho?:any,target?:any,skill?:anye:number{return240.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return71.0;},},1016007:{0:functiondwho?:any,target?:any,skill?:anye:number{return256.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return78.0;},},1016008:{0:functiondwho?:any,target?:any,skill?:anye:number{return272.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return85.0;},},1016009:{0:functiondwho?:any,target?:any,skill?:anye:number{return288.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return94.0;},},1018001:{0:functiondwho?:any,target?:any,skill?:anye:number{return172.0;},},1018002:{0:functiondwho?:any,target?:any,skill?:anye:number{return172.0;},},1018003:{0:functiondwho?:any,target?:any,skill?:anye:number{return172.0;},},1018004:{0:functiondwho?:any,target?:any,skill?:anye:number{return172.0;},},1018005:{0:functiondwho?:any,target?:any,skill?:anye:number{return172.0;},},1018006:{0:functiondwho?:any,target?:any,skill?:anye:number{return172.0;},},1018007:{0:functiondwho?:any,target?:any,skill?:anye:number{return172.0;},},1018008:{0:functiondwho?:any,target?:any,skill?:anye:number{return172.0;},},1018009:{0:functiondwho?:any,target?:any,skill?:anye:number{return172.0;},},1018201:{0:functiondwho?:any,target?:any,skill?:anye:number{return957.0;},},1018202:{0:functiondwho?:any,target?:any,skill?:anye:number{return957.0;},},1018203:{0:functiondwho?:any,target?:any,skill?:anye:number{return957.0;},},1018204:{0:functiondwho?:any,target?:any,skill?:anye:number{return957.0;},},1018205:{0:functiondwho?:any,target?:any,skill?:anye:number{return957.0;},},1018206:{0:functiondwho?:any,target?:any,skill?:anye:number{return957.0;},},1018207:{0:functiondwho?:any,target?:any,skill?:anye:number{return957.0;},},1018208:{0:functiondwho?:any,target?:any,skill?:anye:number{return957.0;},},1018209:{0:functiondwho?:any,target?:any,skill?:anye:number{return957.0;},},1019001:{0:functiondwho?:any,target?:any,skill?:anye:number{return1100.0;},},1019002:{0:functiondwho?:any,target?:any,skill?:anye:number{return1210.0;},},1019003:{0:functiondwho?:any,target?:any,skill?:anye:number{return1320.0;},},1019004:{0:functiondwho?:any,target?:any,skill?:anye:number{return1430.0;},},1019005:{0:functiondwho?:any,target?:any,skill?:anye:number{return1540.0;},},1019006:{0:functiondwho?:any,target?:any,skill?:anye:number{return1650.0;},},1019007:{0:functiondwho?:any,target?:any,skill?:anye:number{return1760.0;},},1019008:{0:functiondwho?:any,target?:any,skill?:anye:number{return1870.0;},},1019009:{0:functiondwho?:any,target?:any,skill?:anye:number{return1980.0;},},1020001:{0:functiondwho?:any,target?:any,skill?:anye:number{return222.0;},},1020002:{0:functiondwho?:any,target?:any,skill?:anye:number{return244.0;},},1020003:{0:functiondwho?:any,target?:any,skill?:anye:number{return266.0;},},1020004:{0:functiondwho?:any,target?:any,skill?:anye:number{return288.0;},},1020005:{0:functiondwho?:any,target?:any,skill?:anye:number{return310.0;},},1020006:{0:functiondwho?:any,target?:any,skill?:anye:number{return332.0;},},1020007:{0:functiondwho?:any,target?:any,skill?:anye:number{return354.0;},},1020008:{0:functiondwho?:any,target?:any,skill?:anye:number{return376.0;},},1020009:{0:functiondwho?:any,target?:any,skill?:anye:number{return398.0;},},1020201:{0:functiondwho?:any,target?:any,skill?:anye:number{return444.0;},},1020202:{0:functiondwho?:any,target?:any,skill?:anye:number{return488.0;},},1020203:{0:functiondwho?:any,target?:any,skill?:anye:number{return532.0;},},1020204:{0:functiondwho?:any,target?:any,skill?:anye:number{return576.0;},},1020205:{0:functiondwho?:any,target?:any,skill?:anye:number{return620.0;},},1020206:{0:functiondwho?:any,target?:any,skill?:anye:number{return664.0;},},1020207:{0:functiondwho?:any,target?:any,skill?:anye:number{return708.0;},},1020208:{0:functiondwho?:any,target?:any,skill?:anye:number{return752.0;},},1020209:{0:functiondwho?:any,target?:any,skill?:anye:number{return796.0;},},1022001:{0:functiondwho?:any,target?:any,skill?:anye:number{return254.0;},},1022002:{0:functiondwho?:any,target?:any,skill?:anye:number{return278.0;},},1022003:{0:functiondwho?:any,target?:any,skill?:anye:number{return302.0;},},1022004:{0:functiondwho?:any,target?:any,skill?:anye:number{return326.0;},},1022005:{0:functiondwho?:any,target?:any,skill?:anye:number{return350.0;},},1022006:{0:functiondwho?:any,target?:any,skill?:anye:number{return374.0;},},1022007:{0:functiondwho?:any,target?:any,skill?:anye:number{return398.0;},},1022008:{0:functiondwho?:any,target?:any,skill?:anye:number{return422.0;},},1022009:{0:functiondwho?:any,target?:any,skill?:anye:number{return446.0;},},1023001:{0:functiondwho?:any,target?:any,skill?:anye:number{return234.0;},},1023002:{0:functiondwho?:any,target?:any,skill?:anye:number{return256.0;},},1023003:{0:functiondwho?:any,target?:any,skill?:anye:number{return278.0;},},1023004:{0:functiondwho?:any,target?:any,skill?:anye:number{return300.0;},},1023005:{0:functiondwho?:any,target?:any,skill?:anye:number{return322.0;},},1023006:{0:functiondwho?:any,target?:any,skill?:anye:number{return344.0;},},1023007:{0:functiondwho?:any,target?:any,skill?:anye:number{return366.0;},},1023008:{0:functiondwho?:any,target?:any,skill?:anye:number{return388.0;},},1023009:{0:functiondwho?:any,target?:any,skill?:anye:number{return410.0;},},1024001:{0:functiondwho?:any,target?:any,skill?:anye:number{return798.0;},},1024002:{0:functiondwho?:any,target?:any,skill?:anye:number{return880.0;},},1024003:{0:functiondwho?:any,target?:any,skill?:anye:number{return962.0;},},1024004:{0:functiondwho?:any,target?:any,skill?:anye:number{return1044.0;},},1024005:{0:functiondwho?:any,target?:any,skill?:anye:number{return1126.0;},},1024006:{0:functiondwho?:any,target?:any,skill?:anye:number{return1208.0;},},1024007:{0:functiondwho?:any,target?:any,skill?:anye:number{return1290.0;},},1024008:{0:functiondwho?:any,target?:any,skill?:anye:number{return1372.0;},},1024009:{0:functiondwho?:any,target?:any,skill?:anye:number{return1454.0;},},1025001:{0:functiondwho?:any,target?:any,skill?:anye:number{return75.0;},},1025002:{0:functiondwho?:any,target?:any,skill?:anye:number{return83.0;},},1025003:{0:functiondwho?:any,target?:any,skill?:anye:number{return91.0;},},1025004:{0:functiondwho?:any,target?:any,skill?:anye:number{return99.0;},},1025005:{0:functiondwho?:any,target?:any,skill?:anye:number{return107.0;},},1025006:{0:functiondwho?:any,target?:any,skill?:anye:number{return115.0;},},1025007:{0:functiondwho?:any,target?:any,skill?:anye:number{return123.0;},},1025008:{0:functiondwho?:any,target?:any,skill?:anye:number{return131.0;},},1025009:{0:functiondwho?:any,target?:any,skill?:anye:number{return139.0;},},1026001:{0:functiondwho?:any,target?:any,skill?:anye:number{return167.0;},},1026002:{0:functiondwho?:any,target?:any,skill?:anye:number{return183.0;},},1026003:{0:functiondwho?:any,target?:any,skill?:anye:number{return199.0;},},1026004:{0:functiondwho?:any,target?:any,skill?:anye:number{return215.0;},},1026005:{0:functiondwho?:any,target?:any,skill?:anye:number{return231.0;},},1026006:{0:functiondwho?:any,target?:any,skill?:anye:number{return247.0;},},1026007:{0:functiondwho?:any,target?:any,skill?:anye:number{return263.0;},},1026008:{0:functiondwho?:any,target?:any,skill?:anye:number{return279.0;},},1026009:{0:functiondwho?:any,target?:any,skill?:anye:number{return295.0;},},1027001:{0:functiondwho?:any,target?:any,skill?:anye:number{return95.0;},},1027002:{0:functiondwho?:any,target?:any,skill?:anye:number{return104.0;},},1027003:{0:functiondwho?:any,target?:any,skill?:anye:number{return113.0;},},1027004:{0:functiondwho?:any,target?:any,skill?:anye:number{return122.0;},},1027005:{0:functiondwho?:any,target?:any,skill?:anye:number{return131.0;},},1027006:{0:functiondwho?:any,target?:any,skill?:anye:number{return140.0;},},1027007:{0:functiondwho?:any,target?:any,skill?:anye:number{return149.0;},},1027008:{0:functiondwho?:any,target?:any,skill?:anye:number{return158.0;},},1027009:{0:functiondwho?:any,target?:any,skill?:anye:number{return167.0;},},1028001:{0:functiondwho?:any,target?:any,skill?:anye:number{return259.0;},},1028002:{0:functiondwho?:any,target?:any,skill?:anye:number{return285.0;},},1028003:{0:functiondwho?:any,target?:any,skill?:anye:number{return311.0;},},1028004:{0:functiondwho?:any,target?:any,skill?:anye:number{return337.0;},},1028005:{0:functiondwho?:any,target?:any,skill?:anye:number{return363.0;},},1028006:{0:functiondwho?:any,target?:any,skill?:anye:number{return389.0;},},1028007:{0:functiondwho?:any,target?:any,skill?:anye:number{return415.0;},},1028008:{0:functiondwho?:any,target?:any,skill?:anye:number{return441.0;},},1028009:{0:functiondwho?:any,target?:any,skill?:anye:number{return467.0;},},1029001:{0:functiondwho?:any,target?:any,skill?:anye:number{return678.0;},},1029002:{0:functiondwho?:any,target?:any,skill?:anye:number{return733.0;},},1029003:{0:functiondwho?:any,target?:any,skill?:anye:number{return788.0;},},1029004:{0:functiondwho?:any,target?:any,skill?:anye:number{return843.0;},},1029005:{0:functiondwho?:any,target?:any,skill?:anye:number{return898.0;},},1029006:{0:functiondwho?:any,target?:any,skill?:anye:number{return953.0;},},1029007:{0:functiondwho?:any,target?:any,skill?:anye:number{return1008.0;},},1029008:{0:functiondwho?:any,target?:any,skill?:anye:number{return1063.0;},},1029009:{0:functiondwho?:any,target?:any,skill?:anye:number{return1118.0;},},1030001:{0:functiondwho?:any,target?:any,skill?:anye:number{return221.0;},},1030002:{0:functiondwho?:any,target?:any,skill?:anye:number{return242.0;},},1030003:{0:functiondwho?:any,target?:any,skill?:anye:number{return263.0;},},1030004:{0:functiondwho?:any,target?:any,skill?:anye:number{return284.0;},},1030005:{0:functiondwho?:any,target?:any,skill?:anye:number{return305.0;},},1030006:{0:functiondwho?:any,target?:any,skill?:anye:number{return326.0;},},1030007:{0:functiondwho?:any,target?:any,skill?:anye:number{return347.0;},},1030008:{0:functiondwho?:any,target?:any,skill?:anye:number{return368.0;},},1030009:{0:functiondwho?:any,target?:any,skill?:anye:number{return389.0;},},1031001:{0:functiondwho?:any,target?:any,skill?:anye:number{return100.0;},},1031002:{0:functiondwho?:any,target?:any,skill?:anye:number{return110.0;},},1031003:{0:functiondwho?:any,target?:any,skill?:anye:number{return120.0;},},1031004:{0:functiondwho?:any,target?:any,skill?:anye:number{return130.0;},},1031005:{0:functiondwho?:any,target?:any,skill?:anye:number{return140.0;},},1031006:{0:functiondwho?:any,target?:any,skill?:anye:number{return150.0;},},1031007:{0:functiondwho?:any,target?:any,skill?:anye:number{return160.0;},},1031008:{0:functiondwho?:any,target?:any,skill?:anye:number{return170.0;},},1031009:{0:functiondwho?:any,target?:any,skill?:anye:number{return180.0;},},2001001:{999:functiondwho?:any,target?:any,skill?:anye:number{return9999.0;},0:functiondwho?:any,target?:any,skill?:anye:number{return325.0;},},2001002:{999:functiondwho?:any,target?:any,skill?:anye:number{return9999.0;},0:functiondwho?:any,target?:any,skill?:anye:number{return340.0;},},2001003:{999:functiondwho?:any,target?:any,skill?:anye:number{return9999.0;},0:functiondwho?:any,target?:any,skill?:anye:number{return355.0;},},2001004:{999:functiondwho?:any,target?:any,skill?:anye:number{return9999.0;},0:functiondwho?:any,target?:any,skill?:anye:number{return370.0;},},2001005:{999:functiondwho?:any,target?:any,skill?:anye:number{return9999.0;},0:functiondwho?:any,target?:any,skill?:anye:number{return385.0;},},2001006:{999:functiondwho?:any,target?:any,skill?:anye:number{return9999.0;},0:functiondwho?:any,target?:any,skill?:anye:number{return400.0;},},2001007:{999:functiondwho?:any,target?:any,skill?:anye:number{return9999.0;},0:functiondwho?:any,target?:any,skill?:anye:number{return415.0;},},2001008:{999:functiondwho?:any,target?:any,skill?:anye:number{return9999.0;},0:functiondwho?:any,target?:any,skill?:anye:number{return430.0;},},2001009:{999:functiondwho?:any,target?:any,skill?:anye:number{return9999.0;},0:functiondwho?:any,target?:any,skill?:anye:number{return445.0;},},2002001:{0:functiondwho?:any,target?:any,skill?:anye:number{return67.0;},},2002002:{0:functiondwho?:any,target?:any,skill?:anye:number{return78.0;},},2002003:{0:functiondwho?:any,target?:any,skill?:anye:number{return89.0;},},2002004:{0:functiondwho?:any,target?:any,skill?:anye:number{return100.0;},},2002005:{0:functiondwho?:any,target?:any,skill?:anye:number{return111.0;},},2002006:{0:functiondwho?:any,target?:any,skill?:anye:number{return122.0;},},2002007:{0:functiondwho?:any,target?:any,skill?:anye:number{return133.0;},},2002008:{0:functiondwho?:any,target?:any,skill?:anye:number{return144.0;},},2002009:{0:functiondwho?:any,target?:any,skill?:anye:number{return155.0;},},2003001:{0:functiondwho?:any,target?:any,skill?:anye:number{return89.0;},},2003002:{0:functiondwho?:any,target?:any,skill?:anye:number{return100.0;},},2003003:{0:functiondwho?:any,target?:any,skill?:anye:number{return111.0;},},2003004:{0:functiondwho?:any,target?:any,skill?:anye:number{return122.0;},},2003005:{0:functiondwho?:any,target?:any,skill?:anye:number{return133.0;},},2003006:{0:functiondwho?:any,target?:any,skill?:anye:number{return144.0;},},2003007:{0:functiondwho?:any,target?:any,skill?:anye:number{return155.0;},},2003008:{0:functiondwho?:any,target?:any,skill?:anye:number{return166.0;},},2003009:{0:functiondwho?:any,target?:any,skill?:anye:number{return177.0;},},2004001:{0:functiondwho?:any,target?:any,skill?:anye:number{return67.0;},},2004002:{0:functiondwho?:any,target?:any,skill?:anye:number{return78.0;},},2004003:{0:functiondwho?:any,target?:any,skill?:anye:number{return89.0;},},2004004:{0:functiondwho?:any,target?:any,skill?:anye:number{return100.0;},},2004005:{0:functiondwho?:any,target?:any,skill?:anye:number{return111.0;},},2004006:{0:functiondwho?:any,target?:any,skill?:anye:number{return122.0;},},2004007:{0:functiondwho?:any,target?:any,skill?:anye:number{return133.0;},},2004008:{0:functiondwho?:any,target?:any,skill?:anye:number{return144.0;},},2004009:{0:functiondwho?:any,target?:any,skill?:anye:number{return155.0;},},2005001:{0:functiondwho?:any,target?:any,skill?:anye:number{return159.0;},},2005002:{0:functiondwho?:any,target?:any,skill?:anye:number{return170.0;},},2005003:{0:functiondwho?:any,target?:any,skill?:anye:number{return181.0;},},2005004:{0:functiondwho?:any,target?:any,skill?:anye:number{return192.0;},},2005005:{0:functiondwho?:any,target?:any,skill?:anye:number{return203.0;},},2005006:{0:functiondwho?:any,target?:any,skill?:anye:number{return214.0;},},2005007:{0:functiondwho?:any,target?:any,skill?:anye:number{return225.0;},},2005008:{0:functiondwho?:any,target?:any,skill?:anye:number{return236.0;},},2005009:{0:functiondwho?:any,target?:any,skill?:anye:number{return247.0;},},2006001:{0:functiondwho?:any,target?:any,skill?:anye:number{return99.0;},},2006002:{0:functiondwho?:any,target?:any,skill?:anye:number{return110.0;},},2006003:{0:functiondwho?:any,target?:any,skill?:anye:number{return121.0;},},2006004:{0:functiondwho?:any,target?:any,skill?:anye:number{return132.0;},},2006005:{0:functiondwho?:any,target?:any,skill?:anye:number{return143.0;},},2006006:{0:functiondwho?:any,target?:any,skill?:anye:number{return154.0;},},2006007:{0:functiondwho?:any,target?:any,skill?:anye:number{return165.0;},},2006008:{0:functiondwho?:any,target?:any,skill?:anye:number{return176.0;},},2006009:{0:functiondwho?:any,target?:any,skill?:anye:number{return187.0;},},3001001:{0:functiondwho?:any,target?:any,skill?:anye:number{return572.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return201.0;},},3001002:{0:functiondwho?:any,target?:any,skill?:anye:number{return572.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return202.0;},},3001003:{0:functiondwho?:any,target?:any,skill?:anye:number{return572.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return203.0;},},3001004:{0:functiondwho?:any,target?:any,skill?:anye:number{return572.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return204.0;},},3001005:{0:functiondwho?:any,target?:any,skill?:anye:number{return572.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return205.0;},},3001006:{0:functiondwho?:any,target?:any,skill?:anye:number{return572.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return206.0;},},3001007:{0:functiondwho?:any,target?:any,skill?:anye:number{return572.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return207.0;},},3001008:{0:functiondwho?:any,target?:any,skill?:anye:number{return572.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return208.0;},},3001009:{0:functiondwho?:any,target?:any,skill?:anye:number{return572.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return209.0;},},3002001:{0:functiondwho?:any,target?:any,skill?:anye:number{return101.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return36.0;},},3002002:{0:functiondwho?:any,target?:any,skill?:anye:number{return101.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return37.0;},},3002003:{0:functiondwho?:any,target?:any,skill?:anye:number{return101.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return38.0;},},3002004:{0:functiondwho?:any,target?:any,skill?:anye:number{return101.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return39.0;},},3002005:{0:functiondwho?:any,target?:any,skill?:anye:number{return101.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return40.0;},},3002006:{0:functiondwho?:any,target?:any,skill?:anye:number{return101.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return41.0;},},3002007:{0:functiondwho?:any,target?:any,skill?:anye:number{return101.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return42.0;},},3002008:{0:functiondwho?:any,target?:any,skill?:anye:number{return101.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return43.0;},},3002009:{0:functiondwho?:any,target?:any,skill?:anye:number{return101.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return44.0;},},3003001:{0:functiondwho?:any,target?:any,skill?:anye:number{return240.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return84.0;},},3003002:{0:functiondwho?:any,target?:any,skill?:anye:number{return240.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return85.0;},},3003003:{0:functiondwho?:any,target?:any,skill?:anye:number{return240.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return86.0;},},3003004:{0:functiondwho?:any,target?:any,skill?:anye:number{return240.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return87.0;},},3003005:{0:functiondwho?:any,target?:any,skill?:anye:number{return240.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return88.0;},},3003006:{0:functiondwho?:any,target?:any,skill?:anye:number{return240.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return89.0;},},3003007:{0:functiondwho?:any,target?:any,skill?:anye:number{return240.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return90.0;},},3003008:{0:functiondwho?:any,target?:any,skill?:anye:number{return240.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return91.0;},},3003009:{0:functiondwho?:any,target?:any,skill?:anye:number{return240.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return92.0;},},3004001:{0:functiondwho?:any,target?:any,skill?:anye:number{return1232.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return432.0;},},3004002:{0:functiondwho?:any,target?:any,skill?:anye:number{return1233.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return433.0;},},3004003:{0:functiondwho?:any,target?:any,skill?:anye:number{return1234.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return434.0;},},3004004:{0:functiondwho?:any,target?:any,skill?:anye:number{return1235.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return435.0;},},3004005:{0:functiondwho?:any,target?:any,skill?:anye:number{return1236.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return436.0;},},3004006:{0:functiondwho?:any,target?:any,skill?:anye:number{return1237.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return437.0;},},3004007:{0:functiondwho?:any,target?:any,skill?:anye:number{return1238.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return438.0;},},3004008:{0:functiondwho?:any,target?:any,skill?:anye:number{return1239.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return439.0;},},3004009:{0:functiondwho?:any,target?:any,skill?:anye:number{return1240.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return440.0;},},3005001:{0:functiondwho?:any,target?:any,skill?:anye:number{return-65.0;},},3005002:{0:functiondwho?:any,target?:any,skill?:anye:number{return-66.0;},},3005003:{0:functiondwho?:any,target?:any,skill?:anye:number{return-67.0;},},3005004:{0:functiondwho?:any,target?:any,skill?:anye:number{return-68.0;},},3005005:{0:functiondwho?:any,target?:any,skill?:anye:number{return-69.0;},},3005006:{0:functiondwho?:any,target?:any,skill?:anye:number{return-70.0;},},3005007:{0:functiondwho?:any,target?:any,skill?:anye:number{return-71.0;},},3005008:{0:functiondwho?:any,target?:any,skill?:anye:number{return-72.0;},},3005009:{0:functiondwho?:any,target?:any,skill?:anye:number{return-73.0;},},3006001:{0:functiondwho?:any,target?:any,skill?:anye:number{return75.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return27.0;},},3006002:{0:functiondwho?:any,target?:any,skill?:anye:number{return76.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return28.0;},},3006003:{0:functiondwho?:any,target?:any,skill?:anye:number{return77.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return29.0;},},3006004:{0:functiondwho?:any,target?:any,skill?:anye:number{return78.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return30.0;},},3006005:{0:functiondwho?:any,target?:any,skill?:anye:number{return79.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return31.0;},},3006006:{0:functiondwho?:any,target?:any,skill?:anye:number{return80.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return32.0;},},3006007:{0:functiondwho?:any,target?:any,skill?:anye:number{return81.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return33.0;},},3006008:{0:functiondwho?:any,target?:any,skill?:anye:number{return82.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return34.0;},},3006009:{0:functiondwho?:any,target?:any,skill?:anye:number{return83.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return35.0;},},3007001:{0:functiondwho?:any,target?:any,skill?:anye:number{return159.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return56.0;},},3007002:{0:functiondwho?:any,target?:any,skill?:anye:number{return160.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return57.0;},},3007003:{0:functiondwho?:any,target?:any,skill?:anye:number{return161.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return58.0;},},3007004:{0:functiondwho?:any,target?:any,skill?:anye:number{return162.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return59.0;},},3007005:{0:functiondwho?:any,target?:any,skill?:anye:number{return163.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return60.0;},},3007006:{0:functiondwho?:any,target?:any,skill?:anye:number{return164.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return61.0;},},3007007:{0:functiondwho?:any,target?:any,skill?:anye:number{return165.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return62.0;},},3007008:{0:functiondwho?:any,target?:any,skill?:anye:number{return166.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return63.0;},},3007009:{0:functiondwho?:any,target?:any,skill?:anye:number{return167.0;},3:functiondwho?:any,target?:any,skill?:anye:number{return64.0;},},9901001:{0:functiondwho?:any,target?:any,skill?:anye:number{return90.0;},},9901002:{0:functiondwho?:any,target?:any,skill?:anye:number{return100.0;},},9901003:{0:functiondwho?:any,target?:any,skill?:anye:number{return110.0;},},9901004:{0:functiondwho?:any,target?:any,skill?:anye:number{return120.0;},},9901005:{0:functiondwho?:any,target?:any,skill?:anye:number{return130.0;},},9901006:{0:functiondwho?:any,target?:any,skill?:anye:number{return140.0;},},9901007:{0:functiondwho?:any,target?:any,skill?:anye:number{return150.0;},},9901008:{0:functiondwho?:any,target?:any,skill?:anye:number{return160.0;},},9901009:{0:functiondwho?:any,target?:any,skill?:anye:number{return170.0;},},9902001:{0:functiondwho?:any,target?:any,skill?:anye:number{return90.0;},},9902002:{0:functiondwho?:any,target?:any,skill?:anye:number{return100.0;},},9902003:{0:functiondwho?:any,target?:any,skill?:anye:number{return110.0;},},9902004:{0:functiondwho?:any,target?:any,skill?:anye:number{return120.0;},},9902005:{0:functiondwho?:any,target?:any,skill?:anye:number{return130.0;},},9902006:{0:functiondwho?:any,target?:any,skill?:anye:number{return140.0;},},9902007:{0:functiondwho?:any,target?:any,skill?:anye:number{return150.0;},},9902008:{0:functiondwho?:any,target?:any,skill?:anye:number{return160.0;},},9902009:{0:functiondwho?:any,target?:any,skill?:anye:number{return170.0;},},9903001:{0:functiondwho?:any,target?:any,skill?:anye:number{return90.0;},},9903002:{0:functiondwho?:any,target?:any,skill?:anye:number{return100.0;},},9903003:{0:functiondwho?:any,target?:any,skill?:anye:number{return110.0;},},9903004:{0:functiondwho?:any,target?:any,skill?:anye:number{return120.0;},},9903005:{0:functiondwho?:any,target?:any,skill?:anye:number{return130.0;},},9903006:{0:functiondwho?:any,target?:any,skill?:anye:number{return140.0;},},9903007:{0:functiondwho?:any,target?:any,skill?:anye:number{return150.0;},},9903008:{0:functiondwho?:any,target?:any,skill?:anye:number{return160.0;},},9903009:{0:functiondwho?:any,target?:any,skill?:anye:number{return170.0;},}};}enumLogicActionType{AddBuff=0,DelBuff=1,SetDamage=2,FakeDamage=3,AddHero=4,ReTarget=5,AttackRetarget=6,AddEnergy=7,HurtLimit=8,CreateCircleArea=9,CreateRectArea=10,AreaMove=11,DelArea=12,SetAreaEffectType=13,SetAreaTargetCount=14,SetEffectCount=15,LockHero=16,UnlockHero=17,SelectTarget=18,IfBegin=19,IfEnd=20,SetDelayFrame=21,SetPosInCache=22,SendCMDToMagic=23,StartMagic=24,StopMagic=25,End=26,}varLogicActionName:any={0:"AddBuff",1:"DelBuff",2:"SetDamage",3:"FakeDamage",4:"AddHero",5:"ReTarget",6:"AttackRetarget",7:"AddEnergy",8:"HurtLimit",9:"CreateCircleArea",10:"CreateRectArea",11:"AreaMove",12:"DelArea",13:"SetAreaEffectType",14:"SetAreaTargetCount",15:"SetEffectCount",16:"LockHero",17:"UnlockHero",18:"SelectTarget",19:"IfBegin",20:"IfEnd",21:"SetDelayFrame",22:"SetPosInCache",23:"SendCMDToMagic",24:"StartMagic",25:"StopMagic",26:"End",}moduleECS{exportvardata_logicflow={9999:[{frame:[0,0,0,0],lockhero:false,type:LogicActionType.AddBuff,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddBuffd2,12e;}},{frame:[0,0,0,0],lockhero:false,type:LogicActionType.SetDelayFrame,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDelayFramed2,MathUtil.distancedskobj.startPos,skobj.endPosec30*100e;}},],10010:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd1e;}},],10030:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[9,9,9,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[11,11,11,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd1e;}},],10032:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[0,0,0,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[0,0,0,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[5,5,5,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[5,5,5,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd1e;}},],10050:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,1,1,0,[1,2],[1,2,3],1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.SendCMDToMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SendCMDToMagicd2,"vit",1,"0"e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.SetDelayFrame,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDelayFramed2,skobj.GetDisanced1,2ecskobj.GetFlySpeedde*10e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.FakeDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.FakeDamaged2,0e;}},{frame:[5,5,5,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[5,5,5,1],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[8,8,8,1],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],10066:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[10,10,10,0],lockhero:true,type:LogicActionType.IfBegin,action:functiondskobj:SkillInterface,who:any,target:anye{ifdwho.atkType==target.atkTypee{skobj.SetDamaged2,1e;}}},{frame:[10,10,10,0],lockhero:true,type:LogicActionType.IfBegin,action:functiondskobj:SkillInterface,who:any,target:anye{ifdwho.atkType!=target.atkTypee{skobj.SetDamaged2,2e;skobj.SelectTargetd2,1,1,0,[1],[1],0e;skobj.AddBuffd2,1006601e;}}},{frame:[16,16,16,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[16,16,16,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],10070:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[4,4,4,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[4,4,4,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[6,6,6,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[8,8,8,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd1e;}},],10080:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[8,8,8,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd1e;}},],10090:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod2e;}},{frame:[4,4,4,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1,2],[2,1,3],1e;}},{frame:[4,4,4,0],lockhero:true,type:LogicActionType.SendCMDToMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SendCMDToMagicd2,"vit",1,"0"e;}},{frame:[4,4,4,0],lockhero:true,type:LogicActionType.SetDelayFrame,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDelayFramed2,skobj.GetDisanced1,2ecskobj.GetFlySpeedde*10e;}},{frame:[4,4,4,0],lockhero:true,type:LogicActionType.FakeDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.FakeDamaged2,0e;}},{frame:[4,4,4,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod2e;}},{frame:[4,4,4,1],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread2,0,0,30,"key1",""e;}},{frame:[4,4,4,1],lockhero:false,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,999,1,0,[2,1],[2,1,3],0e;}},{frame:[4,4,4,1],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[12,12,12,1],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],10110:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[4,4,4,0],lockhero:true,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,1,1,1,[1],[5],0e;}},{frame:[4,4,4,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[6,6,6,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[8,8,8,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd1e;}},],10112:[{frame:[0,0,0,0],lockhero:false,type:LogicActionType.AddHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddHerod2,20050,10,10e;}},{frame:[0,0,0,0],lockhero:false,type:LogicActionType.AddHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddHerod2,20050,-10,-10e;}},{frame:[0,0,0,0],lockhero:false,type:LogicActionType.AddHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddHerod2,20050,-10,10e;}},{frame:[0,0,0,0],lockhero:false,type:LogicActionType.AddHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddHerod2,20050,10,-10e;}},],10120:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[6,6,6,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,1,1,0,[1,2],[1,2,3],1e;}},{frame:[6,6,6,0],lockhero:true,type:LogicActionType.SendCMDToMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SendCMDToMagicd2,"vit",1,"0"e;}},{frame:[6,6,6,0],lockhero:true,type:LogicActionType.FakeDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.FakeDamaged2,0e;}},{frame:[6,6,6,0],lockhero:true,type:LogicActionType.SetDelayFrame,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDelayFramed2,skobj.GetDisanced1,2ecskobj.GetFlySpeedde*10e;}},{frame:[6,6,6,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[6,6,6,1],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread2,0,0,30,"key","0"e;}},{frame:[6,6,6,1],lockhero:false,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,0,1,0,[1,2],[2,3,1],0e;}},{frame:[6,6,6,1],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[13,13,13,1],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],10122:[{frame:[0,0,0,0],lockhero:false,type:LogicActionType.AddHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddHerod2,20040,30,0e;}},{frame:[0,0,0,0],lockhero:false,type:LogicActionType.AddHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddHerod2,20040,0,-30e;}},{frame:[0,0,0,0],lockhero:false,type:LogicActionType.AddHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddHerod2,20040,0,30e;}},],10130:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod2e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread2,0,0,30,"key1",""e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,0,1,0,[1],[2,1,3],0e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[8,8,8,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[12,12,12,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],10132:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod2e;}},{frame:[0,0,0,0],lockhero:true,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread1,0,0,30,"key1",""e;}},{frame:[0,0,0,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[5,5,5,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[8,8,8,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],10140:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod2e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.SendCMDToMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SendCMDToMagicd2,"vit",1,"0"e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.SetDelayFrame,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDelayFramed2,skobj.GetDisanced1,2ecskobj.GetFlySpeedde*10e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.SetPosInCache,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetPosInCached2,"pos1"e;}},{frame:[5,5,5,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod2e;}},{frame:[5,5,5,1],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread2,0,0,40,"key1","pos1"e;}},{frame:[5,5,5,1],lockhero:false,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d1,99,1,0,[1],[1,2,3],0e;}},{frame:[5,5,5,1],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[40,40,40,1],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],10150:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[3,3,3,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[3,3,3,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[3,3,3,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[6,6,6,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd1e;}},],10160:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[8,8,8,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd1e;}},],10180:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[12,12,12,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd1e;}},],10182:[{frame:[30,30,30,0],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread1,0,0,60,"key","0"e;}},{frame:[30,30,30,0],lockhero:false,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,0,1,0,[1],[2,1,3],0e;}},{frame:[30,30,30,0],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},],10190:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[30,30,30,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,1,1,0,[1,2],[1,2,3],1e;}},{frame:[30,30,30,0],lockhero:true,type:LogicActionType.SendCMDToMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SendCMDToMagicd2,"vit",1,"0"e;}},{frame:[30,30,30,0],lockhero:true,type:LogicActionType.SetDelayFrame,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDelayFramed2,skobj.GetDisanced1,2ecskobj.GetFlySpeedde*10e;}},{frame:[30,30,30,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[30,30,30,0],lockhero:false,type:LogicActionType.FakeDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.FakeDamaged2,0e;}},{frame:[30,30,30,1],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[32,32,32,1],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],10200:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[7,7,7,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[7,7,7,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[14,14,14,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[16,16,16,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd1e;}},],10202:[{frame:[0,0,0,0],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread1,0,0,50,"key","0"e;}},{frame:[4,4,4,0],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd1e;}},],10220:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[10,10,10,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[10,10,10,0],lockhero:true,type:LogicActionType.SendCMDToMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SendCMDToMagicd2,"vit",1,"0"e;}},{frame:[10,10,10,0],lockhero:true,type:LogicActionType.SetDelayFrame,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDelayFramed2,skobj.GetDisanced1,2ecskobj.GetFlySpeedde*10e;}},{frame:[10,10,10,0],lockhero:true,type:LogicActionType.FakeDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.FakeDamaged2,0e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[10,10,10,1],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[17,17,17,1],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],10230:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[6,6,6,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,1,1,0,[1,2],[1,2,3],1e;}},{frame:[6,6,6,0],lockhero:true,type:LogicActionType.SendCMDToMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SendCMDToMagicd2,"vit",1,"0"e;}},{frame:[6,6,6,0],lockhero:true,type:LogicActionType.SetDelayFrame,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDelayFramed2,skobj.GetDisanced1,2ecskobj.GetFlySpeedde*10e;}},{frame:[6,6,6,0],lockhero:true,type:LogicActionType.FakeDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.FakeDamaged2,0e;}},{frame:[6,6,6,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[6,6,6,1],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread2,0,0,30,"key","0"e;}},{frame:[6,6,6,1],lockhero:false,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,0,1,0,[1],[1],0e;}},{frame:[6,6,6,1],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[12,12,12,1],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],10240:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[6,6,6,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,1,1,0,[1,2],[1,2,3],1e;}},{frame:[6,6,6,0],lockhero:true,type:LogicActionType.SendCMDToMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SendCMDToMagicd2,"vit",1,"0"e;}},{frame:[6,6,6,1],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[12,12,12,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[12,12,12,1],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],10250:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[6,6,6,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,1,1,0,[1,2],[1,2,3],1e;}},{frame:[6,6,6,0],lockhero:true,type:LogicActionType.SendCMDToMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SendCMDToMagicd2,"vit",1,"0"e;}},{frame:[6,6,6,0],lockhero:true,type:LogicActionType.SetDelayFrame,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDelayFramed2,skobj.GetDisanced1,2ecskobj.GetFlySpeedde*10e;}},{frame:[6,6,6,0],lockhero:true,type:LogicActionType.FakeDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.FakeDamaged2,0e;}},{frame:[6,6,6,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[6,6,6,1],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread2,0,0,30,"key","0"e;}},{frame:[6,6,6,1],lockhero:false,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,0,1,0,[1],[1],0e;}},{frame:[6,6,6,1],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[6,6,6,1],lockhero:false,type:LogicActionType.AddBuff,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddBuffd2,10250e;}},{frame:[12,12,12,1],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],10260:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[8,8,8,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,1,1,0,[1,2],[1,2,3],1e;}},{frame:[8,8,8,0],lockhero:true,type:LogicActionType.SendCMDToMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SendCMDToMagicd2,"vit",1,"0"e;}},{frame:[8,8,8,0],lockhero:true,type:LogicActionType.SetDelayFrame,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDelayFramed2,skobj.GetDisanced1,2ecskobj.GetFlySpeedde*10e;}},{frame:[8,8,8,0],lockhero:true,type:LogicActionType.FakeDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.FakeDamaged2,0e;}},{frame:[8,8,8,1],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[8,8,8,1],lockhero:true,type:LogicActionType.AddBuff,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddBuffd2,10270e;}},{frame:[8,8,8,1],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[15,15,15,1],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],10270:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[3,3,3,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,1,1,0,[1,2],[1,2,3],1e;}},{frame:[3,3,3,0],lockhero:true,type:LogicActionType.SendCMDToMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SendCMDToMagicd2,"vit",1,"0"e;}},{frame:[3,3,3,0],lockhero:true,type:LogicActionType.SetDelayFrame,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDelayFramed2,skobj.GetDisanced1,2ecskobj.GetFlySpeedde*10e;}},{frame:[3,3,3,0],lockhero:true,type:LogicActionType.FakeDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.FakeDamaged2,0e;}},{frame:[3,3,3,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[3,3,3,1],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[3,3,3,1],lockhero:false,type:LogicActionType.AddBuff,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddBuffd2,10270e;}},{frame:[10,10,10,1],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],10280:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[10,10,10,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[10,10,10,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[18,18,18,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[20,20,20,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd1e;}},],10290:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[6,6,6,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[6,6,6,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[12,12,12,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[14,14,14,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd1e;}},],10300:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod2e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread1,0,0,30,"key1",""e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,0,1,0,[1],[2,1,3],0e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[12,12,12,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],10310:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[6,6,6,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[6,6,6,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[12,12,12,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd1e;}},],10990:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[20,20,20,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread1,0,0,5,"bullet1",""e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread1,0,0,5,"bullet2",""e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread1,0,0,5,"bullet3",""e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread1,0,0,5,"bullet4",""e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread1,0,0,5,"bullet5",""e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread1,0,0,5,"bullet6",""e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread1,0,0,5,"bullet7",""e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread1,0,0,5,"bullet8",""e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread1,0,0,5,"bullet9",""e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.AreaMove,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AreaMoved2,1,-40,300,1000,"bullet1"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.AreaMove,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AreaMoved2,1,-30,300,1000,"bullet2"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.AreaMove,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AreaMoved2,1,-20,300,1000,"bullet3"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.AreaMove,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AreaMoved2,1,-10,300,1000,"bullet4"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.AreaMove,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AreaMoved2,1,0,300,1000,"bullet5"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.AreaMove,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AreaMoved2,1,10,300,1000,"bullet6"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.AreaMove,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AreaMoved2,1,20,300,1000,"bullet7"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.AreaMove,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AreaMoved2,1,30,300,1000,"bullet8"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.AreaMove,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AreaMoved2,1,40,300,1000,"bullet9"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.SetAreaTargetCount,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetAreaTargetCountd2,1,"bullet1"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.SetAreaTargetCount,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetAreaTargetCountd2,1,"bullet2"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.SetAreaTargetCount,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetAreaTargetCountd2,1,"bullet3"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.SetAreaTargetCount,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetAreaTargetCountd2,1,"bullet4"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.SetAreaTargetCount,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetAreaTargetCountd2,1,"bullet5"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.SetAreaTargetCount,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetAreaTargetCountd2,1,"bullet6"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.SetAreaTargetCount,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetAreaTargetCountd2,1,"bullet7"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.SetAreaTargetCount,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetAreaTargetCountd2,1,"bullet8"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.SetAreaTargetCount,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetAreaTargetCountd2,1,"bullet9"e;}},{frame:[10,20,1,0],lockhero:false,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,1,1,0,[2,1],[2,1,3],0e;}},{frame:[10,20,1,0],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.StartMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.StartMagicd2,1099001,"mgc1","bullet1"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.StartMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.StartMagicd2,1099001,"mgc2","bullet2"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.StartMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.StartMagicd2,1099001,"mgc3","bullet3"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.StartMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.StartMagicd2,1099001,"mgc4","bullet4"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.StartMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.StartMagicd2,1099001,"mgc5","bullet5"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.StartMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.StartMagicd2,1099001,"mgc6","bullet6"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.StartMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.StartMagicd2,1099001,"mgc7","bullet7"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.StartMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.StartMagicd2,1099001,"mgc8","bullet8"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.StartMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.StartMagicd2,1099001,"mgc9","bullet9"e;}},{frame:[20,20,20,0],lockhero:false,type:LogicActionType.StopMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.StopMagicd2,"mgc1"e;}},{frame:[20,20,20,0],lockhero:false,type:LogicActionType.StopMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.StopMagicd2,"mgc2"e;}},{frame:[20,20,20,0],lockhero:false,type:LogicActionType.StopMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.StopMagicd2,"mgc3"e;}},{frame:[20,20,20,0],lockhero:false,type:LogicActionType.StopMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.StopMagicd2,"mgc4"e;}},{frame:[20,20,20,0],lockhero:false,type:LogicActionType.StopMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.StopMagicd2,"mgc5"e;}},{frame:[20,20,20,0],lockhero:false,type:LogicActionType.StopMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.StopMagicd2,"mgc6"e;}},{frame:[20,20,20,0],lockhero:false,type:LogicActionType.StopMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.StopMagicd2,"mgc7"e;}},{frame:[20,20,20,0],lockhero:false,type:LogicActionType.StopMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.StopMagicd2,"mgc8"e;}},{frame:[20,20,20,0],lockhero:false,type:LogicActionType.StopMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.StopMagicd2,"mgc9"e;}},{frame:[22,22,22,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],19020:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[17,17,17,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod2e;}},{frame:[20,20,20,0],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[22,22,22,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],20010:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[2,2,2,0],lockhero:true,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread2,0,0,50,"key1",""e;}},{frame:[2,2,2,0],lockhero:true,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,999,1,0,[2,1],[2,1,3],0e;}},{frame:[2,2,2,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[2,2,2,0],lockhero:true,type:LogicActionType.DelArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.DelAread2,"key1"e;}},{frame:[2,2,2,0],lockhero:true,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,1,1,1,[1],[5],0e;}},{frame:[2,2,2,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,999e;}},{frame:[2,2,2,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[5,5,5,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd1e;}},],20020:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[3,3,3,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1,2],[1,2,3],1e;}},{frame:[3,3,3,0],lockhero:true,type:LogicActionType.SendCMDToMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SendCMDToMagicd2,"vit",1,"0"e;}},{frame:[3,3,3,0],lockhero:true,type:LogicActionType.SetDelayFrame,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDelayFramed2,skobj.GetDisanced1,2ecskobj.GetFlySpeedde*10e;}},{frame:[3,3,3,0],lockhero:true,type:LogicActionType.FakeDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.FakeDamaged2,0e;}},{frame:[3,3,3,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[3,3,3,1],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[9,9,9,1],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],20030:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1,2],[1,2,3],1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.SendCMDToMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SendCMDToMagicd2,"vit",1,"0"e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.SetDelayFrame,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDelayFramed2,skobj.GetDisanced1,2ecskobj.GetFlySpeedde*10e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.FakeDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.FakeDamaged2,0e;}},{frame:[5,5,5,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[5,5,5,1],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[8,8,8,1],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],20040:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[4,4,4,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[4,4,4,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[6,6,6,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[8,8,8,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd1e;}},],20050:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[3,3,3,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[3,3,3,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[12,12,12,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd1e;}},],20060:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[4,4,4,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[4,4,4,0],lockhero:true,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[5,5,5,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod1e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd1e;}},],30010:[{frame:[0,0,1,0],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread3,0,0,75,"key1",""e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,0,1,0,[1,2],[1,2,3],0e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.AddBuff,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddBuffd2,30010e;}},{frame:[61,61,61,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],30020:[{frame:[0,0,0,0],lockhero:false,type:LogicActionType.SetDelayFrame,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDelayFramed2,skobj.GetDisanced3,4ecskobj.GetFlySpeedde*10e;}},{frame:[0,8,4,1],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread4,0,0,120,"key1",""e;}},{frame:[0,8,4,1],lockhero:false,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,0,1,0,[1],[1,2,3],0e;}},{frame:[0,8,4,1],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[15,15,15,1],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],30030:[{frame:[0,0,0,0],lockhero:false,type:LogicActionType.CreateRectArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateRectAread3,0,0,40,120,"key","0"e;}},{frame:[0,0,0,0],lockhero:false,type:LogicActionType.HurtLimit,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.HurtLimitd2,1e;}},{frame:[0,0,0,0],lockhero:false,type:LogicActionType.AreaMove,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AreaMoved2,1,0,270,3000,"key"e;}},{frame:[0,30,2,0],lockhero:false,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,0,1,0,[1],[2,1,3],0e;}},{frame:[0,30,2,0],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[0,30,2,0],lockhero:false,type:LogicActionType.AddBuff,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddBuffd2,0e;}},{frame:[40,40,40,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],30040:[{frame:[0,0,0,0],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread3,0,0,60,"key","0"e;}},{frame:[30,30,30,0],lockhero:false,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,0,1,0,[2,1],[2,1,3],0e;}},{frame:[30,30,30,0],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[30,30,30,0],lockhero:false,type:LogicActionType.AddBuff,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddBuffd2,0e;}},{frame:[50,50,50,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],30050:[{frame:[0,0,0,0],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread3,0,0,150,"key","0"e;}},{frame:[0,0,0,0],lockhero:false,type:LogicActionType.SetAreaEffectType,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetAreaEffectTyped2,1,"key"e;}},{frame:[0,0,0,0],lockhero:false,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,0,1,1,[2,1],[2,1],0e;}},{frame:[0,70,10,0],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[0,70,10,0],lockhero:false,type:LogicActionType.AddBuff,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddBuffd2,0e;}},{frame:[100,100,100,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],30060:[{frame:[0,0,0,0],lockhero:false,type:LogicActionType.SetDelayFrame,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDelayFramed2,skobj.GetDisanced3,4ecskobj.GetFlySpeedde*10e;}},{frame:[0,0,0,0],lockhero:false,type:LogicActionType.SetAreaEffectType,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetAreaEffectTyped4,1,"key"e;}},{frame:[0,0,0,1],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread4,0,0,105,"key","0"e;}},{frame:[0,70,10,1],lockhero:false,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,0,1,0,[1,2],[2,1,3],0e;}},{frame:[0,70,10,1],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[100,100,100,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],30070:[{frame:[0,0,0,0],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread3,0,0,75,"key","0"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,0,1,0,[2,1],[2,1,3],0e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.AddBuff,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddBuffd2,0e;}},{frame:[30,30,30,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],30080:[{frame:[0,0,0,0],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread3,0,0,90,"key","0"e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,0,1,0,[2,1],[2,1],0e;}},{frame:[10,10,10,0],lockhero:false,type:LogicActionType.AddBuff,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddBuffd2,0e;}},{frame:[15,15,15,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],30090:[{frame:[0,0,0,0],lockhero:false,type:LogicActionType.SetAreaEffectType,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetAreaEffectTyped2,1,"key"e;}},{frame:[0,0,0,0],lockhero:false,type:LogicActionType.CreateCircleArea,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.CreateCircleAread3,0,0,150,"key","0"e;}},{frame:[0,75,5,0],lockhero:false,type:LogicActionType.ReTarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.ReTarget2d2,0,1,0,[1],[1],0e;}},{frame:[0,75,5,0],lockhero:false,type:LogicActionType.AddBuff,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddBuffd2,0e;}},{frame:[100,100,100,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],30100:[{frame:[30,30,0,0],lockhero:false,type:LogicActionType.AddHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddHerod3,20060,60,60e;}},{frame:[30,30,0,0],lockhero:false,type:LogicActionType.AddHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddHerod3,20060,60,-60e;}},{frame:[40,40,0,0],lockhero:false,type:LogicActionType.AddHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddHerod3,20060,-60,-60e;}},{frame:[40,40,0,0],lockhero:false,type:LogicActionType.AddHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddHerod3,20060,-60,60e;}},{frame:[50,50,0,0],lockhero:false,type:LogicActionType.AddHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddHerod3,20060,80,0e;}},{frame:[50,50,0,0],lockhero:false,type:LogicActionType.AddHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddHerod3,20060,-80,0e;}},{frame:[100,100,100,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],99010:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.SendCMDToMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SendCMDToMagicd2,"vit",1,"0"e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.FakeDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.FakeDamaged2,0e;}},{frame:[5,5,5,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod2e;}},{frame:[5,5,5,0],lockhero:false,type:LogicActionType.SetDelayFrame,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDelayFramed2,skobj.GetDisanced1,2ecskobj.GetFlySpeedde*10e;}},{frame:[5,5,5,1],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[8,8,8,1],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],99011:[{frame:[0,0,0,0],lockhero:false,type:LogicActionType.AddBuff,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddBuffd2,1e;}},{frame:[0,0,0,0],lockhero:false,type:LogicActionType.DelBuff,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.DelBuffd2,1e;}},{frame:[2,2,2,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},{frame:[0,0,0,0],lockhero:false,type:LogicActionType.AddBuff,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AddBuffd2,1e;}},{frame:[0,0,0,0],lockhero:false,type:LogicActionType.DelBuff,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.DelBuffd2,1e;}},{frame:[2,2,2,0],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},],99020:[{frame:[0,0,0,0],lockhero:true,type:LogicActionType.LockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.LockHerod1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.AttackRetarget,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.AttackRetargetd2,0,1,0,[1],[1],1e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.SendCMDToMagic,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SendCMDToMagicd2,"vit",1,"0"e;}},{frame:[5,5,5,0],lockhero:true,type:LogicActionType.FakeDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.FakeDamaged2,0e;}},{frame:[5,5,5,0],lockhero:false,type:LogicActionType.UnlockHero,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.UnlockHerod2e;}},{frame:[5,5,5,0],lockhero:false,type:LogicActionType.SetDelayFrame,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDelayFramed2,skobj.GetDisanced1,2ecskobj.GetFlySpeedde*10e;}},{frame:[5,5,5,1],lockhero:false,type:LogicActionType.SetDamage,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.SetDamaged2,0e;}},{frame:[8,8,8,1],lockhero:false,type:LogicActionType.End,action:functiondskobj:SkillInterface,who:any,target:anye{skobj.Endd2e;}},]};}moduleData{exportvartext={1:{key:"我的名字",cn:"我的名字",en:"",},2:{key:"相亲相爱一家人",cn:"相亲相爱一家人",en:"",},3:{key:"中国",cn:"中国",en:"",},4:{key:"美国",cn:"中国",en:"",},5:{key:"日本",cn:"日本",en:"",},6:{key:"家族名字",cn:"家族名字",en:"",},7:{key:"简介",cn:"简介",en:"",},8:{key:"系统未开启",cn:"系统未开启",en:"",},9:{key:"同时最多申请5个家族",cn:"同时最多申请5个家族",en:"",},10:{key:"家族不存在",cn:"家族不存在",en:"",},11:{key:"该家族已满人，不可加入",cn:"该家族已满人，不可加入",en:"",},12:{key:"该家族当前申请人数已满",cn:"该家族当前申请人数已满",en:"",},13:{key:"只能加入同一地区的家族",cn:"只能加入同一地区的家族",en:"",},14:{key:"申请成功",cn:"申请成功",en:"",},15:{key:"该家族需要{0}奖杯才可加入",cn:"该家族需要{0}奖杯才可加入",en:"",},16:{key:"成员名字",cn:"成员名字",en:"",},17:{key:"在线",cn:"在线",en:"",},18:{key:"错误状态:上次离线时间大于当前时间",cn:"错误状态:上次离线时间大于当前时间",en:"",},19:{key:"错误状态",cn:"错误状态",en:"",},20:{key:"族长",cn:"族长",en:"",},21:{key:"长老",cn:"长老",en:"",},22:{key:"左右护法",cn:"左右护法",en:"",},23:{key:"{0}分钟前",cn:"{0}分钟前",en:"",},24:{key:"{0}小时前",cn:"{0}小时前",en:"",},25:{key:"{0}天前",cn:"{0}天前",en:"",},26:{key:"10天前",cn:"10天前",en:"",},27:{key:"玩家",cn:"玩家",en:"",},28:{key:"玩家的家族名",cn:"玩家的家族名",en:"",},29:{key:"玩家a",cn:"玩家a",en:"",},30:{key:"玩家的家族名a",cn:"玩家的家族名a",en:"",},31:{key:"按卡牌品质排序",cn:"按卡牌品质排序",en:"",},32:{key:"按卡牌等级排序",cn:"按卡牌等级排序",en:"",},33:{key:"按法力消耗排序",cn:"按法力消耗排序",en:"",},34:{key:"连接服务器中...",cn:"连接服务器中...",en:"",},35:{key:"登录服务器中...",cn:"登录服务器中...",en:"",},36:{key:"重连服务器成功...",cn:"重连服务器成功...",en:"",},37:{key:"重登录账号成功...",cn:"重登录账号成功...",en:"",},38:{key:"预加载资源",cn:"预加载资源",en:"",},39:{key:"配置资源",cn:"配置资源",en:"",},40:{key:"音效资源",cn:"音效资源",en:"",},41:{key:"公共界面",cn:"公共界面",en:"",},42:{key:"字体资源",cn:"字体资源",en:"",},43:{key:"领主资源",cn:"领主资源",en:"",},44:{key:"主城通用资源",cn:"主城通用资源",en:"",},45:{key:"主城地图",cn:"主城地图",en:"",},46:{key:"战场通用资源",cn:"战场通用资源",en:"",},47:{key:"战场资源",cn:"战场资源",en:"",},48:{key:"地图资源",cn:"地图资源",en:"",},49:{key:"英雄资源",cn:"英雄资源",en:"",},50:{key:"其他资源",cn:"其他资源",en:"",},51:{key:"连接服务器成功...",cn:"连接服务器成功...",en:"",},52:{key:"连接服务器成功!!!",cn:"连接服务器成功!!!",en:"",},53:{key:"连接服务器失败重新连接...",cn:"连接服务器失败重新连接...",en:"",},54:{key:"连接服务器失败!!!",cn:"连接服务器失败!!!",en:"",},55:{key:"战场加载中...",cn:"战场加载中...",en:"",},56:{key:"等待服务器时间...",cn:"等待服务器时间...",en:"",},57:{key:"登录战斗服成功!!!",cn:"登录战斗服成功!!!",en:"",},58:{key:"等待其他玩家...",cn:"等待其他玩家...",en:"",},59:{key:"登录战斗服务器中...",cn:"登录战斗服务器中...",en:"",},60:{key:"无法识别的错误码:{0}",cn:"无法识别的错误码:{0}",en:"",},61:{key:"拒绝",cn:"拒绝",en:"",},62:{key:"同意",cn:"同意",en:"",},63:{key:"组队邀请",cn:"组队邀请",en:"",},64:{key:"拒绝邀请",cn:"拒绝邀请",en:"",},65:{key:"同意邀请",cn:"同意邀请",en:"",},66:{key:"关闭界面",cn:"关闭界面",en:"",},67:{key:"{0}已成为您的好友",cn:"{0}已成为您的好友",en:"",},68:{key:"背包物品数量超出上限",cn:"背包物品数量超出上限",en:"",},69:{key:"获得{0}x{1}",cn:"获得{0}*{1}",en:"",},70:{key:"匹配失败!!!",cn:"匹配失败!!!",en:"",},71:{key:"购买成功",cn:"购买成功",en:"",},72:{key:"购买失败",cn:"购买失败",en:"",},73:{key:"金币不足",cn:"金币不足",en:"",},74:{key:"物品不足",cn:"物品不足",en:"",},75:{key:"配置表找不到该技能",cn:"配置表找不到该技能",en:"",},76:{key:"英雄没有该技能",cn:"英雄没有该技能",en:"",},77:{key:"找不到英雄",cn:"找不到英雄",en:"",},78:{key:"您的好友人数已达上限！",cn:"您的好友人数已达上限！",en:"",},79:{key:"对方的好友已满，添加失败！",cn:"对方的好友已满，添加失败！",en:"",},80:{key:"该玩家已下线，邀请失败！",cn:"该玩家已下线，邀请失败！",en:"",},81:{key:"中立",cn:"中立",en:"",},82:{key:"东方",cn:"东方",en:"",},83:{key:"巨龙城",cn:"巨龙城",en:"",},84:{key:"海洋",cn:"海洋",en:"",},85:{key:"普通",cn:"普通",en:"",},86:{key:"稀有",cn:"稀有",en:"",},87:{key:"珍贵",cn:"珍贵",en:"",},88:{key:"传奇",cn:"传奇",en:"",},89:{key:"根节点",cn:"根节点",en:"",},90:{key:"杯数{0}",cn:"杯数{0}",en:"",},91:{key:"您接受了{0}加入家族的请求",cn:"您接受了{0}加入家族的请求",en:"",},92:{key:"您拒绝了{0}加入家族的请求",cn:"您拒绝了{0}加入家族的请求",en:"",},93:{key:"关闭",cn:"关闭",en:"",},94:{key:"退出",cn:"退出",en:"",},95:{key:"提示",cn:"提示",en:"",},96:{key:"点击了关闭按钮",cn:"点击了关闭按钮",en:"",},97:{key:"点击了退出按钮",cn:"点击了退出按钮",en:"",},98:{key:"等UI出来之后再接",cn:"等UI出来之后再接",en:"",},99:{key:"简介:{0}",cn:"简介:{0}",en:"",},100:{key:"战力:{0}",cn:"战力:{0}",en:"",},101:{key:"战绩:{0}",cn:"战绩:{0}",en:"",},102:{key:"地区:{0}",cn:"地区:{0}",en:"",},103:{key:"成员:{0}c00",cn:"成员:{0}c00",en:"",},104:{key:"杯数:{0}",cn:"杯数:{0}",en:"",},105:{key:"贡献:{0}",cn:"贡献:{0}",en:"",},106:{key:"点击了捐赠按钮",cn:"点击了捐赠按钮",en:"",},107:{key:"您拥有:6c20",cn:"您拥有:6c20",en:"",},108:{key:"家族动态",cn:"家族动态",en:"",},109:{key:"家族名称不能为空",cn:"家族名称不能为空",en:"",},110:{key:"奖杯：{0}",cn:"奖杯：{0}",en:"",},111:{key:"贡献：{0}",cn:"贡献：{0}",en:"",},112:{key:"家族信息",cn:"家族信息",en:"",},113:{key:"加入",cn:"加入",en:"",},114:{key:"已申请",cn:"已申请",en:"",},115:{key:"战力：{0}",cn:"战力：{0}",en:"",},116:{key:"成员：{0}c{1}",cn:"成员：{0}c{1}",en:"",},117:{key:"地区：{0}",cn:"地区：{0}",en:"",},118:{key:"成员信息",cn:"成员信息",en:"",},119:{key:"家族名称:{0}",cn:"家族名称:{0}",en:"",},120:{key:"排名：{0}",cn:"排名：{0}",en:"",},121:{key:"姓名:{0}",cn:"姓名:{0}",en:"",},122:{key:"成员:{0}c{1}",cn:"成员:{0}c{1}",en:"",},123:{key:"推荐家族",cn:"推荐家族",en:"",},124:{key:"很抱歉，当前没有符合的家族，你可以创建属于自己的家族",cn:"很抱歉，当前没有符合的家族，你可以创建属于自己的家族",en:"",},125:{key:"未搜索到家族，请检查输入是否有误\n\n\n提示:只能搜索同一地区的家族",cn:"未搜索到家族，请检查输入是否有误\n\n\n提示:只能搜索同一地区的家族",en:"",},126:{key:"购买了",cn:"购买了",en:"",},127:{key:"商品",cn:"商品",en:"",},128:{key:"限购:{0}",cn:"限购:{0}",en:"",},129:{key:"[热销]",cn:"[热销]",en:"",},130:{key:"超值☆☆☆",cn:"超值☆☆☆",en:"",},131:{key:"-折扣-",cn:"-折扣-",en:"",},132:{key:"⊙限时",cn:"⊙限时",en:"",},133:{key:"添加商品",cn:"添加商品",en:"",},134:{key:"删除商品",cn:"删除商品",en:"",},135:{key:"输入信息最长50个字",cn:"输入信息最长50个字",en:"",},136:{key:"确定",cn:"确定",en:"",},137:{key:"取消",cn:"取消",en:"",},138:{key:"删除好友",cn:"删除好友",en:"",},139:{key:"换一批还在冷却中请等待...",cn:"换一批还在冷却中请等待...",en:"",},140:{key:"您没有收到好友邀请！",cn:"您没有收到好友邀请！",en:"",},141:{key:"当前没有合适的玩家推荐！",cn:"当前没有合适的玩家推荐！",en:"",},142:{key:"{0}秒",cn:"{0}秒",en:"",},143:{key:"换一批",cn:"换一批",en:"",},144:{key:"您的好友：{0}c{1}人",cn:"您的好友：{0}c{1}人",en:"",},145:{key:"邀请失败",cn:"邀请失败",en:"",},146:{key:"已邀请",cn:"已邀请",en:"",},147:{key:"邀请成功，请等待对方同意！",cn:"邀请成功，请等待对方同意！",en:"",},148:{key:"未获得",cn:"未获得",en:"",},149:{key:"{0}阶竞技场开启",cn:"{0}阶竞技场开启",en:"",},150:{key:"{0}阶竞技场解锁后可收集",cn:"{0}阶竞技场解锁后可收集",en:"",},151:{key:"请输入用户名",cn:"请输入用户名",en:"",},152:{key:"请输入密码",cn:"请输入密码",en:"",},153:{key:"登录成功!!!",cn:"登录成功!!!",en:"",},154:{key:"登录失败!!!",cn:"登录失败!!!",en:"",},155:{key:"ip值非法!!!",cn:"ip值非法!!!",en:"",},156:{key:"{0}级后可以加入家族!",cn:"{0}级后可以加入家族!",en:"",},157:{key:"竞技场达到4阶开放",cn:"竞技场达到4阶开放",en:"",},158:{key:"邀请好友",cn:"邀请好友",en:"",},159:{key:"随机匹配",cn:"随机匹配",en:"",},160:{key:"2V2对战",cn:"2V2对战",en:"",},161:{key:"当前没有好友或族员在线，请进行随机匹配！",cn:"当前没有好友或族员在线，请进行随机匹配！",en:"",},162:{key:"玩家已经下线！",cn:"玩家已经下线！",en:"",},163:{key:"弹出个人信息界面",cn:"弹出个人信息界面",en:"",},164:{key:"点击分享",cn:"点击分享",en:"",},165:{key:"刷新任务",cn:"刷新任务",en:"",},166:{key:"取消",cn:"取消",en:"",},167:{key:"刷新",cn:"刷新",en:"",},168:{key:"\nd每日赠送三次免费刷新机会e",cn:"\nd每日赠送三次免费刷新机会e",en:"",},169:{key:"购买钻石",cn:"购买钻石",en:"",},170:{key:"前去购买钻石",cn:"前去购买钻石",en:"",},171:{key:"下个任务:",cn:"下个任务:",en:"",},172:{key:"下个任务：即将刷新:",cn:"下个任务：即将刷新:",en:"",},173:{key:"当前花费:",cn:"当前花费:",en:"",},174:{key:"天",cn:"天",en:"",},175:{key:"小时",cn:"小时",en:"",},176:{key:"分钟",cn:"分钟",en:"",},177:{key:"秒",cn:"秒",en:"",},178:{key:"距离结束:",cn:"距离结束:",en:"",},179:{key:"近期开启，敬请期待:",cn:"近期开启，敬请期待:",en:"",},180:{key:"排位赛近期开启，敬请期待",cn:"排位赛近期开启，敬请期待",en:"",},181:{key:"编号:{0}",cn:"编号:{0}",en:"",},182:{key:"{0}阶",cn:"{0}阶",en:"",},183:{key:"无家族",cn:"无家族",en:"",},184:{key:"购买卡牌",cn:"购买卡牌",en:"",},185:{key:"购买次数不足",cn:"购买次数不足",en:"",},186:{key:"钻石不足",cn:"钻石不足",en:"",},187:{key:"卡牌数量不足",cn:"卡牌数量不足",en:"",},188:{key:"金币数量不足",cn:"金币数量不足",en:"",},189:{key:"更换领主",cn:"更换领主",en:"",},190:{key:"卡组未解锁",cn:"卡组未解锁",en:"",},191:{key:"该领主无法使用这张卡",cn:"该领主无法使用这张卡",en:"",},192:{key:"未解锁",cn:"未解锁",en:"",},193:{key:"取消匹配",cn:"取消匹配",en:"",},194:{key:"有效利用法力是制胜关键",cn:"有效利用法力是制胜关键",en:"",},195:{key:"预计{0}秒",cn:"预计{0}秒",en:"",},196:{key:"资源加载完成!!!",cn:"资源加载完成!!!",en:"",},197:{key:"技能ID:{0}不存在!!!",cn:"技能ID:{0}不存在!!!",en:"",},198:{key:"vitType:{0}非法!!!",cn:"vitType:{0}非法!!!",en:"",},199:{key:"英雄已经死亡",cn:"英雄已经死亡",en:"",},200:{key:"英雄被禁锢",cn:"英雄被禁锢",en:"",},201:{key:"能量不足",cn:"能量不足",en:"",},202:{key:"获取属性失败",cn:"获取属性失败",en:"",},203:{key:"属性不存在",cn:"属性不存在",en:"",},204:{key:"值非法",cn:"值非法",en:"",},205:{key:"数据非法{0}!!!",cn:"数据非法{0}!!!",en:"",},206:{key:"无效位置x:{0}y:{1}",cn:"无效位置x:{0}y:{1}",en:"",},207:{key:"找不到合适的位置摆放英雄x:{0}y:{1}",cn:"找不到合适的位置摆放英雄x:{0}y:{1}",en:"",},208:{key:"跳转帧只能处在当前帧和最大帧之间",cn:"跳转帧只能处在当前帧和最大帧之间",en:"",},209:{key:"帧数:{0}",cn:"帧数:{0}",en:"",},210:{key:"客户端帧:",cn:"客户端帧:",en:"",},211:{key:"服务器帧:",cn:"服务器帧:",en:"",},212:{key:"防御塔10",cn:"防御塔10",en:"",},213:{key:"防御塔11",cn:"防御塔11",en:"",},214:{key:"防御塔12",cn:"防御塔12",en:"",},215:{key:"防御塔20",cn:"防御塔20",en:"",},216:{key:"防御塔21",cn:"防御塔21",en:"",},217:{key:"防御塔22",cn:"防御塔22",en:"",},218:{key:"障碍物",cn:"障碍物",en:"",},219:{key:"完成",cn:"完成",en:"",},220:{key:"游戏异常战斗终止",cn:"游戏异常战斗终止",en:"",},221:{key:"请先执行Init方法初始化数据",cn:"请先执行方法初始化数据",en:"",},222:{key:"两点所确定直线垂直于y轴，不能根据x值得到y值",cn:"两点所确定直线垂直于y轴，不能根据x值得到y值",en:"",},223:{key:"您输入的Email地址格式不正确！",cn:"您输入的电子邮件地址格式不正确！",en:"",},224:{key:"您输入的电话号码不正确!",cn:"您输入的电话号码不正确!",en:"",},225:{key:"零",cn:"零",en:"",},226:{key:"一",cn:"一",en:"",},227:{key:"二",cn:"二",en:"",},228:{key:"三",cn:"三",en:"",},229:{key:"四",cn:"四",en:"",},230:{key:"五",cn:"五",en:"",},231:{key:"六",cn:"六",en:"",},232:{key:"七",cn:"七",en:"",},233:{key:"八",cn:"八",en:"",},234:{key:"九",cn:"九",en:"",},235:{key:"物品名字有好多字",cn:"物品名字有好多字",en:"",},236:{key:"按钮",cn:"按钮",en:"",},237:{key:"出战",cn:"出战",en:"",},238:{key:"描述：",cn:"描述：",en:"",},239:{key:"数量等信息",cn:"数量等信息",en:"",},240:{key:"我是标题标题",cn:"我是标题标题",en:"",},241:{key:"玩家的名字",cn:"玩家的名字",en:"",},242:{key:"贡献：000000000",cn:"贡献：000000000",en:"",},243:{key:"接受",cn:"接受",en:"",},244:{key:"申请列表",cn:"申请列表",en:"",},245:{key:"我是家族战界面",cn:"我是家族战界面",en:"",},246:{key:"聊天",cn:"聊天",en:"",},247:{key:"家族",cn:"家族",en:"",},248:{key:"珍宝阁",cn:"珍宝阁",en:"",},249:{key:"家族战",cn:"家族战",en:"",},250:{key:"职位",cn:"职位",en:"",},251:{key:"家族名称",cn:"家族名称",en:"",},252:{key:"家族简介",cn:"家族简介",en:"",},253:{key:"实力：00000",cn:"实力：00000",en:"",},254:{key:"成员：00c00",cn:"成员：00c00",en:"",},255:{key:"战绩：00c00",cn:"战绩：00c00",en:"",},256:{key:"地区：中国",cn:"地区：中国",en:"",},257:{key:"设置",cn:"设置",en:"",},258:{key:"捐赠",cn:"捐赠",en:"",},259:{key:"换卡",cn:"换卡",en:"",},260:{key:"卡占位",cn:"卡占位",en:"",},261:{key:"正在请求捐赠",cn:"正在请求捐赠",en:"",},262:{key:"您拥有:0c0",cn:"您拥有:0c0",en:"",},263:{key:"玩家的名字d族长、长老e00分钟前",cn:"玩家的名字d族长、长老e00分钟前",en:"",},264:{key:"语音",cn:"语音",en:"",},265:{key:"表情",cn:"表情",en:"",},266:{key:"发送",cn:"发送",en:"",},267:{key:"交换",cn:"交换",en:"",},268:{key:"交换英雄",cn:"交换英雄",en:"",},269:{key:"您将换出",cn:"您将换出",en:"",},270:{key:"您将得到",cn:"您将得到",en:"",},271:{key:"您将患处其中一种英雄",cn:"您将患处其中一种英雄",en:"",},272:{key:"请选择你需要换入的英雄",cn:"请选择你需要换入的英雄",en:"",},273:{key:"您将换出其中一种英雄",cn:"您将换出其中一种英雄",en:"",},274:{key:"一段录音",cn:"一段录音",en:"",},275:{key:"创建家族",cn:"创建家族",en:"",},276:{key:"这里是家族简介",cn:"这里是家族简介",en:"",},277:{key:"500创建",cn:"500创建",en:"",},278:{key:"我是下拉菜单",cn:"我是下拉菜单",en:"",},279:{key:"满足奖杯数自动通过申请",cn:"满足奖杯数自动通过申请",en:"",},280:{key:"玩家的名字很长长长长长长长",cn:"玩家的名字很长长长长长长长",en:"",},281:{key:"加入",cn:"加入",en:"",},282:{key:"家族的名称",cn:"家族的名称",en:"",},283:{key:"家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，",cn:"家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，",en:"",},284:{key:"战力:000000000",cn:"战力:000000000",en:"",},285:{key:"战绩：00000000",cn:"战绩：00000000",en:"",},286:{key:"家族的名字很长长长长长长长",cn:"家族的名字很长长长长长长长",en:"",},287:{key:"常用英雄",cn:"常用英雄",en:"",},288:{key:"d平均花费法力:00.0e",cn:"d平均花费法力:00.0e",en:"",},289:{key:"这里是队伍阵容",cn:"这里是队伍阵容",en:"",},290:{key:"000c000人",cn:"000c000人",en:"",},291:{key:"输入家族名称或家族标签",cn:"输入家族名称或家族标签",en:"",},292:{key:"搜索",cn:"搜索",en:"",},293:{key:"创建",cn:"创建",en:"",},294:{key:"返回",cn:"返回",en:"",},295:{key:"最大",cn:"最大",en:"",},296:{key:"购买",cn:"购买",en:"",},297:{key:"物品名称",cn:"物品名称",en:"",},298:{key:"总价:00000",cn:"总价:00000",en:"",},299:{key:"家族势力达到xxx奖杯解锁",cn:"家族势力达到奖杯解锁",en:"",},300:{key:"我是卡包界面",cn:"我是卡包界面",en:"",},301:{key:"好友",cn:"好友",en:"",},302:{key:"邀请",cn:"邀请",en:"",},303:{key:"删除",cn:"删除",en:"",},304:{key:"角色名称六字",cn:"角色名称六字",en:"",},305:{key:"邀请",cn:"邀请",en:"",},306:{key:"推荐",cn:"推荐",en:"",},307:{key:"您的好友：20c100人",cn:"您的好友：20c100人",en:"",},308:{key:"好友邀请",cn:"好友邀请",en:"",},309:{key:"当前没有合适的玩家推荐!",cn:"当前没有合适的玩家推荐!",en:"",},310:{key:"离线",cn:"离线",en:"",},311:{key:"加好友",cn:"加好友",en:"",},312:{key:"级",cn:"级",en:"",},314:{key:"未获得卡牌",cn:"未获得卡牌",en:"",},315:{key:"已收集军队：",cn:"已收集军队：",en:"",},317:{key:"已收集领主：",cn:"已收集领主：",en:"",},318:{key:"军队",cn:"军队",en:"",},319:{key:"领主",cn:"领主",en:"",},320:{key:"7秒",cn:"7秒",en:"",},321:{key:"领主名称",cn:"领主名称",en:"",},323:{key:"正在加载sdfsdfsadfsadfasdfasdf载sdfsdfsadfsadfasdfasdfssdfsdffsfs",cn:"正在加载",en:"",},326:{key:"预计15秒",cn:"预计15秒",en:"",},328:{key:"用户名：",cn:"用户名：",en:"",},329:{key:"密码：",cn:"密码：",en:"",},330:{key:"选服",cn:"选服",en:"",},331:{key:"选服",cn:"选服",en:"",},332:{key:"当前服务器",cn:"当前服务器",en:"",},333:{key:"服务器名称",cn:"服务器名称",en:"",},334:{key:"请输入指令...",cn:"请输入指令...",en:"",},335:{key:"命令行",cn:"命令行",en:"",},336:{key:"单机对战",cn:"单机对战",en:"",},337:{key:"回放",cn:"回放",en:"",},339:{key:"左文案",cn:"左文案",en:"",},340:{key:"右文案",cn:"右文案",en:"",},341:{key:"玩家昵称六字",cn:"玩家昵称六字",en:"",},342:{key:"抵制不良游戏，拒绝盗版游戏。注意自我保护，谨防受骗上当。适度游戏益脑，沉迷游戏伤身。合理安排时间，享受健康生活。",cn:"抵制不良游戏，拒绝盗版游戏。注意自我保护，谨防受骗上当。适度游戏益脑，沉迷游戏伤身。合理安排时间，享受健康生活。",en:"",},343:{key:"公告内容公告内容",cn:"公告内容公告内容",en:"",},345:{key:"角色名角色名",cn:"角色名角色名",en:"",},346:{key:"纯文字显示弹窗内容\n纯文字显示弹窗内容",cn:"纯文字显示弹窗内容\n纯文字显示弹窗内容",en:"",},347:{key:"您确定要刷新该任务吗？\n",cn:"您确定要刷新该任务吗？",en:"",},350:{key:"角色名称六个字",cn:"角色名称六个字",en:"",},351:{key:"当前在线族员：5人",cn:"当前在线族员：5人",en:"",},352:{key:"分享至家族",cn:"分享至家族",en:"",},353:{key:"当前没有好友在线哦！\n您可以分享到家族，\n邀请家族成员一起战斗",cn:"当前没有好友在线哦！\n您可以分享到家族，\n邀请家族成员一起战斗",en:"",},354:{key:"奖励",cn:"奖励",en:"",},355:{key:"每日任务",cn:"每日任务",en:"",},356:{key:"累计获得1000金币任务描述",cn:"累计获得1000金币任务描述",en:"",},357:{key:"领取",cn:"领取",en:"",},358:{key:"下个任务：5小时14分钟",cn:"下个任务：5小时14分钟",en:"",},361:{key:"距离结束:23小时14分钟",cn:"距离结束:23小时14分钟",en:"",},364:{key:"奖杯",cn:"奖杯",en:"",},365:{key:"竞技场",cn:"竞技场",en:"",},366:{key:"等级",cn:"等级",en:"",},367:{key:"家族",cn:"家族",en:"",},368:{key:"地区",cn:"地区",en:"",},369:{key:"常用卡组",cn:"常用卡组",en:"",},370:{key:"平均花费法力：",cn:"平均花费法力：",en:"",},371:{key:"玩家的昵称",cn:"玩家的昵称",en:"",},372:{key:"8阶",cn:"8阶",en:"",},374:{key:"5级",cn:"5级",en:"",},375:{key:"玩家名称六字",cn:"玩家名称六字",en:"",},376:{key:"家族名称六字",cn:"家族名称六字",en:"",},377:{key:"全球",cn:"全球",en:"",},378:{key:"本地",cn:"本地",en:"",},379:{key:"提示：联盟杯赛事当前剩余时间：24天12时",cn:"提示：联盟杯赛事当前剩余时间：24天12时",en:"",},380:{key:"特惠周剩余6天",cn:"特惠周剩余6天",en:"",},381:{key:"神主",cn:"神主",en:"",},382:{key:"头像框",cn:"头像框",en:"",},383:{key:"聊天框",cn:"聊天框",en:"",},384:{key:"雅典娜",cn:"雅典娜",en:"",},385:{key:"解锁3阶竞技场可购买",cn:"解锁3阶竞技场可购买",en:"",},386:{key:"免费",cn:"免费",en:"",},387:{key:"已购买",cn:"已购买",en:"",},388:{key:"8.5折",cn:"8.5折",en:"",},390:{key:"卡牌名称名称",cn:"卡牌名称名称",en:"",},392:{key:"购买金币",cn:"购买金币",en:"",},395:{key:"一些金币",cn:"一些金币",en:"",},398:{key:"尊享宝箱",cn:"尊享宝箱",en:"",},399:{key:"特惠周",cn:"特惠周",en:"",},400:{key:"至少包含",cn:"至少包含",en:"",},401:{key:"稀有卡牌x10",cn:"稀有卡牌x10",en:"",},402:{key:"史诗卡牌x10",cn:"史诗卡牌x10",en:"",},403:{key:"传奇卡牌x10",cn:"传奇卡牌x10",en:"",},404:{key:"500单次",cn:"500单次",en:"",},405:{key:"4500十次",cn:"4500十次",en:"",},406:{key:"8阶王者宝箱",cn:"8阶王者宝箱",en:"",},408:{key:"生命",cn:"生命",en:"",},409:{key:"弓箭手",cn:"弓箭手",en:"",},411:{key:"9级弓箭手",cn:"9级弓箭手",en:"",},412:{key:"阵营",cn:"阵营",en:"",},413:{key:"品质",cn:"品质",en:"",},414:{key:"升级可获得",cn:"升级可获得",en:"",},415:{key:"卡牌描述说明，卡牌描述说明，卡牌描述说明，卡牌描述说明",cn:"卡牌描述说明，卡牌描述说明，卡牌描述说明，卡牌描述说明",en:"",},417:{key:"出战",cn:"出战",en:"",},418:{key:"出战中",cn:"出战中",en:"",},419:{key:"神主99020",cn:"神主99020",en:"",},422:{key:"信息",cn:"信息",en:"",},423:{key:"出战",cn:"出战",en:"",},424:{key:"不可用",cn:"不可用",en:"",},426:{key:"6级亚瑟亚瑟",cn:"6级亚瑟亚瑟",en:"",},427:{key:"介绍",cn:"介绍",en:"",},428:{key:"所有法力消耗所有法力消耗所有法力消耗所有法力消耗所有法力消耗所有法力消耗所有法力消耗",cn:"所有法力消耗所有法力消耗所有法力消耗所有法力消耗所有法力消耗所有法力消耗所有法力消耗",en:"",},430:{key:"添加英雄",cn:"添加英雄",en:"",},431:{key:"已收集：",cn:"已收集：",en:"",},432:{key:"您当前没有收集到更多的卡牌可使用",cn:"您当前没有收集到更多的卡牌可使用",en:"",},433:{key:"平均花费法力:",cn:"平均花费法力:",en:"",},435:{key:"亚瑟亚瑟亚瑟",cn:"亚瑟亚瑟亚瑟",en:"",},436:{key:"步兵",cn:"步兵",en:"",},437:{key:"加速",cn:"加速",en:"",},438:{key:"减速",cn:"减速",en:"",},439:{key:"播放",cn:"播放",en:"",},440:{key:"暂停",cn:"暂停",en:"",},441:{key:"技能ID",cn:"技能ID",en:"",},442:{key:"添加攻击者",cn:"添加攻击者",en:"",},443:{key:"添加受击者",cn:"添加受击者",en:"",},444:{key:"播放动画",cn:"播放动画",en:"",},445:{key:"读取",cn:"读取",en:"",},446:{key:"写入",cn:"写入",en:"",},447:{key:"测试效果",cn:"测试效果",en:"",},449:{key:"确定",cn:"确定",en:"",},451:{key:"塔10",cn:"塔10",en:"",},452:{key:"塔11",cn:"塔11",en:"",},453:{key:"塔12",cn:"塔12",en:"",},454:{key:"塔22",cn:"塔22",en:"",},455:{key:"塔21",cn:"塔21",en:"",},456:{key:"塔20",cn:"塔20",en:"",},457:{key:"跳转",cn:"跳转",en:"",},458:{key:"帧数:3000",cn:"帧数:3000",en:"",},459:{key:"法力不足!",cn:"法力不足!",en:"",},461:{key:"达到{0}奖杯开放组队模式",cn:"达到{0}奖杯开放组队模式",en:"",},463:{key:"军队01-军队_jpg",cn:"军队01-军队_jpg",en:"",},464:{key:"军队03-领主_jpg",cn:"军队03-领主_jpg",en:"",},465:{key:"00_02loading画面_jpg",cn:"00_02loading画面_jpg",en:"",},466:{key:"04战斗准备1v1_匹配成功_jpg",cn:"04战斗准备1v1_匹配成功_jpg",en:"",},467:{key:"08战斗准备2v2_匹配成功_jpg",cn:"08战斗准备2v2_匹配成功_jpg",en:"",},468:{key:"00_01登录画面_jpg",cn:"00_01登录画面_jpg",en:"",},469:{key:"经验+1000",cn:"经验+1000",en:"",},470:{key:"金币+1000",cn:"金币+1000",en:"",},471:{key:"钻石+1000",cn:"钻石+1000",en:"",},472:{key:"杯数+100",cn:"杯数+100",en:"",},473:{key:"等级+1",cn:"等级+1",en:"",},474:{key:"全满",cn:"全满",en:"",},475:{key:"2v2战斗_弹窗_01_jpg",cn:"2v2战斗_弹窗_01_jpg",en:"",},476:{key:"00主界面01_对战_jpg",cn:"00主界面01_对战_jpg",en:"",},480:{key:"2v2战斗_弹窗_02_jpg",cn:"2v2战斗_弹窗_02_jpg",en:"",},482:{key:"00主界面03_任务_jpg",cn:"00主界面03_任务_jpg",en:"",},483:{key:"00主界面02_赛事_jpg",cn:"00主界面02_赛事_jpg",en:"",},484:{key:"排行榜01_jpg",cn:"排行榜01_jpg",en:"",},485:{key:"02个人资料01_jpg",cn:"02个人资料01_jpg",en:"",},486:{key:"编号：fesf12345662",cn:"编号：fesf12345662",en:"",},487:{key:"商城02卡牌_jpg",cn:"商城02卡牌_jpg",en:"",},488:{key:"商店02_金币02_jpg",cn:"商店02_金币02_jpg",en:"",},489:{key:"商店01_钻石_jpg",cn:"商店01_钻石_jpg",en:"",},490:{key:"商店02_金币_jpg",cn:"商店02_金币_jpg",en:"",},491:{key:"卡组01_主_jpg",cn:"卡组01_主_jpg",en:"",},492:{key:"商城01卡牌_jpg",cn:"商城01卡牌_jpg",en:"",},493:{key:"卡组04-01军队可升级_jpg",cn:"卡组04-01军队可升级_jpg",en:"",},494:{key:"属性",cn:"属性",en:"",},495:{key:"卡组04-05军队未获得_jpg",cn:"卡组04-05军队未获得_jpg",en:"",},496:{key:"卡组02_jpg",cn:"卡组02_jpg",en:"",},497:{key:"卡组03-02更换卡组_jpg",cn:"卡组03-02更换卡组_jpg",en:"",},498:{key:"卡组03-更换军队_主_jpg",cn:"卡组03-更换军队_主_jpg",en:"",},499:{key:"卡组05-领主信息详情_jpg",cn:"卡组05-领主信息详情_jpg",en:"",},500:{key:"卡组03-01更换卡组02_jpg",cn:"卡组03-01更换卡组02_jpg",en:"",},501:{key:"卡组03-待添加选中03_jpg",cn:"卡组03-待添加选中03_jpg",en:"",},502:{key:"12战斗结算-2v2胜利_jpg",cn:"12战斗结算-2v2胜利_jpg",en:"",},503:{key:"01战斗示意图_1v1_jpg",cn:"01战斗示意图_1v1_jpg",en:"",},50001:{key:"",cn:"1、排位赛为期15天，根据拥有奖杯分为全球榜单和本地榜单\n2、拥有奖杯达到3000以上时才可以参与赛事排名\n3、赛事结束时5000以上奖杯的玩家会重置扣除部分奖杯\n4、赛事结束时邮件发放榜单奖励（全球和本地独立奖励）\n5、全球榜单第1001名后奖励，需要拥有奖杯达到3000以上才可获得\n6、本地榜单只有前1000名有排名奖励（第1001名后无奖励）\n7、由于可能存在的网络延时，最终榜单以发放奖励时为准\n8、在事赛期间满足参战次数或三星完胜次数，即可领取挑战宝箱\n",en:"",},50002:{key:"",cn:"1、争霸赛为期10天，本地区玩家之间对战的专属赛事\n2、需要神主等级达到5级以上才可以参与争霸赛\n3、争霸赛在每天的10:00-22:00之间开放\n4、每天有10次免费挑战机会和10次付费挑战机会\n5、需要在系统提供的英雄库里设定出战英雄卡组才能发起挑战\n6、赛事期间获得指定的奖杯数即可以领取对应的挑战礼包\n7、赛事结束后邮件发放奖杯排名奖励（奖杯榜前1000名\n8、由于可能存在的网络延时，最终榜单以发放奖励时为准\n",en:"",}};}modulegame{exportclassAchieveDataItemextendsDataBase{publicconstructorde{superde;}}}modulegame{exportclassAchieveDataMgrextendsDataBase{publiclv:number;cc成就等级publicgrade:number;cc段位publicstar:number;cc星级publicname:string;publicdesc:string;publicupgradeLv:number;cc晋级等级publictaskArray:AchieveTaskDataItem[];publicupgradTask:AchieveTaskDataItem;publicconstructorde{superde;this.taskArray=[];this.upgradTask=null;this.Initde;}publicInitde{this.RefreshLvd1e;}publicRefreshLvdlv:numbere{ifdthis.lv==lvereturn;letdataProxy=JsonData.getGameDatad"achievedata_json"e;letachieveData=dataProxy[lv];ifdachieveData==nulle{game.errord"getachieveDataerror:",lve;ifdlv!=1ethis.RefreshLvd1e;}this.grade=achieveData["grade"];this.star=achieveData["star"];this.name=achieveData["name"];this.desc=achieveData["desc"];this.DestroyTaskde;lettaskIdArray=achieveData["tasklist"];fordlettaskIdoftaskIdArraye{lettaskObj=newAchieveTaskDataItemdtaskIde;this.taskArray.pushdtaskObje;}letupgradeLv=5-this.star+lv;cc计算晋级任务所需等级achieveData=dataProxy[upgradeLv];ifdachieveData!=nulle{lettaskId=achieveData["upgrade"];this.upgradTask=newAchieveTaskDataItemdtaskIde;}this.SetAttrd"lv",lve;this.upgradeLv=upgradeLv;}publicGetTaskDatadindex:numbere:AchieveTaskDataItem{returnthis.taskArray[index];}publicDestroyTaskde{fordlettaskObjofthis.taskArraye{taskObj.Destroyde;}this.taskArray=[];ifdthis.upgradTask!=nulle{this.upgradTask.Destroyde;this.upgradTask=null;}}publicDestroyde{this.DestroyTaskde;super.Destroyde;}}}﻿modulegame{exportclassAchieveTaskDataItemextendsDataBase{publicid:number;publicname:string;publicdesc:string;publiclevel:number;publiccondition:number;publictotalCount:number;publicnowCount:number;publicrewardID:number;publicstate:number;cc状态0:未领取奖励1:已经领取奖励publicconstructordid:numbere{superde;this.id=id;this.state=0;this.Initde;}publicDestroyde{super.Destroyde;}publicInitde{letdataProxy=JsonData.getGameDatad"taskdata_json"e;lettaskData=dataProxy[this.id];this.name=taskData["name"];this.desc=taskData["desc"];this.condition=taskData["condition"];this.totalCount=taskData["count"];this.rewardID=taskData["reward"];this.nowCount=0;}publicRefreshCountdcount:numbere{ifdcountbthis.totalCountecount=this.totalCount;this.nowCount=count;this.SetAttrd"nowCount",counte;}publicRefreshStatedstate:numbere{this.state=state;}publicGetRewardde:any[]{returnDataUtil.GetRewarddthis.rewardIDe;}}}﻿modulegame{exportclassPWSRewardInfoextendsDataBase{publicrewardId:number;publicminScore:number;publicmaxScore:number;publicitemId:number;publicitemCount:number;publicstate:number;cc0未达到1未领取2已领取publicconstructordrewardId:numbere{superde;this.state=0;this.rewardId=rewardId;this.Initde;}publicInitde{letrewardData=DataUtil.GetValueByKeyd"common_rewarddata_json",this.rewardIde;ifdrewardData==nulle{return;}this.minScore=rewardData["min"];this.maxScore=rewardData["max"];letitemArray=rewardData["items"];this.itemId=0;this.itemCount=0;fordletitemInfoofitemArraye{this.itemId=itemInfo[0];this.itemCount=itemInfo[1];}}publicRefreshCupCountdcupCount:numbere{ifdthis.state==0ecc未达到条件{ifdcupCountb=this.minScoreethis.SetAttrd"state",1e;}}publicRefreshStatedstate:numbere{ifdthis.state==0ereturn;this.SetAttrd"state",statee;}publicDestroyde{super.Destroyde;}}exportclassPWSDataMgrextendsDataBase{publicid:number;publicendTime:number;publicminLevel:number;cc最低等级publicminCupCount:number;cc最低奖杯数目publicfreeRewardInfoArray:PWSRewardInfo[]=[];publicvipRewardInfoArray:PWSRewardInfo[]=[];publicmaxRewardCount:number=9;privatekeyMap:SMapanumber,stringb=newSMapanumber,stringbde;publicconstructorde{superde;this.id=10020;this.endTime=0;this.minLevel=0;this.minCupCount=0;TimerMgr.GetInstancede.AddTimerd1,this.Init,thise;}publicInitde{letdataProxy=JsonData.getGameDatad"activitydata_json"e;letdata=dataProxy[this.id];this.minLevel=data["level"];this.minCupCount=data["cup"];this.endTime=HomeServerTime.GetServerTimede+3500*1000;this.freeRewardInfoArray=[];this.vipRewardInfoArray=[];letstart=Const.RewardType.PWSFreeReward*100+1;this.maxRewardCount=9;cc统计奖励有多少fordletrewardId=start;rewardIdastart+20;rewardId++e{letrewardData=DataUtil.GetValueByKeyd"common_rewarddata_json",rewardIde;ifdrewardData!=nulle{this.maxRewardCount=rewardId-start+1;}else{break;}}letend=start+this.maxRewardCount-1;letrewardInfo:PWSRewardInfo;fordletrewardId=start;rewardIda=end;rewardId++e{rewardInfo=newPWSRewardInfodrewardIde;this.freeRewardInfoArray.pushdrewardInfoe;}start=Const.RewardType.PWSVipReward*100+1;end=start+this.maxRewardCount-1;fordletrewardId=start;rewardIda=end;rewardId++e{rewardInfo=newPWSRewardInfodrewardIde;this.vipRewardInfoArray.pushdrewardInfoe;}MainDataMgr.GetInstancede.AddPropCBdthis.keyMap,"cupCount",this.RefreshCupCount,thise;}publicRefreshCupCountde{letcupCount=MainDataMgr.GetInstancede.cupCount;fordletrewardInfoofthis.freeRewardInfoArraye{rewardInfo.RefreshCupCountdcupCounte;}fordletrewardInfoofthis.vipRewardInfoArraye{rewardInfo.RefreshCupCountdcupCounte;}}publicIsUnLockde:boolean{letmainDataMgr=MainDataMgr.GetInstancede;ifdmainDataMgr.levelathis.minLevelereturnfalse;ifdmainDataMgr.cupCountathis.minCupCountereturnfalse;ifdHomeServerTime.GetLeftTimedthis.endTimeea=0ereturnfalse;returntrue;}publicGetLeftTimede:number{returnHomeServerTime.GetLeftTimedthis.endTimee;}publicDestroyde{ccfordlettaskDataofthis.taskDataArrayecc{cctaskData.Destroyde;cc}ccthis.taskDataArray=[];ifdthis.keyMap!=nulle{MainDataMgr.GetInstancede.RemovePropCBdthis.keyMape;this.keyMap.clearde;}fordletrewardInfoofthis.freeRewardInfoArraye{rewardInfo.Destroyde;}this.freeRewardInfoArray=[];fordletrewardInfoofthis.vipRewardInfoArraye{rewardInfo.Destroyde;}this.vipRewardInfoArray=[];super.Destroyde;}}}﻿modulegame{exportclassZBSDataMgrextendsDataBase{publicid:number;publicendTime:number;publicminLevel:number;cc最低等级publicminCupCount:number;cc最低奖杯数目publicconstructorde{superde;this.id=10010;this.endTime=0;this.minLevel=0;this.minCupCount=0;this.Initde;}publicInitde{letdataProxy=JsonData.getGameDatad"activitydata_json"e;letdata=dataProxy[this.id];this.minLevel=data["level"];this.minCupCount=data["cup"];this.endTime=HomeServerTime.GetServerTimede+3500*1000;}publicIsUnLockde:boolean{letmainDataMgr=MainDataMgr.GetInstancede;ifdmainDataMgr.levelathis.minLevelereturnfalse;ifdmainDataMgr.cupCountathis.minCupCountereturnfalse;ifdHomeServerTime.GetLeftTimedthis.endTimeea=0ereturnfalse;returntrue;}publicGetLeftTimede:number{returnHomeServerTime.GetLeftTimedthis.endTimee;}}}cccareferencepath="..cutilscSMap.ts"cbc***数据基类*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassDataBase{publicstaticrecord:boolean;publicstaticdataInfo:SMapanumber,stringb;cc=newSMapanumber,stringbde;publicstaticInitde{DataBase.dataInfo=newSMapanumber,stringbde;}publicstaticBeginRecordde{DataBase.record=true;}publicstaticEndRecordde{DataBase.record=false;}publicstaticGetUnClearCountde:number{letcount=DataBase.dataInfo.size;letvalues=DataBase.dataInfo.valuesde;fordletvalueofvaluese{game.warnd"GetUnClearCount:",valuee;}returncount;}protectedpropCB:SMapastring,SMapanumber,AttrCallBackbb;privatepropLateCB:SMapastring,SMapanumber,AttrCallBackbb;publichashCode:number=0;publicconstructorde{this.hashCode=IDManager.NewKeyIDde;ifdDataBase.recorde{DataBase.dataInfo.setdthis.hashCode,newErrorde.stacke;}this.propCB=newSMapastring,SMapanumber,AttrCallBackbbde;this.propLateCB=newSMapastring,SMapanumber,AttrCallBackbbde;}publicAddPropCB_NotCalldkeyMap:SMapanumber,stringb,propName:string,func:Function,thisObject:any,args?:anye{letkey_id=this.AddAttrListenerNotCalldpropName,func,thisObject,argse;keyMap.setdkey_id,propNamee;ccifdpropName=="state"ecc{ccgame.logd`-----AddPropCB_NotCall.state---key_id:${key_id}--DataBase:${this.hashCode}--${keyMap.valuesde}--size:${propDict.size}---thisObj:${thisObject.hashCode}----`e;cc}}publicAddPropCBdkeyMap:SMapanumber,stringb,propName:string,func:Function,thisObject:any,args?:anye{this.AddPropCB_NotCalldkeyMap,propName,func,thisObject,argse;func.calldthisObject,argse;}publicAddAttrListenerdpropName:string,func:Function,thisObject:any,args?:anye:number{letkey_id=this.AddAttrListenerNotCalldpropName,func,thisObject,argsefunc.calldthisObject,argse;returnkey_id;}publicAddAttrListenerNotCalldpropName:string,func:Function,thisObject:any,args?:anye:number{letkey_id=IDManager.NewKeyIDde;letpropDict:SMapanumber,AttrCallBackb;ifd!this.propCB.hasdpropNameee{propDict=newSMapanumber,AttrCallBackbde;this.propCB.setdpropName,propDicte;}else{propDict=this.propCB.getdpropNamee;}propDict.setdkey_id,newAttrCallBackdfunc,thisObject,argsee;returnkey_id;}publicRemovePropCBdkeyMap:SMapanumber,stringbe{cckeylist.spliced0,keylist.lengthe;letkeys=keyMap.copykeysde;fordletkey_idofkeyse{letpropName=keyMap.getdkey_ide;ifdthis.propCB.hasdpropNameee{this.propCB.getdpropNamee.deletedkey_ide;ccifdpropName=="state"ecc{ccgame.logd`-----RemovePropCB.state---key_id:${key_id}--DataBase:${this.hashCode}`e;cc}}}keyMap.clearde;ccfordletidinkeylistecc{ccletinfo=keylist[id];ccletpropName=info[0];ccletkey_id=info[1];ccifdthis.propCB.hasdpropNameeecc{ccthis.propCB.getdpropNamee.deletedkey_idecc}cc}letkeys2=this.propCB.copykeysde;fordletkeyofkeys2e{ifdthis.propCB.getdkeye.size==0e{this.propCB.deletedkeye;}}}publicRemoveOnePropCBdpropName:string,key_id:numbere{ifdthis.propCB.hasdpropNameee{this.propCB.getdpropNamee.deletedkey_ide;}}publicSetAttrdpropName:string,_value:any,...param:any[]e:void{Object.definePropertydthis,propName,{value:_value,writable:truecctrue表示该属性值可被修改，未修改前，iconBg调用SetAttr方法会报错，加了这个就不会，需要研究下}e;this.FlushAttrdpropName,...parame;}publicFlushAttrdpropName,...param:any[]e:void{ifd!this.propCB.hasdpropNameeereturn;letdict=this.propCB.getdpropNamee;letvalues=dict.valuesde;fordletvalueofvaluese{ifdparam!=nullevalue.execdparame;elsevalue.execde;}}publicRunPropCBdpropNamee{ifd!this.propCB.hasdpropNameeereturn;letdict=this.propCB.getdpropNamee;letvalues=dict.valuesde;fordletvalueofvaluese{value.execde;}}publicRemoveAllCBde{letarray1=this.propCB.valuesde;fordletvalue1ofarray1e{letarray2=value1.valuesde;fordletvalue2ofarray2e{value2.Destroyde;}value1.clearde;}this.propCB.clearde;array1=this.propLateCB.valuesde;fordletvalue1ofarray1e{letarray2=value1.valuesde;fordletvalue2ofarray2e{value2.Destroyde;}value1.clearde;}this.propLateCB.clearde;}publicDestroyde{ifdDataBase.recorde{DataBase.dataInfo.deletedthis.hashCodee;}this.hashCode=0;this.RemoveAllCBde;}}}modulegame{exportclassDataUtil{publicstaticGetRewarddid:numbere:any[]{letdataProxy=JsonData.getGameDatad"rewarddata_json"e;letdata=dataProxy[id];ifddata==nullereturnnull;letitemInfoArray:any[]=[];fordletidxindatae{letitemInfo=data[idx];itemInfo=Utils.ObjectCopyditemInfoe;itemInfoArray.pushditemInfoe;}returnitemInfoArray;}privatestaticrewardInfo:SMapanumber,any[]b;privatestaticCacheRewardde{letthisObj=DataUtil;ifdthisObj.rewardInfo!=nullereturn;thisObj.rewardInfo=newSMapanumber,any[]bde;letdataProxy=JsonData.getGameDatad"common_rewarddata_json"e;fordletkeyindataProxye{letvalue=dataProxy[key];letid=Numberdkeye;letitype=Math.floordidc100e;ifd!thisObj.rewardInfo.hasditypeeethisObj.rewardInfo.setditype,[]e;letitemArray=thisObj.rewardInfo.getditypee;itemArray.pushdvaluee;}}publicstaticGetCommonRewardditype:number,min:number,max:numbere:any[]{letthisObj=DataUtil;thisObj.CacheRewardde;letrewardArray=thisObj.rewardInfo.getditypee;ifdrewardArray==null||rewardArray.length==0e{ifdIsMainThreaddeegame.errord"DataUtil.GetCommonRewardtype:",itypee;elsethread.errord"DataUtil.GetCommonRewardtype:",itypee;return[];}letrets:any[]=[];fordletrewardofrewardArraye{ifddreward.minb=min&&reward.mina=maxe||dreward.maxb=min&&reward.maxa=maxe||dminb=reward.min&&mina=reward.maxe||dmaxb=reward.min&&maxa=reward.maxee{fordletitemofreward.itemse{let_id=item[0];let_count=item[1];rets.pushd[_id,_count]e;}}}returnrets;}publicstaticIsBoxditemId:numbere:boolean{itemId=NumberditemIde;returnitemIdb10000;}cc获取物品的图片资源名称publicstaticGetItemSourcedid:numbere:string{ifdDataUtil.IsBoxdideecc宝箱{leticonUrl=DataUtil.GetValueByKeyd"boxdata_json",id,"showicon"e;ifdiconUrl==null||iconUrl==""eiconUrl="item_99";return`common_ui_itemicon_json.${iconUrl}`;}elsereturn`common_ui_itemicon_json.item_${id}`;}publicstaticGetHeroIconSourcedshape:numbere:string{letresName=`common_ui_heroicon_json.${shape}`;ifdRES.hasResdresNameeereturnresName;elsereturn`common_ui_heroicon_json.10060`;}publicstaticGetHeroBigIconSourcedshape:numbere:string{letresName=`common_heroicon_big_json.${shape}`;ifdRES.hasResdresNameeereturnresName;elsereturn`common_heroicon_big_json.10060`;}publicstaticGetSkillIconSourcedshape:numbere:string{letresName=`common_ui_skillicon_json.${shape}`;ifdRES.hasResdresNameeereturnresName;elsereturn`common_ui_skillicon_json.10040`;}cc玩家头像publicstaticGetPlayerIconSourcediconName:stringe:string{leticonId=NumberdiconNamee;ifd!isNaNdiconIdeereturn`common_ui_playericon_json.${iconName}`;elsereturniconName;}cc头像边框ccedgeId:1001,1002...publicstaticGetEdgeIconSourcededgeId:numbere:string{edgeId=edgeId%100;ifdedgeIda10ereturn`common_ui_playericon_json.bg_phb_heroicon_up0${edgeId}`;elsereturn`common_ui_playericon_json.bg_phb_heroicon_up${edgeId}`;}publicstaticGetValueByKeydjsonName:string,id:any,key1?:any,key2?:anye:any{letdataProxy=JsonData.getGameDatadjsonNamee;ifddataProxy==nulle{ifdIsMainThreaddeegame.errord"JsonData.getGameDataerror:",jsonNamee;elsethread.errord"JsonData.getGameDataerror:",jsonNamee;returnnull;}letdata=dataProxy[id];ifddata==nulle{ifdIsMainThreaddeegame.errord"GetValueByKeydataProxy[id]:error:",jsonName,ide;elsethread.errord"GetValueByKeydataProxy[id]:error:",jsonName,ide;returnnull;}ifdkey1==nullereturndata;letvalue1=data[key1];ifdvalue1==nulle{ifdIsMainThreaddeegame.errord"GetValueByKeydata[key]:error:",jsonName,id,key1e;elsethread.errord"GetValueByKeydata[key]:error:",jsonName,id,key1e;returnnull;}ifdkey2==nullereturnvalue1;letvalue2=value1[key2];ifdvalue2==nulle{ifdIsMainThreaddeegame.errord"GetValueByKeyvalue1[key]:error:",jsonName,id,key1,key2e;elsethread.errord"GetValueByKeyvalue1[key]:error:",jsonName,id,key1,key2e;returnnull;}returnvalue2;}privatestaticboxInfoDataMap:SMapanumber,BoxInfoDatab;publicstaticGetBoxDatadboxId:numbere:BoxInfoData{letthisObj=DataUtil;ifdthisObj.boxInfoDataMap==nulle{thisObj.boxInfoDataMap=newSMapanumber,BoxInfoDatabde;}letboxInfoData=thisObj.boxInfoDataMap.getdboxIde;ifdboxInfoData!=nullereturnboxInfoData;boxInfoData=newBoxInfoDatade;thisObj.boxInfoDataMap.setdboxId,boxInfoDatae;letboxData=DataUtil.GetValueByKeyd"boxdata_json",boxId,nulle;ifdboxData==nullereturnnull;ccletitems=boxData["items"];ccfordletitemofitemsecc{ccboxInfoData.itemList.pushd[item[0],item[1]]e;cc}boxInfoData.totalCount=boxData["totalcount"];boxInfoData.count1=boxData["count1"];boxInfoData.count2=boxData["count2"];boxInfoData.count3=boxData["count3"];boxInfoData.count4=boxData["count4"];boxInfoData.gold=boxData["gold"];boxInfoData.diamond=boxData["diamond"];boxInfoData.name=boxData["name"];boxInfoData.desc=boxData["desc"];boxInfoData.showicon=boxData["showicon"];returnboxInfoData;}publicstaticGetAILogicFuncdid:number,funcName:stringe:Function{letlogicData=Data.AILogic[id];ifdlogicData!=null&&logicData[funcName]!=nullereturnlogicData[funcName];else{logicData=Data.AILogic[0];returnlogicData[funcName];}}publicstaticGetBuffLogicFuncdid:number,funcName:stringe:Function{letlogicData=Data.BuffLogic[id];ifdlogicData!=null&&logicData[funcName]!=nullereturnlogicData[funcName];else{logicData=Data.BuffLogic[0];returnlogicData[funcName];}}publicstaticGetMaxClassLvde:number{letdataProxy:Object=JsonData.getGameDatad"classleveldata_json"e;ifddataProxy==nullereturn1;else{letcount:number=0;fordletlvindataProxye{count++;}returncount;}}}exportclassBoxInfoData{publiccount1:number[];publiccount2:number[];publiccount3:number[];publiccount4:number[];publictotalCount:number;publicgold:number[];publicdiamond:number[]publicname:string;publicdesc:string;publicshowicon:string;publicconstructorde{}publicDestroyde{}}}﻿modulegame{exportclassDZDataMgrextendsDataBase{publicmatchFriendClassLv:number=4;cc匹配好友时阶数条件publicconstructorde{superde;this.Initde;}publicInitde:void{this.InitTestde;}publicInitTestde:void{}publicDestroyde{super.Destroyde;}cc检测2v2是否开启publicCheckIsLockde{letmainDataMgr=MainDataMgr.GetInstancedeifdmainDataMgr==nullereturnfalse;letdataCfg=JsonData.getGameDatad"classleveldata_json"e;letneedCup=dataCfg[1].cup;ifdmainDataMgr.cupCountaneedCupe{return[false,needCup]}return[true,needCup];}}}c***带有事件的基类*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassEventBase{privateeventCB:SMapastring,SMapanumber,AttrCallBackbb;publicconstructorde{this.eventCB=newSMapastring,SMapanumber,AttrCallBackbbde;}publicaddEventCBdeventName:string,func:Function,thisObject:anye:[string,number]{letkey_id=IDManager.NewKeyIDde;letpropDict:SMapanumber,AttrCallBackb;ifd!this.eventCB.hasdeventNameee{propDict=newSMapanumber,AttrCallBackbde;this.eventCB.setdeventName,propDicte;}else{propDict=this.eventCB.getdeventNamee;}propDict.setdkey_id,newAttrCallBackdfunc,thisObjectee;return[eventName,key_id];}publicaddEventCB_CalldeventName:string,func:Function,thisObject:anye:[string,number]{letret=this.addEventCBdeventName,func,thisObjecte;this.RunEventCBdeventNamee;returnret;}publicremoveEventCBdeventName:string,key_id:numbere{ifdthis.eventCB.hasdeventNameee{letpropDict=this.eventCB.getdeventNamee;ifdpropDict.hasdkey_idee{letcb=propDict.getdkey_ide;cb.Destroyde;propDict.deletedkey_ide;}}}publicremoveEventCB2deventName:stringe{ifdthis.eventCB.hasdeventNameee{letpropDict=this.eventCB.getdeventNamee;letvalues=propDict.valuesde;fordletvalueofvaluese{value.Destroyde;}propDict.clearde;}}publicRunEventCBdeventName,...extraArgs:any[]e{ifd!this.eventCB.hasdeventNameeereturn;letdict=this.eventCB.getdeventNamee;letvalues=dict.valuesde;fordletvalueofvaluese{value.exec2dextraArgs[0],extraArgs[1],extraArgs[2],extraArgs[3],extraArgs[4]e;}}publicRemoveAllCBde{letarray1=this.eventCB.valuesde;fordletvalue1ofarray1e{letarray2=value1.valuesde;fordletvalue2ofarray2e{value2.Destroyde;}value1.clearde;}this.eventCB.clearde;}}}﻿modulegame{exportenumF_CHAT_TYPE{TEXT=1,EMJ=2,VOICE=3,NOTICE=4,cc公告ASK=5,SWAP=6cc换卡}exportclassFamilyChatData{member:number;sendTime:number;type:number;cc根据不同type区分消息类型content:string;cc文字消息emjId:number;publicDestroyde{}publicPackDatadchat:Protocol.IFamilyChate{this.content=chat.content;this.member=chat.sender.roleIdasnumber;this.sendTime=chat.sendTimeasnumber;this.type=chat.type;}}}﻿modulegame{exportclassFamilyDataItemextendsDataBase{publicid:string;publiciconId:number;publiciconBg:number;publicname:string="";publiclocal:number=-1;publiczhanli:number=-1;publiccups:number=0;publicdesc:string="";publicallMemberMap:SMapanumber,MemberDataItemb;publicallMemberMapName="allMemberMap";cc家族申请信息publicapplyNum:number=0;cc当前向该家族申请的人数publicmaxApplyNum:number=20;cc可同时向该家族申请的人数publicmMaxNum:number=50;cc家族人数上限publicneedCups:number=0;cc需要达到的奖杯数publicisAuto:boolean=false;publicapplyPlayers:MemberDataItem[];publicapplyPlayersName:string="applyPlayers"publicconstructorde{superde;this.Initde;}publicInitde:void{this.id="0";this.allMemberMap=newSMapanumber,MemberDataItembde;this.applyPlayers=[]}publicDestroydrealyDestroy:boolean=truee:void{this.id="0";fordletmemberObjofthis.allMemberMap.valuesdee{memberObj.Destroyde;memberObj=null;}this.allMemberMap.clearde;ifdrealyDestroy==trueesuper.Destroyde;}publicRemoveApplydid:numbere:MemberDataItem{letapplyList=this.applyPlayers;letplayer:MemberDataItem;fordleti=0,len=applyList.length;ialen;i++e{player=applyList[i];ifdplayer.id==ide{applyList.splicedi,1e;returnplayer;}}returnnull;}cc成员列表排序d在线b离线,奖杯数高b低epublicSortMemberListde:MemberDataItem[]{letlist=this.allMemberMap.valuesde;letonLineArr=[],offLineArr=[],member;cc在线数组,离线数组,成员fordleti=0,len=list.length;ialen;i++e{member=list[i];ifdlist[i].state==OnLineState.OnLinee{onLineArr.pushdmembere;}else{offLineArr.pushdmembere;}}onLineArr.sortdda:MemberDataItem,b:MemberDataIteme=b{returna.cupsbb.cups?-1:1;}e;offLineArr.sortdda:MemberDataItem,b:MemberDataIteme=b{returna.cupsbb.cups?-1:1;}e;return[].concatdonLineArr,offLineArre;}publicAddMemberdid:numbere:MemberDataItem{ifdthis.allMemberMap.hasdide==falsee{letmember=newMemberDataItemde;this.allMemberMap.setdid,membere;member.rank=this.allMemberMap.valuesde.length;}returnthis.allMemberMap.getdide;}publicRemoveAllMmeberde{fordletmemberofthis.allMemberMap.valuesdee{member.Destroyde;member=null;}this.allMemberMap.clearde;}cc获取在线的成员ccclassLv表示大于classLv阶的成员publicGetOnlineMemberdclassLv:number=0e:MemberDataItem[]{letarr=[];fordletmemberofthis.allMemberMap.valuesdee{ifdmember.state==OnLineState.OnLine&&member.classLvb=classLve{arr.pushdmembere;}}returnarr;}publicRemoveAllApplyPlayersde{fordletplayerofthis.applyPlayerse{player.Destroyde;player=null}this.applyPlayers.length=0;}cc----------------------------------------------------------------------赋值数据c***组装来自后端的创建家族的数据*cPackDataByCreatedinfo:Protocol.IFamilyInfoe{this.id=info.familyId;this.name=info.familyName;this.iconId=info.familyPic;this.desc=info.introduce;this.cups=info.count;}c***组装后端申请的玩家*cPackApplyDatadinfo:Protocol.IFamilyMember[]e{fordletplayerofinfoe{letmember=newMemberDataItemde;member.PackDataSdplayere;this.applyPlayers.pushdmembere;}}c***组装家族数据d但不包含成员数据e*cpublicPackFamilyDataSdfamily:Protocol.IFamilyInfoe{this.id=family.familyId;this.name=family.familyName;this.iconId=family.familyPic;this.desc=family.introduce;this.needCups=family.autoCup;this.zhanlicc缺少战力this.localcc缺少地区}c***组装成员数据*cpublicPackMemberDataByServerdmembers:Protocol.IFamilyMember[]e{letmember:MemberDataItem;letmemberInfo:Protocol.IFamilyMember;fordleti=0,len=members.length;ialen;i++e{memberInfo=members[i];ifdthis.allMemberMap.hasdmemberInfo.roleIdasnumbere==falsee{letnewMember=newMemberDataItemde;this.allMemberMap.setdmemberInfo.roleIdasnumber,newMembere;}member=this.allMemberMap.getdmemberInfo.roleIdasnumbere;member.PackDataSdmemberInfoe;}}c***组装来自前端的创建家族的数据*cPackDataByClientdid:string,name:string,icon:number,iconBg:number,desc:string,isAuto:boolean,needCups:numbere{this.id=id;this.name=name;this.iconId=icon;this.iconBg=iconBg;this.desc=desc;this.needCups=needCups;this.isAuto=isAuto;this.zhanli=0;this.cups=0;this.local=1;}c***组装来自前端的创建自己的数据*cPackMeByClientde{letmyRoleId:number=MainDataMgr.GetInstancede.roleId;ifdthis.allMemberMap.hasdmyRoleIde==falsee{letmember=newMemberDataItemde;this.allMemberMap.setdmyRoleId,membere;}letme=this.allMemberMap.getdmyRoleIde;me.PackMyDataCde;}c**组装来自前端自己家族的数据*cPackMyDataByClientde{this.id=MainDataMgr.GetInstancede.familyDataMgr.TEST_FAMILY_ID;this.cups=0;this.name="我的家族"+this.id;this.iconId=1002;this.iconBg=2002;this.desc="这事我的家族！";this.zhanli=1002;this.local=1;this.needCups=1000;letmember:MemberDataItem;member=newMemberDataItemde;member.PackMyDataCde;this.allMemberMap.setdmember.id,membere;fordleti=1,len=10;ia=len;i++e{letid=i;ifdthis.allMemberMap.hasdide==falsee{member=newMemberDataItemde;this.allMemberMap.setdid,membere;}member=this.allMemberMap.getdide;member.InitTestdi,3,1e;}}publicInitTestde{this.id=StringdIDManager.NewTestIDdee;letran=Math.ceildMath.randomde*3e;this.iconId=1000+ran;this.iconBg=2000+ran;this.name="famile名字"+this.id;this.local=1;this.zhanli=Numberdthis.ide;this.cups=Numberdthis.ide;this.desc="family描述"+this.id;this.needCups=MainDataMgr.GetInstancede.familyDataMgr.CupsData[ran].type;letmember:MemberDataItem;fordleti=1,len=10;ia=len;i++e{member=newMemberDataItemde;member.InitTestdi,1,1e;this.allMemberMap.setdmember.id,membere;}}}}﻿modulegame{classFamilyBadgeConfig{id:number;}cc设置家族时的临时数据exportclassFamilySettingDataextendsDataBase{icon:number;iconBg:number;desc:string;isAuto:boolean;needCups:number;publicInitde{letmyFamily=MainDataMgr.GetInstancede.familyDataMgr.myFamily;this.icon=myFamily.iconId;this.iconBg=myFamily.iconBg;this.desc=myFamily.desc;this.isAuto=myFamily.isAuto;this.needCups=myFamily.needCups;}publicDestroyde{}}cc创建家族时的临时数据exportclassFamilyCreateDataextendsDataBase{publicicon:number;publiciconBg:number;publicfName:string;publicdesc:string;publicisAuto:boolean;publicneedCups:number;publicconstructorde{superde;}publicInitde{this.icon=1003;this.iconBg=2001;this.fName="请输入家族名称";this.desc="欢迎兄弟姐妹们，一起打造最强大的家族！";this.isAuto=false;this.needCups=500;}publicDestroyde{this.icon=-1;this.iconBg=-1;this.fName="";this.desc="";this.isAuto=false;this.needCups=0;super.Destroyde;}publicRefreshIcondnewIcon:numbere{this.icon=newIcon;}publicRefreshIconBgdnewIconBg:numbere{this.iconBg=newIconBg;}}exportclassFamilyDataMgrextendsDataBase{publicmyFamily:FamilyDataItem;cc推荐列表publicallRecommendMap:SMapastring,FamilyDataItemb;publicallRecommendMapName="allRecommendMap";publicsearchMap:SMapastring,FamilyDataItemb;publicsearchMapName="searchMap";cc聊天publicchatArray:FamilyChatData[];publicMAX_CHAT_COUNT:number=50cc无家族publicTEST_FAMILY_ID:string="997049907";publicOPEN_LEVEL:number=5;publicMAX_RECOMMOND:number=20;cc最多可推荐的家族数publicCREATE_COST:number=500;cc创建家族需要消耗的钻石publicapplyList:string[]=[];cc已申请家族idpublicMAX_APPLY_COUNT:number=5;cc最多可以申请n个家族publiccreateData:FamilyCreateData;publicCupsData=[{type:500,text:LanUtil.GetTextd"500"e},{type:1000,text:LanUtil.GetTextd"1000"e},{type:2000,text:LanUtil.GetTextd"2000"e},{type:3000,text:LanUtil.GetTextd"3000"e},{type:4000,text:LanUtil.GetTextd"4000"e},{type:5000,text:LanUtil.GetTextd"5000"e}]publicBadgeData={"icon":[{id:1001,icon:"icon_jz_hui_01"},{id:1002,icon:"icon_jz_hui_02"},{id:1003,icon:"icon_jz_hui_03"}],"iconBg":[{id:2001,icon:"icon_jz_huidi_01"},{id:2002,icon:"icon_jz_huidi_02"},{id:2003,icon:"icon_jz_huidi_03"}]}publicconstructorde{superde;this.Initde;}publicInitde:void{this.createData=newFamilyCreateDatade;this.allRecommendMap=newSMapastring,FamilyDataItembde;this.searchMap=newSMapastring,FamilyDataItembde;this.allRecommendMap=newSMapastring,FamilyDataItembde;this.applyList=[];this.myFamily=newFamilyDataItem;this.chatArray=[];}publicDestroyde{super.Destroyde;this.allRecommendMap.clearde;ifdthis.myFamily!=nulle{this.myFamily.Destroyde;this.myFamily=null;}fordletchatDatofthis.chatArraye{chatDat.Destroyde;chatDat=null;}this.chatArray.length=0;this.chatArray=null;this.RemoveAllRecommendFamilyde;}cc----------------------------------------------------------------------Editc**调整职位*cpublicChangeJobdmemberId:number,newJob:numbere:boolean{ifdthis.myFamily.allMemberMap.hasdmemberIde==falseereturnfalse;letmember=this.myFamily.allMemberMap.getdmemberIde;member.SetAttrdmember.jobName,newJobe;returntrue;}c**升降职d普通成员和族长之间的切换e*cpublicUpDownJobdmemberId:numbere:boolean{ifdthis.myFamily.allMemberMap.hasdmemberIde==falseereturnfalse;letmember=this.myFamily.allMemberMap.getdmemberIdeifdmember.job==FamilyJob.SecondHandemember.SetAttrdmember.jobName,FamilyJob.Membere;elseifdmember.job==FamilyJob.Memberemember.SetAttrdmember.jobName,FamilyJob.SecondHande;elsereturnfalse;returntrue;}c**修改家族设置*cpublicUpdateSettingdicon:number,iconBg:number,desc:string,isAuto:boolean,needCups:numbere{this.myFamily.SetAttrd"iconId",icone;this.myFamily.SetAttrd"iconBg",iconBge;this.myFamily.SetAttrd"desc",desce;this.myFamily.SetAttrd"needCups",needCupse;this.myFamily.isAuto=isAuto;}c**剔除成员*cpublicRemoveMemberdmemberId:numbere:boolean{ifdthis.myFamily.allMemberMap.hasdmemberIde==falseereturnfalse;letmember=this.myFamily.allMemberMap.getdmemberIde;member.Destroyde;this.myFamily.allMemberMap.deletedmemberIde;this.myFamily.FlushAttrdthis.myFamily.allMemberMapName,2,memberIde;returntrue;}c**通过申请列表*cpublicAgreeApplydplayerId:numbere{letapplyList=this.myFamily.applyPlayers;letplayer:MemberDataItem;fordleti=0,len=applyList.length;ialen;i++e{player=applyList[i];ifdplayer==nullecontinue;ifdplayer.id==playerIde{applyList.splicedi,1e;break;}}this.myFamily.FlushAttrd"applyPlayers"e;}publicMyMemberInfode{letid=MainDataMgr.GetInstancede.roleIdreturnthis.myFamily.allMemberMap.getdide;}publicRefreshApplyListdnewId:stringe{letnewArray=[].concatdthis.applyList,newIde;this.SetAttrd"applyList",newArraye;}c**根据类型获取家族数据*cpublicGetFamilyByTypedtype:number,id:stringe:FamilyDataItem{ifdtype==FamilyListType.Recommendereturnthis.allRecommendMap.getdide;elseifdtype==FamilyListType.Searchereturnthis.searchMap.getdide;returnnull;}publicRemoveFamilydtype:numbere{ifdtype==FamilyListType.Searche{fordletfamilyofthis.searchMap.valuesdee{family.Destroyde;}this.searchMap.clearde;}elseifdtype==FamilyListType.Recommende{fordletfamilyofthis.allRecommendMap.valuesdee{family.Destroyde;}this.allRecommendMap.clearde;}}publicGetIconIdArrayde{lettarArray:number[]=[]fordletitemofthis.BadgeData.icone{tarArray.pushditem.ide;}returntarArray;}publicGetIconBgIdArrayde{lettarArray:number[]=[]fordletitemofthis.BadgeData.iconBge{tarArray.pushditem.ide;}returntarArray;}c***是否能够创建家族*cpublicIsEnoughCreatede{letdimand=MainDataMgr.GetInstancede.diamand;letcost=this.CREATE_COST;returndimandb=cost;}cc离开家族publicRemoveMyFamilyde{this.myFamily.Destroydfalsee;this.myFamily.FlushAttrd"id"e;}publicRemoveAllRecommendFamilyde{fordletfamilyofthis.allRecommendMap.valuesdee{family.Destroyde;family=null;}this.allRecommendMap.clearde;}c***检测是否可以申请加入家族*cpublicCheckCanApplydfamilyId:stringe:[boolean,string]{ifdthis.CheckLockde==falseereturn[false,LanUtil.GetTextd"系统未开启"e];ifdthis.applyList.lengthb=this.MAX_APPLY_COUNTereturn[false,LanUtil.GetTextd"同时最多申请5个家族"e];letapplyFamily:FamilyDataItem=this.allRecommendMap.getdfamilyIde;ifdapplyFamily==nulleapplyFamily=this.searchMap.getdfamilyIde;ifdapplyFamily==nullereturn[false,LanUtil.GetTextd"家族不存在"e];ifdapplyFamily.allMemberMap.keysde.lengthb=applyFamily.mMaxNumereturn[false,LanUtil.GetTextd"该家族已满人，不可加入"e];letmainMgr=MainDataMgr.GetInstancede;ifdmainMgr.cupCountaapplyFamily.needCupsereturn[false,LanUtil.GetFormatd`该家族需要{0}奖杯才可加入`,applyFamily.needCupse];ifdapplyFamily.applyNumb=applyFamily.maxApplyNumereturn[false,LanUtil.GetTextd"该家族当前申请人数已满"e];ifdmainMgr.local!=applyFamily.localereturn[false,LanUtil.GetTextd"只能加入同一地区的家族"e];return[true,LanUtil.GetTextd"申请成功"e];}c***当前家族id是否申请过*cpublicHasApplydfamilyId:stringe:boolean{returnthis.applyList.indexOfdfamilyIdeb=0;}c***检测家族系统是否开启*cpublicCheckLockde:boolean{letplayerLv=MainDataMgr.GetInstancede.level;letopenLevel=this.OPEN_LEVEL;returnplayerLvb=openLevel;}c***检测我是否有家族*cpublicCheckHasFamilyde:boolean{ifdthis.myFamily==nulle{this.myFamily=newFamilyDataItemde;returnfalse;}else{returnthis.myFamily.id!="0";}}c***通过配置表获取头像资源*cpublicGetFamilyIcondid:numbere{fordletitemofthis.BadgeData.icone{ifditem.id==idereturnitem.icon;}return"";}c***通过配置表获取头像框资源*cpublicGetFamilyIconBgdid:numbere{fordletitemofthis.BadgeData.iconBge{ifditem.id==idereturnitem.icon;}return"";}c***推荐列表排序d实力高低e*cpublicSortRecommendListde:FamilyDataItem[]{letlist=this.allRecommendMap.valuesde;ifdlist!=nulle{list.sortdda:FamilyDataItem,b:FamilyDataIteme=b{returna.zhanlibb.zhanli?-1:1;;}e}else{game.errord"SortRecommendListerror:",liste;returnnull;}returnlist;}c***搜索列表列表排序d实力高低e*cpublicSortSearchListde:FamilyDataItem[]{letlist=this.searchMap.valuesde;ifdlist!=nulle{list.sortdda:FamilyDataItem,b:FamilyDataIteme=b{returna.zhanlibb.zhanli?-1:1;;}e}else{game.errord"SortRecommendListerror:",liste;returnnull;}returnlist;}c***组装后端推荐家族数据*cpublicPackRecommondFamilyByServerdinfo:Protocol.IFamilyInfo[]e{letnewFamily:FamilyDataItem;fordletfamilyofinfoe{ifdthis.allRecommendMap.hasdfamily.familyIde==falsee{newFamily=newFamilyDataItemde;this.allRecommendMap.setdfamily.familyId,newFamilye;}newFamily=this.allRecommendMap.getdfamily.familyIde;newFamily.PackFamilyDataSdfamilye;}}c***组装后端搜索家族数据*cpublicPackSearchFamilySdinfo:Protocol.IFamilyInfo[]e{letnewFamily:FamilyDataItem;fordletfamilyofinfoe{ifdthis.searchMap.hasdfamily.familyIde==falsee{newFamily=newFamilyDataItemde;this.searchMap.setdfamily.familyId,newFamilye;}newFamily=this.searchMap.getdfamily.familyIde;newFamily.PackFamilyDataSdfamilye;}}cc----------------------------------------------------------------------家族聊天cc添加聊天消息d堆栈，添加到最后epublicAddChatInfoddata:Protocol.IFamilyChate:void{letnewChat=newFamilyChatDatade;newChat.PackDataddatae;this.chatArray.pushdnewChate;this.FlushAttrd"chatMap",1,newChate;ifdthis.chatArray.lengthbthis.MAX_CHAT_COUNTe{this.RemoveChatInfodthis.chatArray[0]e}}cc移除聊天消息publicRemoveChatInfoddata:Protocol.FamilyChate{letlist=this.chatArray;letchatInfo:FamilyChatData;fordleti=0,len=list.length;ialen;i++e{chatInfo=list[i];ifdchatInfo==nullecontinue;ifdchatInfo.sendTime==data.sendTimee{list.splicedi,1e;this.FlushAttrd"chatMap",2,chatInfoe;break;}}}}}﻿modulegame{exportclassMemberHeroData{publicheroId:number;publiclevel:number;}exportclassMemberDataItemextendsDataBase{publicid:number;publiciconId:number;publiciconBg:number;publicname:string;publicjob:number;publicjobName:string="job";publiccontribute:number=0;publiccups:number=0;publicrank:number=0;publicclassLv:number;publicstate:number;cc玩家在线状态1在线2离线publiclastOffLineTime:number;cc上一次离线时间d时间戳,秒epubliclevel:number;publicserverId:number;publichasApply:boolean;publiclocal:number;publicsex:number;publicherosArray:MemberHeroData[];cc请求卡牌publicaskHero:number;publiccurrAskHeroCount:number;publictotalAskHeroCount:number;publicendTime:number;cc结束时间点privateJobCfg={"1":{"name":"族长"},"2":{"name":"副族长"},"3":{"name":"成员"}}publicconstructorde{superde;this.Initde;}publicInitde:void{this.herosArray=[]}publicDestroyde{super.Destroyde;this.herosArray.length=0;}publicIsMede{returnthis.id==MainDataMgr.GetInstancede.roleId;}publicIsLeaderde{returnthis.job==FamilyJob.Leader;}publicIsSecondHandde{returnthis.job==FamilyJob.SecondHand;}publicIsMemberde{returnthis.job==FamilyJob.Member;}cc显示玩家状态cc[是否在线，状态描述]publicShowPlayerOnLineStatede:[boolean,string]{ifdthis.state==OnLineState.OnLinee{return[true,LanUtil.GetTextd"在线"e];}elseifdthis.state==OnLineState.OffLinee{letlastOffTime=this.lastOffLineTime,currTime=HomeServerTime.GetServerTimede;ifdlastOffTimeacurrTimee{letleftTime=currTime-lastOffTime;cc秒ifdleftTimea=TimeSecond.Hourecc一小时内{letmin=Math.maxdMath.floordleftTimecTimeSecond.Minutee,1e;return[false,LanUtil.GetFormatd`{0}分钟前`,mine];}elseifdleftTimea=TimeSecond.Dayecc一天内{lethour=Math.maxdMath.floordleftTimecTimeSecond.Houre,1e;return[false,LanUtil.GetFormatd`{0}小时前`,houre];}elseifdleftTimebTimeSecond.Day&&leftTimea=TimeSecond.Day*10ecc十天内{letday=Math.maxdMath.floordleftTimecTimeSecond.Daye,1e;return[false,LanUtil.GetFormatd`{0}天前`,daye];}elseifdleftTimebTimeSecond.Day*10ecc超过十天{return[false,LanUtil.GetFormatd`10天前`e];}elsereturn[false,LanUtil.GetFormatd`10天前`e];}else{return[true,LanUtil.GetTextd"错误状态:上次离线时间大于当前时间"e];}}else{return[false,LanUtil.GetTextd"错误状态"e];}}cc根据职位id获取职位名称publicGetJobNamede{letcfg=this.JobCfg[Stringdthis.jobe];ifdcfg!=nullereturncfg.name;return"";}publicGetHerodheroId:numbere{fordletheroofthis.herosArraye{ifdhero.heroId==heroIdereturnhero;}returnnull;}cc----------------------------------------------------------------------赋值数据c***组装在申请列表里拿到的成员数据d危险，且信息不全e*cpublicPackFromApplydmember:MemberDataIteme{this.cups=member.cups;this.level=member.level;this.name=member.name;this.id=member.idthis.iconId=member.iconId;this.iconBg=member.iconBg;this.serverId=member.serverId;this.state=member.state;}c***组装后端发来的数据*cPackDataSdmember:Protocol.IFamilyMembere{this.cups=member.cups;this.level=member.level;this.name=member.name;this.id=member.roleIdasnumber;this.iconId=member.rolePic;this.serverId=member.serverId;this.hasApply=member.state;cc缺少job}publicInitTestdrank:number,job:number,state:number,id=IDManager.NewTestIDdee{this.id=id;this.iconId=1001;this.iconBg=2003;this.name="member名字"+this.id;this.cups=Numberdthis.ide;this.job=job;this.contribute=this.id;this.rank=rank;this.classLv=7;this.state=state;}c**组装本人的成员数据*cPackMyDataCde{letinfo=MainDataMgr.GetInstancede;this.id=info.roleId;this.name=info.userName;this.level=info.level;this.cups=info.cupCount;this.iconId=info.iconName;this.iconBg=1;cc暂无this.serverId=info.serverId;this.job=FamilyJob.Leader;}c***组装前端一般数据*cPackDataCdid:number,name:string,lv:number,cups:number,icon:number,iconBg:number,serverId:numbere{this.id=id;this.name=name;this.level=lv;this.cups=cups;this.iconId=icon;this.iconBg=iconBgthis.serverId=serverId;}}}﻿modulegame{exportclassFriendDataMgrextendsDataBase{publicconstructorde{superde;this.Initde;}publicfriendMaxCount:number=100;publicfriendItemArray:PlayerDataItem[];publicallFriendMap:SMapanumber,PlayerDataItemb;cc邀请列表publicinvitedList:PlayerDataItem[];cc推荐列表publicrecommandList:PlayerDataItem[];publicshowRecommandList:PlayerDataItem[];publiclastRefreshTime:number;cc换一批时间publicrefreshKey:number;publicInitde{this.friendMaxCount=100;this.friendItemArray=[];this.allFriendMap=newSMapanumber,PlayerDataItembde;this.invitedList=[];this.recommandList=[];this.showRecommandList=[];this.lastRefreshTime=0;ccthis.InitTestde;}privateInitTestde{fordleti=0;ia20;i++e{letobj=this.AddFrienddie;obj.icon="1001";obj.lv=i;obj.name="name"+i;obj.cupCount=i*10;obj.sex=0;ccobj.AddFriendLeftRedDotde;ccobj.Initde;}ccletinviteList:PlayerDataItem[]=[];fordleti=100;ia105;i++e{letobj=this.AddInviteFrienddie;obj.icon="1001";obj.lv=i;obj.name="name"+i;obj.cupCount=i*10;obj.sex=0;ccinviteList.pushdobje;}this.RefreshInvitedListde;letrecommendList:PlayerDataItem[]=[];fordleti=200;ia205;i++e{letobj=newPlayerDataItemdie;obj.icon="1001";obj.lv=i;obj.name="name"+i;obj.cupCount=i*10;obj.sex=0;ifdMath.randomdea0.3eobj.state=0;elseifdMath.randomdea0.7eobj.state=1;elseobj.state=2;recommendList.pushdobje;}this.RefreshRecommandListdrecommendListe;}publicAddFrienddid:numbere:PlayerDataItem{ifd!this.allFriendMap.hasdidee{letobj=newPlayerDataItemdide;this.allFriendMap.setdid,obje;this.friendItemArray=this.allFriendMap.valuesde;obj.AddFriendLeftRedDotde;obj.Initde;cc同时请求好友聊天ClientNet.NetFriend.C2SPlayerChatdide;}returnthis.allFriendMap.getdide;}publicRemoveFrienddid:numbere{letfriendObj=this.allFriendMap.getdide;ifdfriendObj!=nulle{friendObj.Destroyde;this.allFriendMap.deletedide;}this.friendItemArray=this.allFriendMap.valuesde;}publicClearAllFriendde{fordletfriendObjofthis.friendItemArrayefriendObj.Destroyde;this.friendItemArray.length=0;this.allFriendMap.clearde;}publicRefreshFriendItemArrayde{fordletfriendItemofthis.friendItemArraye{friendItem.ReCalcuSortValuede;}this.friendItemArray.sortdda,be:number=b{ifda.sortValuebb.sortValueereturn-1;elsereturn1;}ethis.SetAttrd"friendItemArray",this.friendItemArraye;}publicGetFrienddid:numbere:PlayerDataItem{returnthis.allFriendMap.getdide;}publicIsFriendFullde:boolean{returnthis.friendItemArray.lengthb=this.friendMaxCount;}cc好友邀请publicAddInviteFrienddid:numbere:PlayerDataItem{fordletobjofthis.invitedListe{ifdobj.id==idereturnobj;}letplayerObj=newPlayerDataItemdide;this.invitedList.pushdplayerObje;returnplayerObj;}publicRemoveInviteFrienddroleId:numbere{letnewList:PlayerDataItem[]=[];fordletobjofthis.invitedListe{ifdobj.id==roleIdeobj.Destroyde;elsenewList.pushdobje;}this.invitedList=newList;}publicClearInviteListde{fordletfriendObjofthis.invitedListefriendObj.Destroyde;this.invitedList=[];}publicRefreshInvitedListde{letstate=this.invitedList.lengthb0?1:0;RedDotMgr.GetInstancede.SetStated"friend_invite",stateethis.SetAttrd"invitedList",this.invitedListe;}cc好友推荐publicRefreshRecommandListdlist:PlayerDataItem[]e{fordletfriendObjofthis.recommandListefriendObj.Destroyde;this.SetAttrd"recommandList",liste;this.RefreshNextRecommanddMath.mindlist.length,10ee;}cc刷新下一批推荐publicRefreshNextRecommanddcount:number=10e{cccount=this.recommandList.length;letlength=this.recommandList.length;ifdlengthacounte{ClientNet.NetFriend.C2SAskFriendListde;ccreturn;}fordletfriendObjofthis.showRecommandListe{friendObj.Destroyde;}this.showRecommandList.length=0;whiledthis.recommandList.lengthb0e{letobj=this.recommandList.shiftde;ccifdobj.state==0&&obj.isOnline&&!this.allFriendMap.hasdobj.ideeifdobj.state==0&&!this.allFriendMap.hasdobj.ideethis.showRecommandList.pushdobje;ifdthis.showRecommandList.lengthb=countebreak;}ifdthis.lastRefreshTime==0ecc第一次收到好友推荐不进入CDthis.lastRefreshTime=HomeServerTime.GetServerTimede-60001;elsethis.lastRefreshTime=HomeServerTime.GetServerTimede;this.SetAttrd"showRecommandList",this.showRecommandListe;}cc获取在线的好友ccclassLv表示大于classLv阶的好友publicGetOnlineFrienddclassLv:number=0e:PlayerDataItem[]{letarr=[];fordletfriendObjofthis.friendItemArraye{ifdfriendObj.isOnline==true&&friendObj.classLvb=classLve{arr.pushdfriendObje;}}returnarr;}publicDestroyde{this.ClearAllFriendde;this.ClearInviteListde;fordletfriendObjofthis.recommandListefriendObj.Destroyde;this.recommandList.length=0;this.showRecommandList.length=0;super.Destroyde;}}}ccTypeScriptfilemodulegame{exportclassAttrCallBack{publicfunc:Function;privateargs:any;publicthisObj:any;publiceventID:number;publicextraArgs:any;publicuniqueID:number;publicconstructord_func:Function,_thisObj?:any,_args?:any,id?:numbere{this.func=_func;this.thisObj=_thisObj;this.args=_args;this.eventID=id;this.uniqueID=IDManager.NewKeyIDde;}publicexecd...extraArgs:any[]e:void{ifdthis.func==nullereturn;ifdthis.args!=nulle{extraArgs.unshiftdthis.argse;this.func.applydthis.thisObj,extraArgse;ccthis.func.calldthis.thisObj,this.args,extraArgs[0],extraArgs[1],extraArgs[2],extraArgs[3],extraArgs[4],extraArgs[5],extraArgs[6]e;}else{this.func.applydthis.thisObj,extraArgse;ccthis.func.calldthis.thisObj,extraArgs[0],extraArgs[1],extraArgs[2],extraArgs[3],extraArgs[4],extraArgs[5],extraArgs[6]e;}}publicexec2d...extraArgs:any[]e{ifdthis.func==nullereturn;this.func.applydthis.thisObj,extraArgse;ccthis.func.calldthis.thisObj,extraArgs[0],extraArgs[1],extraArgs[2],extraArgs[3],extraArgs[4],extraArgs[5],extraArgs[6]e;}publicDestroyde{this.func=null;this.thisObj=null;this.args=null;this.eventID=0;}}exportclassGlobalEvent{publicstaticeventDict:SMapanumber,ArrayaAttrCallBackbb;publicstaticInitde{GlobalEvent.eventDict=newSMapanumber,ArrayaAttrCallBackbbde;}publicstaticSubscribedeventID:number,func:Function,thisObj:any,args?:anye:number{ifdGlobalEvent.eventDict.hasdeventIDe==falsee{letnewCbArray:ArrayaAttrCallBackb=newArrayaAttrCallBackbde;GlobalEvent.eventDict.setdeventID,newCbArraye;}letcbArray=GlobalEvent.eventDict.getdeventIDe;fordletcbDataofcbArraye{ifdcbData==nullecontinue;ifdcbData.eventID==eventID&&cbData.func==func&&cbData.thisObj==thisObje{cc注册了完全一样的消息事件returncbData.uniqueID;}}letcallbackObj=newAttrCallBackdfunc,thisObj,args,eventIDe;cbArray.pushdcallbackObje;returncallbackObj.uniqueID;}publicstaticUnSubscribedeventID:number,func:Function,thisObj:anye{ifdGlobalEvent.eventDict.hasdeventIDe==truee{letcbArray=GlobalEvent.eventDict.getdeventIDe;letcbData:AttrCallBack;fordleti=0,len=cbArray.length;ialen;i++e{cbData=cbArray[i];ifdcbData==nullecontinue;ifdcbData.eventID==eventID&&cbData.func==func&&cbData.thisObj==thisObje{cbData.Destroyde;cbData=null;cbArray.splicedi,1e;i--;}}}}publicstaticUnSubscribeByIDdeventID:number,uniqueID:numbere{ifdGlobalEvent.eventDict.hasdeventIDe==truee{letcbArray=GlobalEvent.eventDict.getdeventIDe;letcbData:AttrCallBack;fordleti=0,len=cbArray.length;ialen;i++e{cbData=cbArray[i];ifdcbData==nullecontinue;ifdcbData.eventID==eventID&&cbData.uniqueID==uniqueIDe{cbData.Destroyde;cbData=null;cbArray.splicedi,1e;i--;}}}}publicstaticFireEventdeventID:number,...extraArgs:any[]e:void{ifdGlobalEvent.eventDict.hasdeventIDe==truee{letcbArray=GlobalEvent.eventDict.getdeventIDe;fordletcallbackObjofcbArraye{ifdcallbackObj!=nulle{callbackObj.exec.applydcallbackObj,extraArgse;cccallbackObj.execdextraArgs[0],extraArgs[1],extraArgs[2],extraArgs[3],extraArgs[4],extraArgs[5],extraArgs[6]e;}}}}}}﻿modulegame{cc卡牌基类exportclassCardDataItemextendsDataBase{publicid:number;publiclv:number;cc实际等级publicshowLv:number;cc当卡牌未获得时，又要显示对应等级的属性信息用publicname:string;publicdesc:string;publicexp:number;publicclassLv:number;publichp:number;publicattackSpeed:number;publicresRely:SMapanumber,numberb;cc资源依赖shape-blvpubliceffectRely:number[];cc特效依赖shape-bpubliccamp:number;publiccost:number;publicupCost:SMapanumber,numberb;cc升级需求publicupExp:number;cc升级之后提供给玩家的经验publicpreviewType:number;publicpreviewArgs:any[];publicputType:number;cc放置类型publicquality:number;publicclipName:number;publiclandType:number;publicgoldLevel:number;publicnormalSkillIdArray:number[];cc普攻publicaskillIdArray:number[];cc主动技能publicpskillIdArray:number[];cc被动技能publicallSkillMap:SMapanumber,SkillDataItemb;cc记录所有技能publiclifeTime:number;cc存活时间publicdataProxy:any;publicdataProxyName:string;publicconstructordid:numbere{superde;this.id=id;this.lv=0;this.previewArgs=[];this.effectRely=[];this.upCost=newSMapanumber,numberbde;this.resRely=newSMapanumber,numberbde;this.normalSkillIdArray=[];this.askillIdArray=[];this.pskillIdArray=[];this.allSkillMap=newSMapanumber,SkillDataItembde;this.Initde;}protectedGetDataProxyde{}publicInitde{this.GetDataProxyde;this.lv=0;this.exp=0;letheroArrayData=this.dataProxy[this.id];ifdheroArrayData==nulle{ifdIsMainThreaddeegame.errordthis.dataProxyName,"hasnoheroid:",this.ide;elsethread.errordthis.dataProxyName,"hasnoheroid:",this.ide;return;}this.name=heroArrayData["name"];this.desc=heroArrayData["desc"];this.clipName=heroArrayData["clipname"];this.camp=heroArrayData["camp"];this.quality=heroArrayData["quality"];this.classLv=heroArrayData["classlv"];this.cost=heroArrayData["cost"];this.putType=heroArrayData["puttype"];this.landType=heroArrayData["landtype"];this.resRely=newSMapanumber,numberbde;fordletidofheroArrayData["resrely"]e{letlv=id%100;letshape=Math.floordidc100e;this.resRely.setdshape,lve;}this.effectRely=[];fordleteffectIdofheroArrayData["effectrely"]e{this.effectRely.pushdeffectIde;}}publicDestroyde{super.Destroyde;ifdthis.resRely!=nulle{this.resRely.clearde;this.resRely=null;}ifdthis.upCost!=nulle{this.upCost.clearde;this.upCost=null;}ifdthis.effectRely!=nulle{this.effectRely.length=0;this.effectRely=null;}ifdthis.allSkillMap!=nulle{letskobjs=this.allSkillMap.valuesde;fordletskobjofskobjseskobj.Destroyde;this.allSkillMap.clearde;}this.dataProxy=null;}publicSetLvdlv:numbere:boolean{ifdthis.lv==lv&&lv!=0ereturnfalse;letdataLv=Math.maxd1,lve;ccifddataLva=0eccdataLv=1;ccletmaxLv=MainDataMgr.GetInstancede.cardMaxLv;ccifddataLvbmaxLveccdataLv=maxLv;this.SetAttrd"lv",lve;letret=this.RefreshDataddataLve;returnret;}publicRefreshDatadlv:numbere:boolean{letdataProxy=JsonData.getGameDatadthis.dataProxyNamee;letheroArrayData=dataProxy[this.id];ifdheroArrayData==nulle{ifdIsMainThreaddeegame.errordthis.dataProxyName,"errorid:",this.id,lve;elsethread.errordthis.dataProxyName,"errorid:",this.id,lve;returnfalse;}letherodata=heroArrayData[lv-1];ifdherodata==nulle{ifdIsMainThreaddeegame.errordthis.dataProxyName,"errorid:",this.id,lve;elsethread.errordthis.dataProxyName,"errorid:",this.id,lve;returnfalse;}this.upCost=newSMapanumber,numberbde;fordletinfoofherodata["upcost"]e{this.upCost.setdinfo[0],info[1]e;}letupCost=this.GetUpCostCardde;this.exp=Math.maxdthis.exp-upCost,0e;cc预览效果letpreview:any[]=herodata["preview"];this.previewType=preview[0];this.previewArgs=[];fordleti=1;iapreview.length;i++e{letargs=preview[i];ifdargs!=nulle{this.previewArgs.pushdargse;}}this.lifeTime=herodata["lifetime"];this.upExp=herodata["upexp"]returntrue;}publicSetExpdexp:numbere{this.exp=exp;this.SetAttrd"exp",expe;letflag=this.expb=this.GetUpCostCardde&&this.lvathis.GetHeroMaxLevelde;this.SetCanUpgradedflag?1:0ereturntrue;}publicGetSkilldid:numbere:SkillDataItem{ifdthis.allSkillMap!=nullereturnthis.allSkillMap.getdide;returnnull;}cc升级到下一级所需卡牌publicGetUpCostCardde:number{letcount=9999999999;letid=this.quality*1000+this.lv;letcfg=JsonData.getGameDatad"upgradedata_json"e[id];ifdcfg==nullereturn-1;ifdcfg.costka!=null||cfg.costka!=""ecount=Numberdcfg.costkaereturncount;}cc升级到下一级所需金币publicGetUpCostGoldde:number{letcount=9999999999;letid=this.quality*1000+this.lv;letcfg=JsonData.getGameDatad"upgradedata_json"e[id];ifdcfg==nullereturn-1;ifdcfg.costgold!=null||cfg.costgold!=""ecount=Numberdcfg.costgoldereturncount;}cc设置初始显示属性，但此时等级为0publicSetInitAttrdlv:numbere{this.SetLvdlve;this.lv=0;this.showLv=lv;}cc获取下一级升级的属性publicGetNextLevelAttrdattrType:number,lv:number=this.lve:number{letdataProxy=JsonData.getGameDatadthis.dataProxyNamee[this.id];letheroCfg=dataProxy[lv];ifdheroCfg==nullereturn0;letattrsArray:any[]=heroCfg.showattr;ifdattrsArray==nullereturn0;letattrCfg:any[];fordleti=0,len=attrsArray.length;ialen;i++e{attrCfg=attrsArray[i];ifdattrCfg==null||attrCfg[0]==nullecontinue;ifdNumberdattrCfg[0]e==attrTypee{ifdisNaNdNumberdattrCfg[1]ee==trueereturn0;returnNumberdattrCfg[1]e;}}return0;}cc获取最大等级publicGetHeroMaxLevelde:number{letheroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetCfgdthis.ide;ifdheroInfo==nullereturn0;letmaxLv=0;cc里面的等级从零开始。。。whiled1e{ifdheroInfo[maxLv]!=nullemaxLv++;elsebreak;ifdmaxLvb=100ebreak;cc防止无限循环}returnmaxLv;}cc显示等级cc当卡牌未获得时，使用显示等级，当卡牌获得时，使用实际等级publicGetLvde{ifdthis.lvb0ereturnthis.lv;elsereturnthis.showLv;}publicAddHeroRedDotde{RedDotMgr.GetInstancede.AddReddotd`hero_data_item_${this.id}`,"jundui_hero_new"e;RedDotMgr.GetInstancede.AddReddotd`hero_data_upgrade_${this.id}`,"kapai_upgrade"e;}publicSetIsNewdisShow:numbere{RedDotMgr.GetInstancede.SetStated`hero_data_item_${this.id}`,isShowe;}publicSetCanUpgradedcanUpgrade:numbere{RedDotMgr.GetInstancede.SetStated`hero_data_upgrade_${this.id}`,canUpgradee;}publicAddSkilldid:number,lv:numbere:SkillDataItem{ifdthis.allSkillMap==nullereturnnull;ifd!this.allSkillMap.hasdideethis.allSkillMap.setdid,newSkillDataItemdidee;letskobj=this.allSkillMap.getdide;skobj.heroData=this;skobj.SetLvdlve;returnskobj;}}}﻿modulegame{exportclassHeroDataItemextendsCardDataItem{publicscale:number;publicmainhero:number[][];cc主英雄publicchildhero:number[][];cc子英雄publicshield:number;cc护盾publicposType:number;cc位置跟随1:跟随主英雄0:不跟随主英雄ccpublicatt:number;ccpublicdef:number;publichp:number;publicmoveSpeed:number;publicattackSpeed:number;publicrange:number;publicmass:number;publicdeployTime:number;cc部署时间publiclandType:number;cc陆空类型publicheroType:number;cc英雄类型publicputType:number;cc放置类型publiccollideType:number[];cc阻挡类型publiccallHeroType:number=0;publicconstructordid:numbere{superdide;this.mainhero=[];this.childhero=[];}protectedGetDataProxyde{this.dataProxyName="herodata_json"this.dataProxy=JsonData.getGameDatadthis.dataProxyNamee;}publicInitde{super.Initde;letheroArrayData=this.dataProxy[this.id];ifdheroArrayData==nulle{ifdIsMainThreaddeegame.errordthis.dataProxyName,"hasnoheroid:",this.ide;elsethread.errordthis.dataProxyName,"hasnoheroid:",this.ide;return;}ifdIsMainThreadde&&!RES.hasResd`hero_${this.clipName}_json`eethis.clipName=19990;this.mass=heroArrayData["mass"];this.heroType=heroArrayData["herotype"];this.scale=heroArrayData["scale"];this.callHeroType=0;this.SetInitAttrd1e;this.AddHeroRedDotde;}publicDestroyde{super.Destroyde;ifdthis.mainhero!=nulle{this.mainhero.length=0this.mainhero=null;}ifdthis.childhero!=nulle{this.childhero.length=0this.childhero=null;}}publicRefreshDatadlv:numbere:boolean{letret=super.RefreshDatadlve;ifd!retereturnfalse;letdataProxy=JsonData.getGameDatadthis.dataProxyNamee;letheroArrayData=dataProxy[this.id];letherodata=heroArrayData[lv-1];letskObj:SkillDataItem;cc普攻this.normalSkillIdArray=[];fordletskillIdofherodata["normalskill"]e{ifdthis.normalSkillIdArray.indexOfdskillIdea=-1ethis.normalSkillIdArray.pushdskillIde;skObj=this.AddSkilldskillId,lve;skObj.skillType=SkillType.NormalSkill;}cc技能cc主动this.askillIdArray=[];fordletskillIdofherodata["activeskill"]e{ifdthis.askillIdArray.indexOfdskillIdea=-1ethis.askillIdArray.pushdskillIde;skObj=this.AddSkilldskillId,lve;skObj.skillType=SkillType.ActiveSkill;}cc被动this.pskillIdArray=[];fordletskillIdofherodata["pskill"]e{ifdthis.pskillIdArray.indexOfdskillIdea=-1ethis.pskillIdArray.pushdskillIde;skObj=this.AddSkilldskillId,lve;skObj.skillType=SkillType.PassiveSkill;}cc主英雄this.mainhero=[]letmainhero=herodata["mainhero"];fordletheroinfoofmainheroe{letheroID=heroinfo[0];letposx=heroinfo[1];letposy=heroinfo[2];letdelayTime=heroinfo[3];ifddelayTime==nulledelayTime=0;delayTime=Math.floorddelayTimecMathConst.KeyFrameTimee;this.mainhero.pushd[heroID,posx,posy,delayTime]e;}cc子英雄this.childhero=[];letchildhero=herodata["childhero"];fordletheroinfoofchildheroe{letheroID=heroinfo[0];letposx=heroinfo[1];letposy=heroinfo[2];letdelayTime=heroinfo[3];ifddelayTime==nulledelayTime=0;delayTime=Math.floorddelayTimecMathConst.KeyFrameTimee;this.childhero.pushd[heroID,posx,posy,delayTime]e;}this.shield=herodata["shield"];this.posType=herodata["postype"];ccthis.att=herodata["att"];ccthis.def=herodata["def"];this.hp=herodata["hp"];ifdECSC.RenderWarUtil.IsKingTowerdthis.ideethis.hp=Math.floordthis.hp*GameData.KingHPAddtione;ccifdthis.id==20020eccthis.hp*=100;this.moveSpeed=herodata["movespeed"];this.attackSpeed=herodata["attackspeed"];this.shield=herodata["shield"];this.shield=herodata["shield"];this.range=herodata["range"];this.deployTime=herodata["deploytime"];this.collideType=[];fordletitypeofherodata["collidetype"]ethis.collideType.pushditypee;returntrue;}publicGetSubHeroShapesde:number[]{letshapes:number[]=[];fordletinfoofthis.mainheroe{letshape=info[0];ifdshapes.indexOfdshapeea=-1eshapes.pushdshapee;}fordletinfoofthis.childheroe{letshape=info[0];ifdshapes.indexOfdshapeea=-1eshapes.pushdshapee;}returnshapes;}cc军团类卡牌的真正部署时间d配表时间+最后一个角色的延迟时间epublicGetMaxDeployTimede:number{letmaxDelayTime:number=0;fordletinfoofthis.mainheroe{letdelayTime=info[3];maxDelayTime=Math.maxdmaxDelayTime,delayTimee;}fordletinfoofthis.childheroe{letdelayTime=info[3];maxDelayTime=Math.maxdmaxDelayTime,delayTimee;}returnthis.deployTime+maxDelayTime;}}}﻿modulegame{exportclassHeroDataMgrextendsDataBase{publicconstructorde{superde;this.Initde;}ccpublicserverHeroMap:SMapastring,CardDataItemb;cc只保存了后端传过来的key，而非全部publicherosMap:SMapanumber,CardDataItemb;publicheroKeysArray:number[];cc所有卡牌（可显示在主界面可升级）publicleaderKeysArray:number[];cc所有领主publicqueenKeysArray:number[];cc所有公主塔publicotherKeysArray:number[];cc其他d召唤物之类的epublichasLeaders:number[];cc已激活的领主publichasHeros:number[];cc已经激活的卡牌publicheroCapacity:number=50;publicInitde{ccthis.serverHeroMap=newSMapastring,CardDataItembde;this.herosMap=newSMapanumber,CardDataItembde;this.heroKeysArray=[];this.leaderKeysArray=[];this.queenKeysArray=[];this.otherKeysArray=[];this.hasLeaders=[];this.hasHeros=[];cc初始化MapletdataProxy=JsonData.getGameDatad"herodata_json"e;letid:number=0;fordletidStrindataProxye{id=NumberdidStre;letcardObj:CardDataItem;ifdECS.LogicWarUtil.IsKingTowerdide==truee{cardObj=this.AddLeaderdid,0e;}elseifdECS.LogicWarUtil.IsQueenTowerdide==truee{cardObj=this.AddQueendide;}elseifdECS.LogicWarUtil.IsCarddidee{cardObj=this.AddHerodid,0e;}else{cardObj=this.AddOtherdide;}ifdcardObj!=nullecardObj.SetLvd0e;}cccc初始化法术dataProxy=JsonData.getGameDatad"spelldata_json"e;fordletidindataProxye{this.AddHerodNumberdide,0e;}this.TestInitde;}publicTestInitde{ccthis.hasLeaders.pushd99010e;ccthis.hasLeaders.pushd99020e;ccthis.hasLeaders.pushd99030e;ccthis.hasLeaders.pushd99040e;}publicDestroyde{this.heroKeysArray=null;this.leaderKeysArray=null;this.queenKeysArray=null;this.otherKeysArray=null;fordletheroofthis.herosMap.valuesdeehero.Destroyde;this.herosMap.clearde;ccthis.serverHeroMap.clearde;this.hasLeaders=null;this.hasHeros=null;super.Destroyde;}publicAddLeaderdid:number,lv:numbere:CardDataItem{ifdDataUtil.GetValueByKeyd"herodata_json",ide==nulle{game.errord"---------HeroDataMgr.AddLeadererror:",ide;returnnull;}ifdthis.herosMap.hasdide==falsee{letnewLeader=ECS.WarFactory.CreateCardDataItemdide;this.herosMap.setdid,newLeadere;this.leaderKeysArray.pushdide;}letleader=this.herosMap.getdide;ifdlvb0e{this.hasLeaders.pushdide;ccthis.serverHeroMap.setdserverID,leadere;}returnleader;}publicAddQueendid:numbere:CardDataItem{ifdDataUtil.GetValueByKeyd"herodata_json",ide==nulle{game.errord"---------HeroDataMgr.AddQueenerror:",ide;returnnull;}ifdthis.herosMap.hasdide==falsee{letnewQueen=ECS.WarFactory.CreateCardDataItemdide;this.herosMap.setdid,newQueene;this.queenKeysArray.pushdide;}letqueen=this.herosMap.getdide;returnqueen;}publicAddHerodid:number,lv:numbere:CardDataItem{ifdECS.LogicWarUtil.IsSpelldidee{ifdDataUtil.GetValueByKeyd"spelldata_json",ide==nulle{game.errord"---------HeroDataMgr.AddHeroerror:",ide;returnnull;}}else{ifdDataUtil.GetValueByKeyd"herodata_json",ide==nulle{game.errord"---------HeroDataMgr.AddHeroerror:",ide;returnnull;}}ifdthis.herosMap.hasdide==falsee{letnewHero=ECS.WarFactory.CreateCardDataItemdide;this.herosMap.setdid,newHeroe;this.heroKeysArray.pushdide;}lethero=this.herosMap.getdide;ifdlvb0e{ifdthis.hasHeros.indexOfdidea0&&ECS.LogicWarUtil.IsCarddide==trueethis.hasHeros.pushdide;}returnhero;}publicAddOtherdid:numbere:CardDataItem{ifdDataUtil.GetValueByKeyd"herodata_json",ide==nulle{game.errord"---------HeroDataMgr.AddOthererror:",ide;returnnull;}ifdthis.herosMap.hasdide==falsee{letnewKa=ECS.WarFactory.CreateCardDataItemdide;this.herosMap.setdid,newKae;this.otherKeysArray.pushdide;}letka=this.herosMap.getdide;returnka;}publicGetHerodid:numbere:CardDataItem{returnthis.herosMap.getdide;}publicGetLeaderdid:numbere:CardDataItem{returnthis.herosMap.getdide;}publicGetQueendid:numbere:CardDataItem{returnthis.herosMap.getdide;}cc根据id判断英雄是否激活publicCheckHasLockdid:numbere{letheroInfo=this.herosMap.getdide;ifdheroInfo==nullereturntrue;returnthis.hasHeros.indexOfdidea0}cc获取英雄c法术配置表publicGetCfgdide{ifdECS.LogicWarUtil.IsSpelldide==falseereturnJsonData.getGameDatad"herodata_json"e[id];elsereturnJsonData.getGameDatad"spelldata_json"e[id];}cc只为军队界面排序用publicSortHerodheros:number[],type:number=0e:number[]{ifdheros==nullereturn[];let_thatt=this;functionsortAAAdherosArraye{lettarArray:number[]=[];letid:number,heroInfo1:HeroDataItem,heroInfo2:HeroDataItem;fordleti=0,len=herosArray.length;ialen;i++e{id=herosArray[i];ifdid==nullecontinue;ifdtarArray.lengtha=0ecc第一个{tarArray.pushdide;continue;}else{fordletj=0,len2=tarArray.length;jalen2;j++e{heroInfo1=_thatt.herosMap.getdideasHeroDataItem;heroInfo2=_thatt.herosMap.getdtarArray[j]easHeroDataItem;cc核心代码为以下内容ifdtype==0ecc英雄按照品质排序d高到底e{ifdheroInfo1.qualityb=heroInfo2.qualitye{tarArray.splicedj,0,ide;break;}}elseifdtype==1ecc按照卡牌等级排序d高到低e{ifdheroInfo1.GetLvdeb=heroInfo2.GetLvdee{tarArray.splicedj,0,ide;break;}}elseifdtype==2ecc按照法力消耗排序{ifdheroInfo1.costa=heroInfo2.coste{tarArray.splicedj,0,ide;break;}}elsecc原样输出{tarArray.pushdide;}ifdj==len2-1ecc遍历到末尾还没添加到目标数组{tarArray.pushdide;}}}}returntarArray;}letarr1:number[]=[],arr2:number[]=[],arr3:number[]=[];cc已拥有、未拥有、未解锁letheroInfo:HeroDataItem,heroId:number,myClassLv:number=MainDataMgr.GetInstancede.classLv;fordleti=0,len=heros.length;ialen;i++e{heroId=heros[i];heroInfo=this.herosMap.getdheroIdeasHeroDataItem;ifdheroInfo==nullecontinue;ifdheroInfo.lvb0e{arr1.pushdheroIde;}else{ifdheroInfo.classLva=myClassLve{arr2.pushdheroIde;}else{arr3.pushdheroIde;}}}return[].concatdsortAAAdarr1e,sortAAAdarr2e,sortAAAdarr3ee;}}}﻿modulegame{exportclassLeaderDataItemextendsHeroDataItem{publicconstructordid:numbere{superdide;}publicAddHeroRedDotde{RedDotMgr.GetInstancede.AddReddotd`hero_data_item_${this.id}`,"lingzhu_hero_new"e;}publicSetIsNewdisShow:numbere{RedDotMgr.GetInstancede.SetStated`hero_data_item_${this.id}`,isShowe;}}}﻿modulegame{exportclassSkillDataItemextendsDataBase{publicheroData:CardDataItem;publicid:number;publiclv:number;publicskillType:number;cc特殊分组字段publicname:string;publicdesc:string;publictriggerTypeArray:any[];cc触发方式publicbreakTypeArray:number[];cc打断方式publicprobability:number;cc触发概率publiccd:number;publiccdSource:number;publictargetCount:number;cc目标数目publictargetSortType:number;cc排序方式publicenemyType:number;cc敌我类型publicattackCurrent:number;cc是否优先攻击当前目标publiclandTypeArray:number[];cc空地类型publicheroTypeArray:number[];cc兵种类型publicatkDis:number;cc攻击距离publicwarnDis:number;cc警戒距离publicaddHeroId:number;cc召唤英雄publicbuffId:number;publicflySpeed:number;cc子弹飞行速度publiclogicFlowID:number;cc技能流程IDpublicmagicID:number;cc法术流程IDpublicconstructordid:numbere{superde;this.id=id;this.Initde;}publicDestroyde{super.Destroyde;this.heroData=null;}publicInitde{this.lv=0;this.skillType=SkillType.NormalSkill;letdataProxy=JsonData.getGameDatad"skilldata_json"e;letskillArrayData=dataProxy[this.id];ifdskillArrayData==nulle{game.errord"SkillDataItemskillArrayDataisnullid:",this.ide;return;}cc特殊分组字段this.name=skillArrayData["name"];this.desc="";}publicSetLvdlv:numbere:boolean{ifdlv==0ereturnfalse;ifdthis.lv==lvereturnfalse;this.lv=lv;letdataProxy=JsonData.getGameDatad"skilldata_json"e;letskillArrayData=dataProxy[this.id];ifdskillArrayData==nulle{game.errord"skilldataerrorid:",this.id,this.lve;returnfalse;}letskilldata=skillArrayData[lv-1];ifdskilldata==nullecc如果找不到对应的技能就读取1级技能skilldata=skillArrayData[0];ifdskilldata==nulle{game.errord"skilldataerrorid:",this.id,this.lve;returnfalse;}lettriggerTypeArray=skilldata["triggertype"];this.triggerTypeArray=[];fordletargsoftriggerTypeArraye{letarr:number[]=[];fordletargofargse{arr.pushdNumberdargee;}this.triggerTypeArray.pushdarre;}this.breakTypeArray=[];fordlettypeofskilldata["breaktype"]ethis.breakTypeArray.pushdNumberdtypeee;this.probability=100;this.cd=skilldata["cd"];this.cdSource=skilldata["cdsource"];this.targetCount=skilldata["targetcount"];this.targetSortType=skilldata["targetsorttype"];this.enemyType=skilldata["enemytype"];this.attackCurrent=skilldata["attackcurrent"];this.landTypeArray=[];fordlettypeofskilldata["landtype"]ethis.landTypeArray.pushdtypee;this.heroTypeArray=[];fordlettypeofskilldata["herotype"]ethis.heroTypeArray.pushdtypee;this.atkDis=skilldata["atkdis"];this.warnDis=skilldata["warndis"];this.addHeroId=skilldata["addheroid"];this.buffId=skilldata["buffid"];this.flySpeed=skilldata["flyspeed"];this.logicFlowID=skilldata["logicflowid"];this.magicID=skilldata["magicid"];this.SetAttrd"lv",lve;returntrue;}}}﻿modulegame{exportclassSpellDataItemextendsCardDataItem{publicrangeType:number;cc范围publicrangeArgs:number[];publicstartPos:number;cc起始位置0：从当前触摸位置开始释放1：从国王塔位置开始释放publicconstructordid:numbere{superdide;this.rangeArgs=[];}protectedGetDataProxyde{this.dataProxyName="spelldata_json"this.dataProxy=JsonData.getGameDatadthis.dataProxyNamee;}publicInitde{super.Initde;this.SetInitAttrd1e;this.AddHeroRedDotde;}publicDestroyde{super.Destroyde;}publicRefreshDatadlv:numbere:boolean{letret=super.RefreshDatadlve;ifd!retereturnfalse;letdataProxy=JsonData.getGameDatadthis.dataProxyNamee;letheroArrayData=dataProxy[this.id];letherodata=heroArrayData[lv-1];cc范围letrangeInfo=herodata["range"];this.rangeType=rangeInfo[0];this.rangeArgs=[];fordleti=1;iarangeInfo.length;i++e{letargs=rangeInfo[i];ifdargs!=nullethis.rangeArgs.pushdargse;}cc检查合法性ifdthis.rangeType==RangeType.Circle&&this.rangeArgs.lengtha1egame.errord"SpellDataItemcirclerangeerror:",this.ide;ifdthis.rangeType==RangeType.Rect&&this.rangeArgs.lengtha2egame.errord"SpellDataItemrangerangeerror:",this.ide;this.startPos=herodata["startpos"];letskObj:SkillDataItem;cc技能this.normalSkillIdArray=[];fordletskillIdofherodata["skill"]e{ifdthis.normalSkillIdArray.indexOfdskillIdea=-1ethis.normalSkillIdArray.pushdskillIde;skObj=this.AddSkilldskillId,lve;skObj.skillType=SkillType.NormalSkill;}cc主动this.askillIdArray=[];cc被动this.pskillIdArray=[];returntrue;}}}﻿modulegame{exportclassTowerDataMgrextendsDataBase{publicconstructorde{superde;this.Initde;}cc公主塔publicqueueData:HeroDataItem;cc神主publicallKingArray:HeroDataItem[];publicserverKingMap:SMapastring,HeroDataItemb;publicallKingMap:SMapanumber,HeroDataItemb;publiccurrentKingIndex:number;cc当前神主形象publicInitde{this.allKingArray=[];this.serverKingMap=newSMapastring,HeroDataItembde;this.allKingMap=newSMapanumber,HeroDataItembde;this.currentKingIndex=0;cc公主塔this.queueData=aHeroDataItembECS.WarFactory.CreateCardDataItemdMathConst.QueenTowerIDe;this.queueData.SetLvd0e;cc国王塔letdataProxy=JsonData.getGameDatad"herodata_json"e;fordletindex=1;indexa10;index++e{letshape=99000+index*10;ifddataProxy[shape]==nullecontinue;this.AddKingdshape,0e;}this.SetCurrentKingIndexd0e;}cc角色等级变化时刷新塔的等级publicRefreshHeroLvdlv:numbere{fordletheroObjofthis.allKingArraye{heroObj.SetLvdlve;}ifdthis.queueData!=nullethis.queueData.SetLvdlve;}publicSetCurrentKingIndexdindex:numbere{letheroObj=this.allKingArray[index];ifdheroObj!=nulle{this.currentKingIndex=index;ccMathConst.ChangeKingTowerIDdheroObj.ide;this.SetAttrd"currentKingIndex",indexe;}}publicGetCurrentKingde{letheroObj=this.allKingArray[this.currentKingIndex];returnheroObj;}publicDestroyde{ifdthis.queueData!=nulle{this.queueData.Destroyde;this.queueData=null;}fordletheroObjofthis.allKingArrayeheroObj.Destroyde;this.allKingArray.length=0;this.allKingMap.clearde;this.serverKingMap.clearde;super.Destroyde;}publicRefreshHeroCBde{this.SetAttrd"allKingArray",this.allKingArraye;}publicAddKingdid:number,lv:number,serverID:string=null,isRunCB:boolean=falsee:HeroDataItem{letheroObj=null;ifd!this.allKingMap.hasdidee{heroObj=aHeroDataItembECS.WarFactory.CreateCardDataItemdide;this.allKingMap.setdid,heroObje;this.allKingArray.pushdthis.allKingMap.getdidee;}heroObj=this.allKingMap.getdide;heroObj.id=id;ifdserverID!=null&&!this.serverKingMap.hasdserverIDeethis.serverKingMap.setdserverID,heroObje;letret=heroObj.SetLvdlve;ifdret&&isRunCBe{this.SetAttrd"allKingArray",this.allKingArraye;}returnheroObj;}publicGetKingdid:numbere:HeroDataItem{returnthis.allKingMap.getdide;}publicGetKingByServerIDdserverID:stringe:HeroDataItem{returnthis.serverKingMap.getdserverIDe;}}}modulegame{exportclassHomeInit{privatestatic_isDataInit:boolean=false;publicstaticInitDatade{ifdHomeInit._isDataInitereturn;HomeInit._isDataInit=true;cc请求好友信息ClientNet.NetFriend.C2SAllInviteListde;ClientNet.NetFriend.C2SAllFriendListde;ClientNet.NetFriend.C2SAskFriendListde;cc家族ifdgame.MainDataMgr.GetInstancede.familyDataMgr.CheckHasFamilyde==falsee{ClientNet.NetFamily.C2SRecommendFamilyde;}else{ClientNet.NetFamily.C2SFamilyInfodgame.MainDataMgr.GetInstancede.familyDataMgr.myFamily.ide;}cc商品列表ClientNet.NetShop.C2SShopInfode;}publicstaticResetde{HomeInit._isDataInit=false;}}}﻿modulegame{exportclassItemDataItemextendsDataBase{publicid:number;publicname:string;publicdesc:string;publiccount:number;publicaction:number[];publicconstructordid:numbere{superde;this.id=id;this.Initde;}publicDestroyde{super.Destroyde;}publicInitde{letdataProxy=JsonData.getGameDatad"itemdata_json"e;ifddataProxy==nullereturn;letitemData=dataProxy[this.id];ifditemData==nullereturn;this.name=itemData["name"];this.desc=itemData["desc"];this.action=itemData["action"];this.count=0;}publicRefreshCountdcounte{this.count=count;this.SetAttrd"count",counte;}publicIsBoxde:boolean{returnthis.action!=null&&this.action[0]==100;}}}﻿modulegame{exportclassItemDataMgrextendsDataBase{publicconstructorde{superde;this.Initde;}publicitemMaxCount:number;cc背包容量publicitemCount:number;cc当前物品数目publicallItemArray:ItemDataItem[];publicallItemMap:SMapanumber,ItemDataItemb;publicInitde{this.allItemArray=[];this.allItemMap=newSMapanumber,ItemDataItembde;this.itemMaxCount=0;this.itemCount=0;}publicAddItemdid:number,count:numbere{ifdcountb=0e{ifd!this.allItemMap.hasdidee{this.allItemMap.setdid,newItemDataItemdidee;}this.allItemMap.getdide.RefreshCountdcounte;this.allItemArray=[];letvalues=this.allItemMap.valuesde;fordletvalueofvaluese{ifdvalue.countb0ethis.allItemArray.pushdvaluee;}}else{ccifdthis.allItemMap.hasdideecc{ccletitemObj=this.allItemMap.getdide;ccitemObj.Destroyde;ccthis.allItemMap.deletedide;ccthis.allItemArray=this.allItemMap.valuesde;cc}}ccreturnthis.allItemMap.;}publicGetOrAdddid:numbere:ItemDataItem{letitem=this.allItemMap.getdide;ifditem==nulle{this.AddItemdid,0e;}returnthis.allItemMap.getdide;}publicRefreshBagde{this.SetAttrd"allItemArray",this.allItemArraye;}cc更新物品数量publicRefreshItemCountde{letcount=0;fordletitemObjofthis.allItemArrayecount+=itemObj.count;this.SetAttrd"itemCount",counte;}publicGetItemsdid:numbere{returnthis.allItemMap.getdide;}publicDestroyde{fordlettaskObjofthis.allItemArrayetaskObj.Destroyde;this.allItemArray.length=0;this.allItemMap.clearde;super.Destroyde;}}}c***数据读取模板*bydily*dcecopyright2014-2035*AllRightsReserved.*cclassJsonData{ccpublicstaticNAME:string="template_json";cc必须和excel导出文件一致c***开发状态：json可读*TODO*上线状态：加载bin文件，在这里解密【文件小，加密】*是预加载json文件还是到时候使用到再加载*cpublicstaticjsonDataDict:SMapastring,JSONb;publicstaticInitde{JsonData.jsonDataDict=newSMapastring,JSONbde;}publicstaticgetGameDatadname:stringe:any{ifd!JsonData.jsonDataDict.hasdnameeeJsonData.jsonDataDict.setdname,RES.getResdnameee;returnJsonData.jsonDataDict.getdnamee;ccvarjsonData:JSON=RES.getResdnamee;ccreturnjsonData;}publicstaticgetJsonStringddata:anye:string{letmsg:string=JSON.stringifyddatae;returnmsg;}ccletMsg:string=JSON.stringifydDatae;ccprivate_dataMap:Arrayaanyb=newArrayde;cc存储excel数据ccprivate_proxyName:string="";ccexcel名称}modulegame{exportclassMailDataItemextendsDataBase{publicid:string;publicsendTime:number;publicendTime:number;cc邮件过期时间publiccontext:string;publictitle:string;publicisRead:boolean;publicisGetReward:boolean;publicitemArray:any[];publicconstructorde{superde;this.Initde;}publicInitde{this.itemArray=[];}publicRefreshFromDatadmailData:MailDataIteme{this.id=mailData.id;this.sendTime=mailData.sendTime;this.endTime=mailData.endTime;this.context=mailData.context;this.title=mailData.title;this.isRead=mailData.isRead;this.isGetReward=mailData.isGetReward;this.itemArray=mailData.itemArray;this.SetAttrd"isRead",mailData.isReade;}publicRefreshFromProtoddata:Protocol.IMaile{this.id=data.id;this.sendTime=Numberddata.timee;this.endTime=this.sendTime+15*24*3600*1000;cc过期时间15天this.context=data.content;this.title=data.header;this.isRead=data.hasRead;this.isGetReward=data.hasGet;this.itemArray=[];fordletrewardofdata.rewardse{letitem:any={};item.itemid=reward.index;item.count=reward.count;this.itemArray.pushditeme;}}publicSetIsReaddisRead:booleane{this.SetAttrd"isRead",isReade;}publicSetIsGetRewarddisGetReward:booleane{this.SetAttrd"isGetReward",isGetRewarde;}publicGetLeftTimede:numbercc邮件剩余时间{letleftTime=Math.floordHomeServerTime.GetLeftTimedthis.endTimeec1000e;returnleftTime;ccreturnMath.floorddthis.endTime-this.sendTimeec1000e;}publicDestroyde{super.Destroyde;this.itemArray=[];}}}modulegame{exportclassMailDataMgrextendsDataBase{publicmailDataMap:SMapastring,MailDataItemb;publicmailDataArray:MailDataItem[];publicmaxCount:number=50;publicisMailNotice:boolean;cc如果这个字段为true表示服务器有邮件未读publicisMailChange:boolean=false;publicconstructorde{superde;this.Initde;ccthis.InitTestde;}publicInitTestde{fordleti=0;ia5;i++e{letmailData=newMailDataItemde;mailData.id=Math.randomde.toStringde;mailData.sendTime=HomeServerTime.GetServerTimede;mailData.endTime=mailData.sendTime+Utils.RandomRanged100*1000,3600*50*1000e;mailData.context=`邮件内容`;mailData.title="补偿奖励";letrandom=Utils.RandomRanged1,100e;mailData.isRead=randomb80;mailData.isGetReward=randomb23;mailData.itemArray=[];ifdrandomb50e{mailData.isGetReward=false;fordletj=0;ja5;j++e{letdata:any={};data["itemid"]=2;data["count"]=j;mailData.itemArray.pushddatae;}}this.AddMaildmailData,truee;}}publicInitde{this.mailDataArray=[];this.mailDataMap=newSMapastring,MailDataItembde;this.isMailNotice=false;RedDotMgr.GetInstancede.SetStated"mail_info",0e}publicRefreshMailNoticedisNotice:booleane{ifdisNoticeeRedDotMgr.GetInstancede.SetStated"mail_info",1e;else{letstate:number=0;fordletmailDataofthis.mailDataArraye{ifdmailData.itemArray.lengthb0ecc有附件{ifd!mailData.isGetRewarde{state=1;break;}}elsecc没有附件{ifd!mailData.isReade{state=1;break;}}}RedDotMgr.GetInstancede.SetStated"mail_info",statee;}this.SetAttrd"isMailChange",truee;}publicRefreshMailDataArrayde{this.SetAttrd"mailDataArray",this.mailDataMap.valuesdee;this.RefreshMailNoticedfalsee;}publicAddMaildmailData:MailDataItem,isRefresh:booleane{ifd!this.mailDataMap.hasdmailData.idee{this.mailDataMap.setdmailData.id,mailDatae;}else{this.mailDataMap.getdmailData.ide.RefreshFromDatadmailDatae;mailData.Destroyde;}ifdisRefreshethis.RefreshMailDataArrayde;}publicGetMaildid:stringe{returnthis.mailDataMap.getdide;}publicDestroyMaildid:string,isRefresh:booleane{ifdthis.mailDataMap.hasdidee{this.mailDataMap.getdide.Destroyde;this.mailDataMap.deletedide;this.RefreshMailDataArrayde;ifdisRefreshethis.RefreshMailDataArrayde;}}publicGetAllDeleteMailde:MailDataItem[]{letarray:MailDataItem[]=[];fordletmailDataofthis.mailDataArraye{ifdmailData.itemArray.lengthb0ecc有附件{ifd!mailData.isGetRewardecontinue;}elseccc没有附件{ifd!mailData.isReadecontinue;}array.pushdmailDatae;}returnarray;}publicGetAllGetRewardMailde:MailDataItem[]{letarray:MailDataItem[]=[];fordletmailDataofthis.mailDataArraye{ifd!mailData.isGetReward&&mailData.itemArray.lengthb0earray.pushdmailDatae;}returnarray;}publicDestroyde{fordletmailDataofthis.mailDataArraye{mailData.Destroyde;}this.mailDataArray=[];this.mailDataMap.clearde;}}}﻿cccareferencepath="DataBase.ts"cbmodulegame{exportclassMainDataMgrextendsDataBase{privatestatics_Instance:MainDataMgr;publicstaticInitInstancede{newMainDataMgrde;}cc将constructor设为私有属性，防止new调用privateconstructorde{superde;MainDataMgr.s_Instance=this;this.Initde;}publicstaticGetInstancede:MainDataMgr{ifd!CheckMainThreaddeereturnnull;returnMainDataMgr.s_Instance;}publicuserName:string=LanUtil.GetTextd"我的名字"e;publicfamilyName:string=LanUtil.GetTextd"相亲相爱一家人"e;publiccupCount:number=100;publiciconName:number=1001;cc头像publicedgeId:number=1001;cc头像边框publiclevel:number=1;cc玩家等级publicexp:number=0;cc经验值publicnextExp:number=0;cc下一级所需经验值publicgold:number=0;publicdiamand:number=0;publicclassLv:number=1;cc阶数publicmaxClassLv:number=1;publiclocal:number=-1;cc地区publicsex:number=1;publiccardMaxLv:number=9;cc卡牌最高等级publicaccount:string;cc账号publicserverId:number=20190601;publicroleId:number=20190601;cc服务器分配的玩家IDccpublicfightRoleId:number=0;publicloginState:number=LoginType.LoginOut;publicfightState:number=1;cc0：正常1：匹配中2：战斗中publicfightRoomId:string="";publicheroDataMgr:HeroDataMgr;publictowerDataMgr:TowerDataMgr;publicpwsDataMgr:PWSDataMgr;publiczbsDataMgr:ZBSDataMgr;publictaskDataMgr:TaskDataMgr;publicitemDataMgr:ItemDataMgr;publicfriendDataMgr:FriendDataMgr;publicfamilyDataMgr:FamilyDataMgr;publicshopDataMgr:ShopDataMgr;publicdzDataMgr:DZDataMgr;publicteamDataMgr:TeamDataMgr;publicrankDataMgr:RankDataMgr;publicreplayDataMgr:ReplayDataMgr;publicachieveDataMgr:AchieveDataMgr;publicmailDataMgr:MailDataMgr;publictestDataMgr:TestDataMgr;publicID2AttrName:SMapanumber,[DataBase,string]b;publicInitde{this.heroDataMgr=newHeroDataMgrde;this.towerDataMgr=newTowerDataMgrde;this.pwsDataMgr=newPWSDataMgrde;this.zbsDataMgr=newZBSDataMgrde;this.taskDataMgr=newTaskDataMgrde;this.itemDataMgr=newItemDataMgrde;this.friendDataMgr=newFriendDataMgrde;this.familyDataMgr=newFamilyDataMgrde;this.shopDataMgr=newShopDataMgrde;this.dzDataMgr=newDZDataMgrde;this.teamDataMgr=newTeamDataMgrde;this.rankDataMgr=newRankDataMgrde;this.replayDataMgr=newReplayDataMgrde;this.achieveDataMgr=newAchieveDataMgrde;this.mailDataMgr=newMailDataMgrde;this.testDataMgr=newTestDataMgrde;this.exp=0;this.maxClassLv=DataUtil.GetMaxClassLvde;this.InitAttrde;this.SetLvd1e;RedDotMgr.GetInstancede;}publicInitAttrde{this.ID2AttrName=newSMapanumber,[DataBase,string]bde;this.ID2AttrName.setdProtocol.PropertyEnum.EXP,[this,"exp"]e;this.ID2AttrName.setdProtocol.PropertyEnum.MONEY,[this,"gold"]e;this.ID2AttrName.setdProtocol.PropertyEnum.DIAMOND,[this,"diamand"]e;this.ID2AttrName.setdProtocol.PropertyEnum.CUPS,[this,"cupCount"]e;this.ID2AttrName.setdProtocol.PropertyEnum.LEVEL,[this,"level"]e;this.ID2AttrName.setdProtocol.PropertyEnum.CLASSLEVEL,[this,"classLv"]e;this.ID2AttrName.setdProtocol.PropertyEnum.TASKSCOPE,[this.taskDataMgr,"score"]e;}publicSetLvdlve{letnextExp=-1;letdataProxy=JsonData.getGameDatad"playerdata_json"e;letdata=dataProxy[lv];ifddata!=nulle{nextExp=data["exp"];}this.nextExp=nextExp;this.towerDataMgr.RefreshHeroLvdlve;this.SetAttrd"level",lve;fordletleaderIdofthis.heroDataMgr.leaderKeysArraye{letleaderInfo=this.heroDataMgr.GetLeaderdleaderIdeleaderInfo.SetLvdlve;}}publicSetClassLvdclassLv:numbere{this.SetAttrd"classLv",classLve;this.cardMaxLv=DataUtil.GetValueByKeyd"classleveldata_json",classLv,"cardlevel"e;ifdthis.cardMaxLv==nulle{this.cardMaxLv=9;game.errord"MainDataMgr.SetClassLverror:",classLve;}}publicGetCountdid:numbere{letarray=this.ID2AttrName.getdide;ifdarray==nulle{game.errord"MainDataMgr.GetCounterror"+ide;return0;}letthisObj=array[0];letattrName=array[1];returnthisObj[attrName];}publicGetAttrNamedid:numbere:string{letarray=this.ID2AttrName.getdide;ifdarray==nulle{game.errord"MainDataMgr.GetCounterror"+ide;returnnull;}letattrName=array[1];returnattrName;}cc根据地区id获取地区名字publicGetLocalNamedlocal:numbere{ccreturn[LanUtil.GetTextd"中国"e,LanUtil.GetTextd"美国"e,LanUtil.GetTextd"日本"e][local];return[LanUtil.GetTextd"中国"e,LanUtil.GetTextd"中国"e,LanUtil.GetTextd"中国"e][local];cc审核版本之后可删除本行代码，恢复上行代码。}publicDestroyde{ifdthis.heroDataMgr!=nulle{this.heroDataMgr.Destroyde;this.heroDataMgr=null;}ifdthis.towerDataMgr!=nulle{this.towerDataMgr.Destroyde;this.towerDataMgr=null;}ifdthis.pwsDataMgr!=nulle{this.pwsDataMgr.Destroyde;this.pwsDataMgr=null;}ifdthis.zbsDataMgr!=nulle{this.zbsDataMgr.Destroyde;this.zbsDataMgr=null;}ifdthis.taskDataMgr!=nulle{this.taskDataMgr.Destroyde;this.taskDataMgr=null;}ifdthis.itemDataMgr!=nulle{this.itemDataMgr.Destroyde;this.itemDataMgr=null;}ifdthis.friendDataMgr!=nulle{this.friendDataMgr.Destroyde;this.friendDataMgr=null;}ifdthis.familyDataMgr!=nulle{this.familyDataMgr.Destroyde;this.familyDataMgr=null;}ifdthis.shopDataMgr!=nulle{this.shopDataMgr.Destroyde;this.shopDataMgr=null;}ifdthis.dzDataMgr!=nulle{this.dzDataMgr.Destroyde;this.dzDataMgr=null;}ifdthis.teamDataMgr!=nulle{this.teamDataMgr.Destroyde;this.teamDataMgr=null;}ifdthis.rankDataMgr!=nulle{this.rankDataMgr.Destroyde;this.rankDataMgr=null;}ifdthis.replayDataMgr!=nulle{this.replayDataMgr.Destroyde;this.replayDataMgr=null;}ifdthis.achieveDataMgr!=nulle{this.achieveDataMgr.Destroyde;this.achieveDataMgr=null;}ifdthis.mailDataMgr!=nulle{this.mailDataMgr.Destroyde;this.mailDataMgr=null;}ifdthis.testDataMgr!=nulle{this.testDataMgr.Destroyde;this.testDataMgr=null;}RedDotMgr.GetInstancede.Destroyde;super.Destroyde;}}}﻿modulegame{exportclassChatDataItemextendsDataBase{publicfromId:number;publictoId:number;publictime:number;publictext:string;publicimageId:number;publicconstructorde{superde;this.Initde;this.imageId=0;}publicInitde{}publicSetTextdtext:stringe{this.text=text;letregex=c\[&[0-9]{1,8}\]cgim;letimgIds=text.matchdregexe;ifdimgIds==null||imgIds.length==0ethis.imageId=0;else{letidStr=imgIds[0].matchdc[0-9]+ce;letid=NumberdidStr[0]e;this.imageId=id;}}publicIsImgde:boolean{returnthis.imageId!=0;}publicDestroyde{super.Destroyde;}}}﻿modulegame{exportclassPlayerDataItemextendsDataBase{publicid:number;publicicon:string;publicedgeId:number;publiclv:number;publicname:string;publiccupCount:number;publicsex:number;publicstate:number;cc0没有状态1：邀请失败2：已邀请publicserverId:number;cc服务器下发的serverIdpublicclassLv:number=4;publicisOnline:boolean=false;cc是否在线publiclastReadChatTime:number=0;cc上次阅读信息的时间publichasUnReadMsg:boolean=false;publicsortValue:number=0;cc排序值publicchatList:ChatDataItem[];publictodayFirstChatIndex=0;publicconstructordid:numbere{superde;this.id=id;this.chatList=[];}publicAddFriendLeftRedDotde{RedDotMgr.GetInstancede.AddReddotd`friend_left_item_${this.id}`,"friend_left_item"e;}publicInitde{ccthis.InitTestde;}publicInitTestde{fordleti=0;ia30;i++e{letchatObj=newChatDataItemde;ifdMath.randomdeb0.5e{chatObj.fromId=this.id;chatObj.toId=20190601;}else{chatObj.fromId=20190601;chatObj.toId=this.id;}chatObj.time=HomeServerTime.GetServerTimede;chatObj.SetTextdMath.randomde.toStringdeeifdia20echatObj.SetTextdMath.randomde.toStringdeeccchatObj.SetTextd"[&34]"e;elseccchatObj.SetTextdMath.randomde.toStringdeechatObj.SetTextd"[&34]"e;this.AddChatdchatObje;}RedDotMgr.GetInstancede.SetStated`friend_left_item_${this.id}`,1e;}publicAddChatdchatDataItem:ChatDataIteme{this.chatList.pushdchatDataIteme;ifdthis.chatList.lengthb50ethis.chatList.shiftde;}publicClearAllChatde{fordletchatofthis.chatListe{chat.Destroyde;}this.chatList=[];}publicRefreshChatDatade{this.chatList.sortdda,be:number=b{ifda.timebb.timeereturn1;elsereturn-1;}e;this.todayFirstChatIndex=-1;lettodayStartTime=HomeServerTime.GetTodayStartTimede;letmyRoleId=MainDataMgr.GetInstancede.roleId;letindex=-1;fordletchatDataItemofthis.chatListe{index++;ifdchatDataItem.timebthis.lastReadChatTime&&chatDataItem.fromId!=myRoleIde{RedDotMgr.GetInstancede.SetStated`friend_left_item_${this.id}`,1e;this.hasUnReadMsg=true;}ifdchatDataItem.timeb=todayStartTime&&this.todayFirstChatIndex==-1e{this.todayFirstChatIndex=index;}}ccthis.hasUnReadMsg=false;this.SetAttrd"chatList",this.chatListe;}cc重新计算排序值publicReCalcuSortValuede{letvalue=this.cupCount*10000;ifdthis.hasUnReadMsgevalue+=1000;ifdthis.isOnlineevalue+=100;this.sortValue=value;}publicRefreshDataFromServerdfriend:Protocol.IFriende{this.name=friend.name;this.lv=friend.level;this.cupCount=friend.cups;this.serverId=friend.serverId;this.icon=friend.iconName;this.edgeId=friend.edgeId;this.isOnline=friend.state;}publicDestroyde{this.ClearAllChatde;super.Destroyde;}}}﻿modulegame{exportclassRankInfoextendsDataBase{publictype:number;publicgloRankMap:SMapanumber,RankDataItemb;publiclocRankMap:SMapanumber,RankDataItemb;publicpreGloRankMap:SMapanumber,RankDataItemb;cc上届全球榜publicpreLocRankMap:SMapanumber,RankDataItemb;cc上届本地榜publicreqSpace:number=20;cc一次请求n个玩家数据publicmaxRankNum:number=1000cc显示前n名publicgloCurrIndex:number=1;publiclocalCurrIndex:number=1;publicpreGloCurrIndex:number=1;publicpreLocalCurrIndex:number=1;publicconstructordtype:numbere{superde;this.type=type;this.Initde;}publicInitde{this.gloRankMap=newSMapanumber,RankDataItembde;this.locRankMap=newSMapanumber,RankDataItembde;this.preGloRankMap=newSMapanumber,RankDataItembde;this.preLocRankMap=newSMapanumber,RankDataItembde;}publicDestroyde{fordletinfoofthis.gloRankMap.valuesdee{info.Destroyde;}fordletinfoofthis.locRankMap.valuesdee{info.Destroyde;}fordletinfoofthis.preGloRankMap.valuesdee{info.Destroyde;}fordletinfoofthis.preLocRankMap.valuesdee{info.Destroyde;}this.gloRankMap=null;this.locRankMap=null;this.preGloRankMap=null;this.preLocRankMap=null;}publicAddGloRankInfodrank:numbere{ifdthis.gloRankMap.hasdranke==falsee{letnewRankInfo=newRankDataItemde;newRankInfo.rank=rank;newRankInfo.type=Const.RankType.GLOBAL;this.gloRankMap.setdrank,newRankInfoe;}returnthis.gloRankMap.getdranke;}publicAddLocRankInfodrank:numbere{ifdthis.locRankMap.hasdranke==falsee{letnewRankInfo=newRankDataItemde;newRankInfo.rank=rank;newRankInfo.type=Const.RankType.LOCAL;this.locRankMap.setdrank,newRankInfoe;}returnthis.locRankMap.getdranke;}publicAddPreGloRankInfodrank:numbere{ifdthis.preGloRankMap.hasdranke==falsee{letnewRankInfo=newRankDataItemde;newRankInfo.rank=rank;newRankInfo.type=Const.RankType.PRE_GLOBAL;this.preGloRankMap.setdrank,newRankInfoe;}returnthis.preGloRankMap.getdranke;}publicAddPreLocRankInfodrank:numbere{ifdthis.preLocRankMap.hasdranke==falsee{letnewRankInfo=newRankDataItemde;newRankInfo.rank=rank;newRankInfo.type=Const.RankType.PRE_LOCAL;this.preLocRankMap.setdrank,newRankInfoe;}returnthis.preLocRankMap.getdranke;}publicResetIndexde{this.gloCurrIndex=1;this.localCurrIndex=1;this.preGloCurrIndex=1;this.preLocalCurrIndex=1;}}exportclassRankPlayerTeam{heroId:number;level:number;publicDestroyde{};}exportclassRankDataItemextendsDataBase{publictype:number;publicrank:number;publicplayerName:string;publicplayerId:number;publiccups:number;publicfamilyId:string;publicsex:number;publicfamilyName:string;publicheadIconId:number;publicheadIconBg:number;publiclv:number;publiclocal:number;publicclassLv:number;publicteam:RankPlayerTeam[];publicconstructorde{superde;}publicDestroyde{}publicGetHeroLvdheroId:numbere{fordletheroofthis.teame{ifdhero.heroId==heroIdereturnhero.level;}returnnull;}publicGetHerodheroId:numbere{fordletheroofthis.teame{ifdhero.heroId==heroIdereturnhero;}returnnull;}cc仅针对从后端发来的数据进行赋值d完全赋值epublicPackDataFromServerdinfo:Protocol.IRankInfoe{this.familyName=info.familyName;this.playerName=info.roleName;this.cups=info.cups;this.playerId=info.roleIdasnumber;this.local=info.serverId;this.headIconId=info.rolePicthis.headIconBg=2001ccinfo.headIconBg;this.familyId="-1";this.sex=1;this.lv=info.level;this.classLv=info.classLevel;this.team=[];lethero:Protocol.ISimpleHero;fordletj=0,len2=info.heros.length;jalen2;j++e{hero=info.heros[j]ifdECSC.RenderWarUtil.IsCarddhero.indexe==falseecontinueletheroInfo=newgame.RankPlayerTeamde;heroInfo.heroId=hero.indexheroInfo.level=hero.levelthis.team.pushdheroInfoe;}}}cc----------------------------------------------------------------------MgrexportclassRankDataMgrextendsDataBase{publicplayerRankData:RankInfo;cc玩家排行榜publicconstructorde{superde;this.Initde;}publicInitde{this.playerRankData=newRankInfodConst.RankInfoType.PLAYERe;}publicInitTestde{}publicDestroyde{this.playerRankData.Destroyde;}cc----------------------------------------------------------------------各种apic***获取排行榜类型的所有数据*cpublicGetRankInfodtype:numbere:RankInfo{ifdtype==nullereturnnull;switchdtypee{caseConst.RankInfoType.PLAYER:returnthis.playerRankData;caseConst.RankInfoType.FAMILY:returnnull;caseConst.RankInfoType.FIGHT:returnnull;}returnnull;}c***获取特定排行榜的全球c地区数据*@paramrankType排行榜类型*@paramglolocType是全球还是本地排行榜*cpublicGetRankByTypedrankType:number,glolocType:numbere:SMapanumber,RankDataItemb{letrankInfo=this.GetRankInfodrankTypee;ifdrankInfo==nullereturnnull;ifdglolocType==Const.RankType.GLOBALereturnrankInfo.gloRankMap;elseifdglolocType==Const.RankType.LOCALereturnrankInfo.locRankMap;returnnull;}c***获取特定类型排行榜的特定排行内的特定玩家*cpublicGetOneRankInfodrankType:number,glolocType:number,rank:numbere:RankDataItem{letrankMap:SMapanumber,RankDataItemb=this.GetRankByTypedrankType,glolocTypee;ifdrankMap==nullereturnnull;returnrankMap.getdranke;}c***向后申请数据*cpublicReqNewRankInfodrankType:number,glolocType:numbere{letrankMap=this.GetRankInfodrankTypee;ifdrankMap==nullereturn;letbegin:number;ifdglolocType==Const.RankType.GLOBALebegin=rankMap.gloCurrIndex;elseifdglolocType==Const.RankType.LOCALebegin=rankMap.localCurrIndex;ifdbegin==nullereturn;letend=begin+rankMap.reqSpace;ClientNet.NetRank.C2SRankInfodbegin,end,glolocTypee;}}}﻿modulegame{classRedDotStateextendsDataBase{publicname:string;privatestate:number;cc0:无红点1:有红点privateparent:RedDotState;privatechildrenInfo:SMapastring,RedDotStateb;publicisFixed:boolean;cc配置文件里面的固定属性publicconstructordname:stringe{superde;this.name=name;this.state=0;this.parent=null;this.childrenInfo=newSMapastring,RedDotStatebde;this.isFixed=true;}publicCopydreddotObj:RedDotStatee:RedDotState{reddotObj.SetParentdthis.parente;letkeys=this.childrenInfo.keysde;fordletkeyofkeyse{letvalue=this.childrenInfo.getdkeye;reddotObj.AddChilddvaluee;}this.parent.AddChilddreddotObje;this.parent.Checkde;returnreddotObj;}publicSetParentdparent:RedDotStateeccTODONIU添加冲突检测防止多个父节点{ifdthis.parent!=nulle{game.errord"RedDotState.SetParentRepeated!!!!",this.namee;}this.parent=parent;}publicAddChilddchild:RedDotStatee{this.childrenInfo.setdchild.name,childe;}publicSetState_NotCalldstate:numbere{ifdthis.state==stateereturn;this.state=state;ifdthis.state==1e{ifdthis.parent!=nullecc当前节点有红点父节点必然有红点this.parent.SetStated1e;}else{ifdthis.parent!=nullecc当前节点红点消失检查父节点的红点状况this.parent.Checkde;}}publicSetStatedstate:numbere{ifdthis.state==stateereturn;this.SetAttrd"state",statee;ifdthis.state==1e{ifdthis.parent!=nullecc当前节点有红点父节点必然有红点this.parent.SetStated1e;}else{ifdthis.parent!=nullecc当前节点红点消失检查父节点的红点状况this.parent.Checkde;}}publicSetStateSelfdstate:numbere{ifdthis.state==stateereturn;this.SetAttrd"state",statee;}publicGetStatede:number{returnthis.state;}cc自检红点publicCheckde{letkeys=this.childrenInfo.keysde;fordletkeyofkeyse{letchild=this.childrenInfo.getdkeye;ifdchild.state==1e{this.SetStated1e;return;}}this.SetStated0e;}publicDestroyde{ifdthis.parent!=nulle{this.parent.Destroyde;this.parent=null;}letvalues=this.childrenInfo.valuesde;fordletchildofvaluese{child.Destroyde;}this.childrenInfo.clearde;super.Destroyde;}}exportclassRedDotMgrextendsDataBase{privatestatics_Instance:RedDotMgr;publicstaticGetInstancede:RedDotMgr{ifdRedDotMgr.s_Instance==nulleRedDotMgr.s_Instance=newRedDotMgrde;returnRedDotMgr.s_Instance;}privateredDotInfo:SMapastring,RedDotStateb;publicconstructorde{superde;this.redDotInfo=newSMapastring,RedDotStatebde;this.Initde;}publicInitde{letdataProxy=JsonData.getGameDatad"reddot_json"e;fordletkeyindataProxye{letvalue=dataProxy[key];letparentList=value["parent"];ifdparentList==nulleparentList=[];letreddotObj=this.Adddkeye;reddotObj.SetStateSelfd0e;letchildObj=reddotObj;letparentObj:RedDotState;fordletparentNameofparentListe{parentObj=this.AdddparentNamee;parentObj.SetStateSelfd0e;parentObj.AddChilddchildObje;childObj.SetParentdparentObje;cc后面的节点是前面节点的父节点childObj=parentObj;parentObj=null;}}}privateAdddname:stringe:RedDotState{ifd!this.redDotInfo.hasdnameeethis.redDotInfo.setdname,newRedDotStatednameee;returnthis.redDotInfo.getdnamee;}privateGetdname:stringe:RedDotState{returnthis.redDotInfo.getdnamee;}privateRemovedname:stringe{letreddotObj=this.Getdnamee;ifdreddotObj!=nulle{reddotObj.Destroyde;this.redDotInfo.deletednamee;}}publicGetStatedname:stringe:number{letreddotObj=this.Getdnamee;ifdreddotObj!=nullereturnreddotObj.GetStatede;return0;}publicGetReddotdname:stringe:RedDotState{returnthis.Getdnamee;}publicSetStatedname:string,state:numbere{letreddotObj=this.Getdnamee;ifdreddotObj==nulle{game.errord"RedDotMgr.SetStateerror:",name,statee;return;}reddotObj.SetStatedstatee;}publicAddReddotdname:string,copyName:stringe:RedDotState{letcopyObj=this.GetdcopyNamee;ifdcopyObj==nulle{game.errord"AddReddoterror",name,copyNamee;returnnull;}letreddotObj=this.Getdnamee;ifdreddotObj!=nullereturnreddotObj;reddotObj=this.Adddnamee;reddotObj.SetStateSelfd0e;reddotObj=copyObj.CopydreddotObje;reddotObj.isFixed=false;returnreddotObj;}publicRemoveReddotdname:stringe{letreddotObj=this.Getdnamee;ifdreddotObj!=null&&!reddotObj.isFixede{this.Removednamee;}else{game.errord"RemoveReddoterror",name,reddotObje}}publicDestroyde{letvalues=this.redDotInfo.valuesde;fordletchildofvaluese{child.Destroyde;}this.redDotInfo.clearde;super.Destroyde;}}}modulegame{exportclassReplayPlayerData{publicroleId:number;publiciconName:number;publicedgeId:number;publicwinType:number;cc0失败1胜利publicplayerName:string;publicfamilyName:string;publicheroInfoArray:any[];cc[heroId,lv]publicconstructorde{}}exportclassReplayDataItemextendsDataBase{publicuniqueId:number;publicindex:number=0;publicstartTime:number;publiclastShareTime:number;publicwatchCount:number;publicclassLv:number;publicplayerArray:ReplayPlayerData[];publicpvpType:number;cc1V1或者2V2publicsingleType:number;cc1世界2个人publicconstructorde{superde;this.playerArray=[];}publicSetReplayDatadmsg:Protocol.ISimpleRecorde{ifdmsg!=nulle{this.uniqueId=msg.index;this.startTime=Numberdmsg.timee;this.lastShareTime=Numberdmsg.timee;letsrcPlayerData=newReplayPlayerDatade;srcPlayerData.roleId=Numberdmsg.srcRoleIde;srcPlayerData.iconName=msg.srcIcon;srcPlayerData.edgeId=1001;srcPlayerData.winType=msg.winSide==1?1:0;srcPlayerData.playerName=msg.srcName;srcPlayerData.familyName=msg.srcFamilyName;srcPlayerData.heroInfoArray=[];fordletheroofmsg.srcHerose{ifd!ECSC.RenderWarUtil.IsTowerdhero.indexeesrcPlayerData.heroInfoArray.pushd[hero.index,hero.level]e;}letdecPlayerData=newReplayPlayerDatade;decPlayerData.roleId=Numberdmsg.decRoleIde;decPlayerData.iconName=msg.decIcon;decPlayerData.edgeId=1001;decPlayerData.winType=msg.winSide==2?1:0;decPlayerData.playerName=msg.decName;decPlayerData.familyName=msg.decFamilyName;decPlayerData.heroInfoArray=[];fordletheroofmsg.decHerose{ifd!ECSC.RenderWarUtil.IsTowerdhero.indexeedecPlayerData.heroInfoArray.pushd[hero.index,hero.level]e;}letmyRoleId=MainDataMgr.GetInstancede.roleId;ifdmsg.srcRoleId==myRoleIde{this.playerArray.pushdsrcPlayerDatae;this.playerArray.pushddecPlayerDatae;}else{this.playerArray.pushddecPlayerDatae;this.playerArray.pushdsrcPlayerDatae;}this.pvpType=PVPType.VS_1_1;return;}this.startTime=HomeServerTime.GetServerTimede;this.lastShareTime=HomeServerTime.GetServerTimede;this.watchCount=Utils.RandomRanged1,1000e;this.classLv=Utils.RandomRanged1,7e;this.playerArray=[];fordleti=0;ia2;i++e{letplayerData=newReplayPlayerDatade;playerData.roleId=Utils.RandomRanged1000,2000e;playerData.iconName=1001;playerData.edgeId=1001;playerData.winType=i;playerData.playerName="";playerData.familyName="";playerData.heroInfoArray=[];letheroIdArray=[10010,10020,10030,10040,10050,10060,10070,10080];fordletj=0;ja8;j++e{playerData.heroInfoArray.pushd[heroIdArray[j],j]e;}this.playerArray.pushdplayerDatae;}this.pvpType=PVPType.VS_1_1;}publicIsMyReplayde:boolean{letmyRoleId=MainDataMgr.GetInstancede.roleId;fordletplayerofthis.playerArraye{ifdplayer.roleId==myRoleIdereturntrue;}returnfalse;}}}modulegame{exportclassReplayDataMgrextendsDataBase{publicworldItemArray:ReplayDataItem[];publicmyItemMap:SMapanumber,ReplayDataItemb;publicmyItemArray:ReplayDataItem[];publicconstructorde{superde;this.worldItemArray=[];this.myItemMap=newSMapanumber,ReplayDataItembde;this.myItemArray=[];this.InitTestde;}publicInitTestde{fordleti=0;ia1;i++e{letitem=newReplayDataItemde;item.SetReplayDatadnulle;this.AddWorldItemditeme;}}publicAddMyItemditem:ReplayDataIteme{this.myItemMap.setditem.uniqueId,iteme;this.myItemArray.pushditeme;item.singleType=2;item.index=this.myItemArray.length-1;}publicRefreshMyArrayde{this.SetAttrd"myItemArray",this.myItemArraye;}publicRefreshWorldArrayde{this.SetAttrd"worldItemArray",this.myItemArraye;}publicAddWorldItemditem:ReplayDataIteme{this.worldItemArray.pushditeme;item.singleType=1;item.index=this.worldItemArray.length-1;}publicGetReplayDataArraydtype:number,classLv:numbere:ReplayDataItem[]{ifdtype==2ecc个人回放直接返回returnthis.myItemArray;letreplayDataArray:ReplayDataItem[]=[];letarray=this.worldItemArray;fordletreplayDataofarraye{ifdreplayData.classLv==classLvecc只有世界回放才会根据阶数过滤{replayDataArray.pushdreplayDatae;}}returnreplayDataArray;}cc1世界回放2个人回放publicGetReplayDatadtype:number,index:numbere:ReplayDataItem{ifdtype==1e{ifdindexathis.worldItemArray.lengthereturnthis.worldItemArray[index];returnnull;}else{ifdindexathis.myItemArray.lengthereturnthis.myItemArray[index];returnnull;}}publicDestroyMyArrayde{this.myItemMap.clearde;fordletitemofthis.myItemArraye{item.Destroyde;}this.myItemArray=[];}publicDestroyWorldArrayde{fordletitemofthis.worldItemArraye{item.Destroyde;}this.worldItemArray=[];}publicDestroyde{this.DestroyMyArrayde;this.DestroyWorldArrayde;super.Destroyde;}}}﻿modulegame{exportclassGoodsDataItemextendsDataBase{publicid:numbercc商品idpublicshopType:numbercc标记商店类型publicname:string;cc商品名称publicitemType:number;cc商品类型publicitemId:number;cc物品idpublicitemCount:numbercc一次购买所获得的物品数目publiccostType:number;cc支付方式publicprice:number;cc原价publicsalePrice:number;cc折扣价d最终价格epublicsalePercent:number;cc折扣d0-100的数字epubliclimitGrade:number;cc阶数限制publicdesc:string;cc描述publiclimitType:number;cc限购类型publiclimitCount:number;cc购买次数限制publicbegin:number;cc开始日期publicend:number;cc结束日期publicshowIcon:string;cc商品图标cc动态数据publichasBuy:number;cc已经购买的次数publicconstructordid:numbere{superde;this.id=id;this.Initde;}publicInitde:void{letdataProxy=JsonData.getGameDatad"shopdata_json"e;letdata=dataProxy[this.id];ifddata==nulle{game.errord"GoodsDataItem.Initerrorid:",this.ide;return;}this.shopType=data["shoptype"];this.name=data["name"];this.itemType=data["type"];this.itemId=data["item"];this.itemCount=data["count"];this.costType=data["costtype"];this.price=data["price"];this.salePrice=data["saleprice"];this.salePercent=data["saledesc"];this.limitGrade=data["limitgrade"];this.desc=data["desc"];this.limitType=data["limittype"];this.limitCount=data["limitcount"];this.begin=data["beigin"];this.end=data["end"];this.showIcon=data["showicon"];cc动态数据this.hasBuy=0;}publicDestroyde{super.Destroyde;}publicSetCountdcount:numbere{this.SetAttrd"hasBuy",counte;}c***是否打折*cpublicIsZheKoude{returnthis.salePercent!=null&&this.salePercentb0;}c***支付的货币是否充足*cpublicIsEnoughCostde:boolean{letcostType=this.costType;letneedCount=this.salePrice;ccsalePrice才是实际价格ifdcostType==ShopCostType.RMBe{returntrue;}elseifdcostType==ShopCostType.GOLDe{returnneedCounta=MainDataMgr.GetInstancede.gold;}elseifdcostType==ShopCostType.DIMANDe{returnneedCounta=MainDataMgr.GetInstancede.diamand;}elseifdcostType==ShopCostType.FAMILY_SCOREe{returnfalse;cc暂无}returnfalse;}c***商品是否解锁*cpublicIsUnlockedde:boolean{returnthis.limitGradea=MainDataMgr.GetInstancede.classLv;}c***是否免费*cpublicIsFreede:boolean{returnthis.salePricea=0;}c***是否还有购买次数*cpublicIsHasCountde{returnthis.hasBuyathis.limitCount;}}}﻿modulegame{exportclassShopDataMgrextendsDataBase{privateshopDataMap:SMapanumber,GoodsDataItemb;cc包含了配置表所有的商品publiccurrKaPaiArray:number[];cc保存精选卡牌当前刷出的卡牌idpublicconstructorde{superde;this.Initde;}publicInitde{this.shopDataMap=newSMapanumber,GoodsDataItembde;this.currKaPaiArray=[20210,20211,20212,20213,20214];letdataProxy=JsonData.getGameDatad"shopdata_json"e;letid:number=0;fordletidStrindataProxye{id=NumberdidStre;letinfo=newGoodsDataItemdide;this.shopDataMap.setdid,infoe;}}publicDestroyde{letvalues=this.shopDataMap.valuesde;fordletvalueofvaluese{value.Destroyde;value=null;}this.shopDataMap.clearde;this.shopDataMap=null;this.currKaPaiArray=null;super.Destroyde;}c***根据商品类型获取该类的所有商品id*cpublicGetGoodsArraydtype:numbere:number[]{letarray:number[]=[];fordletgoodsDataItemofthis.shopDataMap.valuesdee{ifdgoodsDataItem.shopType==typeearray.pushdgoodsDataItem.ide;}returnarray;}c***根据商品id获取商品信息*cpublicGetItemdid:numbere:GoodsDataItem{returnthis.shopDataMap.getdide;}c***获取当前精选卡牌的id*cpublicGetKaPaiArraydsortType:number=1e{ifdsortType==1e{lettarArray1:number[]=[];cc免费lettarArray2:number[]=[];cc打折lettarArray3:number[]=[];cc已解锁lettarArray4:number[]=[];cc未解锁letcurrArray:number[]=this.currKaPaiArray;letitem1:GoodsDataItem;letid:number;fordleti=0,len=currArray.length;ialen;i++e{id=currArray[i];item1=this.shopDataMap.getdide;ifditem1==nullecontinue;ifditem1.IsUnlockedde==truee{ifditem1.IsFreede==trueetarArray1.pushdide;elseifditem1.IsZheKoude==trueetarArray2.pushdide;elsetarArray3.pushdide;}elsetarArray4.pushdide;}return[].concatdtarArray1,tarArray2,tarArray3,tarArray4e;}returnthis.currKaPaiArray;}}}﻿modulegame{exportclassTaskDataItemextendsDataBase{publicid:number;publicname:string;publicdesc:string;publiclevel:number;publiccondition:number;publictotalCount:number;publicnowCount:number;publicrewardID:number;cc任务开始时间0表示任务在进行中publicstartTime:number;publicisGetReward:boolean;cc是否已经领取奖励publicconstructordid:numbere{superde;this.id=id;this.Initde;}publicDestroyde{super.Destroyde;}publicInitde{letdataProxy=JsonData.getGameDatad"taskdata_json"e;lettaskData=dataProxy[this.id];this.name=taskData["name"];this.desc=taskData["desc"];this.condition=taskData["condition"];this.totalCount=taskData["count"];this.rewardID=taskData["reward"];this.nowCount=0;this.startTime=0;this.isGetReward=false;}publicRefreshCountdcount:numbere{ifdcountbthis.totalCountecount=this.totalCount;this.nowCount=count;this.SetAttrd"nowCount",counte;}publicGetRewardde:any[]{returnDataUtil.GetRewarddthis.rewardIDe;}}}﻿modulegame{exportclassTaskDataMgrextendsDataBase{publicconstructorde{superde;this.Initde;}publicnextTaskTime:number;publicscore:number;publicmaxScore:number;privateallTaskArray:TaskDataItem[];privateallTaskMap:SMapanumber,TaskDataItemb;publicrefreshCost:number=50;cc刷新一次任务所需的花费publicInitde{this.nextTaskTime=0;this.maxScore=500;this.score=340;this.allTaskArray=[];this.allTaskMap=newSMapanumber,TaskDataItembde;this.nextTaskTime=HomeServerTime.GetServerTimede+3500*1000;ccletdataProxy=JsonData.getGameDatad"taskdata_json"e;ccfordletidxindataProxyecc{ccletid=Numberdidxe;ccthis.AddTaskdid,0,truee;cc}}publicRefreshScoredscore:numbere{this.SetAttrd"score",scoree;}publicClearTaskde{fordlettaskObjofthis.allTaskArrayetaskObj.Destroyde;this.allTaskArray.length=0;this.allTaskMap.clearde;}publicAddTaskdid:number,count:number,refreshCB:booleane:TaskDataItem{letisChanged:boolean=false;ifd!this.allTaskMap.hasdidee{letnewTaskObj=newTaskDataItemdide;this.allTaskMap.setdid,newTaskObje;this.allTaskArray.pushdnewTaskObje;isChanged=true;}lettaskObj=this.allTaskMap.getdide;taskObj.RefreshCountdcounte;ifdisChanged&&refreshCBethis.RefreshTaskCBde;returntaskObj;}publicRefreshTaskCBde{this.SetAttrd"allTaskArray",this.allTaskArraye;}publicGetTaskdid:numbere:TaskDataItem{returnthis.allTaskMap.getdide;}publicGetAllTaskde:TaskDataItem[]{returnthis.allTaskArray;}publicDestroyde{this.ClearTaskde;super.Destroyde;}}}﻿modulegame{exportclassTeamDataMgrextendsDataBase{publicteamMap:SMapanumber,TeamInfob;cc保存在卡组中的领主信息publiccurrentTeamIndex:number=1;cc当前使用卡组publicMaxTeamNum:number=6;cc队伍最大数量publicMaxMemberNum:number=8;cc卡组英雄的最大数量publicteamHeroListSortData=["按卡牌品质","按卡牌等级","按法力消耗"];publicconstructorde{superde;this.Initde;}publicInitde{this.currentTeamIndex=1;this.teamMap=newSMapanumber,TeamInfobde;letteam:TeamInfo;fordleti=1,len=this.MaxTeamNum;ia=len;i++e{team=newTeamInfo;team.teamId=i;this.teamMap.setdi,teame;};}publicDestroyde{fordletteamofthis.teamMap.valuesdeeteam.Destroyde;this.teamMap.clearde;this.teamMap=null;}cc----------------------------------------------------------------------Herocc添加新英雄到末尾publicAddHerodteamId:number,heroId:numbere{ifdthis.teamMap.hasdteamIde==falseereturnnull;letteam=this.teamMap.getdteamIde;letheroArray=team.heroArray;fordletidofheroArraye{ifdid==heroIdereturnnull;}heroArray.pushdheroIde;}cc添加领主publicAddLeaderdteamId:number,leaderId:numbere{ifdthis.teamMap.hasdteamIde==falseereturnnull;letteam=this.teamMap.getdteamIde;team.leader=leaderId;}cc切换领主publicChangeLeaderdteamId:number,leaderId:numbere{ifdthis.teamMap.hasdteamIde==falseereturn;letteam=this.teamMap.getdteamIde;team.leader=leaderId;}cc----------------------------------------------------------------------ToolpublicGetTeamInfodteamId:numbere:TeamInfo{returnthis.teamMap.getdteamIde;}publicGetLeaderInfoByTeamIddteamId:numbere{letteamInfo=this.teamMap.getdteamIde;ifdteamInfo==nullereturnnull;returnMainDataMgr.GetInstancede.heroDataMgr.GetLeaderdteamInfo.leadere;}publicGetLeaderInfoByIddleaderId:numbere{returnMainDataMgr.GetInstancede.heroDataMgr.GetLeaderdleaderIde;}cc获取已激活的领主publicGetUnlockLeadersIdde:number[]{returnMainDataMgr.GetInstancede.heroDataMgr.hasLeaders;}cc替换英雄publicSwapHerodteamId:number,oheroId:number,newHeroId:numbere:boolean{ifdteamId==null||oheroId==null||newHeroId==null||teamIda=0||oheroIda=0||newHeroIda=0ereturnfalse;letteamInfo=this.teamMap.getdteamIde;letindex=teamInfo.heroArray.indexOfdoheroIde;ifdindexa0ereturnfalse;teamInfo.heroArray.splicedindex,1,newHeroIde;returntrue;}cc整个替换英雄组publicSwapAllHerodteamId:number,herosArray:number[]e{this.teamMap.getdteamIde.heroArray=herosArray;}cc获取当前阵营信息publicGetCurrTeamInfode:TeamInfo{returnthis.teamMap.getdthis.currentTeamIndexe;}cc将领主对应的卡组切换成适合的卡组cc切换领主时用publicSuitHeroArraydteamId:number,newLeader:numbere:number[]{letnewArray:number[]=[];letmMgr=game.MainDataMgr.GetInstancede;letteamInfo=mMgr.teamDataMgr.GetTeamInfodteamIde;letleadInfo=mMgr.heroDataMgr.GetLeaderdnewLeadere;letid:number,heroInfo:HeroDataItem;fordleti=0,len=teamInfo.heroArray.length;ialen;i++e{id=teamInfo.heroArray[i];heroInfo=mMgr.heroDataMgr.GetHerodideasHeroDataItem;ifdheroInfo==nullecontinue;ifddheroInfo.camp==0||heroInfo.camp==leadInfo.campe&&newArray.indexOfdheroInfo.idee{newArray.pushdheroInfo.ide;}}lethMgr=game.MainDataMgr.GetInstancede.heroDataMgr;lethasHeroIds=hMgr.hasHeros;fordleti=0,len=hasHeroIds.length;ialen;i++e{ifdnewArray.lengthb=this.MaxMemberNumebreak;id=hasHeroIds[i];heroInfo=hMgr.GetHerodideasHeroDataItem;ifdheroInfo==nullecontinue;ifddheroInfo.camp==0||heroInfo.camp==leadInfo.campe&&newArray.indexOfdheroInfo.idea0e{newArray.pushdheroInfo.ide;}}returnnewArray;}cc可用英雄+剔除对应卡组英雄+法术消耗降序排序publicSortCostdarray:number[],teamId:numbere{letteamInfo=this.teamMap.getdteamIde;ifdteamInfo==nullereturn[];letheroArray=teamInfo.heroArray;lethMgr=MainDataMgr.GetInstancede.heroDataMgr;lethasHeroIds:number[]=hMgr.hasHeros;lettarArray:number[]=[];letcannotUseArray:number[]=[];lethero:HeroDataItem;letid:number;letcompareHero:HeroDataItem;letcompareId:number;letleaderInfo:LeaderDataItem;fordleti=0,len=array.length;ialen;i++e{id=array[i];ifdhasHeroIds.indexOfdidea0econtinue;cc剔除未激活英雄ifdheroArray.indexOfdideb=0econtinue;cc剔除在组英雄hero=hMgr.GetHerodideasHeroDataItem;ifdhero==nullecontinue;leaderInfo=hMgr.GetLeaderdteamInfo.leadereasLeaderDataItem;ifdleaderInfo==nullecontinue;ccifdhero.camp!=0&&hero.camp!=leaderInfo.campecontinue;cc不同阵营的去掉cccccc核心代码，其他排序也只是修改这里fordletj=0,len2=tarArray.length;jalen2;j++e{compareId=tarArray[j];compareHero=hMgr.GetHerodcompareIdeasHeroDataItem;ifdhero.camp!=0&&hero.camp!=leaderInfo.campecc将不同阵营的卡牌放到最后{cannotUseArray.pushdide;break;}ifdhero.costb=compareHero.coste{tarArray.splicedj,0,ide;break;}ifdj==len2-1etarArray.pushdide;}ifdtarArray.lengtha=0e{ifdhero.camp!=0&&hero.camp!=leaderInfo.campe{cannotUseArray.pushdide;}else{tarArray.pushdide;}}}return[].concatdtarArray,cannotUseArraye;}cc可用英雄+剔除对应卡组英雄+等级降序排序publicSortLeveldarray:number[],teamId:numbere{letteamInfo=this.teamMap.getdteamIde;ifdteamInfo==nullereturn[];letheroArray=teamInfo.heroArray;lethMgr=MainDataMgr.GetInstancede.heroDataMgr;lethasHeroIds:number[]=hMgr.hasHeros;lettarArray:number[]=[];letcannotUseArray:number[]=[];lethero:HeroDataItem;letid:number;letcompareHero:HeroDataItem;letcompareId:number;letleaderInfo:LeaderDataItem;fordleti=0,len=array.length;ialen;i++e{id=array[i];ifdhasHeroIds.indexOfdidea0econtinue;cc剔除未激活英雄ifdheroArray.indexOfdideb=0econtinue;cc剔除在组英雄hero=hMgr.GetHerodideasHeroDataItem;ifdhero==nullecontinue;leaderInfo=hMgr.GetLeaderdteamInfo.leadereasLeaderDataItem;ifdleaderInfo==nullecontinue;ccifdhero.camp!=0&&hero.camp!=leaderInfo.campecontinue;cc不同阵营的去掉cccccc核心代码，其他排序也只是修改这里fordletj=0,len2=tarArray.length;jalen2;j++e{compareId=tarArray[j];compareHero=hMgr.GetHerodcompareIdeasHeroDataItem;ifdhero.camp!=0&&hero.camp!=leaderInfo.campecc将不同阵营的卡牌放到最后{cannotUseArray.pushdide;break;}ifdhero.GetLvdeb=compareHero.GetLvdee{tarArray.splicedj,0,ide;break;}ifdj==len2-1etarArray.pushdide;}ifdtarArray.lengtha=0e{ifdhero.camp!=0&&hero.camp!=leaderInfo.campe{cannotUseArray.pushdide;}else{tarArray.pushdide;}}}return[].concatdtarArray,cannotUseArraye;}cc可用英雄+剔除对应卡组英雄+品质降序排序publicSortQualitydarray:number[],teamId:numbere{letteamInfo=this.teamMap.getdteamIde;ifdteamInfo==nullereturn[];letheroArray=teamInfo.heroArray;lethMgr=MainDataMgr.GetInstancede.heroDataMgr;lethasHeroIds:number[]=hMgr.hasHeros;lettarArray:number[]=[];letcannotUseArray:number[]=[];lethero:HeroDataItem;letid:number;letcompareHero:HeroDataItem;letcompareId:number;letleaderInfo:LeaderDataItem;fordleti=0,len=array.length;ialen;i++e{id=array[i];ifdhasHeroIds.indexOfdidea0econtinue;cc剔除未激活英雄ifdheroArray.indexOfdideb=0econtinue;cc剔除在组英雄hero=hMgr.GetHerodideasHeroDataItem;ifdhero==nullecontinue;leaderInfo=hMgr.GetLeaderdteamInfo.leadereasLeaderDataItem;ifdleaderInfo==nullecontinue;ccifdhero.camp!=0&&hero.camp!=leaderInfo.campecontinue;cc不同阵营的去掉cccccc核心代码，其他排序也只是修改这里fordletj=0,len2=tarArray.length;jalen2;j++e{compareId=tarArray[j];compareHero=hMgr.GetHerodcompareIdeasHeroDataItem;ifdhero.camp!=0&&hero.camp!=leaderInfo.campecc将不同阵营的卡牌放到最后{cannotUseArray.pushdide;break;}ifdhero.qualityb=compareHero.qualitye{tarArray.splicedj,0,ide;break;}ifdj==len2-1etarArray.pushdide;}ifdtarArray.lengtha=0e{ifdhero.camp!=0&&hero.camp!=leaderInfo.campe{cannotUseArray.pushdide;}else{tarArray.pushdide;}}}return[].concatdtarArray,cannotUseArraye;}}}﻿modulegame{exportclassTeamInfo{publicteamId:number;publicheroArray:number[];publicleader:number;publicconstructorde{this.Initde;}publicInitde{this.heroArray=[];this.leader=-1;this.teamId=-1;}publicDestroyde{this.heroArray.length=0;this.leader=-1;this.teamId=-1;}cc----------------------------------------------------------------------HeropublicAddHerode{}}}modulegame{exportclassTestDataMgrextendsDataBase{publicheroIdArray:number[];publicconstructorde{superde;this.Initde;}publicInitde{this.heroIdArray=[];}publicUpdateHeroIdArraydheroIdArray:number[]e{this.heroIdArray=heroIdArray;}publicGetHeroIdArraydheroIdArray:number[]e:number[]{ifdthis.heroIdArray.lengthb0ereturnthis.heroIdArray;returnheroIdArray;}publicDestroyde{this.heroIdArray=[];super.Destroyde;}}}modulegame{exportclassHomeServerTime{publicstaticserverTime:number=dnewDatedee.getTimede;publicstaticlocalTime:number=dnewDatedee.getTimede;publicstaticSetServerTimedtime:numbere{HomeServerTime.serverTime=time;HomeServerTime.localTime=dnewDatedee.getTimede;ccgame.logd"------SetServerTime----serverTime:",HomeServerTime.serverTime,"localTime:",HomeServerTime.localTimee;}publicstaticGetServerTimede:number{letnow=dnewDatedee.getTimede;letpassTime=now-HomeServerTime.localTime;returnHomeServerTime.serverTime+passTime;}cc返回距离指定的时间还有多久d毫秒epublicstaticGetLeftTimedtime:numbere:number{letserverTime=HomeServerTime.GetServerTimede;ccgame.logd"------GetLeftTime----serverTime:",serverTime,"localTime:",HomeServerTime.localTime,"------bbb",time,time-serverTimee;ifdserverTimebtimeereturn0;returntime-serverTime;}cc返回距离指定时间已经过去了多久d毫秒epublicstaticGetPassTimedtime:numbere:number{letserverTime=HomeServerTime.GetServerTimede;ccgame.logd"------GetLeftTime----serverTime:",serverTime,"localTime:",HomeServerTime.localTime,"------bbb",time,time-serverTimee;ifdserverTimeatimeereturn0;returnserverTime-time;}cc返回今日00：00:00时候的的服务器时间publicstaticGetTodayStartTimede:number{constdate=newDatede;cc获取距离日00：00:00过去了多久letpassTime=ddate.getHoursde*3600+date.getMinutesde*60+date.getSecondsdee*1000;letserverTime=HomeServerTime.GetServerTimede;returnserverTime-passTime;}}}﻿classLinkUtil{ccpublicstaticGetWorldFrameCountde:numbercc{ccletworldObj=ECS.LogicWorld.GetInstancede;ccifdworldObj!=nulleccreturnworldObj.frameCount;ccreturn0;cc}publicstaticCheckDevicede{ifdGameData.DeviceType==DeviceType.LinuxServeregame.errord"servercannotcallLinkUtilfunc!!!!",newErrorde.stacke;}ccpublicstaticGetWorldObjdcheck:boolean=truee:ECS.LogicWorldcc{ccifdcheckeccLinkUtil.CheckDevicede;ccreturnECS.LogicWorld.GetInstancede;cc}ccpublicstaticGetWarManagerdcheck:boolean=truee:ECS.LogicWarManagercc{ccifdcheckeccLinkUtil.CheckDevicede;ccreturnECS.LogicWarManager.GetInstancede;cc}ccpublicstaticGetPreWarDatadcheck:boolean=truee:PreWarDatacc{ccifdcheckeccLinkUtil.CheckDevicede;ccletworldObj=ECS.LogicWorld.GetInstancede;ccifdworldObj!=nulleccreturnworldObj.prewarData;ccreturnnull;cc}ccpublicstaticGetWarContainerdcheck:boolean=truee:ECS.WarContainercc{ccifdcheckeccLinkUtil.CheckDevicede;ccletworldObj=ECS.LogicWorld.GetInstancede;ccifdworldObj!=nulleccreturnworldObj.warContainer;ccreturnnull;cc}cc明天干掉linkutilccpublicstaticGetWarMapdcheck:boolean=truee:ECS.WarMapcc{ccifdcheckeccLinkUtil.CheckDevicede;ccletcontainer=LinkUtil.GetWarContainerde;ccifdGameData.TestThreadecccontainer=ECSC.RenderWarUtil.GetWarContainerde;ccifdcontainer!=nulleccreturncontainer.mapObj;ccreturnnull;cc}ccpublicstaticGetRenderHeroManagerdcheck:boolean=truee:ECSC.RenderHeroManagercc{ccifdcheckeccLinkUtil.CheckDevicede;ccletworldObj=ECSC.RenderWorld.GetInstancede;ccifdworldObj!=nulleccreturnworldObj.renderHeroManager;ccreturnnull;cc}}﻿classWarData{cc入场动画效果publicstaticEnterAni_TopLeftStartTime=0.1;publicstaticEnterAni_TopLeftMoveTime=0.5;publicstaticEnterAni_TopRightStartTime=0.2;publicstaticEnterAni_TopRightMoveTime=0.5;publicstaticEnterAni_TopCenterStartTime=0.3;publicstaticEnterAni_TopCenterMoveTime=0.5;publicstaticEnterAni_BottomStartTime=0.2;publicstaticEnterAni_BottomMoveTime=0.4;publicstaticEnterAni_MapStartTime=0.1;publicstaticEnterAni_MapMoveTime=0.7;ccloading动画时间dloading界面上的角色移动之类的动画eccUI动画时间d战斗UI的一些渐入动画ecc卡牌上阵动画时间d卡牌从下一张卡牌位置飞向各自的卡牌格子位置动画ecc地图动画时间d战斗地图变大变小动画epublicstaticloadingAnimationStartTime:number=-1;publicstaticuiAnimationStartTime:number=-1;ccUI动画开始时间publicstaticcardAniationStartTime:number=-1;cc卡牌上阵动画时间publicstaticmapAnimationStartTime:number=-1;cc地图动画时间publicstaticbShowSpeedUpEffect:boolean;cc加速特效publicstaticbShowBurnEffect:boolean;cc燃烧特效ccpublicstaticuiAnimationOverTime:number=-1;ccUI动画结束时间publicstaticDeployAni_Time1:number=1000;cc部署第一段动画所需要的时间publicstaticDeployAni_Time2:number=1000;cc部署第二段动画所需要的时间publicstaticCallHeroAni_Time1:number=1000;cc召唤英雄动画时间所需要的时间publicstaticSkillLockTime:number=100;publicstaticShowRender:boolean=true;publicstaticStartWardecc可以开始播放动画了{WarData.loadingAnimationStartTime=egret.getTimerde;WarData.uiAnimationStartTime=WarData.loadingAnimationStartTime+1500;WarData.cardAniationStartTime=WarData.loadingAnimationStartTime+1500+700;WarData.mapAnimationStartTime=WarData.loadingAnimationStartTime+1500;}publicstaticResetWarDatade{WarData.loadingAnimationStartTime=-1;WarData.uiAnimationStartTime=-1;WarData.cardAniationStartTime=-1;WarData.mapAnimationStartTime=-1;WarData.bShowSpeedUpEffect=false;WarData.bShowBurnEffect=false;ccWarData.uiAnimationOverTime=-1;}}﻿c***资源加载工具类，*支持多个resource.json文件加载*cclassConfigUtils{private_configs:Arrayaanyb;private_onComplete:Function;private_thisObj:any;c***构造函数*cpublicconstructorde{this._configs=newArrayaanybde;}c***添加一个配置文件*@paramjsonPathresource.json路径*@paramfilePath访问资源路径*cpublicAddConfigdjsonPath:string,filePath:stringe:void{this._configs.pushd[jsonPath,filePath]e;}c***开始加载配置文件*@param$onComplete加载完成执行函数*@param$thisObj加载完成执行函数所属对象*cpublicLoadConfigd$onComplete:Function,$thisObj:anye:void{this._onComplete=$onComplete;this._thisObj=$thisObj;this.LoadNextConfigde;}c***加载*cprivateLoadNextConfigde:void{cc加载完成ifdthis._configs.length==0e{this.LoadThemede;return;}letarr:any=this._configs[0];RES.addEventListenerdRES.ResourceEvent.CONFIG_COMPLETE,this.OnConfigCompleteHandle,thise;RES.addEventListenerdRES.ResourceEvent.CONFIG_LOAD_ERROR,this.OnConfigErrorHandle,thise;RES.loadConfigdarr[0],arr[1]e;}c***加载完成*@paramevent*cprivateOnConfigCompleteHandledevent:RES.ResourceEvente:void{RES.removeEventListenerdRES.ResourceEvent.CONFIG_COMPLETE,this.OnConfigCompleteHandle,thise;RES.removeEventListenerdRES.ResourceEvent.CONFIG_LOAD_ERROR,this.OnConfigCompleteHandle,thise;this._configs.shiftde;this.LoadNextConfigde;}c***加载失败重新继续加载*@paramevent*cprivateOnConfigErrorHandledevent:RES.ResourceEvente:void{RES.removeEventListenerdRES.ResourceEvent.CONFIG_COMPLETE,this.OnConfigCompleteHandle,thise;RES.removeEventListenerdRES.ResourceEvent.CONFIG_LOAD_ERROR,this.OnConfigCompleteHandle,thise;this.LoadNextConfigde;}privateLoadThemede{vartheme=neweui.Themedgame.VersionController.getHttpUrlde+game.VersionController.defaultThmJson,Main.instance.stagee;theme.oncedeui.UIEvent.COMPLETE,this.OnThemeLoadComplete,thise;}privateOnThemeLoadCompletede:void{this._onComplete.calldthis._thisObje;this._onComplete=null;this._thisObj=null;return;}}﻿modulegame{exportclassConnectManager{privatestaticinstance:ConnectManager;publicstaticGetInstancede:ConnectManager{ifdConnectManager.instance==nulle{ConnectManager.instance=newConnectManagerde;}returnConnectManager.instance;}privatehost:string;privateport:string;privateisConnecting:boolean;privateconnectProgress:number;privateusername:string;privatepassword:string;privateisLogining:boolean;privateloginProgress:number;privatestopCheck:boolean;cc停止重连检测private_isConnected:boolean;publicconstructorde{this.isConnecting=false;this.isLogining=false;this.connectProgress=0;this.loginProgress=0;this.stopCheck=false;TimerMgr.GetInstancede.AddTimerd200,this.CheckConnected,thise;TimerMgr.GetInstancede.AddTimerd1000,this.CheckConnected2,thise;}publicgetisConnectedde:boolean{returnthis._isConnected;}publicSetIsStopCheckdisStop:booleane{this.stopCheck=isStop;}privateCheckConnected2de{ifd!this._isConnectedegame.HomeInit.Resetde;returntrue;}privateCheckConnectedde{this._isConnected=false;ifdGameData.LocalTeste{this._isConnected=true;returntrue;}ifdthis.stopCheckecc停止重连检测returntrue;ifdthis.host==null||this.username==nullereturntrue;letloadingMgr=game.LoadingManager.GetInstancede;ifdthis.isConnectinge{this.connectProgress+=1;ifdthis.connectProgressb99ethis.connectProgress=99;loadingMgr.SetLoadingProgressdthis.connectProgress,100,LanUtil.GetTextd"连接服务器中..."ee;returntrue;}ifd!ClientNet.SocketManager.GetInstancede.IsSocketValiddee{game.logd`----开始重连服务器---host:${this.host}port:${this.port}--`e;this.isConnecting=true;ifd!loadingMgr.IsShowLoadingdSceneTypeConst.Homeee{loadingMgr.SetLoadingTypedSceneTypeConst.Homee;loadingMgr.ShowLoadingde;}loadingMgr.SetLoadingProgressdthis.connectProgress,100,LanUtil.GetTextd"连接服务器中..."ee;this.ConnectServerdthis.host,this.port,this.ReConnectServerRet,thise;returntrue;}ifdthis.isLogininge{this.loginProgress+=1;ifdthis.loginProgressb99ethis.loginProgress=99;game.LoadingManager.GetInstancede.SetLoadingProgressdthis.loginProgress,100,LanUtil.GetTextd"登录服务器中..."ee;returntrue;}ifd!ClientNet.NetTime.IsConnecteddee{game.logd`----开始重新登录账号---username:${this.username}--`e;this.isLogining=true;ifd!loadingMgr.IsShowLoadingdSceneTypeConst.Homeee{loadingMgr.SetLoadingTypedSceneTypeConst.Homee;loadingMgr.ShowLoadingde;}loadingMgr.SetLoadingProgressdthis.loginProgress,100,LanUtil.GetTextd"登录服务器中..."ee;this.LoginGamedthis.username,this.password,this.ReLoginGameRet,thise;returntrue;}this._isConnected=true;returntrue;}privateReConnectServerRetdret:numbere{this.isConnecting=false;this.isLogining=false;ifdret==1e{game.logd`----重连服务器成功----`e;this.connectProgress=0;game.LoadingManager.GetInstancede.SetLoadingProgressd100,100,LanUtil.GetTextd"重连服务器成功..."ee;}else{game.logd`----重连服务器失败-继续重连---`e;ccSceneManager.GetInstancede.SetLoadingProgressd10,100,"重连服务器失败..."e;}}privatefightReconnectTimerKey:number=null;privateRemoveFightReconnecTimerKeyde{ifdthis.fightReconnectTimerKey!=nulle{TimerMgr.GetInstancede.RemoveTimerdthis.fightReconnectTimerKeye;this.fightReconnectTimerKey=null;}}privateReLoginGameRetdret:numbere{this.isLogining=false;let_that=this;functionOnReLoginGameRetde{GlobalEvent.UnSubscribedGlobalEventType.FightReConnectResult,OnReLoginGameRet,_thate;_that.RemoveFightReconnecTimerKeyde;ifdret==0e{game.logd`----重连进战场失败回到主城---`e;SceneManager.GetInstancede.EnterHomede;}}ifdret==1e{this.loginProgress=0;game.LoadingManager.GetInstancede.SetLoadingProgressd100,100,LanUtil.GetTextd"重登录账号成功..."ee;cc销毁战斗模块ccLinkUtil.GetWarManagerde.StopWarde;ECSC.CNetWar.StopWarde;letmainData=game.MainDataMgr.GetInstancede;ifdmainData.fightState==2ecc重连进战场{game.logd`----重登录账号成功请求重连进战场---`e;ClientNet.NetWar.C2SFightReconnectde;this.RemoveFightReconnecTimerKeyde;GlobalEvent.SubscribedGlobalEventType.FightReConnectResult,OnReLoginGameRet,thise;this.fightReconnectTimerKey=TimerMgr.GetInstancede.AddTimerd3000,de=b{cc3s服务器没响应表示重连进战场失败GlobalEvent.FireEventdGlobalEventType.FightReConnectResult,0e;},thise;}elsecc回到主界面{game.logd`----重登录账号成功回到主界面---`e;SceneManager.GetInstancede.EnterHomede;}}else{game.logd`----重登录账号失败-继续重登录---`e;ccSceneManager.GetInstancede.SetLoadingProgressd50,100,"重登录账号失败..."e;}}publicConnectServerdhost:string,port:string,cb:Function,thisObj:anye{let_tthat=this;functionOnConnectServerdret:numbere{GlobalEvent.UnSubscribedGlobalEventType.ConnectResult,OnConnectServer,_tthate;_tthat.host=host;_tthat.port=port;ClientNet.NetTime.StopHeartTimede;ifdcb!=nullecb.calldthisObj,rete;}GlobalEvent.SubscribedGlobalEventType.ConnectResult,OnConnectServer,thise;ClientNet.SocketManager.GetInstancede.ConnectServerdhost,porte;}publicLoginGamedusername:string,password:string,cb:Function,thisObj:anye{ifdusername==nullecc清除掉登录信息{this.username=null;this.password=null;return;}let_tthat=this;functionOnLoginGamedret:numbere{GlobalEvent.UnSubscribedGlobalEventType.LoginResult,OnLoginGame,_tthate;ifdret==1ecc登录成功开始心跳{ClientNet.NetTime.StartHeartTimed15000e;_tthat.username=username;_tthat.password=password;}ifdcb!=nullecb.calldthisObj,rete;}GlobalEvent.SubscribedGlobalEventType.LoginResult,OnLoginGame,_tthate;ClientNet.NetLogin.C2SLoginGamedusername,passworde;}publicResetde{this.host=null;this.port=null;this.username=null;this.password=null;}}}﻿c****资源加载类*@author**cclassLoaderextendsegret.EventDispatcher{publicstaticinstance:Loader;c**一个自定义加载侦听事件*cprivateloadevent:LoadEvent;publicconstructorde{superde;}c**获取对象实例*cpublicstaticGetInstancede:Loader{ifdLoader.instance==nulle{varloader:Loader=newLoaderde;Loader.instance=loader;}returnLoader.instance;}c**加载配置文件*cpublicInitde{}c***资源组加载出错*cprivateOnResourceLoadErrordevent:RES.ResourceEvente:void{ccTODOconsole.warnd"Group:"+event.groupName+"hasfailedtoload"e;cc忽略加载失败的项目this.OnResourceLoadCompletedevente;}c***资源组加载进度*cprivateOnResourceProgressdevent:RES.ResourceEvente:void{this.loadevent=newLoadEventdLoadEvent.GROUP_PROGRESSe;this.loadevent.groupName=event.groupName;this.loadevent.itemsLoaded=event.itemsLoaded;this.loadevent.itemsTotal=event.itemsTotal;this.dispatchEventdthis.loadevente;this.loadevent=null;}c***preload资源组加载完成*cprivateOnResourceLoadCompletedevent:RES.ResourceEvente:void{RES.removeEventListenerdRES.ResourceEvent.GROUP_COMPLETE,this.OnResourceLoadComplete,thise;RES.removeEventListenerdRES.ResourceEvent.GROUP_LOAD_ERROR,this.OnResourceLoadError,thise;RES.removeEventListenerdRES.ResourceEvent.GROUP_PROGRESS,this.OnResourceProgress,thise;cc派发完成事件this.loadevent=newLoadEventdLoadEvent.GROUP_COMPLETEe;this.loadevent.groupName=event.groupName;this.dispatchEventdthis.loadevente;this.loadevent=null;}c***加载preload资源组。*cpublicLoaddgroup:stringe:void{RES.addEventListenerdRES.ResourceEvent.GROUP_COMPLETE,this.OnResourceLoadComplete,thise;RES.addEventListenerdRES.ResourceEvent.GROUP_LOAD_ERROR,this.OnResourceLoadError,thise;RES.addEventListenerdRES.ResourceEvent.GROUP_PROGRESS,this.OnResourceProgress,thise;RES.loadGroupdgroupe;}}﻿c****加载类事件*@author**cclassLoadEventextendsRES.ResourceEvent{ccpublicstaticLOADING:string="loading";ccpublicstaticLOADCOMP:string="loadcomp";ccprivate_resName:string="";ccpublicconstructordtype:string,resName:string="",bubbles:boolean=false,cancelable:boolean=falsee{publicconstructordtype:string,bubbles:boolean=false,cancelable:boolean=falsee{superdtype,bubbles,cancelablee;ccthis._resName=resName;}ccpublicgetresNamede:string{ccreturnthis._resName;cc}}modulegame{exportclassLoadManager{publicstaticinstance:LoadManager;publicstaticGetInstancede:LoadManager{ifdLoadManager.instance==nulleLoadManager.instance=newLoadManagerde;returnLoadManager.instance;}publicconstructorde{}privateLoadAllCardde{letteamDataMgr=MainDataMgr.GetInstancede.teamDataMgr;cc优先加载当前卡组letteamInfo=teamDataMgr.GetCurrTeamInfode;letheroIdArray=teamInfo.heroArray;letheroIdMap:SMapanumber,numberb=newSMapanumber,numberbde;fordletheroIdofheroIdArraye{heroIdMap.setdheroId,heroIde;heroIdMap.setdteamInfo.leader,teamInfo.leadere;}cc然后加载我的其他卡组letteamInfoArray=teamDataMgr.teamMap.valuesde;fordletteamInfoofteamInfoArraye{heroIdArray=teamInfo.heroArray;fordletheroIdofheroIdArraye{fordletheroIdofheroIdArraye{ifd!heroIdMap.hasdheroIdeeheroIdMap.setdheroId,heroIde;ifd!heroIdMap.hasdteamInfo.leadereeheroIdMap.setdteamInfo.leader,teamInfo.leadere;}}}cc然后加载其他所有卡牌heroIdArray=game.MainDataMgr.GetInstancede.heroDataMgr.herosMap.keysde;fordletheroIdofheroIdArraye{fordletheroIdofheroIdArraye{ifd!heroIdMap.hasdheroIdeeheroIdMap.setdheroId,heroIde;}}letresDataMap:SMapastring,IAutoGroupResDatab=newSMapastring,IAutoGroupResDatabde;letfileDataMap:SMapastring,numberb=newSMapastring,numberbde;letheroIDSet:Setanumberb=newSetanumberbde;heroIdArray=heroIdMap.keysde;fordletheroIdofheroIdArraye{RenderUtils.GetHeroGroupsdresDataMap,fileDataMap,heroIDSet,heroIde;}heroIDSet.clearde;letresDataArray=resDataMap.valuesde;resDataMap.clearde;fileDataMap.clearde;letstartTime=newDatede.getTimede;letrets=ResUtils.GetInstancede.LoadResArrayWithProdresDataArray,de=b{letendTime=newDatede.getTimede;letpassTime=endTime-startTime;game.logd`---------所有卡牌加载完成耗时：${passTime}毫秒`e;},devent:RES.ResourceEvente=b{game.logd"--------卡牌加载失败"e;},this,0e;}cc加载公共资源privateLoadCommonResde{letstartTime=newDatede.getTimede;ResUtils.GetInstancede.LoadGroupByKeydGroupResType.War,de=b{letendTime=newDatede.getTimede;letpassTime=endTime-startTime;game.logd`---------战场公共资源加载完成耗时：${passTime}毫秒`e;},devent:RES.ResourceEvente=b{game.logd"--------战场公共资源加载失败"e;},this,0e;}cc加载所有地图privateLoadAllMapde{letmapResData:IAutoGroupResData={groupName:`map_info`,resArray:[]};fordletmapId=1001;mapIda1050;mapId++e{letmapName=`map_${mapId}_jpg`;ifd!RES.hasResdmapNameeecontinue;mapResData.resArray.pushdmapNamee;}letstartTime=newDatede.getTimede;letrets=ResUtils.GetInstancede.LoadResArrayWithProd[mapResData],de=b{letendTime=newDatede.getTimede;letpassTime=endTime-startTime;game.logd`---------所有地图加载完成耗时：${passTime}毫秒`e;},devent:RES.ResourceEvente=b{game.logd"--------地图加载失败"e;},this,0e;}private_loadHomeGroupdjsonData:anye{letgroups=jsonData["groups"];letnewGroups:string[]=[];fordletgroupofgroupse{letgroupName=group["name"];ifdRES.isGroupLoadeddgroupNameeecontinue;newGroups.pushdgroupNamee;}letstartTime=newDatede.getTimede;ResUtils.GetInstancede.LoadGroupdnewGroups,de=b{letendTime=newDatede.getTimede;letpassTime=endTime-startTime;game.logd`---------所有其他资源加载完成耗时：${passTime}毫秒`e;},this,0e;}privateLoadOtherde{lethomeResJsonUrl=VersionController.getHttpUrlde+VersionController.homeResJson;lethomeResData=RES.getResByUrldhomeResJsonUrl,ddata,urle=b{try{letjsonData=JSON.parseddatae;this._loadHomeGroupdjsonDatae;}catchderrore{game.warnd`loadhome.res.jsonerror:`,error,datae;}},this,RES.ResourceItem.TYPE_TEXTe;}privateisStart:boolean=false;publicStartde{ifdthis.isStartereturn;this.isStart=true;ccthis.LoadCommonResde;ccthis.LoadAllMapde;ccthis.LoadAllCardde;ccthis.LoadOtherde;}}}moduleRES{exportfunctionloadGroup2dgroupName:stringecc静默下载资源{LoadResMgr.GetInstancede.LoadGroupdgroupNamee;}exportfunctionaddEventListener2dtype:string,listener:devent:egret.Evente=bvoid,thisObject:any,useCapture?:boolean,priority?:numbere{LoadResMgr.GetInstancede.addEventListener2dtype,listener,thisObject,useCapture,prioritye;}exportfunctionpauseLoaddecc暂停下载{LoadResMgr.GetInstancede.Pausede;}exportfunctionresumeLoaddecc继续下载{LoadResMgr.GetInstancede.Resumede;}exportfunctionisResLoadeddresName:stringe:booleancc资源是否下载完成{returnRES["host"].getdresNamee!=null;}classLoadItem{publicgroupName:string;publicresName:string;publicurl:string;publicsize:number;publicmaxLoadTime:number;ccpublicroot:string;publicfaileCount:number;publicstate:number;cc0：未加载1：加载中2：加载完成publicstartTime:number;privateisPause:boolean;publichttpObj:game.HttpRequest;publicconstructordres:RES.ResourceItem,groupName:stringe{this.groupName=groupName;this.resName=res.name;this.url=res.root+res.url;this.url=getVersionControllerde.getVirtualUrldthis.urle;ccthis.root=res.root;this.size=game.VersionController.getFileSizedres.urle;this.maxLoadTime=this.sizec5;cc按照5kb下载速度进行计算最大下载时间d单位:毫秒eifdthis.maxLoadTimea30000ecc默认情况下加载时间为30sthis.maxLoadTime=30000;ifdSettings.resLogegame.logd`startLoadgroupName:${this.groupName}url:${this.url}size:${this.size}maxLoadTime:${this.maxLoadTime}`e;this.faileCount=0;this.state=0;this.isPause=false;this.httpObj=game.HttpRequest.Createde.DataFormatdegret.HttpResponseType.ARRAY_BUFFERe.Successdddata:anye=b{this.state=2;cc加载完成ifdSettings.resLogegame.logdthis.url,"---------加载完成---bbbbbbbbbbbbbbbbb",datae;},thise.Faildde=b{this.faileCount+=1;this.Startde;},thise;}publicUpdatede{ifdthis.state==1e{letnowTime=egret.getTimerde;ifdnowTime-this.startTimebthis.maxLoadTimeecc资源加载超过最大下载时间视为加载超时重新加载一次{game.warnd`LoadRes${this.url}timeouterror:${nowTime-this.startTime}毫秒`e;this.faileCount++;this.Startde;}}elseifdthis.state!=2ecc资源已经加载完成{ifdRES.isResLoadeddthis.resNameee{this.httpObj.Abortde;this.state=2;}}}publicPausedecc暂停{ifdthis.state==1&&!this.isPausee{this.httpObj.Abortde;}this.isPause=true;}publicResumede{ifdthis.state==1&&this.isPausee{this.Startde;}this.isPause=false;}publicStartde{this.state=1;cc加载中ifdthis.faileCounta=3e{this.httpObj.Getdthis.urle;this.startTime=egret.getTimerde;}else{this.state=2;cc加载失败game.errord"loadresfail===========:",this.urle;}}}classLoadResMgrextendsegret.EventDispatcher{publicstaticinstance:LoadResMgr;publicstaticGetInstancede:LoadResMgr{ifdLoadResMgr.instance==nulleLoadResMgr.instance=newLoadResMgrde;returnLoadResMgr.instance;}privateloadMap:SMapastring,LoadItemb;privateisPause:boolean;privatetimerKey:number;publicconstructorde{superde;this.loadMap=newSMapastring,LoadItembde;this.isPause=false;this.timerKey=game.TimerMgr.GetInstancede.AddTimerd200,this.Update,thise;}publicLoadGroupdgroupName:stringe{letresArray=RES.getGroupByNamedgroupNamee;fordletresofresArraye{ifdRES.isResLoadeddres.nameeecontinue;ifdthis.loadMap.hasdres.nameeecontinue;this.loadMap.setdres.name,newLoadItemdres,groupNameee;}}publicaddEventListener2dtype:string,listener:devent:egret.Evente=bvoid,thisObject:any,useCapture?:boolean,priority?:numbere{this.addEventListenerdtype,listener,thisObject,useCapture,prioritye;}publicPausedecc暂停下载{ifdthis.isPauseereturn;this.isPause=true;letvalues=this.loadMap.valuesde;fordletloadItemofvaluese{loadItem.Pausede;}}publicResumedecc恢复下载{ifd!this.isPauseereturn;this.isPause=false;letvalues=this.loadMap.valuesde;fordletloadItemofvaluese{loadItem.Resumede;}}privateIsGroupLoadeddgroupName:stringe:boolean{letvalues=this.loadMap.valuesde;fordletloadItemofvaluese{ifdloadItem.groupName==groupName&&loadItem.state!=2ereturnfalse;}returntrue;}publicUpdatede:boolean{ifdthis.isPauseereturntrue;letkeys=this.loadMap.keysde;letloadingCount:number=0;letmaxLoadCount:number=2;cc同时加载的数目letdelKeys:string[]=[];fordletkeyofkeyse{letloadItem=this.loadMap.getdkeye;ifdloadItem.state==2ecc加载完成{delKeys.pushdkeye;ifdthis.IsGroupLoadeddloadItem.groupNameeecc这个组加载完成{letevent=newRES.ResourceEventdRES.ResourceEvent.GROUP_COMPLETEe;event.groupName=loadItem.groupName;this.dispatchEventdevente;egret.Event.releasedevente;}}elseifdloadItem.state==1ecc加载中{loadingCount+=1;loadItem.Updatede;}elsecc还未加载{ifdloadingCountamaxLoadCountecc加载数目还未到上限{loadItem.Startde;loadingCount+=1;}}}ifddelKeys.length==0ereturntrue;fordletkeyofdelKeyse{this.loadMap.deletedkeye;}delKeys.length=0;returntrue;}}}﻿modulegame{classResItemData{publickeyName:string;publichasDestroy:boolean;cc是否已经销毁资源publicdestroyTime:number;publicrefInfo:SMapanumber,numberb;cc资源引用详情publicconstructorde{this.refInfo=newSMapanumber,numberbde;}publicGetRefCountde:number{lettotalCount:number=0;fordletcountofthis.refInfo.valuesdeetotalCount+=count;returntotalCount;}}exportclassResManager{privatestaticinstance:ResManager;publicstaticGetInstancede:ResManager{ifdResManager.instance==nulle{ResManager.instance=newResManagerde;}returnResManager.instance;}privateresDataMap:SMapastring,ResItemDatab;ccprivateresInfo:any={};privatetimerKey:number;publicconstructorde{this.resDataMap=newSMapastring,ResItemDatabde;this.timerKey=TimerMgr.GetInstancede.AddTimerd200,this.Update,thise;ccthis.resInfo={};}publicUpdatede{letmaxDestroyCount=2;letdestroyCount=0;letnowTime:number=egret.getTimerde;letvalues=this.resDataMap.valuesde;fordletitemDataofvaluese{ifditemData.GetRefCountde==0&&itemData.destroyTimea=nowTime&&!itemData.hasDestroyecc可以删除{ccifditemData.keyName.indexOfd"Arrow01_json"eb-1||itemData.keyName.indexOfd"war_ui_common_json"eb-1eifdSettings.resLogegame.logditemData.keyName,"_____________________destroyRes_________________________________",egret.getTimerdee;ifdRES.hasResditemData.keyNamee==trueeRES.destroyResditemData.keyNamee;itemData.hasDestroy=true;destroyCount++;ifddestroyCountb=maxDestroyCountecc每次只删除固定数目防止卡顿returntrue;}}returntrue;}cc为分组的资源添加引用publicAddGroupRefdgroupNames:string[]e:number{letkeyID=IDManager.NewKeyIDde;fordletgroupNameofgroupNamese{letresArray=RES.getGroupByNamedgroupNamee;fordletresofresArraye{this.AddResRefdres.name,keyIDe;}}returnkeyID;}cc为没有进行分组的资源添加引用publicAddSplitResRefdresNames:string[]e:number{letgroupName="";fordletresNameofresNamesegroupName+=resName;try{letcreatedGroups=RES.getGroupByNamedgroupNamee;ifdcreatedGroups!=null&&createdGroups.lengthb0e{game.logd"--------bbbbbbbbbbbbgrouphasbeencreateed!!!!:",groupNamee;}}catchderrore{}letret=RES.createGroupdgroupName,resNamese;ifd!rete{game.warnd"--------bbbbbbbbbbbbRES.createGrouperror:",groupNamee;return0;}returnthis.AddGroupRefd[groupName]e;}cc加一个keyID只用一个引用的话cc如果某个dlg界面疯狂调用RemoveGroupRef函数删除比如common资源cc会导致其他引用common资源的界面显示出问题publicRemoveGroupRefdgroupNames:string[],keyID:numbere{fordletgroupNameofgroupNamese{letresArray=RES.getGroupByNamedgroupNamee;fordletresofresArraye{this.RemoveResRefdres.name,keyIDe;}}}privateAddResRefdresName:string,keyID:numbere{ifd!this.resDataMap.hasdresNameee{lettempData=newResItemDatade;tempData.keyName=resName;tempData.destroyTime=0;tempData.hasDestroy=true;this.resDataMap.setdresName,tempDatae;}letitemData=this.resDataMap.getdresNamee;itemData.hasDestroy=false;letrefCount=0;ifd!itemData.refInfo.hasdkeyIDee{refCount=1;}else{refCount=itemData.refInfo.getdkeyIDe;refCount=refCount+1;}itemData.refInfo.setdkeyID,refCounte;cc增加引用ccifdresName.indexOfd"Arrow01_json"eb-1||resName.indexOfd"war_ui_common_json"eb-1eccgame.logdresName,"_____________________AddResRef_________________________________",resName,refCount,itemData.destroyTime,egret.getTimerde,dnewErrordee.stacke;ifdSettings.resLogegame.logdresName,"_____________________AddResRef_________________________________",resName,refCount,itemData.destroyTime,egret.getTimerdee;}privateRemoveResRefdresName:string,keyID:numbere{ifd!this.resDataMap.hasdresNameeereturn;letitemData=this.resDataMap.getdresNamee;ifditemData.refInfo.hasdkeyIDee{letrefCount=itemData.refInfo.getdkeyIDe;ifdrefCounta=0ecc引用已经为0不处理refCount=0;elseifdrefCount==1ecc引用计数第一次为0标记删除时间{refCount=0;itemData.destroyTime=egret.getTimerde+5000;}elserefCount=refCount-1;itemData.refInfo.setdkeyID,refCounte;cc减少引用ccifdresName.indexOfd"Arrow01_json"eb-1||resName.indexOfd"war_ui_common_json"eb-1eccgame.logdresName,"_____________________RemoveResRef_________________________________",resName,refCount,itemData.destroyTime,egret.getTimerde,dnewErrordee.stacke;ifdSettings.resLogegame.logdresName,"_____________________RemoveResRef_________________________________",resName,refCount,itemData.destroyTime,egret.getTimerdee;}}publicDebugResde{this.resDataMap.forEachddvalue,keye=b{letrefCount=value.GetRefCountde;ifdrefCountb0e{ifdRES.hasResdkeyeegame.logd`${key}:${value.GetRefCountde}`e;elsegame.logd`${key}:${value.GetRefCountde}错误删除`e;}elseifd!value.hasDestroye{ifdRES.hasResdkeyeegame.logd`${key}:${value.GetRefCountde}未删除`e;elsegame.logd`${key}:${value.GetRefCountde}非非常删除`e;}elsegame.logd`${key}:${value.GetRefCountde}已删除`e;}e;}}}﻿c***资源加载*支持单个或多个资源组加载*cclassGroupResInfo{publickey:number;publicname:string;privatestate:number;cc0：未加载1：加载中2：加载完成publictime:number;cc开始加载时间publicprogress:number;publicpriority:number;publicconstructorde{this.key=0;this.state=0;this.time=0;this.progress=0;this.priority=0;}publicIsUnLoadedde:boolean{returnthis.state==0;}publicIsLoadingde:boolean{returnthis.state==1;}publicIsLoadedde:boolean{returnthis.state==2;}publicSetStatedstate:numbere{ifdstate==1ethis.time=egret.getTimerde;ifdstate==2ethis.time=egret.getTimerde-this.time;this.state=state;}publicGetMaxLoadTimedgroupName:stringe:[number,number]{ccMaxLoadTime=10000;cc超过10s视为加载失败d加载进度为0eccMaxLoadTime2=30000;cc超过30s视为加载失败d加载进度不为0eifdthis.priority==0ecc如果是静默加载的资源无时间限制{return[90000,9000000];}ifdgroupName=="common_sound"ecc音效文件无关紧要加载不完成也可以{ifdegret["isEditor"]ereturn[1000,3000];elsereturn[2000,10000];cc2s10s}elseifdgroupName=="config_common"ecc配置文件的超时时间设置的很大防止配置文件加载不了{ifdegret["isEditor"]ereturn[1000,3000];elsereturn[20000,100000];cc20s100s}else{ifdegret["isEditor"]ereturn[1000,3000];elsereturn[10000,30000];cc10s30s}}publicSetProgressdprogress:numbere:boolean{this.progress=progress;ifdthis.state==1e{let[maxTime,maxTime2]=this.GetMaxLoadTimedthis.namee;ccmaxTime*=1000;ccmaxTime2*=1000;letpassTime=egret.getTimerde-this.time;ifdpassTimebmaxTime&&progress==0e{game.errord`loadgroup:${this.name}progress:${progress}time:${passTime}error1......`e;returnfalse;}ifdpassTimebmaxTime2ecc加载超过时间上限{game.errord`loadgroup:${this.name}progress:${progress}time:${passTime}error2......`e;returnfalse;}}returntrue;}cc判断加载是否有问题判断依据:加载超过10s进度仍然为0publicIsLoadErrorde:boolean{ifdthis.state!=1ereturnfalse;let[maxTime,maxTime2]=this.GetMaxLoadTimedthis.namee;ccmaxTime*=1000;ccmaxTime2*=1000;letpassTime=egret.getTimerde-this.time;ifdpassTimebmaxTime&&this.progress==0ereturntrue;ifdpassTimebmaxTime2ecc加载超过时间上限{returntrue;}returnfalse;}}classResUtilsextendsConfigUtils{privatestaticinstance:ResUtils;publicstaticGetInstancede:ResUtils{ifdResUtils.instance==nulle{ResUtils.instance=newResUtilsde;}returnResUtils.instance;}cc保存要加载的资源组的回调函数privategroupCB:SMapanumber,any[]b;c**保存正在加载的资源组名*cprivategroupInfos:SMapanumber,SMapastring,GroupResInfobb;c**是否有资源在更新*cprivateisLoading:boolean;c**保存界面映射对应的资源组名*cprivaterecordGroups:SMapanumber,string[]b;privatetimerKey:number;c***构造函数*cpublicconstructorde{superde;this.groupCB=newSMapanumber,any[]bde;this.groupInfos=newSMapanumber,SMapastring,GroupResInfobbde;this.recordGroups=newSMapanumber,string[]bde;this.isLoading=false;this.timerKey=game.TimerMgr.GetInstancede.AddTimerd200,this.Update,thise;RES.addEventListenerdRES.ResourceEvent.GROUP_COMPLETE,this.OnResourceLoadComplete,thise;RES.addEventListenerdRES.ResourceEvent.GROUP_PROGRESS,this.OnResourceLoadProgress,thise;RES.addEventListenerdRES.ResourceEvent.GROUP_LOAD_ERROR,this.OnResourceLoadError,thise;RES.addEventListener2dRES.ResourceEvent.GROUP_COMPLETE,this.OnResourceLoadComplete,thise;RES.addEventListener2dRES.ResourceEvent.GROUP_PROGRESS,this.OnResourceLoadProgress,thise;RES.addEventListener2dRES.ResourceEvent.GROUP_LOAD_ERROR,this.OnResourceLoadError,thise;}publicUpdatede{ifdthis.groupInfos.size==0e{returntrue;}ifd!this.isLoadinge{this.LoadNextGroupde;}else{letkeys=this.groupInfos.keysde;fordletkeyofkeyse{letvalue=this.groupInfos.getdkeye;letinfos=value.valuesde;fordletinfoofinfose{ifdinfo.IsLoadErrordee{letpassTime=egret.getTimerde-info.time;game.errord`loadgroup:${info.name}progress:${info.progress}time:${passTime}error3......`e;this.OnLoadCompletedkey,info.name,truee;this.isLoading=false;returntrue;}}}}returntrue;}privateCheckPausedisPause:booleane{ifdisPauseecc直接暂停{RES.pauseLoadde;cc如果有优先级较高下载的资源暂停静默下载}else{letkeys=this.groupInfos.keysde;fordletkeyofkeyse{letvalue=this.groupInfos.getdkeye;letinfos=value.valuesde;fordletinfoofinfose{ifdinfo.priorityb0ecc有优先级更高的资源暂停静默下载{RES.pauseLoadde;cc如果有优先级较高下载的资源暂停静默下载return;}}}RES.resumeLoadde;cc如果所有都加载完了恢复静默下载}}cc记录各个场景的资源组引用publicInitSceneConfigde{letjsonData=JsonData.getGameDatad"sceneres_json"e;letsceneArray:number[]=[GroupResType.Common,GroupResType.Home,GroupResType.War];fordletsceneofsceneArraye{letresData=jsonData[scene];ccgame.logdresData,"---------InitSceneConfig1111------------bbb",scenee;ccgame.logd"---------InitSceneConfig22222------------bbb",jsonDatae;letresArray:string[]=[];fordletresNameofresData["res"]eresArray.pushdresNamee;this.RecordGroupsdscene,resArraye;ccthis.recordGroups.setdscene,resArraye;}}publicRecordGroupsdkey:number,groups:string[]e{ccgame.logd"__________________RecordGroups________",key,groupse;this.recordGroups.setdkey,groupse;}publicGetGroupsdkey:numbere:string[]{letgroups=this.recordGroups.getdkeye;ifdgroups==nulle{console.warnd"GetGroupsreserror:",keye;}returngroups;}publicLoadNextGroupdkey:number=0e{ifdthis.groupInfos.hasdkeyeecc加载指定的资源组{letinfos=this.groupInfos.getdkeye;letnames=infos.keysde;letinfo:GroupResInfo;fordletnameofnamese{info=infos.getdnamee;ifdinfo.IsUnLoadeddee{info.SetStated1e;cc标记正在加载中ccletresArray=RES.getGroupByNamednamee;ifdSettings.resLogegame.logd`1beginloadgroup:${name}__priority:${info.priority}____`,egret.getTimerdee;ifdinfo.priorityb0ecc只有非静默加载的资源dpriority优先级为0e才占用加载队列才会挡住不让其他资源加载{RES.loadGroupdname,info.prioritye;this.isLoading=true;return;}else{RES.loadGroup2dnamee;}}}}elsecckey为0顺组加载剩下的资源组{letks=this.groupInfos.keysde;letinfos:SMapastring,GroupResInfob;fordletkofkse{infos=this.groupInfos.getdke;letnames=infos.keysde;letinfo:GroupResInfo;fordletnameofnamese{info=infos.getdnamee;ifdinfo.IsUnLoadeddee{info.SetStated1e;cc标记正在加载中ccletresArray=RES.getGroupByNamednamee;ifdSettings.resLogegame.logd`2beginloadgroup:${name}__priority:${info.priority}____`,egret.getTimerdee;ifdinfo.priorityb0ecc只有非静默加载的资源dpriority优先级为0e才占用加载队列才会挡住不让其他资源加载{RES.loadGroupdname,info.prioritye;this.isLoading=true;return;}else{RES.loadGroup2dnamee;}}}}}}cc取消资源加载publicRemoveGroupLoaddkey_id:numbere{this.groupCB.deletedkey_ide;this.groupInfos.deletedkey_ide;this.CheckPausedfalsee;}c***加载资源组，带加载完成回调*@group资源组d支持字符串和数组e*@onComplete加载完成回调*@thisObject回调执行对象*@priority优先级*cpublicLoadGroupdgroups:string[],onComplete:Function,thisObject:any,priority:number=1e:number{letkey_id:number=this.CombGroupNamedgroups,prioritye;ifdkey_id==0e{ifdonComplete!=nulleonComplete.calldthisObjecte;returnkey_id;}this.groupCB.setdkey_id,[onComplete,null,thisObject]e;ifdpriority==0ecc优先级很低的资源立刻在后台加载this.LoadNextGroupdkey_ide;returnkey_id;}c***加载资源组*@key*@onComplete加载完成回调*@thisObject回调执行对象*@priority优先级*cpublicLoadGroupByKeydkey:number,onComplete:Function,onProgress:Function,thisObject:any,priority:number=1e:number{letgroups=this.GetGroupsdkeye;ifdgroups==null||groups.length==0e{ifdSettings.resLogegame.logd"LoadGroupWithLoadingnogroupswithkey:",keye;onComplete.calldthisObjecte;return0;}letkey_id:number=this.CombGroupNamedgroups,prioritye;ifdkey_id==0e{ifdonComplete!=nulleonComplete.calldthisObjecte;returnkey_id;}this.groupCB.setdkey_id,[onComplete,onProgress,thisObject]e;ifdpriority==0ecc优先级很低的资源立刻在后台加载this.LoadNextGroupdkey_ide;returnkey_id;}c***加载资源组，带加载进度*@group资源组d支持字符串和数组e*@onComplete加载完成回调*@onProgress加载进度回调*@thisObject回调执行对象*cpublicLoadGroupWithProdgroups,onComplete:Function,onProgress:Function,thisObject:any,priority:number=1e:number{letkey_id:number=this.CombGroupNamedgroups,prioritye;ifdkey_id==0e{ifdonComplete!=nulleonComplete.calldthisObjecte;returnkey_id;}this.groupCB.setdkey_id,[onComplete,onProgress,thisObject]e;ifdpriority==0ecc优先级很低的资源立刻在后台加载this.LoadNextGroupdkey_ide;returnkey_id;}c***加载不分组的资源自动创建组*@resArray:资源列表*@onComplete加载完成回调*@onProgress加载进度回调*@thisObject回调执行对象*cpublicLoadResArrayWithProdresDataArray:IAutoGroupResData[],onComplete:Function,onProgress:Function,thisObject:any,priority:number=1e:[string[],number]{letgroups:string[]=[];fordletresDataofresDataArraye{try{letresArray=RES.getGroupByNamedresData.groupNamee;letnameArray:string[]=[];fordletresofresArraye{nameArray.pushdres.namee;}ifdgame.Utils.CompareArraydnameArray,resData.resArrayee{groups.pushdresData.groupNamee;continue;}else{ifdnameArray.lengthb0ecc如果发现相同组名的资源不一致创建一个新的组resData.groupName=resData.groupName+game.Utils.GetResVerde;}}catchderrore{}letret=RES.createGroupdresData.groupName,resData.resArraye;ifd!rete{game.warnd"--------bbbbbbbbbbbbRES.createGrouperror:",resData.groupNamee;continue;}groups.pushdresData.groupNamee;}ifdgroups.length==0e{ifdSettings.resLogegame.logd"LoadResArrayWithProerror:"e;onComplete.calldthisObjecte;return[groups,-1];}letkey_id:number=this.CombGroupNamedgroups,prioritye;ifdkey_id==0e{ifdonComplete!=nulleonComplete.calldthisObjecte;return[groups,key_id];}this.groupCB.setdkey_id,[onComplete,onProgress,thisObject]e;ifdpriority==0ecc优先级很低的资源立刻在后台加载this.LoadNextGroupdkey_ide;return[groups,key_id];}privateCombGroupNamedgroups:string[],priority:numbere:number{letkey=IDManager.NewKeyIDde;this.groupInfos.setdkey,newSMapastring,GroupResInfobdee;letresInfoMap:SMapastring,GroupResInfob=this.groupInfos.getdkeye;letinfo:GroupResInfo;fordletitemofgroupse{letresItemArray=RES.getGroupByNamediteme;cc资源组不存在ifdresItemArray==null||resItemArray.length==0e{game.errord"CombGroupNamehasnogroup:",iteme;continue;}letisLoaded=RES.isGroupLoadedditeme;cc资源组已经加载完成ifdisLoadedecontinue;info=newGroupResInfode;info.name=item;info.key=key;info.priority=priority;resInfoMap.setditem,infoe;}ifdresInfoMap.size==0ecc没有资源需要加载{return0;}this.CheckPausedpriorityb0e;cc有优先级更高的资源需要加载returnkey;}privateGetGroupKeyByNamedgroupName:stringe:number[]{letkeys:number[]=[];letks=this.groupInfos.keysde;letinfos:SMapastring,GroupResInfob;fordletkofkse{infos=this.groupInfos.getdke;ifdinfos.hasdgroupNameeekeys.pushdke;}returnkeys;}privateOnLoadProgressdkey:number,groupName:string,event:RES.ResourceEvente{letcbInfo=this.groupCB.getdkeye;ifdcbInfo==nullereturn;letloadProgress:Function=cbInfo[1];letloadProgressTarget:any=cbInfo[2];ifdloadProgress!=nulle{loadProgress.calldloadProgressTarget,evente;}cc设置加载进度letinfos=this.groupInfos.getdkeye;ifdinfos==nullereturn;letinfo=infos.getdgroupNamee;ifdinfo!=nulle{letprogress=event.itemsLoadedcevent.itemsTotal*100;letret=info.SetProgressdprogresse;ifd!retecc该资源加载失败{this.OnLoadCompletedkey,groupName,truee;}}}privateOnLoadCompletedkey:number,groupName:string,isSuccess:booleane{letinfos=this.groupInfos.getdkeye;ifdinfos!=nulle{letinfo=infos.getdgroupNamee;ifdinfo!=nulle{ifdisSuccesseinfo.SetStated2e;cc标记已经加载完成elseinfo.SetStated0e;}letresArray=RES.getGroupByNamedgroupNamee;ifdSettings.resLogegame.logd`loadgroupover:${groupName}costTime:${info.time}msnowTime:${egret.getTimerde}`e;letvalues=infos.valuesde;fordletvalueofvaluese{ifd!value.IsLoadeddeecc有一个还未加载完成直接返回return;}infos.clearde;}this.groupInfos.deletedkeye;this.CheckPausedfalsee;letcbInfo=this.groupCB.getdkeye;ifdcbInfo==nullereturn;letloadComplete:Function=cbInfo[0];letloadCompleteTarget:any=cbInfo[2];ifdloadComplete!=nulle{loadComplete.calldloadCompleteTargete;}this.groupCB.deletedkeye;}c***资源组加载完成*cprivateOnResourceLoadCompletedevent:RES.ResourceEvente:void{letgroupName:string=event.groupName;letkeys=this.GetGroupKeyByNamedgroupNamee;fordletkeyofkeyse{this.OnLoadCompletedkey,groupName,truee;}this.isLoading=false;this.LoadNextGroupde;}c***资源组加载进度*cprivateOnResourceLoadProgressdevent:RES.ResourceEvente:void{letgroupName:string=event.groupName;letkeys=this.GetGroupKeyByNamedgroupNamee;fordletkeyofkeyse{this.OnLoadProgressdkey,groupName,evente;}}c***资源组加载失败重新加载*cprivateOnResourceLoadErrordevent:RES.ResourceEvente:void{game.errord"loadgrouperror:",event.groupNamee;ccthis.OnResourceLoadCompletedevente;letgroupName:string=event.groupName;letkeys=this.GetGroupKeyByNamedgroupNamee;fordletkeyofkeyse{this.OnLoadCompletedkey,groupName,falsee;}this.isLoading=false;this.LoadNextGroupde;}}﻿c****资源加载类*@author**cmodulegame{exportclassSceneManager{publicstaticinstance:SceneManager;c**获取对象实例*cpublicstaticGetInstancede:SceneManager{ifdSceneManager.instance==nulle{SceneManager.instance=newSceneManagerde;SceneManager.instance.Initde;}returnSceneManager.instance;}privatesceneType:number;publicconstructorde{this.sceneType=SceneTypeConst.None;}publicInitde{letgameLayer=GameLayerManager.gameLayerde;letmainObj=Main.instance;mainObj.addChilddgameLayere;this.AutoScalede;}publicAutoScalede{letinfo=GameConfig.GetGameScaleSizede;letmainObj=Main.instance;mainObj.x=info[0];mainObj.y=info[1];mainObj.scaleX=info[2];mainObj.scaleY=info[2];GameData.Scale=mainObj.scaleX;GameData.XOffset=mainObj.x;GameData.YOffset=mainObj.y;}privategroupNameInfo:SMapastring,stringb;privateOnProgressdevent:RES.ResourceEvente{window["destroyLoadingRes"]de;ifdthis.groupNameInfo==nulle{this.groupNameInfo=newSMapastring,stringbde;this.groupNameInfo.setd"preload",LanUtil.GetTextd"预加载资源"ee;this.groupNameInfo.setd"config_common",LanUtil.GetTextd"配置资源"ee;this.groupNameInfo.setd"common_sound",LanUtil.GetTextd"音效资源"ee;this.groupNameInfo.setd"common_ui",LanUtil.GetTextd"公共界面"ee;this.groupNameInfo.setd"common_font",LanUtil.GetTextd"字体资源"ee;this.groupNameInfo.setd"kingtower",LanUtil.GetTextd"领主资源"ee;this.groupNameInfo.setd"home_common",LanUtil.GetTextd"主城通用资源"ee;this.groupNameInfo.setd"home_map",LanUtil.GetTextd"主城地图"ee;this.groupNameInfo.setd"war_common",LanUtil.GetTextd"战场通用资源"ee;this.groupNameInfo.setd"war_ui",LanUtil.GetTextd"战场资源"ee;}letshowName:string;ifd!this.groupNameInfo.hasdevent.groupNameee{ifdevent.groupName.indexOfd"map_"eeshowName=LanUtil.GetTextd"地图资源"e;elseifdevent.groupName.indexOfd"hero_"eeshowName=LanUtil.GetTextd"英雄资源"e;else{game.warnd"unknowngroupName:",event.groupNamee;showName=LanUtil.GetTextd"其他资源"e;}}else{showName=this.groupNameInfo.getdevent.groupNamee;}ccgame.logd`${event.groupName}:${event.itemsLoaded}c${event.itemsTotal}`e;game.LoadingManager.GetInstancede.SetLoadingProgressdevent.itemsLoaded,event.itemsTotal,showNamee;}privateshowSelectServerTimerKey:number=0;privatecheckFrameTimerKey:number=0;privatecheckServerTimerKey=0;privatecheckWarReadyTimerKey:number=0;privatedelayShowReconnectTimerKey:number=0;privateRemoveAllTimerKeyde{TimerMgr.GetInstancede.RemoveTimerdthis.showSelectServerTimerKeye;TimerMgr.GetInstancede.RemoveTimerdthis.checkFrameTimerKeye;TimerMgr.GetInstancede.RemoveTimerdthis.checkServerTimerKeye;TimerMgr.GetInstancede.RemoveTimerdthis.checkWarReadyTimerKeye;TimerMgr.GetInstancede.RemoveTimerdthis.delayShowReconnectTimerKeye;}cc加载完成显示主城privateShowHomede{this.sceneType=SceneTypeConst.Home;Settings.ChangeScenedthis.sceneTypee;game.LoadingManager.GetInstancede.HideLoadingd500e;game.UIManager.ShowPaneldPanelTypeConst.MainUINewe;game.UIManager.ShowPaneldPanelTypeConst.Homee;game.HomeInit.InitDatade;ccConnectManager.GetInstancede.SetIsStopCheckdfalsee;}publicShowSelectServerde{this.sceneType=SceneTypeConst.Home;Settings.ChangeScenedthis.sceneTypee;letloadingMgr=game.LoadingManager.GetInstancede;TimerMgr.GetInstancede.RemoveTimerdthis.showSelectServerTimerKeye;ifdGameData.DevelopMode!=DevelopMode.Develope{loadingMgr.HideLoadingd500e;game.UIManager.ShowPaneldPanelTypeConst.SelectServere;}else{letserverData=game.NetConst.serverArray[2];ifdserverData==nulle{serverData={};serverData["ip"]="120.92.33.204";serverData["port"]="8000";}letthisObj=this;loadingMgr.SetDesc1dLanUtil.GetTextd"连接服务器中..."ee;game.logd"连接服务器中...",serverData["ip"],serverData["port"]e;ConnectManager.GetInstancede.ConnectServerdserverData["ip"],serverData["port"],drete=b{game.UIManager.HidePaneldPanelTypeConst.UILoadinge;ifdret==1e{loadingMgr.SetDesc1dLanUtil.GetTextd"连接服务器成功..."ee;TipsManager.ShowTipsdLanUtil.GetTextd"连接服务器成功!!!"e,1e;loadingMgr.HideLoadingd500e;game.UIManager.ShowPaneldPanelTypeConst.Logine;}else{loadingMgr.SetDesc1dLanUtil.GetTextd"连接服务器失败重新连接..."ee;TipsManager.ShowTipsdLanUtil.GetTextd"连接服务器失败!!!"e,1e;this.showSelectServerTimerKey=TimerMgr.GetInstancede.AddTimerd1000,this.ShowSelectServer,thise;}},thise;}}cc加载完成显示战场privateShowWarde{this.sceneType=SceneTypeConst.War;Settings.ChangeScenedthis.sceneTypee;ECSC.RenderWarManager.GetInstancede.InitWarRenderde;game.UIManager.ShowPaneldPanelTypeConst.Ware;game.UIManager.ShowPaneldPanelTypeConst.WarUIe;ECSC.CNetWar.RefreshPreShareDatad"isClientStartWar",truee;game.LoadingManager.GetInstancede.SetLoadingStated10e;cc加载完成game.LoadingManager.GetInstancede.HideLoadingd2000e;ccloading动画持续2s}cc重连成功后显示战场d直接进入战斗eprivateShowReconnectWarde{this.sceneType=SceneTypeConst.War;Settings.ChangeScenedthis.sceneTypee;ECSC.RenderWarManager.GetInstancede.InitWarRenderde;game.UIManager.ShowPaneldPanelTypeConst.Ware;game.UIManager.ShowPaneldPanelTypeConst.WarUIe;ECSC.CNetWar.RefreshPreShareDatad"isClientStartWar",truee;ECSC.CNetWar.RefreshPreShareDatad"isServerStartWar",truee;TimerMgr.GetInstancede.RemoveTimerdthis.checkFrameTimerKeye;TimerMgr.GetInstancede.RemoveTimerdthis.delayShowReconnectTimerKeye;this.checkFrameTimerKey=TimerMgr.GetInstancede.AddTimerd100,de=b{letworldObj=ECSC.RenderWarUtil.GetWorldObjde;ifdworldObj.warOverFrameb0||dworldObj.frameCountb0&&worldObj.frameCountb=worldObj.serverFrameCount-2ee{cc追赶上服务器帧才显示战场worldObj.Loopd1e;cc渲染层刷新一下worldObj.ForceSysncRenderPosde;this.delayShowReconnectTimerKey=TimerMgr.GetInstancede.AddTimerd1000,de=b{game.LoadingManager.GetInstancede.SetLoadingStated10e;cc加载完成returnfalse;},thise;game.LoadingManager.GetInstancede.HideLoadingd3000e;returnfalse;}ifd!ConnectManager.GetInstancede.isConnectedereturnfalse;game.LoadingManager.GetInstancede.SetLoadingProgressdworldObj.frameCount,worldObj.serverFrameCount+1,LanUtil.GetTextd"战场加载中..."ee;returntrue;},thise;}cc加载公共资源privateLoadCommonResdonComplete:Functione{cc公共资源永远不会被删除letcommonGroups=ResUtils.GetInstancede.GetGroupsdGroupResType.Commone;game.ResManager.GetInstancede.AddGroupRefdcommonGroupse;ResUtils.GetInstancede.LoadGroupByKeydGroupResType.Common,onComplete,this.OnProgress,thise;}cc加载主城资源privateLoadHomeResdonComplete:Functione{lethomeGroups=ResUtils.GetInstancede.GetGroupsdGroupResType.Homee;game.ResManager.GetInstancede.RemoveGroupRefdhomeGroups,Settings.HomeResKeyIDe;Settings.HomeResKeyID=game.ResManager.GetInstancede.AddGroupRefdhomeGroupse;ResUtils.GetInstancede.RemoveGroupLoaddSettings.LoadHomeGroupKeyIDe;Settings.LoadHomeGroupKeyID=ResUtils.GetInstancede.LoadGroupByKeydGroupResType.Home,onComplete,this.OnProgress,thise;}cc加载战场资源privateLoadWarResdonComplete:Functione{letwarGroups=ResUtils.GetInstancede.GetGroupsdGroupResType.Ware;game.ResManager.GetInstancede.RemoveGroupRefdwarGroups,Settings.WarResKeyIDe;Settings.WarResKeyID=game.ResManager.GetInstancede.AddGroupRefdwarGroupse;ResUtils.GetInstancede.RemoveGroupLoaddSettings.LoadWarGroupKeyIDe;Settings.LoadWarGroupKeyID=ResUtils.GetInstancede.LoadGroupByKeydGroupResType.War,de=b{this.LoadFightHeroResdonCompletee;},this.OnProgress,thise;}privateLoadFightHeroResdonComplete:Functione{letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;letresDataArray=warComp.GetUnloadGroupsde;ifdresDataArray.length==0e{ifdonComplete!=nulle{onComplete.calldthise;}return;}ResUtils.GetInstancede.RemoveGroupLoaddSettings.LoadFightHeroGroupKeyIDe;letrets=ResUtils.GetInstancede.LoadResArrayWithProdresDataArray,de=b{ifdonComplete!=nulle{onComplete.calldthise;}},this.OnProgress,thise;Settings.FightHeroGroups=rets[0];Settings.LoadFightHeroGroupKeyID=rets[1];game.ResManager.GetInstancede.RemoveGroupRefdSettings.FightHeroGroups,Settings.FightHeroKeyIDe;Settings.FightHeroKeyID=game.ResManager.GetInstancede.AddGroupRefdSettings.FightHeroGroupse;}privateCheckFightServerTimedonComplete:Functione{TimerMgr.GetInstancede.RemoveTimerdthis.checkServerTimerKeye;letfightServerTime=FightServerTime.GetServerTimede;ifdfightServerTime==0e{cc等待服务器时间过来才能继续下去this.checkServerTimerKey=TimerMgr.GetInstancede.AddTimerd500,this.CheckFightServerTime,this,onCompletee;game.LoadingManager.GetInstancede.SetLoadingProgressd0,0,LanUtil.GetTextd"等待服务器时间..."ee;returnfalse;}cc服务器时间已经到达ECSC.CNetWar.RefreshPreShareDatad"isServerTimeReady",truee;this.LoadWarResdde=b{ifdonComplete!=nulleonComplete.calldthise;}e;returnfalse;}cc开始进入主城cc1进入主界面cc2进入选服界面publicEnterHomedtype:number=1e{this.RemoveAllTimerKeyde;game.LoadingManager.GetInstancede.SetLoadingTypedSceneTypeConst.Homee;game.LoadingManager.GetInstancede.ShowLoadingde;ClientNet.NetTime.StartHeartTimed15000e;Settings.MainRightSelectIndex=1;ifdtype==1ethis.LoadHomeResdthis.ShowHomee;else{ConnectManager.GetInstancede.LoginGamednull,null,null,nulle;ccConnectManager.GetInstancede.SetIsStopCheckdtruee;this.LoadHomeResdthis.ShowSelectServere;}}cc开始进入战场publicEnterWarde{this.RemoveAllTimerKeyde;letloadingMgr=game.LoadingManager.GetInstancede;loadingMgr.SetLoadingTypedSceneTypeConst.Ware;loadingMgr.ShowLoadingde;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;loadingMgr.SetLoadingStated0,warComp.pvpTypee;loadingMgr.SetLoadingStated3,warComp.pvpTypee;TimerMgr.GetInstancede.RemoveTimerdthis.checkWarReadyTimerKeye;letthisObj=this;functionOnEnterWardret:numbere{warComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;GlobalEvent.UnSubscribedGlobalEventType.FightLoginResult,OnEnterWar,thisObje;ifdret==1e{game.LoadingManager.GetInstancede.SetLoadingProgressd0,0,LanUtil.GetTextd"登录战斗服成功!!!"ee;ClientNet.NetWar.StartHeartTimed3000e;cc战场对时3sClientNet.NetTime.StartHeartTimed3000e;warComp.SetAllReadyCBdthisObj.ShowWar,thisObje;cc检查服务器时间thisObj.CheckFightServerTimedde=b{cc通知服务器我已经准备完毕game.LoadingManager.GetInstancede.SetLoadingProgressd0,0,LanUtil.GetTextd"我已经加载完毕,等待其他玩家..."ee;ClientNet.NetWar.C2SWarReadyde;cc定时器检查防止服务器把房间关了导致超时TimerMgr.GetInstancede.RemoveTimerdthisObj.checkWarReadyTimerKeye;warComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;thisObj.checkWarReadyTimerKey=TimerMgr.GetInstancede.AddTimerd15000,duniqueId:numbere=b{warComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;cc如果15s后所有人没有准备完毕且是同一场战斗则客户端直接回到主界面ifdwarComp!=null&&uniqueId==warComp.uniqueId&&!warComp.IsAllReadydee{SceneManager.GetInstancede.EnterHomede;}},thisObj,warComp.uniqueIde;}e;}else{thisObj.EnterWarde;}}GlobalEvent.SubscribedGlobalEventType.FightLoginResult,OnEnterWar,thise;game.LoadingManager.GetInstancede.ShowLoadingde;game.LoadingManager.GetInstancede.SetLoadingProgressd0,0,LanUtil.GetTextd"登录战斗服务器中..."ee;ClientNet.NetWar.C2SEnterRoomdwarComp.roomIde;}cc回放战斗publicReplayWarde{this.RemoveAllTimerKeyde;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;letloadingMgr=game.LoadingManager.GetInstancede;loadingMgr.SetLoadingTypedSceneTypeConst.Ware;loadingMgr.ShowLoadingde;loadingMgr.SetLoadingStated0,warComp.pvpTypee;loadingMgr.SetLoadingStated3,warComp.pvpTypee;ClientNet.NetWar.StartHeartTimed3000e;cc战场对时3sClientNet.NetTime.StartHeartTimed3000e;warComp.SetAllReadyCBdthis.ShowWar,thise;cc检查服务器时间this.CheckFightServerTimedde=b{cc通知服务器我已经准备完毕game.LoadingManager.GetInstancede.SetLoadingProgressd0,0,LanUtil.GetTextd"等待其他玩家..."ee;warComp.SetPlayerReadydwarComp.myFightRoleIde;}e;}cc重连进入战场publicReconnectWarde{this.RemoveAllTimerKeyde;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;letloadingMgr=game.LoadingManager.GetInstancede;loadingMgr.SetLoadingTypedSceneTypeConst.Ware;loadingMgr.ShowLoadingde;loadingMgr.SetLoadingStated0,warComp.pvpTypee;loadingMgr.SetLoadingStated3,warComp.pvpTypee;ClientNet.NetWar.StartHeartTimed3000e;cc战场对时3sClientNet.NetTime.StartHeartTimed3000e;warComp.SetAllReadyCBdthis.ShowReconnectWar,thise;cc检查服务器时间this.CheckFightServerTimedde=b{cc通知服务器我已经准备完毕warComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;game.LoadingManager.GetInstancede.SetLoadingProgressd0,0,LanUtil.GetTextd"等待其他玩家..."ee;warComp.SetPlayerReadydwarComp.myFightRoleIde;}e;}privateLoadGameResOverde{letstartTime=egret.getTimerde;letthisObj=this;TimerMgr.GetInstancede.AddTimerd100,de=b{letfont_progress:number=egret["font_progress"];ifdfont_progress==nullefont_progress=0;letpassTime:number=egret.getTimerde-startTime;letpercent:number=font_progress;ccMath.floordpassTimec20000e;ifdfont_progressa100epercent=Math.floordpassTimec20000*100e;ifdpercentb=100efont_progress=100;cc多线程初始化中...letclientMainIns=thread.ClientMain.GetIntancede;letisWorkerInit=clientMainIns.IsWorkerInitde;letworkerProgress:number=0;letmaxWorkerLoadTime=20000;ifdegret["isEditor"]emaxWorkerLoadTime=50000;ifd!isWorkerInite{letworkerPassTime=clientMainIns.GetWorkerLoadTimede;ifdworkerPassTimebmaxWorkerLoadTimeecc加载超时{clientMainIns.CloseMulitiThreadde;isWorkerInit=true;}workerProgress=Math.floordworkerPassTimecmaxWorkerLoadTime*100e;}ifdisWorkerIniteworkerProgress=100;ifdfont_progressa100egame.LoadingManager.GetInstancede.SetLoadingProgressdpercent,100,LanUtil.GetTextd"游戏字体"ee;elseifdworkerProgressa100egame.LoadingManager.GetInstancede.SetLoadingProgressdworkerProgress,100,LanUtil.GetTextd"异步资源"ee;ifdfont_progressb=100&&workerProgressb=100ecc字体加载时间大于20s直接加载完成{Main.instance.LoadFontde;game.LoadingManager.GetInstancede.SetArgsd1e;ccgame.logd"字体:",window.document["fonts"]e;game.LoadingManager.GetInstancede.SetLoadingProgressdpercent,100,LanUtil.GetTextd"游戏字体"ee;game.logd`游戏内字体和异步资源加载完成耗时:${passTime}毫秒进度：${font_progress}`e;game.LoadManager.GetInstancede.Startde;this.ShowSelectServerde;returnfalse;}returntrue;},thise;}cc开始进入游戏d第一次进入游戏epublicEnterGamede{game.LoadingManager.GetInstancede.SetLoadingTypedSceneTypeConst.Homee;game.LoadingManager.GetInstancede.ShowLoadingde;cc先加载资源this.LoadCommonResdde=b{ClientNet.NetManager.Initde;game.MainDataMgr.InitInstancede;Server.Main.Startde;thread.ClientMain.GetIntancede;Main.instance.addChilddgame.TopMaskPanel.GetInstancedee;ccthis.LoadHomeResdthis.ShowSelectServere;this.LoadHomeResdthis.LoadGameResOvere;}e;}publicIsInHomede:boolean{returnthis.sceneType==SceneTypeConst.Home;}publicIsInWarde:boolean{returnthis.sceneType==SceneTypeConst.War;}}}﻿declarevarwx:{getFileSystemManager,env}modulegame{exportclassVersionControllerimplementsRES.IVersionController{ccpublicstatichttpUrl="http:cc127.0.0.1:5297cresourcec";publicstatichttpUrl_wx="resourcec";;cc"https:ccstd-game-china.oss-cn-beijing.aliyuncs.comcgamecminiGamecresourcec";publicstatichttpUrl_web="resourcec";publicstatichttpUrl_dev="resourcec";publicstaticdefaultResJson="default.res.json";publicstaticconfigResJson="config.res.json";publicstatichomeResJson="home.res.json";publicstaticwarResJson="war.res.json";publicstaticdefaultThmJson="default.thm.json";publicstaticversionJson="version.json";publicstaticIsInit:boolean=false;cc版本控制信息文件名-b[crc32码,文件大小]publicstaticversionConfigInfo:SMapastring,any[]b;ccegret.Capabilities.runtimeType==egret.RuntimeType.WXGAMEpublicstaticgetHttpUrlde:string{ifdRELEASEe{ifdegret.Capabilities.runtimeType==egret.RuntimeType.WXGAMEereturnVersionController.httpUrl_wx;elsereturnVersionController.httpUrl_web;}else{returnVersionController.httpUrl_dev;}}cc初始化文件配信息publicstaticinitConfigInfodtext:stringe{letthisObj=VersionController;thisObj.versionConfigInfo=newSMapastring,any[]bde;letinfo=JSON.parsedtexte;fordletkeyininfoe{letvalue=info[key];letcrc32Code=value[0];letsize=Numberdvalue[1]e;thisObj.versionConfigInfo.setdkey,[crc32Code,size]e;}}cc获取文件CRC32码publicstaticgetFileCRC32CodedfileName:stringe:string{letthisObj=VersionController;ifdthisObj.versionConfigInfo==nullereturnfileName;ifd!thisObj.versionConfigInfo.hasdfileNameee{game.errord"getFileCRC32Codeerror1:",fileNamee;returnfileName;}else{letinfo=thisObj.versionConfigInfo.getdfileNamee;letcrc32Code:string=info[0];ifdcrc32Code==nulle{game.errord"getFileCRC32Codeerror2:",fileNamee;returnfileName;}returncrc32Code;}}cc获取文件大小publicstaticgetFileSizedfileName:stringe:number{letthisObj=VersionController;ifdthisObj.versionConfigInfo==nullereturn0;ifd!thisObj.versionConfigInfo.hasdfileNameee{game.errord"getFileSizeerror1:",fileNamee;return1;}else{letinfo=thisObj.versionConfigInfo.getdfileNamee;letsize:number=info[1];ifdsize==nulle{game.errord"getFileSizeerror2:",fileNamee;return1;}returnsize;}}privateconfig_res_type=".res.json";privatepreload_res="preloadc"ccresource根路径privateresourceRoot="resourcec";cchttps根路径privatehttpUrlRoot=VersionController.getHttpUrlde;cc版本控制的文件夹privateversionPath="";cc版本信息保存路径,建议放入resource包里面，因为这个文件每次都需要加载，不需要放在cdn上。privateversionConfigPath="";cc这里每次打开都要清理缓存ccwxgame的当前版本号privatecurrentVersion="1.0.7";cc在游戏开始加载资源的时候就会调用这个函数initde:Promiseaanyb{ifd!VersionController.IsInite{game.errord"Main.PreInithasnotcalled"e;Main.instance.PreInitde;}this.httpUrlRoot=VersionController.getHttpUrlde;game.warnd"httpUrl:",this.httpUrlRoote;this.versionConfigPath=VersionController.getHttpUrlde+VersionController.versionJson;ifdRELEASEe{cc发布模式returnnewPromiseddresolve,rejecte=b{cc通过httpReques获得配置资源信息letrequest=newegret.HttpRequestde;request.responseType=egret.HttpResponseType.TEXT;request.setRequestHeaderd"Content-Type","applicationcx-www-form-urlencoded;charset=UTF-8"e;request.opendthis.versionConfigPath+Utils.GetResVerde,egret.HttpMethod.GETe;request.sendde;request.addEventListenerdegret.Event.COMPLETE,devent:egret.Evente=b{varrequest=aegret.HttpRequestbevent.currentTarget;ccgame.logd"postdata:",request.responsee;VersionController.initConfigInfodrequest.responsee;ccgame.logd"____________读取version.json________",this.versionConfige;cc处理文件资源的缓存cc下面主要是对各种运行时的版本控制，ifdegret.Capabilities.runtimeType==egret.RuntimeType.WXGAMEe{this.versionCacheWxgamede;cc微信小游戏}elseifdegret.Capabilities.runtimeType==egret.RuntimeType.WEBe{this.versionCacheWebde;cc浏览器H5}resolvede;},thise;request.addEventListenerdegret.IOErrorEvent.IO_ERROR,de=b{game.logd"posterror:"+evente;rejectde;},thise;}e}else{ccdebug开发模式returnPromise.resolvede}}c***处理wxgame里面的无效资源*cprivateversionCacheWxgame=de=b{cc简单处理，通过localStorage获取当前游戏版本号resVersion，如果版本号不同，进行删除过期资源操作cc这里开发者可以自己控制版本号，不一定使用localStorageconstlocalVersion=egret.localStorage.getItemd"resVersion"e;ifdlocalVersion!=this.currentVersione{egret.localStorage.setItemd"resVersion",this.currentVersione;game.logd`versionupdatelastVersion：${localVersion}-----nowVersion:${this.currentVersion}`e;cc下面是wxgame提供的api，进行过期缓存资源的移除constfs=wx.getFileSystemManagerde;cc如果是最新的微信支持库请修改file-util.js中localFileMap对应的存储路径，其他版本参照修改constdir=wx.env.USER_DATA_PATH+"ccache_crc32cassets";letfiles=NativeApi.walkFile_wxddire;game.logd"_______读取本地缓存文件数目:__________",filese;constresult=this.getRemoveListdfilese;game.logd"_______需要删除的文件数目:__________",resulte;constlength=result.length;letfilename:string;fordleti=0;ialength;++ie{filename=dir+"c"+result[i];try{game.logd"尝试删除",filenamee;fs.unlinkSyncdfilenamee;}catchdee{game.logd"删除失败原因：",ee;}}ccfs.readdird{ccdirPath:dir,ccsuccess:dee=b{ccconstresult=this.getRemoveListde.filese;ccconstlength=result.length;ccfordleti=0;ialength;++ie{ccgame.logd"删除",dir+"c"+result[i]eccfs.unlinkSyncddir+"c"+result[i]e;cc}cc},ccfail:dee=b{ccccgame.logdee;cc}cc}e;}}c***处理WebH5里面的更新，如果开发者有其他平台发布的版本控制，请参照这两种进行修改*cprivateversionCacheWeb=de=b{cc简单处理，通过localStorage获取当前游戏版本号resVersion，如果版本号不同，进行删除过期资源操作cc这里开发者可以自己控制版本号，不一定使用localStorageconstlocalVersion=egret.localStorage.getItemd"resVersion"e;ifdlocalVersion!=this.currentVersione{egret.localStorage.setItemd"resVersion",this.currentVersione;game.logd"Web版本更新"e;}}c***获得上版本的过期资源列表，提高效率使用字符串的形式进行比对*cprivategetRemoveListdfiles:Arrayastringbe:Arrayastringb{constresult=[];letstr="";letkeys=VersionController.versionConfigInfo.keysde;fordconstkeyofkeyse{letvalue=VersionController.versionConfigInfo.getdkeye;str+=value[0]+",";}constlength=files.length;fordleti=0;ialength;++ie{constitem=files[i];constcrc32=item.sliced0,item.indexOfd"."ee;ifdstr.indexOfdcrc32e==-1e{result.pushditeme;}}returnresult;}cc在游戏运行时，每个资源加载url都要经过这个函数getVirtualUrldurl:stringe{cc在开发模式下，所有资源还是以原来的资源路径去加载，方便开发者替换资源ifdRELEASEe{ifdegret.Capabilities.runtimeType==egret.RuntimeType.WXGAMEereturnthis.getResUrl_WxGamedurle;elsereturnthis.getResUrl_WebGamedurle;}else{returnurl;}}getResUrl_WebGamedurl:stringe:string{ccdefault_res.jsonconfig_res.json等资源走这里ifdurl.indexOfdthis.config_res_typee!=-1e{ccgame.logd"___getResUrl_Web___111111_________________",urle;returnurl;}cc将文件的resourceRoot路径抹去，进而判读文件是否经过版本管理url=url.replacedthis.httpUrlRoot,""e;url=url.replacedthis.resourceRoot,""e;letconfigInfo=VersionController.versionConfigInfo;ifdconfigInfo!=nulle{cc部分文件可能存在？v=加数字进行控制的形式，在引擎底层这里是不支持加v=的，只会以原始url加载路径，cc如果项目中存在类似的情况，将其还原成普通形式constindex=url.indexOfd"?v="e;ifdindex!=-1e{url=url.sliced0,indexe;}cc取版本控制的的versionletversionKey=url;letcrc32Code=VersionController.getFileCRC32CodedversionKeye;ifdcrc32Code!=nulle{constext=url.slicedurl.lastIndexOfd"."ee;constpath=url.sliced0,url.lastIndexOfd"c"e+1e;cc原始的文件夹+crc32码+后缀扩展名url=path+crc32Code+ext;ccgame.logd"___getResUrl_WebGame___444444_________________",this.httpUrlRoot+urle;returnthis.httpUrlRoot+url;}}url=this.httpUrlRoot+url;ccgame.logd"____getResUrl_WebGame___555555_________________",urle;returnurl;}c***获得版本控制之后的路径信息*cgetResUrl_WxGamedurl:stringe:string{game.logd"____getResUrl_WxGamen___111_________________",urle;cc判断是否为版本控制的资源，其他域的资源，比如玩家头像，或是初始包体里面的资源以原始url加载dpreload里面的资源走这里eifdurl.indexOfdthis.preload_rese!=-1e{url=url.replacedthis.httpUrlRoot,this.resourceRoote;game.logd"___getResUrl_WxGame___2222222_________________",urle;returnurl;}ccifdurl.indexOfdthis.httpUrlRoote==-1ecc{ccgame.logd"____getResUrl_WxGame__22222_________________",urle;ccreturnurl;cc}ccdefault_res.jsonconfig_res.json等资源走这里ifdurl.indexOfdthis.config_res_typee!=-1e{game.logd"___getResUrl_WxGame___333333_________________",urle;returnurl;}cc将文件的resourceRoot路径抹去，进而判读文件是否经过版本管理url=url.replacedthis.httpUrlRoot,""e;url=url.replacedthis.resourceRoot,""e;letconfigInfo=VersionController.versionConfigInfo;ifdconfigInfo!=nulle{cc部分文件可能存在？v=加数字进行控制的形式，在引擎底层这里是不支持加v=的，只会以原始url加载路径，cc如果项目中存在类似的情况，将其还原成普通形式constindex=url.indexOfd"?v="e;ifdindex!=-1e{url=url.sliced0,indexe;}cc取版本控制的的versionletversionKey=url;letcrc32Code=VersionController.getFileCRC32CodedversionKeye;ifdcrc32Code!=nulle{constext=url.slicedurl.lastIndexOfd"."ee;constpath=url.sliced0,url.lastIndexOfd"c"e+1e;cc原始的文件夹+crc32码+后缀扩展名url=path+crc32Code+ext;game.logd"___getResUrl_WxGame___444444_________________",this.httpUrlRoot+urle;returnthis.httpUrlRoot+url;}}url=this.httpUrlRoot+url;game.logd"____getResUrl_WxGame___555555_________________",urle;returnurl;}}}cc在最开始将AssetsManager的默认版本控制替换掉RES.registerVersionControllerdnewgame.VersionControllerdee;ifdegret.Capabilities.runtimeType==egret.RuntimeType.WXGAMEe{window["RoleInfo"]=game.RoleInfo;window["game"]=game;window["SButton"]=SButton;window["SBitmap"]=SBitmap;window["SGroup"]=SGroup;window["SInputLabel"]=SInputLabel;}classTestBase{publica:number;publicconstructorda:numbere{this.a=a;}publictestde:number{game.logd"test........",this.ae;returnthis.a;}}classMainextendseui.UILayer{publicstaticinstance:Main;protectedcreateChildrende:void{super.createChildrende;window.onerror=functiondmsg,url,line,col,errore{cccc没有URL不上报！上报也不知道错误ccifdmsg!="Scripterror."&&!urle{ccreturntrue;cc}cc采用异步的方式cc我遇到过在window.onunload进行ajax的堵塞上报cc由于客户端强制关闭webview导致这次堵塞上报有NetworkErrorcc我猜测这里window.onerror的执行流在关闭前是必然执行的cc而离开文章之后的上报对于业务来说是可丢失的cc所以我把这里的执行流放到异步事件去执行cc脚本的异常数降低了10倍setTimeoutdfunctionde{ifd!!error&&!!error.stacke{cc如果浏览器有堆栈信息cc直接使用ccgame.errordmsg,error.stacke;game.ErrorManager.UnCacheExceptiondmsg,error.stacke;cc把data上报到后台！}},0e;returntrue;};Main.instance=this;egret.lifecycle.addLifecycleListenerddcontexte=b{cccustomlifecycleplugin}eegret.lifecycle.onPause=de=b{ccegret.ticker.pausede;ccGameData.OnPausede;}egret.lifecycle.onResume=de=b{ccegret.ticker.resumede;ccGameData.OnResumede;}this.PreInitde;this.DelayInitde;}publicPreInitde{game.VersionController.httpUrl_wx=egret["httpUrl_wx"]!=null?egret["httpUrl_wx"]:"resourcec";;cc"https:ccstd-game-china.oss-cn-beijing.aliyuncs.comcgamecminiGamecresourcec";game.VersionController.httpUrl_web=egret["httpUrl_web"]!=null?egret["httpUrl_web"]:"resourcec";game.VersionController.defaultResJson=egret["default.res.json"]!=null?egret["default.res.json"]:"default.res.json";game.VersionController.configResJson=egret["config.res.json"]!=null?egret["config.res.json"]:"config.res.json";game.VersionController.homeResJson=egret["home.res.json"]!=null?egret["home.res.json"]:"home.res.json";game.VersionController.warResJson=egret["war.res.json"]!=null?egret["war.res.json"]:"war.res.json";game.VersionController.defaultThmJson=egret["default.thm.json"]!=null?egret["default.thm.json"]:"default.thm.json";game.VersionController.versionJson=egret["version.json"]!=null?egret["version.json"]:"version.json";game.VersionController.httpUrl_dev="resourcec";egret.ImageLoader.crossOrigin="anonymous";game.warnd"httpUrl_wx:",game.VersionController.httpUrl_wxe;game.warnd"httpUrl_web:",game.VersionController.httpUrl_webe;game.warnd"defaultResJson:",game.VersionController.defaultResJsone;game.warnd"configResJson:",game.VersionController.configResJsone;game.warnd"homeResJson:",game.VersionController.homeResJsone;game.warnd"warResJson:",game.VersionController.warResJsone;game.warnd"defaultThmJson:",game.VersionController.defaultThmJsone;game.warnd"versionJson:",game.VersionController.versionJsone;game.VersionController.IsInit=true;}privateDelayInitde{ccinjectthecustommaterialparsercc注入自定义的素材解析器letassetAdapter=newAssetAdapterde;egret.registerImplementationd"eui.IAssetAdapter",assetAdaptere;egret.registerImplementationd"eui.IThemeAdapter",newThemeAdapterdee;RES.processor.mapd"proto",ProtoAnalyzere;ifd!egret["isEditor"]e{GameData.DevelopMode=DevelopMode.Publish;GameData.IsSelfAI=false;GameData.IsOtherAI=true;GameData.LocalTest=false;GameData.EditorMode=false;GameData.ReplayMode=false;GameData.SpeedUpMode=false;}game.DataBase.Initde;IDManager.NewKeyIDde;game.GlobalEvent.Initde;game.UIManager.Initde;JsonData.Initde;this.LoadFontde;this.LoadConfigde;game.SceneManager.GetInstancede;ClientNet.LogNetManager.GetInstancede.Initde;game.HomeServerTime.SetServerTimednewDatede.getTimedee;ccthread.ClientMain.GetIntancede;this.TestDrawde;this.addEventListenerdegret.Event.RESIZE,this.OnReSize,thise;}privateOnReSizede{game.SceneManager.GetInstancede.AutoScalede;ccgame.logd"---------OnReSizeOnReSizeOnReSizeOnReSize---bbbbbbbbbbbbbbbbbbbbbbbbbbb",this.stage.stageHeight,this.stage.stageWidthe;}privateTestDrawde{}privateDownload2de{game.NetUtil.DownloadFromPHPd"2019-05-1615:59:53",ddata:anye=b{letab=egret.Base64Util.decodeddatae;letbyteArray:egret.ByteArray=newegret.ByteArraydabe;letframeLen=byteArray.readShortde;letframe=byteArray.readShortde;letrandomeSeed=byteArray.readUnsignedIntde;letfighg_id=byteArray.readUnsignedIntde;game.logd"-----------",frameLen,frame,"--------bbbbbbbbbbbbbbbbbbbb",randomeSeed,fighg_ide;},thise;}privateDownloadde{ccletbuffArray=newegret.ByteArrayde;ccbuffArray.writeIntd23e;ccbuffArray.writeDoubled342.1231411e;ccletbase64Str=egret.Base64Util.encodedbuffArray.buffere;letfileName="record123.bin";ccleturl="http:cc122.152.230.16ctestfile.php";leturl="http:cc192.168.21.77:6555cprocess";game.Http.Createde.Successdddata:anye=b{letab=egret.Base64Util.decodeddatae;letbyteArray:egret.ByteArray=newegret.ByteArraydabe;letintNum=byteArray.readIntde;letdoubleNum=byteArray.readDoublede;game.logd"------------downloadSuccess...............",intNum,doubleNume;},thise.Faildde=b{game.logd"------------Fail..............."e;},thise.DataFormatdegret.URLLoaderDataFormat.TEXTe.Addd`type=read&name=${fileName}`e.Postdurle;}privateUpload3de{letbuffArray=newegret.ByteArrayde;buffArray.writeIntd0e;buffArray.writeIntd0e;fordleti=0;ia50;i++ebuffArray.writeDoubled342.1231411e;letbase64Str=egret.Base64Util.encodedbuffArray.buffere;letfileName="hszzcrecordcrecord123.bin";leturl="http:cc192.168.21.77:6555cprocess";ccleturl="http:cc192.168.21.77:6555cprocess";ccleturl="http:cc94.191.120.119:6555cprocess";game.Http.Createde.Successdddata:anye=b{game.logd"------------Upload3Success..-------------------------------.............",datae;},thise.Faildddata:anye=b{game.logd"------------Fail...............",datae;},thise.DataFormatdegret.URLLoaderDataFormat.TEXTe.Addd`type=15&index=${1}&file=nihaonihaonihanihaoasdfsdfsdf&name=${fileName}`ecc.Addd`type=${HttpConst.WriteFile}&index=${1}&file=nihaonihaonihanihaoasdfsdfsdf&name=${fileName}`e.Postdurle;}privateUploaddindex:number,content:string,cb:Function,thisObj:anye{letbuffArray=newegret.ByteArrayde;buffArray.writeIntd0e;buffArray.writeIntd0e;fordleti=0;ia50;i++ebuffArray.writeDoubled342.1231411e;letbase64Str=egret.Base64Util.encodedbuffArray.buffere;letfileName="record123.bin";leturl=GameData.PHPURL;game.Http.Createde.Successdddata:anye=b{ifdindex==999egame.logd"------------uploadSuccess...............",index,"---",data,egret.getTimerdee;ifdcb!=nullecb.calldthisObj,indexe;},thise.Faildddata:anye=b{game.logd"------------Fail...............",index,datae;},thise.DataFormatdegret.URLLoaderDataFormat.TEXTe.Addd`type=write&index=${index}&file=${base64Str}&name=${fileName}`e.Postdurle;}privateUpload2de{letbuffArray=newegret.ByteArrayde;buffArray.writeIntd0e;buffArray.writeIntd0e;buffArray.writeDoubled342.1231411e;letbase64Str=egret.Base64Util.encodedbuffArray.buffere;letbuffStr=String.fromCharCode.applydnull,newUint8ArraydbuffArray.bufferee;letfileName="record123.bin";ccleturl="http:cc122.152.230.16ctestfile.php";leturl=GameData.PHPURL;game.Http.Createde.Successdddata:anye=b{game.logd"------------uploadSuccess...............","---",datae;},thise.Faildde=b{game.logd"------------Fail..............."e;},thise.DataFormatdegret.URLLoaderDataFormat.TEXTe.Addd`type=write&index=${1}&file=${base64Str}&name=${fileName}`e.Postdurle;}publicLoadFontde{letlabel=neweui.Labelde;label.text="1";label.fontFamily="main_font";label.visible=false;this.addChilddlabele;ccthis.removeChilddlabele;letlabel1=neweui.Labelde;label1.text="1";label1.fontFamily="desc_font";label1.visible=false;this.addChilddlabel1e;ccthis.removeChilddlabel1e;}privateLoadConfigde{game.logd"-------LoadConfig------------------------------------------------"e;ccthis.ExtractClassInfode;letresVer=game.Utils.GetResVerde;ResUtils.GetInstancede.AddConfigdgame.VersionController.defaultResJson+resVer,game.VersionController.getHttpUrldee;ResUtils.GetInstancede.AddConfigdgame.VersionController.configResJson+resVer,game.VersionController.getHttpUrldee;ResUtils.GetInstancede.AddConfigdgame.VersionController.homeResJson+resVer,game.VersionController.getHttpUrldee;ResUtils.GetInstancede.AddConfigdgame.VersionController.warResJson+resVer,game.VersionController.getHttpUrldee;ResUtils.GetInstancede.LoadConfigdthis.LoadPreload,thise;}privateExtractClassInfodpathUrl:string="cdocctoolscautoimportcbaseClass.json"e{function_parseObjectdparentKey,parent:any,key:string,obj:any,classInfo:any[]e{letsType=game.Utils.GetTypedobje;ifdsType=="function"||sType=="enum"||key=="Const"e{letmapObj={"function":"object","object":"module","enum":"enum"};sType=mapObj[sType];ifdobj.prototype==null&&sType!="enum"esType="value";ifdobj.prototype!=null&&obj.prototype.__class__==nullesType="function";classInfo.pushd[parentKey,key,sType]e;}elseifdsType=="object"e{game.errord"类名嵌套不能超过三层.......",keye;}else{game.logd"------unKnowtype222222:",key,obje;}}function_parseClassInfoddata:stringe{letbaseClassInfo=JSON.parseddatae;letgameClassInfo=[]fordletkeyinglobale{ifdbaseClassInfo[key]!=nullecontinue;letvalue=global[key];ifdvalue==nullecontinue;letsType=game.Utils.GetTypedvaluee;ifdsType=="function"||sType=="enum"||key=="Const"e{_parseObjectd"",global,key,value,gameClassInfoe;}elseifdsType=="object"e{fordletkey1invaluee{letvalue1=value[key1];_parseObjectdkey,value,key1,value1,gameClassInfoe;}}else{game.logd"------unKnowtype1111111111:",key,valuee;}}letgameStr=JSON.stringifydgameClassInfoe;console.logdgameStre;}ifd!egret["isEditor"]ereturn;letnowUrl=window.document.location.href.toStringde;nowUrl=nowUrl.replaced"cindex.html",""e;letbaseUrl=nowUrl+pathUrl;letthisObj=this;game.HttpRequest.Createde.Successdddatae=b{_parseClassInfoddatae;},thise.Faildde=b{letpathUrl2="c文档ctoolscautoimportcbaseClass.json";ifdpathUrl==pathUrl2ereturn;thisObj.ExtractClassInfodpathUrl2e},thise.DataFormatdegret.HttpResponseType.TEXTe.GetdbaseUrle;}privateLoadPreloadde{ResUtils.GetInstancede.LoadGroupd["preload"],this.EnterHome,thise;}privateEnterHomede{cc记录各个场景的资源组引用ResUtils.GetInstancede.InitSceneConfigde;game.SceneManager.GetInstancede.EnterGamede;ccvarurl=window.document.location.href.toStringde;ccconsole.logd"浏览器地址："+urle;}privateloadThemede{returnnewPromiseddresolve,rejecte=b{ccloadskinthemeconfigurationfile,youcanmanuallymodifythefile.Andreplacethedefaultskin.cc加载皮肤主题配置文件,可以手动修改这个文件。替换默认皮肤。lettheme=neweui.Themed"resourcecdefault.thm.json",this.stagee;theme.addEventListenerdeui.UIEvent.COMPLETE,de=b{resolvede;},thise;}e}}c***主界面管理类*bydily*dcecopyright2014-2035*AllRightsReserved.*所有的弹窗都需要在register注册事件*在execute添加消息处理面板打开关闭事件*cmodulegame{exportclassMainUINewCextendsUICtrlBase{publicstaticmainUI:MainUINew;publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.mainLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnMainUINew;}cc做一下类型转换方便调用一定要有!!!protectedgetmainUINewPanelde{returnaMainUINewbthis.panel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,falsee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld0e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}}}﻿moduleECS{exportclassCommandPack{cc将指令和数据打包成bytepublicstaticPackdaction:number,fightRoleId:number,minFrame:number,args:anye:Uint8Array{letbyteArray=newegret.ByteArrayde;byteArray.writeShortdactione;byteArray.writeDoubledfightRoleIde;byteArray.writeShortdminFramee;ifdaction==CommandType.AddHeroe{letheroID=args[0];letx=args[1];lety=args[2];letcmdID=args[3];letindex=args[4];letcardID=args[5];byteArray.writeIntdheroIDe;byteArray.writeShortdxe;byteArray.writeShortdye;byteArray.writeIntdcmdIDe;cc唯一标识操作的IDcccccccccccccccc这里注意长度byteArray.writeShortdindexe;cc英雄图标在拖拽栏的索引byteArray.writeIntdcardIDe;cc唯一标识previewCard的IDccgame.logd"pack:",action,fightRoleId,heroID,x,y,cmdID,index,"_____________________________________________"e;}elseifdaction==CommandType.AddSpelle{letspellID=args[0];letx=args[1];lety=args[2];letcmdID=args[3];letindex=args[4];letcardID=args[5];byteArray.writeIntdspellIDe;byteArray.writeShortdxe;byteArray.writeShortdye;byteArray.writeIntdcmdIDe;cc唯一标识操作的IDbyteArray.writeShortdindexe;cc英雄图标在拖拽栏的索引byteArray.writeIntdcardIDe;cc唯一标识previewCard的IDccgame.logd"pack:",action,fightRoleId,heroID,x,y,cmdID,index,"_____________________________________________"e;}elseifdaction==CommandType.UseSkille{letid=args[0];letcmdID=args[1];letindex=args[2];byteArray.writeIntdide;byteArray.writeShortdcmdIDe;byteArray.writeShortdindexe;cc英雄图标在拖拽栏的索引}elseifdaction==CommandType.Nonee{byteArray.writeIntd0e;}else{game.warnd"Packunknowtype:",actione;}returnbyteArray.bytes;}cc解包服务器下发的指令和数据publicstaticUnPackdargs:Uint8Arraye:any{letbyteArray=newegret.ByteArraydargse;ifdbyteArray.length==0ereturn0;letaction=byteArray.readShortde;letfightRoleId=byteArray.readDoublede;letminFrame=byteArray.readShortde;ifdaction==CommandType.AddHeroe{letheroID=byteArray.readIntde;letx=byteArray.readShortde;lety=byteArray.readShortde;letcmdID=byteArray.readIntde;letindex=byteArray.readShortde;letcardID=byteArray.readIntde;byteArray.clearde;ccgame.logd"UnPack:",action,fightRoleId,heroID,x,y,cmdID,index,"_____________________________________________"e;return[action,fightRoleId,minFrame,[heroID,x,y,cmdID,index,cardID]];}elseifdaction==CommandType.AddSpelle{letheroID=byteArray.readIntde;letx=byteArray.readShortde;lety=byteArray.readShortde;letcmdID=byteArray.readIntde;letindex=byteArray.readShortde;letcardID=byteArray.readIntde;byteArray.clearde;ccgame.logd"UnPack:",action,fightRoleId,heroID,x,y,cmdID,index,"_____________________________________________"e;return[action,fightRoleId,minFrame,[heroID,x,y,cmdID,index,cardID]];}elseifdaction==CommandType.UseSkille{letid=byteArray.readIntde;letcmdID=byteArray.readIntde;letindex=byteArray.readShortde;byteArray.clearde;return[action,fightRoleId,minFrame,[id,cmdID,index]];}elseifdaction==CommandType.Nonee{byteArray.clearde;return0;}else{byteArray.clearde;game.warnd"UnPackunknowtype:",actione;return0;}}publicstaticPackToJsondaction:number,fightRoleId:number,minFrame:number,args:anye:any[]{return[action,fightRoleId,minFrame,args];}cc处理服务器发送过来的帧数据publicstaticProcessServerActiondworldObj:LogicWorld,actionArray:Protocol.IAction_Response[],maxFrame:numbere{letplayerList=worldObj.GetPlayerListde;letpcrcList:PlayerCommandRecordComponent[]=[];letpcrcMap:SMapanumber,PlayerCommandRecordComponentb=newSMapanumber,PlayerCommandRecordComponentbde;cc处理空帧fordletentityofplayerListe{letpcrc:PlayerCommandRecordComponent=aPlayerCommandRecordComponentbentity.GetCompdComponentType.PlayerCommandRecordComponente;pcrcList.pushdpcrce;pcrcMap.setdpcrc.id,pcrce;ifdmaxFrame==0ecc单个帧操作{cc先给所有的帧一个空操作fordletactionofactionArraye{letframe=action.frame;letcmd=pcrc.GetInputCachedframee;ifdcmd==nullecc这一帧没有操作的玩家给一个空帧{cmd=aCommandComponentbWarFactory.CreateComponentdComponentType.CommandComponent,worldObje;cmd.id=pcrc.id;cmd.frame=frame;cmd.entity=entity;pcrc.RecordCommanddcmde;}}}elsecc重连或者回放的帧操作{cc先给所有的帧一个空操作fordletframe=1;framea=maxFrame;frame++e{letcmd=pcrc.GetInputCachedframee;ifdcmd==nullecc这一帧没有操作的玩家给一个空帧{cmd=aCommandComponentbWarFactory.CreateComponentdComponentType.CommandComponent,worldObje;cmd.id=pcrc.id;cmd.frame=frame;cmd.entity=entity;pcrc.RecordCommanddcmde;}}}cc先给所有的帧一个空操作fordletframe=1;framea=maxFrame;frame++eccfordletactionofactionArraye{letcmd=pcrc.GetInputCachedframee;ifdcmd==nullecc这一帧没有操作的玩家给一个空帧{cmd=aCommandComponentbWarFactory.CreateComponentdComponentType.CommandComponent,worldObje;cmd.id=pcrc.id;cmd.frame=frame;cmd.entity=entity;pcrc.RecordCommanddcmde;}}}letframe:number=0;cc记录真实的帧数据fordletactionObjofactionArraye{fordletactionArgsofactionObj.actionArraye{letactionInfo=CommandPack.UnPackdactionArgse;cc如果是无指令的空帧直接返回0ifdactionInfo==0econtinue;letactionType=actionInfo[0];letfightRoleId=actionInfo[1];letminFrame=actionInfo[2];letargs=actionInfo[3];letpcrc=pcrcMap.getdfightRoleIde;ifdpcrc==nulle{game.errord"ProcessServerActionfightRoleIdnotfound:",fightRoleIde;continue;}frame=actionObj.frame;ifdframeaminFrameecc如果服务器的发过来的帧小于当前操作要求的最小帧则延迟到操作所需最小帧执行frame=minFrame;letcmd=pcrc.GetInputCachedframee;ifdcmd==nulle{cmd=aCommandComponentbWarFactory.CreateComponentdComponentType.CommandComponent,worldObje;cmd.id=pcrc.id;cmd.frame=frame;cmd.entity=pcrc.entity;pcrc.RecordCommanddcmde;}cmd.AddCmdDatadactionType,args,minFramee;}}}}}﻿c***网络公共类*bydily*dcecopyright2014-2035*AllRightsReserved.*存放网络公共方法*注意：是同步请求，不是异步*cmoduleClientNet{classCallbackInfo{publicstartTime:number;publicfunc:Function;publicthisObj:any;publicargs:any;publicconstructorde{this.startTime=0;}publicIsTimeOutde:boolean{returnegret.getTimerde-this.startTimeb10000;}publicExecd...args:any[]e:number{letdt=egret.getTimerde-this.startTime;ccifdegret.getTimerde-this.startTimeb10000ecc{ccconsole.logd"-----------------------回调时间延迟:--",egret.getTimerde-this.startTimee;cc}ifdthis.func!=nullethis.func.calldthis.thisObj,args[0],args[1],args[2]e;this.func=null;this.thisObj=null;returndt;}publicGetDelayTimede:number{returnegret.getTimerde-this.startTime;}publicDestroyde{this.func=null;this.thisObj=null;this.args=null;}}exportclassLogNetManager{publicstaticinstance:LogNetManager;publicstaticGetInstancede:LogNetManager{ifdLogNetManager.instance==nulle{LogNetManager.instance=newLogNetManagerde;}returnLogNetManager.instance;}privatetimerKey:number;privatesock:egret.WebSocket=newegret.WebSocketde;privateip:string;privateport:number;publicisConnected:boolean;privateisConnecting:boolean;publicisLogined:boolean=false;privateuserName:string;privatecallbackInfoMap:SMapanumber,CallbackInfob;privaterequestHeartTimeCount:number;publicconstructorde{this.isConnected=false;this.isConnecting=false;this.isLogined=false;this.callbackInfoMap=newSMapanumber,CallbackInfobde;this.requestHeartTimeCount=0;this.userName=null;}publicInitde{this.Disposede;this.timerKey=game.TimerMgr.GetInstancede.AddTimerd100,this.ProcessMessage,thise;}publicDisposede{ifdthis.timerKey!=nulle{game.TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=null;}this.DisposeSocketde;}publicCheckConnectde{ifdthis.ip!=GameData.LogSocketURL||this.port!=GameData.LogSocketPorte{console.logd"---GameData.LogSocketURL------CheckConnect--bbbbbbbbbbbbbbbbbbb"e;}else{ifdthis.isConnectedereturn;ifdthis.isConnectingereturn;}this.ConnectServerdGameData.LogSocketURL,GameData.LogSocketPorte;ccthis.ConnectServerd"127.0.0.1","6555"e;}publicConnectServerdhost:string="",port:number=80e{this.DisposeSocketde;this.sock=newegret.WebSocketde;this.sock.type=egret.WebSocket.TYPE_BINARY;this.sock.addEventListenerdegret.ProgressEvent.SOCKET_DATA,this.OnReceiveMessage,thise;this.sock.addEventListenerdegret.Event.CONNECT,this.OnSocketOpen,thise;this.sock.addEventListenerdegret.Event.CLOSE,this.OnSocketClose,thise;this.sock.addEventListenerdegret.IOErrorEvent.IO_ERROR,this.OnSocketError,thise;this.ip=host;this.port=port;console.logd"LogServerConnectServer------bbbbbbbbbbbbbbb",host,port,GetThreadNamedee;this.isConnecting=true;this.isConnected=false;this.isLogined=false;this.sock.connectdhost,porte;}publicDisposeSocketde{console.logd"___________DisposeLogSocket_________________",GetThreadNamedee;this.isConnected=false;this.isConnecting=false;this.isLogined=false;ifdthis.sock!=nulle{this.sock.removeEventListenerdegret.ProgressEvent.SOCKET_DATA,this.OnReceiveMessage,thise;this.sock.removeEventListenerdegret.Event.CONNECT,this.OnSocketOpen,thise;this.sock.removeEventListenerdegret.Event.CLOSE,this.OnSocketClose,thise;this.sock.removeEventListenerdegret.IOErrorEvent.IO_ERROR,this.OnSocketError,thise;this.sock.closede;this.sock=null;}fordletcbInfoofthis.callbackInfoMap.valuesdee{cbInfo.Destroyde;}this.callbackInfoMap.clearde;this.requestHeartTimeCount=0;}cc连接成功返回publicOnSocketOpende:void{console.logd"____LogNetManager____OnSocketOpen______________",GetThreadNamedee;this.isConnected=true;this.isConnecting=false;this.isLogined=false;ifdthis.userName!=nullethis.SendLoginMessagedthis.userNamee;}publicOnSocketClosede:void{console.logd"___LogNetManager____OnSocketClose____________",GetThreadNamede,newErrorde.stacke;this.DisposeSocketde;}publicOnSocketErrorde:void{console.logd"___LogNetManager____OnSocketError____________",GetThreadNamede,newErrorde.stacke;this.DisposeSocketde;}cc消息返回publicOnReceiveMessagede:void{ccGlobal.HideWaitPanelde;let_arr:egret.ByteArray=newegret.ByteArrayde;this.sock.readBytesd_arre;letlength=_arr.readIntde;cc协议长度letmainId=_arr.readShortde;ccconsole.logd"------------LogNetManager.OnReceiveMessage-----bbbbbbbbbbbbbbbbbbbbb",mainIde;ifdmainId==1ecc登录{letsubId=_arr.readIntde;this.isLogined=true;ccconsole.logd"----OnReceiveMessage--1111111-bbbbbbbbbbbbbbbbbbb",mainId,subIde;}elseifdmainId==2ecc数据{letsubId=_arr.readIntde;letstr=_arr.readUTFBytesdlength-6e;letcbInfo=this.callbackInfoMap.getdsubIde;ifdcbInfo!=nulle{letdt=cbInfo.Execd1,stre;this.callbackInfoMap.deletedsubIde;ccconsole.logd"------收到写文件回包-延迟时间:",subId,dte;}ccconsole.logd"----OnReceiveMessage--222222-bbbbbbbbbbbbbbbbbbb",mainId,subId,stre;}elseifdmainId==3ecc心跳{letsubId=_arr.readIntde;letcbInfo=this.callbackInfoMap.getdsubIde;ifdcbInfo!=nulle{letdt=cbInfo.Execd1e;ccconsole.logd"------收到log服心跳包-延迟时间:",subId,dte;this.callbackInfoMap.deletedsubIde;}else{ccconsole.logd"------------收到log服心跳包-无回调----bbbbbbbbbbbbbbbbbbbbb",subIde;}this.requestHeartTimeCount--;ifdthis.requestHeartTimeCounta0ethis.requestHeartTimeCount=0;}}cc发送登录信息publicSendLoginMessageduserName:stringe:boolean{this.userName=userName;ifd!this.isConnectedereturnfalse;letsendMsg:egret.ByteArray=newegret.ByteArrayde;letlen:number=userName.length;sendMsg.writeIntdlen+2e;cc协议长度letmainId=1;sendMsg.writeShortdmainIde;sendMsg.writeUTFBytesduserNamee;this.sock.writeBytesdsendMsg,0,sendMsg.lengthe;returntrue;}cc发送登录信息publicSendHeartBeatMessagedfunc:Function,thisObj:anye:boolean{ifd!this.isConnectedereturnfalse;letsendMsg:egret.ByteArray=newegret.ByteArrayde;sendMsg.writeIntd2+4e;cc协议长度letmainId=3;sendMsg.writeShortdmainIde;letsubId=IDManager.NewKeyIDde;sendMsg.writeIntdsubIde;cc处理回调开始---------------------------------------------ifdfunc!=nulle{letcbInfo=newCallbackInfode;cbInfo.startTime=egret.getTimerde;cbInfo.func=func;cbInfo.thisObj=thisObj;this.callbackInfoMap.setdsubId,cbInfoe;}cc处理回调结束---------------------------------------------this.sock.writeBytesdsendMsg,0,sendMsg.lengthe;ccconsole.logd"------------发送log服心跳包-----bbbbbbbbbbbbbbbbbbbbb",mainId,subIde;returntrue;}cc发送日志publicSendLogMessageditype:number,args:string[],func:Function,thisObj:anye:boolean{ifd!this.isConnected||!this.isLoginedereturnfalse;letsendMsg:egret.ByteArray=newegret.ByteArrayde;letlen:number=0;letlenArray:number[]=[];fordletstrofargse{letstrLen=game.Utils.GetStringLendstre;lenArray.pushdstrLene;len+=strLen+2;}sendMsg.writeIntdlen+8e;cc协议长度letmainId=2;sendMsg.writeShortdmainIde;cc协议号ccletsubId=IDManager.NewTestIDde;letsubId=IDManager.NewKeyIDde;cc处理回调开始---------------------------------------------ifdfunc!=nulle{letcbInfo=newCallbackInfode;cbInfo.startTime=egret.getTimerde;cbInfo.func=func;cbInfo.thisObj=thisObj;cbInfo.args=newErrorde.stack;this.callbackInfoMap.setdsubId,cbInfoe;}cc处理回调结束---------------------------------------------sendMsg.writeIntdsubIde;cc子协议号sendMsg.writeShortditypee;cc类型letindex=0;fordletstrofargse{letstrLen=lenArray[index];sendMsg.writeShortdstrLene;sendMsg.writeUTFBytesdstre;index++;}ccconsole.logd"----发送写文件协议----bbbbbbbbbbbbbbbbbbbbb协议号:",subId,"协议长度:",sendMsg.length,"itype:",itypee;this.sock.writeBytesdsendMsg,0,sendMsg.lengthe;ccthis.sock.flushde;returntrue;}privateCheckHeartBeatde{letret=this.SendHeartBeatMessagedde=b{},thise;ifdrete{this.requestHeartTimeCount++;ifdthis.requestHeartTimeCountb3ethis.OnSocketClosede;}ccletret=this.SendLogMessagedHttpConst.HeartBeat,[],de=b{ccthis.requestHeartTimeCount--;ccifdthis.requestHeartTimeCounta0eccthis.requestHeartTimeCount=0;cc},thise;ccifdretecc{ccthis.requestHeartTimeCount++;ccifdthis.requestHeartTimeCountb2eccthis.OnSocketClosede;cc}}privatetestString:string;privatetestSubId=1;privateSendTestLogde{ifd!this.isLoginedereturn;ifdthis.testString==nulle{letstr="";fordleti=0;ia2200;i++e{str+="sjdkshfiejhghsjdkshfiejhghrrrr";}this.testString=str;}this.SendLogMessaged1,[this.testString],de=b{},thise;}privatetimeCount:number=0;privateProcessMessagede{ifdGameData.LocalTestereturntrue;this.timeCount++;ifdthis.timeCount%30==0&&this.isConnectede{this.CheckHeartBeatde;}ccfordleti=0;ia10;i++eccthis.SendTestLogde;ifdthis.timeCount%10==0e{letcallbackInfoMap=this.callbackInfoMap;letdelKeys:number[]=[];fordletkeyofcallbackInfoMap.keysdee{letvalue=callbackInfoMap.getdkeye;ifdvalue.IsTimeOutdee{letdt=value.Execd0e;console.logd"----------服务器会包超时:subId:",key,"time:",dt,value.args,GetThreadNamedee;delKeys.pushdkeye;ccTipsManager.ShowTipsd`数据包丢失subId:${key}`,1,null,0,10000e;}}fordletkeyofdelKeyse{callbackInfoMap.deletedkeye;}}this.CheckConnectde;returntrue;}}}﻿moduleClientNet{exportclassNetChat{publicstaticInitde{NetManager.RegisterCallbackdProtocol.MessageID.GM_COMMAND_RES,NetChat.S2CGMCommande;}publicstaticDisposede{NetManager.UnSubscribedProtocol.MessageID.GM_COMMAND_RESe;}publicstaticS2CGMCommanddcmdDataBA:egret.ByteArraye{cclettaskData=Protocol.TaskChange_Respond.decodedcmdDataBA.bytese;ccNetTask.RefreshTasksdtaskData.taskse;}ccC2S-----------ccccccccccccccccccccpublicstaticC2SGMCommanddcmd:stringe{game.logd"C2SGMCommand------------",cmde;letsendData=newProtocol.GMCommand_Requestde;sendData.command=cmd;letsendByte=Protocol.GMCommand_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.GM_COMMAND_REQ,sendBytee;}}}﻿moduleClientNet{exportclassNetCommon{publicstaticInitde{NetManager.RegisterCallbackdProtocol.MessageID.ERROR_NOTICE_RES,NetCommon.S2CErrorCodee;}publicstaticDisposede{NetManager.UnSubscribedProtocol.MessageID.ERROR_NOTICE_RESe;}publicstaticS2CErrorCodedcmdDataBA:egret.ByteArraye{letinfo=Protocol.ErrorNotice_Respond.decodedcmdDataBA.bytese;lettext=Const.ErrorCode[info.errorCode];ifdtext==nulle{text=LanUtil.GetFormatd`无法识别的错误码:{0}`,info.errorCodee;}game.TipsManager.ShowTipsdtexte;}ccC2S-----------cccccccccccccccccccc}}﻿modulegame{exportclassNetConst{publicstaticserverArray:any[]=[];publicstaticInitde{ccletdata:any={};ccdata.ip="192.168.21.76"ccdata.port="7777"ccdata.name="孙凯服"ccNetConst.serverArray.pushddatae;NetConst.serverArray=[];letdataProxy=JsonData.getGameDatad"serverdata_json"e;letserverDataArray=dataProxy["list"];fordletserverDataofserverDataArraye{letdata:any={};data.ip=serverData["ip"];data.port=serverData["port"];data.name=serverData["name"];NetConst.serverArray.pushddatae;}}publicstaticDisposede{NetConst.serverArray.length=0;}}}﻿moduleClientNet{exportclassNetDZ{publicstaticInitde{ccNetManager.RegisterCallbackdProtocol.MessageID.ADD_HERO_RES,NetHero.S2CInviteFighte;}publicstaticDisposede{ccNetManager.UnSubscribedProtocol.MessageID.ADD_HERO_RESe;}cc邀请战斗publicstaticS2CInviteFightdcmdDataBA:egret.ByteArraye{lettext=`afontsize="24"b您的好友xxx邀请你组队参加2V2经济，快加入队伍一起战斗吧！acfontb\nafontcolor="0xca4a4a"size="24"b60秒后自动决绝邀请acfontb`letdata:game.CommonDlgData=newgame.CommonDlgData;data.leftText=LanUtil.GetTextd"拒绝"e;data.leftIcon=Const.ButtonImg.RED;data.rightText=LanUtil.GetTextd"同意"e;data.rightIcon=Const.ButtonImg.GREEN;data.titleText=LanUtil.GetTextd"组队邀请"e;data.content=text;data.thisObj=this;data.leftFunc=de=b{game.TipsManager.ShowTipsdLanUtil.GetTextd"拒绝邀请"ee;};data.rightFunc=de=b{game.TipsManager.ShowTipsdLanUtil.GetTextd"同意邀请"ee;};data.closeFunc=de=b{game.TipsManager.ShowTipsdLanUtil.GetTextd"关闭界面"ee;};game.UIManager.ShowPaneldPanelTypeConst.CommonDlg,datae;}}}﻿moduleClientNet{exportclassNetFamily{publicstaticRecommendType:number=1;cc1推荐2搜索publicconstructorde{}publicstaticInitde{NetManager.RegisterCallbackdProtocol.MessageID.CREATE_FAMILY_RES,NetFamily.S2CCreateFamilye;NetManager.RegisterCallbackdProtocol.MessageID.ASK_FAMILY_RES,NetFamily.S2CRecommendFamilye;NetManager.RegisterCallbackdProtocol.MessageID.JOIN_FAMILY_RES,NetFamily.S2CJoinFamilye;NetManager.RegisterCallbackdProtocol.MessageID.LEAVE_FAMILY_RES,NetFamily.S2CLeaveFamilye;NetManager.RegisterCallbackdProtocol.MessageID.ASK_FAMILY_APPLY_RES,NetFamily.S2CFamilyApplye;NetManager.RegisterCallbackdProtocol.MessageID.FAMILY_INFO_RES,NetFamily.S2CFamilyInfoe;NetManager.RegisterCallbackdProtocol.MessageID.JOIN_FAMILY_SUCEED_RES,NetFamily.S2cJoinSuccesse;NetManager.RegisterCallbackdProtocol.MessageID.ACCEPT_FAMILY_APPLY_RES,NetFamily.S2CDoApplye;NetManager.RegisterCallbackdProtocol.MessageID.NOTICE_MEMBER_CHANGE_RES,NetFamily.S2CMemberInfoe;NetManager.RegisterCallbackdProtocol.MessageID.FAMILY_CHATS_RES,NetFamily.S2CChatListe;NetManager.RegisterCallbackdProtocol.MessageID.SEND_FAMILY_CHAT_RES,NetFamily.S2CSendInfoe;}publicstaticDisposede{NetManager.UnSubscribedProtocol.MessageID.CREATE_FAMILY_RESe;NetManager.UnSubscribedProtocol.MessageID.ASK_FAMILY_RESe;NetManager.UnSubscribedProtocol.MessageID.JOIN_FAMILY_RESe;NetManager.UnSubscribedProtocol.MessageID.LEAVE_FAMILY_RESe;NetManager.UnSubscribedProtocol.MessageID.ASK_FAMILY_APPLY_RESe;NetManager.UnSubscribedProtocol.MessageID.FAMILY_INFO_RESe;NetManager.UnSubscribedProtocol.MessageID.JOIN_FAMILY_SUCEED_RESe;NetManager.UnSubscribedProtocol.MessageID.ACCEPT_FAMILY_APPLY_RESe;NetManager.UnSubscribedProtocol.MessageID.NOTICE_MEMBER_CHANGE_RESe;NetManager.UnSubscribedProtocol.MessageID.FAMILY_CHATS_RESe;NetManager.UnSubscribedProtocol.MessageID.SEND_FAMILY_CHAT_RESe;}cc----------------------------------------------------------------------创建家族publicstaticC2SCreateFamilydfamilyName:string,icon:number,iconBg:number,desc:string,isAuto:boolean,needCups:numbere{letisTest=false;letheroId=game.MainDataMgr.GetInstancede.roleId;ifd!isTeste{cc缺少一个是否自动加入的字段letsendData=newProtocol.CreateFamily_Requestde;sendData.roleId=heroId;sendData.name=familyName;sendData.pic=icon;sendData.introduce=desc;sendData.autoCup=needCups;letsendByte=Protocol.CreateFamily_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.CREATE_FAMILY_REQ,sendBytee;}else{letmyFamily=game.MainDataMgr.GetInstancede.familyDataMgr.myFamily;myFamily.PackDataByClientd"997049907",familyName,icon,iconBg,desc,isAuto,needCupse;myFamily.PackMeByClientde;game.GlobalEvent.FireEventdGlobalEventType.familyCreatee;}}publicstaticS2CCreateFamilydcmdDataBA:egret.ByteArraye{letinfo=Protocol.CreateFamily_Respond.decodedcmdDataBA.bytese;letmyFamily=game.MainDataMgr.GetInstancede.familyDataMgr.myFamily;ifdinfo.ret==1&&myFamily!=nulle{myFamily.PackDataByCreatedinfo.infoe;myFamily.PackMeByClientde;game.GlobalEvent.FireEventdGlobalEventType.familyCreatee;}}cc----------------------------------------------------------------------推荐家族列表tuijianpublicstaticasyncC2SRecommendFamilyde{letisTrue=false;ifd!isTruee{NetFamily.RecommendType=FamilyListType.Recommend;letsendData=newProtocol.AskFamily_Requestde;letsendByte=Protocol.AskFamily_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.ASK_FAMILY_REQ,sendBytee;}else{letfMgr=game.MainDataMgr.GetInstancede.familyDataMgr;fMgr.RemoveFamilydFamilyListType.Recommende;fordleti=0,len=10;ialen;i++e{letfamily=newgame.FamilyDataItemde;family.InitTestde;fMgr.allRecommendMap.setdfamily.id,familye;}fMgr.FlushAttrdfMgr.allRecommendMapNamee;}}publicstaticS2CRecommendFamilydcmdDataBA:egret.ByteArraye{letinfo=Protocol.AskFamily_Respond.decodedcmdDataBA.bytese;letfMgr=game.MainDataMgr.GetInstancede.familyDataMgr;ifdfMgr==nullereturn;ifdNetFamily.RecommendType==FamilyListType.Recommendecc添加推荐列表{fMgr.RemoveFamilydFamilyListType.Recommende;fMgr.PackRecommondFamilyByServerdinfo.familyse;fMgr.SetAttrdfMgr.allRecommendMapName,fMgr.allRecommendMape;}elseifdNetFamily.RecommendType==FamilyListType.Searchecc更新搜索列表{fMgr.RemoveFamilydFamilyListType.Searche;fMgr.PackSearchFamilySdinfo.familyse;fMgr.SetAttrdfMgr.searchMapName,fMgr.searchMape;}NetFamily.RecommendType=null;}cc----------------------------------------------------------------------搜索推荐家族sousuocc搜索列表通过S2CRecommendFamily返回publicstaticC2SSearchFamilydcontent:stringe{letisTest=false;ifd!isTeste{NetFamily.RecommendType=FamilyListType.Search;letsendData=newProtocol.SearchFamily_Requestde;sendData.name=content;letsendByte=Protocol.SearchFamily_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.SEARCH_FAMILY_REQ,sendBytee;}else{letfMgr=game.MainDataMgr.GetInstancede.familyDataMgr;fMgr.RemoveFamilydFamilyListType.Searche;fordleti=0,len=3;ialen;i++e{letfamily=newgame.FamilyDataItemde;family.InitTestde;fMgr.searchMap.setdfamily.id,familye;}fMgr.FlushAttrdfMgr.searchMapNamee;}}cc----------------------------------------------------------------------申请加入家族privatestaticJoinFamilyId:string;publicstaticC2SJoinFamilydfamilyId:stringe{letisTest=false;ifd!isTeste{NetFamily.JoinFamilyId=familyId;letsendData=newProtocol.JoinFamily_Requestde;sendData.familyId=familyId;letsendByte=Protocol.JoinFamily_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.JOIN_FAMILY_REQ,sendBytee;}else{letfMgr=game.MainDataMgr.GetInstancede.familyDataMgr;fMgr.RefreshApplyListdfamilyIde;}}publicstaticS2CJoinFamilydcmdDataBA:egret.ByteArraye{letinfo=Protocol.JoinFamily_Respond.decodedcmdDataBA.bytese;ifdinfo.ret==1e{letfMgr=game.MainDataMgr.GetInstancede.familyDataMgr;fMgr.RefreshApplyListdNetFamily.JoinFamilyIde;}}publicstaticS2cJoinSuccessdcmdDataBA:egret.ByteArraye{letinfo=Protocol.JoInFamilySuceed_Respond.decodedcmdDataBA.bytese;letmyFamily=game.MainDataMgr.GetInstancede.familyDataMgr.myFamily;myFamily.PackDataByCreatedinfo.infoe;myFamily.PackMemberDataByServerdinfo.memberse;game.GlobalEvent.FireEventdGlobalEventType.joinApplySuccesse;}cc----------------------------------------------------------------------家族信息xinxipublicstaticC2SFamilyInfodfamilyId:stringe{letisTest=false;ifd!isTeste{letsendData=newProtocol.FamilyInfo_Requestde;sendData.familyId=familyId;letsendByte=Protocol.FamilyInfo_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.FAMILY_INFO_REQ,sendBytee;}else{letmyFamily=game.MainDataMgr.GetInstancede.familyDataMgr.myFamily;myFamily.PackMyDataByClientde;myFamily.FlushAttrd"cups"e;}}publicstaticS2CFamilyInfodcmdDataBA:egret.ByteArraye{letinfo=Protocol.FamilyInfo_Respond.decodedcmdDataBA.bytese;letfMgr=game.MainDataMgr.GetInstancede.familyDataMgr;letmyFamily=fMgr.myFamily;ifdmyFamily.id==info.info.familyIdecc自己的家族{myFamily.PackFamilyDataSdinfo.infoe;myFamily.PackMemberDataByServerdinfo.memberse;myFamily.FlushAttrd"cups"e;}else{letfamily:game.FamilyDataItem=fMgr.GetFamilyByTypedNetFamily.RecommendType,info.info.familyIde;family.PackFamilyDataSdinfo.infoe;family.PackMemberDataByServerdinfo.memberse;family.FlushAttrd"cups"e;family.FlushAttrdfamily.allMemberMapNamee;}}cc----------------------------------------------------------------------接受c拒绝申请shenqingprivatestaticApplyMsg:any[]=[]publicstaticC2SDoApplydflag:boolean,id:numbere{letisTest=false;ifd!isTeste{NetFamily.ApplyMsg=[flag,id];cc这里应该后端也传回来letsendData=newProtocol.AcceptFamilyApply_Requestde;sendData.accept=flag;sendData.roleId=id;letsendByte=Protocol.AcceptFamilyApply_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.ACCEPT_FAMILY_APPLY_REQ,sendBytee;}else{letmyFamily=game.MainDataMgr.GetInstancede.familyDataMgr.myFamily;letplayer=myFamily.RemoveApplydide;myFamily.FlushAttrdmyFamily.applyPlayersName,flag,ide;ifdflag==truee{letmember=myFamily.AddMemberdplayer.ide;member.PackDataCdplayer.id,player.name,player.classLv,player.cups,player.iconId,player.iconBg,player.serverIdemyFamily.FlushAttrdmyFamily.allMemberMapName,flag,player.ide;}}}publicstaticS2CDoApplydcmdDataBA:egret.ByteArraye{letinfo=Protocol.AcceptFamilyApply_Respond.decodedcmdDataBA.bytese;ifdinfo.rete{ifdNetFamily.ApplyMsg!=nulle{letflag=NetFamily.ApplyMsg[0];letid=NetFamily.ApplyMsg[1];letmyFamily=game.MainDataMgr.GetInstancede.familyDataMgr.myFamily;letplayer=myFamily.RemoveApplydide;NetFamily.ApplyMsg=null;myFamily.FlushAttrdmyFamily.applyPlayersName,flag,ide;ifdflag==truee{letmember=myFamily.AddMemberdplayer.ide;member.PackFromApplydplayeremyFamily.FlushAttrdmyFamily.allMemberMapName,flag,player.ide;}}}}cc----------------------------------------------------------------------职位设置publicstaticC2SJobdroleId:numbere{letisTest=false;ifd!isTeste{letsendData=newProtocol.SetFamilyJob_Requestde;letsendByte=Protocol.SetFamilyJob_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.SET_FAMILY_JOB_REQ,sendBytee;}else{game.MainDataMgr.GetInstancede.familyDataMgr.UpDownJobdroleIde;}}publicstaticS2CJobdcmdDataBA:egret.ByteArraye{letinfo=Protocol.SetFamilyJob_Respond.decodedcmdDataBA.bytese;ifdinfo.ret==1e{}}cc----------------------------------------------------------------------踢人publicstaticC2SRemoveMemberdroleId:numbere{letisTest=true;ifd!isTeste{}else{game.MainDataMgr.GetInstancede.familyDataMgr.RemoveMemberdroleIde;}}cc----------------------------------------------------------------------家族设置publicstaticC2SSettingdicon:number,iconBg:number,desc:string,isAuto:boolean,needCups:numbere{letisTest:boolean=true;ifd!isTeste{}else{game.TipsManager.ShowTipsd"缺少更新设置的协议"e;game.MainDataMgr.GetInstancede.familyDataMgr.UpdateSettingdicon,iconBg,desc,isAuto,needCupse;}}publicstaticS2CSettingdcmdDataBA:egret.ByteArraye{}cc----------------------------------------------------------------------成员申请列表d针对高职位有效epublicstaticC2SFamilyApplyde{letisTest:boolean=false;ifd!isTeste{letsendData=newProtocol.AskFamilyApply_Requestde;letsendByte=Protocol.AskFamilyApply_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.ASK_FAMILY_APPLY_REQ,sendBytee;}else{letmyFamily=game.MainDataMgr.GetInstancede.familyDataMgr.myFamilyfordletmemberofmyFamily.applyPlayerse{member.Destroyde;}myFamily.applyPlayers.length=0;fordleti=1,len=10;ia=len;i++e{letran=Math.ceildMath.randomde*3e;letdata=newgame.MemberDataItemde;data.InitTestd1,1,1,10000+ie;myFamily.applyPlayers.pushddatae;}myFamily.FlushAttrdmyFamily.applyPlayersNamee;}}publicstaticS2CFamilyApplydcmdDataBA:egret.ByteArraye{letinfo=Protocol.AskFamilyApply_Respond.decodedcmdDataBA.bytese;letmyFamily=game.MainDataMgr.GetInstancede.familyDataMgr.myFamily;myFamily.RemoveAllApplyPlayersde;myFamily.PackApplyDatadinfo.applyse;myFamily.FlushAttrdmyFamily.applyPlayersNamee;}cc----------------------------------------------------------------------退出家族tuichupublicstaticC2SLeaveFamilydfamilyId:stringe{letsendData=newProtocol.LeaveFamily_Requestde;sendData.familyId=familyId;letsendByte=Protocol.LeaveFamily_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.LEAVE_FAMILY_REQ,sendBytee;}publicstaticS2CLeaveFamilydcmdDataBA:egret.ByteArraye{letinfo=Protocol.leaveFamily_Respond.decodedcmdDataBA.bytese;game.MainDataMgr.GetInstancede.familyDataMgr.RemoveMyFamilyde;}cc----------------------------------------------------------------------申请信息publicstaticC2SApplyInofde{letsendData=newProtocol.JoinApplys_Requestde;letsendByte=Protocol.JoinApplys_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.JOIN_FAMILY_APPLYS_REQ,sendBytee;}publicstaticS2CApplyInfodcmdDataBA:egret.ByteArraye{letinfo=Protocol.JoinApplys_Respond.decodedcmdDataBA.bytese;letfMgr=game.MainDataMgr.GetInstancede.familyDataMgr;fMgr.applyList.length=0;fMgr.applyList=info.familyIds;}cc----------------------------------------------------------------------成员更新publicstaticS2CMemberInfodcmdDataBA:egret.ByteArraye{letinfo=Protocol.NoticeMemberChange_Respond.decodedcmdDataBA.bytese;letmyFamily=game.MainDataMgr.GetInstancede.familyDataMgr.myFamily;ifdmyFamily!=nulle{myFamily.RemoveAllMmeberde;fordletmemberofinfo.membere{myFamily.AddMemberdmember.roleIdasnumbere;}}}cc----------------------------------------------------------------------聊天信息publicstaticC2SChatListde{letsendData=newProtocol.FamilyChats_Requestde;letsendByte=Protocol.FamilyChats_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.FAMILY_CHATS_REQ,sendBytee;}publicstaticS2CChatListdcmdDataBA:egret.ByteArraye{letinfo=Protocol.FamilyChats_Respond.decodedcmdDataBA.bytese;letfMgr=game.MainDataMgr.GetInstancede.familyDataMgr;fordletchatofinfo.chatse{fMgr.AddChatInfodchate;}}cc----------------------------------------------------------------------发送消息publicstaticC2SSendInfodtype:number,content:anye{cc正式代码ccletsendData=newProtocol.SendFamilyChat_Requestde;ccsendData.content=content;ccsendData.type=type;ccletsendByte=Protocol.SendFamilyChat_Request.encodedsendDatae.finishde;ccSocketManager.GetInstancede.SendMessagedProtocol.MessageID.SEND_FAMILY_CHAT_REQ,sendBytee;cc测试代码letotherId=997049907ifdgame.MainDataMgr.GetInstancede.familyDataMgr.myFamily.allMemberMap.getdotherIde==nulle{letother=game.MainDataMgr.GetInstancede.familyDataMgr.myFamily.AddMemberdotherIde;other.job=1;other.name="wwwwwsx";}letsendData=newProtocol.SendFamilyChat_Respondde;sendData.chat=newProtocol.FamilyChatde;sendData.chat.type=type;sendData.chat.sender=newProtocol.FamilyMember;sendData.chat.sender.roleId=game.MainDataMgr.GetInstancede.roleId;sendData.chat.sendTime=game.HomeServerTime.GetServerTimede;sendData.chat.content=content;letsendByte=Protocol.SendFamilyChat_Respond.encodedsendDatae.finishde;letcmdDataBA=newegret.ByteArraydsendBytee;this.S2CSendInfodcmdDataBAe;letsendData2=newProtocol.SendFamilyChat_Respondde;sendData2.chat=newProtocol.FamilyChatde;sendData2.chat.type=type;sendData2.chat.content=content;sendData2.chat.sender=newProtocol.FamilyMember;sendData2.chat.sender.roleId=otherId;sendData2.chat.sendTime=game.HomeServerTime.GetServerTimede+500;letsendByte2=Protocol.SendFamilyChat_Respond.encodedsendData2e.finishde;letcmdDataBA2=newegret.ByteArraydsendByte2e;setTimeoutdde=b{this.S2CSendInfodcmdDataBA2e;},500eccleta3=Utils.ObjectCopydsendData2e;cca3.chat.sendTime=HomeServerTime.GetServerTimede+550;ccleta33=Protocol.SendFamilyChat_Respond.encodeda3e.finishde;ccleta333=newegret.ByteArrayda33e;ccsetTimeoutdde=b{ccthis.S2CSendInfoda333e;cc},500ecca3=Utils.ObjectCopydsendData2e;cca3.chat.sendTime=HomeServerTime.GetServerTimede+600;cca33=Protocol.SendFamilyChat_Respond.encodeda3e.finishde;cca333=newegret.ByteArrayda33e;ccsetTimeoutdde=b{ccthis.S2CSendInfoda333e;cc},500e}publicstaticS2CSendInfodcmdDataBA:egret.ByteArraye{letinfo=Protocol.SendFamilyChat_Respond.decodedcmdDataBA.bytese;game.MainDataMgr.GetInstancede.familyDataMgr.AddChatInfodinfo.chate;}}}﻿moduleClientNet{exportclassNetFriend{publicstaticInitde{NetManager.RegisterCallbackdProtocol.MessageID.FRIEND_CHAT_RES,NetFriend.S2CFriendChate;NetManager.RegisterCallbackdProtocol.MessageID.INVITE_FRIEND_RES,NetFriend.S2CInviteFriende;NetManager.RegisterCallbackdProtocol.MessageID.ADD_FRIEND_RES,NetFriend.S2CAddFriende;NetManager.RegisterCallbackdProtocol.MessageID.ASK_FRIEND_LIST_RES,NetFriend.S2CAskFriendListe;NetManager.RegisterCallbackdProtocol.MessageID.ALL_FRIENDS_RES,NetFriend.S2CAllFriendListe;NetManager.RegisterCallbackdProtocol.MessageID.ALL_INVITES_RES,NetFriend.S2CAllIniviteListe;NetManager.RegisterCallbackdProtocol.MessageID.ALL_CHAT_RES,NetFriend.S2CPlayerChate;NetManager.RegisterCallbackdProtocol.MessageID.FRIEND_STATE_RES,NetFriend.S2CFriendStatee;NetManager.RegisterCallbackdProtocol.MessageID.DELETE_INVITE_RES,NetFriend.S2CDelFriendInvitee;NetManager.RegisterCallbackdProtocol.MessageID.DELETE_FRIEND_RES,NetFriend.S2CDelFriende;}publicstaticDisposede{NetManager.UnSubscribedProtocol.MessageID.FRIEND_CHAT_RESe;NetManager.UnSubscribedProtocol.MessageID.INVITE_FRIEND_RESe;NetManager.UnSubscribedProtocol.MessageID.ADD_FRIEND_RESe;NetManager.UnSubscribedProtocol.MessageID.ASK_FRIEND_LIST_RESe;NetManager.UnSubscribedProtocol.MessageID.ALL_FRIENDS_RESe;NetManager.UnSubscribedProtocol.MessageID.ALL_INVITES_RESe;NetManager.UnSubscribedProtocol.MessageID.ALL_CHAT_RESe;NetManager.UnSubscribedProtocol.MessageID.FRIEND_STATE_RESe;NetManager.UnSubscribedProtocol.MessageID.DELETE_INVITE_RESe;NetManager.UnSubscribedProtocol.MessageID.DELETE_FRIEND_RESe;}cc好友聊天转发publicstaticS2CFriendChatdcmdDataBA:egret.ByteArraye{letinfo=Protocol.FriendChat_Respond.decodedcmdDataBA.bytese;letmsg=info.msg;letmainDataMgr=game.MainDataMgr.GetInstancede;letfriendDataMgr=mainDataMgr.friendDataMgr;letfriendObj:game.PlayerDataItem=null;ifdmsg.senderId==mainDataMgr.roleIdefriendObj=friendDataMgr.GetFrienddNumberdmsg.friendIdee;elsefriendObj=friendDataMgr.GetFrienddNumberdmsg.senderIdee;ifdfriendObj==nullereturn;letchatObj=newgame.ChatDataItemde;chatObj.fromId=Numberdmsg.senderIde;chatObj.toId=Numberdmsg.friendIde;chatObj.SetTextdmsg.contente;chatObj.time=Numberdmsg.timee;friendObj.AddChatdchatObje;friendObj.RefreshChatDatade;}cc好友邀请publicstaticS2CInviteFrienddcmdDataBA:egret.ByteArraye{letinfo=Protocol.InviteFriend_Respond.decodedcmdDataBA.bytese;letfrom=info.from;letfriend=from.from;letmainDataMgr=game.MainDataMgr.GetInstancede;letfriendDataMgr=mainDataMgr.friendDataMgr;letobj=friendDataMgr.AddInviteFrienddNumberdfriend.roleIdeeobj.RefreshDataFromServerdfriende;friendDataMgr.RefreshInvitedListde;}cc添加好友publicstaticS2CAddFrienddcmdDataBA:egret.ByteArraye{letinfo=Protocol.AddFriend_Respond.decodedcmdDataBA.bytese;letfriend=info.newFd;letmainDataMgr=game.MainDataMgr.GetInstancede;letfriendDataMgr=mainDataMgr.friendDataMgr;letobj=friendDataMgr.AddFrienddNumberdfriend.roleIdee;obj.RefreshDataFromServerdfriende;friendDataMgr.RefreshFriendItemArrayde;game.TipsManager.ShowTipsdLanUtil.GetFormatd`{0}已成为您的好友`,friend.nameee;}cc推荐好友列表publicstaticS2CAskFriendListdcmdDataBA:egret.ByteArraye{letinfo=Protocol.AskFriendList_Respond.decodedcmdDataBA.bytese;letmainDataMgr=game.MainDataMgr.GetInstancede;letfriendDataMgr=mainDataMgr.friendDataMgr;letlist:game.PlayerDataItem[]=[];fordletfriendofinfo.friendse{ifdfriend.roleId==mainDataMgr.roleIdecontinue;letobj=newgame.PlayerDataItemdNumberdfriend.roleIdee;obj.RefreshDataFromServerdfriende;obj.state=0;list.pushdobje;}friendDataMgr.RefreshRecommandListdliste;}cc所有好友列表publicstaticS2CAllFriendListdcmdDataBA:egret.ByteArraye{letinfo=Protocol.AllFriends_Respond.decodedcmdDataBA.bytese;letmainDataMgr=game.MainDataMgr.GetInstancede;letfriendDataMgr=mainDataMgr.friendDataMgr;friendDataMgr.ClearAllFriendde;fordletfriendofinfo.friendse{letobj=friendDataMgr.AddFrienddNumberdfriend.roleIdee;obj.RefreshDataFromServerdfriende;}friendDataMgr.RefreshFriendItemArrayde;}cc所有邀请列表publicstaticS2CAllIniviteListdcmdDataBA:egret.ByteArraye{letinfo=Protocol.AllInvites_Respond.decodedcmdDataBA.bytese;letmainDataMgr=game.MainDataMgr.GetInstancede;letfriendDataMgr=mainDataMgr.friendDataMgr;friendDataMgr.ClearInviteListde;fordletinviteofinfo.invitese{letfriend=invite.from;letobj=friendDataMgr.AddInviteFrienddNumberdfriend.roleIdeeobj.RefreshDataFromServerdfriende;}friendDataMgr.RefreshInvitedListde;}cc单个好友的所有聊天请求publicstaticS2CPlayerChatdcmdDataBA:egret.ByteArraye{letinfo=Protocol.AllChat_Respond.decodedcmdDataBA.bytese;letmainDataMgr=game.MainDataMgr.GetInstancede;letfriendDataMgr=mainDataMgr.friendDataMgr;letfriendObj:game.PlayerDataItem=friendDataMgr.GetFrienddNumberdinfo.roleIdee;ifdfriendObj!=nulle{friendObj.lastReadChatTime=Numberdinfo.lastReadTimee;friendObj.ClearAllChatde;fordletchatofinfo.chatse{letchatObj=newgame.ChatDataItemde;chatObj.fromId=Numberdchat.senderIde;chatObj.toId=Numberdchat.friendIde;chatObj.time=Numberdchat.timee;chatObj.SetTextdchat.contente;friendObj.AddChatdchatObje;}friendObj.RefreshChatDatade;}else{game.warnd"S2CFriendStatefriendisnullid:",info.roleIde;}}cc好友状态publicstaticS2CFriendStatedcmdDataBA:egret.ByteArraye{letinfo=Protocol.FriendState_Respond.decodedcmdDataBA.bytese;letmainDataMgr=game.MainDataMgr.GetInstancede;letfriendDataMgr=mainDataMgr.friendDataMgr;letfriendObj:game.PlayerDataItem=friendDataMgr.GetFrienddNumberdinfo.roleIdee;ifdfriendObj!=nulle{friendObj.SetAttrd"isOnline",info.statee;}else{game.warnd"S2CFriendStatefriendisnullid:",info.roleIde;}}cc删除好友邀请publicstaticS2CDelFriendInvitedcmdDataBA:egret.ByteArraye{letinfo=Protocol.DeleteInvite_Respond.decodedcmdDataBA.bytese;letmainDataMgr=game.MainDataMgr.GetInstancede;letfriendDataMgr=mainDataMgr.friendDataMgr;friendDataMgr.RemoveInviteFrienddNumberdinfo.roleIdee;friendDataMgr.RefreshInvitedListde;}cc删除好友publicstaticS2CDelFrienddcmdDataBA:egret.ByteArraye{letinfo=Protocol.DeleteFriend_Respond.decodedcmdDataBA.bytese;letroleId=info.roleId;letmainDataMgr=game.MainDataMgr.GetInstancede;letfriendDataMgr=mainDataMgr.friendDataMgr;friendDataMgr.RemoveFrienddNumberdroleIdee;friendDataMgr.RefreshFriendItemArrayde;}ccC2Sccccccccccccccccccccccccccccccccccc好友聊天publicstaticC2SFriendChatdroleId:number,content:stringe:void{letsendData=newProtocol.FriendChat_Requestde;sendData.roleId=roleId;sendData.content=content;letsendByte=Protocol.FriendChat_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.FRIEND_CHAT_REQ,sendBytee;}cc邀请好友publicstaticC2SInviteFrienddroleId:number,serverId:numbere:void{letsendData=newProtocol.InviteFriend_Requestde;sendData.roleId=roleId;sendData.serverId=serverId;letsendByte=Protocol.InviteFriend_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.INVITE_FRIEND_REQ,sendBytee;}cc好友邀请处理ccisAccept:boolean是否同意好友邀请publicstaticC2SAcceptFrienddroleId:number,isAccept:booleane:void{letsendData=newProtocol.AcceptFriend_Requestde;sendData.roleId=roleId;sendData.isAccept=isAccept;letsendByte=Protocol.AcceptFriend_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.ACCEPT_FRIEND_REQ,sendBytee;}cc推荐好友列表publicstaticC2SAskFriendListde:void{letsendData=newProtocol.AskFrinedList_Requestde;letsendByte=Protocol.AskFrinedList_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.ASK_FRIEND_LIST_REQ,sendBytee;}cc所有好友列表publicstaticC2SAllFriendListde:void{letsendData=newProtocol.AllFriends_Requestde;letsendByte=Protocol.AllFriends_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.ALL_FRIENDS_REQ,sendBytee;}cc所有邀请列表publicstaticC2SAllInviteListde:void{letsendData=newProtocol.AllInvite_Requestde;letsendByte=Protocol.AllInvite_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.ALL_INVITES_REQ,sendBytee;}cc单个好友的所有聊天请求publicstaticC2SPlayerChatdroleId:numbere:void{letsendData=newProtocol.AllChat_Requestde;sendData.roleId=roleId;letsendByte=Protocol.AllChat_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.ALL_CHAT_REQ,sendBytee;}cc删除好友publicstaticC2SDelFrienddroleId:numbere:void{letsendData=newProtocol.DeleteFriend_Requestde;sendData.roleId=roleId;letsendByte=Protocol.DeleteFriend_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.DELETE_FRINED_REQ,sendBytee;}cc浏览好友信息publicstaticC2SReadFriendChatdroleId:numbere:void{letsendData=newProtocol.NoticeLastReadTime_Requestde;sendData.FrinedId=roleId;letsendByte=Protocol.NoticeLastReadTime_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.NOTICE_LAST_READ_TIME_REQ,sendBytee;}}}﻿moduleClientNet{exportclassNetHero{publicstaticInitde{NetManager.RegisterCallbackdProtocol.MessageID.ADD_HERO_RES,NetHero.S2CAddHeroe;NetManager.RegisterCallbackdProtocol.MessageID.HERO_LEVEL_UP_RES,NetHero.S2CHeroUpgradee;}publicstaticDisposede{NetManager.UnSubscribedProtocol.MessageID.ADD_HERO_RESe;NetManager.UnSubscribedProtocol.MessageID.HERO_LEVEL_UP_RESe;}publicstaticS2CAddHerodcmdDataBA:egret.ByteArraye{cchero,20010,1letinfo=Protocol.AddHero_Respond.decodedcmdDataBA.bytese;lethMgr=game.MainDataMgr.GetInstancede.heroDataMgr;letheroObj:game.CardDataItem;letisNew:boolean;ifdECSC.RenderWarUtil.IsKingTowerdinfo.hero.indexe==truee{isNew=hMgr.GetLeaderdinfo.hero.indexe.lv==0;heroObj=hMgr.AddLeaderdinfo.hero.index,info.hero.levele;}elseifdECSC.RenderWarUtil.IsQueenTowerdinfo.hero.indexe==truee{isNew=hMgr.GetQueendinfo.hero.indexe.lv==0;heroObj=hMgr.AddQueendinfo.hero.indexe;}else{isNew=hMgr.GetHerodinfo.hero.indexe.lv==0;heroObj=hMgr.AddHerodinfo.hero.index,info.hero.levele;}ifdheroObj!=nulle{ifdisNew==trueeheroObj.SetIsNewd1e;heroObj.SetExpdinfo.hero.counte;heroObj.SetLvdinfo.hero.levele;heroObj.goldLevel=info.hero.goldLevel;}}cc----------------------------------------------------------------------升级ccprivatestatictestLv:number;publicstaticC2SUpgradeHerodheroId:numbere{letsendData=newProtocol.HeroLevelUp_Requestde;sendData.index=heroId;letsendByte=Protocol.HeroLevelUp_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.HERO_LEVEL_UP_REQ,sendBytee;}publicstaticS2CHeroUpgradedcmdDataBA:egret.ByteArraye{letinfo=Protocol.HeroLevelUp_Respond.decodedcmdDataBA.bytese;ifdinfo.ret!=1ereturn;lethero=game.MainDataMgr.GetInstancede.heroDataMgr.GetHerodinfo.indexehero.SetLvdinfo.levele;hero.SetExpdinfo.counte;}}}﻿moduleClientNet{exportclassNetItem{publicstaticInitde{NetManager.RegisterCallbackdProtocol.MessageID.REWARD_RES,NetItem.S2CRewarde;NetManager.RegisterCallbackdProtocol.MessageID.ITEM_CHANGE_RES,NetItem.S2CBagChangee;}publicstaticDisposede{NetManager.UnSubscribedProtocol.MessageID.REWARD_RESe;NetManager.UnSubscribedProtocol.MessageID.ITEM_CHANGE_RESe;}publicstaticS2CRewarddcmdDataBA:egret.ByteArraye{letinfo=Protocol.Reward_Respond.decodedcmdDataBA.bytese;info.rewards[0];fordleti=0;iainfo.rewards.length;i++e{letdata=JsonData.getGameDatad"itemdata_json"e;letdataProxy=data[info.rewards[i].index];ifddataProxy!=nulle{game.TipsManager.ShowTipsdLanUtil.GetFormatd`获得{0}x{1}`,dataProxy.name,info.rewards[i].counte,1e;}}}publicstaticS2CBagChangedcmdDataBA:egret.ByteArraye{letbags=Protocol.ItemChange_Respond.decodedcmdDataBA.bytese;NetItem.RefreshBagdbags.itemse;}publicstaticRefreshBagdbags:Protocol.IItemInfo[],capacity:number=nulle:void{letitemDataMgr=game.MainDataMgr.GetInstancede.itemDataMgr;ifdcapacity!=nulle{itemDataMgr.itemMaxCount=capacity;}fordleti=0,len=bags.length;ialen;i++e{itemDataMgr.AddItemdbags[i].index,bags[i].counte;}itemDataMgr.RefreshItemCountde;ifditemDataMgr.itemCountbitemDataMgr.itemMaxCounte{game.TipsManager.ShowTipsdLanUtil.GetTextd"背包物品数量超出上限"e,1e;}itemDataMgr.RefreshBagde;}}}moduleClientNet{exportclassNetLogin{publicstaticInitde{NetManager.RegisterCallbackdProtocol.MessageID.LOGIN_GAME_RES,NetLogin.S2CLoginGamee;NetManager.RegisterCallbackdProtocol.MessageID.PROPERTY_CHANGE_RES,NetLogin.S2CPropertye;}publicstaticDisposede{NetManager.UnSubscribedProtocol.MessageID.LOGIN_GAME_RESe;}publicstaticS2CLoginGamedcmdDataBA:egret.ByteArraye{letloginGame=Protocol.LoginGame_Respond.decodedcmdDataBA.bytese;letmainData=game.MainDataMgr.GetInstancede;mainData.account=loginGame.account;mainData.teamDataMgr.currentTeamIndex=loginGame.curLineUp;ccmainData.exp=loginGame.exp;ccmainData.level=loginGame.level;mainData.userName=loginGame.name;mainData.familyName="";mainData.roleId=NumberdloginGame.roleIde;mainData.fightState=loginGame.state;mainData.fightRoomId=loginGame.roomId;cc明天写这里战斗流程示意包-缺结算letheroDataMgr=mainData.heroDataMgr;fordletheroofloginGame.herose{letid=hero.index;letheroObj:game.CardDataItem;ifdECSC.RenderWarUtil.IsKingTowerdide==truee{heroObj=heroDataMgr.AddLeaderdid,hero.levele;}elseifdECSC.RenderWarUtil.IsQueenTowerdide==truee{heroObj=heroDataMgr.AddQueendide;}else{heroObj=heroDataMgr.AddHerodid,hero.levele;}ifdheroObj!=nulle{heroObj.SetLvdhero.levele;heroObj.SetExpdhero.counte;heroObj.goldLevel=hero.goldLevel;}}NetLogin.AddTeamdloginGamee;ifdloginGame.familyId!=null&&loginGame.familyId!=""e{letfdata=game.MainDataMgr.GetInstancede.familyDataMgr;fdata.myFamily.id=loginGame.familyId;ccfdata.TEST_FAMILY_ID;}NetLogin.RefreshPropertydloginGame.prose;NetTask.RefreshTasksdloginGame.taskse;NetItem.RefreshBagdloginGame.items,loginGame.capacitye;game.GlobalEvent.FireEventdGlobalEventType.LoginResult,loginGame.rete;ECSC.CNetWar.Server2Logicd"S2CLoginGame",cmdDataBA.bytese;}publicstaticS2CPropertydcmdDataBA:egret.ByteArraye{letpropertyData=Protocol.PropertyChange_Respond.decodedcmdDataBA.bytese;NetLogin.RefreshPropertydpropertyData.prose;}publicstaticRefreshPropertydpros:Protocol.IProperty[]e{letmainData=game.MainDataMgr.GetInstancede;fordletitemofprose{switchditem.keye{caseProtocol.PropertyEnum.EXP:mainData.SetAttrd"exp",item.valuee;break;caseProtocol.PropertyEnum.MONEY:mainData.SetAttrd"gold",item.valuee;break;caseProtocol.PropertyEnum.DIAMOND:mainData.SetAttrd"diamand",item.valuee;break;caseProtocol.PropertyEnum.CUPS:mainData.SetAttrd"cupCount",item.valuee;break;caseProtocol.PropertyEnum.LEVEL:mainData.SetLvditem.valuee;break;caseProtocol.PropertyEnum.CLASSLEVEL:mainData.SetClassLvditem.valuee;break;caseProtocol.PropertyEnum.TASKSCOPE:mainData.taskDataMgr.RefreshScoreditem.valuee;break;default:break;}}}publicstaticC2SLoginGameduserName:string,password:stringe:void{ccGlobal.ShowWaitPaneld0e;cc登录letsendData=newProtocol.LoginGame_Requestde;sendData.account=userName;letsendByte=Protocol.LoginGame_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.LOGIN_GAME_REQ,sendBytee;}publicstaticAddTeamdloginGame:Protocol.LoginGame_Responde{letmainData=game.MainDataMgr.GetInstancede;letheroDataMgr=mainData.heroDataMgr;letteamMgr=mainData.teamDataMgr;fordleti=1,len=teamMgr.MaxTeamNum;ia=len;i++e{letteam=loginGame[`lineUp${i}`];ifdteam==nullecontinue;fordletindexofteame{letheroObj=heroDataMgr.GetHerodindexe;ifdheroObj==nullecontinue;ifdECSC.RenderWarUtil.IsKingTowerdheroObj.ide==trueecc领主和英雄都放在一个数组里了，需要区分{teamMgr.AddLeaderdi,heroObj.ide;}else{ifdheroObj!=nulleteamMgr.AddHerodi,heroObj.ide;}}}}}}moduleClientNet{exportclassNetMail{publicstaticInitde{NetManager.RegisterCallbackdProtocol.MessageID.ALL_MAILS_RES,NetMail.S2CAllMaile;NetManager.RegisterCallbackdProtocol.MessageID.NOTICE_MAIL_RES,NetMail.S2CNoticeMaile;NetManager.RegisterCallbackdProtocol.MessageID.READ_MAIL_RES,NetMail.S2CReadMaile;NetManager.RegisterCallbackdProtocol.MessageID.GET_MAIL_RES,NetMail.S2CGetMailRewarde;NetManager.RegisterCallbackdProtocol.MessageID.DEL_MAIL_RES,NetMail.S2CDeleteMaile;}publicstaticDisposede{NetManager.UnSubscribedProtocol.MessageID.ALL_MAILS_RESe;NetManager.UnSubscribedProtocol.MessageID.NOTICE_MAIL_RESe;NetManager.UnSubscribedProtocol.MessageID.READ_MAIL_RESe;NetManager.UnSubscribedProtocol.MessageID.GET_MAIL_RESe;NetManager.UnSubscribedProtocol.MessageID.DEL_MAIL_RESe;}publicstaticS2CAllMaildcmdDataBA:egret.ByteArraye{letdata=Protocol.AllMails_Respond.decodedcmdDataBA.bytese;letmailDataMgr=game.MainDataMgr.GetInstancede.mailDataMgr;fordletmailofdata.mailse{letmailData=newgame.MailDataItemde;mailData.RefreshFromProtodmaile;mailDataMgr.AddMaildmailData,falsee;}mailDataMgr.RefreshMailDataArrayde;}publicstaticS2CNoticeMaildcmdDataBAe:void{letdata=Protocol.NoticeMail_Respond.decodedcmdDataBA.bytese;letmailDataMgr=game.MainDataMgr.GetInstancede.mailDataMgr;mailDataMgr.RefreshMailNoticedtruee;}publicstaticS2CReadMaildcmdDataBAe{letdata=Protocol.ReadMail_Respond.decodedcmdDataBA.bytese;ifddata.ret==2ecc读取失败return;letmailDataMgr=game.MainDataMgr.GetInstancede.mailDataMgr;letmailData=newgame.MailDataItemde;mailData.RefreshFromProtoddata.maile;mailDataMgr.AddMaildmailData,falsee;mailDataMgr.RefreshMailNoticedfalsee;}publicstaticS2CGetMailRewarddcmdDataBAe{letdata=Protocol.Getmail_Respond.decodedcmdDataBA.bytese;ifddata.ret==2ecc领取失败return;letmailDataMgr=game.MainDataMgr.GetInstancede.mailDataMgr;fordletmailofdata.maile{letmailData=newgame.MailDataItemde;mailData.RefreshFromProtodmaile;mailDataMgr.AddMaildmailData,falsee;}mailDataMgr.RefreshMailNoticedfalsee;}publicstaticS2CDeleteMaildcmdDataBAe{letdata=Protocol.DelMail_Respond.decodedcmdDataBA.bytese;ifddata.ret==2ecc删除失败return;letmailDataMgr=game.MainDataMgr.GetInstancede.mailDataMgr;fordletidofdata.ide{mailDataMgr.DestroyMaildid,falsee;}mailDataMgr.RefreshMailDataArrayde;game.TipsManager.ShowTipsd"成功删除邮件!"e;}ccC2SpublicstaticC2SAllMailde{letsendData=newProtocol.AllMails_Requestde;letsendByte=Protocol.AllMails_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.ALL_MAILS_REQ,sendBytee;}publicstaticC2SReadMaildid:stringe{letsendData=newProtocol.ReadMail_Requestde;sendData.id=id;letsendByte=Protocol.ReadMail_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.READ_MAIL_REQ,sendBytee;}publicstaticC2SGetMailRewarddidArray:string[]e{letsendData=newProtocol.GetMail_Requestde;sendData.id=idArray;letsendByte=Protocol.GetMail_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.GET_MAIL_REQ,sendBytee;}publicstaticC2SDeleteMaildidArray:string[]e{letsendData=newProtocol.DelMail_Requestde;sendData.id=idArray;letsendByte=Protocol.DelMail_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.DEL_MAIL_REQ,sendBytee;}}}﻿c***服务器命令返回*bydily*dcecopyright2014-2035*AllRightsReserved.*cmoduleClientNet{exportclassNetManager{publicstaticInitde{NetManager.netCallbackDict=newSMapanumber,game.AttrCallBackbde;fordletkeyinClientNete{ifdkey=="NetManager"econtinue;ifd!ClientNet.hasOwnPropertydkeyeecontinue;letnetObj=ClientNet[key];ifdtypeofdnetObj.Inite=="function"enetObj.Initde;else{game.warnd"ClientNet."+key,"hasnoInit!!!!!"e;}}SocketManager.GetInstancede.Initde;game.NetConst.Initde;}publicstaticDisposede{fordletkeyinClientNete{ifd!ClientNet.hasOwnPropertydkeyeecontinue;letnetObj=ClientNet[key];ifdtypeofdnetObj.Disposee=="function"enetObj.Disposede;else{game.warnd"ClientNet."+key,"hasnoDispose!!!!!"e;}}SocketManager.GetInstancede.Disposede;game.NetConst.Disposede;}publicstaticnetCallbackDict:SMapanumber,game.AttrCallBackb;publicstaticRegisterCallbackdmainId:number,func:Function,thisObj?:anye{letcallbackObj=newgame.AttrCallBackdfunc,thisObje;letid=mainId;ifdNetManager.netCallbackDict.hasdmainIdee{game.warnd"NetManager.RegisterCallbackrepeated!!!!",mainId,newErrorde.stacke;}NetManager.netCallbackDict.setdid,callbackObje;}publicstaticUnSubscribedmainId:numbere{letid=mainId;NetManager.netCallbackDict.deletedide;}publicstaticReceiveMessagedmainId:number,cmdDataBA:egret.ByteArraye{letid=mainId;ifdNetManager.netCallbackDict.hasdidee{letcallbackObj=NetManager.netCallbackDict.getdide;callbackObj.execdcmdDataBAe;cccmdDataBA.clearde;}else{game.logd"________errorunknowReceiveMessageID:__________",ide;}ccletuser_login=template.user_login.decodedcmdDataBA.bytese;ccgame.logduser_login.userId,user_login.userNamee;cc输出1"abc"cccc创建user_login_classccvaruser_login_class=Global.getMessaged"user_login"e;cccc反序列化ccvarnew_user_login=user_login_class.decodedcmdDataBAe;ccgame.logd"反序列化数据：",new_user_logine;}publicstaticSendMessagedmainId:number,msg:anye{SocketManager.GetInstancede.SendMessagedmainId,msge;}}}﻿moduleClientNet{exportclassNetMatch{publicstaticInitde{NetManager.RegisterCallbackdProtocol.MessageID.BEGIN_MATCH_RES,NetMatch.S2CBeginMatche;NetManager.RegisterCallbackdProtocol.MessageID.CANCLE_MATCH_RES,NetMatch.S2CCancelMatche;NetManager.RegisterCallbackdProtocol.MessageID.FIGHT_ROOM_INFO_RES,NetMatch.S2CFightRoomInfoe;NetManager.RegisterCallbackdProtocol.MessageID.FIGHT_RECONNECT_ROOM_RES,NetMatch.S2CFightReconnectRoome;NetManager.RegisterCallbackdProtocol.MessageID.FIGHT_RECORD_RES,NetMatch.S2CFightRecorde;}publicstaticDisposede{NetManager.UnSubscribedProtocol.MessageID.BEGIN_MATCH_RESe;NetManager.UnSubscribedProtocol.MessageID.CANCLE_MATCH_RESe;NetManager.UnSubscribedProtocol.MessageID.FIGHT_ROOM_INFO_RESe;NetManager.UnSubscribedProtocol.MessageID.FIGHT_RECONNECT_ROOM_RESe;NetManager.UnSubscribedProtocol.MessageID.FIGHT_RECORD_RESe;}publicstaticS2CBeginMatchdcmdDataBA:egret.ByteArraye{letbeginMatch=Protocol.BeginMatch_Respond.decodedcmdDataBA.bytese;letret=beginMatch.ret;ifdret==1ecc成功{ccTipsManager.ShowTipsd"找到对手,即将进入战斗!!!",1e;ccgame.LoadingManager.GetInstancede.SetDesc2d"搜索到玩家,即将进入战场!"e;}else{game.TipsManager.ShowTipsdLanUtil.GetTextd"匹配失败!!!"e,1e;game.LoadingManager.GetInstancede.HideLoadingd500e;}}publicstaticS2CCancelMatchdcmdDataBA:egret.ByteArraye{letcancelMatch=Protocol.CancleMatch_Respond.decodedcmdDataBA.bytese;game.LoadingManager.GetInstancede.HideLoadingd0e;}cc正常进入战斗publicstaticS2CFightRoomInfodcmdDataBA:egret.ByteArraye{ccletfightRoomInfo=Protocol.FightRoomInfo_Respond.decodedcmdDataBA.bytese;ccLinkUtil.GetWarManagerde.InitWardfightRoomInfo,false,game.MainDataMgr.GetInstancede.roleIde;cccc进入战斗ccLinkUtil.GetWarManagerde.ClientStartWard"EnterWar"e;ccccgame.SceneManager.GetInstancede.EnterWarde;ccgame.logd"-----NetMatch.S2CFightRoomInfo-----bbbbbbbbbbbbbbbbbbbbbbbbbbbb",JsonData.getJsonStringdfightRoomInfoee;ECSC.CNetWar.Server2Logicd"S2CFightRoomInfo",cmdDataBA.bytese;}cc重连进入战斗publicstaticS2CFightReconnectRoomdcmdDataBA:egret.ByteArraye{ccletcmd=Protocol.FightReconnectRoom_Respond.decodedcmdDataBA.bytese;ccLinkUtil.GetWarManagerde.InitWardcmd.info,true,game.MainDataMgr.GetInstancede.roleIde;ccLinkUtil.GetWarManagerde.InitStartWarDatadNumberdcmd.timee,cmd.seed,cmde;cccc通知connectManager重连成功ccgame.GlobalEvent.FireEventdGlobalEventType.FightReConnectResult,1e;cccccc处理重连帧ccccgame.GlobalEvent.FireEventdGlobalEventType.SyncMessage,Protocol.MessageID.FIGHT_RECONNECT_ACTION_RES,cmde;cccc重连进入战斗ccLinkUtil.GetWarManagerde.ClientStartWard"ReconnectWar"e;ccccgame.SceneManager.GetInstancede.ReconnectWarde;ccgame.logd"-----S2CFightReconnectRoom-----bbbbbbbbbbbbbbbbbbbbbbbbbbbb",JsonData.getJsonStringdcmdee;ECSC.CNetWar.Server2Logicd"S2CFightReconnectRoom",cmdDataBA.bytese;}cc回放进入战斗publicstaticS2CFightRecorddcmdDataBA:egret.ByteArraye{ccletmsg=Protocol.FightRecord_Respond.decodedcmdDataBA.bytese;ccECS.ReplayManager.GetInstancede.ClientDoReplaydmsg.recorde;cccc服务器协议回放cccc房间信息过来后进入战斗ccLinkUtil.GetWarManagerde.ClientStartWard"ReplayWar"e;ccccgame.SceneManager.GetInstancede.ReplayWarde;ECSC.CNetWar.Server2Logicd"S2CFightRecord",cmdDataBA.bytese;}cc---------------C2S------------------------------------publicstaticC2SBeginMatchdpvpType:numbere:void{letloadingMgr=game.LoadingManager.GetInstancede;loadingMgr.SetLoadingTypedSceneTypeConst.Ware;loadingMgr.SetLoadingStated0,pvpTypee;loadingMgr.SetLoadingStated2,pvpTypee;loadingMgr.ShowLoadingde;letsendData=newProtocol.BeginMatch_Requestde;sendData.type=pvpType;sendData.lineUp=game.MainDataMgr.GetInstancede.teamDataMgr.currentTeamIndex;letsendByte=Protocol.BeginMatch_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.BEGIN_MATCH_REQ,sendBytee;game.logd"---C2SBeginMatch：",pvpType,sendData.lineUpe;}publicstaticC2SCancelMatchde:void{letsendData=newProtocol.CancleMatch_Requestde;letsendByte=Protocol.CancleMatch_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.CANCLE_MATCH_REQ,sendBytee;}publicstaticC2SFightRecorddindex:numbere{game.logd"C2SFightRecord------------"e;letsendData=newProtocol.FightRecord_Requestde;sendData.index=index;letsendByte=Protocol.FightRecord_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.FIGHT_RECORD_REQ,sendBytee;}}}﻿moduleClientNet{exportclassNetRank{publicstaticInitde{NetManager.RegisterCallbackdProtocol.MessageID.GET_RANK_RANGE_RES,this.S2CRankInfoe;}publicstaticDisposede{NetManager.UnSubscribedProtocol.MessageID.GET_RANK_RANGE_RESe;}cc----------------------------------------------------------------------排行榜数据publicstaticC2SRankInfodbegin:number,end:number,type:numbere{letsendData=newProtocol.GetRankRange_Requestde;sendData.begin=begin;sendData.end=end;sendData.type=type;letsendByte=Protocol.GetRankRange_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.GET_RANK_RANGE_REQ,sendBytee;}publicstaticS2CRankInfodcmdDataBA:egret.ByteArraye{letinfo=Protocol.GetRankRange_Respond.decodedcmdDataBA.bytese;letrMgr=game.MainDataMgr.GetInstancede.rankDataMgr;letpRankInfo=rMgr.GetRankInfodConst.RankInfoType.PLAYERe;ifdpRankInfo==nullereturn;pRankInfo.localCurrIndex=info.end;letrankInfo:game.RankDataItem,infoArray=info.infos;ifdinfo.type==Const.RankType.LOCALe{fordleti=0,len=infoArray.length;ialen;i++e{rankInfo=pRankInfo.AddLocRankInfodinfo.begin+ie;rankInfo.PackDataFromServerdinfo.infos[i]e;}game.GlobalEvent.FireEventdGlobalEventType.RankAddItem,Const.RankType.LOCAL,info.begin,info.ende}elseifdinfo.type==Const.RankType.GLOBALe{fordleti=0,len=info.infos.length;ialen;i++e{rankInfo=pRankInfo.AddGloRankInfodinfo.begin+ie;rankInfo.PackDataFromServerdinfo.infos[i]e;}game.GlobalEvent.FireEventdGlobalEventType.RankAddItem,Const.RankType.GLOBAL,info.begin,info.ende}}}}﻿moduleClientNet{exportclassNetReplay{publicstaticInitde{NetManager.RegisterCallbackdProtocol.MessageID.SIMPLE_RECORD_RES,NetReplay.S2CSimpleRecorde;}publicstaticDisposede{NetManager.UnSubscribedProtocol.MessageID.SIMPLE_RECORD_RESe;}publicstaticS2CSimpleRecorddcmdDataBA:egret.ByteArraye{letmsg=Protocol.SimpleRecord_Respond.decodedcmdDataBA.bytese;letreplayDataMgr=game.MainDataMgr.GetInstancede.replayDataMgr;letmyItemMap=replayDataMgr.myItemMap;cc首先检测数据是否有变化letisChanged=false;ifdmyItemMap.size==msg.records.lengthe{fordletdataofmsg.recordse{ifd!myItemMap.hasddata.indexee{isChanged=true;break;}}}else{isChanged=true;}ifd!isChangedecc数据没有变化直接退出{game.logd"S2CSimpleRecordserverDataissameaslocalData!!!"e;return;}replayDataMgr.DestroyMyArrayde;letrecords=msg.records.reversede;cc数据逆序一下fordletdataofrecordse{letitemObj=newgame.ReplayDataItemde;itemObj.SetReplayDataddatae;replayDataMgr.AddMyItemditemObje;ccfordleti=0;ia10;i++ecc{ccitemObj.uniqueId=i;ccreplayDataMgr.AddMyItemditemObje;cc}}replayDataMgr.RefreshMyArrayde;}ccC2S-----------ccccccccccccccccccccpublicstaticC2SSimpleRecordde{game.logd"C2SSimpleRecord------------"e;letsendData=newProtocol.SimpleRecord_Requestde;letsendByte=Protocol.SimpleRecord_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.SIMPLE_RECORD_REQ,sendBytee;}}}﻿moduleClientNet{exportclassNetShop{publicstaticInitde{NetManager.RegisterCallbackdProtocol.MessageID.BUY_TREASURE_INFO_RES,NetShop.S2CShopInfoe;NetManager.RegisterCallbackdProtocol.MessageID.BUY_TREASURE_RES,NetShop.S2CBuye;}publicstaticDisposede{NetManager.UnSubscribedProtocol.MessageID.BUY_TREASURE_INFO_RESe;NetManager.UnSubscribedProtocol.MessageID.BUY_TREASURE_RESe;}cc----------------------------------------------------------------------购买商店publicstaticC2SBuyditemId:numbere{letsendData=newProtocol.BuyTreasure_Requestde;sendData.treasureId=itemId;letsendByte=Protocol.BuyTreasure_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.BUY_TREASURE_REQ,sendBytee;}publicstaticS2CBuydcmdDataBA:egret.ByteArraye{letinfo=Protocol.BuyTreasure_Respond.decodedcmdDataBA.bytese;ifdinfo.ret==1e{letsMgr=game.MainDataMgr.GetInstancede.shopDataMgr;letitem=sMgr.GetItemdinfo.treasureIde;item.SetCountditem.hasBuy+1e;game.TipsManager.ShowTipsdLanUtil.GetTextd"购买成功"ee;}else{game.TipsManager.ShowTipsdLanUtil.GetTextd"购买失败"ee;}}cc----------------------------------------------------------------------商店信息publicstaticC2SShopInfode{letsendData=newProtocol.BuyTreasureInfo_Requestde;letsendByte=Protocol.BuyTreasureInfo_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.BUY_TREASURE_INFO_REQ,sendBytee;}publicstaticS2CShopInfodcmdDataBA:egret.ByteArraye{letinfo=Protocol.BuyTreasureInfo_Respond.decodedcmdDataBA.bytese;letsMgr=game.MainDataMgr.GetInstancede.shopDataMgr;ifdsMgr!=nulle{letgoods:game.GoodsDataItemfordletitemofinfo.infose{goods=sMgr.GetItemditem.treasureIde;ifdgoods==nullecontinue;goods.SetCountditem.hasBuyCounte;}}}}}﻿moduleClientNet{exportclassNetTask{publicstaticInitde{NetManager.RegisterCallbackdProtocol.MessageID.TASK_CHANGE_RES,NetTask.S2CTaskChangee;}publicstaticDisposede{NetManager.UnSubscribedProtocol.MessageID.TASK_CHANGE_RESe;}publicstaticS2CTaskChangedcmdDataBA:egret.ByteArraye{lettaskData=Protocol.TaskChange_Respond.decodedcmdDataBA.bytese;NetTask.RefreshTasksdtaskData.taskse;}publicstaticRefreshTasksdtasks:Protocol.ITask[]e:void{lettaskDataMgr=game.MainDataMgr.GetInstancede.taskDataMgr;taskDataMgr.ClearTaskde;tasks.sortddt1,t2e=b{ifdt1.gridbt2.gridereturn1;elsereturn-1;}e;ccgame.logd"-----任务刷新-----bbbbbbbbbbbbbbbbb"e;fordlettaskoftaskse{ccgame.logdtask.taskId,"----------bbbbbbbbbbbbbbbbb",task.gride;lettaskObj=taskDataMgr.AddTaskdtask.taskId,task.finishCount,falsee;taskObj.startTime=Numberdtask.finishTimee;cc服务器发的是上个任务完成的时间点所以需要+6个小时是下个任务刷新的时间点ifdtaskObj.startTime!=0etaskObj.startTime+=6*3600*1000;ifdtask.isFinishetaskObj.nowCount=taskObj.totalCount;}taskDataMgr.RefreshTaskCBde;}publicstaticC2SFinishTaskdtaskId:numbere{letsendData=newProtocol.FinishTask_Requestde;sendData.taskIndex=taskId;letsendByte=Protocol.FinishTask_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.FINISH_TASK_REQ,sendBytee;}publicstaticC2SRefreshTaskdtaskId:numbere{letsendData=newProtocol.RefreshTask_Requestde;sendData.taskIndex=taskId;letsendByte=Protocol.RefreshTask_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.REFRESH_TASK_REQ,sendBytee;}publicstaticC2SRefreshScorede{letsendData=newProtocol.TaskScopeBoxOpen_Requestde;letsendByte=Protocol.RefreshTask_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.TASK_SCOPE_BOX_OPEN_REQ,sendBytee;}}}﻿moduleClientNet{exportclassNetTeam{publicstaticInitde{NetManager.RegisterCallbackdProtocol.MessageID.SET_FIGHT_LINEUP_RES,NetTeam.S2CSetTeamIndexe;NetManager.RegisterCallbackdProtocol.MessageID.SET_LINEUP_RES,NetTeam.S2CUpdateTeame;}publicstaticDisposede{NetManager.UnSubscribedProtocol.MessageID.SET_FIGHT_LINEUP_RESe;NetManager.UnSubscribedProtocol.MessageID.SET_LINEUP_RESe;}cc----------------------------------------------------------------------修改卡组idpublicstaticC2SSetTeamIndexdteamIndex:numbere{letsendData=newProtocol.SetFightLineUp_Requestde;sendData.lineUpNum=teamIndex;letsendByte=Protocol.SetFightLineUp_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.SET_FIGHT_LINEUP_REQ,sendBytee;}publicstaticS2CSetTeamIndexdcmdDataBA:egret.ByteArraye{letinfo=Protocol.SetFightLineUp_Respond.decodedcmdDataBA.bytese;game.MainDataMgr.GetInstancede.teamDataMgr.currentTeamIndex=info.lineUpNum;game.GlobalEvent.FireEventdGlobalEventType.ChangeTeamIndexe;}cc----------------------------------------------------------------------替换领主c英雄...cc1领主2英雄publicstaticC2SUpdateTeamdtype:number,teamId:number,oId:number,nId:numbere{letmMgr=game.MainDataMgr.GetInstancede;letidArray:number[];ifdtype==1e{letnewLeaderId:number=nId;ifdnewLeaderId==nullereturn;letherosId:number[]=mMgr.teamDataMgr.SuitHeroArraydteamId,nIde;idArray=[].concatdnewLeaderId,herosIde;}elseifdtype==2e{letleaderInfo=mMgr.teamDataMgr.GetTeamInfodteamIde;letindex=leaderInfo.heroArray.indexOfdoIde;ifdindexa0ereturn;leaderInfo.heroArray.splicedindex,1,nIde;letleaderId:number=leaderInfo.leaderletherosId:number[]=mMgr.teamDataMgr.GetTeamInfodteamIde.heroArray;idArray=[].concatdleaderId,herosIde;}else{return;}letsendData=newProtocol.SetLineUp_Requestde;sendData.lineUpNum=teamId;sendData.heroIds=idArray;letsendByte=Protocol.SetLineUp_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.SET_LINEUP_REQ,sendBytee;}publicstaticS2CUpdateTeamdcmdDataBA:egret.ByteArraye{letinfo=Protocol.SetLineUp_Respond.decodedcmdDataBA.bytese;ifdinfo.ret==1e{letheroIds:number[]=[];letleaderId:number;letmMgr=game.MainDataMgr.GetInstancede;letid:number;fordleti=0,len=info.heroIds.length;ialen;i++e{id=info.heroIds[i];ifdECSC.RenderWarUtil.IsKingTowerdide==truee{leaderId=id;}else{heroIds.pushdide;}}ifdleaderId!=nulle{mMgr.teamDataMgr.ChangeLeaderdinfo.lineUpNum,leaderIde;game.GlobalEvent.FireEventdGlobalEventType.ChangeLeader,info.lineUpNum,leaderIde;}mMgr.teamDataMgr.SwapAllHerodinfo.lineUpNum,heroIdse;game.GlobalEvent.FireEventdGlobalEventType.SWapHero,heroIdse;}}}}﻿moduleClientNet{exportclassNetTime{publicstaticrequestTimeCount:number=100;publicstaticheartTimerKey:number=0;ccC2SccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicstaticInitde{NetTime.Disposede;game.logd"------NetTime.Init-------bbbbbbbbbbbbbbbbbbbbbbbb"e;NetManager.RegisterCallbackdProtocol.MessageID.HEARBEAT_RES,NetTime.S2CHeartBeate;NetManager.RegisterCallbackdProtocol.MessageID.GET_LOGIC_TIME_RES,NetTime.S2CServerTimee;}publicstaticDisposede{NetManager.UnSubscribedProtocol.MessageID.HEARBEAT_RESe;ifdNetTime.heartTimerKey!=0e{game.TimerMgr.GetInstancede.RemoveTimerdNetTime.heartTimerKeye;NetTime.heartTimerKey=0;}}cc连接上服务器后定时请求心跳包publicstaticStartHeartTimedinterval:numbere{game.logd"------NetTime.StartHeartTime-------bbbbbbbbbbbbbbbbbbbbbbbb"e;NetTime.requestTimeCount=0;ifdNetTime.heartTimerKey!=0e{game.TimerMgr.GetInstancede.RemoveTimerdNetTime.heartTimerKeye;NetTime.heartTimerKey=0;}NetTime.C2SHeartBeatde;NetTime.heartTimerKey=game.TimerMgr.GetInstancede.AddTimerdinterval,NetTime.C2SHeartBeat,thise;}publicstaticStopHeartTimede{NetTime.requestTimeCount=100;ifdNetTime.heartTimerKey!=0e{game.TimerMgr.GetInstancede.RemoveTimerdNetTime.heartTimerKeye;NetTime.heartTimerKey=0;}}publicstaticnowIndex=-1;cc服务器时间同步publicstaticS2CHeartBeatdcmdDataBA:egret.ByteArraye{NetTime.requestTimeCount--;letdata=Protocol.HearBeat_Respond.decodedcmdDataBA.bytese;ccgame.logd`___________S2CHeartBeatindex:${data.index}___________`,egret.getTimerdee;ifdNetTime.nowIndex==-1e{NetTime.nowIndex=data.index;return;}ccifddata.index!=0ecc{ccifddata.index-NetTime.nowIndex!=1ecc{ccgame.errord"----------------------ddddddffffffff-------------------------------------bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb",NetTime.nowIndex,data.indexe;cc}cc}NetTime.nowIndex=data.index;ifddata.index==999eNetTime.nowIndex=-1;}publicstaticS2CServerTimedcmdDataBA:egret.ByteArraye{letdata=Protocol.GetLogicTime_Respond.decodedcmdDataBA.bytese;game.HomeServerTime.SetServerTimedNumberddata.timeee;}ccC2SccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicstaticC2SHeartBeatde{NetTime.requestTimeCount++;letsendData=newProtocol.HearBeat_Respondde;letsendByte=Protocol.HearBeat_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.HEARBEAT_REQ,sendBytee;ccgame.logd`___________C2SHeartBeat___________`,egret.getTimerdee;NetTime.C2SServerTimede;returntrue;}publicstaticC2SServerTimede{letsendData=newProtocol.GetLogicTime_Requestde;letsendByte=Protocol.GetLogicTime_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.GET_LOGIC_TIME_REQ,sendBytee;}publicstaticIsConnectedde:boolean{returnNetTime.requestTimeCounta=2;}}}﻿c***请求用户信息例子*bydily*dcecopyright2014-2035*AllRightsReserved.*cmoduleClientNet{exportclassNetUser{publicstaticInitde{ccNetManager.RegisterCallbackdNetS2CConst.UserInfo,NetUser.S2CUserInfoe;}publicstaticDisposede{ccNetManager.UnSubscribedNetS2CConst.UserInfoe;}publicstaticInitUserInfode{}publicstaticS2CUserInfodcmdDataBA:egret.ByteArraye{ccletuser_login=Protocol.user_login.decodedcmdDataBA.bytese;ccgame.logduser_login.userId,user_login.userNamee;cc输出1"abc"}publicstaticC2SUserInfoduserId:number,userName:stringe:void{cccccc创建user_login_classccccvaruser_login_class=Global.getMessaged"user_login"e;cccccc创建一条消息ccccvaruser_login=newuser_login_classd{cccc"userId":userId,cccc"userName":userNamecccc}e;ccletsendData=newProtocol.user_loginde;ccsendData.userId=userId;ccsendData.userName=userName;ccccencodeuser_loginccletsendByte=Protocol.user_login.encodedsendDatae.finishde;ccSocketManager.SendMessagedNetC2SConst.UserInfo,sendBytee;}}}﻿c***同步用户操作的协议*bydily*dcecopyright2014-2035*AllRightsReserved.*cmoduleClientNet{exportclassNetWar{publicstaticrequestTimeCount:number=0;publicstaticheartTimerKey:number=0;ccS2CccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicstaticInitde{NetManager.RegisterCallbackdProtocol.MessageID.ENTER_ROOM_RES,NetWar.S2CEnterRoome;NetManager.RegisterCallbackdProtocol.MessageID.WAR_READY_RES,NetWar.S2CWarReadye;NetManager.RegisterCallbackdProtocol.MessageID.SYN_ROOM_STATE_RES,NetWar.S2CRoomStatee;NetManager.RegisterCallbackdProtocol.MessageID.START_WAR_RES,NetWar.S2CStartSyncMsge;ccNetManager.RegisterCallbackdProtocol.MessageID.ENTER_ROOM_REQ,NetWar.S2CReConnectMsge;ccNetManager.RegisterCallbackdProtocol.MessageID.ENTER_ROOM_REQ,NetWar.S2CAffirmMsge;NetManager.RegisterCallbackdProtocol.MessageID.ACTION_RES,NetWar.S2CCommandMsge;cc重连相关NetManager.RegisterCallbackdProtocol.MessageID.FIGHT_RECONNECT_ACTION_RES,NetWar.S2CFightReconnectActione;NetManager.RegisterCallbackdProtocol.MessageID.ACTIONFRAME_RES,NetWar.S2CActionFramee;NetManager.RegisterCallbackdProtocol.MessageID.SERVER_TIME_RES,NetWar.S2CServerTimee;NetManager.RegisterCallbackdProtocol.MessageID.BATTLE_RET_RES,NetWar.S2CBattleRete;NetManager.RegisterCallbackdProtocol.MessageID.BATTLE_REWARD_RES,NetWar.S2CBattleRewarde;NetManager.RegisterCallbackdProtocol.MessageID.QUIT_WAR_RES,NetWar.S2CQuitWare;}publicstaticDisposede{NetWar.StopHeartTimede;NetManager.UnSubscribedProtocol.MessageID.ENTER_ROOM_RESe;NetManager.UnSubscribedProtocol.MessageID.WAR_READY_RESe;NetManager.UnSubscribedProtocol.MessageID.SYN_ROOM_STATE_RESe;NetManager.UnSubscribedProtocol.MessageID.START_WAR_RESe;ccNetManager.UnSubscribedProtocol.MessageID.WAR_READY_RESe;ccNetManager.UnSubscribedProtocol.MessageID.WAR_READY_RESe;NetManager.UnSubscribedProtocol.MessageID.ACTION_RESe;NetManager.UnSubscribedProtocol.MessageID.FIGHT_RECONNECT_ACTION_RESe;NetManager.UnSubscribedProtocol.MessageID.ACTIONFRAME_RESe;NetManager.UnSubscribedProtocol.MessageID.SERVER_TIME_RESe;NetManager.UnSubscribedProtocol.MessageID.BATTLE_RET_RESe;NetManager.UnSubscribedProtocol.MessageID.BATTLE_REWARD_RESe;NetManager.UnSubscribedProtocol.MessageID.QUIT_WAR_RESe;}publicstaticStartHeartTimedinterval:numbere{NetWar.requestTimeCount=0;ifdNetWar.heartTimerKey!=0e{game.TimerMgr.GetInstancede.RemoveTimerdNetWar.heartTimerKeye;NetWar.heartTimerKey=0;}FightServerTime.SetServerTimed0e;NetWar.C2SServerTimede;NetWar.heartTimerKey=game.TimerMgr.GetInstancede.AddTimerdinterval,NetWar.C2SServerTime,thise;}publicstaticStopHeartTimede{NetWar.requestTimeCount=0;ifdNetWar.heartTimerKey!=0e{game.TimerMgr.GetInstancede.RemoveTimerdNetWar.heartTimerKeye;NetWar.heartTimerKey=0;}}publicstaticS2CEnterRoomdcmdDataBA:egret.ByteArraye{letenterRoom=Protocol.EnterRoom_Respond.decodedcmdDataBA.bytese;letret=enterRoom.result;game.GlobalEvent.FireEventdGlobalEventType.FightLoginResult,enterRoom.resulte;}publicstaticS2CWarReadydcmdDataBA:egret.ByteArraye{letcmd=Protocol.WarReady_Response.decodedcmdDataBA.bytese;letworldObj=ECSC.RenderWarUtil.GetWorldObjde;ifdworldObj==nulle{game.errord"S2CWarReadyErrorroomId:",cmd.roomIde;return;}letfightRoleId=ECSC.RenderWarUtil.GetWorldObjde.GetFightRoleIDdNumberdcmd.roleIdee;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;warComp.SetPlayerReadydfightRoleIde;}cc同步房间准备状态的消息publicstaticS2CRoomStatedcmdDataBA:egret.ByteArraye{letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;letcmd=Protocol.SynRoomState_Response.decodedcmdDataBA.bytese;fordletinfoofcmd.infose{letfightRoleId=ECSC.RenderWarUtil.GetWorldObjde.GetFightRoleIDdNumberdinfo.roleIdee;ifdinfo.state==1ecc玩家好了warComp.SetPlayerReadydfightRoleIde;}}cc开始游戏publicstaticS2CStartSyncMsgdcmdDataBA:egret.ByteArraye{ccletcmd=Protocol.StartWar_Reponse.decodedcmdDataBA.bytese;ccECS.LogicWarManager.GetInstancede.InitStartWarDatadNumberdcmd.timee,cmd.seed,nulle;ECSC.CNetWar.Server2Logicd"S2CStartSyncMsg",cmdDataBA.bytese;}publicstaticS2CFightReconnectActiondcmdDataBA:egret.ByteArraye{ccletcmd=Protocol.FightReconnectAction_Respond.decodedcmdDataBA.bytese;ccgame.GlobalEvent.FireEventdGlobalEventType.SyncMessage,Protocol.MessageID.FIGHT_RECONNECT_ACTION_RES,cmde;ccgame.logd"-----S2CFightReconnectAction-----bbbbbbbbbbbbbbbbbbbbbbbbbbbb",JsonData.getJsonStringdcmdee;}cc补帧publicstaticS2CActionFramedcmdDataBA:egret.ByteArraye{ccletcmd=Protocol.ActionFrame_Response.decodedcmdDataBA.bytese;ccgame.GlobalEvent.FireEventdGlobalEventType.SyncMessage,Protocol.MessageID.ACTIONFRAME_RES,cmde;ccgame.logd"--补帧--S2CActionFrame-----bbbbbbbbbbbbbbbbbbbbbbbbbbbb",cmd.actionse;ECSC.CNetWar.Server2Logicd"S2CActionFrame",cmdDataBA.bytese;}cccc断线重连d可能用于断线重连或者刚开始进入游戏的时候服务器发送eTODONIU这个协议还没写ccpublicstaticS2CReConnectMsgdcmdDataBA:egret.ByteArrayecc{ccletcmd=Protocol.Reconnect_Response.decodedcmdDataBA.bytese;ccgame.GlobalEvent.FireEventdGlobalEventType.SyncMessage,NetS2CConst.ReconnectMsg,cmde;cc}cccc帧确认消息用以计算ping值TODONIU这个协议还没写ccpublicstaticS2CAffirmMsgdcmdDataBA:egret.ByteArrayecc{ccletcmd=Protocol.StartWar_Reponse.decodedcmdDataBA.bytese;ccgame.GlobalEvent.FireEventdGlobalEventType.SyncMessage,NetS2CConst.AffirmMsg,cmde;cc}publicstaticS2CCommandMsgdcmdDataBA:egret.ByteArraye{ccletcmd=Protocol.Action_Response.decodedcmdDataBA.bytese;ccgame.GlobalEvent.FireEventdGlobalEventType.SyncMessage,Protocol.MessageID.ACTION_RES,cmde;ECSC.CNetWar.Server2Logicd"S2CCommandMsg",cmdDataBA.bytese;}publicstaticS2CServerTimedcmdDataBA:egret.ByteArraye{NetWar.requestTimeCount--;letcmd=Protocol.ServerTime_Response.decodedcmdDataBA.bytese;FightServerTime.SetServerTimedNumberdcmd.timeee;ECSC.CNetWar.Server2Logicd"S2CServerTime",cmdDataBA.bytese;}publicstaticS2CBattleRewarddcmdDataBA:egret.ByteArraye{letcmd=Protocol.BattleReward_Respond.decodedcmdDataBA.bytese;game.logd"----S2CBattleReward------",cmde;ifdgame.SceneManager.GetInstancede.IsInHomedeecc客户端已经回到主城{return;}letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdwarComp==nullecc数据无效了{return;}ifdcmd.winType==4||cmd.winType==3ecc无效战斗或者平局直接回主城{game.errord"S2CBattleRewardinvalidwar............",cmd.winTypee;return;}letserverRetInfo=warComp.serverWarRetInfo;ifdserverRetInfo==nulle{game.errord"servershouldsendS2CBattleRetfirst!!!!"e;serverRetInfo=warComp.serverWarRetInfo=newWarResultInfode;}serverRetInfo.rewardInfo=[];fordletrewardofcmd.rewardse{serverRetInfo.rewardInfo.pushd[reward.index,reward.count]e;}serverRetInfo.rewardInfo.pushd[Protocol.PropertyEnum.CUPS,cmd.cups]e;cc如果客户端还没有计算完成就先不管服务器的结算协议letworldObj=ECSC.RenderWorld.GetInstancede;game.logd`-----S2CBattleRetisStart:${worldObj.isStart}frameCount:${worldObj.frameCount}serverFrameCount:${worldObj.serverFrameCount}`e;cc发送到逻辑层ECSC.CNetWar.Server2Logicd"S2CBattleReward",cmdDataBA.bytese;cc客户端的帧还没跑完ifdworldObj.isStart&&worldObj.frameCounta=worldObj.serverFrameCounte{game.logd"-----S2CBattleRetandclientisstillrunning",worldObj.frameCount,worldObj.serverFrameCount,newErrorde.stacke;return;}game.UIManager.HidePaneldPanelTypeConst.WarOvere;game.UIManager.ShowPaneldPanelTypeConst.WarOver,serverRetInfoe;}publicstaticS2CBattleRetdcmdDataBA:egret.ByteArraye{letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdwarComp==nulle{game.errord"S2CBattleRetwarComp==null............"e;game.SceneManager.GetInstancede.EnterHomede;return;}letcmd=Protocol.BattleRet_Respond.decodedcmdDataBA.bytese;ifdcmd.winType==4||cmd.winType==3ecc无效战斗或者平局直接回主城{game.errord"S2CBattleRetinvalidwar............",cmd.winTypee;game.SceneManager.GetInstancede.EnterHomede;return;}game.logd"----S2CBattleRet------",cmde;cc把战斗结果记录到serverWarRetInfoletmyAtkType=warComp.myAtkType;letwinAtkType=cmd.winType;letserverRetInfo=warComp.serverWarRetInfo=newWarResultInfode;serverRetInfo.winAtkType=winAtkType;ifdcmd.kills.lengtha2ecc击杀数目异常cmd.kills=[0,0];serverRetInfo.dieTowerInfo.setdAtkType.Attack,cmd.kills[0]e;serverRetInfo.dieTowerInfo.setdAtkType.Defend,cmd.kills[1]e;cc发送到逻辑层ECSC.CNetWar.Server2Logicd"S2CBattleRet",cmdDataBA.bytese;}publicstaticS2CQuitWardcmdDataBA:egret.ByteArraye{letcmd=Protocol.QuitWar_Respond.decodedcmdDataBA.bytese;game.SceneManager.GetInstancede.EnterHomede;cc退出战斗}ccC2SccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicstaticC2SEnterRoomdroomId:stringe:void{letsendData=newProtocol.EnterRoom_Requestde;sendData.roomId=roomId;sendData.roleId=game.MainDataMgr.GetInstancede.roleId;letsendByte=Protocol.EnterRoom_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.ENTER_ROOM_REQ,sendBytee;}publicstaticC2SWarReadyde:void{letsendData=newProtocol.WarReady_Requestde;sendData.id=game.MainDataMgr.GetInstancede.roleId;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;sendData.roomId=warComp.roomId;letsendByte=Protocol.WarReady_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.WAR_READY_REQ,sendBytee;}cc帧相关--------------------publicstaticC2SCommandMsgdroomId:string,action:number,id:number,minFrame:number,args:anye:void{letsendData=newProtocol.Action_Requestde;sendData.roomId=roomId;sendData.actionArray=ECS.CommandPack.Packdaction,id,minFrame,argse;letsendByte=Protocol.Action_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.ACTION_REQ,sendBytee;}publicstaticC2SActionFramedframes:number[]e{game.logd"------------请求补帧..................",framese;letsendData=newProtocol.ActionFrame_Requestde;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;sendData.roomId=warComp.roomId;sendData.roleId=game.MainDataMgr.GetInstancede.roleId;sendData.frames=Array.fromdframese;letsendByte=Protocol.ActionFrame_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.ACTIONFRAME_REQ,sendBytee;}cc帧相关-----------------------publicstaticC2SServerTimede{NetWar.requestTimeCount++;letsendData=newProtocol.ServerTime_Requestde;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;sendData.roomId=warComp.roomId;sendData.roleId=game.MainDataMgr.GetInstancede.roleId;letsendByte=Protocol.ServerTime_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.SERVER_TIME_REQ,sendBytee;returntrue;}cc重连相关publicstaticC2SFightReconnectde{letsendData=newProtocol.FightReconnect_Requestde;sendData.roomId=game.MainDataMgr.GetInstancede.fightRoomId;sendData.roleId=game.MainDataMgr.GetInstancede.roleId;letsendByte=Protocol.FightReconnect_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.FIGHT_RECONNECT_REQ,sendBytee;}publicstaticC2SBattleEnddretInfo:WarResultInfoe{ifdretInfo==nulle{game.errord"NetWar.C2SBattleEndretInfoisnull:",newErrorde.stacke;return;}game.Utils.UpdateProtoTypedretInfo.dieTowerInfoe;ECSC.RenderWorld.GetInstancede.WarOverde;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;letsendData=newProtocol.BattleEnd_Requestde;sendData.roleId=game.MainDataMgr.GetInstancede.roleId;sendData.roomId=warComp.roomId;letplayerArray=warComp.GetPlayerByAtkTypedretInfo.winAtkTypee;sendData.winId=[];fordletplayerObjofplayerArrayesendData.winId.pushdplayerObj.serverIde;sendData.winType=retInfo.winAtkType;sendData.kills=[retInfo.dieTowerInfo.getdAtkType.Attacke,retInfo.dieTowerInfo.getdAtkType.Defende]letsendByte=Protocol.BattleEnd_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.BATTLE_END_REQ,sendBytee;game.logd"-------C2SBattleEnd:-------",sendData.winType,sendData.kills[0],sendData.kills[1]e;}publicstaticC2SQuitWardtype:numbere{letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;letsendData=newProtocol.QuitWar_Requestde;sendData.type=type;sendData.roomId=warComp.roomId;sendData.roleId=game.MainDataMgr.GetInstancede.roleId;letsendByte=Protocol.QuitWar_Request.encodedsendDatae.finishde;SocketManager.GetInstancede.SendMessagedProtocol.MessageID.QUIT_WAR_REQ,sendBytee;game.logd"----------------C2SQuitWar---------------------",sendData.type,sendData.roleId,sendData.roomIde;}publicstaticCheckNetConnectde:boolean{returnNetWar.requestTimeCounta=1;}}}﻿c***网络公共类*bydily*dcecopyright2014-2035*AllRightsReserved.*存放网络公共方法*注意：是同步请求，不是异步*cmoduleClientNet{exportclassSocketManager{publicstaticinstance:SocketManager;publicstaticGetInstancede:SocketManager{ifdSocketManager.instance==nulle{SocketManager.instance=newSocketManagerde;}returnSocketManager.instance;}privatetimerKey:number;privatesock:egret.WebSocket;privatecacheMsgArray:[number,egret.ByteArray][]=[];publicconstructorde{}publicInitde{this.Disposede;game.GlobalEvent.SubscribedGlobalEventType.S2CMessage,this.OnReceiveLocalMessage,thise;this.timerKey=game.TimerMgr.GetInstancede.AddTimerd100,this.ProcessCacheMessage,thise;}publicDisposede{game.GlobalEvent.UnSubscribedGlobalEventType.S2CMessage,this.OnReceiveLocalMessage,thise;ifdthis.timerKey!=nulle{game.TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=null;}this.DisposeSocketde;}publicConnectServerdhost:string="",port:string="80"e{ccGlobal.ShowWaitPaneld0e;this.DisposeSocketde;this.sock=newegret.WebSocketde;this.sock.type=egret.WebSocket.TYPE_BINARY;this.sock.addEventListenerdegret.ProgressEvent.SOCKET_DATA,this.OnReceiveMessage,thise;this.sock.addEventListenerdegret.Event.CONNECT,this.OnSocketOpen,thise;this.sock.addEventListenerdegret.Event.CLOSE,this.OnSocketClose,thise;this.sock.addEventListenerdegret.IOErrorEvent.IO_ERROR,this.OnSocketError,thise;game.logd"GameServerConnectServer------bbbbbbbbbbbbbbb",host,port,egret.getTimerdee;ifdGameData.LocalTestethis.OnSocketOpende;elsethis.sock.connectdhost,Numberdportee;}publicIsSocketValidde:boolean{returnthis.sock!=null;}publicDisposeSocketde{game.logd"___________DisposeSocket_________________"e;fordletmsgofthis.cacheMsgArraye{msg[1].clearde;}this.cacheMsgArray=[];cc启动定时器来定时处理协议ifdthis.sock!=nulle{this.sock.removeEventListenerdegret.ProgressEvent.SOCKET_DATA,this.OnReceiveMessage,thise;this.sock.removeEventListenerdegret.Event.CONNECT,this.OnSocketOpen,thise;this.sock.removeEventListenerdegret.Event.CLOSE,this.OnSocketClose,thise;this.sock.removeEventListenerdegret.IOErrorEvent.IO_ERROR,this.OnSocketError,thise;this.sock.closede;this.sock=null;}}cc连接成功返回publicOnSocketOpende:void{game.logd"____SocketManager____OnSocketOpen______________",egret.getTimerdee;game.GlobalEvent.FireEventdGlobalEventType.ConnectResult,1e;}publicOnSocketClosede:void{game.logd"___SocketManager____OnSocketClose____________",newErrorde.stacke;this.DisposeSocketde;game.GlobalEvent.FireEventdGlobalEventType.ConnectResult,0e;}publicOnSocketErrorde:void{game.logd"___SocketManager____OnSocketError____________",newErrorde.stacke;this.DisposeSocketde;game.GlobalEvent.FireEventdGlobalEventType.ConnectResult,0e;}cc消息返回publicOnReceiveMessagede:void{ccGlobal.HideWaitPanelde;let_arr:egret.ByteArray=newegret.ByteArrayde;this.sock.readBytesd_arre;letlength=_arr.readIntde;cc协议长度letmainId=_arr.readShortde;letcmdDataBA:egret.ByteArray=newegret.ByteArrayde;_arr.readBytesdcmdDataBAe;ifdSettings.loge{ccifdmainId!=Protocol.MessageID.ACTION_RESeccgame.logd"OnReceiveMessage-----bbbbbbbbbbbbbbbbbbb",mainId,"msg.len:",lengthe;}ifdcmdDataBA.length!=length-2e{game.errord`SocketManagerOnReceiveMessageerrorlength:${length}bodyLenght:${cmdDataBA.length}!!!!`e;}this.cacheMsgArray.pushd[mainId,cmdDataBA]e;ccNetManager.ReceiveMessagedmainId,cmdDataBAe;}cc向服务端发送消息publicSendMessagedmainId:number,msg:Uint8Arraye:void{ifdSettings.log&&game.SceneManager.GetInstancede.IsInHomede&&dmainId!=Protocol.MessageID.HEARBEAT_REQ&&mainId!=Protocol.MessageID.GET_LOGIC_TIME_REQeegame.logd"SendMessage------bbbbbbbbbbbbbbb",mainIde;ifdGameData.LocalTeste{this.SendLocalMessagedmainId,msge;return;}ifdthis.sock==nullereturn;letsendMsg:egret.ByteArray=newegret.ByteArrayde;sendMsg.writeIntdmsg.length+2e;cc协议长度sendMsg.writeShortdmainIde;letcmdDataBA=newegret.ByteArraydmsge;sendMsg.writeBytesdcmdDataBAe;this.sock.writeBytesdsendMsg,0,sendMsg.lengthe;}cc接受本地消息publicOnReceiveLocalMessaged_arr:egret.ByteArraye:void{_arr.position=0;letlength=_arr.readIntde;cc协议长度letmainId=_arr.readShortde;letcmdDataBA:egret.ByteArray=newegret.ByteArrayde;_arr.readBytesdcmdDataBAe;ifdcmdDataBA.length!=length-2e{game.warnd`SocketManagerOnReceiveMessageerrorlength:${length}bodyLenght:${cmdDataBA.length}!!!!`e;}this.cacheMsgArray.pushd[mainId,cmdDataBA]e;ccNetManager.ReceiveMessagedmainId,cmdDataBAe;}cc向本地发送消息publicSendLocalMessagedmainId:number,msg:Uint8Arraye:void{letsendMsg:egret.ByteArray=newegret.ByteArrayde;sendMsg.writeIntdmsg.length+2e;cc协议长度sendMsg.writeShortdmainIde;letcmdDataBA=newegret.ByteArraydmsge;sendMsg.writeBytesdcmdDataBAe;game.GlobalEvent.FireEventdGlobalEventType.C2SMessage,sendMsge;}privateProcessCacheMessagede{ifdthis.cacheMsgArray.length==0ereturntrue;fordletmsgofthis.cacheMsgArraye{ClientNet.NetManager.ReceiveMessagedmsg[0],msg[1]e;}this.cacheMsgArray.length=0;returntrue;}}}﻿c***同步用户操作的协议*bydily*dcecopyright2014-2035*AllRightsReserved.*cmoduleNodeJS{exportclassNetServer{publicstaticrequestTimeCount:number=0;publicstaticheartTimerKey:number=0;ccS2CccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicstaticInitde{ClientNet.NetManager.RegisterCallbackdProtocol.MessageID.CHECK_LOGIN_FIGHT_RESPOND,NetServer.S2CLogine;ClientNet.NetManager.RegisterCallbackdProtocol.MessageID.FIGHT_ROOM_INFO_RESPOND,NetServer.S2CFightRoomInfoe;}publicstaticDisposede{ClientNet.NetWar.StopHeartTimede;ClientNet.NetManager.UnSubscribedProtocol.MessageID.CHECK_LOGIN_FIGHT_RESPONDe;ClientNet.NetManager.UnSubscribedProtocol.MessageID.FIGHT_ROOM_INFO_RESPONDe;}ccpublicstaticStartHeartTimedinterval:numberecc{ccNetWar.requestTimeCount=0;ccifdNetWar.heartTimerKey!=0ecc{ccTimerMgr.GetInstancede.RemoveTimerdNetWar.heartTimerKeye;ccNetWar.heartTimerKey=0;cc}ccNetWar.C2SServerTimede;ccNetWar.heartTimerKey=TimerMgr.GetInstancede.AddTimerdinterval,NetWar.C2SServerTime,thise;cc}ccccpublicstaticStopHeartTimedecc{ccNetWar.requestTimeCount=0;ccifdNetWar.heartTimerKey!=0ecc{ccTimerMgr.GetInstancede.RemoveTimerdNetWar.heartTimerKeye;ccNetWar.heartTimerKey=0;cc}cc}publicstaticS2CLogindcmdDataBA:egret.ByteArraye{letcmd=Protocol.CheckLoginFight_Respond.decodedcmdDataBA.bytese;game.GlobalEvent.FireEventdGlobalEventType.CheckLoginResult,cmd.rete;}cc战斗信息publicstaticS2CFightRoomInfodcmdDataBA:egret.ByteArraye{game.GlobalEvent.FireEventdGlobalEventType.ServerBeginCalcu,cmdDataBAe;game.logd"-----S2CFightRoomInfo-----bbbbbbbbbbbbbbbbbbbbbbbbbbbb"e;}ccC2SccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicstaticC2SLoginde:void{letsendData=newProtocol.CheckLoginFight_Requestde;letsendByte=Protocol.CheckLoginFight_Request.encodedsendDatae.finishde;ClientNet.SocketManager.GetInstancede.SendMessagedProtocol.MessageID.CHECK_LOGIN_FIGHT_REQUEST,sendBytee;}publicstaticC2SCalResultdroomId:string,winId:number[],winType:number,kills:number[]e:void{letsendData=newProtocol.CheckCalResult_Requestde;sendData.roomId=roomId;sendData.winId=winId;sendData.winType=winType;sendData.kills=kills;letsendByte=Protocol.CheckCalResult_Request.encodedsendDatae.finishde;ClientNet.SocketManager.GetInstancede.SendMessagedProtocol.MessageID.CHCEK_CAL_RESULT_REQUEST,sendBytee;}ccpublicstaticC2SServerTimedecc{ccNetWar.requestTimeCount++;ccccletsendData=newProtocol.ServerTime_Requestde;ccsendData.roomId=LinkUtil.GetPreWarDatade.roomId;ccsendData.roleId=game.MainDataMgr.GetInstancede.roleId;ccletsendByte=Protocol.ServerTime_Request.encodedsendDatae.finishde;ccSocketManager.GetInstancede.SendMessagedProtocol.MessageID.SERVER_TIME_REQ,sendBytee;ccccccreturntrue;cc}ccpublicstaticCheckNetConnectde:booleancc{ccreturnNetWar.requestTimeCounta=1;cc}}}﻿cccareferencepath="..cTestcClientLogiccRendercWarNumber.ts"cbmoduleNodeJS{exportclassServerMain{privatestaticinstance:ServerMain;publicstaticGetInstancede:ServerMain{ifdServerMain.instance==nulleServerMain.instance=newServerMainde;returnServerMain.instance;}publicserverId:number=0;privateip:string;privateport:string;privateisConnecting:boolean;privateisLogining:boolean;privateisLogined:boolean;private_isConnected:boolean;publicInitde{GameData.LocalTest=false;ClientNet.NetManager.netCallbackDict=newSMapanumber,game.AttrCallBackbde;game.NetConst.Initde;NodeJS.NetServer.Initde;ClientNet.SocketManager.GetInstancede.Initde;this.isConnecting=false;this.isLogining=false;this.isLogined=false;ccletserverData=NetConst.serverArray[this.serverId];ccthis.ip=serverData.ip;ccthis.port="6601";game.TimerMgr.GetInstancede.AddTimerd200,this.CheckConnected,thise;}publicCheckConnectedde{this._isConnected=false;ifdthis.isConnectinge{game.logd"连接服务器中..."e;returntrue;}ifd!ClientNet.SocketManager.GetInstancede.IsSocketValiddee{game.logd`----开始重连服务器---ip:${this.ip}port:${this.port}--`e;this.isConnecting=true;this.ConnectServerdthis.ip,this.port,this.ReConnectServerRet,thise;returntrue;}ifdthis.isLogininge{game.logd"登录服务器中..."e;returntrue;}ifd!this.isLoginede{this.isLogining=true;game.logd`----开始重新登录账号-----`e;this.LoginGamedthis.ReLoginGameRet,thise;}this._isConnected=true;returntrue;}publicStartdip:string,port:stringe{this.ip=ip;this.port=port;this.Initde;}publicConnectServerdip:string,port:string,cb:Function,thisObj:anye{letuniqueID=game.GlobalEvent.SubscribedGlobalEventType.ConnectResult,dret:numbere=b{game.GlobalEvent.UnSubscribeByIDdGlobalEventType.ConnectResult,uniqueIDe;ifdcb!=nullecb.calldthisObj,rete;},thise;this.isLogined=false;ClientNet.SocketManager.GetInstancede.ConnectServerdip,porte;}privateReConnectServerRetdret:numbere{this.isConnecting=false;this.isLogining=false;this.isLogined=false;ifdret==1e{game.logd`----重连服务器成功----`e;}else{game.logd`----重连服务器失败-继续重连---`e;}}publicLoginGamedcb:Function,thisObj:anye{letuniqueID=game.GlobalEvent.SubscribedGlobalEventType.CheckLoginResult,drete=b{game.GlobalEvent.UnSubscribeByIDdGlobalEventType.CheckLoginResult,uniqueIDe;ifdret==1e{game.logd"-------登录成功---bbbbbbbbbbbbbbbbbbbbb"e;}else{game.logd"-------登录失败---bbbbbbbbbbbbbbbbbbbbb"e;}ifdcb!=nullecb.calldthisObj,rete;},thise;NodeJS.NetServer.C2SLoginde;}privateReLoginGameRetdret:numbere{this.isLogining=false;ifdret==1e{this.isLogined=true;game.logd"重登录账号成功..."e;}else{this.isLogined=false;game.logd`----重登录账号失败-继续重登录---`e;}}publicBeginCalcudcmdDataBA:egret.ByteArray,pool:anye{letintervalObj=null;newPromiseddresolve,rejecte=b{intervalObj=setIntervaldde=b{clearIntervaldintervalObje;intervalObj=null;resolvede;},1e;}e.thenddreplayData:anye=b{game.logd"-------ServeMain.BeginCalcu-------"e;returnpool.rundde=bd{cmd:"",frame:12,cmdData:cmdDataBA.bytes}ee;}e.thenddresult:anye=b{NodeJS.NetServer.C2SCalResultdresult.roomId,result.winId,result.winType,result.killse}e.catchdderre=b{letcmd=Protocol.FightReconnectRoom_Respond.decodedcmdDataBA.bytese;game.logd"BeginCalcuerror:",cmd.info.roomId,erre;NodeJS.NetServer.C2SCalResultdcmd.info.roomId,[],3,[]e}e;}}}﻿cccareferencepath="..cTestcClientLogiccRendercWarNumber.ts"cbmoduleNodeJS{exportclassServerThread{privatestaticinstance:ServerThread;publicstaticGetInstancede:ServerThread{ifdServerThread.instance==nulleServerThread.instance=newServerThreadde;returnServerThread.instance;}publicuniqueID:number;publicconstructorde{this.uniqueID=Math.floordMath.randomde*1000e;}publicDownloadReplayData2dfileName:stringe{returnnewPromiseddresolve,rejecte=b{game.NetUtil.DownloadFromPHPd"hszzcreplayc"+fileName,dret:boolean,data:anye=b{ifd!rete{game.errord"downloadreplayerror1:",fileNamee;rejectd"downloadreplayerror1:"+fileNamee;}resolveddatae;},thise;}e;}publicBeginReplayde{GameData.DeviceType=DeviceType.LinuxServer;ECS.ReplayManager.GetInstancede.DownloadReplayDatadGameData.ReplayFileName,this.BeginWar,thise;}publicBeginWarddataDict:anye{letcmd=ECS.ReplayManager.GetInstancede.LoadReplyDataByJsonddataDicte;ECS.ReplayManager.GetInstancede.ServerDoReplaydcmde;}publicBeginCalcudbytes:Uint8Arraye:any{game.logd"---ServerThrad.BeginCalcu---bbbbbbbbbbbbb",egret.getTimerdee;letcmd=Protocol.FightReconnectRoom_Respond.decodedbytese;returnECS.ReplayManager.GetInstancede.ServerDoReplaydcmde;}}}c***平台数据接口。*由于每款游戏通常需要发布到多个平台上，所以提取出一个统一的接口用于开发者获取平台数据信息*推荐开发者通过这种方式封装平台逻辑，以保证整体结构的稳定*由于不同平台的接口形式各有不同，白鹭推荐开发者将所有接口封装为基于Promise的异步形式*cdeclareinterfacePlatform{getUserInfode:Promiseaanyb;loginde:Promiseaanyb}classDebugPlatformimplementsPlatform{asyncgetUserInfode{return{nickName:"username"}}asyncloginde{}}ifd!window.platforme{window.platform=newDebugPlatformde;}declareletplatform:Platform;declareinterfaceWindow{platform:Platform}c***常量定义*cenumPanelTypeConst{WarUI=11,WarOver=12,TestWar=21,Login=22,MainUINew=31,RightDZ=32,RunScript=33,RightSS=34,RightRW=35,RightTF=36,RightDZRecommend=37,EditorUI=40,CommonDlg=1000,SelectServer=1001,CMDDlg=1002,FriendInfo=1003,FriendInvited=1004,ShopInfo=1010,ZXBXDetail=1011,ShopBuyWin=1012,RankMainPanel=1013,RankPlayerInfoMainPanel=1014,ShopKaPaiPanel=1015,ShopBuyKaPaiWin=1016,RankHeroInfoPanel=1017,UILoading=1018,ReplayInfo=1019,SettingsInfo=1020,CommonTextInfo=1021,SelectLan=1022,AchieveDescTips=1023,AchieveFullTips=1024,AchieveInfo=1025,AchieveTaskInfo=1027,AchieveGradeInfo=1028,MailDetailInfo=1029,MailInfo=1030,PWSInfo=1031,BoxTips=1100,Bag=2000,Hero=3000,HeroUpgrade=30001,PlayerInfoMainPanel=4003,FamilyMainPanel=4004,FamilyApplyPanel=4005,FamilyChangeKaPanel=4006,FamilyShopBuyPanel1=4007,FamilyShopBuyPanel3=4009,FamilyNoneMainPanel=4010,FamilyInfoPanel=4011,FamilySettingPanel=4012,TeamPanel=5000,HeroInfoWin1=5001,HeroMainPanel=5002,LeaderInfoPanel=5003,HeroInfoPanel=5004,KakuMainPanel=5005,RoleMainPanel=5007,RoleEditNameWin=5008,ShopQuickBuyWin=5009,cc----这一行代码不要删除--------------------Home=101,War=102,}enumGroupResType{Common=10000,Home=10001,War=10002,FightHero=10003,}enumPanelMessageType{OnShow=1,OnHide=2,OnDestroy=3,OnConnectSucess=13,OnUpdateData=14,}enumSceneTypeConst{None=0,Home=1,War=2,CommonUI=3,}enumGlobalEventType{ConnectResult=1,LoginResult=3,FightLoginResult=4,FightReConnectResult=5,CheckLoginResult=6,MainCenterOnCreated=11,ShowMainTips=12,SyncMessage=50,FrameCallbackEvent=60,cc帧回调事件DoSkillRender=100,StopSkillRender=101,AddSkillVit=102,StopWait=103,ForceSyncRenderPos=104,cc强制同步渲染层目标BlowFlyRender=105,cc击飞渲染目标PauseSkillRender=106,cc暂停技能SendLogicCMD=107,cc逻辑层指令DoSpellRender=108,cc法术FaceToTarget=109,cc面向目标InputAddHero=201,ccui拖动英雄到战场InputAddSpell=202,ccui释放法术InputHeroSkill=203,ccui释放英雄技能AddFrameEndAction=221,WarUILocked=261,WarUIHeroDie=262,ClientReadyAddHero=301,cc服务器同意释放英雄ClientReadyAddSpell=302,cc客户端同意释放法术ServerReadyAddHero=303,cc服务器同意释放英雄ServerReadyAddSpell=304,cc服务器同意释放法术LogicHeroEnterWar=310,cc逻辑层英雄进入战场CreateRenderEntity=320,cc创建可渲染实体JumpFrameOver=401,ServerShowPanel=411,ServerBeginCalcu=412,ChangeLanguage=501,FriendLeftItemClicked=1001,familyCreate=2002,joinApplySuccess=2009,familyAskChangeItem=2011,familyShopBuy=2011,TeamHideLeaderWin=3011,TeamChangeSelLeader=3012,TeamChuZhan=3013,ChangeLeader=3014,InitLeaderView=3015,SWapHero=3016,ChangeTeamIndex=3017,HideAttrTips=3018,ShowAttrTips=3019,RankAddItem=3020,ShowRank=3021,ShopBuyItem=3022,C2SMessage=601,S2CMessage=602,}enumLoginType{LoginIn=1,LoginOut=2,}classColorMatrixType{publicstaticGrey:Arrayaanyb=[0.3,0.6,0,0,0,0.3,0.6,0,0,0,0.3,0.6,0,0,0,0,0,0,1,0];publicstaticRed:Arrayaanyb=[1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0];}enumHttpConst{WriteRecord=1,WriteReplay=2,WriteFile=3,ReadFile=4,WriteLog=5,HeartBeat=100}enumUploadLogLevel{Exception=0,Error=1,Warn=2,Log=3}enumSocketConnectType{ConnectFail=1,Connecting=2,ConnectSuccess=3}enumDeviceType{Html5Client=0,cc真实客户端LinuxServer=1,cc服务器SimulateClient=2,cc模拟客户端}enumDevelopMode{Publish=1,cc发布版Develop=2,cc审核版Debug=10cc调试版}enumDeviceOS{IOS=1,Android=2,WindowsPC=3,MacOS=4,Unknow=5}enumOnLineState{OnLine=1,OffLine=2}cc记录各周期有多少秒enumTimeSecond{Second=1,Minute=60,Hour=60*60,Day=60*60*24}enumDataType{Int=1,String=2}enumEffectMoveType{FixedSpeedToTarget=11,cc固定速度飞向角色目标d跟随目标eFixedTimeToTarget=12,cc固定时间飞向角色目标d跟随目标eFixedSpeedToPos=21,cc固定速度飞向位置d不跟随目标eFixedTimeToPos=22cc固定时间飞向位置d不跟随目标e}classMagicSign{publicstaticAtt:string="Att";publicstaticVit:string="Vit";publicstaticOneVit:string="OneVit";publicstaticAll:string="All";publicstaticStartPos:string="StartPos";publicstaticEndPos:string="EndPos";}cc----------------------------------------------------------------------shopc***商店类型*cenumShopType{ZXBX=11,cc尊享宝箱JXKP=12,cc精选卡牌GXZB=13,cc个性装扮ZXCL=14,cc珍稀材料Diamond=15,cc钻石Gold=16,cc金币FamilyZBG=31cc家族珍宝阁}c***商品类型*cenumShopGoodsType{RES=1,cc各种货币HERO=2,cc英雄和领主BOX=3,cc宝箱}c***商品购买所要消耗的物品类型（支付方式）*cenumShopCostType{RMB=0,GOLD=2,DIMAND=3,FAMILY_SCORE=8,cc家族积分}c***限购类型*cenumShopLimitBuyType{MEI_RI=1,cc每日限购ZONG_LIANG=2,cc总量限购SHI_JIAN_DUAN_MEI_RI=3,cc时间段每日限购SHI_JIAN_DUAN_ZONG_LIANG=4,cc时间段总量限购NONE=5cc不限购}c***商品状态*cenumShopGoodsState{FREE=1,cc免费HAS_BUY=2,cc已购买CAN_BUY=3cc可购买}cc-------enumRecordType{ONE_V_ONE=1,LIAN_MENG=2,FAMILY=3}enumFamilyListType{Recommend=1,Search=2}enumFamilyJob{Leader=1,SecondHand=2,Member=3,}﻿cccareferencepath="..c..cutilscLanUtil.ts"cbmoduleConst{exportvarErrorCode:any={1:LanUtil.GetTextd"金币不足"e,2:LanUtil.GetTextd"物品不足"e,3:LanUtil.GetTextd"配置表找不到该技能"e,4:LanUtil.GetTextd"英雄没有该技能"e,5:LanUtil.GetTextd"找不到英雄"e,100:LanUtil.GetTextd"您的好友人数已达上限！"e,101:LanUtil.GetTextd"对方的好友已满，添加失败！"e,102:LanUtil.GetTextd"该玩家已下线，邀请失败！"e};exportclassButtonImg{staticRED="common_ui_common_json.button_ty_red";cc红色按钮staticGREEN="common_ui_common_json.button_ty_green";cc绿色按钮staticBLUE="common_ui_common_json.button_ty_blue";cc蓝色staticYELLOW="common_ui_common_json.button_ty_yellow";cc蓝色}exportclassCampName{staticCAMP_0=LanUtil.GetTextd"中立"e;staticCAMP_1=LanUtil.GetTextd"东方"e;staticCAMP_2=LanUtil.GetTextd"巨龙城"e;staticCAMP_3=LanUtil.GetTextd"海洋"e;}exportclassQualityName{staticQ0=LanUtil.GetTextd"普通"e;staticQ1=LanUtil.GetTextd"稀有"e;staticQ2=LanUtil.GetTextd"珍贵"e;staticQ3=LanUtil.GetTextd"传奇"e;}exportclassRankInfoType{staticPLAYER:number=1;staticFAMILY:number=2;staticFIGHT:number=3;staticPWS_FIGHT:number=10;cc排位赛staticZBS_FIGHT:number=11;cc争霸赛staticTZS_FIGHT:number=11;cc挑战赛}exportclassRankType{staticGLOBAL:number=1;staticLOCAL:number=2;staticPRE_GLOBAL:number=3;cc上届全球staticPRE_LOCAL:number=4;cc上届本地}exportclassQualityColor{staticQ0=0x8a819b;staticQ1=0x327fb0;staticQ2=0xcc8536;staticQ3=0xb741cc;}exportclassRewardType{staticTaskReward=10;cc任务积分奖励staticGameReward=11;cc赛事奖励staticWarWinReward=12;cc对战胜利奖励staticWarFailReward=13;cc对战失败奖励staticPWSFreeReward=14;cc排位赛免费奖励staticPWSVipReward=15;cc排位赛VIP奖励staticZBSReward=20;cc争霸赛奖励staticTZSReward=21;cc挑战赛奖励}exportclassTaskType{staticNormalTask=10000;cc普通任务staticAchieveTask=11000;cc成就任务staticPWSTask=12000;cc排位赛任务}exportclassDirection{staticLEFT_TOP:number=1;staticLEFT_CENTER:number=2;staticLEFT_BOTTOM:number=3;staticRIGHT_TOP:number=4;staticRIGHT_CENTER:number=5;staticRIGHT_BOTTOM:number=6;staticCENTER_TOP:number=7;staticCENTER_CENTER:number=8;staticCENTER_BOTTOM:number=9;staticLEFT:number=10;staticTOP:number=11;staticRIGHT:number=12;staticBOTTOM:number=13;staticMIDDLE:number=14;}exportvarMaxGradeLv:number=30;cc成就最高等级}﻿c***场景管理类*bydily*dcecopyright2014-2035*AllRightsReserved.*所有的弹窗都需要在register注册事件*在execute添加消息处理面板打开关闭事件*cmodulegame{exportclassHomeCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用ccTODONIU这里可以引用默认主城地图资源protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameSceneLayer.gameLayerde.mapLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnHomePanel;}cc做一下类型转换方便调用一定要有!!!protectedgethomePanelde{returnaHomePanelbthis.panel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,falsee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld0e;}}protectedDestroyde{}}}﻿c***主城*cmodulegame{exportclassHomePanelextendsUIComponentBase{publicconstructorde{superd"HomeMapSkin"e;}protectedDestroyde{}}}﻿c***场景管理类*bydily*dcecopyright2014-2035*AllRightsReserved.*所有的弹窗都需要在register注册事件*在execute添加消息处理面板打开关闭事件*cmodulegame{exportclassWarCextendsUICtrlBase{ccpublicstaticwarPanel:WarPanel;publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用ccTODONIU这里可以引用进场的武将和选择的地图资源protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameSceneLayer.gameLayerde.objectLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnWarPanel;}cc做一下类型转换方便调用一定要有!!!protectedgetwarPanelde{returnaWarPanelbthis.panel;}privategetscalede:number{returnthis.GetParentde.scaleX;}privatesetscaledvalue:numbere{letparent=this.GetParentde;parent.scaleX=parent.scaleY=value;letpanel=this.warPanel;panel.bg1.scaleX=panel.bg1.scaleY=1cvalue;panel.bg2.scaleY=1cvalue;panel.bg2.scaleX=-1cvalue;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,falsee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld0e;}elseifditype==PanelMessageType.OnUpdateDatae{ifddata[0]==100e{letpanel=this.warPanel;TweenLite.todpanel.map_bg,0.5,{width:1536,height:864,ease:Power2.easeIn}e.kill;letparent=this.GetParentde;ccparent.scaleX=parent.scaleY=0.83333333;this.scale=0.83333333;TweenLite.delayedCalldWarData.EnterAni_MapStartTime,de=b{TweenLite.todthis,WarData.EnterAni_MapMoveTime,{scale:1,ease:Power2.easeIn}e.kill;}e;}ifddata[0]==200e{ccletpanel=this.warPanel;ccTweenLite.todpanel.map_bg,0.5,{width:1280,height:720,ease:Power2.easeIn}e.kill;letparent=this.GetParentde;this.scale=1;TweenLite.delayedCalldWarData.EnterAni_MapStartTime,de=b{TweenLite.todthis,WarData.EnterAni_MapMoveTime,{scale:0.83333333,ease:Power2.easeIn}e.kill;}e;}}}c***初始化面板ui*cpublicInitUIde:void{letpanel=this.warPanel;panel.parent.setChildIndexdpanel,0e;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;letmapID=warComp.mapID;letmapName=`map_${mapID}_jpg`;ifd!RES.hasResdmapNameee{mapID=1001;mapName=`map_${mapID}_jpg`;}panel.map_bg.source=RES.getResdmapNamee;panel.map_bg.width=1536;ccGameData.Width;panel.map_bg.height=864;ccGameData.Height;ccletparent=this.GetParentde;ccparent.scaleX=parent.scaleY=0.83333333;this.scale=0.8333333;ccgame.logdmapName,"_____________OnMessage____________",mapID,"____________",panel.map_bg.sourcee;}protectedDestroyde{}}}﻿c***战场*cmodulegame{exportclassWarPanelextendsUIComponentBase{publicmap_bg:eui.Image;publicbg1:eui.Image;publicbg2:eui.Image;publicconstructorde{superd"WarMapSkin"e;}protectedDestroyde{}}}﻿c***bgm禁止，则正在播放的音乐应该停止。*bgm重新开启，则播放上次音乐。*cclassSoundManager{privateeffVolume:number;privatebgVolume:number;publiccurrBgName:string;publicshowBg:boolean;publicshowEff:boolean;privatebgSoundChannel:egret.SoundChannel;privatebgSound:egret.Soundpublicconstructorde{this.Initde;}publicInitde{this.showBg=true;this.showEff=true;this.bgVolume=1;this.effVolume=1;}publicDestroyde{this.bgSound=null;this.currBgName=null;this.bgSoundChannel=null;}publicPlayEffectdsound:stringe{ifdthis.showEff==falseereturnvarnewEffSound=RES.getResdsoundeasegret.Sound;ifdnewEffSound==nullereturn;newEffSound.type=egret.Sound.EFFECT;varchannel=newEffSound.playd0,1e;channel.volume=this.effVolume;}publicPlayBgSounddsound:string,loop:number=0e{ifdthis.showBg==falseereturnifdthis.bgSoundChannel!=nullethis.bgSoundChannel.stopde;this.bgSound=RES.getResdsoundeasegret.Sound;ifdthis.bgSound==nullereturn;this.bgSound.type=egret.Sound.MUSIC;try{this.bgSoundChannel=this.bgSound.playd0,loope;this.bgSoundChannel.volume=this.bgVolume;this.currBgName=sound;}catchderrore{game.errord"播放音乐失败:",errore;}}publicStopBgSoundde{ifdthis.bgSoundChannel!=nullethis.bgSoundChannel.stopde;}ccvolume:0~1publicSetBgVolumedvolume:numbere{this.bgVolume=Math.mindvolume,1e;ifdthis.bgSoundChannel!=nullethis.bgSoundChannel.volume=volume;}ccvolume:0~1publicSetEffVolumedvolume:numbere{this.effVolume=Math.mindvolume,1e;}cc音乐开关publicIsPlayBgdplay:booleane{ifdthis.showBg==playereturn;this.showBg=play;ifdthis.bgSoundChannel!=nulle{ifdplay==falseethis.bgSoundChannel.stopde;elsethis.bgSound.playde;}}cc音效开关publicIsPlayEffdplay:booleane{ifdthis.showEff==playereturn;this.showEff=play;}cc----------------------------------------------------------------------单例privatestaticInstance:SoundManager;publicstaticInsde{ifdSoundManager.Instance==nulleSoundManager.Instance=newSoundManagerde;returnSoundManager.Instance;}}﻿moduleECSC{exportclassDrawComponentextendsRenderComponent{publicshapeID:number;publicargs:any;publicgameObject:any;publicclassType:number;privatebShouldCreateObject:boolean;cc标记是否应该创建渲染对象publicconstructorde{superde;this.bShouldCreateObject=false;}publicInitGameObjectdgameObject:anye{this.gameObject=gameObject;ECSC.RenderWarUtil.GetRenderHeroManagerde.AddRenderObjectdthis.id,this.gameObjecte;}publicUpdateGameObjectdecc检查渲染对象是否应该被创建{ifd!this.bShouldCreateObjectereturn;ifdthis.gameObject!=nullereturn;this._createGameObjectde;}publicCreateGameObjectde:any{this.bShouldCreateObject=true;this._createGameObjectde;}private_createGameObjectde:any{ifd!WarData.ShowRender||GameData.DeviceType!=DeviceType.Html5Clientereturnnull;lettrans=aTransformComponentbthis.entity.GetCompdRenderComponentType.TransformComponente;letheroData=aHeroDataComponentbthis.entity.GetCompdRenderComponentType.HeroDataComponente;letgameObject=ECS.WarFactory.CreateObjectdthis.classType,this.shapeID,[this.args]e;gameObject.id=this.id;gameObject.name=this.id.toStringde;ifdheroData!=nulle{gameObject.campType=heroData.campType;gameObject.atkType=heroData.atkType;}gameObject.Initde;gameObject.SetPosdtrans.pos.x,trans.pos.ye;ifdheroData!=nulle{gameObject.SetHPdheroData.hp,heroData.hpmaxe;gameObject.SetLvdheroData.lve;ifdheroData.atkType==AtkType.AttackegameObject.SetAniAngled90e;elsegameObject.SetAniAngled270e;gameObject.SetAnimStatedAnimState.Idle,-1,heroData.campTypee;}letparent=this.world.renderHeroManager.GetHerodtrans.parentIDe;lethasParent=false;ifdparent!=nulle{letparentRC=aDrawComponentbparent.GetCompdRenderComponentType.DrawComponente;ifdparentRC!=null&&parentRC.gameObject!=nulle{ccifdSettings.logeccgame.logd"CreateObjectgameObject:　　",gameObjecte;parentRC.gameObject.addChilddgameObjecte;hasParent=true;}}ifd!hasParente{game.warnd"youshouldcreateparentDrawComponentFirst!!!",trans.parentIDe;}this.InitGameObjectdgameObjecte;returngameObject;}publicGetDatade:any{}publicDisposede{this.DisposeRenderde;}publicDisposeRenderde{ifdthis.gameObject!=nulle{letrenderHeroManager=ECSC.RenderWarUtil.GetRenderHeroManagerde;ifdrenderHeroManager!=nullerenderHeroManager.RemoveRenderObjectdthis.ide;ifdthis.shapeID!=0eECS.WarFactory.DestroyObjectdthis.gameObject,this.classType,this.shapeIDe;this.gameObject=null;}}cc判断是否可以删除publicCanDisposede{returntrue;}}}﻿cccareferencepath="..c..cServerLogiccECScLogicComponent.ts"cbmoduleECS{exportclassDrawComponentextendsLogicComponent{publicshapeID:number;publicargs:any;publicgameObject:any;publicclassType:number;privatebShouldCreateObject:boolean;cc标记是否应该创建渲染对象publicconstructorde{superde;this.bShouldCreateObject=false;}publicInitGameObjectdgameObject:anye{this.gameObject=gameObject;ECSC.RenderWarUtil.GetRenderHeroManagerde.AddRenderObjectdthis.id,this.gameObjecte;}publicUpdateGameObjectdecc检查渲染对象是否应该被创建{ifd!this.bShouldCreateObjectereturn;ifdthis.gameObject!=nullereturn;this._createGameObjectde;}publicCreateGameObjectde:any{this.bShouldCreateObject=true;this._createGameObjectde;}private_createGameObjectde:any{ifd!WarData.ShowRender||GameData.DeviceType!=DeviceType.Html5Clientereturnnull;lettrans=aTransformComponentbthis.entity.GetCompdRenderComponentType.TransformComponente;letheroData=aHeroDataComponentbthis.entity.GetCompdRenderComponentType.HeroDataComponente;letgameObject=WarFactory.CreateObjectdthis.classType,this.shapeID,[this.args]e;gameObject.id=this.id;gameObject.name=this.id.toStringde;ifdheroData!=nulle{gameObject.campType=heroData.campType;gameObject.atkType=heroData.atkType;}gameObject.Initde;gameObject.SetPosdtrans.pos.x,trans.pos.ye;ifdheroData!=nulle{gameObject.SetHPdheroData.hp,heroData.hpmaxe;gameObject.SetLvdheroData.lve;ifdheroData.atkType==AtkType.AttackegameObject.SetAniAngled90e;elsegameObject.SetAniAngled270e;gameObject.SetAnimStatedAnimState.Idle,-1,heroData.campTypee;}letparent=this.world.logicHeroManager.GetHerodtrans.parentIDe;lethasParent=false;ifdparent!=nulle{letparentRC=aDrawComponentbparent.GetCompdRenderComponentType.DrawComponente;ifdparentRC!=null&&parentRC.gameObject!=nulle{ccifdSettings.logeccgame.logd"CreateObjectgameObject:　　",gameObjecte;parentRC.gameObject.addChilddgameObjecte;hasParent=true;}}ifd!hasParente{game.warnd"youshouldcreateparentDrawComponentFirst!!!",trans.parentIDe;}this.InitGameObjectdgameObjecte;returngameObject;}publicGetDatade:any{}publicDisposede{this.DisposeRenderde;}publicDisposeRenderde{ifdthis.gameObject!=nulle{ECSC.RenderWarUtil.GetRenderHeroManagerde.RemoveRenderObjectdthis.ide;ifdthis.shapeID!=0eWarFactory.DestroyObjectdthis.gameObject,this.classType,this.shapeIDe;this.gameObject=null;}}cc判断是否可以删除publicCanDisposede{returntrue;}}}moduleECSC{exportclassHeroDataComponentextendsRenderComponent{cc临时存储到目标的距离publictoTargetDis:number;publicname:string;publicshape:number;cc英雄造型publicdelayFrame:number;cc血量publichpmax:number;publichp:number;publiccallHeroType:number=0;cc召唤类英雄类型d空中召唤地面召唤等等epubliclv:number;cc等级publicshieldmax:number=0;cc护盾最大值publicshield:number=0;cc护盾publiclandType:number;cc陆空类型publicheroType:number;cc英雄类型publicputType:number;cc放置类型publiccampType:number;publicatkType:number;publicdeployTime:number;cc部署时间publicconstructorde{superde;}publicInitde{super.Initde;}cc检测目标合法性ccsrcData来源目标d谁找我epublicIsTargetValiddsrcData:HeroDataComponente:boolean{ifdthis.hpa=0ereturnfalse;ifdsrcData==nullereturntrue;returntrue;}}}moduleECSC{exportclassRealPlayerComponentextendsRenderComponent{publicplayerData:PreWarItemData;publicposType:number;cc11攻击1号位12攻击2号位21防守1号位22防守2号位publicisRobot:boolean;publickingTowerID:number;publicqueenTowerID:number;publiccampType:number;cc阵营信息publicatkType:number;publicsceneID:number;cc实时刷新变量开始publicmaxEnergy:number;publicnowEnergy:number;publicnextHeroShape:number;publicindex2HeroIconMap:SMapanumber,ECS.HeroIconDatab;cc仅限rendercccccccccccccc实时刷新变量结束privateheroDataMap:SMapanumber,game.CardDataItemb;publicconstructorde{superde;}publicInitde{super.Initde;this.heroDataMap=newSMapanumber,game.CardDataItembde;this.nextHeroShape=null;this.index2HeroIconMap=newSMapanumber,ECS.HeroIconDatabde;this.nowEnergy=ECS.WarSettings.InitHeroEnergy;this.maxEnergy=ECS.WarSettings.InitMaxHeroEnergy;letwarComp=aWarComponentbthis.world.GetSingletonCompdRenderComponentType.WarComponente;this.sceneID=warComp.sceneID;this.AddPropCBd"heroIconData",de=b{letheroIconData=this["heroIconData"];fordleti=0;iaMathConst.MaxIconCount*4;i+=4e{letindex=heroIconData[i];letshape=heroIconData[i+1];letnowState=heroIconData[i+2];letuniqueId=heroIconData[i+3];ifdindex==nullebreak;ifd!this.index2HeroIconMap.hasdindexee{this.index2HeroIconMap.setdindex,newECS.HeroIconDatadthis.world,0ee;}letobj=this.index2HeroIconMap.getdindexe;obj.iconType=1;obj.shape=shape;obj.nowState=nowState;obj.uniqueId=uniqueId;}},thise;}privatecmdID:number=0;publicGetCmdIDde:number{this.cmdID++;returnthis.cmdID;}publicInitPlayerDatadplayerData:PreWarItemDatae{this.DisposeHerode;letwarComp=aWarComponentbthis.world.GetSingletonCompdRenderComponentType.WarComponente;this.playerData=playerData;this.isRobot=playerData.isRobot;ccgame.logd"-------InitPlayerDataInitPlayerData----bbbbbbbbbbbbbbbbbb",this.id,data.pos,warComp.myAtkTypee;this.posType=playerData.posType;this.atkType=playerData.atkType;ifdthis.atkType==warComp.myAtkTypeethis.campType=CampType.Friend;elsethis.campType=CampType.Enemy;cc兵种和防御塔fordletheroDataofplayerData.teamInfoe{letheroObj=this.AddHeroObjdheroData.id,heroData.lve;heroObj.goldLevel=heroData.goldLv;ccfordletskillDataofheroData.skillsecc{ccheroObj.AddSkilldskillData.id,skillData.lve;cc}}this.kingTowerID=playerData.kingTowerID;this.queenTowerID=playerData.queenTowerID;}publicAddHeroObjdshape:number,lv:numbere:game.CardDataItem{letcardObj:game.CardDataItem;ifdthis.heroDataMap.hasdshapeee{cardObj=this.heroDataMap.getdshapee;ifdcardObj.lv!=lve{game.errord"AddHeroObjrepeatshapedifflv:",shape,lv,cardObj.lve;}returncardObj;}this.heroDataMap.setdshape,ECS.WarFactory.CreateCardDataItemdshapeee;cardObj=this.heroDataMap.getdshapee;cardObj.id=shape;cardObj.cost=cardObj.cost*ECS.WarSettings.EnergyRatio;cardObj.SetLvdlve;ifd!ECS.LogicWarUtil.IsSpelldshapeee{letheroObj=agame.HeroDataItembcardObj;fordletinfoofheroObj.mainheroe{letsubShape=info[0];this.AddHeroObjdsubShape,lve;}fordletinfoofheroObj.childheroe{letsubShape=info[0];this.AddHeroObjdsubShape,lve;}}returncardObj;}publicGetHeroDatadshape:numbere:game.CardDataItem{letheroObj=this.heroDataMap.getdshapee;returnheroObj;}publicAddOneHeroToScenedid:number,shape:number,lv:number,campType:number,x:number,y:number,parentID:number,delayFrame:numbere:number{this.AddHeroObjdshape,lve;letheroObj=agame.HeroDataItembthis.GetHeroDatadshapee;letworldObj=this.world;letcomps=newSMapanumber,RenderComponentbde;ccHeroDataComponentletcomp:HeroDataComponent=aHeroDataComponentbECS.WarFactory.CreateComponentdRenderComponentType.HeroDataComponent,worldObje;comp.id=id;comp.Initde;comp.shape=heroObj.id;comp.name=heroObj.name;comp.hpmax=heroObj.hp;comp.hp=heroObj.hp;comp.shield=heroObj.shield;comp.shieldmax=heroObj.shield;cccomp.fitAttackTime=heroObj.attackSpeed;cccomp.attackSpeedBase=heroObj.attackSpeed;cccomp.targetID=0;comp.campType=campType;comp.atkType=this.atkType;comp.lv=heroObj.lv;comp.shield=heroObj.shield;comp.shieldmax=heroObj.shield;comp.heroType=heroObj.heroType;comp.landType=heroObj.landType;comp.putType=heroObj.putType;comp.deployTime=heroObj.deployTime;comp.callHeroType=heroObj.callHeroType;cccomp.mass=heroObj.mass;comp.delayFrame=delayFrame;ccifdheroObj.lifeTime==0ecccomp.dieFrame=0;ccelsecccomp.dieFrame=worldObj.frameCount+heroObj.lifeTimecMathConst.KeyFrameTime;cccomp.createdFrame=worldObj.frameCount;comps.setdRenderComponentType.HeroDataComponent,compe;ccTransformComponentletcomp1:TransformComponent=aTransformComponentbECS.WarFactory.CreateComponentdRenderComponentType.TransformComponent,worldObje;comp1.id=id;comp1.Initde;ifdparentID==0ecomp1.parentID=this.sceneID;elsecomp1.parentID=parentID;cccomp1.hasCollide=false;comp1.landType=heroObj.landType;comp1.fitMoveSpeed=heroObj.moveSpeed;comp1.moveSpeed=heroObj.moveSpeed;comp1.scale=heroObj.scale;comp1.range=heroObj.range;ccifdECS.LogicWarUtil.IsKingTowerdheroObj.ideecc{cccccomp1.searchCenterPos=newVector2d[x,y]e;cccccomp1.searchRadius=MathConst.KingSearchRadius;cccomp1.hasCollide=false;cc国王塔无视碰撞cc}comp1.SetTransPosdx,y,truee;comps.setdRenderComponentType.TransformComponent,comp1e;ccSkillStatusComponentletcomp2:SkillStatusComponent=aSkillStatusComponentbECS.WarFactory.CreateComponentdRenderComponentType.SkillStatusComponent,worldObje;comp2.id=id;comp2.Initde;letskData:game.SkillDataItem;fordletskillIDofheroObj.normalSkillIdArraye{letskid=skillID;skData=heroObj.GetSkilldskide;comp2.AddSkillTemplatedskDatae;}fordletskillIDofheroObj.askillIdArraye{letskid=skillID;skData=heroObj.GetSkilldskide;comp2.AddSkillTemplatedskDatae;}fordletskillIDofheroObj.pskillIdArraye{letskid=skillID;skData=heroObj.GetSkilldskide;comp2.AddSkillTemplatedskDatae;}comps.setdRenderComponentType.SkillStatusComponent,comp2e;ccDrawComponentletcomp3:DrawComponent=aDrawComponentbECS.WarFactory.CreateComponentdRenderComponentType.DrawComponent,worldObje;ifdECS.LogicWarUtil.IsQueenTowerdheroObj.idee{comp3.classType=ObjectType.HeroQueue;ifdthis.campType==CampType.Friendecomp3.args=`hero_${heroObj.clipName}`;elsecomp3.args=`hero_${heroObj.clipName+1}`;}else{comp3.classType=ObjectType.HeroBase;comp3.args=`hero_${heroObj.clipName}`;}comp3.shapeID=heroObj.id;comp3.id=id;comp3.Initde;comps.setdRenderComponentType.DrawComponent,comp3e;ccTowerComponentifdRenderWarUtil.IsTowerdheroObj.idee{letcomp4:TowerComponent=aTowerComponentbECS.WarFactory.CreateComponentdRenderComponentType.TowerComponent,worldObje;comps.setdRenderComponentType.TowerComponent,comp4e;}ccccStateComponentccletcomp4:StateComponent=aStateComponentbWarFactory.CreateComponentdRenderComponentType.StateComponent,worldObje;cccomp4.Initde;cccomps.setdRenderComponentType.StateComponent,comp4e;letentity=worldObj.CreateEntitydid,compse;entity.pid=this.id;cc设置英雄属于哪个玩家阵营returnid;}publicGetHeroIconDatadindex:numbere:ECS.HeroIconData{returnthis.index2HeroIconMap.getdindexe;}publicGetMaxEnergyde:number{returnthis.maxEnergy;}cc这个函数只是给界面UI调用要扣除已经虚假使用过的能量publicGetEnergyPrecisede:number{returnthis.nowEnergy}cc这个函数只是给界面UI调用要扣除已经虚假使用过的能量publicGetShowEnergyde:number{returnthis.GetEnergyPrecisedecECS.WarSettings.EnergyRatio;}publicDisposeHerode{letheroDataArray=this.heroDataMap.valuesde;fordletheroDataofheroDataArraye{heroData.Destroyde;}this.heroDataMap.clearde;ifdthis.index2HeroIconMap!=nullethis.index2HeroIconMap.clearde;}publicDisposede{this.DisposeHerode;super.Disposede;}}}moduleECSC{exportclassSkillStatusComponentextendsRenderComponent{publicisLockHeroAI:boolean;publicisUseSkill:boolean;publicatkDis:number;publicwarnDis:number;privatetemplateDict:SMapanumber,ECS.SkillDataTemplateb;privatetemplateArray:ArrayaECS.SkillDataTemplateb;cc被动技能privatepSkillTemplateDict:SMapanumber,ECS.SkillDataTemplateb;publicconstructorde{superde;}publicInitde{super.Initde;this.templateDict=newSMapanumber,ECS.SkillDataTemplatebde;this.templateArray=newArrayaECS.SkillDataTemplatebde;this.pSkillTemplateDict=newSMapanumber,ECS.SkillDataTemplatebde;ccifdthis.id==1019ecc{ccthis.AddPropCBd"isLockHeroAI",de=b{ccgame.logd"--------isLockHeroAI-1019------",this.isLockHeroAI,egret.getTimerdee;cc},thise;ccthis.AddPropCBd"isUseSkill",de=b{ccgame.logd"--------isUseSkill-1019------",this.isUseSkill,egret.getTimerdee;cc},thise;cc}}publicDisposede{super.Disposede;fordletvalueofthis.templateArraye{value.Disposede;}this.templateArray.length=0this.templateDict.clearde;letvalues=this.pSkillTemplateDict.valuesde;fordletvalueofvaluese{value.Disposede;}this.pSkillTemplateDict.clearde;}publicAddSkillTemplatedskData:game.SkillDataItemecc技能模板{ifd!this.templateDict.hasdskData.idee{letdata=newECS.SkillDataTemplatedskData,this.worlde;data.skillType=skData.skillType;ifddata.skillType==SkillType.PassiveSkillethis.pSkillTemplateDict.setdskData.id,datae;else{this.templateDict.setdskData.id,datae;this.templateArray.pushddatae;}}}publicGetTemplateDatadid:numbere:ECS.SkillDataTemplate{ifdthis.templateDict.hasdideereturnthis.templateDict.getdide;returnnull;}publicGetAISkillTemplatede:ECS.SkillDataTemplate{returnthis.templateArray[0];}}}﻿moduleECSC{exportclassSpellComponentextendsRenderComponent{privatetemplateDict:SMapanumber,ECS.SpellDataTemplateb;privatetemplateArray:ArrayaECS.SpellDataTemplateb;publicconstructorde{superde;}publicInitde{super.Initde;this.templateDict=newSMapanumber,ECS.SpellDataTemplatebde;this.templateArray=newArrayaECS.SpellDataTemplatebde;}publicDisposede{fordletvalueofthis.templateArraye{value.Disposede;}this.templateArray.length=0this.templateDict.clearde;super.Disposede;}publicAddSpellTemplatedspellData:game.SpellDataItemecc技能模板{ifdspellData.normalSkillIdArray.length==0ereturn;letskillId=spellData.normalSkillIdArray[0];ifd!this.templateDict.hasdspellData.idee{letskData=spellData.GetSkilldskillIdeletdata=newECS.SpellDataTemplatedspellData,skData,this.worlde;this.templateDict.setdspellData.id,datae;this.templateArray=this.templateDict.valuesde;}}publicGetSkillDataTemplatedspellId:numbere:ECS.SkillDataTemplate{ifd!this.templateDict.hasdspellIdeereturnnull;returnthis.templateDict.getdspellIde.template;}}}moduleECSC{exportclassTowerComponentextendsRenderComponent{cc101112分别为攻方上中下塔cc202122分别为守方上中下塔publictowerPos:number;publicatkType:number;publicshape:number;publicconstructorde{superde;}publicInitde{super.Initde;}}}moduleECSC{exportclassTransformComponentextendsRenderComponent{publicparentID:number;publicnodeX:number;cc列publicnodeY:number;cc行publicpos:Vector2=newVector2de;publictargetPos:Vector2=newVector2de;publicmoveable:boolean;publicscale:number;cc半径publicrange:number;publiclandType:number;publicmoveSpeed:number;publicfitMoveSpeed:number=0;cc匹配人物动作的移动速度d用于加速ecc有了buff加成后的真实移动速度publicrealMoveSpeed:number=0;publicrealMoveDir:Vector2=newVector2de;publicblowFly_Actid:number=0;privatepath:ECS.NodePoint[]=[];publicconstructorde{superde;}publicInitde{super.Initde;this.AddPropCBd"_pos",de=b{letpos=this["_pos"];this.SetTransPosdpos[0],pos[1]e;},thise;this.AddPropCBd"_targetPos",de=b{lettargetPos=this["_targetPos"];this.targetPos.x=targetPos[0];this.targetPos.y=targetPos[1];},thise;this.AddPropCBd"_realMoveDir",de=b{letrealMoveDir=this["_realMoveDir"];this.realMoveDir.x=realMoveDir[0];this.realMoveDir.y=realMoveDir[1];},thise;this.AddPropCBd"_path",de=b{letindexArray=this["_path"];this.path=[];letwarContainer=this.world.warContainer;fordletindexofindexArraye{letnodeX=Math.floordindexc10000e;letnodeY=index%10000;letnode=warContainer.GetNodednodeX,nodeY,this.landType,1e;ifdnode!=nullethis.path.pushdnodee;}},thise;}publicSetTransPosdx:number,y:number,isHero:boolean=falsee{this.pos.x=x;this.pos.y=y;letcellSize=MathConst.MapCellSize;this.nodeX=Math.floordxccellSizee;this.nodeY=Math.floordyccellSizee;}publicGetAnglede:number{letvelocity=Vector2.directiondthis.targetPos,this.pose;returnvelocity.anglede;}publicGetPathde:ECS.NodePoint[]{returnthis.path;}publicIsTargetValiddsrcTrans:TransformComponente:boolean{returntrue;}}}moduleECSC{exportclassWarComponentextendsRenderSingletonComponent{publicuniqueId:number;cc唯一标识本场战斗的idpublicfightIp:string;publicsecrete:string;publicroomId:string;cc用来唯一标识战斗publicuserName:string;cc标记战斗视角publicclassLv:number;cc阶数publicmyFightRoleId:number=0;publicmyAtkType:number;publicpvpType:number=PVPType.VS_2_2;publicmapID:number=0;publicseed:number=0;publicstartTime:number;cc游戏开始时间publicsceneID:number;publicendFrame:number;cc游戏结束publicspeedUpFrame:number;cc加速时期恢复速度X2publicburnFrame:number;cc燃烧阶段防御塔持续掉血privateplayerReadyInfo:SMapanumber,numberb;cc记录英雄资源是否加载完成privateallReadyCB:Function;privateallObj:any;publicdieHeroInfo:SMapanumber,numberb;cc皇家塔的死亡判定privatedieTowerInfo:SMapanumber,number[]b;publicserverWarRetInfo:WarResultInfo;cc服务器发来的战斗结束信息publicplayerIdArray:number[];publiclogicServerTime:number=0;publiclogicFrame:number=0;publicrenderServerTime:number=0;publicrenderFrame:number=0;publiclogicMsgDataArray:any[]=[];cc用来缓存logic发来创建tower的数据publicconstructorde{superde;this.uniqueId=IDManager.NewKeyIDde;ifdGameData.DevelopMode==DevelopMode.Debuge{this.AddPropCBd"logicFrame",de=b{this.renderServerTime=FightServerTime.GetServerTimede;this.renderFrame=this.world.frameCount;},thise;}}publicInitde{this.dieTowerInfo=newSMapanumber,number[]bde;this.dieHeroInfo=newSMapanumber,numberbde;this.playerReadyInfo=newSMapanumber,numberbde;this.playerIdArray=[];super.Initde;}cc判断是否可以删除publicCanDisposede{returntrue;}publicDisposede{this.endFrame=0;this.speedUpFrame=0;this.burnFrame=0;ifdthis.dieHeroInfo!=nulle{this.dieHeroInfo.clearde;this.dieHeroInfo=null;}ifdthis.dieTowerInfo!=nulle{this.dieTowerInfo.clearde;this.dieTowerInfo=null;}ifdthis.playerReadyInfo!=nulle{this.playerReadyInfo.clearde;this.playerReadyInfo=null;}this.allReadyCB=null;this.allObj=null;super.Disposede;}publicIsEndTimede:boolean{returnthis.world.frameCountb=this.endFrame;}publicIsSpeedUpTimede:booleancc加速阶段{returnthis.world.frameCountb=this.speedUpFrame;}publicIsBurnTimede:booleancc燃烧阶段每三帧掉血一次d超过燃烧时间并且帧数为3的整倍数e{letframeCount=this.world.frameCount;ifdframeCountb=this.burnFrame&&frameCount%3==0ereturntrue;returnfalse;}publicIsReversePosde:boolean{ccreturnfalse;ccreturntrue;returnthis.myAtkType==AtkType.Defend&&!GameData.EditorMode;}cc战前开始ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicGetAllPlayerDatade:SMapanumber,PreWarItemDatab{letplayerList=this.GetPlayerListde;letallPlayerDict:SMapanumber,PreWarItemDatab=newSMapanumber,PreWarItemDatabde;fordletentityofplayerListe{letplayerComp:RealPlayerComponent=aRealPlayerComponentbentity.GetCompdRenderComponentType.RealPlayerComponente;allPlayerDict.setdplayerComp.id,playerComp.playerDatae;}returnallPlayerDict}publicGetPlayerByAtkTypedatkType:numbere:PreWarItemData[]{letrets:PreWarItemData[]=[];letplayerList=this.GetPlayerListde;fordletentityofplayerListe{letplayerComp:RealPlayerComponent=aRealPlayerComponentbentity.GetCompdRenderComponentType.RealPlayerComponente;ifdMath.floordplayerComp.posTypec10e==atkTypeerets.pushdplayerComp.playerDatae;}returnrets;}publicIsPlayerReadydpid:numbere:boolean{returnthis.playerReadyInfo.hasdpide;}publicIsAllReadyde:boolean{ifdthis.pvpType==PVPType.VS_1_1ereturnthis.playerReadyInfo.sizeb=2;elseifdthis.pvpType==PVPType.VS_2_2ereturnthis.playerReadyInfo.sizeb=4;elsereturnfalse;}publicSetAllReadyCBdfunc:Function,thisObj:anye{this.allReadyCB=func;this.allObj=thisObj;}publicSetPlayerReadydfightRoleId:numbere{this.playerReadyInfo.setdfightRoleId,fightRoleIde;game.logd"fightRoleId:",fightRoleId,"ready!!!","readyCount:",this.playerReadyInfo.sizee;ifdthis.IsAllReadyde&&this.allReadyCBe{this.allReadyCB.calldthis.allObje;this.allReadyCB=null;this.allObj=null;}}cc拿到还未加载加成的资源组publicGetUnloadGroupsde:IAutoGroupResData[]{letresDataMap:SMapastring,IAutoGroupResDatab=newSMapastring,IAutoGroupResDatabde;letfileDataMap:SMapastring,numberb=newSMapastring,numberbde;letmapResData:IAutoGroupResData={groupName:`map_${this.mapID}`,resArray:[]};ifdRES.hasResd`map_${this.mapID}_jpg`ee{mapResData.resArray.pushd`map_${this.mapID}_jpg`e;}else{mapResData.resArray.pushd`map_1001_jpg`e;}resDataMap.setdmapResData.groupName,mapResDatae;letheroIDSet:Setanumberb=newSetanumberbde;letallPlayerDict=this.GetAllPlayerDatade;letkeys=allPlayerDict.keysde;fordletpidofkeyse{letplayerData=allPlayerDict.getdpide;letteamInfo=playerData.teamInfo;fordletheroDataofteamInfoe{game.RenderUtils.GetHeroGroupsdresDataMap,fileDataMap,heroIDSet,heroData.ide;ccthis.AddHeroGroupsdresDataMap,heroIDSet,heroData.ide;}}heroIDSet.clearde;letretArray=resDataMap.valuesde;resDataMap.clearde;fileDataMap.clearde;returnretArray;}publicCreateScenedsceneID:numbere{letworldObj=this.world;letcontainerObj=worldObj.warContainer;containerObj.InitdMathConst.GridCountX,MathConst.GridCountY,MathConst.MapCellSizee;cc初始化场景letcomps=newSMapanumber,RenderComponentbde;letrc=newDrawComponentde;rc.gameObject=containerObj.mapObj;rc.classType=0;rc.shapeID=0;comps.setdRenderComponentType.DrawComponent,rce;letentity=worldObj.CreateEntitydsceneID,compse;entity.name=LanUtil.GetTextd"根节点"e;worldObj.renderHeroManager.AddHerodentity.id,entitye;this.sceneID=sceneID;}cc获取到所有的玩家publicGetPlayerListde:RenderEntity[]{letentityArray:RenderEntity[]=[];fordletplayerIdofthis.playerIdArraye{letentity=this.world.GetEntitydplayerIde;entityArray.pushdentitye;}returnentityArray;}publicCreateAllPlayerdplayerDataArray:PreWarItemData[],isOtherReady:booleane{letinfos=playerDataArray;cc创建我和其他玩家（2V2的情况下可能会有三个其他玩家）this.playerIdArray=[];fordletplayerDataofinfose{this.CreatePlayerdplayerDatae;this.playerIdArray.pushdplayerData.fightRoleIde;ifdplayerData.isRobot||isOtherReadyethis.SetPlayerReadydplayerData.fightRoleIde;}cc创建玩家后检查是否有缓存的需要创建在玩家身上的英雄letarray=this.logicMsgDataArray;this.logicMsgDataArray=[];fordletmsgDataofarraye{CNetWar.OnMessagedmsgDatae;}this.CreateTowerde;}publicCreateTowerde{ccletplayerArray=this.GetPlayerListde;ccfordletentityofplayerArrayecc{ccletcomp=aRealPlayerComponentbentity.GetCompdRenderComponentType.RealPlayerComponente;cccomp.InitTowerde;cc}}cc创建玩家玩家ID由服务器指定publicCreatePlayerdplayerData:PreWarItemDatae{letworldObj=this.world;letcomps=newSMapanumber,RenderComponentbde;cc玩家数据组件letcomp3=aRealPlayerComponentbECS.WarFactory.CreateComponentdRenderComponentType.RealPlayerComponent,worldObje;comp3.id=playerData.fightRoleId;comp3.Initde;comp3.InitPlayerDatadplayerDatae;comps.setdRenderComponentType.RealPlayerComponent,comp3e;cc技能组件letcomp4=aSpellComponentbECS.WarFactory.CreateComponentdRenderComponentType.SpellComponent,worldObje;comp4.id=playerData.fightRoleId;comp4.Initde;letskData:game.SkillDataItem;fordletheroDataofplayerData.teamInfoe{ifd!RenderWarUtil.IsSpelldheroData.ideecontinue;letheroObj=agame.SpellDataItembcomp3.GetHeroDatadheroData.ide;cc法术comp4.AddSpellTemplatedheroObje;}comps.setdRenderComponentType.SpellComponent,comp4e;letentity=worldObj.CreateEntitydplayerData.fightRoleId,compse;entity.pid=playerData.fightRoleId;cc设置英雄属于哪个玩家阵营}}}moduleECSC{exportclassRenderComponentextendsECS.ComponentBase{protected_world:RenderWorld;publicentity:RenderEntity;protectedpropCB:SMapastring,game.AttrCallBackb;publicconstructorde{superde;this.propCB=newSMapastring,game.AttrCallBackbde;}publicgetworldde:RenderWorld{returnthis._world!=null?this._world:this.entity.world;}publicsetworldd_world:RenderWorlde{this._world=_world;}publicAddPropCBdpropName:string,func:Function,thisObject:any,args?:anye{this.propCB.setdpropName,newgame.AttrCallBackdfunc,thisObject,argsee}publicSetAttrdpropName:string,_value:any,...param:any[]e:void{Object.definePropertydthis,propName,{value:_value,writable:truecctrue表示该属性值可被修改，未修改前，iconBg调用SetAttr方法会报错，加了这个就不会，需要研究下}e;ifdthis.propCB.hasdpropNameee{ifdparam!=nullethis.propCB.getdpropNamee.execdparame;elsethis.propCB.getdpropNamee.execde;}}publicDisposede{letarray1=this.propCB.valuesde;fordletvalue1ofarray1e{value1.Destroyde;}this.propCB.clearde;super.Disposede;}}}moduleECSC{exportclassRenderEntityextendsECS.EntityBase{publicworld:RenderWorld;publicconstructorde{superde;}}}﻿moduleECSC{exportclassRenderSingletonComponentextendsRenderComponent{publicconstructorde{superde;}publicDisposede{super.Disposede;}}}moduleECSC{exportclassRenderSystemextendsECS.SystemBase{publicworld:RenderWorld;publicconstructorde{superde;}}}moduleECSC{exportclassRenderWorldextendsECS.WorldBaseaRenderEntityb{publicstatics_Instance:RenderWorld;publicstaticInitInstancedworldType:numbere{ifdRenderWorld.s_Instance==nulleRenderWorld.s_Instance=ECS.WarFactory.CreateWorlddworldTypee;elsegame.warnd"CreateWorlderror:",worldTypee;returnRenderWorld.s_Instance;}publicstaticDestroyInstancede{ifdRenderWorld.s_Instance!=nulleRenderWorld.s_Instance.Disposede;RenderWorld.s_Instance=null;}publicstaticGetInstancede:RenderWorld{returnRenderWorld.s_Instance;}publicmaxFrameCount:number=0;publicserverFrameCount:number=0;publicwarOverFrame:number=0;cc战场结束帧publicconstructorde{superde;this.Initde;}publicInitde{super.Initde;this.ResetFightIDde;this.InitWarContainerde;this.InitRenderHeroManagerde;}publicDisposede{this.DisposeWarContainerde;this.DisposeRenderHeroManagerde;super.Disposede;}publicIsLogicde:boolean{returnfalse;}publicGetSystemTypesde:number[]{lettypes:number[]=newArrayanumberbde;types.pushdSystemType.CreateRenderSysteme;types.pushdSystemType.SkillRenderSysteme;types.pushdSystemType.MoveRenderSysteme;types.pushdSystemType.WarUISysteme;returntypes;}publicGetEntityClassde:any{returnRenderEntity;}publicGetCompdcomponentType:numbere{returnthis.GetSingletonCompdcomponentTypee;}publicForceSysncRenderPosdecc强制同步位置{letentityArray=this.renderHeroManager.GetAllHerodfalsee;fordletentityofentityArraye{game.GlobalEvent.FireEventdGlobalEventType.ForceSyncRenderPos,entity.ide;}}publicWarOverde{this.warOverFrame=this.frameCount;ifdGameData.DeviceType!=DeviceType.LinuxServereServer.LogicMgr.GetInstancede.isStart=false;}publicRefreshFramedframe:number,serverFrame:numbere{this.frameCount=frame;this.serverFrameCount=serverFrame;this.RunFrameCallbackdthis.frameCounte;}publicLoopddeltaTime:numbere{ifdthis.isStarte{MagicMgr.GetInstancede.UpdateddeltaTimee;MoveRenderMgr.GetInstancede.UpdateddeltaTimee;this.BeforeUpdateddeltaTimee;this.UpdateddeltaTimee;this.LateUpdateddeltaTimee;}else{this.UpdateByPauseddeltaTimee;}}ccUpdate客户端以刷新频率执行主要用于客户端自己的表现publicBeforeUpdateddeltaTime:numbere{fordletobjofthis.systemListe{obj.BeforeUpdateddeltaTimee;}}publicUpdateddeltaTime:numbere{fordletobjofthis.systemListe{obj.UpdateddeltaTimee;}}publicLateUpdateddeltaTime:numbere{fordletobjofthis.systemListe{obj.LateUpdateddeltaTimee;}}publicUpdateByPauseddeltaTime:numbere{fordletobjofthis.systemListe{obj.UpdateByPauseddeltaTimee;}}ccWarContainerprivate_warContainer:ECS.WarContainer;publicgetwarContainerde:ECS.WarContainer{returnthis._warContainer;}publicInitWarContainerde{ifdthis._warContainer==nullethis._warContainer=newECS.WarContainerdthise;}publicDisposeWarContainerde{ifdthis._warContainer!=nulle{this._warContainer.Disposede;this._warContainer=null;}}ccRenderHeroManagerprivate_renderHeroManager:ECSC.RenderHeroManager;publicgetrenderHeroManagerde:ECSC.RenderHeroManager{returnthis._renderHeroManager;}publicInitRenderHeroManagerde{ifdthis._renderHeroManager==nullethis._renderHeroManager=newECSC.RenderHeroManagerde;}publicDisposeRenderHeroManagerde{ifdthis._renderHeroManager!=nulle{this._renderHeroManager.Disposede;this._renderHeroManager=null;}}}}﻿moduleECSC{exportclassAreaBaseextendsHeroBase{privatecircle_shape:egret.Shape;publicconstructordshape:number,args:anye{superdshape,argse;this.isDebug=true;}protectedInitRenderdargs:anye{letradius=args;letshape=this.circle_shape=newegret.Shapede;shape.graphics.beginFilld0x00ff00,0.2e;shape.graphics.drawCircled0,0,radiuse;shape.graphics.endFillde;this.root.addChilddshapee;this.zIndex=300;}publicInitColorViewdclipName:string,campType:numbere{}publicDisposeDeployInfode{}publicSetColordr:number,g:number,b:number,_revertColorTime:numbere{}publicInitde{}publicDisposede{super.Disposede;}publicSetAniAngledanglee{}publicSetAniSpeeddstate:number,speed:numbere{}publicSetAnimStatedstate:number,angle:number,campType:numbere:void{}publicDrawDebugPathdpath:ECS.NodePoint[],pos:Vector2e{}publicDrawDebugLinedpos:Vector2,targetPos:Vector2,atkType:numbere{}}}﻿moduleECSC{exportclassDeployCardMgr{privatestatics_Instance:DeployCardMgr;publicstaticGetInstancede:DeployCardMgr{ifdDeployCardMgr.s_Instance==nulleDeployCardMgr.s_Instance=newDeployCardMgrde;returnDeployCardMgr.s_Instance;}privatecardMap:SMapanumber,PreviewCardb;publicconstructorde{this.cardMap=newSMapanumber,PreviewCardbde;}publicGetCarddcarId:number,shape:number,playerComp:ECSC.RealPlayerComponente:PreviewCard{ifd!this.cardMap.hasdcarIde&&shape!=nulle{this.AddCarddcarId,shape,playerCompe;}returnthis.cardMap.getdcarIde;}publicAddCarddcardId:number,shape:number,playerComp:ECSC.RealPlayerComponente{letheroData=playerComp.GetHeroDatadshapee;letcardObj:PreviewCard=ECS.WarFactory.CreateObjectdObjectType.PreviewCard,shape,[heroData]e;cardObj.cardID=cardId;cardObj.Initde;cardObj.InitAttrdplayerCompe;cardObj.ShowDeployInfode;ECSC.RenderWarUtil.GetWarMapde.addChilddcardObje;this.cardMap.setdcardId,cardObje;}publicRemoveCarddcardId:numbere{ifd!this.cardMap.hasdcardIdeereturn;letcardObj=this.cardMap.getdcardIde;cardObj.Disposede;this.cardMap.deletedcardIde;}publicDisposede{letvalues=this.cardMap.valuesde;fordletvalueofvaluesevalue.Disposede;this.cardMap.clearde;}}}﻿moduleECSC{exportclassDragonBonesEffectextendsEffectBase{privatearmature:dragonBones.Armature;privatearmatureDisplay:dragonBones.EgretArmatureDisplay;privatedragonBonesData:dragonBones.DragonBonesData;publicconstructordshape:numbere{superdshape,null,nullethis.classType=ObjectType.DragonBonesEffect;}protectedInitRenderde{this.InitDatade;cc往龙骨工厂里添加资源letegretFactory:dragonBones.EgretFactory=dragonBones.EgretFactory.factory;EffectPool.GetInstancede.CacheDragonBonesDatadthis.fileName,this.shapee;}publicInitde{ifdthis.armatureDisplay!=nullethis.armatureDisplay.disposede;letegretFactory:dragonBones.EgretFactory=dragonBones.EgretFactory.factory;letdragonName=this.fileName;this.dragonBonesData=egretFactory.getDragonBonesDataddragonNamee;letarmature=egretFactory.buildArmatured"MovieClip",dragonName,"",dragonNameeifdarmature!=nulle{egretFactory.clock.adddarmaturee;letarmatureDisplay=armature.display;ccletarmatureDisplay:dragonBones.EgretArmatureDisplay=egretFactory.buildArmatureDisplayd"MovieClip",dragonName,null,dragonNamee;this.addChilddarmatureDisplaye;this.armatureDisplay=armatureDisplay;}this.armature=armature;super.Initde;}privateGetAnimationDatadanimationName:stringe:dragonBones.AnimationData{letanimations=this.armatureDisplay.animation.animations;fordletkeyinanimationse{ifdkey==animationNameereturnanimations[key];}returnnull;ccreturnthis.armatureDisplay.animation.animations}publicPlayEffectByTimedaniLabel:string,time:number,count:numbere{this.PlaydaniLabel,time,counte;}publicPlayEffectdaniLabel:stringe:void{this.PlaydaniLabel,this.time,this.counte;}privatePlaydaniLabel:string,time:number,count:numbere{ifdthis.armatureDisplay==null||this.dragonBonesData==nullereturn;letanimationData=this.GetAnimationDatadaniLabele;ifdanimationData==nulle{game.errord"DragonBonesEffectPlayEffecthasnostateerror:",aniLabele;return;}cc计算特效原始播放时间letoriginalTime=animationData.frameCountcthis.dragonBonesData.frameRate;ifdtime==0etime=originalTime;lettimeScale=originalTimectime;this.armatureDisplay.animation.timeScale=timeScale;ifdthis.armatureDisplay.animation.hasAnimationdaniLabeleethis.armatureDisplay.animation.playdaniLabel,counte;else{game.errord"DragonBonesEffectPlayEffectunknowstateerror:",aniLabele;}}publicDisposede{ifdthis.armature!=nulle{dragonBones.EgretFactory.factory.clock.removedthis.armaturee;this.armature.disposede;this.armature=null;}ifdthis.armatureDisplay!=nulle{game.RenderUtils.RemoveFromParentdthis.armatureDisplaye;this.armatureDisplay.disposedtruee;this.armatureDisplay=null;}this.dragonBonesData=null;super.Disposede;}publicDisposeAllde{this.Disposede;}}}﻿moduleECSC{exportclassEffectBaseextendsSpriteBase{publicclassType:number;publicshape:number=0;publicclipName:string;publicfileName:string;publicaniLabel:string;cc当前播放的动作名publictime:number;cc播放一次所需时间d0使用默认帧率播放epubliccount:number;cc播放次数d默认1次序列帧动画：-1表示循环播放龙骨动画：0表示循环播放epublicisLoop:boolean;cc动画MovieClipprotectedview:EffectMovieClip;publicconstructordshape:number,clipName:string,fileName:string=nulle{superde;this.shape=shape;this.clipName=clipName;this.fileName=fileName;this.classType=ObjectType.EffectBase;this.aniLabel="";this.time=0;this.count=1;this.isLoop=false;this.InitRenderde;}protectedInitDatade{letdataProxy=JsonData.getGameDatad"effectdata_json"e;leteffectData=dataProxy[this.shape];this.clipName=effectData["clipname"];this.fileName=effectData["filename"];this.aniLabel=effectData["aniname"]this.time=effectData["time"];leteType=effectData["type"];letloop=effectData["loop"];this.isLoop=loop;ifdeType==EffectType.DragonBonesEffectecc龙骨特效{ifdloop==1ecc循环this.count=0;elsethis.count=1;}else{ifdloop==1ecc循环this.count=-1;elsethis.count=1;}}protectedInitRenderde{ifdthis.fileName==nulle{this.InitDatade;}cclettemp=newegret.Bitmapde;cctemp.texture=RES.getResd"arrow_shadow_png"e;ccthis.addChilddtempe;cctemp.name="shadow";cctemp.x=-10;cctemp.y=10;cctemp.alpha=0.5;this.view=newEffectMovieClipde;this.addChilddthis.viewe;this.view.SetClipNamedthis.fileName,this.clipNamee;this.view.Initde;}protectedOnAddToStagedevent:egret.Evente{super.OnAddToStagedevente;this.zIndex=200;letmoveRenderMgr=MoveRenderMgr.GetInstancede;ifdmoveRenderMgr!=nullemoveRenderMgr.AddRenderObjectdthise;}ccpublicSetAnimStatedstate:number,time:number=0,count:number=1e:voidcc{ccthis.view.SetAnimStatedstate,time,counte;cc}publicPlayEffectByTimedaniLabel:string,time:number,count:numbere{ifdthis.view!=nullethis.view.PlayEffectdaniLabel,time,counte;}publicPlayEffectdaniLabel:stringe:void{ifdthis.view!=nullethis.view.PlayEffectdaniLabel,this.time,this.counte;}publicGotoAndStopdaniLabel:string,frame:numbere{ifdthis.isLoopecc循环动作除外return;this.scaleX=-1;ifdthis.view!=nullethis.view.GotoAndStopdaniLabel,framee;}publicInitde{super.Initde;ccgame.logdthis.hashCode,"-----------EffectBase--bbbbbbbbbbbbb",egret.getTimerdee;}publicDisposede{letmoveRenderMgr=MoveRenderMgr.GetInstancede;ifdmoveRenderMgr!=nullemoveRenderMgr.RemoveRenderObjectdthise;super.Disposede;}publicDisposeAllde{ifdthis.view!=nulle{this.view.Disposede;this.view=null;}this.Disposede;}publicUpdateddte{super.Updateddte;ifdthis.view!=nullethis.view.Updateddte;}}}﻿moduleECSC{exportclassEffectMovieClipextendsMovieClipBase{publicconstructorde{superde;}publicInitde:void{super.Initde;}ccpublicSetAnimStatedstate:number,time:number=0,count:number=1ecc{ccifdstate==AnimState.Idleecc{ccletaniLabel=MathConst.IdelLabel;ccthis.PlayEffectdaniLabel,time,counte;cc}ccccthis.originFrameRatecc}publicGotoAndStopdaniLabel:string,frame:numbere{ifdthis.stage==nullereturn;ifdthis.labelInfo==null||this.labelInfo.size==0ereturn;ifdaniLabel!=nulle{letframeInfo=this.labelInfo.getdaniLabele;ifdframeInfo!=nulle{frame+=frameInfo.frame;ifdframebframeInfo.endeframe=frameInfo.end}}this.gotoAndStopdframee;}publicPlayEffectdaniLabel:string,time:number,count:numbere{letframeInfo=this.labelInfo.getdaniLabele;ifdframeInfo!=null&&time!=0e{letframeCount=frameInfo.end-frameInfo.frame+1letspeed=dframeCountcthis.originFrameRateectime;this.aniSpeedInfo.setdaniLabel,speede;}else{this.aniSpeedInfo.setdaniLabel,1e;}this.PlaydaniLabel,count,null,nulle;}publicDisposede:void{super.Disposede;}publicUpdateddt:numbere{ccgame.logdthis.$nextFrameNum,this.currentFrame,this.currentFrameLabel,"----------bbbb"e;super.Updateddte;}}}﻿moduleECSC{exportclassEffectPool{privatestaticinstance:EffectPool;publicstaticGetInstancede:EffectPool{ifdEffectPool.instance==nulle{EffectPool.instance=newEffectPoolde;}returnEffectPool.instance;}private_movieClipPool:SMapastring,egret.MovieClipDataFactoryb;private_dragonPool:SMapastring,numberb;publicconstructorde{this._movieClipPool=newSMapastring,egret.MovieClipDataFactorybde;this._dragonPool=newSMapastring,numberbde;}publicGetMovieClipdfileName:stringe:egret.MovieClipDataFactory{ifd!this._movieClipPool.hasdfileNameee{letjsonName=fileName+"_json";letpngName=fileName+"_png";letdata=RES.getResdjsonNamee;lettexture=RES.getResdpngNamee;letmcf:egret.MovieClipDataFactory=newegret.MovieClipDataFactoryddata,texturee;this._movieClipPool.setdfileName,mcfe;}returnthis._movieClipPool.getdfileNamee;}publicHasMovieClipdfileName:stringe:boolean{letjsonName=fileName+"_json";letpngName=fileName+"_png";lethasJson=RES.hasResdjsonNamee;lethasPNG=RES.hasResdpngNamee;returnhasJson&&hasPNG;}publicDestroyMovieClipdfileNamee{ifdthis._movieClipPool.hasdfileNameee{letmcf=this._movieClipPool.getdfileNamee;mcf.clearCachede;this._movieClipPool.deletedfileNamee;}}publicCacheDragonBonesDatadfileName:string,shape:numbere{letskeJsonData=RES.getResd`${fileName}_ske_json`e;lettextureJsonData=RES.getResd`${fileName}_tex_json`e;lettexturePNGData=RES.getResd`${fileName}_tex_png`e;ifdskeJsonData==null||textureJsonData==null||texturePNGData==nulle{game.errord"DragonBonesEffectInitRendererror:",fileName,shapee;return;}letdragonName=fileName;letegretFactory:dragonBones.EgretFactory=dragonBones.EgretFactory.factory;ifdegretFactory.getDragonBonesDataddragonNamee==nulle{letdragonBonesData=egretFactory.parseDragonBonesDatadskeJsonDatae;egretFactory.addDragonBonesDataddragonBonesData,dragonNamee;}ifdegretFactory.getTextureAtlasDataddragonNamee==nulle{lettextureAtlasData=egretFactory.parseTextureAtlasDatadtextureJsonData,texturePNGDatae;egretFactory.addTextureAtlasDatadtextureAtlasData,dragonNamee;}this._dragonPool.setdfileName,shapee;}publicDestroyAllde{fordletmcfofthis._movieClipPool.valuesdee{mcf.clearCachede;}this._movieClipPool.clearde;letegretFactory:dragonBones.EgretFactory=dragonBones.EgretFactory.factory;letkeys=this._dragonPool.keysde;fordletkeyofkeyse{letdragonName=key;ccdragonBonesData.disposede;ccletdragonBonesData=egretFactory.getDragonBonesDataddragonNamee;ccifddragonBonesData!=nulleccdragonBonesData.addArmatured"MovieClip"e.egretFactory.removeDragonBonesDataddragonName,truee;egretFactory.removeTextureAtlasDataddragonName,truee;}this._dragonPool.clearde;}}}﻿moduleECSC{exportclassEmptyMovieClipextendsMovieClipBase{publicconstructorde{superde;}publicInitde:void{}publicSetAnimStatedstate:number,angle:number,campType:numbere:void{}publicSetAniSpeeddstate:number,speed:numbere{}publicSetAngledanglee{}publicUpdateddeltaTime:numbere{}publicDisposede:void{ifdthis&&this.parente{this.parent.removeChilddthise;}}}}﻿moduleECSC{exportclassHeroBaseextendsSpriteBase{publicroot:egret.DisplayObjectContainer;cc动画MovieClipprotected_view:MovieClipBase;protected_color_view:MovieClipBase;private_view2:MovieClipBase;private_color_view2:MovieClipBase;publicgetviewde:MovieClipBase{ifdthis._view2!=nullereturnthis._view2;returnthis._view;}publicgetcolor_viewde:MovieClipBase{ifdthis._color_view2!=nullereturnthis._color_view2;ifdthis._view2!=nullecc如果有变身view就不能使用了_color_viewreturnnull;returnthis._color_view;}protectedshadow:egret.Bitmap;publicshape:number;publicclipName:string;protectedlifeBar:LifeBarBase;protectedlifeBarX:number;protectedlifeBarY:number;protectedaniAngle:number;cc调试对象protected_lineShape:egret.Shape;protected_player:egret.Sprite;protected_circleArray:egret.Sprite[];publicisDebug:boolean;protectedrevertColorTime:number=0;protectedisDie:boolean;protectedtimerKey:number;private_enemyColor:string;private_offset:Vector2;privateattackPointArray:number[][];cc攻击点位置列表privatevitPointArray:number[][];cc受击点位置列表publicconstructordshape:number,args:anye{superde;this.shape=shape;this.clipName=args;this.root=newegret.DisplayObjectContainerde;this.root.name="root";this.addChilddthis.roote;this.attackPointArray=[];this.vitPointArray=[];this.aniAngle=0;this._enemyColor="red";letdataProxy=JsonData.getGameDatad"movieclipdata_json"e;letdata=dataProxy[shape.toStringde];ifddata==nulledata=dataProxy["0"];ifddata!=nulle{this._enemyColor=data["enemycolor"];letoffset=data["offset"];letx=offset[0];lety=offset[1];ifdx!=null&&y!=nullethis._offset=newVector2d[x,y]e;fordletpointofdata["attackpoint"]ethis.attackPointArray.pushd[point[0],point[1]]e;fordletpointofdata["vitpoint"]ethis.vitPointArray.pushd[point[0],point[1]]e;}this.InitRenderdargse;this.isDebug=false;this._circleArray=[];}protectedInitRenderdargs:anye{letclipName=args;this.shadow=newegret.Bitmapde;this.shadow.texture=RES.getResd"war_ui_common_json.bg_zdyz"e;this.root.addChilddthis.shadowe;this.shadow.x=-30;this.shadow.y=-15;this._view=newHeroMovieClipdthis.shapee;this.root.addChilddthis._viewe;this._view.SetClipNamedclipName,clipNamee;this._view.Initde;}privateIsInitColorViewdclipName:string,campType:numbere:boolean{letredClipName=`${clipName}_${this._enemyColor}`;ccclipName+"_red"ifdcampType==CampType.Enemy&&this._enemyColor!=null&&EffectPool.GetInstancede.HasMovieClipdredClipNameee{returntrue;}returnfalse;}cc初始化颜色外观publicInitColorViewdclipName:string,campType:numbere{letredClipName=`${clipName}_${this._enemyColor}`;ccclipName+"_red"ifdthis.IsInitColorViewdclipName,campTypeee{ifdthis._color_view==nulle{this._color_view=newHeroMovieClipdthis.shapee;this.root.addChilddthis._color_viewe;cc蓝色的英雄不叠加_redthis._color_view.SetClipNamedredClipName,redClipNamee;this._color_view.Initde;}this._color_view.visible=true;}else{ifdthis._color_view!=nullethis._color_view.visible=false;}}publicChangeViewdshape:numberecc变羊术{this.cacheAsBitmap=false;ifdthis._view!=nullethis._view.visible=false;ifdthis._color_view!=nullethis._color_view.visible=false;ifdthis._view2!=nullethis._view2.Disposede;ifdthis._color_view2!=nullethis._color_view2.Disposede;this._view2=newHeroMovieClipdshapee;letindex=this.root.getChildIndexdthis._viewe;this.root.addChildAtdthis._view2,indexe;letclipName=`hero_${shape}`;this._view2.SetClipNamedclipName,clipNamee;this._view2.Initde;ifdthis.IsInitColorViewdclipName,this.campTypeee{this._color_view2=newHeroMovieClipdshapee;this.root.addChildAtdthis._color_view2,index+1e;this._color_view2.SetClipNamedclipName,clipNamee;this._color_view2.Initde;}this.cacheAsBitmap=true;this.SetAniAngledthis.aniAnglee;this.SetAnimStatedAnimState.Idle,-1,this.campTypee;this.SetViewColord255,255,255,255e;}publicResetViewde{this.cacheAsBitmap=false;ifdthis._view2!=nulle{this._view2.Disposede;this._view2=null;}ifdthis._color_view2!=nulle{this._color_view2.Disposede;this._color_view2=null;}ifdthis._view!=nullethis._view.visible=true;ifdthis._color_view!=nullethis._color_view.visible=true;this.cacheAsBitmap=true;}publicInitddata?:anye{super.Initde;this.SetVisibledtruee;this.SetAlphad1e;this.isDie=false;this.SetColord255,255,255,255,0e;this.timerKey=null;this.InitColorViewdthis.clipName,this.campTypee;ifdthis._offset!=nulle{ifdthis.view!=nulle{this.view.SetPosdthis._offset.x,this._offset.ye;}ifdthis.color_view!=nulle{this.color_view.SetPosdthis._offset.x,this._offset.ye;}}ifdthis.view!=nullethis.view.id=this.id;ifdthis.color_view!=nullethis.color_view.id=this.id;cc血条letlifeBarType=LifeBarType.SelfHeroLifeBar;letx=0;lety=0;ifdRenderWarUtil.IsKingTowerdthis.shapeee{ifdthis.campType==CampType.Friende{lifeBarType=LifeBarType.SelfKingLifeBar;x=-70;y=-125;}else{lifeBarType=LifeBarType.TargetKingLifeBar;x=-85;y=-125;}}elseifdRenderWarUtil.IsQueenTowerdthis.shapeee{ifdthis.campType==CampType.Friende{lifeBarType=LifeBarType.SelfQueueLifeBar;x=-40;y=23;}else{lifeBarType=LifeBarType.TargetQueueLifeBar;x=-50;y=23;}}else{ifdthis.campType==CampType.Friende{lifeBarType=LifeBarType.SelfHeroLifeBar;x=-25;y=-90;}else{lifeBarType=LifeBarType.TargetHeroLifeBar;x=-45;y=-90;}}letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdwarComp!=null&&warComp.IsReversePosdee{x=-x;y=-y;}this.lifeBarX=x;this.lifeBarY=y;ifddata==null||data.hasLifeBare{this.lifeBar=ECSC.CreateLifeBardlifeBarTypee;}ccifdthis.id!=1025ecc{ccifdthis.view!=nulleccthis.view.visible=false;ccifdthis.color_view!=nulleccthis.color_view.visible=false;ccifdthis.lifeBar!=nulleccthis.lifeBar.alpha=0;ccifdthis.shadow!=nulleccthis.shadow.visible=false;cc}ccthis.lifeBar.x=x;ccthis.lifeBar.y=y;ccthis.addChilddthis.lifeBare;ccthis.lifeBar.visible=false;ccthis.DrawDebugLinednull,nulle;}protectedOnAddToStagedevent:egret.Evente{super.OnAddToStagedevente;lettopGroup=ECSC.RenderWarUtil.GetWarMapde.topGroup;ifdthis.lifeBar!=null&&topGroup!=nulle{topGroup.addChilddthis.lifeBare;this.lifeBar.x=this.lifeBarX+this.x;this.lifeBar.y=this.lifeBarY+this.y;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdwarComp!=null&&warComp.IsReversePosdeethis.lifeBar.rotation=180;this.lifeBar.name=this.id.toStringde;}this.root.cacheAsBitmap=true;}publicDisposede{ifdthis._player!=nulle{this.removeChilddthis._playere;this._player=null;}this.DisposeCircleInfode;ifdthis.timerKey!=nulle{game.TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=null;}ifdthis.lifeBar!=nulle{this.lifeBar.Disposede;this.lifeBar=null;}this.ResetViewde;game.TimerMgr.GetInstancede.RemoveTimerdthis.delayAniTimerKeye;this.DisposeBlinkTimerde;ccthis.DisposeDeployInfode;super.Disposede;}publicDisposeAllde{ifdthis._view!=nulle{this._view.Disposede;this._view=null;}ifdthis._view2!=nulle{this._view2.Disposede;this._view2=null;}ifdthis._color_view!=nulle{this._color_view.Disposede;this._color_view=null;}ifdthis._color_view2!=nulle{this._color_view2.Disposede;this._color_view2=null;}ifdthis.shadow!=nulle{game.RenderUtils.RemoveFromParentdthis.shadowe;this.shadow=null;}this.SetWarnEffectShowdfalsee;this.Disposede;}publicSetChildIndexdlayer:numbere{ccthis.parent.setChildIndexdthis,layere;this.zIndex=layer;ifdthis.lifeBar!=null&&this.lifeBar.parent!=nullethis.lifeBar.zIndex=layer;ccthis.lifeBar.parent.setChildIndexdthis.lifeBar,layere;}publicsetXdx:numbere{lety=this.Y;this.SetPosdx,ye;}publicgetXde:number{returnthis.GetPosde.x;}publicsetYdy:numbere{letx=this.X;this.SetPosdx,ye;}publicgetYde:number{returnthis.GetPosde.y;}publicSetPosdx:number,y:numbere:void{super.SetPosdx,ye;ifdthis.lifeBar!=nulle{this.lifeBar.x=this.lifeBarX+x;this.lifeBar.y=this.lifeBarY+y;}}publicSetShowPosdx:number,y:numbere{super.SetShowPosdx,ye;ifdthis.lifeBar!=nulle{this.lifeBar.x=this.lifeBarX+x;this.lifeBar.y=this.lifeBarY+y;}}publicSetAniAngledanglee{ccvarerr=newErrorde;ccgame.logd"----------------angle-----------------",angle,this.id,err.stacke;ccangle=44.999;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdwarComp!=null&&warComp.IsReversePosdeeangle=dangle+180e%360;angle=angle%360;this.aniAngle=angle;ccifdthis.id==1018ecc{ccccleterr=newErrorde;ccgame.logdangle,"-------1018---SetAniAngle-----bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb"e;cc}ifdthis.view!=nullethis.view.SetAngledanglee;ifdthis.color_view!=nullethis.color_view.SetAngledanglee;}publicSetAngledangle:numbere:void{super.SetAngledanglee;}publicGetBonePosdboneName:stringe:[number,number]{ifdthis.view==nullereturn[0,0];ifdboneName=="attackPoint"e{letangle=this.view.GetAnglede;angle=angle%360;letrotateType=this.view.GetRotateTypedanglee;letscaleX=this.view.GetScaleXdanglee;cc使用攻击点来标记letpoint=this.attackPointArray[rotateType];letptx=0;letpty=0;ifdpoint!=nulle{ptx=point[0];pty=point[1]}ifdscaleX==-1eptx=-ptx;letx,y;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdwarComp!=null&&warComp.IsReversePosdee{x=-ptx-this.view.x;y=-pty-this.view.y;}else{x=ptx+this.view.x;y=pty+this.view.y;}return[x,y];}elseifdboneName=="vitPoint"e{letangle=this.view.GetAnglede;angle=angle%360;letrotateType=this.view.GetRotateTypedanglee;letscaleX=this.view.GetScaleXdanglee;cc使用受击点来标记letpoint=this.vitPointArray[rotateType];letptx=0;letpty=0;ifdpoint!=nulle{ptx=point[0];pty=point[1]}ifdscaleX==-1eptx=-ptx;letx,y;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdwarComp!=null&&warComp.IsReversePosdee{x=-ptx-this.view.x;y=-pty-this.view.y;}else{x=ptx+this.view.x;y=pty+this.view.y;}return[x,y];}return[0,0];}publicSetAniSpeeddstate:number,speed:number,time:number=0e{ccstate=AnimState.Move;ifdthis.view!=nullethis.view.SetAniSpeeddstate,speed,timee;ifdthis.color_view!=nullethis.color_view.SetAniSpeeddstate,speed,timee;}privatedelayAniTimerKey:number=0;publicSetAnimStatedstate:number,angle:number,campType:number,delayTime=0e:void{ccstate=AnimState.Move;ccifdthis.id==1019ecc{ccgame.logdthis.shape,"----1019-------SetAnimState-----------",state,egret.getTimerdee;cc}game.TimerMgr.GetInstancede.RemoveTimerdthis.delayAniTimerKeye;ifddelayTimeb0e{this.delayAniTimerKey=game.TimerMgr.GetInstancede.AddTimerddelayTime,de=b{this.SetAnimStatedstate,angle,campType,0e;},thise;return;}ifdthis.view!=nullethis.view.SetAnimStatedstate,angle,campTypee;ifdthis.color_view!=nulle{this.color_view.SetAnimStatedstate,angle,campTypee;}}publicPausedisPause:booleane{ifdthis.view!=nulle{ifdisPauseethis.view.stopde;elsethis.view.playde;}ifdthis.color_view!=nulle{ifdisPauseethis.color_view.stopde;elsethis.color_view.playde;}}publicSetLvdlv:numbere{ifdthis.lifeBar!=nullethis.lifeBar.SetLvdlve;}publicSetAlphadalpha:numbere{ccgame.logd`-------SetAlpha------alpha:${alpha}--id:${this.id}hashcode:${this.hashCode}stack:${newErrorde.stack}`e;this.alpha=alpha;ccifdthis.lifeBar!=nulleccthis.lifeBar.alpha=alpha;}publicSetHPdhp:number,hpMax:numbere{letextraArgs=null;ccifdthis.view!=nulleccextraArgs=`${this.view.currentLabel}:${this.view.currentFrame}`;extraArgs=this.id;ifdhpa=0&&!this.isDiee{this.OnDiede;}ifdthis.lifeBar!=nulle{this.lifeBar.SetHPdhp,hpMax,extraArgse;ifdhpa=0&&!this.visiblee{game.logd"------鞭尸---bbbbbbbbbbbbbbbbbbbbbbb",this.ide;}ifdRenderWarUtil.IsTowerdthis.shapeeethis.lifeBar.visible=dhpb0e;else{ifdGameData.DevelopModeb=DevelopMode.Debugethis.lifeBar.visible=dhpb0e;elsethis.lifeBar.visible=dhpahpMax&&hpb0e;}}}protectedOnDiede{this.isDie=true;ccthis.SetAnimStatedAnimState.Die,0,0e;this.timerKey=game.TimerMgr.GetInstancede.AddTimerd500,de=b{ccgame.logd"------OnDie----bbbbbbbbbbbbbbb",this.ide;this.SetVisibledfalsee;},thise;ifdthis.lifeBar!=nullethis.lifeBar.visible=false;this.DisposeCircleInfode;}privatetweenObj:game.TweenInfo;privateDestroyTweenObjde{ifdthis.tweenObj!=nulle{this.tweenObj.Destroyde;this.tweenObj=null;}}private_viewAlpha:number;private_viewColor:number;private_viewColorProgress:number;privategetviewColorProgressde{returnthis._viewColorProgress;}privatesetviewColorProgressdvalue:numbere{this._viewColorProgress=value;letcolor=this._viewColor;letr=colorbb16;color=color-draa16e;letg=colorbb8;color=color-dgaa8e;letb=color;leta=this._viewAlpha;r=r+d255-re*valuec100;g=g+d255-ge*valuec100;b=b+d255-be*valuec100;a=a+d255-ae*valuec100;this.SetViewColordr,g,b,ae;}publicSetViewColordr:number,g:number,b:number,a:numbere{ccletcolor=draa16e+dgaa8e+b;ccifdthis.view!=nullecc{ccthis.view.tint=color;ccthis.view.alpha=ac255;cc}ccifdthis.color_view!=nullecc{ccthis.color_view.tint=color;ccthis.color_view.alpha=ac255;cc}ifdrb=250&&gb=250&&bb=250e{ifdthis.view!=nullethis.view.filters=null;ifdthis.color_view!=nullethis.color_view.filters=null;return;}letcolorMatrix=[1,0,0,0,1,0,0,0,0,1,0,0,1,0,1,0,0,0,1,0];colorMatrix[0]=rc255;colorMatrix[6]=gc255;colorMatrix[12]=bc255;colorMatrix[18]=ac255;letcolorFilter=newegret.ColorMatrixFilterdcolorMatrixe;ccthis.view.filters=[shadowFilter,colorFilter];ifdthis.view!=nullethis.view.filters=[colorFilter];ifdthis.color_view!=nullethis.color_view.filters=[colorFilter];}ccrevertColorTime恢复颜色时间延迟0表示不恢复publicSetColordr:number,g:number,b:number,a:number,revertColorTime:numbere{ifdthis.view==null||this.isDieereturn;this.DestroyTweenObjde;letcolor=draa16e+dgaa8e+b;this.SetViewColordr,g,b,ae;ifdrevertColorTimeb0e{this._viewAlpha=a;this._viewColor=color;this._viewColorProgress=0;this.tweenObj=game.TweenInfo.Createde;this.tweenObj.DoTweend0,this,revertColorTimec1000,{viewColorProgress:100}e;this.tweenObj.Execde;}ccletshadowFilter:egret.DropShadowFilter=newegret.DropShadowFilterd40,60,0x000000,0.8,16,16,0.6,egret.BitmapFilterQuality.LOW,false,falsee;cc只有飞行类的用这个shader效果其他的用一个圆圈就行了TODONIUccthis.view.filters=[shadowFilter];ccifdrevertColorTimea0eccthis.revertColorTime=egret.getTimerde+MathConst.MaxNumber;ccelseccthis.revertColorTime=egret.getTimerde+revertColorTime;ccifdr==255&&g==255&&b==255ecc{ccthis.view.filters=null;ccccthis.view.filters=[shadowFilter];ccthis.revertColorTime=egret.getTimerde+MathConst.MaxNumber;cc}ccletcolorMatrix=[cc1,0,0,0,1,cc0,0,0,0,1,cc0,0,1,0,1,cc0,0,0,1,0cc];cccolorMatrix[0]=rc255;cccolorMatrix[6]=gc255;cccolorMatrix[12]=bc255;cccolorMatrix[18]=ac255;ccletcolorFilter=newegret.ColorMatrixFilterdcolorMatrixe;ccccthis.view.filters=[shadowFilter,colorFilter];ccthis.view.filters=[colorFilter];}privateblinkTimer:number;privateblinkCount:number;publicDisposeBlinkTimerde{ifdthis.blinkTimer!=nulle{game.TimerMgr.GetInstancede.RemoveTimerdthis.blinkTimere;this.blinkTimer=null;}}cc颜色闪烁publicSetBlinkColordtime:number,r:number,g:number,b:number,a:numbere{ifdtime==0e{this.SetColord255,255,255,255,0e;this.DisposeBlinkTimerde;return;}else{ifdthis.blinkTimer!=nullereturn;}letthisObj=this;this.blinkCount=0;this.blinkTimer=game.TimerMgr.GetInstancede.AddTimerdtime,de=b{thisObj.blinkCount+=1;ifdthisObj.blinkCount%2==1ethisObj.SetColordr,g,b,a,0e;elsethisObj.SetColord255,255,255,255,0e;returntrue;},thise;}privatewarnEffect:EffectBase;cc在警戒范围内的话显示警戒叹号publicSetWarnEffectShowdshow:booleane{ifdshowe{ifdthis.warnEffect==nullethis.warnEffect=game.RenderUtils.CreateEffectdSceneTypeConst.War,9503,0,0e;this.root.addChildAtdthis.warnEffect,1000e;this.warnEffect.SetPosd0,-20e;}else{ifdthis.warnEffect!=nulle{game.RenderUtils.DestroyEffectdSceneTypeConst.War,this.warnEffecte;this.warnEffect=null;}}}publicSetVisibledvisible:booleane{super.SetVisibledvisiblee;ifdthis.lifeBar!=nullethis.lifeBar.visible=visible;}publicSetLifeBarVisibledvisible:booleane{ifdthis.lifeBar!=nullethis.lifeBar.visible=visible;}publicSetShadowVisibledvisible:booleane{ifdthis.shadow!=nullethis.shadow.visible=visible;}publicUpdateddeltaTime:numbere{ifdthis.view!=nullethis.view.UpdateddeltaTimee;ifdthis.color_view!=nullethis.color_view.UpdateddeltaTimee;ccifdegret.getTimerdeb=this.revertColorTimeecc{ccthis.SetColord255,255,255,255,-1e;cc}}publicDrawDebugPathdpath:ECS.NodePoint[],pos:Vector2e{ifdGameData.DevelopModeaDevelopMode.Debugereturn;ifdRenderWarUtil.IsTowerdthis.shapeeereturn;ifdpath==null||path.length==0ereturn;ifdthis._lineShape==null&&this.parent!=nulle{this._lineShape=newegret.Shapede;this.parent.addChilddthis._lineShapee;}letcellSize=MathConst.MapCellSize;this._lineShape.graphics.clearde;this._lineShape.graphics.lineStyled1,0xFF0000e;letnode=path[0];letx=node.x*cellSize+cellSizec2;lety=node.y*cellSize+cellSizec2;cc[x,y]=RenderWarUtil.GetReversePosdx,ye;this._lineShape.graphics.moveTodpos.x,pos.ye;this._lineShape.graphics.lineTodx,ye;letlen=path.length;ifdlenb1e{fordleti=1;ia=path.length-1;i++e{node=path[i];x=node.x*cellSize+cellSizec2;y=node.y*cellSize+cellSizec2;cc[x,y]=RenderWarUtil.GetReversePosdx,ye;this._lineShape.graphics.lineTodx,ye;}}this._lineShape.graphics.endFillde;}publicDrawDebugLinedpos:Vector2,targetPos:Vector2,atkType:numbere{ccifdGameData.DevelopModeaDevelopMode.Debugeccreturn;ccifdthis._player==nullecc{ccthis._player=newegret.Spritede;ccccthis._player.touchChildren=false;ccifdatkType==AtkType.Attackeccthis._player.graphics.beginFilld0x0000ffe;ccelseccthis._player.graphics.beginFilld0xff0000e;ccthis._player.graphics.drawCircled0,0,4e;ccthis._player.graphics.endFillde;ccthis._player.x=0;ccthis._player.y=0;ccthis.addChilddthis._playere;cc}ccifdLogicWarUtil.IsTowerdthis.shapeeeccreturn;ccifdthis._lineShape==null&&this.parent!=nullecc{ccthis._lineShape=newegret.Shapede;ccthis.parent.addChilddthis._lineShapee;cc}ccifdpos!=null&&targetPos!=nullecc{ccthis._lineShape.graphics.clearde;ccthis._lineShape.graphics.lineStyled1,0xFF0000e;ccthis._lineShape.graphics.moveTodpos.x,pos.ye;ccthis._lineShape.graphics.lineTodtargetPos.x,targetPos.ye;ccthis._lineShape.graphics.endFillde;cc}}publicDisposeCircleInfode{fordletcircleofthis._circleArraye{game.RenderUtils.RemoveFromParentdcirclee;}this._circleArray=[];ifdthis._lineShape!=nulle{this.parent.removeChilddthis._lineShapee;this._lineShape=null;}}publicDrawDebugCircleInfodheroData:ECS.HeroDataComponent|ECSC.HeroDataComponent,centerPos:Vector2,radiusArray:number[]e{ifd!GameData.ShowAttackRangeereturn;ifdGameData.DevelopModeaDevelopMode.Debugereturn;ifdRenderWarUtil.IsTowerdheroData.shapeeereturn;ifdthis.parent==nullereturn;ifdradiusArray[0]==null||radiusArray[0]==0ereturn;letindex=0;ifdthis._circleArray.length==0e{index=0;fordletradiusofradiusArraye{letcircleObj=newegret.Spritede;circleObj.graphics.beginFilld0xff0000,0e;ifdindex==0ecircleObj.graphics.lineStyled2,0xff0000,0.6,truee;elsecircleObj.graphics.lineStyled2,0x00ff00,0.6,truee;circleObj.graphics.drawCircled0,0,radiuse;circleObj.graphics.endFillde;circleObj.name=`circle_${this.id}_${radius}`;this._circleArray.pushdcircleObje;letidx=this.parent.getChildIndexdthise;this.parent.addChildAtdcircleObj,idx-1e;index++;}}index=0;fordletradiusofradiusArraye{letcircleObj=this._circleArray[index];ifdcircleObj!=nulle{cclet[x,y]=RenderWarUtil.GetReversePosdcenterPos.x,centerPos.ye;let[x,y]=[centerPos.x,centerPos.y]circleObj.x=x;circleObj.y=y;}index++;}}}}﻿moduleECSC{exportclassHeroMovieClipextendsMovieClipBase{publicshape:number;protectedlastAniLabel:string;protectedlastAniType:string;privatecampType:number;privateangle:number;privateaniTimeInfo:SMapastring,numberb;cc每个动作播放一次时间publicconstructordshape:numbere{superde;this.shape=shape;this.aniTimeInfo=newSMapastring,numberbde;}publicInitde:void{super.Initde;ccthis.scaleX=this.scaleY=1;this.angle=-1;letkeys=this.labelInfo.keysde;fordletkeyofkeysecc计算每个动作播放一次所需时间{letname=key.substringd0,key.length-1e;ifdthis.aniTimeInfo.hasdnameeecontinue;letfl=this.labelInfo.getdkeye;letframeCount=fl.end-fl.frame+1lettime=dframeCountcthis.originFrameRatee;this.aniTimeInfo.setdname,timee;}}protectedOnAddToStagedevent:egret.Evente{super.OnAddToStagedevente;ccthis.anchorOffsetX=256;ccthis.anchorOffsetY=256;ccthis.anchorOffsetX=this.widthc2;ccthis.anchorOffsetY=this.heightc2;}publicDisposede:void{this.aniTimeInfo.clearde;super.Disposede;}publicGetScaleXdanglee:number{angle=angle%360;ifdanglea=180ereturn1;elsereturn-1;}publicGetRotateTypedangle:numbere:number{angle=angle%360;ifdangleb180eangle=360-angle;letangleInfo=WarCache.GetInstancede.GetHeroAngleInfodthis.shapee;ifdangle!=nulle{letstartAngle,endAngle,rotateType;fordletinfoofangleInfoe{startAngle=info[0];endAngle=info[1];rotateType=info[2];ifdangleb=startAngle&&anglea=endAngleereturnrotateType;}game.errord"GetRotateTypeerror1:",this.clipName,anglee;return0;}game.errord"GetRotateTypeerror2:",this.clipName,anglee;ccifdangleb=0&&anglea30c2eccreturn0;ccelseifdangleb=30c2&&anglea95c2eccreturn1;ccelseifdangleb=95c2&&anglea155c2eccreturn2;ccelseifdangleb=155c2&&anglea215c2eccreturn3;ccelseifdangleb=215c2&&anglea285c2eccreturn4;ccelseifdangleb=285c2&&anglea340c2eccreturn5;ccelseifdangleb=340c2&&anglea360c2eccreturn6;ccelseccreturn6;ifdangleb=0&&anglea45c2ereturn0;elseifdangleb=45c2&&anglea135c2ereturn1;elseifdangleb=135c2&&anglea225c2ereturn2;elseifdangleb=225c2&&anglea315c2ereturn3;elseifdangleb=315c2&&anglea360c2ereturn4elsereturn4;}publicSetAnimStatedstate:number,angle:number,campType:numbere:void{letrotateType=this.GetRotateTypedthis.anglee;letscaleX=this.GetScaleXdthis.anglee;this.scaleX=scaleX;ccifdthis.id==1018ecc{ccgame.logd"---1018--------------------------SetAnimState---------",this.angle,rotateType,scaleXe;cc}ifdstate==AnimState.Idlee{letaniType=MathConst.IdelLabel;letaniLable=`${aniType}${rotateType}`;ifdthis.lastAniLabel!=aniLablee{ifdthis.lastAniType==aniTypeethis.PlaydaniLable,-1,aniType,this.lastAniLabele;cc同一个动作从上一帧续播elsethis.PlaydaniLable,-1,aniType,nulle;cc不同动作从头播放}this.lastAniLabel=aniLable;this.lastAniType=MathConst.IdelLabel;}elseifdstate==AnimState.Movee{letaniType=MathConst.MoveLabel;letaniLable=`${aniType}${rotateType}`;ifdthis.lastAniLabel!=aniLablee{ccletbeginFrame=0;ccletlastFrameLabel=this.labelInfo.getdthis.lastAniLabele;ccletnowFrameLabel=this.labelInfo.getdaniLablee;ccifdlastFrameLabel!=null&&nowFrameLabel!=nullecc{ccbeginFrame=nowFrameLabel.frame+this.currentFrame-lastFrameLabel.frame;cc}ccthis.gotoAndStopdaniLablee;ccthis.gotoAndStopdbeginFramee;ccthis.playd-1e;ccthis.$frameLabelStart=nowFrameLabel.frame;ccthis.$frameLabelEnd=nowFrameLabel.end;ifdthis.lastAniType==aniTypeethis.PlaydaniLable,-1,aniType,this.lastAniLabele;cc同一个动作从上一帧续播elsethis.PlaydaniLable,-1,aniType,nulle;cc不同动作从头播放}this.lastAniLabel=aniLable;this.lastAniType=aniType;}elseifdstate==AnimState.Attacke{letaniType=MathConst.AttackLabel;letaniLable=`${aniType}${rotateType}`;this.PlaydaniLable,1,aniType,nulle;cc非循环动作每次都从头播放this.lastAniLabel=aniLable;this.lastAniType=aniType;}elseifdstate==AnimState.Skille{letaniType=MathConst.SkillLabel;letaniLable=`${aniType}${rotateType}`;ifd!this.labelInfo.hasdaniLableeecc没有施法动作先播放攻击动作{this.SetAnimStatedAnimState.Attack,angle,campTypee;return;}this.PlaydaniLable,1,aniType,nulle;cc非循环动作每次都从头播放this.lastAniLabel=aniLable;this.lastAniType=aniType;}elseifdstate==AnimState.Diee{letaniType=MathConst.IdelLabel;letaniLable=`${aniType}${rotateType}`;this.PlaydaniLable,-1,aniType,nulle;cc死亡动作每次都从头播放this.lastAniLabel=aniLable;this.lastAniType=aniType;}ccifdSettings.log&&campType==CampType.Enemyeccgame.logdegret.getTimerde,"state:",state,"_____________angle:__",angle,"__________campType:__",campType,"当前状态：",this.lastAniLabele;}publicSetAniSpeeddstate:number,speed:number,time:number=0e{letaniLabel:string=null;ifdstate==AnimState.Idleecc待机动作不受攻速加成影响{}elseifdstate==AnimState.Movee{aniLabel=MathConst.MoveLabel;}elseifdstate==AnimState.Attacke{aniLabel=MathConst.AttackLabel;}elseifdstate==AnimState.Skille{aniLabel=MathConst.SkillLabel;}elseifdstate==AnimState.Diee{}ifdaniLabel!=nulle{ifdthis.aniTimeInfo.hasdaniLabele&&time!=0ecc重新计算播放速度{letoriginTime=this.aniTimeInfo.getdaniLabele;speed=originTimectime*speed;}}else{speed=1;}this.aniSpeedInfo.setdaniLabel,speede;ifdaniLabel!=null&&aniLabel==this.nowAniLablee{letupdateSpeed=ECSC.RenderWarUtil.GetUpdateSpeedde;this.frameRate=Math.floordthis.originFrameRate*updateSpeed*speede;}}publicSetAngledanglee{this.angle=angle;}publicGetAnglede:number{returnthis.angle;}ccprivateendFrames:Setanumberb=newSetanumberbd[7,14,21,28,35,77,84,91,98,105]epublicUpdateddeltaTime:numbere{super.UpdateddeltaTimee;ifdthis.aniSpeedInfo!=null&&this.nowAniType!=null&&this.aniSpeedInfo.hasdthis.nowAniTypeee{letspeed=this.aniSpeedInfo.getdthis.nowAniTypee;letupdateSpeed=ECSC.RenderWarUtil.GetUpdateSpeedde;letframeRate=Math.floordthis.originFrameRate*updateSpeed*speede;ifdthis.frameRate!=frameRateethis.frameRate=frameRate;}ccgame.logd"---------Update------bbbbbbbbbbb",this.currentFrame,"time:",egret.getTimerdee;ccifdthis.id==1015eccifdthis.id==1018ecc{ccgame.logdegret.getTimerde,"_______1015_Update________________",this.currentFrame,this.currentLabel,egret.getTimerdee;cc}ccifdthis.endFrames.hasdthis.currentFrameeecc攻击结束帧cc{ccccgame.logd"________Update_____攻击结束帧____________"e;ccifdthis.angle!=-1eccthis.SetAnimStatedAnimState.Idle,this.angle,CampType.Friende;cc}}}}﻿moduleECSC{exportclassHeroQueueextendsHeroBase{publicconstructordshape:number,clipName:stringe{superdshape,clipNamee;}protectedInitRenderdclipName:stringe{this._view=newTowerMovieClipde;this.root.addChilddthis._viewe;this._view.SetClipNamedclipName,clipNamee;this._view.scaleX=1;this._view.scaleY=1;this._view.Initde;this._view.anchorOffsetX=this._view.anchorOffsetY=0;ccthis.view.y=-45;ccthis.lifeBar.visible=false;ccthis.view.alpha=0;}publicInitColorViewdclipName:string,campType:numbere{}publicDisposeDeployInfode{}publicInitde{super.Initde;}publicDisposede{super.Disposede;}publicSetAniAngledanglee{}publicSetAniSpeeddstate:number,speed:numbere{ifdthis.view!=nullethis.view.SetAniSpeeddstate,speede;}publicSetAnimStatedstate:number,angle:number,campType:numbere:void{ifdthis.view!=nullethis.view.SetAnimStatedstate,angle,campTypee;}}}﻿moduleECSC{classHurtNumberRenderextendsegret.DisplayObjectContainer{privatelabel:egret.TextField;privatetimerKey:number;privategameObject:any;publicconstructordgameObject:any,hurtHP:number,hurtType:number,text:stringe{superde;cchurtType=112;letdataProxy=JsonData.getGameDatad"warnumberdata_json"e;letwarnumberData=dataProxy[hurtType];ifdwarnumberData==null||warnumberData["size"]==0||warnumberData["color"]==0e{game.warnd"__HurtNumberRendererror:__",hurtTypee;return;}hurtHP=Math.absdhurtHPe;letlabel:egret.TextField=newegret.TextFieldde;label.text="";label.size=warnumberData["size"];label.textColor=warnumberData["color"];cclabel.textColor=0xff0000;label.fontFamily="MicrosoftYaHei";ifdhurtHPb0elabel.text=`${text}${warnumberData["text"]}${hurtHP}`;elselabel.text=`${text}${warnumberData["text"]}`;this.label=label;this.addChilddlabele;this.gameObject=gameObject;this.timerKey=0;this.addEventListenerdegret.Event.ADDED_TO_STAGE,this.onAddToStage,thise;}privateonAddToStagedevent:egret.Evente{letpos=this.gameObject.GetPosde;lettargetY=0;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdwarComp.IsReversePosdee{this.x=pos.x+30;this.y=pos.y+100;this.rotation=-180;targetY=pos.y+200;}else{this.x=pos.x-30;this.y=pos.y-100;this.rotation=0;targetY=pos.y-200;}lettime=1;TweenLite.todthis,time,{x:this.x,y:targetY,alpha:0.5,ease:Power0.easeIn}e.kill;this.timerKey=game.TimerMgr.GetInstancede.AddTimerdtime*1000,de=b{HurtNumberRenderMgr.GetInstancede.RemoveHurtNumberdthise;},thise;}publicDisposede{this.gameObject=null;ifdthis.parent!=nulle{this.parent.removeChilddthise;}ifdthis.timerKey!=0e{game.TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=0;}TweenLite.killTweensOfdthise;this.removeEventListenerdegret.Event.ADDED_TO_STAGE,this.onAddToStage,thise;}}exportclassHurtNumberRenderMgr{privatestaticinstance:HurtNumberRenderMgr;publicstaticGetInstancede:HurtNumberRenderMgr{returnHurtNumberRenderMgr.instance;}publicstaticInitInstancede{ifdHurtNumberRenderMgr.instance==nulleHurtNumberRenderMgr.instance=newHurtNumberRenderMgrde;}publicstaticDestroyInstancede{ifdHurtNumberRenderMgr.instance!=nulleHurtNumberRenderMgr.instance.Disposede;HurtNumberRenderMgr.instance=null;}privatehurtNumberRenderArray:HurtNumberRender[];publicconstructorde{this.hurtNumberRenderArray=[];}publicDisposede{fordletrenderofthis.hurtNumberRenderArraye{render.Disposede;}this.hurtNumberRenderArray=[];}publicRemoveHurtNumberdrender:HurtNumberRendere{letindex=this.hurtNumberRenderArray.indexOfdrendere;ifdindexb-1e{this.hurtNumberRenderArray.splicedindex,1e;render.Disposede;}}publicShowHurtdgameObject:any,hurtHP:number,hurtType:number,text:string=""e{letrender=newHurtNumberRenderdgameObject,hurtHP,hurtType,texte;this.hurtNumberRenderArray.pushdrendere;ccgameObject.parent.addChilddrendere;ifdgameObject.parent!=nullegameObject.parent.addChildAtdrender,10000e;elsegame.errord"HurtNumberRenderMgr.ShowhurterrorgameObject.parentisnull!!!"e;}}}﻿c****血条*@author**cmoduleECSC{exportclassLifeBarBaseextendsegret.Sprite{protected_width:numberprotected_height:number;protectedbg:eui.Image;protectedfg:eui.Image;protectedshine:eui.Image;protectedtext:egret.TextField;protectedlastHP:number=0;publicconstructorde{superde;letlabel:egret.TextField=newegret.TextFieldde;label.text="";label.size=15;label.textColor=0x00ffff;label.fontFamily="MicrosoftYaHei";label.x=30;label.y=0;this.text=label;this.addChilddlabele;label.visible=dGameData.DevelopModeb=DevelopMode.Debuge;cclabel.visible=false;this.Initde;}protectedInitde{this.cacheAsBitmap=true;this.lastHP=0;}publicDisposede{ifdthis.parent!=nullethis.parent.removeChilddthise;}publicSetTextdtxt:stringe{this.text.text=txt;ccthis.text.x=-dthis.text.width-18ec2;ccthis.text.y=-20;ccthis.text.anchorOffsetX=0;ccthis.text.anchorOffsetY=0;}protectedAlignRightdobj:eui.Image,xStart:number,maxWidth:numbere{obj.x=xStart+maxWidth-obj.width;}publicSetLvdlv:numbere{}publicSetHPdhp:number,hpmax:number,id?:anye{this.lastHP=hp;}protected_strength:number=1;protectedgetstrengthde{returnthis._strength;}protectedsetstrengthdvalue:numbere{ccgame.RenderUtils.SetColordthis.fg,255,255,255,valuee;this.shine.visible=dvaluea=1&&valueb0e;this.shine.alpha=value;this._strength=value;}protectedShowAnimationdhp:number,hpmax:number,cb:Functione{ccgame.logd"------ShowAnimation--------bbbbbbbbbbb",egret.getTimerdee;ifdthis.lastHP==hp||this.lastHP==0e{this.strength=0;ifdcb!=nullecb.calldthise;return;}else{this.lastHP=hp;}TweenLite.killTweensOfdthise;this.strength=0;TweenLite.todthis,0.1,{strength:1,ease:Power0.easeIn,onComplete:de=b{TweenLite.todthis,0.1,{strength:0,ease:Power0.easeIn,onComplete:de=b{this.strength=0;ifdcb!=nulle{cb.calldthise;}}}e;}}e;}}exportclassSelfHeroLifeBarextendsLifeBarBase{privatelv:egret.BitmapText;publicconstructorde{superde;}publicInitde{this._width=41;this._height=14;letbg="war_ui_common_json.bg_hp_s_di";letshine="war_ui_common_json.bg_hp_s_blue_shine";letfg="war_ui_common_json.bg_hp_s_blue";cc""this.bg=game.RenderUtils.CreateScale9GridImgdbg,this._width,this._height,newegret.Rectangled5,3,30,5ee;this.addChilddthis.bge;this.bg.x=15;this.bg.y=5;this.fg=game.RenderUtils.CreateScale9GridImgdfg,this._width,this._height,newegret.Rectangled4,3,32,5ee;this.addChilddthis.fge;this.fg.x=15;this.fg.y=5;this.shine=game.RenderUtils.CreateScale9GridImgdshine,this._width,this._height,newegret.Rectangled3,2,34,7ee;this.addChilddthis.shinee;this.shine.x=15;this.shine.y=5;this.lv=newegret.BitmapTextde;this.lv.font=RES.getResd"hp_blue_little_font_fnt"e;this.addChilddthis.lve;this.lv.x=-2;this.lv.y=0;this.lv.textAlign="center";this.text.y=-20;super.Initde;}publicSetLvdlv:numbere{lettransInfo:any={10:"a",11:"b",12:"c",13:"d",14:"e",15:"f"};letlvStr=lv.toStringde;ifdlvb9elvStr=transInfo[lv];this.lv.text=lvStr;}publicSetHPdhp:number,hpmax:number,id?:anye{this.ShowAnimationdhp,hpmax,de=b{letnum=this._width*hpchpmax;num=numa0?0:num;this.shine.width=num;this.fg.width=num;}e;ifdid!=0&&id!=nullethis.SetTextd`${id}`e;}}exportclassTargetHeroLifeBarextendsLifeBarBase{privatelv:egret.BitmapText;publicconstructorde{superde;}publicInitde{this._width=41;this._height=14;letbg="war_ui_common_json.bg_hp_s_di_red";letshine="war_ui_common_json.bg_hp_s_blue_shine";letfg="war_ui_common_json.bg_hp_s_red";cc""this.bg=game.RenderUtils.CreateScale9GridImgdbg,this._width,this._height,newegret.Rectangled5,3,30,5ee;this.addChilddthis.bge;this.bg.x=15;this.bg.y=5;this.fg=game.RenderUtils.CreateScale9GridImgdfg,this._width,this._height,newegret.Rectangled4,3,32,5ee;this.addChilddthis.fge;this.fg.x=15;this.fg.y=5;this.fg.right=15;this.shine=game.RenderUtils.CreateScale9GridImgdshine,this._width,this._height,newegret.Rectangled3,2,34,7ee;this.addChilddthis.shinee;this.shine.x=15;this.shine.y=5;this.shine.right=15;this.lv=newegret.BitmapTextde;this.lv.font=RES.getResd"hp_red_little_font_fnt"e;this.addChilddthis.lve;this.lv.x=51;this.lv.y=0;this.lv.textAlign="center";this.text.y=-20;super.Initde;}publicSetLvdlv:numbere{lettransInfo:any={10:"a",11:"b",12:"c",13:"d",14:"e",15:"f"};letlvStr=lv.toStringde;ifdlvb9elvStr=transInfo[lv];this.lv.text=lvStr;}publicSetHPdhp:number,hpmax:number,id?:anye{this.ShowAnimationdhp,hpmax,de=b{letnum=this._width*hpchpmax;num=numa0?0:num;this.shine.width=num;this.fg.width=num;this.AlignRightdthis.shine,15,this._widthe;this.AlignRightdthis.fg,15,this._widthe;}e;ifdid!=0&&id!=nullethis.SetTextd`${id}`e;}}exportclassSelfQueueLifeBarextendsLifeBarBase{privatelvBg:eui.Image;privatehp:egret.BitmapText;publicconstructorde{superde;}publicInitde{this._width=68;this._height=16;letbg="war_ui_common_json.bg_hp_m_di";letshine="war_ui_common_json.bg_hp_s_blue_shine";letfg="war_ui_common_json.bg_hp_m_blue";cc""this.bg=game.RenderUtils.CreateScale9GridImgdbg,this._width,this._height,newegret.Rectangled5,3,30,5ee;this.addChilddthis.bge;this.bg.x=12;this.bg.y=5;this.fg=game.RenderUtils.CreateScale9GridImgdfg,this._width,this._height,newegret.Rectangled4,3,32,5ee;this.addChilddthis.fge;this.fg.x=12;this.fg.y=5;this.fg.right=15;this.shine=game.RenderUtils.CreateScale9GridImgdshine,this._width,this._height,newegret.Rectangled3,2,34,7ee;this.addChilddthis.shinee;this.shine.x=12;this.shine.y=5;this.shine.right=15;this.lvBg=game.RenderUtils.CreateImageByNamed"war_ui_common_json.bg_hp_m_blue_icon"e;this.addChilddthis.lvBge;this.lvBg.x=-6;this.lvBg.y=0;this.hp=newegret.BitmapTextde;this.hp.font=RES.getResd"hp_blue_big_font_fnt"e;this.addChilddthis.hpe;this.hp.x=12;this.hp.y=0;this.hp.letterSpacing=-3;this.hp.width=80;this.hp.scaleX=this.hp.scaleY=0.85;this.hp.textAlign="center";this.text.x=20;this.text.y=-20;super.Initde;}publicSetHPdhp:number,hpmax:number,id?:anye{this.ShowAnimationdhp,hpmax,de=b{letnum=this._width*hpchpmax;num=numa0?0:num;this.shine.width=num;this.fg.width=num;}e;ifdid!=0&&id!=nullethis.SetTextd`${id}`e;this.hp.text=hp.toStringde;}}exportclassTargetQueueLifeBarextendsLifeBarBase{privatelvBg:eui.Image;privatehp:egret.BitmapText;publicconstructorde{superde;}publicInitde{this._width=68;this._height=16;letbg="war_ui_common_json.bg_hp_m_di_red";letshine="war_ui_common_json.bg_hp_s_red_shine";letfg="war_ui_common_json.bg_hp_m_red";cc""this.bg=game.RenderUtils.CreateScale9GridImgdbg,this._width,this._height,newegret.Rectangled5,3,30,5ee;this.addChilddthis.bge;this.bg.x=12;this.bg.y=5;this.fg=game.RenderUtils.CreateScale9GridImgdfg,this._width,this._height,newegret.Rectangled4,3,32,5ee;this.addChilddthis.fge;this.fg.x=12;this.fg.y=5;this.fg.right=12;this.shine=game.RenderUtils.CreateScale9GridImgdshine,this._width,this._height,newegret.Rectangled3,2,34,7ee;this.addChilddthis.shinee;this.shine.x=12;this.shine.y=5;this.shine.right=12;this.lvBg=game.RenderUtils.CreateImageByNamed"war_ui_common_json.bg_hp_m_red_icon"e;this.addChilddthis.lvBge;this.lvBg.x=96;this.lvBg.y=0;this.lvBg.scaleX=-1;this.hp=newegret.BitmapTextde;this.hp.font=RES.getResd"hp_red_big_font_fnt"e;this.addChilddthis.hpe;this.hp.x=12;this.hp.y=0;this.hp.letterSpacing=-3;this.hp.width=80;this.hp.scaleX=this.hp.scaleY=0.85;this.hp.textAlign="center";this.text.x=20;this.text.y=-20;super.Initde;}publicSetHPdhp:number,hpmax:number,id?:anye{this.ShowAnimationdhp,hpmax,de=b{letnum=this._width*hpchpmax;num=numa0?0:num;this.shine.width=num;this.fg.width=num;this.AlignRightdthis.shine,12,this._widthe;this.AlignRightdthis.fg,12,this._widthe;}e;ifdid!=0&&id!=nullethis.SetTextd`${id}`e;this.hp.text=hp.toStringde;}}exportclassSelfKingLifeBarextendsLifeBarBase{privatelvBg:eui.Image;privatehp:egret.BitmapText;privatelv:egret.BitmapText;privateshineWidth:number;privateshineHeight:number;publicconstructorde{superde;}publicInitde{this._width=90;this._height=18;this.shineWidth=90;this.shineHeight=18;letbg="war_ui_common_json.bg_hp_l_di";letshine="war_ui_common_json.bg_hp_s_blue_shine";letfg="war_ui_common_json.bg_hp_l_blue";cc""this.bg=game.RenderUtils.CreateScale9GridImgdbg,this._width,this._height,newegret.Rectangled5,3,30,5ee;this.addChilddthis.bge;this.bg.x=33;this.bg.y=21;this.fg=game.RenderUtils.CreateScale9GridImgdfg,this._width,this._height,newegret.Rectangled4,3,32,5ee;this.addChilddthis.fge;this.fg.x=33;this.fg.y=21;this.shine=game.RenderUtils.CreateScale9GridImgdshine,this.shineWidth,this.shineHeight,newegret.Rectangled3,2,34,7ee;this.addChilddthis.shinee;this.shine.x=34;this.shine.y=22;this.hp=newegret.BitmapTextde;this.hp.font=RES.getResd"hp_blue_big_font_fnt"e;this.addChilddthis.hpe;this.hp.x=28;this.hp.y=15;this.hp.letterSpacing=-3;this.hp.width=100;this.hp.textAlign="center";this.lvBg=game.RenderUtils.CreateImageByNamed"war_ui_common_json.bg_hp_l_blue_icon"e;this.addChilddthis.lvBge;this.lvBg.x=5;this.lvBg.y=4;this.lv=newegret.BitmapTextde;this.lv.font=RES.getResd"tower_lv_blue_font_fnt"e;this.addChilddthis.lve;this.lv.x=4;this.lv.y=8;this.lv.width=40;this.lv.textAlign="center";this.text.x=50;this.text.y=0;super.Initde;}publicSetLvdlv:numbere{letlvStr=lv.toStringde;this.lv.text=lvStr;}publicSetHPdhp:number,hpmax:number,id?:anye{this.ShowAnimationdhp,hpmax,de=b{letnum=this._width*hpchpmax;num=numa0?0:num;this.shine.width=num*this.shineWidthcthis._width;this.fg.width=num;}e;ifdid!=0&&id!=nullethis.SetTextd`${id}`e;this.hp.text=hp.toStringde;}}exportclassTargetKingLifeBarextendsLifeBarBase{privatelvBg:eui.Image;privatehp:egret.BitmapText;privatelv:egret.BitmapText;privateshineWidth:number;privateshineHeight:number;publicconstructorde{superde;}publicInitde{this._width=90;this._height=18;this.shineWidth=90;this.shineHeight=18;letbg="war_ui_common_json.bg_hp_l_di_red";letshine="war_ui_common_json.bg_hp_s_red_shine";letfg="war_ui_common_json.bg_hp_l_red";cc""this.bg=game.RenderUtils.CreateScale9GridImgdbg,this._width,this._height,newegret.Rectangled5,3,30,5ee;this.addChilddthis.bge;this.bg.x=33;this.bg.y=21;this.fg=game.RenderUtils.CreateScale9GridImgdfg,this._width,this._height,newegret.Rectangled4,3,32,5ee;this.addChilddthis.fge;this.fg.x=33;this.fg.y=21;this.fg.right=30;this.shine=game.RenderUtils.CreateScale9GridImgdshine,this.shineWidth,this.shineHeight,newegret.Rectangled3,2,34,7ee;this.addChilddthis.shinee;this.shine.x=34;this.shine.y=22;this.shine.right=34;this.hp=newegret.BitmapTextde;this.hp.font=RES.getResd"hp_red_big_font_fnt"e;this.addChilddthis.hpe;this.hp.x=28;this.hp.y=15;this.hp.letterSpacing=-3;this.hp.width=100;this.hp.textAlign="center";this.lvBg=game.RenderUtils.CreateImageByNamed"war_ui_common_json.bg_hp_l_blue_icon"e;this.addChilddthis.lvBge;this.lvBg.x=137;this.lvBg.y=4;this.lv=newegret.BitmapTextde;this.lv.font=RES.getResd"tower_lv_red_font_fnt"e;this.addChilddthis.lve;this.lv.x=110;this.lv.y=8;this.lv.width=40;this.lv.height=20;this.lv.textAlign="center";this.text.x=50;this.text.y=0;super.Initde;}publicSetLvdlv:numbere{letlvStr=lv.toStringde;this.lv.text=lvStr;}publicSetHPdhp:number,hpmax:number,id?:anye{this.ShowAnimationdhp,hpmax,de=b{letnum=this._width*hpchpmax;num=numa0?0:num;this.shine.width=num*this.shineWidthcthis._width;this.fg.width=num;this.AlignRightdthis.shine,34,this.shineWidthe;this.AlignRightdthis.fg,33,this._widthe;}e;ifdid!=0&&id!=nullethis.SetTextd`${id}`e;this.hp.text=hp.toStringde;}}exportfunctionCreateLifeBardlifeBarType:numbere:LifeBarBase{switchdlifeBarTypee{caseLifeBarType.SelfHeroLifeBar:returnnewSelfHeroLifeBarde;caseLifeBarType.TargetHeroLifeBar:returnnewTargetHeroLifeBarde;caseLifeBarType.SelfQueueLifeBar:returnnewSelfQueueLifeBarde;caseLifeBarType.TargetQueueLifeBar:returnnewTargetQueueLifeBarde;caseLifeBarType.SelfKingLifeBar:returnnewSelfKingLifeBarde;caseLifeBarType.TargetKingLifeBar:returnnewTargetKingLifeBarde;default:returnnewSelfHeroLifeBarde;}}exportclassLifeBarextendsegret.Sprite{privatebg:egret.Bitmap;privatebar:egret.Bitmap;cc18privatetext:egret.TextField;private_width:numberprivate_height:number;publicconstructordargs:anye{superde;this._width=args.width;this._height=args.height;letbg=args.bg?args.bg:"lifeBarBg_png";letfg=args.fg?args.fg:"lifeBar_png";this.bg=game.RenderUtils.CreateScale9GridBitmapdbg,args.width,args.height,newegret.Rectangled7,7,79,5ee;this.addChilddthis.bge;this.bar=game.RenderUtils.CreateScale9GridBitmapdfg,args.width,args.height,newegret.Rectangled7,7,79,5ee;this.addChilddthis.bare;letlabel:egret.TextField=newegret.TextFieldde;label.text="";label.size=15;label.textColor=0x000000;label.fontFamily="MicrosoftYaHei";cclabel.textAlign=egret.HorizontalAlign.LEFT;label.x=0;label.y=0;this.text=label;this.addChilddlabele;this.cacheAsBitmap=true;}publicDisposede{ifdthis.parent!=nulle{this.parent.removeChilddthise;}}publicSetProgressdhp:number,hpmax:number,id:number=0e{varnum:number=this._width*hpchpmax;varper:number=numa0?0:num;this.bar.width=per;ifdid!=0ethis.SetTextd`${id}`e;}publicSetTextdtxt:stringe{this.text.text=txt;this.text.x=-dthis.text.width-18ec2;this.text.y=-20;ccthis.text.anchorOffsetX=0;ccthis.text.anchorOffsetY=0;}publicReSetde{this.bar.width=this._width;this.text.text="";}}}﻿moduleECSC{exportclassMagicCMDInfo{publicname:string;publictime:number;publicaction:Function;publicargs:any[];publicwhileAction:Function;cc行为条件publicwhileArgs:any[];publicconstructorde{this.args=[];}publicExecdthisObj:MagicBasee:booleancc执行成功返回true否则返回false{letret=true;ifdthis.whileAction!=nulle{ret=this.whileAction.applydthisObj,this.whileArgse;}ifd!retereturnfalse;ifdthis.action==nullereturntrue;ccthis.action.calldthisObje;letnewArgs:any[]=[];fordletvalueofthis.argse{ifdtypeofvalue=="function"evalue=valuedthisObje;newArgs.pushdvaluee;}this.action.applydthisObj,newArgse;returntrue;}publicDisposede{this.action=null;this.args=null;this.whileAction=null;this.whileArgs=null;ccgame.logd"-----MagicCMDInfo.Disposede-------",this.namee;}}exportclassLogicCMDInfo{publickey:string;publicvalue:any;publicisReached:boolean;cc指令是否已经到达publicfunc:Function;publicconstructorde{this.isReached=false;}publicDisposede{this.func=null;this.isReached=false;}publicAddFuncdfunc:Function,thisObj:MagicBase,isReached:booleane{ifd!this.isReachedethis.isReached=isReached;ifdfunc!=nullethis.func=func;ifdthis.isReachedethis.ExecdthisObje;}publicExecdthisObj:MagicBasee{ifdthis.func!=nullethis.func.calldthisObj,this.valuee;}}exportclassMagicMgr{privatestaticinstance:MagicMgr;publicstaticGetInstancede:MagicMgr{returnMagicMgr.instance;}publicstaticInitInstancede{ifdMagicMgr.instance==nulleMagicMgr.instance=newMagicMgrde;}publicstaticDestroyInstancede{ifdMagicMgr.instance!=nulleMagicMgr.instance.Disposede;MagicMgr.instance=null;}privatestaticmagicData:SMapanumber,any[]b;publicstaticInitMagicDatade{ifdMagicMgr.magicData!=nullereturn;MagicMgr.magicData=newSMapanumber,any[]bde;letdataProxy=JsonData.getGameDatad"magicdata_json"e;letwhileAction:Function;letwhileArgs:any[];fordletkeyindataProxye{letmagicId=Numberdkeye;ifd!MagicMgr.magicData.hasdmagicIdeeMagicMgr.magicData.setdmagicId,[]e;letcmdArray=MagicMgr.magicData.getdmagicIde;lettempArray:any[][]=dataProxy[key];fordlettempInfooftempArraye{lettime=tempInfo.shiftde;letname=tempInfo.shiftde;letfunc:Function=MagicBase.prototype[name];ifdfunc==nulle{game.errord`MagicMgrerror${magicId}:${name}`e;continue;}ifdname=="WhileBegin"e{whileAction=func;whileArgs=tempInfo;continue;}elseifdname=="WhileEnd"e{whileAction=null;whileArgs=null;continue;}letcmdInfo:any={};cmdInfo.time=time;cmdInfo.name=name;ifdwhileAction!=nulle{cmdInfo.whileAction=whileAction;cmdInfo.whileArgs=whileArgs;}cmdInfo.action=func;cmdInfo.args=tempInfo;cmdArray.pushdcmdInfoe;}}}publicstaticGetMagicDatadmagicId:numbere:any[]{returnMagicMgr.magicData.getdmagicIde;}publicmagicArray:MagicBase[];publicmagicDict:SMapanumber,MagicBaseb;publicconstructorde{this.magicArray=newArrayaMagicBasebde;this.magicDict=newSMapanumber,MagicBasebde;}publicDisposede{fordletvalueofthis.magicArrayevalue.Disposede;this.magicArray.length=0;this.magicDict.clearde;}publicCreateMagicdpfid:number,attID:number,actid:number,vits:number[],attackSpeedUp:numbere{cc没有法术流程ifd!MagicMgr.magicData.hasdpfideereturn;ifdattackSpeedUp==nulle{game.warnd"-----------CreateMagicdattackSpeedUpisnulle---bbbbbbbbbbbb",pfide;attackSpeedUp=1;}ccifdpfid==99010eccgame.logd"________CreateMagic_pfid:",pfid,"attID:",attID,"actid:",actid,"magicArray.len:",this.magicArray.lengthe;letmagicObj=newMagicBasedpfid,attID,actid,attackSpeedUpe;magicObj.AddVitsdvitse;this.magicArray.pushdmagicObje;this.magicDict.setdactid,magicObje;}publicCreateMagic2dpfid:number,actid:number,fromPos:number[],toPos:number[],attackSpeedUpe{cc没有法术流程ifd!MagicMgr.magicData.hasdpfideereturn;ifdattackSpeedUp==nulle{game.warnd"-----------CreateMagic2dattackSpeedUpisnulle---bbbbbbbbbbbb",pfide;attackSpeedUp=1;}ccifdpfid==104eccgame.logd"________CreateMagic_pfid:",pfid,"attID:",attID,"actid:",actid,"magicArray.len:",this.magicArray.lengthe;letmagicObj=newMagicBasedpfid,0,actid,attackSpeedUpe;letx=fromPos[0];lety=fromPos[1];magicObj.fromPos=newVector2d[x,y]e;x=toPos[0];y=toPos[1];magicObj.toPos=newVector2d[x,y]e;this.magicArray.pushdmagicObje;this.magicDict.setdactid,magicObje;}publicDestoryMagicdactid:numbere{ccifdSettings.logeccgame.logd"________DestoryMagic_actid:",actid,"time:",egret.getTimerdee;ifd!this.magicDict.hasdactideereturn;fordleti=0;iathis.magicArray.length;i++e{ifdthis.magicArray[i].actid==actide{this.magicArray[i].Disposede;this.magicArray.splicedi,1e;return;}}}publicAddVitsdactid:number,vits:number[]e{ifd!this.magicDict.hasdactideereturn;letmagicObj=this.magicDict.getdactide;magicObj.AddVitsdvitse;}publicStopWaitdactid:numbere{ifd!this.magicDict.hasdactideereturn;letmagicObj=this.magicDict.getdactide;magicObj.StopWaitde;}publicPauseSkilldactid:number,isPause:booleane{ifd!this.magicDict.hasdactideereturn;letmagicObj=this.magicDict.getdactide;magicObj.PauseSkilldisPausee;}publicSendLogicCMDdactid:number,key:string,value:anye{ifd!this.magicDict.hasdactideereturn;letmagicObj=this.magicDict.getdactide;magicObj.AddLogicCMDdkey,value,null,truee;}publicUpdateddt:numbere{fordleti=0;iathis.magicArray.length;i++e{this.magicArray[i].Updateddte;}}}exportclassMagicBase{publicactid:number;publicpfid:number;publiccmdArray:MagicCMDInfo[];publicwhileCmdArray:MagicCMDInfo[];publicattID:number;publicattackSpeedUp:number;publicfromPos:Vector2;publictoPos:Vector2;cc受击者privatevits:number[];cc等待logicprivateisWait:boolean;privatewaitTime:number;privatepassTime:number;cc暂停privateisPause:boolean;cc特效相关privateeffectObjs:SMapanumber,anyb;privateeffectCache:SMapastring,any[]b;privateoriginAttrs:SMapanumber,SMapanumber,anybb;cc包装特效privateheroCache:SMapastring,stringb;cc移动privatemoveObjMap:SMapanumber,anyb;privatelogicCMDMap:SMapastring,LogicCMDInfob;ccpublicstaticlastTime:number=0;publicconstructordpfid:number,attID:number,actid:number,attackSpeedUp:numbere{ccletdtime=egret.getTimerde-MagicBase.lastTime;ccMagicBase.lastTime=egret.getTimerde;ccifdpfid==99010eccgame.logd"___MagicBasector____time:",egret.getTimerde,"______________frame:",LogicWorld.GetInstancede.frameCount,"actid:",actide;this.attID=attID;this.actid=actid;this.pfid=pfid;this.attackSpeedUp=attackSpeedUp;this.vits=newArrayanumberbde;this.effectObjs=newSMapanumber,anybde;this.effectCache=newSMapastring,anybde;this.isWait=false;this.isPause=false;this.waitTime=0;this.passTime=0;this.originAttrs=newSMapanumber,SMapanumber,anybbde;this.heroCache=newSMapastring,stringbde;this.moveObjMap=newSMapanumber,anybde;this.logicCMDMap=newSMapastring,LogicCMDInfobde;this.fromPos=null;this.toPos=null;this.cmdArray=newArrayaMagicCMDInfobde;this.whileCmdArray=newArrayaMagicCMDInfobde;cc法术流程letcmdArray:any[]=MagicMgr.GetMagicDatadpfide;ifdcmdArray==nulle{game.errord"MagicMgrhasnomgcid:",pfide;return;}lettotalTime=0;fordleti=0;iacmdArray.length;i++e{letcmdInfo:any=cmdArray[i];letcmdObj:MagicCMDInfo=ECS.WarFactory.CreateObjectdObjectType.MagicCMDInfo,null,nulle;cmdObj.name=cmdInfo.name;totalTime+=NumberdcmdInfo.timee;cmdObj.time=totalTime;cmdObj.action=cmdInfo.action;cmdObj.args=cmdInfo.args;cmdObj.whileAction=cmdInfo.whileAction;cmdObj.whileArgs=cmdInfo.whileArgs;ifdcmdObj.whileAction!=nullethis.whileCmdArray.pushdcmdObje;elsethis.cmdArray.pushdcmdObje;}ccgame.logd"------------MagicMgr.constructor__",this.pfid,this.actid,egret.getTimerdee;}publicDisposede{letarray=this.effectObjs.valuesde;fordletvalueofarraye{game.RenderUtils.DestroyEffectdSceneTypeConst.War,valuee;}ccifdthis.pfid==99010eccgame.logd"------------MagicMgr.Dispose__",this.pfid,this.actid,egret.getTimerde,ECSC.RenderWarUtil.GetWorldObjde.frameCount,newErrorde.stacke;this.effectObjs.clearde;this.effectCache.clearde;this.vits.length=0;this.fromPos=null;letoriginAttrs=this.originAttrs;letkeys=originAttrs.keysde;letkeys2:number[];letrenderObj:HeroBase;letattrs:SMapanumber,anyb;letvalue:any;fordletidofkeyse{renderObj=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdide;ifdrenderObj==nullecontinue;attrs=originAttrs.getdide;keys2=attrs.keysde;fordletattrTypeofkeys2e{value=attrs.getdattrTypee;ifdattrType==MagicAttrType.AlphaerenderObj.SetAlphadvaluee;elseifdattrType==MagicAttrType.ScaleerenderObj.SetScaledvalue[0],value[1]e;elseifdattrType==MagicAttrType.LogicPoserenderObj.SetPosdvalue[0],value[1]e;elseifdattrType==MagicAttrType.ShowPose{ccgame.logd"-----------------SetShowPos----bbbb",value[0],value[1]e;renderObj.SetShowPosdvalue[0],value[1]e;}elseifdattrType==MagicAttrType.ViewerenderObj.ResetViewde;}attrs.clearde;}originAttrs.clearde;this.heroCache.clearde;letids=this.moveObjMap.keysde;fordletidofidse{letobj=this.moveObjMap.getdide;ifdid==obj.ideMoveRenderMgr.GetInstancede.RemoveMoveInfodobje;}this.moveObjMap.clearde;fordletcmdObjofthis.cmdArraye{ifdcmdObj.whileAction==nulleECS.WarFactory.DestroyObjectdcmdObj,ObjectType.MagicCMDInfo,nulle;}this.cmdArray.length=0;fordletcmdObjofthis.whileCmdArraye{ECS.WarFactory.DestroyObjectdcmdObj,ObjectType.MagicCMDInfo,nulle;}this.whileCmdArray.length=0;letcmdInfoArray=this.logicCMDMap.valuesde;fordletcmdInfoofcmdInfoArraye{ECS.WarFactory.DestroyObjectdcmdInfo,ObjectType.LogicCMDInfo,nulle;}this.logicCMDMap.clearde;}publicAddVitsdvits:number[]e{ifdvits!=nullethis.vits=vits;}publicUpdateddt:numbere{ifdthis.isPauseereturn;ifdthis.isWaitecc等待期间不执行其他指令{this.waitTime+=dt;return;}this.passTime+=dt;ccifdthis.cmdArray.length==0ecc{ccMagicMgr.GetInstancede.DestoryMagicdthis.actide;ccreturn;cc}letcmdObj:MagicCMDInfo;fordleti=0;iathis.whileCmdArray.length;i++ecc条件指令每帧检查一次{cmdObj=this.whileCmdArray[i];ifdcmdObj.whileAction==nullecontinue;ifdthis.passTimeacmdObj.timeecontinue;ifdcmdObj.ExecdthiseecmdObj.whileAction=null;}ccgame.logdnowTime,"_____updatemagic__________",this.waitTime,"___________",this.actide;whiledthis.cmdArray.lengthb0e{cmdObj=this.cmdArray[0];ifdthis.passTimeb=cmdObj.timee{this.ExcuteCMDdcmdObje;this.cmdArray.shiftde;ifdcmdObj.whileAction==nulleECS.WarFactory.DestroyObjectdcmdObj,ObjectType.MagicCMDInfo,nulle;ifdthis.isWaitereturn;}elsereturn;}MagicMgr.GetInstancede.DestoryMagicdthis.actide;}publicExcuteCMDdcmdObj:MagicCMDInfoe{cmdObj.Execdthise;cccmdObj.actiondthise;}privateGetIdsBySigndsign:stringe:Arrayanumberb{ifdsign==MagicSign.Atte{letarray=newArrayanumberbde;array.pushdthis.attIDe;returnarray;}elseifdsign==MagicSign.Vite{returnthis.vits;}elseifdsign==MagicSign.OneVite{letarray=newArrayanumberbde;ifdthis.vits.lengthb0earray.pushdthis.vits[0]e;returnarray;}elseifdsign==MagicSign.Alle{letarray=newArrayanumberbde;fordletidofthis.vitse{array.pushdide;}array.pushdthis.attIDe;returnarray;}returnnewArrayanumberbde;}privateGetObjectBySigndsign:stringe:Arrayaanyb{letobjectArray:Arrayaanyb=newArrayaanybde;letobj:any;ifdsign==MagicSign.Atte{obj=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdthis.attIDe;ifdobj!=nulleobjectArray.pushdobje;}elseifdsign==MagicSign.Vite{fordletidofthis.vitse{obj=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdide;ifdobj!=nulleobjectArray.pushdobje;}}elseifdsign==MagicSign.OneVite{fordletidofthis.vitse{obj=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdide;ifdobj!=nulleobjectArray.pushdobje;break;}}elseifdsign==MagicSign.Alle{fordletidofthis.vitse{obj=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdide;ifdobj!=nulleobjectArray.pushdobje;}obj=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdthis.attIDe;ifdobj!=nulleobjectArray.pushdobje;}returnobjectArray;}privateGetPosBySigndsign:string,boneName:stringe:Vector2[]{ifdsign==MagicSign.StartPosereturn[this.fromPos];elseifdsign==MagicSign.EndPosereturn[this.toPos];else{letobjArray:HeroBase[]=this.GetObjectBySigndsigne;letposArray:Vector2[]=[];fordletobjofobjArraye{letpos:Vector2=obj.GetPosde;letoffset=obj.GetBonePosdboneNamee;ifdoffset[0]!=0||offset[1]!=0epos=newVector2d[pos.x+offset[0],pos.y+offset[1]]e;posArray.pushdpose;}returnposArray;}}privateRecordOrginAttrdid:number,attrType:number,value:anye{letoriginAttrs=this.originAttrs;ifd!originAttrs.hasdideeoriginAttrs.setdid,newSMapanumber,anybdee;letattrs=originAttrs.getdide;ifd!attrs.hasdattrTypeee{attrs.setdattrType,valuee;}}publicWhileBegindtype:number,value:anye:boolean{ifdtype==1ecc受击者数目bvalue{returnthis.vits.lengthb=value;}returnfalse;}publicWhileEndde{}publicSetAnimStatedsign:string,state:number,time:numbere{time=time==null?0:time;letobjectArray=this.GetObjectBySigndsigne;ccgame.logdthis.actid,"____MagicMgr.SetAnimState_______",egret.getTimerdee;fordletgameObjectofobjectArraye{gameObject.SetAniSpeeddstate,this.attackSpeedUp,timee;gameObject.SetAnimStatedstate,-1,0e;}}publicVitHurtdsign:stringe{ccletobjectArray=this.GetObjectBySigndsigne;ccccgame.logdthis.actid,"____MagicMgr.SetAnimState_______",egret.getTimerdee;ccfordletgameObjectofobjectArrayecc{ccWarNumber.GetInstancede.BeHurtdgameObject.id,this.actid,this.pfide;cc}}publicShowHPBardsign:stringe{letidArray=this.GetIdsBySigndsigne;fordletidofidArraye{letentity=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetHerodide;ifdentity==nullecontinue;letheroData=aHeroDataComponentbentity.GetCompdRenderComponentType.HeroDataComponente;ifdheroData==nullecontinue;letgameObject=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdide;ifdgameObject==nullecontinue;ifdheroData.shieldb0egameObject.SetHPdheroData.shield,heroData.shieldmaxe;elsegameObject.SetHPdheroData.hp,heroData.hpmaxe;}}privateCreateEffectdeffectID:number,parent:any,x:number,y:number,boneName:stringe:any{leteffectObj=game.RenderUtils.CreateEffectdSceneTypeConst.War,effectIDe;effectObj.id=IDManager.NewKeyIDde;effectObj.Initde;parent.addChilddeffectObje;effectObj.SetPosdx,ye;this.effectObjs.setdeffectObj.id,effectObje;returneffectObj;}privateSetEffectCachedkey:string,effectObj:anye{ifdkey==null||key==""ereturn;ifd!this.effectCache.hasdkeyeethis.effectCache.setdkey,newArrayaanybdee;this.effectCache.getdkeye.pushdeffectObje;}publicSetEffectTimedkey:string,time:numbere{leteffectArray:EffectBase[]=this.GetEffectByKeydkeye;fordleteffectObjofeffectArraye{effectObj.PlayEffectByTimedeffectObj.aniLabel,timecthis.attackSpeedUp,effectObj.counte;}}publicCreateEffectOnMapdeffectID:number,sign:string,dx:number,dy:number,boneName:string,key:string,posType:numbere{letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdwarComp!=null&&warComp.IsReversePosde&&posType==2e{dx=-dx;dy=-dy;}letposArray=this.GetPosBySigndsign,boneNamee;fordletposofposArraye{leteffectObj=this.CreateEffectdeffectID,ECSC.RenderWarUtil.GetWarMapde,pos.x+dx,pos.y+dy,boneNamee;this.SetEffectCachedkey,effectObje;}}publicCreateEffectOnHerodeffectID:number,sign:string,dx:number,dy:number,boneName:string,key:string,posType:numbere{letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdwarComp!=null&&warComp.IsReversePosde&&posType==2e{dx=-dx;dy=-dy;}letobjectArray=this.GetObjectBySigndsigne;fordletgameObjectofobjectArraye{letoffset=gameObject.GetBonePosdboneNamee;leteffectObj=this.CreateEffectdeffectID,gameObject,dx+offset[0],dy+offset[1],boneNamee;this.SetEffectCachedkey,effectObje;}}publicCreateEffectWithPosdeffectID:number,x:number,y:number,key:stringe{leteffectObj=this.CreateEffectdeffectID,ECSC.RenderWarUtil.GetWarMapde,x,y,""e;this.SetEffectCachedkey,effectObje;}publicSetHeroInCachedsign:string,key:stringe{this.heroCache.setdkey,signe;}privateGetEffectByKeydkey:stringe:any[]{ifdthis.effectCache.hasdkeyeereturnthis.effectCache.getdkeye;ifdthis.heroCache.hasdkeyee{letsign=this.heroCache.getdkeye;letobjectArray=this.GetObjectBySigndsigne;returnobjectArray;}returnnewArrayaanybde;}cc等待飞行结束publicWaitMoveOverdkey:stringe{leteffectArray=this.GetEffectByKeydkeye;fordleteffectObjofeffectArraye{this.WaitServerde;letisSuccess=MoveRenderMgr.GetInstancede.AddOnOnverCBdeffectObj,this.StopWait,thise;ifd!isSuccessethis.StopWaitde;break;}}cc等待逻辑层指令publicWaitLogicCMDdkey:stringe{this.WaitServerde;this.AddLogicCMDdkey,null,this.StopWait,falsee;}cc曲线移动ccmoveType11:FixedSpeedToTarget12:FixedTimeToTarget21:FixedSpeedToPos22:FixedTimeToPoscctimeOrSpeed如果是时间单位为毫秒如果是速度单位为像素c秒一个格子的像素大小为30ccbaseDis计算抛物线高度的基础距离publicCurveMovedkey:string,sign:string,timeOrSpeed:number,dx:number,dy:number,baseDis:number,moveType:numbere{cctime=timecthis.attackSpeedUp;lettargetPos:Vector2;lettargetObj:HeroBase;ifdmoveType==EffectMoveType.FixedSpeedToTarget||moveType==EffectMoveType.FixedTimeToTargetecc飞向目标{letobjArray=this.GetObjectBySigndsigne;targetObj=objArray[0];ifdtargetObj==nullecc找不到追踪目标{game.errord"MagicMgrCurveMovetargetObjisnull:",this.pfide;return;}}else{letposArray=this.GetPosBySigndsign,nulle;targetPos=posArray[0];ifdtargetPos==nullecc找不到目标点{game.errord"MagicMgrCurveMovetargetPosisnull:",this.pfide;return;}}cc固定速度飞行ifdmoveType==EffectMoveType.FixedSpeedToTarget||moveType==EffectMoveType.FixedSpeedToPose{ifdtimeOrSpeed==0ecc速度为0就都表{timeOrSpeed=game.DataUtil.GetValueByKeyd"skilldata_json",this.pfid,0,"flyspeed"e;ifdtimeOrSpeed==0||timeOrSpeed==nulle{game.errord"skilldataflyspeederror:",this.pfide;timeOrSpeed=150;}}}leteffectArray=this.GetEffectByKeydkeye;fordleteffectObjofeffectArraye{letmoveInfo:MoveInfo;ifdmoveType==EffectMoveType.FixedSpeedToTarget||moveType==EffectMoveType.FixedTimeToTargetecc飞向目标{ifdeffectObj.campType==CampType.Friendecc攻击方和防守方偏移是相反的moveInfo=MoveRenderMgr.GetInstancede.CurveToTargetdeffectObj,targetObj,timeOrSpeed,0,dx,dy,baseDis,moveTypee;elsemoveInfo=MoveRenderMgr.GetInstancede.CurveToTargetdeffectObj,targetObj,timeOrSpeed,0,-dx,dy,baseDis,moveTypee;}else{ifdeffectObj.campType==CampType.Friendecc攻击方和防守方偏移是相反的moveInfo=MoveRenderMgr.GetInstancede.CurveToPosdeffectObj,targetPos.x,targetPos.y,timeOrSpeed,0,dx,dy,baseDis,moveTypee;elsemoveInfo=MoveRenderMgr.GetInstancede.CurveToPosdeffectObj,targetPos.x,targetPos.y,timeOrSpeed,0,-dx,dy,baseDis,moveTypee;}moveInfo.pfid=this.pfid;this.moveObjMap.setdeffectObj.id,effectObje;}}cc直线移动ccmoveType11:FixedSpeedToTarget12:FixedTimeToTarget21:FixedSpeedToPos22:FixedTimeToPoscctimeOrSpeed如果是时间单位为毫秒如果是速度单位为像素c秒一个格子的像素大小为30publicStraightMovedkey:string,sign:string,timeOrSpeed:number,dx:number,dy:number,angle:number,moveType:numbere{cctime=timecthis.attackSpeedUp;lettargetPos:Vector2;lettargetObj:HeroBase;ifdmoveType==EffectMoveType.FixedSpeedToTarget||moveType==EffectMoveType.FixedTimeToTargetecc飞向目标{letobjArray=this.GetObjectBySigndsigne;targetObj=objArray[0];ifdtargetObj==nullecc找不到追踪目标{game.errord"MagicMgrCurveMovetargetObjisnull:",this.pfide;return;}}else{letposArray=this.GetPosBySigndsign,nulle;targetPos=posArray[0];ifdtargetPos==nullecc找不到目标点{game.errord"MagicMgrCurveMovetargetPosisnull:",this.pfide;return;}}leteffectArray=this.GetEffectByKeydkeye;fordleteffectObjofeffectArraye{letmoveInfo:MoveInfo;ifdmoveType==EffectMoveType.FixedSpeedToTarget||moveType==EffectMoveType.FixedTimeToTargetecc飞向目标{ifdeffectObj.campType==CampType.Friendecc攻击方和防守方偏移是相反的moveInfo=MoveRenderMgr.GetInstancede.StraightToTargetdeffectObj,targetObj,timeOrSpeed,0,dx,dy,moveTypee;elsemoveInfo=MoveRenderMgr.GetInstancede.StraightToTargetdeffectObj,targetObj,timeOrSpeed,0,-dx,dy,moveTypee;}else{ifdangle!=0e{letepos=effectObj.GetPosde;let[tx,ty]=MathUtil.RotatePointdtargetPos.x,targetPos.y,epos.x,epos.y,anglee;targetPos.x=tx;targetPos.y=ty;}ifdeffectObj.campType==CampType.Friendecc攻击方和防守方偏移是相反的moveInfo=MoveRenderMgr.GetInstancede.StraightToPosdeffectObj,targetPos.x,targetPos.y,timeOrSpeed,0,dx,dy,moveTypee;elsemoveInfo=MoveRenderMgr.GetInstancede.StraightToPosdeffectObj,targetPos.x,targetPos.y,timeOrSpeed,0,-dx,dy,moveTypee;}moveInfo.pfid=this.pfid;this.moveObjMap.setdeffectObj.id,effectObje;}}cctween公式移动publicTweenMovedkey:string,sign:string,dx:number,dy:number,time:number,tweenType:number,posType:numbere{cctime=timecthis.attackSpeedUp;letobjectArray=this.GetObjectBySigndsigne;ifdobjectArray.length==0ereturn;letpos=objectArray[0].GetShowPosde;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdwarComp!=null&&warComp.IsReversePosde&&posType==2e{dx=-dx;dy=-dy;}leteffectArray=this.GetEffectByKeydkeye;fordletobjofeffectArraye{MoveRenderMgr.GetInstancede.TweenMovedobj,pos.x+dx,pos.y+dy,time,tweenTypee;this.moveObjMap.setdobj.id,obje;}}publicDestroyEffectdkey:stringe{ifd!this.effectCache.hasdkeyeereturn;fordleteffectObjofthis.effectCache.getdkeyee{this.effectObjs.deletedeffectObj.ide;game.RenderUtils.DestroyEffectdSceneTypeConst.War,effectObje;}this.effectCache.deletedkeye;}publicWaitServerde{this.isWait=true;this.waitTime=0;}publicStopWaitde{this.isWait=false;}publicPauseSkilldisPause:booleane{this.isPause=isPause;letattObj=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdthis.attIDe;ifdattObj!=nulle{attObj.PausedisPausee;}}publicAddLogicCMDdkey:string,value:any,func:Function,isReached:booleane{letlogicCmdInfo:LogicCMDInfo;ifd!this.logicCMDMap.hasdkeyee{logicCmdInfo=ECS.WarFactory.CreateObjectdObjectType.LogicCMDInfo,null,nulle;logicCmdInfo.key=key;logicCmdInfo.value=value;this.logicCMDMap.setdkey,logicCmdInfoe;}logicCmdInfo=this.logicCMDMap.getdkeye;logicCmdInfo.AddFuncdfunc,this,isReachede;}publicSetAlphadsign:string,alpha:numbere{letobjectArray=this.GetObjectBySigndsigne;ifdobjectArray.length==0ereturn;fordletobjofobjectArraye{this.RecordOrginAttrdobj.id,MagicAttrType.Alpha,obj.GetAlphadee;ccgame.logd"------MagicMgr.SetAlpha-------",alpha,this.actid,this.pfid,this.attID,"id:",obj.ide;obj.SetAlphadalphae;}}publicSetScaledsign:string,sx:number,sy:numbere{letobjectArray=this.GetObjectBySigndsigne;ifdobjectArray.length==0ereturn;fordletobjofobjectArraye{letscaleVec=obj.GetScalede;this.RecordOrginAttrdobj.id,MagicAttrType.Scale,[scaleVec.x,scaleVec.y]e;obj.SetScaledsx,sye;}}publicSetPosdsign:string,targetSign:string,dx:number,dy:number,posType:numbere{letobjectArray=this.GetObjectBySigndsigne;ifdobjectArray.length==0ereturn;lettargetArray=this.GetObjectBySigndtargetSigne;ifdtargetArray.length==0ereturn;lettargetObj=targetArray[0];fordletobjofobjectArraye{ifdposType==1ecc逻辑坐标{letpos=obj.GetPosde;this.RecordOrginAttrdobj.id,MagicAttrType.LogicPos,[pos.x,pos.y]e;lettargetPos=targetObj.GetPosde;obj.SetPosdtargetPos.x+dx,targetPos.y+dye;}elsecc显示坐标{letpos=obj.GetShowPosde;this.RecordOrginAttrdobj.id,MagicAttrType.ShowPos,[pos.x,pos.y]e;lettargetPos=targetObj.GetShowPosde;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdwarComp!=null&&warComp.IsReversePosdee{dx=-dx;dy=-dy;}obj.SetShowPosdtargetPos.x+dx,targetPos.y+dye;}}}publicFaceTodsign1:string,sign2:stringe{letattObjs=this.GetObjectBySigndsign1e;letvitObjs=this.GetObjectBySigndsign2e;ifdattObjs.lengthb0&&vitObjs.lengthb0e{letattPos=attObjs[0].GetPosde;letvitPos=vitObjs[0].GetPosde;letdir=Vector2.directiondvitPos,attPose;attObjs[0].SetAniAngleddir.anglede+90e;}}publicCallFuncdfuncName:string,args1:any,args2:any,args3:any,args4:anye{}publicEndde{}publicPlaySounddname:string,value:numbere{SoundManager.Insde.PlayEffectdnamee;}publicShakeScreendnumberOfShakes:number,cc震动次数xRange:number,yRange:number,ccx,y轴的震动量级rotationAmount:number,cc旋转量级speed:number,cc如果速度越快，则振幅越剧烈decay:numbercc振幅的递减系数e{letmapObj=game.GameSceneLayer.gameLayerde;ifdmapObj==nullereturn;ShakeTools.GetInstancede.DoShakedmapObj,numberOfShakes,newegret.Pointd0.5,0.5e,newegret.PointdxRange,yRangee,rotationAmount,1,speed,decaye;}cc变身publicChangeHeroViewdsign:string,shape:numbere{letobjectArray:HeroBase[]=this.GetObjectBySigndsigne;ifdobjectArray.length==0ereturn;fordletobjofobjectArraye{obj.ChangeViewdshapee;this.RecordOrginAttrdobj.id,MagicAttrType.View,1e;}}}}﻿moduleECSC{exportclassMoveInfo{publicobj:any;publicstartPos:Vector2=newVector2de;publictarget:any;publictargetPos:Vector2=newVector2de;publicmoveTime:number;publicmindis:number;publicoffsetx:number;publicoffsety:number;publicmoveType:number;cc公主的弓箭飞向目标所在位置d不追踪目标e落地后造成AOEpublicstartTime:number;publicpassTime:number;publicstartSpeed:number;cc初速度publicaccSpeed:number;cc加速度publicmoveFunc:Function;publiconOverFunc:Function;publiconOverThisObj:any;privateisFirstMove=false;privatemidPos:Vector2;cc抛物线的中间值publicbaseDis:number=50;cc抛物线高度为30再根据实际距离除以基础距离得到高度倍数publicpfid:number;publicconstructorde{this.moveType=EffectMoveType.FixedTimeToTarget;}privateIsToPosde:boolean{returnthis.moveType==EffectMoveType.FixedSpeedToPos||this.moveType==EffectMoveType.FixedTimeToPos;}privateIsToTargetde:boolean{returnthis.moveType==EffectMoveType.FixedSpeedToTarget||this.moveType==EffectMoveType.FixedTimeToTarget;}publicInitde{this.isFirstMove=false;this.passTime=0;ifdthis.IsToPosde&&this.target!=nullecc如果是飞向固定位置{letpos:Vector2=this.target.GetPosde;pos.copydthis.targetPose;}cc固定速度飞行的话需要重新计算时间ifdthis.moveType==EffectMoveType.FixedSpeedToPose{letspeed=this.moveTime;letdis=MathUtil.distancedthis.targetPos,this.startPose;this.moveTime=discspeed*1000;}cc固定速度飞行的话需要重新计算时间ifdthis.moveType==EffectMoveType.FixedSpeedToTargete{ifdthis.target!=nulle{letspeed=this.moveTime;letpos:Vector2=this.target.GetPosde;letdis=MathUtil.distancedpos,this.startPose;this.moveTime=discspeed*1000;}}}publicDisposede{this.obj=null;this.target=null;this.moveFunc=null;this.onOverFunc=null;this.onOverThisObj=null;}privateOnOnverde{ifdthis.onOverFunc!=nulle{this.onOverFunc.calldthis.onOverThisObje;this.onOverFunc=null;this.onOverThisObj=null;}}publicUpdateddt:numbere{ifdthis.moveFunc!=nulle{this.moveFunc.calldthis,dte;}else{}}cc匀速直线运动publicFixedSpeedStraightMoveddt:numbere{letnowPos=this.obj.GetPosde;this.passTime+=dt;cc飞向目标ifdthis.IsToTargetde&&this.target==nulle{game.errord"-------FixedSpeedStraightMoveToTargetandtargetisnull-----------",this.pfide;this.OnOnverde;MoveRenderMgr.GetInstancede.RemoveMoveInfodthis.obje;return;}letstartPos=this.startPos;lettargetPos=this.targetPos;ifdthis.IsToTargetdeetargetPos=this.target.GetPosde;letobj:EffectBase=this.obj;ifdthis.passTimeb=this.moveTimee{obj.SetPosdtargetPos.x+this.offsetx,targetPos.y+this.offsetye;this.OnOnverde;MoveRenderMgr.GetInstancede.RemoveMoveInfodobje;return;}lett=this.passTimecthis.moveTime;letx=startPos.x+t*dtargetPos.x+this.offsetx-startPos.xe;lety=startPos.y+t*dtargetPos.y+this.offsety-startPos.ye;obj.SetPosdx,ye;t=dthis.passTime+dtecthis.moveTime;cc模拟下一帧的位置letx1=startPos.x+t*dtargetPos.x+this.offsetx-startPos.xe;lety1=startPos.y+t*dtargetPos.y+this.offsety-startPos.ye;letdx:number=x1-x;letdy:number=y1-y;letangle=Math.atan2ddy,dxe;letrotation=angle*180cMath.PI;ccobj.SetLogicAngledrotatione;obj.SetAngledrotatione;ccletframeIndex=11-Math.floordt*11e;ccobj.GotoAndStopdframeIndexe;obj.GotoAndStopdobj.aniLabel,4e;}cc抛物线移动publicCurveMoveddt:numbere{letobj:EffectBase=this.obj;this.passTime+=dt;ifdthis.IsToTargetde&&this.target==nulle{game.errord"-------CurveMoveToTargetandtargetisnull-----------",this.pfide;this.OnOnverde;MoveRenderMgr.GetInstancede.RemoveMoveInfodobje;return;}lettargetPos=this.targetPos;letstartPos=this.startPos;ifdthis.IsToTargetdeetargetPos=this.target.GetPosde;ifdthis.passTimeb=this.moveTimee{obj.SetPosdtargetPos.x,targetPos.ye;this.OnOnverde;MoveRenderMgr.GetInstancede.RemoveMoveInfodobje;return;}ifd!this.isFirstMovee{this.isFirstMove=true;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdwarComp!=null&&warComp.IsReversePosdeethis.midPos=MathUtil.getCurveFuncdstartPos,targetPos,-this.baseDise;elsethis.midPos=MathUtil.getCurveFuncdstartPos,targetPos,this.baseDise;}letmidPos=this.midPos;lett=this.passTimecthis.moveTime;letx=d1-te*d1-te*startPos.x+2*t*d1-te*midPos.x+t*t*targetPos.x;lety=d1-te*d1-te*startPos.y+2*t*d1-te*midPos.y+t*t*targetPos.y;ccgame.logdx.toFixedd2e,y.toFixedd2e,"____________________",targetPos.tostringde,"_______",passTime,this.moveTimee;obj.SetPosdx,ye;t=dthis.passTime+dtecthis.moveTime;cc模拟下一帧的位置letx1=d1-te*d1-te*startPos.x+2*t*d1-te*midPos.x+t*t*targetPos.x;lety1=d1-te*d1-te*startPos.y+2*t*d1-te*midPos.y+t*t*targetPos.y;letdx:number=x1-x;letdy:number=y1-y;letangle=Math.atan2ddy,dxe;letrotation=angle*180cMath.PI;letlastAngle=obj.rotation;ccobj.SetLogicAngledrotatione;obj.SetAngledrotatione;letframeIndex=11-Math.floordt*11e;obj.GotoAndStopdobj.aniLabel,frameIndexe;ccgame.logd"------------rotation:",Math.floordrotatione,frameIndexe;}cc变速直线运动publicAccSpeedStraightMoveddt:numbere{letnowPos=this.obj.GetPosde;this.passTime+=dt;letleftTime=this.moveTime-this.passTime;ifdthis.IsToTargetde&&this.target==nulle{game.errord"-------AccSpeedStraightMoveToTargetandtargetisnull-----------",this.pfide;this.OnOnverde;MoveRenderMgr.GetInstancede.RemoveMoveInfodthis.obje;return;}lettargetPos=this.targetPos;letstartPos=this.startPos;ifdthis.IsToTargetdeetargetPos=this.target.GetPosde;letobj:SpriteBase=this.obj;ifdleftTimea=0e{this.OnOnverde;MoveRenderMgr.GetInstancede.RemoveMoveInfodobje;return;}ifdthis.passTimeb=this.moveTimee{this.OnOnverde;MoveRenderMgr.GetInstancede.RemoveMoveInfodobje;return;}lett=this.passTimec1000;ccx=0.5*a*t*t+v0*tletmoveDis=0.5*this.accSpeed*t*t+this.startSpeed*t;letdir=Vector2.directiondtargetPos,startPose;letx=startPos.x+dir.x*moveDis;lety=startPos.y+dir.y*moveDis;ifdxbMathConst.MapPosMaxX||xa0||ybMathConst.MapPosMaxY||ya0e{this.OnOnverde;MoveRenderMgr.GetInstancede.RemoveMoveInfodobje;return;}ccgame.logdx,y,"-------------AccSpeedStraightMove---------------",this.passTime,this.moveTimee;obj.SetPosdx,ye;}}}﻿moduleECSC{exportclassMoveRenderMgr{privatestaticinstance:MoveRenderMgr;publicstaticGetInstancede:MoveRenderMgr{returnMoveRenderMgr.instance;}publicstaticInitInstancede{ifdMoveRenderMgr.instance==nulleMoveRenderMgr.instance=newMoveRenderMgrde;}publicstaticDestroyInstancede{ifdMoveRenderMgr.instance!=nulleMoveRenderMgr.instance.Disposede;MoveRenderMgr.instance=null;}cc自定义移动publicrenderArray:any[];publicmoveInfoDict:SMapaany,MoveInfob;publicconstructorde{this.renderArray=newArrayaanybde;this.moveInfoDict=newSMapaany,MoveInfobde;}publicDisposede{this.renderArray.length=0;letvalues=this.moveInfoDict.valuesde;fordletvalueofvaluese{ECS.WarFactory.DestroyObjectdvalue,ObjectType.MoveInfo,nulle;}this.moveInfoDict.clearde;}publicAddRenderObjectdobj:anye{letindex=this.renderArray.indexOfdobje;ifdindexa=-1ethis.renderArray.pushdobje;}publicRemoveRenderObjectdobj:anye{letindex=this.renderArray.indexOfdobje;ifdindexb-1e{this.renderArray.splicedindex,1e;}}publicRemoveMoveInfodobj:anye{ifdthis.moveInfoDict.hasdobjee{letmoveInfo=this.moveInfoDict.getdobje;ECS.WarFactory.DestroyObjectdmoveInfo,ObjectType.MoveInfo,nulle;this.moveInfoDict.deletedobje;}TweenLite.killTweensOfdobje;}publicStraightToPosdobj:any,posx:number,posy:number,timeOrSpeed:number,mindis:number,dx:number,dy:number,moveType:numbere:MoveInfo{this.RemoveMoveInfodobje;letmoveInfo=aMoveInfobECS.WarFactory.CreateObjectdObjectType.MoveInfo,null,nulle;letstartPos=obj.GetPosde;moveInfo.obj=obj;moveInfo.startPos.x=startPos.x;moveInfo.startPos.y=startPos.y;moveInfo.targetPos.x=posx;moveInfo.targetPos.y=posy;moveInfo.moveTime=timeOrSpeed;moveInfo.mindis=mindis;moveInfo.offsetx=dx;moveInfo.offsety=dy;moveInfo.moveFunc=moveInfo.FixedSpeedStraightMove;moveInfo.startTime=egret.getTimerde;moveInfo.moveType=moveType;moveInfo.Initde;this.moveInfoDict.setdobj,moveInfoe;returnmoveInfo;}publicStraightToTargetdobj:any,target:any,timeOrSpeed:number,mindis:number,dx:number,dy:number,moveType:numbere:MoveInfo{this.RemoveMoveInfodobje;letmoveInfo=aMoveInfobECS.WarFactory.CreateObjectdObjectType.MoveInfo,null,nulle;letstartPos=obj.GetPosde;moveInfo.obj=obj;moveInfo.startPos.x=startPos.x;moveInfo.startPos.y=startPos.y;moveInfo.target=target;moveInfo.moveTime=timeOrSpeed;moveInfo.mindis=mindis;moveInfo.offsetx=dx;moveInfo.offsety=dy;moveInfo.moveFunc=moveInfo.FixedSpeedStraightMove;moveInfo.startTime=egret.getTimerde;moveInfo.moveType=moveType;moveInfo.Initde;this.moveInfoDict.setdobj,moveInfoe;returnmoveInfo;}publicCurveToPosdobj:any,posx:number,posy:number,timeOrSpeed:number,mindis:number,dx:number,dy:number,baseDis:number,moveType:numbere:MoveInfo{this.RemoveMoveInfodobje;letmoveInfo=aMoveInfobECS.WarFactory.CreateObjectdObjectType.MoveInfo,null,nulle;letstartPos=obj.GetPosde;moveInfo.obj=obj;moveInfo.startPos.x=startPos.x;moveInfo.startPos.y=startPos.y;moveInfo.targetPos.x=posx;moveInfo.targetPos.y=posy;moveInfo.moveTime=timeOrSpeed;moveInfo.mindis=mindis;moveInfo.offsetx=dx;moveInfo.offsety=dy;moveInfo.moveFunc=moveInfo.CurveMove;moveInfo.startTime=egret.getTimerde;moveInfo.moveType=moveType;moveInfo.baseDis=baseDis;moveInfo.Initde;this.moveInfoDict.setdobj,moveInfoe;returnmoveInfo;}publicCurveToTargetdobj:any,target:any,timeOrSpeed:number,mindis:number,dx:number,dy:number,baseDis:number,moveType:numbere:MoveInfo{this.RemoveMoveInfodobje;letmoveInfo=aMoveInfobECS.WarFactory.CreateObjectdObjectType.MoveInfo,null,nulle;letstartPos=obj.GetPosde;moveInfo.obj=obj;moveInfo.startPos.x=startPos.x;moveInfo.startPos.y=startPos.y;moveInfo.target=target;moveInfo.moveTime=timeOrSpeed;moveInfo.mindis=mindis;moveInfo.offsetx=dx;moveInfo.offsety=dy;moveInfo.moveFunc=moveInfo.CurveMove;moveInfo.startTime=egret.getTimerde;moveInfo.moveType=moveType;moveInfo.baseDis=baseDis;moveInfo.Initde;this.moveInfoDict.setdobj,moveInfoe;returnmoveInfo;}publicAcccMoveStraightToPosdobj:any,posx:number,posy:number,startSpeed:number,accSpeed:number,time:numbere:MoveInfo{this.RemoveMoveInfodobje;letmoveInfo=aMoveInfobECS.WarFactory.CreateObjectdObjectType.MoveInfo,null,nulle;letstartPos=obj.GetPosde;moveInfo.obj=obj;moveInfo.startPos.x=startPos.x;moveInfo.startPos.y=startPos.y;moveInfo.targetPos.x=posx;moveInfo.targetPos.y=posy;moveInfo.moveTime=time;moveInfo.mindis=0;moveInfo.moveFunc=moveInfo.AccSpeedStraightMove;moveInfo.startTime=egret.getTimerde;moveInfo.moveType=EffectMoveType.FixedTimeToPos;moveInfo.accSpeed=accSpeed;moveInfo.startSpeed=startSpeed;moveInfo.Initde;this.moveInfoDict.setdobj,moveInfoe;returnmoveInfo;}publicTweenMovedobj:any,posx:number,posy:number,time:number,tweenType:numbere{this.RemoveMoveInfodobje;ifdtweenType==1eTweenLite.todobj,timec1000,{x:posx,y:posy,ease:Power3.easeIn}e.kill;}publicAddOnOnverCBdobj:any,func:Function,thisObj:anye:boolean{letmoveInfo=this.moveInfoDict.getdobje;ifdmoveInfo!=nulle{moveInfo.onOverFunc=func;moveInfo.onOverThisObj=thisObj;returntrue;}returnfalse;}publicUpdateddt:numbere{fordleti=0;iathis.renderArray.length;i++e{this.renderArray[i].Updatede;}letvalues=this.moveInfoDict.valuesde;fordletvalueofvaluese{value.Updateddte;}}}}﻿moduleECSC{exportclassMovieClipBaseextendsegret.MovieClipimplementsRenderInterface{publicid:number;protectedclipName:string;protectedfileName:string;protectedoriginFrameRate:number;cc当前初始的动画播放速度protectedaniSpeedInfo:SMapastring,numberb;cc当前动画的播放速度protectednowAniLable:string;protectednowCount:number;protectednowAniType:string;publiclabelInfo:SMapastring,egret.FrameLabelb;publicconstructorde{superde;this.id=0;}publicSetClipNamed_fileName:string,_clipName:stringe{this.clipName=_clipName;this.fileName=_fileName;}publicInitde:void{letmcf:egret.MovieClipDataFactory=EffectPool.GetInstancede.GetMovieClipdthis.fileNamee;this.movieClipData=mcf.generateMovieClipDatadthis.clipNamee;this.labelInfo=newSMapastring,egret.FrameLabelbde;ifdthis.movieClipData!=null&&this.movieClipData.labels!=nulle{letlabels:egret.FrameLabel[]=this.movieClipData.labels;fordletfloflabelse{this.labelInfo.setdfl.name,fle;}}else{game.errord"-------------this.clipName--isnull------------",this.clipNamee;}this.originFrameRate=this.frameRate;this.aniSpeedInfo=newSMapastring,numberbde;this.removeEventListenerdegret.Event.ADDED_TO_STAGE,this.OnAddToStage,thise;this.addEventListenerdegret.Event.ADDED_TO_STAGE,this.OnAddToStage,thise;ccletcolorMatrix=[cc1,0,0,0,0,cc0,0,0,0,0,cc0,0,1,0,0,cc0,0,0,1,0cc];ccletcolorFilter=newegret.ColorMatrixFilterdcolorMatrixe;ccthis.filters=[colorFilter];}protectedOnAddToStagedevent:egret.Evente{ifdthis.nowAniLable!=nulle{this.Playdthis.nowAniLable,this.nowCount,this.nowAniTypee;}}publicGetRotateTypedangle:numbere:number{return0;}publicGetScaleXdangle:numbere:number{return1;}publicDisposede:void{ifdthis.aniSpeedInfo!=nulle{this.aniSpeedInfo.clearde;this.aniSpeedInfo=null;}ifdthis.labelInfo!=nullethis.labelInfo.clearde;this.removeEventListenerdegret.Event.ADDED_TO_STAGE,this.OnAddToStage,thise;game.RenderUtils.RemoveFromParentdthise;}publicSetAnimStatedstate:number,angle:number,campType:numbere:void{ifdstate==AnimState.Idlee{this.PlaydMathConst.IdelLabel,1,MathConst.IdelLabel,nulle;cc从头播放}}publicSetAniSpeeddstate:number,speed:number,time:number=0e{}publicSetPosdx:number,y:numbere:void{this.x=x;this.y=y;}ccprivate_x:number=0;ccpublicgetxde:numbercc{ccreturnthis._x;cc}ccpublicsetxd_xecc{ccthis._x=_x;cc}ccprivate_y:number=0;ccpublicgetyde:numbercc{ccreturnthis._y;cc}ccpublicsetyd_yecc{ccgame.logd"-------------------------y:",_y,newErrorde.stacke;ccthis._y=_y;cc}publicGetPosde:Vector2{returnnewVector2d[this.x,this.y]e;}publicSetAngledangle:numbere:void{this.rotation=angle;}publicGetAnglede:number{returnthis.rotation;}publicSetScaledsx:number,sy:numbere:void{this.scaleX=sx;this.scaleY=sy;}publicGetScalede:Vector2{returnnewVector2d[this.scaleX,this.scaleY]e;}publicSetAlphadalpha:numbere{this.alpha=alpha;}publicGetAlphade:number{returnthis.alpha;}cc播放publicPlaydaniLable:string,count:number,anitype:string,lastAniLabe:string=nulle{ccifdlable=="idle"eccgame.logdegret.getTimerde,"_________Play_____________",lablee;this.nowAniLable=aniLable;this.nowCount=count;this.nowAniType=anitype;ifdthis.stage==nullereturn;ifd!this.labelInfo.hasdaniLableee{game.errord"MovieClipPlayError:",aniLable,counte;return;}anitype=anitype?anitype:aniLable;ifd!this.aniSpeedInfo.hasdanitypeeethis.aniSpeedInfo.setdanitype,1e;letspeed=this.aniSpeedInfo.getdanitypee;letupdateSpeed=ECSC.RenderWarUtil.GetUpdateSpeedde;this.frameRate=Math.floordthis.originFrameRate*updateSpeed*speed+0.5e;letnowFrameLabel=this.labelInfo.getdaniLablee;ifdnowFrameLabel.frame==nowFrameLabel.endecc引擎底层本身的问题TODONIU如果某个动作只有一帧的话会播放错乱game.js:3340{this.gotoAndStopdaniLablee;}elseifdlastAniLabe==null||count!=-1e{this.gotoAndPlaydaniLable,counte;ccthis.$frameLabelStart=nowFrameLabel.frame;ccthis.$frameLabelEnd=nowFrameLabel.end;}elsecc如果是同一个循环动作不同方向则从上一个动作的当前帧续播{letbeginFrame=0;letlastFrameLabel=this.labelInfo.getdlastAniLabee;ifdlastFrameLabel!=null&&nowFrameLabel!=nullebeginFrame=nowFrameLabel.frame+this.currentFrame-lastFrameLabel.frame;this.gotoAndStopdaniLablee;this.gotoAndStopdbeginFramee;this.playdcounte;this.$frameLabelStart=nowFrameLabel.frame;this.$frameLabelEnd=nowFrameLabel.end;}ccthis.nowAniLable=null;}publicStopdframe:numbere{this.gotoAndStopdframee;}privateupdateSpeed:number=0;publicUpdateddeltaTime:numbere{letupdateSpeed=ECSC.RenderWarUtil.GetUpdateSpeedde;ifdthis.updateSpeed==updateSpeedereturn;this.updateSpeed=updateSpeed;letanitype=this.nowAniType;letaniLable=this.nowAniLable;anitype=anitype?anitype:aniLable;ifd!this.aniSpeedInfo.hasdanitypeeethis.aniSpeedInfo.setdanitype,1e;letspeed=this.aniSpeedInfo.getdanitypee;letframeRate=Math.floordthis.originFrameRate*updateSpeed*speed+0.5e;ifdthis.frameRate!=frameRateethis.frameRate=frameRate;ccifdthis.id==1018ecc{ccgame.logdthis.currentFrame,"---------------bbbbbbbbbbbbbb",this.currentFrameLabel,"____________",this.currentLabele;cc}}}}﻿moduleECSC{exportclassPreviewCardextendsSpriteBase{publicheroObjArray:HeroBase[];privateeffectArray:ECSC.EffectBase[];publicdelayFrameArray:number[];privatedestoryTimer:number;publiccardID:number;publicheroIdArray:number[];publicconstructordcardData:game.CardDataIteme{superde;this.cardID=0;this.destoryTimer=0;this.heroIdArray=[];this.heroObjArray=[];this.effectArray=[];this.delayFrameArray=[];this.zIndex=1000;}publicInitde{super.Initde;}publicInitAttrdplayerComp:ECSC.RealPlayerComponente{this.atkType=playerComp.atkType;this.campType=playerComp.campType;}publicInitRenderdcardData:game.CardDataItem,playerComp:ECSC.RealPlayerComponente{this.DisposeRenderde;this.heroObjArray=[];this.effectArray=[];letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;this.delayFrameArray=[];ifd!RenderWarUtil.IsSpelldcardData.idee{ifdcardData.previewType==1e{letheroData=agame.HeroDataItembcardData;letmainHeroID:number=0;letheroObj:HeroBase;letsubHeroData;letheroDataMgr=game.MainDataMgr.GetInstancede.heroDataMgr;fordletinfoofheroData.mainheroe{letshape=info[0];letoffsetX=info[1];letoffsetY=info[2];letdelayFrame=info[3];subHeroData=agame.HeroDataItembheroDataMgr.GetHerodshapee;ifdsubHeroData==nulle{game.errord"PreviewCard.InitRender.subHeroDataerror:",shapee;continue;}letlv=cardData.lv;letclipName=subHeroData.clipName;heroObj=ECS.WarFactory.CreateObjectdObjectType.HeroBase,shape,[`hero_${clipName}`]e;heroObj.Initde;ifdwarComp.IsReversePosdee{offsetX=-offsetX;offsetY=-offsetY;}heroObj.SetPosdoffsetX,offsetYe;heroObj.SetLifeBarVisibledfalsee;this.addChilddheroObje;this.heroObjArray.pushdheroObje;this.delayFrameArray.pushddelayFramee;ccgame.logd`----拖拽出来的位置--PreviewCard.InitRender---cardX:${this.x}cardY:${this.y}---offsetX:${offsetX}offsetY:${offsetY}-------`e;}ifdheroObj==nulle{heroObj=ECS.WarFactory.CreateObjectdObjectType.HeroBase,heroData.id,[`hero_${heroData.clipName}`]e;heroObj.Initde;heroObj.SetPosd0,0e;heroObj.SetLifeBarVisibledfalsee;this.addChilddheroObje;this.heroObjArray.pushdheroObje;this.delayFrameArray.pushd0e;}}else{game.errord"PreviewCardInitRendererror:",cardData.previewTypee;}}else{leteffectID=cardData.previewArgs[0];ifdeffectID==nulle{game.errord"PreviewCardeffectIDisnull",cardData.ide;}else{leteffectObj=game.RenderUtils.CreateEffectdSceneTypeConst.War,effectID,0,0e;effectObj.SetPosd0,0e;this.addChilddeffectObje;this.effectArray.pushdeffectObje;}}this.UpdateRenderdplayerCompe;}publicUpdateRenderdplayerComp:ECSC.RealPlayerComponente{letangle=270;ifdplayerComp.atkType==AtkType.Attackeangle=90;fordletheroObjofthis.heroObjArraye{heroObj.SetAniAngledanglee;heroObj.SetAnimStatedAnimState.Idle,-1,0e;}}publicUpdateHeroObjdheroIdArray:number[]e{this.DisposeRenderde;letworldObj=RenderWarUtil.GetWorldObjde;fordletheroIdofheroIdArraye{this.heroIdArray.pushdheroIde;letentity=worldObj.renderHeroManager.GetHerodheroIde;letheroData=aHeroDataComponentbentity.GetCompdRenderComponentType.HeroDataComponente;ifdheroData!=nullethis.delayFrameArray.pushdheroData.delayFramee;elsethis.delayFrameArray.pushd0e;letheroObj:HeroBase=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdheroIde;ifdheroObj!=nulle{this.heroObjArray.pushdheroObje;}}}privateeffectTargetIdArray:number[]=[];publicUpdateRangedcardData:game.CardDataIteme{ifdRenderWarUtil.IsSpelldcardData.ideethis.UpdateSpellRangedcardDatae;elsethis.UpdateHeroWarnRangedcardDatae;}privateUpdateSpellRangedcardData:game.CardDataIteme{letworldObj=RenderWarUtil.GetWorldObjde;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;letmyFightRoleId=warComp.myFightRoleId;letplayerComp=aECSC.RealPlayerComponentbworldObj.GetCompByIDdmyFightRoleId,RenderComponentType.RealPlayerComponente;letspellComp=aECSC.SpellComponentbworldObj.GetCompByIDdmyFightRoleId,RenderComponentType.SpellComponente;letskillTemplate=spellComp.GetSkillDataTemplatedcardData.ide;ifdskillTemplate==nulle{game.errord"UpdateSpellRangeGetSkillDataTemplateerror:",cardData.ide;return;}lettargetArray=worldObj.renderHeroManager.GetAllTargetdskillTemplate.enemyType,playerComp.campType,falsee;letspellData=agame.SpellDataItembcardData;letthisObj=this;letnowPos=this.GetPosde;cc圆形区域范围过滤functioncircleTransFilterdtargetTrans:TransformComponent,targetData:HeroDataComponente:boolean{letradius=spellData.rangeArgs[0];letdis=MathUtil.squaredDistancednowPos,targetTrans.pose;radius=radius+targetTrans.range;cc半径为区域半径+角色本身的半径ifddisa=radius*radiuse{targetData.toTargetDis=dis;cc记录距离后面排序用的returntrue;}returnfalse;}cc矩形区域范围过滤functionrectTransFilterdtargetTrans:TransformComponent,targetData:HeroDataComponente:boolean{letwidth=spellData.rangeArgs[0];letheight=spellData.rangeArgs[1];letx1=nowPos.x;lety1=nowPos.y-heightc2;letx2=nowPos.x+heightc2;lety2=nowPos.y;cc矩形区域和角色本身的圆形区域碰撞检测letisCollide=MathUtil.IsCircleIntersectRectangledtargetTrans.pos.x,targetTrans.pos.y,targetTrans.range,nowPos.x,nowPos.y,x1,y1,x2,y2,thisObj.width,thisObj.heighte;returnisCollide;}letlandTypeArray=skillTemplate.landTypeArray;letheroTypeArray=skillTemplate.heroTypeArray;cc属性过滤functionattrFileterdtargetData:HeroDataComponente:boolean{ifdlandTypeArray.indexOfdtargetData.landTypeea=-1ereturnfalse;ifdheroTypeArray.indexOfdtargetData.heroTypeea=-1ereturnfalse;returntrue;}cc构建参数letfindArgs=newECS.FindTargetArgsde;findArgs.campType=this.campType;findArgs.srcTrans=null;findArgs.srcHeroData=null;findArgs.targetArray=targetArray;findArgs.maxCount=9999;findArgs.attrFileterFunc=attrFileter;findArgs.thisObj=this;findArgs.sortType=skillTemplate.targetSortType;ifdspellData.rangeType==RangeType.Circleecc圆形区域findArgs.transFilterFunc=circleTransFilter;else{findArgs.transFilterFunc=rectTransFilter;}letnowTargetIdArray=ECS.FindUtils.GetTargetsdfindArgse;letoutOfRangeTargetIdArray:number[]=[];fordlettargetIdofthis.effectTargetIdArraye{ifdnowTargetIdArray.indexOfdtargetIdea=-1eoutOfRangeTargetIdArray.pushdtargetIde;}fordlettargetIdofnowTargetIdArraye{letheroObj:HeroBase=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdtargetIde;ifdheroObj!=nulle{heroObj.SetBlinkColord200,92,164,219,256e;}}fordlettargetIdofoutOfRangeTargetIdArraye{letheroObj:HeroBase=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdtargetIde;ifdheroObj!=nulle{heroObj.SetBlinkColord0,0,0,0,0e;}}this.effectTargetIdArray=nowTargetIdArray;}privateUpdateHeroWarnRangedcardData:game.CardDataIteme{letworldObj=RenderWorld.GetInstancede;letheroDataItem=agame.HeroDataItembcardData;letsubHeroShapes=heroDataItem.GetSubHeroShapesde;ifdsubHeroShapes.lengthb0e{letshape=subHeroShapes[0];heroDataItem=agame.HeroDataItembgame.MainDataMgr.GetInstancede.heroDataMgr.GetHerodshapee;ifdheroDataItem==nulleheroDataItem=agame.HeroDataItembcardData;}letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;letmyFightRoleId=warComp.myFightRoleId;letplayerComp=aECSC.RealPlayerComponentbworldObj.GetCompByIDdmyFightRoleId,RenderComponentType.RealPlayerComponente;lettargetArray=worldObj.renderHeroManager.GetAllTargetdEnemyType.Enemy,playerComp.campType,falsee;letnowTargetIdArray:number[]=[];fordlettargetoftargetArraye{ifdthis.IsInTargetWarnRangedtarget,heroDataItemeenowTargetIdArray.pushdtarget.ide;}letoutOfRangeTargetIdArray:number[]=[];fordlettargetIdofthis.effectTargetIdArraye{ifdnowTargetIdArray.indexOfdtargetIdea=-1eoutOfRangeTargetIdArray.pushdtargetIde;}fordlettargetIdofnowTargetIdArraye{letheroObj:HeroBase=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdtargetIde;ifdheroObj!=nulle{heroObj.SetWarnEffectShowdtruee;}}fordlettargetIdofoutOfRangeTargetIdArraye{letheroObj:HeroBase=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdtargetIde;ifdheroObj!=nulle{heroObj.SetWarnEffectShowdfalsee;}}this.effectTargetIdArray=nowTargetIdArray;}cc我是否在目标的警戒范围内privateIsInTargetWarnRangedtarget:ECS.EntityBase,heroDataItem:game.HeroDataIteme:boolean{lettargetHeroData=aHeroDataComponentbtarget.GetCompdRenderComponentType.HeroDataComponente;ifdRenderWarUtil.IsQueenTowerdtargetHeroData.shapeeereturnfalse;letssc=aSkillStatusComponentbtarget.GetCompdRenderComponentType.SkillStatusComponente;ifdssc==nulle{game.errord"IsTargetWarnMeGetAISkillTemplateerror:",heroDataItem.ide;returnfalse;}letskillTemplate=ssc.GetAISkillTemplatede;ifdskillTemplate==nulle{game.errord"IsTargetWarnMeGetAISkillTemplateerror:",heroDataItem.ide;returnfalse;}ifdskillTemplate.landTypeArray.indexOfdheroDataItem.landTypeea=-1ecc属性不符合returnfalse;ifdskillTemplate.heroTypeArray.indexOfdheroDataItem.heroTypeea=-1ecc属性不符合returnfalse;letnowPos=this.GetPosde;ifdRenderWarUtil.IsTowerdtargetHeroData.shapeeecc国王塔攻击范围是矩形{letareaType=RenderWorld.GetInstancede.warContainer.IsInEnemyLockAreadnowPos.x,nowPos.y,targetHeroData.atkType,MathConst.MapCellSizee;ifdareaType!=0ecc不在target的己方区域内d这里比较绕ereturnfalse;elsereturntrue;}lettargetTrans=aTransformComponentbtarget.GetCompdRenderComponentType.TransformComponente;letdis=MathUtil.squaredDistancednowPos,targetTrans.pose;letradius=skillTemplate.warnDis+heroDataItem.range;ifddisbradius*radiusecc距离超出returnfalse;returntrue;}publicDisposeRangeEffectde{letworldObj=RenderWarUtil.GetWorldObjde;ifdworldObj==nullereturn;fordlettargetIdofthis.effectTargetIdArraye{letheroObj:HeroBase=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdtargetIde;ifdheroObj!=nulle{heroObj.SetBlinkColord0,0,0,0,0e;heroObj.SetWarnEffectShowdfalsee;}}}publicSetPosdx:number,y:numbere:void{super.SetPosdx,ye;}publicSetScaledsx:number,sy:numbere:void{super.SetScaledsx,sye;}publicSetAlphadalpha:numbere{super.SetAlphadalphae;}publicSetVisibledvisible:booleane{super.SetVisibledvisiblee;}publicdeployEffect_guanghuan:ECSC.EffectBase;cc光环publicdeployEffect_yanwu:ECSC.EffectBase;cc烟雾publicdeployPanel:game.DeployPanel;cc面板publicdeployEffect_shizhong:ECSC.EffectBase;cc时钟publicdeployEffect_lv:egret.BitmapText;cc等级d敌方epublicShowDeployInfode{this.DisposeDeployInfode;cc光环leteffectObj=game.RenderUtils.CreateEffectdSceneTypeConst.War,9002e;effectObj.id=IDManager.NewKeyIDde;effectObj.Initde;effectObj.SetPosd0,0e;this.deployEffect_guanghuan=effectObj;effectObj.visible=false;this.addChildAtdeffectObj,0e;cc烟雾effectObj=game.RenderUtils.CreateEffectdSceneTypeConst.War,9003e;effectObj.id=IDManager.NewKeyIDde;effectObj.Initde;effectObj.SetPosd0,0e;this.deployEffect_yanwu=effectObj;effectObj.visible=false;this.addChildAtdeffectObj,2e;cc面板letdeployPanel=newgame.DeployPanelde;this.deployPanel=deployPanel;deployPanel.visible=false;ifdthis.campType==CampType.Friendecc友方没有color_viewthis.addChildAtddeployPanel,4e;elsethis.addChildAtddeployPanel,5e;cc时钟effectObj=game.RenderUtils.CreateEffectdSceneTypeConst.War,9004e;effectObj.id=IDManager.NewKeyIDde;effectObj.Initde;effectObj.SetPosd0,-20e;this.deployEffect_shizhong=effectObj;effectObj.visible=false;ifdthis.campType==CampType.Friendecc友方没有color_viewthis.addChildAtdeffectObj,5e;elsethis.addChildAtdeffectObj,6e;cc等级letlvObj=newegret.BitmapTextde;lvObj=newegret.BitmapTextde;lvObj.font=RES.getResd"hp_red_little_font_fnt"e;this.addChildAtdlvObj,7e;lvObj.textAlign="center";lvObj.text="a";lvObj.y=-90;lvObj.visible=false;this.deployEffect_lv=lvObj;}publicSetDeployLvdlv:numbere{letlvObj=this.deployEffect_lv;ifdlvObj!=nulle{lvObj.visible=true;lettransInfo:any={10:"a",11:"b",12:"c",13:"d",14:"e",15:"f"};letlvStr=lv.toStringde;ifdlvb9elvStr=transInfo[lv];lvObj.text=lvStr;lvObj.x=-lvObj.widthc2;}}publicUpdateDeployInfodname:string,lv:number,costCount:number,nowCount:numbere{ifdthis.deployPanel!=nullethis.deployPanel.SetDatadnull,name,lv,costCount,nowCounte;}publicShowDeployAnimation0decc拖动时的动画{fordletheroObjofthis.heroObjArrayeheroObj.SetAlphad0.5e;fordleteffectObjofthis.effectArrayeeffectObj.SetAlphad0.5e;this.deployPanel.visible=true;this.deployEffect_guanghuan.visible=true;}publicShowDeployAnimation1decc第一段部署动画{ifdthis.deployPanel!=nulle{fordletheroObjofthis.heroObjArrayeheroObj.SetAlphad0.5e;fordleteffectObjofthis.effectArrayeeffectObj.SetAlphad0.5e;this.deployPanel.visible=true;this.deployEffect_guanghuan.visible=true;this.deployPanel.ShowCostAnimationde;}}publicShowDeployAnimation2ddeployTime:numberecc第二段部署动画下落{game.TweenUtil.Deploy_Anim2dthis,deployTimee;}publicDisposeDeployInfode{ifdthis.deployPanel!=nulle{this.deployPanel.DestroyAllde;this.deployPanel=null;}ifdthis.deployEffect_shizhong!=nulle{game.RenderUtils.DestroyEffectdSceneTypeConst.War,this.deployEffect_shizhonge;this.deployEffect_shizhong=null;}ifdthis.deployEffect_yanwu!=nulle{game.RenderUtils.DestroyEffectdSceneTypeConst.War,this.deployEffect_yanwue;this.deployEffect_yanwu=null;}ifdthis.deployEffect_guanghuan!=nulle{game.RenderUtils.DestroyEffectdSceneTypeConst.War,this.deployEffect_guanghuane;this.deployEffect_guanghuan=null;}ifdthis.deployEffect_lv!=nulle{this.removeChilddthis.deployEffect_lve;this.deployEffect_lv=null;}fordletheroObjofthis.heroObjArraye{TweenLite.killTweensOfdheroObj.roote;heroObj.root.y=0;heroObj.root.alpha=1;heroObj.root.scaleX=heroObj.root.scaleY=1;}this.DisposeRenderde;}publicSetCardDestroyTimeddelayTime:numbere{this.DisposeTimerde;this.destoryTimer=game.TimerMgr.GetInstancede.AddTimerddelayTime,dstack:stringe=b{DeployCardMgr.GetInstancede.RemoveCarddthis.cardIDe;},thise;}publicDisposeTimerde{ifdthis.destoryTimer!=0e{game.TimerMgr.GetInstancede.RemoveTimerdthis.destoryTimere;this.destoryTimer=0;}}publicDisposeRenderde{letisWarHero:boolean=true;cc如果为true为真正的战场中的单位不能删除fordletheroObjofthis.heroObjArraye{ifdthis.containsdheroObjee{isWarHero=false;heroObj.Disposede;}}this.heroObjArray.length=0;this.delayFrameArray.length=0;fordleteffectObjofthis.effectArraye{ifdthis.containsdeffectObjeegame.RenderUtils.DestroyEffectdSceneTypeConst.War,effectObje;}this.effectArray.length=0;ifd!isWarHeroethis.heroIdArray=[];}publicDisposede{this.DisposeTimerde;this.DisposeRenderde;this.DisposeRangeEffectde;this.heroIdArray=[];this.DisposeDeployInfode;super.Disposede;}}}﻿moduleECSC{exportclassSpriteBaseextendsegret.SpriteimplementsRenderInterface{publicid:number;publiccampType:number;publicatkType:number;publiclogicPos:Vector2=newVector2de;publiclogicAngle:number=0;publicisOnMap:boolean=false;cc角色的父节点是否是地图privateposCache:Vector2=newVector2de;privatescaleCache:Vector2=newVector2de;publicconstructorde{superde;this.id=0;this.SetLogicAngled0e;}publicInitde:void{this.removeEventListenerdegret.Event.ADDED_TO_STAGE,this.OnAddToStage,thise;this.addEventListenerdegret.Event.ADDED_TO_STAGE,this.OnAddToStage,thise;}protectedOnAddToStagedevent:egret.Evente{ifdthis.parent==ECSC.RenderWarUtil.GetWarMapdee{ccthis.anchorOffsetX=this.widthc2;ccthis.anchorOffsetY=this.heightc2;this.isOnMap=true;this.SetLogicAngledthis.logicAnglee;}elsethis.isOnMap=false;}publicDisposede:void{ifdthis&&this.parente{this.parent.removeChilddthise;}letmoveRenderMgr=MoveRenderMgr.GetInstancede;ifdmoveRenderMgr!=nulleMoveRenderMgr.GetInstancede.RemoveMoveInfodthise;else{ccgame.logd"-------------bbbbbbbbbbbbbbbbbbbbbbbbbb"e;}this.removeEventListenerdegret.Event.ADDED_TO_STAGE,this.OnAddToStage,thise;}publicSetPosdx:number,y:numbere:void{ECSC.RenderWarUtil.SetLogicPosdx,y,thise;ccgame.logdthis.x,this.y,"_________SetPos________",this.logicPos.x,this.logicPos.ye;}publicGetPosde:Vector2{this.posCache.x=this.x;this.posCache.y=this.y;returnthis.posCache;ccreturnthis.logicPos;}publicGetShowPosde{this.posCache.x=this.x;this.posCache.y=this.y;returnthis.posCache;}publicSetShowPosdx:number,y:numbere{ECSC.RenderWarUtil.SetShowPosdx,y,thise;ccgame.logdthis.x,this.y,"_________SetShowPos________",this.logicPos.x,this.logicPos.ye;}publicSetAngledangle:numbere:void{this.rotation=angle;this.logicAngle=angle;}publicSetLogicAngledangle:numbere{ECSC.RenderWarUtil.SetLogicAngledangle,thise;}publicGetAnglede:number{returnthis.rotation;}publicSetScaledsx:number,sy:numbere:void{this.scaleX=sx;this.scaleY=sy;this.scaleCache.x=this.scaleX;this.scaleCache.y=this.scaleY;}publicGetScalede:Vector2{this.scaleCache.x=this.scaleX;this.scaleCache.y=this.scaleY;returnthis.scaleCache;}publicSetAlphadalpha:numbere{this.alpha=alpha;}publicGetAlphade:number{returnthis.alpha;}publicSetVisibledvisible:booleane{this.visible=visible;}publicSetAniAngledanglee{}publicUpdateddeltaTime:numbere{}}}﻿moduleECSC{exportclassTowerMovieClipextendsMovieClipBase{publicconstructorde{superde;}publicInitde:void{super.Initde;}protectedOnAddToStagedevent:egret.Evente{super.OnAddToStagedevente;ccthis.anchorOffsetX=this.widthc2;ccthis.anchorOffsetY=this.heightc2;}publicSetAnimStatedstate:number,angle:number,campType:numbere:void{ifdstate==AnimState.Idlee{this.PlaydMathConst.IdelLabel,1,MathConst.IdelLabel,nulle;cc从头播放}elseifdstate==AnimState.Attacke{letaniType=MathConst.AttackLabel;this.PlaydMathConst.AttackLabel,1,MathConst.AttackLabel,nulle;cc非循环动作每次都从头播放}}publicSetAniSpeeddstate:number,speed:numbere{ifdstate==AnimState.Idleecc待机动作不受攻速加成影响this.aniSpeedInfo.setdMathConst.IdelLabel,1e;elseifdstate==AnimState.Attacke{this.aniSpeedInfo.setdMathConst.AttackLabel,speede;}}publicDisposede:void{super.Disposede;}}}﻿c****@author**cmoduleECSC{exportclassWarMapextendseui.Group{private_cellSize:number=MathConst.MapCellSize;private_player:egret.Sprite;cc调试用的private_debug_cell_list:egret.Sprite[]=[];private_lineShape:egret.Shape;cc调试用的public_gridContent:egret.DisplayObjectContainer;public_gridArr:egret.Shape[][];privatelockAreaLineShape:egret.Shape;privatelockAreaRectShape:egret.Shape;publicbottomGroup:eui.Group;publictopGroup:eui.Group;ccpublicstatics_Instance:WarMap;ccpublicstaticGetInstancede:WarMapcc{ccreturnWarMap.s_Instance;cc}ccpublicstaticInitInstancedecc{ccifdWarMap.s_Instance==nulleccWarMap.s_Instance=newWarMapde;cc}ccpublicstaticDestroyInstancedecc{ccifdWarMap.s_Instance!=nulleccWarMap.s_Instance.Disposede;ccWarMap.s_Instance=null;cc}privateworld:RenderWorld;publicconstructordworldObj:anye{superde;this.world=worldObj;this.bottomGroup=neweui.Groupde;this.bottomGroup.name="bottomGroup";this.topGroup=neweui.Groupde;this.topGroup.name="topGroup";this.sortableChildren=true;this.bottomGroup.sortableChildren=true;this.topGroup.sortableChildren=true;}publicInitdgrid:ECS.Grid,numCols:number,numRows:number,cellSize:numbere{this._cellSize=cellSize;this.x=MathConst.MapPosX;this.y=MathConst.MapPosY;this.removeEventListenerdegret.Event.ADDED_TO_STAGE,this.OnAddToStage,thise;this.addEventListenerdegret.Event.ADDED_TO_STAGE,this.OnAddToStage,thise;this.MakeGriddgrid,numCols,numRows,cellSizee;this.touchEnabled=true;this.touchChildren=true;this.touchThrough=true;letrootLayer=game.GameSceneLayer.gameLayerde.objectLayer;rootLayer.addChilddthise;}privateOnAddToStagedevent:egret.Evente{letwarComp:ECSC.WarComponent=this.world.GetSingletonCompdRenderComponentType.WarComponente;ifdwarComp.IsReversePosdee{this.anchorOffsetX=MathConst.MapPosMaxXc2;this.anchorOffsetY=MathConst.MapPosMaxYc2;this.width=MathConst.MapPosMaxX;this.height=MathConst.MapPosMaxY;this.x=GameData.Widthc2;this.y=GameData.Heightc2-20;this.rotation=180;}this.bottomGroup.anchorOffsetX=this.anchorOffsetX;this.bottomGroup.anchorOffsetY=this.anchorOffsetY;this.bottomGroup.height=this.height;this.bottomGroup.width=this.width;this.bottomGroup.x=this.x;this.bottomGroup.y=this.y;this.bottomGroup.rotation=this.rotation;this.parent.addChildAtdthis.bottomGroup,0e;this.topGroup.anchorOffsetX=this.anchorOffsetX;this.topGroup.anchorOffsetY=this.anchorOffsetY;this.topGroup.height=this.height;this.topGroup.width=this.width;this.topGroup.x=this.x;this.topGroup.y=this.y;this.topGroup.rotation=this.rotation;this.parent.addChildAtdthis.topGroup,999e;}publicDisposedeccTODONIU{this.removeEventListenerdegret.Event.ADDED_TO_STAGE,this.OnAddToStage,thise;game.RenderUtils.RemoveFromParentdthis.lockAreaLineShapee;this.lockAreaLineShape=null;game.RenderUtils.RemoveFromParentdthis.lockAreaRectShapee;this.lockAreaRectShape=null;game.RenderUtils.RemoveFromParentdthis._playere;this._player=null;game.RenderUtils.RemoveArrayFromParentdthis._debug_cell_liste;this._debug_cell_list=[];game.RenderUtils.RemoveFromParentdthis._lineShapee;this._lineShape=null;ifdthis._gridArr!=null&&this._gridContent!=nulle{fordleti=0;iathis._gridArr.length;i++e{letarr=this._gridArr[i];ifdarr!=nulle{game.RenderUtils.RemoveArrayFromParentdarre;arr.length=0;}}this._gridArr.length=0;}game.RenderUtils.RemoveFromParentdthis._gridContente;this._gridContent=null;game.RenderUtils.RemoveFromParentdthis.topGroupe;game.RenderUtils.RemoveFromParentdthis.bottomGroupe;game.RenderUtils.RemoveFromParentdthise;this.topGroup=null;this.bottomGroup=null;}publicMakeTowerCollidede{cc绘制国王塔索敌半径}publicRelaseTowerCollidede{}publicRefreshEnemyLockAreadshow:boolean,heroData:game.CardDataItem,posIndex:numbere{ifdthis.lockAreaRectShape==nulle{this.lockAreaRectShape=newegret.Shapede;this.bottomGroup.addChildAtdthis.lockAreaRectShape,1e;}ifdthis.lockAreaLineShape==nulle{this.lockAreaLineShape=newegret.Shapede;this.bottomGroup.addChildAtdthis.lockAreaLineShape,1e;}this.lockAreaLineShape.visible=show;this.lockAreaRectShape.visible=show;ifd!showereturn;this.lockAreaRectShape.graphics.clearde;this.lockAreaLineShape.graphics.clearde;this.lockAreaRectShape.graphics.beginFilld0xf58f98,0.5e;this.lockAreaLineShape.graphics.lineStyled6,0xf1544a,0.8e;letcellSize=MathConst.MapCellSize;ccposIndex=7;letposArray=MathConst.LockAreaPosArray[posIndex];letindex=0;letwarComp:ECSC.WarComponent=this.world.GetSingletonCompdRenderComponentType.WarComponente;letisReverse=warComp.IsReversePosde;fordletposofposArraye{letx=isReverse?MathConst.MapPosMaxX-pos[0]*cellSize:pos[0]*cellSize;lety=isReverse?MathConst.MapPosMaxY-pos[1]*cellSize:pos[1]*cellSize;ifdindex==0e{this.lockAreaRectShape.graphics.moveTodx,ye;this.lockAreaLineShape.graphics.moveTodx,ye;}else{this.lockAreaRectShape.graphics.lineTodx,ye;this.lockAreaLineShape.graphics.lineTodx,ye;}index++;}this.lockAreaRectShape.graphics.endFillde;this.lockAreaLineShape.graphics.endFillde;}c***Createsagridwithabunchofrandomunwalkablenodes.*cpublicMakeGriddgrid:ECS.Grid,numCols:number,numRows:number,cellSize:numbere:void{ifdGameData.DevelopModeb=DevelopMode.Debug&&grid!=nulle{this._gridContent=newegret.DisplayObjectContainerde;this._gridContent.touchEnabled=true;this._gridContent.touchChildren=false;ccthis.touchEnabled=true;ccthis._gridContent.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnGridClick,thise;this.bottomGroup.addChilddthis._gridContente;cccc随机障碍物ccletrandomArray=cc[[18,4],[16,6],[16,13],[20,4],[1,8],[26,2],[1,1],[18,3],[4,7],[6,7],cc[16,8],[10,2],[19,13],[7,3],[4,9],[8,13],[27,4],[6,3],[10,4],[17,8],cc[4,4],[9,9],[0,6],[13,9],[14,1],[24,14],[1,1],[8,13],[9,12],[0,7],cc[24,13],[6,6],[28,3],[3,3],[6,10],[22,2],[7,5],[27,15],[27,11],[21,8]]ccfordvari:number=0;ia40;i++ecc{ccthis._landGrid.setWalkabledrandomArray[i][0],randomArray[i][1],falsee;ccccthis._landGrid.setWalkabledMath.floordMath.randomde*29e,Math.floordMath.randomde*15e,falsee;cc}this.DrawGriddgride;this.MakePlayerde;}}publicRefreshPlayerPosdx:number,y:numbere{ifdGameData.DevelopModeb=DevelopMode.Debuge{this._player.x=x;this._player.y=y;}}publicRefreshDebugCellPosdposArray:any[]e{ifdGameData.DevelopModeaDevelopMode.Debugereturn;letlist:egret.Sprite[]=[];fordletposofposArraye{letcell:egret.Sprite;ifdthis._debug_cell_list.lengthb0ecell=this._debug_cell_list.popde;elsecell=newegret.Spritede;letx=pos[0];lety=pos[1];letenable=pos[2];letcolor=enable?0x00ff00:0xff0000;cell.touchEnabled=true;cc当为true时点击事件会穿过该对象到达侦听对象cell.graphics.clearde;cell.graphics.beginFilldcolor,0e;cell.graphics.lineStyled1,colore;cell.graphics.moveTodx,ye;cell.graphics.lineTodx+30,ye;cell.graphics.lineTodx+30,y+30e;cell.graphics.lineTodx,y+30e;cell.graphics.lineTodx,ye;cell.graphics.endFillde;cell.anchorOffsetX=15;cell.anchorOffsetY=15;cell.name="nnnnnnn";ECSC.RenderWarUtil.SetLogicPosd0+15,0+15,celle;this.topGroup.addChilddcelle;list.pushdcelle;}fordletcellofthis._debug_cell_liste{cell.graphics.clearde;game.RenderUtils.RemoveFromParentdcelle;}this._debug_cell_list=list;}c***Createstheplayersprite.Justacirclehere.*cprivateMakePlayerde:void{this._player=newegret.Spritede;ccthis._player.touchChildren=false;this._player.touchEnabled=true;cc当为true时点击事件会穿过该对象到达侦听对象this._player.graphics.beginFilld0xff0000,0.5e;ccthis._player.graphics.drawCircled0,0,15e;this._player.graphics.lineStyled1,0x000000e;ccthis._player.graphics.beginFilld0xff0000e;this._player.graphics.drawRectd0,0,this._cellSize,this._cellSizee;this._player.graphics.endFillde;this._player.anchorOffsetX=15;this._player.anchorOffsetY=15;ccthis._player.x=15;ccthis._player.y=15;ECSC.RenderWarUtil.SetLogicPosd0+15,0+15,this._playere;this.bottomGroup.addChilddthis._playere;this._lineShape=newegret.Shapede;this.bottomGroup.addChilddthis._lineShapee;ccthis._lineShape.graphics.clearde;ccthis._lineShape.graphics.lineStyled4,0xFF0000e;ccthis._lineShape.graphics.moveTodMathConst.MapPosMaxX-30,MathConst.MapPosMaxY-315e;ccthis._lineShape.graphics.lineTodMathConst.MapPosMaxX-300,MathConst.MapPosMaxY-315e;ccthis._lineShape.graphics.endFillde;}c***TODO_landGrid从外面传过来*cprivateDrawGriddgrid:ECS.Gride:void{this._gridArr=newArrayde;fordvari:number=0;iagrid.numCols;i++e{this._gridArr[i]=[];fordvarj:number=0;jagrid.numRows;j++e{varnode:ECS.NodePoint=grid.getNodedi,je;varrect:egret.Shape=newegret.Shapede;rect.graphics.lineStyled1,0x000000e;rect.graphics.beginFilldthis.GetColordnodee,0.5e;rect.graphics.drawRectd0,0,this._cellSize,this._cellSizee;rect.graphics.endFillde;rect.anchorOffsetX=this._cellSizec2;rect.anchorOffsetY=this._cellSizec2;ccrect.x=i*this._cellSize;ccrect.y=j*this._cellSize;ECSC.RenderWarUtil.SetLogicPosdi*this._cellSize+this._cellSizec2,j*this._cellSize+this._cellSizec2,recte;this._gridContent.addChilddrecte;this._gridArr[i][j]=rect;}}this._gridContent.cacheAsBitmap=true;}ccTODO_landGrid从外面传过来privateChangeGridColordgrid:ECS.Grid,x:number,y:number,color:number=-1e{ifdthis._gridArr==nullereturn;varnode:ECS.NodePoint=grid.getNodedx,ye;letrect:egret.Shape=this._gridArr[x][y];rect.graphics.clearde;rect.graphics.lineStyled1,0x000000e;ifdcolor==-1erect.graphics.beginFilldthis.GetColordnodee,0.5e;elserect.graphics.beginFilldcolor,0.5e;rect.graphics.drawRectd0,0,this._cellSize,this._cellSizee;rect.graphics.endFillde;}c***Determinesthecolorofagivennodebasedonitsstate.*cprivateGetColordnode:ECS.NodePointe:number{ifdnode.heroInfo.sizeb1ereturn0x0000ff;ifd!node.walkableereturn0x666666;ccifdnode==this._grid.startNodeereturn0x999900;ccifdnode==this._grid.endNodeereturn0x0000ff;ccreturn0xcccccc;return0xbbbbbb;}publicRefreshGridColordgrid:ECS.Grid,x:number,y:number,color:number=-1e{ifdGameData.DevelopModeb=DevelopMode.Debuge{this.ChangeGridColordgrid,x,y,colore;}}}}﻿moduleECSC{classHurtInfo{publichurtHP:number;publichurtType:number;publicflag:number;cc默认0,magic流程执行完后+1logic计算完之后+1publicconstructordhurtHP:number,hurtType:numbere{this.hurtHP=hurtHP;this.hurtType=hurtType;this.flag=0;}publicIsShowHurtde:boolean{returnthis.flagb=2;}}exportclassWarNumber{privatestaticinstance:WarNumber;publicstaticInitInstancede{ifdWarNumber.instance==nulleWarNumber.instance=newWarNumberde;}publicstaticDestroyInstancede{ifdWarNumber.instance!=nulleWarNumber.instance.Disposede;WarNumber.instance=null;}publicstaticGetInstancede:WarNumber{ifd!CheckMainThreaddeereturnnull;returnWarNumber.instance;}privatehurtInfoMap:SMapanumber,SMapanumber,HurtInfobb;publicconstructorde{this.hurtInfoMap=newSMapanumber,SMapanumber,HurtInfobbde;}publicDisposede{letvalues=this.hurtInfoMap.valuesde;fordletvalueofvaluesevalue.clearde;this.hurtInfoMap.clearde;}publicShowHurtdentityID:number,pfid:number,hurtHP:number,hurtType:number,text:string=""e{ifd!WarData.ShowRenderereturn;hurtHP=hurtHP+0.5;letabsHurt=Math.absdhurtHPe;hurtHP=hurtHPcabsHurt*Math.floordabsHurte;letentity=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetHerodentityIDe;ifdentity==nullereturn;letrender=aDrawComponentbentity.GetCompdRenderComponentType.DrawComponente;ifdrender==nullereturn;letgameObject:HeroBase=render.gameObject;ifdgameObject==nullereturn;letheroData=aHeroDataComponentbentity.GetCompdRenderComponentType.HeroDataComponente;ifdheroData==nullereturn;ccifdhurtHP==30ecc{ccgame.logd"__________ShowHurt_________________",entityID,hurtType,gameObjecte;cc}ccifdentityID==1010eifdGameData.DevelopModeb=DevelopMode.DebugeHurtNumberRenderMgr.GetInstancede.ShowHurtdgameObject,hurtHP,hurtType,texte;ifdhurtHP==0ereturn;ifdheroData.shieldb0egameObject.SetHPdheroData.shield,heroData.shieldmaxe;elsegameObject.SetHPdheroData.hp,heroData.hpmaxe;ifdheroData.hpb0&&pfid!=0e{ifdgameObject.campType==CampType.EnemyegameObject.SetColord255,138,138,255,200e;elsegameObject.SetColord92,164,219,255,200e;}}ccmagiccallpublicBeHurtdentityID:number,actid:number,pfid:numbere{ifd!this.hurtInfoMap.hasdentityIDeethis.hurtInfoMap.setdentityID,newSMapanumber,HurtInfobdee;letdict=this.hurtInfoMap.getdentityIDe;ifd!dict.hasdactideedict.setdactid,newHurtInfod0,0ee;lethurtInfo=dict.getdactide;hurtInfo.flag+=1;ifdhurtInfo.IsShowHurtdee{this.ShowHurtdentityID,pfid,hurtInfo.hurtHP,hurtInfo.hurtTypee;dict.deletedactide;}}cclogiccallpublicAddOneHurtdentityID:number,actid:number,hurtHP:number,hurtType:number,pfid:numbere{ifd!this.hurtInfoMap.hasdentityIDeethis.hurtInfoMap.setdentityID,newSMapanumber,HurtInfobdee;letdict=this.hurtInfoMap.getdentityIDe;ifd!dict.hasdactideedict.setdactid,newHurtInfodhurtHP,hurtTypeee;lethurtInfo=dict.getdactide;hurtInfo.hurtHP=hurtHP;hurtInfo.hurtType=hurtType;hurtInfo.flag+=1;ccgame.logd"___AddOneHurt____________",actide;ifdhurtInfo.IsShowHurtdee{this.ShowHurtdentityID,pfid,hurtInfo.hurtHP,hurtInfo.hurtTypee;dict.deletedactide;}}}}﻿moduleECSC{exportinterfaceRenderInterface{SetPosdx:number,y:numbere:void;GetPosde:Vector2;SetAngledangle:numbere:void;GetAnglede:number;SetScaledsx:number,sy:numbere:void;GetScalede:Vector2;UpdateddeltaTime:numbere:void;Initde:void;Disposede:void;}}﻿moduleECSC{exportclassCreateRenderSystemextendsECSC.RenderSystem{privateeventIdArray:Arraya[string,number]b;publicconstructorde{superde;}publicInitde{super.Initde;this.eventIdArray=newArraya[string,number]bde;letkey_info=this.world.addEventCBd"OnEntityOptimizeCreated",this.OnEntityOptimizeCreated,thise;this.eventIdArray.pushdkey_infoe;key_info=this.world.addEventCBd"OnEntityOptimizeDestroyed",this.OnEntityOptimizeDestroyed,thise;this.eventIdArray.pushdkey_infoe;game.GlobalEvent.SubscribedGlobalEventType.ClientReadyAddHero,this.ClientReadyAddHero,thise;game.GlobalEvent.SubscribedGlobalEventType.ClientReadyAddSpell,this.ClientReadyAddSpell,thise;game.GlobalEvent.SubscribedGlobalEventType.ServerReadyAddHero,this.ServerReadyAddHero,thise;game.GlobalEvent.SubscribedGlobalEventType.ServerReadyAddSpell,this.ServerReadyAddSpell,thise;game.GlobalEvent.SubscribedGlobalEventType.LogicHeroEnterWar,this.LogicHeroEnterWar,thise;game.GlobalEvent.SubscribedGlobalEventType.CreateRenderEntity,this.CreateRenderEntity,thise;}publicDisposede{letkey_info;fordvari=0;iathis.eventIdArray.length;++ie{key_info=this.eventIdArray[i];this.world.removeEventCBdkey_info[0],key_info[1]e;}this.eventIdArray.length=0;game.GlobalEvent.UnSubscribedGlobalEventType.ClientReadyAddHero,this.ClientReadyAddHero,thise;game.GlobalEvent.UnSubscribedGlobalEventType.ClientReadyAddSpell,this.ClientReadyAddSpell,thise;game.GlobalEvent.UnSubscribedGlobalEventType.ServerReadyAddHero,this.ServerReadyAddHero,thise;game.GlobalEvent.UnSubscribedGlobalEventType.ServerReadyAddSpell,this.ServerReadyAddSpell,thise;game.GlobalEvent.UnSubscribedGlobalEventType.LogicHeroEnterWar,this.LogicHeroEnterWar,thise;game.GlobalEvent.UnSubscribedGlobalEventType.CreateRenderEntity,this.CreateRenderEntity,thise;super.Disposede;}publicOnEntityOptimizeCreateddentity:RenderEntitye{letheroData=aECSC.HeroDataComponentbentity.GetCompdRenderComponentType.HeroDataComponente;ifdheroData==nulle{ccgame.errord"--CreateRenderSystem.OnCreateRenderObjectheroDataisnull!!!--",entity.ide;return;}ECSC.RenderWarUtil.GetRenderHeroManagerde.AddHerodentity.id,entitye;letrc=aECSC.DrawComponentbentity.GetCompdRenderComponentType.DrawComponente;ifdrc!=null&&rc.gameObject==nulle{rc.CreateGameObjectde;}ifdheroData.callHeroTypeb0e{ifdheroData.callHeroType==1ethis.OnCallHeroReadydentitye;elsethis.OnCallHeroReadydentitye;return;}}publicOnEntityOptimizeDestroyeddentity:RenderEntitye{this.StopAllSpecialMagicdentitye;letrc=aECSC.DrawComponentbentity.GetCompdRenderComponentType.DrawComponente;ifdrc!=null&&rc.gameObject!=nulle{rc.DisposeRenderde;}ECSC.RenderWarUtil.GetRenderHeroManagerde.RemoveHerodentity.ide;}publicClientReadyAddHerodcardId:numbere{ccgame.logd"-------CreateRenderSystem.ClientReadyAddHero-------",cardId,FightServerTime.GetServerTimede,this.world.frameCounte;letcardObj=DeployCardMgr.GetInstancede.GetCarddcardId,null,nulle;ifdcardObj==nulle{game.errord"ClientReadyAddHerocardObjisnull!!!",cardId,FightServerTime.GetServerTimedee;return;}cardObj.ShowDeployAnimation1de;ccgame.logd"------ClientReadyAddHero-----------",egret.getTimerdee;}publicClientReadyAddSpelldcardId:numbere{letcardObj=DeployCardMgr.GetInstancede.GetCarddcardId,null,nulle;ifdcardObj==nulle{game.errord"ClientReadyAddHerocardObjisnull!!!"e;}cardObj.ShowDeployAnimation1de;}publicServerReadyAddHerodcardId:number,shape:number,x:number,y:number,playeId:number,idArray:number[]e{ifdshape==0ecc使用英雄卡牌失败{DeployCardMgr.GetInstancede.RemoveCarddcardIde;game.logd"------ServerFailAddHero-----------",egret.getTimerdee;return;}letplayerComp=aECSC.RealPlayerComponentbECSC.RenderWorld.GetInstancede.GetCompByIDdplayeId,RenderComponentType.RealPlayerComponente;letheroDataItem=agame.HeroDataItembplayerComp.GetHeroDatadshapee;ifdheroDataItem==nulle{game.errord"ServerReadyAddHeroerror",shapee;return;}letcardObj=DeployCardMgr.GetInstancede.GetCarddcardId,shape,playerCompe;cardObj.SetCardDestroyTimedWarData.DeployAni_Time2*10e;cardObj.UpdateHeroObjdidArraye;cardObj.SetPosdx,ye;cardObj.ShowDeployAnimation2dheroDataItem.deployTimee;cc计算部署效果结束帧letpreDeployEndFrame=this.world.frameCount+heroDataItem.GetMaxDeployTimedecMathConst.KeyFrameTime;this.world.AddFrameCallbackdpreDeployEndFrame,this.OnDeployEnd,true,this,[cardId,idArray]e;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdplayerComp.id!=warComp.myFightRoleIdecc其他的英雄显示等级{cardObj.SetDeployLvdheroDataItem.lve;}}publicServerReadyAddSpelldcardId:number,shape:number,x:number,y:number,playeId:numbere{ifdshape==0ecc使用法术失败{DeployCardMgr.GetInstancede.RemoveCarddcardIde;game.logd"------ServerFailAddSpell-----------",egret.getTimerdee;}letplayerComp=aECSC.RealPlayerComponentbECSC.RenderWorld.GetInstancede.GetCompByIDdplayeId,RenderComponentType.RealPlayerComponente;letheroData=agame.SpellDataItembplayerComp.GetHeroDatadshapee;ifdheroData==nulle{game.errord"ServerReadyAddSpellerror",shapee;return;}cc删除部署动画DeployCardMgr.GetInstancede.RemoveCarddcardIde;}publicLogicHeroEnterWardid:numbereccTODONIU这里现在还是logic层传递过来的消息应该改成和logic层完全没有关联才对{letentity=this.world.GetEntitydide;ifdentity!=nullethis.HeroEnterWardentitye;}publicCreateRenderEntitydid:number,compInfoDict:anye{letcomps=newSMapanumber,RenderComponentbde;fordletkey1incompInfoDicte{letcompType=Numberdkey1e;letcomp=aECSC.RenderComponentbECS.WarFactory.CreateComponentdcompType,this.worlde;letcompInfo=compInfoDict[key1];fordletkey2incompInfoe{letvalue=compInfo[key2];comp.SetAttrdkey2,valuee;}comps.setdcompType,compe;}this.world.CreateEntitydid,compse;}cc这个只是这张卡牌部署完毕里面的每个兵种不一定部署完毕cc比如骷髅军团部署时间为1s这个函数就是在1s部署时间后调用cc而里面的最后一只骷髅可能部署时间为1.5s所以这个函数不能删除部署状态要等部署状态时间到了之后自动消失privateOnDeployEnddargs:anye{letcardId:number=args[0];letidArray=args[1];letcardObj=DeployCardMgr.GetInstancede.GetCarddcardId,null,nulle;ifdcardObj==null||idArray.length==0e{game.warnd"OnDeployEnderror:",cardIde;}cc删除部署动画DeployCardMgr.GetInstancede.RemoveCarddcardIde;}cc英雄正式上场privateHeroEnterWardentity:RenderEntitye{letgameObject=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdentity.ide;letheroData=aECSC.HeroDataComponentbentity.GetCompdRenderComponentType.HeroDataComponente;cc初始化操作的技能d显示血条等ethis.DoSpecialMagicdentity,MathConst.InitMagicIDe;ifd!RenderWarUtil.IsTowerdheroData.shapee&&heroData.hpb0e{lettrans=aECSC.TransformComponentbentity.GetCompdRenderComponentType.TransformComponente;ifdgameObject!=nulle{gameObject.SetPosdtrans.pos.x,trans.pos.ye;}ccgame.logdtrans.id,"---HeroEnterWar--after:",trans.pos.tostringde,"before:",str1,"----bbb",pos.toStringdee;}}cc召唤类英雄出场动画publicOnCallHeroReadydentity:RenderEntitye{letheroData=aECSC.HeroDataComponentbentity.GetCompdRenderComponentType.HeroDataComponente;letgameObject:HeroBase=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdentity.ide;ifdgameObject!=nulle{cc播放动画gameObject.SetVisibledtruee;gameObject.SetLifeBarVisibledfalsee;}}cc播放特殊mgcprivateDoSpecialMagicdentity:RenderEntity,pfid:numbere:number{letactid=IDManager.NewKeyIDde;entity.tempIDInfo.setdpfid,actide;cc初始化操作的技能d显示血条等egame.GlobalEvent.FireEventdGlobalEventType.DoSkillRender,entity.id,pfid,actid,[],1e;returnactid;}cc停止所有特殊mgcprivateStopAllSpecialMagicdentity:RenderEntitye{letactid=entity.tempIDInfo.getdMathConst.InitMagicIDe;entity.tempIDInfo.deletedMathConst.InitMagicIDe;game.GlobalEvent.FireEventdGlobalEventType.StopSkillRender,actide;}}}﻿moduleECS{exportclassCreateRenderSystem_backupextendsLogicSystem{privateeventIdArray:Arraya[string,number]b;publicconstructorde{superde;}publicInitde{super.Initde;this.eventIdArray=newArraya[string,number]bde;letkey_info=this.world.addEventCBd"OnEntityOptimizeCreated",this.OnEntityOptimizeCreated,thise;this.eventIdArray.pushdkey_infoe;key_info=this.world.addEventCBd"OnEntityOptimizeDestroyed",this.OnEntityOptimizeDestroyed,thise;this.eventIdArray.pushdkey_infoe;game.GlobalEvent.SubscribedGlobalEventType.ClientReadyAddHero,this.ClientReadyAddHero,thise;game.GlobalEvent.SubscribedGlobalEventType.ClientReadyAddSpell,this.ClientReadyAddSpell,thise;game.GlobalEvent.SubscribedGlobalEventType.ServerReadyAddHero,this.ServerReadyAddHero,thise;game.GlobalEvent.SubscribedGlobalEventType.ServerReadyAddSpell,this.ServerReadyAddSpell,thise;game.GlobalEvent.SubscribedGlobalEventType.LogicHeroEnterWar,this.LogicHeroEnterWar,thise;}publicDisposede{letkey_info;fordvari=0;iathis.eventIdArray.length;++ie{key_info=this.eventIdArray[i];this.world.removeEventCBdkey_info[0],key_info[1]e;}this.eventIdArray.length=0;game.GlobalEvent.UnSubscribedGlobalEventType.ClientReadyAddHero,this.ClientReadyAddHero,thise;game.GlobalEvent.UnSubscribedGlobalEventType.ClientReadyAddSpell,this.ClientReadyAddSpell,thise;game.GlobalEvent.UnSubscribedGlobalEventType.ServerReadyAddHero,this.ServerReadyAddHero,thise;game.GlobalEvent.UnSubscribedGlobalEventType.ServerReadyAddSpell,this.ServerReadyAddSpell,thise;game.GlobalEvent.UnSubscribedGlobalEventType.LogicHeroEnterWar,this.LogicHeroEnterWar,thise;super.Disposede;}publicOnEntityOptimizeCreateddentity:EntityBasee{ECSC.RenderWarUtil.GetRenderHeroManagerde.AddHerodentity.id,entitye;letrc=aDrawComponentbentity.GetCompdRenderComponentType.DrawComponente;ifdrc!=null&&rc.gameObject==nulle{rc.CreateGameObjectde;}}publicOnEntityOptimizeDestroyeddentity:EntityBasee{this.StopAllSpecialMagicdentitye;letrc=aDrawComponentbentity.GetCompdRenderComponentType.DrawComponente;ifdrc!=null&&rc.gameObject!=nulle{rc.DisposeRenderde;}ECSC.RenderWarUtil.GetRenderHeroManagerde.RemoveHerodentity.ide;}publicClientReadyAddHerodcardId:numbere{letcardObj=ECSC.DeployCardMgr.GetInstancede.GetCarddcardId,null,nulle;ifdcardObj==nulle{game.errord"ClientReadyAddHerocardObjisnull!!!"e;return;}cardObj.ShowDeployAnimation1de;game.logd"------ClientReadyAddHero-----------",egret.getTimerdee;}publicClientReadyAddSpelldcardId:numbere{letcardObj=ECSC.DeployCardMgr.GetInstancede.GetCarddcardId,null,nulle;ifdcardObj==nulle{game.errord"ClientReadyAddHerocardObjisnull!!!"e;}cardObj.ShowDeployAnimation1de;}publicServerReadyAddHerodcardId:number,shape:number,x:number,y:number,playeId:number,idArray:number[]e{ifdshape==0ecc使用英雄卡牌失败{ECSC.DeployCardMgr.GetInstancede.RemoveCarddcardIde;game.logd"------ServerFailAddHero-----------",egret.getTimerdee;return;}letplayerComp:any=LogicWorld.GetInstancede.GetCompByIDdplayeId,RenderComponentType.RealPlayerComponente;letheroDataItem=agame.HeroDataItembplayerComp.GetHeroDatadshapee;ifdheroDataItem==nulle{game.errord"ServerReadyAddHeroerror",shapee;return;}letcardObj=ECSC.DeployCardMgr.GetInstancede.GetCarddcardId,shape,playerCompe;cardObj.SetCardDestroyTimedWarData.DeployAni_Time2*10e;cardObj.UpdateHeroObjdidArraye;cardObj.SetPosdx,ye;cardObj.ShowDeployAnimation2dheroDataItem.deployTimee;cc计算部署效果结束帧letpreDeployEndFrame=this.world.frameCount+heroDataItem.GetMaxDeployTimedecMathConst.KeyFrameTime;this.world.AddFrameCallbackdpreDeployEndFrame,this.OnDeployEnd,true,this,[cardId,idArray]e;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdplayerComp.id!=warComp.myFightRoleIdecc其他的英雄显示等级{cardObj.SetDeployLvdheroDataItem.lve;}}publicServerReadyAddSpelldcardId:number,shape:number,x:number,y:number,playeId:numbere{ifdshape==0ecc使用法术失败{ECSC.DeployCardMgr.GetInstancede.RemoveCarddcardIde;game.logd"------ServerFailAddSpell-----------",egret.getTimerdee;}letplayerComp=aRealPlayerComponentbLogicWorld.GetInstancede.GetCompByIDdplayeId,RenderComponentType.RealPlayerComponente;letheroData=agame.SpellDataItembplayerComp.GetHeroDatadshapee;ifdheroData==nulle{game.errord"ServerReadyAddSpellerror",shapee;return;}cc删除部署动画ECSC.DeployCardMgr.GetInstancede.RemoveCarddcardIde;}publicLogicHeroEnterWardid:numbere{letentity=this.world.GetEntitydide;ifdentity!=nullethis.HeroEnterWardentitye;}cc这个只是这张卡牌部署完毕里面的每个兵种不一定部署完毕cc比如骷髅军团部署时间为1s这个函数就是在1s部署时间后调用cc而里面的最后一只骷髅可能部署时间为1.5s所以这个函数不能删除部署状态要等部署状态时间到了之后自动消失privateOnDeployEnddargs:anye{letcardId:number=args[0];letidArray=args[1];letcardObj=ECSC.DeployCardMgr.GetInstancede.GetCarddcardId,null,nulle;ifdcardObj==null||idArray.length==0e{game.warnd"OnDeployEnderror:",cardIde;}cc删除部署动画ECSC.DeployCardMgr.GetInstancede.RemoveCarddcardIde;}cc英雄正式上场privateHeroEnterWardentity:EntityBasee{letgameObject=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdentity.ide;letheroData=aHeroDataComponentbentity.GetCompdRenderComponentType.HeroDataComponente;cc初始化操作的技能d显示血条等ethis.DoSpecialMagicdentity,MathConst.InitMagicIDe;ifd!LogicWarUtil.IsTowerdheroData.shapee&&heroData.hpb0e{lettrans=aTransformComponentbentity.GetCompdRenderComponentType.TransformComponente;ifdgameObject!=nulle{gameObject.SetPosdtrans.pos.x,trans.pos.ye;}ccgame.logdtrans.id,"---HeroEnterWar--after:",trans.pos.tostringde,"before:",str1,"----bbb",pos.toStringdee;}}cc召唤类英雄出场动画publicOnCallHeroReadydentity:EntityBasee{letheroData=aHeroDataComponentbentity.GetCompdRenderComponentType.HeroDataComponente;letgameObject:ECSC.HeroBase=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdentity.ide;ifdgameObject!=nulle{cc播放动画gameObject.SetVisibledtruee;gameObject.SetLifeBarVisibledfalsee;}}cc播放特殊mgcprivateDoSpecialMagicdentity:EntityBase,pfid:numbere:number{letactid=this.world.NewFightIDde;entity.tempIDInfo.setdpfid,actide;cc初始化操作的技能d显示血条等egame.GlobalEvent.FireEventdGlobalEventType.DoSkillRender,entity.id,pfid,actid,[],1e;returnactid;}cc停止所有特殊mgcprivateStopAllSpecialMagicdentity:EntityBasee{letactid=entity.tempIDInfo.getdMathConst.InitMagicIDe;entity.tempIDInfo.deletedMathConst.InitMagicIDe;game.GlobalEvent.FireEventdGlobalEventType.StopSkillRender,actide;}}}﻿moduleECSC{exportclassMoveRenderSystemextendsECSC.RenderSystem{publicconstructorde{superde;}publicInitFilterde{this.filter=newInt32Arrayd2e;this.filter[0]=RenderComponentType.TransformComponent;this.filter[1]=RenderComponentType.DrawComponent;ccthis.filter[2]=RenderComponentType.HeroDataComponent;}publicInitde{super.Initde;game.GlobalEvent.SubscribedGlobalEventType.ForceSyncRenderPos,this.ForceSyncRenderPos,thise;game.GlobalEvent.SubscribedGlobalEventType.BlowFlyRender,this.BlowFlyRender,thise;game.GlobalEvent.SubscribedGlobalEventType.FaceToTarget,this.FaceToTarget,thise;}publicDisposede{super.Disposede;game.GlobalEvent.UnSubscribedGlobalEventType.ForceSyncRenderPos,this.ForceSyncRenderPos,thise;game.GlobalEvent.UnSubscribedGlobalEventType.BlowFlyRender,this.BlowFlyRender,thise;game.GlobalEvent.UnSubscribedGlobalEventType.FaceToTarget,this.FaceToTarget,thise;}publicUpdateddeltaTime:numbere{letlist=this.GetEntityListde;letgameObjectArray:any[]=[];fordletentityofliste{this.DoMovedentity,deltaTimee;letrender=aECSC.DrawComponentbentity.GetCompdRenderComponentType.DrawComponente;letgameObject=render.gameObject;ifdgameObject!=null&&!gameObject.isDebugegameObjectArray.pushdgameObjecte;}this.DoUpdateLayerdgameObjectArraye;gameObjectArray.length=0;gameObjectArray=null;}privateDoUpdateLayerdgameObjectArray:any[]e{function_reverserSortda,be:number{ifda.yab.yereturn1;elsereturn-1;}function_normalSortda,be:number{ifda.ybb.yereturn1;elsereturn-1;}letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdwarComp.IsReversePosdeegameObjectArray.sortd_reverserSorte;elsegameObjectArray.sortd_normalSorte;letlen=gameObjectArray.length;letgameObject=null;fordleti=0;ialen;i++e{gameObject=gameObjectArray[i];gameObject.SetChildIndexdie;}}privateDoMovedentity:ECS.EntityBase,deltaTime:numbere{lettrans=aECSC.TransformComponentbentity.GetCompdRenderComponentType.TransformComponente;letrender=aECSC.DrawComponentbentity.GetCompdRenderComponentType.DrawComponente;letheroData=aECSC.HeroDataComponentbentity.GetCompdRenderComponentType.HeroDataComponente;letplayerComp=aECSC.RealPlayerComponentbthis.world.GetCompByIDdentity.pid,RenderComponentType.RealPlayerComponente;ifdheroData!=null&&heroData.hpa=0ecc如果是玩家需要判定血量return;letgameObject:HeroBase=render.gameObject;ifdgameObject==nullereturn;gameObject.UpdateddeltaTimee;letssc=aECSC.SkillStatusComponentbentity.GetCompdRenderComponentType.SkillStatusComponente;ifdssc!=null&&heroData!=nulle{gameObject.DrawDebugCircleInfodheroData,trans.pos,[ssc.atkDis,ssc.warnDis]e;gameObject.DrawDebugPathdtrans.GetPathde,trans.pose;}ccgameObject.DrawDebugLinedtrans.pos,trans.targetPos,playerComp.atkTypee;ccletdis=MathUtil.distancedtrans.pos,trans.targetPose;ccgameObject.lifeBar.SetTextddis.toFixedd0e.toStringdee;ccletdir=Vector2.directiondtrans.targetPos,trans.pose;ccgame.logd"angle:",trans.GetAnglede.toFixedd0e,"pos:",dir.tostringde,"myPos:",trans.pos.tostringde,"______targetPos:____",trans.targetPos.tostringdee;ifdtrans.blowFly_Actidb0ecc击飞过程中return;ccifdssc!=null&&ssc.id==1019ecc{ccgame.logd"-----1019-MoveRenderSystem--------------bbbbbbbbbbbbbbbbb:",ssc.isLockHeroAI,egret.getTimerdee;cc}ifdssc!=null&&ssc.isLockHeroAIecc有技能在锁定中return;ifdtrans.moveSpeed==0||!trans.moveablee{ifdheroData!=null&&RenderWarUtil.IsTowerdheroData.shapeee{ifdplayerComp.atkType==AtkType.AttackegameObject.SetAniAngled90e;elsegameObject.SetAniAngled270e;}ifdssc==null||!ssc.isUseSkillecc没有技能在后摇中gameObject.SetAnimStatedAnimState.Idle,-1,playerComp.campTypee;return;}ifdgameObject.isDebugeccdebug对象不做平滑处理{gameObject.SetPosdtrans.pos.x,trans.pos.ye;return;}letrenderPos:Vector2=gameObject.GetPosde;letdis=Vector2.distancedrenderPos,trans.pose;letmovePath=trans.GetPathde;ifdmovePath==nullemovePath=[];ifddisbMathConst.errorDise{letmoveSpeed=trans.realMoveSpeedb0?trans.realMoveSpeed:trans.moveSpeed;letmoveOffset=moveSpeed*deltaTimec1000;ifdmoveOffsetbdisemoveOffset=dis;letdir=Vector2.directiondtrans.pos,renderPose;ccifdtrans.id==1018eccgame.logdtrans.id,"-----111111-----renderPos：bbb",renderPos.tostringde,"--------targetPos:bbbb",trans.pos.tostringdee;dir=dir.scaledmoveOffsete;ccifdtrans.id==1015eccgame.logd"________MoveRenderSystem_11111_________________",dis,movePath.length,moveOffset,egret.getTimerdee;renderPos.addddire;gameObject.SetPosdrenderPos.x,renderPos.ye;gameObject.SetAniSpeeddAnimState.Move,moveSpeedctrans.fitMoveSpeedeccgameObject.SetAniAngleddir.anglede+90e;gameObject.SetAniAngledtrans.realMoveDir.anglede+90e;gameObject.SetAnimStatedAnimState.Move,trans.GetAnglede,playerComp.campTypee;ccifdtrans.id==1094ecc{ccgame.logd"---------1094正在行走中----",egret.getTimerdee;cc}}elseifdmovePath==null||movePath.length==0ecc如果路径已经走完{ccifdtrans.id==1094ecc{ccgame.logd"---------1094路径已经走完待机目前处于待机状态----",egret.getTimerdee;cc}gameObject.SetPosdtrans.pos.x,trans.pos.ye;ifdssc==null||!ssc.isUseSkillecc没有技能在后摇中gameObject.SetAnimStatedAnimState.Idle,-1,playerComp.campType,100e;ccifdtrans.id==1015eccgame.logd"________MoveRenderSystem___22222_______________",dis,movePath.length,egret.getTimerdee;ccgame.logdtrans.id,"----222222------renderPos：bbb",renderPos.tostringde,"--------targetPos:bbbb",trans.pos.tostringdee;}elseccmovePath长度不为0并且disa=MathConst.errorDis{ccgame.logd"----ddddddddddddddddddddddddddddddddd-----------------bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb"e;}}cc击飞目标publicBlowFlyRenderdentityId:number,actid:number,startSpeed:number,accSpeed:number,dir:Vector2,time:numbere{letentity=this.world.GetEntitydentityIde;ifdentity==nullereturn;lettrans=aECSC.TransformComponentbentity.GetCompdRenderComponentType.TransformComponente;letrender=aECSC.DrawComponentbentity.GetCompdRenderComponentType.DrawComponente;letheroData=aECSC.HeroDataComponentbentity.GetCompdRenderComponentType.HeroDataComponente;letgameObject=render.gameObject;ifdgameObject==nullereturn;ifdactid!=0e{gameObject.SetAnimStatedAnimState.Idle,-1,heroData.campTypee;letdestPosX=trans.pos.x+dir.x*99999;letdestPosY=trans.pos.y+dir.y*99999;MoveRenderMgr.GetInstancede.AcccMoveStraightToPosdgameObject,destPosX,destPosY,startSpeed,accSpeed,timee;}else{MoveRenderMgr.GetInstancede.RemoveMoveInfodgameObjecte;ccthis.ForceSyncRenderPosdentitye;}}cc释放技能的时候强制同步渲染目标的位置publicForceSyncRenderPosdentityId:numbere{letentity=this.world.GetEntitydentityIde;ifdentity==nulle{game.errord"-------ForceSyncRenderPoserror:-------",entityIde;return;}letrender=aECSC.DrawComponentbentity.GetCompdRenderComponentType.DrawComponente;ifdrender==nullereturn;render.UpdateGameObjectde;ifdrender.gameObject==nullereturn;letgameObject=render.gameObject;lettrans=aECSC.TransformComponentbentity.GetCompdRenderComponentType.TransformComponente;letheroData=aECSC.HeroDataComponentbentity.GetCompdRenderComponentType.HeroDataComponente;letrenderPos=gameObject.GetPosde;letdis=Vector2.distancedrenderPos,trans.pose;ifddisb100e{ifdSettings.logegame.logd"renderandlogicposerroris:",dise;gameObject.SetPosdtrans.pos.x,trans.pos.ye;}gameObject.SetAnimStatedAnimState.Idle,-1,heroData.campTypee;}publicFaceToTargetdsrcId:number,targetId:numbere{letsrcObj=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdsrcIde;lettargetObj=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdtargetIde;ifdsrcObj!=null&&targetObj!=nulle{letsrcPos=srcObj.GetPosde;lettargetPos=targetObj.GetPosde;letdir=Vector2.directiondtargetPos,srcPose;srcObj.SetAniAngleddir.anglede+90e;}}}}﻿moduleECS{exportclassMoveRenderSystem_backupextendsLogicSystem{publicconstructorde{superde;}publicInitFilterde{this.filter=newInt32Arrayd2e;this.filter[0]=RenderComponentType.TransformComponent;this.filter[1]=RenderComponentType.DrawComponent;ccthis.filter[2]=RenderComponentType.HeroDataComponent;}publicInitde{super.Initde;game.GlobalEvent.SubscribedGlobalEventType.ForceSyncRenderPos,this.ForceSyncRenderPos,thise;game.GlobalEvent.SubscribedGlobalEventType.BlowFlyRender,this.BlowFlyRender,thise;game.GlobalEvent.SubscribedGlobalEventType.FaceToTarget,this.FaceToTarget,thise;}publicDisposede{super.Disposede;game.GlobalEvent.UnSubscribedGlobalEventType.ForceSyncRenderPos,this.ForceSyncRenderPos,thise;game.GlobalEvent.UnSubscribedGlobalEventType.BlowFlyRender,this.BlowFlyRender,thise;game.GlobalEvent.UnSubscribedGlobalEventType.FaceToTarget,this.FaceToTarget,thise;}publicUpdateddeltaTime:numbere{letlist=this.GetEntityListde;letgameObjectArray:any[]=[];fordletentityofliste{this.DoMovedentity,deltaTimee;letrender=aDrawComponentbentity.GetCompdRenderComponentType.DrawComponente;letgameObject=render.gameObject;ifdgameObject!=null&&!gameObject.isDebugegameObjectArray.pushdgameObjecte;}this.DoUpdateLayerdgameObjectArraye;gameObjectArray.length=0;gameObjectArray=null;}privateDoUpdateLayerdgameObjectArray:any[]e{function_reverserSortda,be:number{ifda.yab.yereturn1;elsereturn-1;}function_normalSortda,be:number{ifda.ybb.yereturn1;elsereturn-1;}letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdwarComp.IsReversePosdeegameObjectArray.sortd_reverserSorte;elsegameObjectArray.sortd_normalSorte;letlen=gameObjectArray.length;letgameObject=null;fordleti=0;ialen;i++e{gameObject=gameObjectArray[i];gameObject.SetChildIndexdie;}}privateDoMovedentity:EntityBase,deltaTime:numbere{lettrans=aTransformComponentbentity.GetCompdRenderComponentType.TransformComponente;letrender=aDrawComponentbentity.GetCompdRenderComponentType.DrawComponente;letheroData=aHeroDataComponentbentity.GetCompdRenderComponentType.HeroDataComponente;letplayerComp=aECS.RealPlayerComponentbthis.world.GetCompByIDdentity.pid,RenderComponentType.RealPlayerComponente;ifdheroData!=null&&heroData.hpa=0ecc如果是玩家需要判定血量return;letgameObject:ECSC.HeroBase=render.gameObject;ifdgameObject==nullereturn;gameObject.UpdateddeltaTimee;letssc=aSkillStatusComponentbentity.GetCompdRenderComponentType.SkillStatusComponente;ifdssc!=null&&heroData!=nulle{gameObject.DrawDebugCircleInfodheroData,trans.pos,[ssc.GetAttackDisde,ssc.GetWarnDisde]e;}gameObject.DrawDebugPathdtrans.GetPathde,trans.pose;gameObject.DrawDebugLinedtrans.pos,trans.targetPos,playerComp.atkTypee;ccletdis=MathUtil.distancedtrans.pos,trans.targetPose;ccgameObject.lifeBar.SetTextddis.toFixedd0e.toStringdee;ccletdir=Vector2.directiondtrans.targetPos,trans.pose;ccgame.logd"angle:",trans.GetAnglede.toFixedd0e,"pos:",dir.tostringde,"myPos:",trans.pos.tostringde,"______targetPos:____",trans.targetPos.tostringdee;ifdtrans.blowFly_Actidb0ecc击飞过程中return;ifdssc!=null&&ssc.IsLockHeroAIdeecc有技能在锁定中return;ifdtrans.moveSpeed==0||!trans.moveablee{ifdheroData!=null&&LogicWarUtil.IsTowerdheroData.shapeee{ifdplayerComp.atkType==AtkType.AttackegameObject.SetAniAngled90e;elsegameObject.SetAniAngled270e;}ifdssc==null||!ssc.IsUseSkilldeecc没有技能在后摇中gameObject.SetAnimStatedAnimState.Idle,-1,playerComp.campTypee;return;}ifdgameObject.isDebugeccdebug对象不做平滑处理{gameObject.SetPosdtrans.pos.x,trans.pos.ye;return;}letrenderPos:Vector2=gameObject.GetPosde;letdis=Vector2.distancedrenderPos,trans.pose;letmovePath=trans.GetPathde;ifdmovePath==nullemovePath=[];ifddisbMathConst.errorDise{letmoveSpeed=trans.realMoveSpeedb0?trans.realMoveSpeed:trans.moveSpeed;letmoveOffset=moveSpeed*deltaTimec1000;ifdmoveOffsetbdisemoveOffset=dis;letdir=Vector2.directiondtrans.pos,renderPose;ccifdtrans.id==1018eccgame.logdtrans.id,"-----111111-----renderPos：bbb",renderPos.tostringde,"--------targetPos:bbbb",trans.pos.tostringdee;dir=dir.scaledmoveOffsete;ccifdtrans.id==1015eccgame.logd"________MoveRenderSystem_11111_________________",dis,movePath.length,moveOffset,egret.getTimerdee;renderPos.addddire;gameObject.SetPosdrenderPos.x,renderPos.ye;gameObject.SetAniSpeeddAnimState.Move,moveSpeedctrans.fitMoveSpeedeccgameObject.SetAniAngleddir.anglede+90e;gameObject.SetAniAngledtrans.realMoveDir.anglede+90e;gameObject.SetAnimStatedAnimState.Move,trans.GetAnglede,playerComp.campTypee;ccifdtrans.id==1094ecc{ccgame.logd"---------1094正在行走中----",egret.getTimerdee;cc}}elseifdmovePath==null||movePath.length==0ecc如果路径已经走完{ccifdtrans.id==1094ecc{ccgame.logd"---------1094路径已经走完待机目前处于待机状态----",egret.getTimerdee;cc}gameObject.SetPosdtrans.pos.x,trans.pos.ye;ifdssc==null||!ssc.IsUseSkilldeecc没有技能在后摇中gameObject.SetAnimStatedAnimState.Idle,-1,playerComp.campType,100e;ccifdtrans.id==1015eccgame.logd"________MoveRenderSystem___22222_______________",dis,movePath.length,egret.getTimerdee;ccgame.logdtrans.id,"----222222------renderPos：bbb",renderPos.tostringde,"--------targetPos:bbbb",trans.pos.tostringdee;}elseccmovePath长度不为0并且disa=MathConst.errorDis{ccgame.logd"----ddddddddddddddddddddddddddddddddd-----------------bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb"e;}}cc击飞目标publicBlowFlyRenderdentityId:number,actid:number,startSpeed:number,accSpeed:number,dir:Vector2,time:numbere{letentity=this.world.GetEntitydentityIde;ifdentity==nullereturn;lettrans=aTransformComponentbentity.GetCompdRenderComponentType.TransformComponente;letrender=aDrawComponentbentity.GetCompdRenderComponentType.DrawComponente;letheroData=aHeroDataComponentbentity.GetCompdRenderComponentType.HeroDataComponente;letgameObject=render.gameObject;ifdgameObject==nullereturn;ifdactid!=0e{gameObject.SetAnimStatedAnimState.Idle,-1,heroData.campTypee;letdestPosX=trans.pos.x+dir.x*99999;letdestPosY=trans.pos.y+dir.y*99999;ECSC.MoveRenderMgr.GetInstancede.AcccMoveStraightToPosdgameObject,destPosX,destPosY,startSpeed,accSpeed,timee;}else{ECSC.MoveRenderMgr.GetInstancede.RemoveMoveInfodgameObjecte;ccthis.ForceSyncRenderPosdentitye;}}cc释放技能的时候强制同步渲染目标的位置publicForceSyncRenderPosdentityId:numbere{letentity=this.world.GetEntitydentityIde;ifdentity==nullereturn;letrender=aDrawComponentbentity.GetCompdRenderComponentType.DrawComponente;ifdrender==nullereturn;render.UpdateGameObjectde;ifdrender.gameObject==nullereturn;letgameObject=render.gameObject;lettrans=aTransformComponentbentity.GetCompdRenderComponentType.TransformComponente;letheroData=aHeroDataComponentbentity.GetCompdRenderComponentType.HeroDataComponente;letrenderPos=gameObject.GetPosde;letdis=Vector2.distancedrenderPos,trans.pose;ifddisb100e{ifdSettings.logegame.logd"renderandlogicposerroris:",dise;gameObject.SetPosdtrans.pos.x,trans.pos.ye;}gameObject.SetAnimStatedAnimState.Idle,-1,heroData.campTypee;}publicFaceToTargetdsrcId:number,targetId:numbere{letsrcObj=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdsrcIde;lettargetObj=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetRenderObjectdtargetIde;ifdsrcObj!=null&&targetObj!=nulle{letsrcPos=srcObj.GetPosde;lettargetPos=targetObj.GetPosde;letdir=Vector2.directiondtargetPos,srcPose;srcObj.SetAniAngleddir.anglede+90e;}}}}﻿moduleECSC{exportclassSkillRenderSystemextendsECSC.RenderSystem{publicconstructorde{superde;}publicInitFilterde{this.filter=newInt32Arrayd4e;this.filter[0]=RenderComponentType.SkillStatusComponent;this.filter[1]=RenderComponentType.DrawComponent;this.filter[2]=RenderComponentType.HeroDataComponent;this.filter[3]=RenderComponentType.TransformComponent;}publicInitde{super.Initde;game.GlobalEvent.SubscribedGlobalEventType.DoSkillRender,this.DoSkillRender,thise;game.GlobalEvent.SubscribedGlobalEventType.DoSpellRender,this.DoSpellRender,thise;game.GlobalEvent.SubscribedGlobalEventType.StopSkillRender,this.StopSkillRender,thise;game.GlobalEvent.SubscribedGlobalEventType.AddSkillVit,this.AddSkillVit,thise;game.GlobalEvent.SubscribedGlobalEventType.StopWait,this.StopWait,thise;game.GlobalEvent.SubscribedGlobalEventType.PauseSkillRender,this.PauseSkillRender,thise;game.GlobalEvent.SubscribedGlobalEventType.SendLogicCMD,this.SendLogicCMD,thise;}publicDisposede{super.Disposede;game.GlobalEvent.UnSubscribedGlobalEventType.DoSkillRender,this.DoSkillRender,thise;game.GlobalEvent.UnSubscribedGlobalEventType.DoSpellRender,this.DoSpellRender,thise;game.GlobalEvent.UnSubscribedGlobalEventType.StopSkillRender,this.StopSkillRender,thise;game.GlobalEvent.UnSubscribedGlobalEventType.AddSkillVit,this.AddSkillVit,thise;game.GlobalEvent.UnSubscribedGlobalEventType.StopWait,this.StopWait,thise;game.GlobalEvent.UnSubscribedGlobalEventType.PauseSkillRender,this.PauseSkillRender,thise;game.GlobalEvent.UnSubscribedGlobalEventType.SendLogicCMD,this.SendLogicCMD,thise;}publicDoSkillRenderdentityId:number,skillId:number,actid:number,vits:number[],attackSpeedUp:numbere{letmagicMgr=MagicMgr.GetInstancede;ifdmagicMgr!=nulleMagicMgr.GetInstancede.CreateMagicdskillId,entityId,actid,vits,attackSpeedUpe;}publicDoSpellRenderdspellId:number,actid:number,fromPos:number[],toPos:number[],attackSpeedUp:numbere{letmagicMgr=MagicMgr.GetInstancede;ifdmagicMgr!=nulleMagicMgr.GetInstancede.CreateMagic2dspellId,actid,fromPos,toPos,attackSpeedUpe;}publicStopSkillRenderdactid:numbere{letmagicMgr=MagicMgr.GetInstancede;ifdmagicMgr!=nulleMagicMgr.GetInstancede.DestoryMagicdactide;}publicAddSkillVitdactid:number,vits:number[]e{letmagicMgr=MagicMgr.GetInstancede;ifdmagicMgr!=nulleMagicMgr.GetInstancede.AddVitsdactid,vitse;}publicStopWaitdactid:numbere{letmagicMgr=MagicMgr.GetInstancede;ifdmagicMgr!=nulleMagicMgr.GetInstancede.StopWaitdactide;}publicPauseSkillRenderdactid:number,isPause:booleane{letmagicMgr=MagicMgr.GetInstancede;ifdmagicMgr!=nulleMagicMgr.GetInstancede.PauseSkilldactid,isPausee;}publicSendLogicCMDdactid:number,key:string,value:anye{letmagicMgr=MagicMgr.GetInstancede;ifdmagicMgr!=nulleMagicMgr.GetInstancede.SendLogicCMDdactid,key,valuee;}}}﻿moduleECS{exportclassSkillRenderSystem_backupextendsLogicSystem{publicconstructorde{superde;}publicInitFilterde{this.filter=newInt32Arrayd4e;this.filter[0]=RenderComponentType.SkillStatusComponent;this.filter[1]=RenderComponentType.DrawComponent;this.filter[2]=RenderComponentType.HeroDataComponent;this.filter[3]=RenderComponentType.TransformComponent;}publicInitde{super.Initde;game.GlobalEvent.SubscribedGlobalEventType.DoSkillRender,this.DoSkillRender,thise;game.GlobalEvent.SubscribedGlobalEventType.DoSpellRender,this.DoSpellRender,thise;game.GlobalEvent.SubscribedGlobalEventType.StopSkillRender,this.StopSkillRender,thise;game.GlobalEvent.SubscribedGlobalEventType.AddSkillVit,this.AddSkillVit,thise;game.GlobalEvent.SubscribedGlobalEventType.StopWait,this.StopWait,thise;game.GlobalEvent.SubscribedGlobalEventType.PauseSkillRender,this.PauseSkillRender,thise;game.GlobalEvent.SubscribedGlobalEventType.SendLogicCMD,this.SendLogicCMD,thise;}publicDisposede{super.Disposede;game.GlobalEvent.UnSubscribedGlobalEventType.DoSkillRender,this.DoSkillRender,thise;game.GlobalEvent.UnSubscribedGlobalEventType.DoSpellRender,this.DoSpellRender,thise;game.GlobalEvent.UnSubscribedGlobalEventType.StopSkillRender,this.StopSkillRender,thise;game.GlobalEvent.UnSubscribedGlobalEventType.AddSkillVit,this.AddSkillVit,thise;game.GlobalEvent.UnSubscribedGlobalEventType.StopWait,this.StopWait,thise;game.GlobalEvent.UnSubscribedGlobalEventType.PauseSkillRender,this.PauseSkillRender,thise;game.GlobalEvent.UnSubscribedGlobalEventType.SendLogicCMD,this.SendLogicCMD,thise;}publicDoSkillRenderdentityId:number,skillId:number,actid:number,vits:number[],attackSpeedUp:numbere{letmagicMgr=ECSC.MagicMgr.GetInstancede;ifdmagicMgr!=nulleECSC.MagicMgr.GetInstancede.CreateMagicdskillId,entityId,actid,vits,attackSpeedUpe;}publicDoSpellRenderdspellId:number,actid:number,fromPos:number[],toPos:number[],attackSpeedUp:numbere{letmagicMgr=ECSC.MagicMgr.GetInstancede;ifdmagicMgr!=nulleECSC.MagicMgr.GetInstancede.CreateMagic2dspellId,actid,fromPos,toPos,attackSpeedUpe;}publicStopSkillRenderdactid:numbere{letmagicMgr=ECSC.MagicMgr.GetInstancede;ifdmagicMgr!=nulleECSC.MagicMgr.GetInstancede.DestoryMagicdactide;}publicAddSkillVitdactid:number,vits:number[]e{letmagicMgr=ECSC.MagicMgr.GetInstancede;ifdmagicMgr!=nulleECSC.MagicMgr.GetInstancede.AddVitsdactid,vitse;}publicStopWaitdactid:numbere{letmagicMgr=ECSC.MagicMgr.GetInstancede;ifdmagicMgr!=nulleECSC.MagicMgr.GetInstancede.StopWaitdactide;}publicPauseSkillRenderdactid:number,isPause:booleane{letmagicMgr=ECSC.MagicMgr.GetInstancede;ifdmagicMgr!=nulleECSC.MagicMgr.GetInstancede.PauseSkilldactid,isPausee;}publicSendLogicCMDdactid:number,key:string,value:anye{letmagicMgr=ECSC.MagicMgr.GetInstancede;ifdmagicMgr!=nulleECSC.MagicMgr.GetInstancede.SendLogicCMDdactid,key,valuee;}}}﻿moduleECSC{exportclassWarUISystemextendsECSC.RenderSystem{publicupdateTimer:number=0;publicInitde{super.Initde;}publicUpdateddeltaTime:numbere{this.updateTimer+=deltaTime;cc转换为毫秒ifdthis.updateTimerb100e{letworldObj=this.world;letwarComp=aECSC.WarComponentbworldObj.GetSingletonCompdRenderComponentType.WarComponente;ccletwarComp1=aFrameDataCacheComponentbworldObj.GetSingletonCompdRenderComponentType.FrameDataCacheComponente;letstartLeftTime=100;cc距离开始游戏还有多久ifdwarComp.startTime!=nullestartLeftTime=FightServerTime.GetLeftTimedwarComp.startTimee;this.UpdateAnimationdwarCompe;cc+2用来控制误差比如剩余169帧则显示剩余17秒letendLeftTime=dECS.WarSettings.ShowTotalTime-worldObj.frameCount+2e*MathConst.KeyFrameTimec1000;ifdendLeftTimea0e{endLeftTime=0;}letdata:any={};data.startLeftTime=startLeftTime;data.endLeftTime=endLeftTime;data.cframe=worldObj.frameCount;ifdGameData.LocalTestedata.sframe=Server.LogicMgr.GetInstancede.GetFramede;elsedata.sframe=worldObj.serverFrameCount;ccdata.sframe=ECS.LogicWorld.GetInstancede.frameCount;letplayerComp=aECSC.RealPlayerComponentbworldObj.GetCompByIDdwarComp.myFightRoleId,RenderComponentType.RealPlayerComponente;ifdplayerComp!=nulledata.energy=playerComp.GetShowEnergyde;elsedata.energy=0;game.UIManager.UpdateDatadPanelTypeConst.WarUI,datae;this.updateTimer=0;}}cc动画privateUpdateAnimationdwarComp:ECSC.WarComponente{letnowTime=egret.getTimerde;ifdWarData.uiAnimationStartTime!=-1&&nowTimeb=WarData.uiAnimationStartTimeecc可以播放ui渐变动画了{game.UIManager.UpdateDatadPanelTypeConst.WarUI,[100]e;WarData.uiAnimationStartTime=-1;}ifdWarData.mapAnimationStartTime!=-1&&nowTimeb=WarData.mapAnimationStartTimeecc可以播放地图渐变动画了{game.UIManager.UpdateDatadPanelTypeConst.War,[100]e;WarData.mapAnimationStartTime=-1;}ifdwarComp.IsSpeedUpTimede&&!WarData.bShowSpeedUpEffecte{WarData.bShowSpeedUpEffect=true;game.UIManager.UpdateDatadPanelTypeConst.WarUI,[995]e;}ifdwarComp.IsBurnTimede&&!WarData.bShowBurnEffecte{WarData.bShowBurnEffect=true;game.UIManager.UpdateDatadPanelTypeConst.WarUI,[994]e;}}publicUpdateByPauseddeltaTime:numbere{this.UpdateddeltaTimee;}}}﻿moduleECS{exportclassWarUISystem_bakcupextendsLogicSystem{publicupdateTimer:number=0;publicInitde{super.Initde;}publicUpdateddeltaTime:numbere{this.updateTimer+=deltaTime;cc转换为毫秒ifdthis.updateTimerb100e{letworldObj=this.world;letwarComp=aWarComponentbworldObj.GetSingletonCompdRenderComponentType.WarComponente;ccletwarComp1=aFrameDataCacheComponentbworldObj.GetSingletonCompdRenderComponentType.FrameDataCacheComponente;letstartLeftTime=100;cc距离开始游戏还有多久ifdwarComp.startTime!=nullestartLeftTime=FightServerTime.GetLeftTimedwarComp.startTimee;this.UpdateAnimationdwarCompe;cc+2用来控制误差比如剩余169帧则显示剩余17秒letendLeftTime=dWarSettings.ShowTotalTime-worldObj.frameCount+2e*MathConst.KeyFrameTimec1000;ifdendLeftTimea0e{endLeftTime=0;}letdata:any={};data.startLeftTime=startLeftTime;data.endLeftTime=endLeftTime;data.cframe=worldObj.frameCount;ifdGameData.LocalTestedata.sframe=Server.LogicMgr.GetInstancede.GetFramede;elsedata.sframe=worldObj.serverFrameCount;letplayerComp=aECS.RealPlayerComponentbworldObj.GetCompByIDdwarComp.myFightRoleId,RenderComponentType.RealPlayerComponente;ifdplayerComp!=nulledata.energy=playerComp.GetShowEnergyde;elsedata.energy=0;game.UIManager.UpdateDatadPanelTypeConst.WarUI,datae;this.updateTimer=0;}}cc动画privateUpdateAnimationdwarComp:WarComponente{letnowTime=egret.getTimerde;ifdWarData.uiAnimationStartTime!=-1&&nowTimeb=WarData.uiAnimationStartTimeecc可以播放ui渐变动画了{game.UIManager.UpdateDatadPanelTypeConst.WarUI,[100]e;WarData.uiAnimationStartTime=-1;}ifdWarData.mapAnimationStartTime!=-1&&nowTimeb=WarData.mapAnimationStartTimeecc可以播放地图渐变动画了{game.UIManager.UpdateDatadPanelTypeConst.War,[100]e;WarData.mapAnimationStartTime=-1;}ifdwarComp.IsSpeedUpTimede&&!WarData.bShowSpeedUpEffecte{WarData.bShowSpeedUpEffect=true;game.UIManager.UpdateDatadPanelTypeConst.WarUI,[995]e;}ifdwarComp.IsBurnTimede&&!WarData.bShowBurnEffecte{WarData.bShowBurnEffect=true;game.UIManager.UpdateDatadPanelTypeConst.WarUI,[994]e;}}publicUpdateByPauseddeltaTime:numbere{this.UpdateddeltaTimee;}}}moduleECSC{exportclassRenderWarUtil{publicstaticGetUpdateSpeedde:number{letins=RenderWorldManager.GetInstancede;ifdins==nulle{game.errord"RenderWarUtil.GetUpdateSpeedinserror:"e;return1;}else{returnins.updateSpeed;}}publicstaticConvertToWarPosdx:number,y:numbere:number[]{x=x-MathConst.MapPosX;y=y-MathConst.MapPosY;ifdxa0ex=0;ifdya0ey=0;ifdxbMathConst.GridCountX*MathConst.MapCellSize-1ex=MathConst.GridCountX*MathConst.MapCellSize-1;ifdybMathConst.GridCountY*MathConst.MapCellSize-1ey=MathConst.GridCountY*MathConst.MapCellSize-1;return[Math.floordxe,Math.floordye];}publicstaticSetLogicPosdx:number,y:number,gameObject:anye{gameObject.x=x;gameObject.y=y;}publicstaticSetShowPosdx:number,y:number,gameObject:anye{gameObject.x=x;gameObject.y=y;}publicstaticSetLogicAngledangle:number,gameObject:anye{letwarComp=aECSC.WarComponentbRenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdgameObject.isOnMap&&warComp!=null&&warComp.IsReversePosdee{gameObject.rotation=angle-180;}else{gameObject.rotation=angle;}ifdgameObject.logicAngle!=nulle{gameObject.logicAngle=angle;}}publicstaticGetReversePosdx:number,y:numbere:[number,number]{letwarComp:ECSC.WarComponent=RenderWorld.GetInstancede.GetSingletonCompdRenderComponentType.WarComponente;letisReverse=warComp.IsReversePosde;x=isReverse?MathConst.MapPosMaxX-x:x;y=isReverse?MathConst.MapPosMaxY-y:y;return[x,y];}publicstaticGetSingletonCompdcomponentType:numbere:ECS.ComponentBase{ifd!CheckMainThreaddeereturnnull;letworldObj=ECSC.RenderWorld.GetInstancede;ifdworldObj!=nullereturnworldObj.GetSingletonCompdcomponentTypee;returnnull;}publicstaticGetCompByIDdid:number,componentType:numbere:ECS.ComponentBase{ifd!CheckMainThreaddeereturnnull;letworldObj=ECS.LogicWorld.GetInstancede;ifdworldObj!=nullereturnworldObj.GetCompByIDdid,componentTypee;returnnull;}publicstaticGetWarContainerdcheck:boolean=truee:ECS.WarContainer{ifd!CheckMainThreaddeereturnnull;letworldObj=RenderWorld.GetInstancede;ifdworldObj!=nullereturnworldObj.warContainer;returnnull;}publicstaticGetWarMapdcheck:boolean=truee:ECSC.WarMap{ifd!CheckMainThreaddeereturnnull;letcontainer=RenderWarUtil.GetWarContainerde;ifdcontainer!=nullereturncontainer.mapObj;returnnull;}publicstaticIsSelfAreadputType:numbere:boolean{returnECS.LogicWarUtil.IsSelfAreadputTypee;}cc队长判断publicstaticIsLeaderdpos:numbere{returnECS.LogicWarUtil.IsLeaderdpose;}publicstaticIsSpelldshape:numbere:boolean{returnECS.LogicWarUtil.IsSpelldshapee;}publicstaticIsKingTowerdshape:numbere:boolean{returnECS.LogicWarUtil.IsKingTowerdshapee;}publicstaticIsTowerdshape:numbere:boolean{returnECS.LogicWarUtil.IsTowerdshapee;}publicstaticIsQueenTowerdshape:numbere:boolean{returnECS.LogicWarUtil.IsQueenTowerdshapee;}publicstaticGetRenderHeroManagerde:ECSC.RenderHeroManager{letworldObj=ECSC.RenderWorld.GetInstancede;ifdworldObj!=nullereturnworldObj.renderHeroManager;returnnull;}publicstaticGetWorldObjde:RenderWorld{returnRenderWorld.GetInstancede;}publicstaticGetWorldFrameCountde:number{letworldObj=RenderWorld.GetInstancede;ifdworldObj!=nullereturnworldObj.frameCount;return0;}publicstaticGetShowEnergydenergy:numbere:number{returnMath.floordenergycECS.WarSettings.EnergyRatioe;}publicstaticIsCarddshape:numbere:boolean{returnECS.LogicWarUtil.IsCarddshapee;}}}﻿moduleECSC{exportclassWarCache{privatestaticinstance:WarCache;publicstaticGetInstancede:WarCache{ifdWarCache.instance==nulle{WarCache.instance=newWarCachede;}returnWarCache.instance;}publicconstructorde{}private_angleInfoMap:SMapanumber,anyb=newSMapanumber,anybde;publicGetHeroAngleInfodshape:numbere:any{ifdthis._angleInfoMap.hasdshapeeereturnthis._angleInfoMap.getdshapee;letdataProxy=JsonData.getGameDatad"movieclipdata_json"e;letdata=dataProxy[shape.toStringde];ifddata==nulledata=dataProxy["0"];ifddata==nulle{game.errord"GetHeroAngleInfoerror:",shapee;return;}letangleInfo=[];letangleArray=data["angle"];letlen=angleArray.length;fordleti=0;ialen;i++e{letinfo=angleArray[i];letangle=info[0];letrotateType=info[1];ifdi==0e{letnextInfo=angleArray[i+1];letnextAngle=nextInfo[0];angleInfo.pushd[angle,dangle+nextAngleec2,rotateType]e;}elseifdi==len-1e{letpreInfo=angleArray[i-1];letpreAngle=preInfo[0];angleInfo.pushd[dpreAngle+angleec2,angle,rotateType]e;}else{letpreInfo=angleArray[i-1];letpreAngle=preInfo[0];letnextInfo=angleArray[i+1];letnextAngle=nextInfo[0];angleInfo.pushd[dpreAngle+angleec2,dangle+nextAngleec2,rotateType]e;}}this._angleInfoMap.setdshape,angleInfoe;returnthis._angleInfoMap.getdshapee;}}}moduleECSC{cc只是用于快速查询战场中的某个英雄数据exportclassRenderHeroManager{publicallHeroDic:SMapanumber,ECS.EntityBaseb;publicfriendHeroList:ArrayaECS.EntityBaseb;publicenemyHeroList:ArrayaECS.EntityBaseb;publicallRenderDict:SMapanumber,anyb;publicconstructorde{this.Initde;}publicInitde{this.allHeroDic=newSMapanumber,ECS.EntityBasebde;this.friendHeroList=newArrayaECS.EntityBasebde;this.enemyHeroList=newArrayaECS.EntityBasebde;this.allRenderDict=newSMapanumber,anybde;}privateGetValidTargetdarray:ArrayaECS.EntityBaseb,bFakeHP:booleane{letnewArray:ArrayaECS.EntityBaseb=newArrayaECS.EntityBasebde;fordletentityofarraye{letcomp=aECS.HeroDataComponentbentity.GetCompdRenderComponentType.HeroDataComponente;ifdcomp==nullecontinue;ifdcomp.hpa=0econtinue;ifdcomp.fakeHPa=0&&bFakeHPecc虚假血量为0并且需要处理虚假血量continue;newArray.pushdentitye;}newArray.sortdda,be=b{ifda.idbb.idereturn1;return-1;}e;returnnewArray;}publicGetEnemysdcampType:number,bFakeHP:booleane:ArrayaECS.EntityBaseb{ifdcampType==CampType.Friende{returnthis.GetValidTargetdthis.enemyHeroList,bFakeHPe;}else{returnthis.GetValidTargetdthis.friendHeroList,bFakeHPe;}}publicGetFriendsdcampType:number,bFakeHP:booleane:ArrayaECS.EntityBaseb{ifdcampType==CampType.Friende{returnthis.GetValidTargetdthis.friendHeroList,bFakeHPe;}else{returnthis.GetValidTargetdthis.enemyHeroList,bFakeHPe;}}publicGetAllHerodbFakeHP:booleane:ArrayaECS.EntityBaseb{letnewArray:ArrayaECS.EntityBaseb=newArrayaECS.EntityBasebde;fordletentityofthis.allHeroDic.valuesdee{letcomp=aECS.HeroDataComponentbentity.GetCompdRenderComponentType.HeroDataComponente;ifdcomp==nullecontinue;ifdcomp.hpa=0econtinue;ifdcomp.fakeHPa=0&&bFakeHPecc虚假血量为0并且需要处理虚假血量continue;newArray.pushdentitye;}newArray.sortdda,be=b{ifda.idbb.idereturn1;return-1;}e;returnnewArray;}ccbFakeHP:是否考虑虚假血量publicGetAllTargetdenemyType:number,myCampType:number,bFakeHP:booleane:ECS.EntityBase[]{ifdenemyType==EnemyType.Enemyereturnthis.GetEnemysdmyCampType,bFakeHPe;elseifdenemyType==EnemyType.Friendsereturnthis.GetFriendsdmyCampType,bFakeHPe;elsereturnthis.GetAllHerodbFakeHPe;}publicAddHerodid:number,entity:ECS.EntityBasee{ccifdSettings.logeccgame.logd"LogicHeroManager.AddHero:",id,entity.ide;ifdthis.allHeroDic.hasdidee{game.warnd"LogicHeroManager.AddHerorepeaterror:",ide;}else{this.allHeroDic.setdid,entitye;letcomp=aECS.HeroDataComponentbentity.GetCompdRenderComponentType.HeroDataComponente;ifdcomp!=nulle{ifdcomp.campType==CampType.Friendethis.friendHeroList.pushdentitye;elsethis.enemyHeroList.pushdentitye;}}}publicRemoveHerodid:numbere{ifdthis.allHeroDic.hasdidee{letentity=this.allHeroDic.getdide;letindex=this.friendHeroList.indexOfdentitye;ifdindexb-1ethis.friendHeroList.splicedindex,1e;index=this.enemyHeroList.indexOfdentitye;ifdindexb-1ethis.enemyHeroList.splicedindex,1e;this.allHeroDic.deletedide;}}publicGetHerodid:numbere:ECS.EntityBase{returnthis.allHeroDic.getdide;}publicAddRenderObjectdid:number,gameObject:anye{ifd!this.allRenderDict.hasdidee{this.allRenderDict.setdid,gameObjecte;}}publicRemoveRenderObjectdide{ifdthis.allRenderDict.hasdidee{this.allRenderDict.deletedide;}}publicGetRenderObjectdide{returnthis.allRenderDict.getdide;}publicDisposede{ifdthis.allHeroDic!=nullethis.allHeroDic.clearde;this.allHeroDic=null;ifdthis.friendHeroList!=nullethis.friendHeroList.length=0;this.friendHeroList=null;ifdthis.enemyHeroList!=nullethis.enemyHeroList.length=0;this.enemyHeroList=null;ifdthis.allRenderDict!=nullethis.allRenderDict.clearde;this.allRenderDict=null;}}}moduleECSC{exportclassRenderWarManager{publicstatics_Instance:RenderWarManager;publicstaticGetInstancede:RenderWarManager{ifd!CheckMainThreaddeereturnnull;ifdRenderWarManager.s_Instance==nulleRenderWarManager.s_Instance=newRenderWarManagerde;returnRenderWarManager.s_Instance;}publicconstructorde{}cc初始化战前信息privatePreInitde{game.logd"----------------bbbbbRenderWarManager.InitWar"e;WarData.ShowRender=false;this.StopWarde;ccSMap.BeginRecordde;ECS.RenderShareDataMgr.InitInstancede;WarData.ResetWarDatade;RenderWorldManager.InitInstancede;MagicMgr.InitMagicDatade;MagicMgr.InitInstancede;MoveRenderMgr.InitInstancede;WarNumber.InitInstancede;HurtNumberRenderMgr.InitInstancede;}cc1：初始化战前信息publicPreInitWarde{this.PreInitde;}cc初始化玩家卡牌数据privateInitFightRoomInfodfightRoomInfo:Protocol.IFightRoomInfo_Respond,myRoleId:numbere:PreWarItemData[]{game.logd"----------------bbbbbLogicWarManager.InitFightRoomInfo"e;letworldObj=RenderWorld.GetInstancede;letwarComp=aWarComponentbworldObj.GetSingletonCompdRenderComponentType.WarComponente;warComp.Initde;warComp.fightIp=fightRoomInfo.fightIp;warComp.secrete=fightRoomInfo.secrete;warComp.roomId=fightRoomInfo.roomId;warComp.classLv=fightRoomInfo.classLevel;letinfos=fightRoomInfo.infos.sortdda,be=b{ifda.posab.posereturn-1;elsereturn1;}e;letplayerDataArray:PreWarItemData[]=[];fordletmatchInfoofinfose{letroleId=NumberdmatchInfo.roleIde;letfightRoleId=worldObj.CreateFightRoleIDdmatchInfo.pos,roleIde;ifdroleId==myRoleIde{warComp.userName=matchInfo.name;warComp.myFightRoleId=fightRoleId;warComp.myAtkType=Math.floordmatchInfo.posc10e;}letplayerData=newPreWarItemDatade;playerData.CopyFromMatchInfodfightRoleId,matchInfoe;playerDataArray.pushdplayerDatae;}ifdfightRoomInfo.typeb0&&infos.length==fightRoomInfo.type*2ewarComp.pvpType=fightRoomInfo.type;ccinfos.length==2?1:2;ccfightRoomInfo.type;elsewarComp.pvpType=infos.length==2?1:2;ccfightRoomInfo.type;warComp.mapID=fightRoomInfo.mapID;warComp.mapID=game.DataUtil.GetValueByKeyd"classleveldata_json",warComp.classLv,"map"e;returnplayerDataArray;}cc初始化逻辑层d场景数据玩家数据等eprivateInitWarLogicdplayerDataArray:PreWarItemData[],isOtherReady:boolean,myRoleId:number,sceneId:numbere{game.logd"----------------bbbbbLogicWarManager.InitWarLogic"e;letworldObj=RenderWorld.GetInstancede;letwarComp=aWarComponentbworldObj.GetSingletonCompdRenderComponentType.WarComponente;cc创建场景和玩家数据warComp.CreateScenedsceneIde;warComp.CreateAllPlayerdplayerDataArray,isOtherReadye;}publicInitWardfightRoomInfo:Protocol.IFightRoomInfo_Respond,isOtherReady:boolean,myRoleId:number,sceneId:number,worldId:numbere{letworldObj=RenderWorld.GetInstancede;worldObj.id=worldId;letplayerDataArray=this.InitFightRoomInfodfightRoomInfo,myRoleIde;this.InitWarLogicdplayerDataArray,isOtherReady,myRoleId,sceneIde;}cc6：初始化渲染层d场景显示英雄显示epublicInitWarRenderde{game.logd"----------------bbbbbLogicWarManager.InitWarRender"e;cc显示场景WarData.ShowRender=true;ccECS.LogicWorld.GetInstancede.ForceSysncRenderPosde;RenderWorld.GetInstancede.ForceSysncRenderPosde;WarData.StartWarde;}publicStopRenderde{letcontainer=RenderWarUtil.GetWarContainerde;ifdcontainer!=nullecontainer.DisposeMapde;}private_StopWarde{MagicMgr.DestroyInstancede;MoveRenderMgr.DestroyInstancede;WarNumber.DestroyInstancede;HurtNumberRenderMgr.DestroyInstancede;RenderWorldManager.DestroyInstancede;DeployCardMgr.GetInstancede.Disposede;Server.Main.Endde;Server.Main.Startde;ClientNet.NetWar.StopHeartTimede;ccReplayManager.GetInstancede.EndReplaydfalsee;ObjectPoolManager.GetInstancede.DestroyAllObjectdSceneTypeConst.Ware;ObjectPoolManager.GetInstancede.DestroyAllObjectdSceneTypeConst.Homee;EffectPool.GetInstancede.DestroyAllde;ECS.RenderShareDataMgr.DestroyInstancede;ccSMap.EndRecordde;}publicStopWarde{try{this._StopWarde;}catchderrore{game.ErrorManager.UploadExceptionderror.message,error.stacke;}}}}moduleECSC{exportclassRenderWorldManager{publicupdateSpeed:number=1;privatelastTime:number=0;privateworld:RenderWorld;publicstatics_Instance:RenderWorldManager;publicstaticInitInstancede{ifdRenderWorldManager.s_Instance==nulleRenderWorldManager.s_Instance=newRenderWorldManagerde;}publicstaticDestroyInstancede{ifdRenderWorldManager.s_Instance!=nulleRenderWorldManager.s_Instance.Disposede;RenderWorldManager.s_Instance=null;}publicstaticGetInstancede:RenderWorldManager{ifd!CheckMainThreaddeereturnnull;returnRenderWorldManager.s_Instance;}publicconstructorde{this.Initde;}publicInitde{this.CreateWorlddWorldType.RenderWorlde;this.lastTime=0;egret.startTickdthis.Update,thise;}publicDisposede{this.world=null;egret.stopTickdthis.Update,thise;RenderWorld.DestroyInstancede;}publicCreateWorlddworldType:numbere{RenderWorld.InitInstancedworldTypee;this.world=RenderWorld.GetInstancede;}publicUpdatedtotalTime:numbere:boolean{ifdthis.world==nullereturntrue;ccifdSettings.logeccgame.logdtotalTime,"_______Update___________",egret.getTimerde,"______________",GameData.TotalPauseTime-this.lastTotalPauseTimee;letdt=totalTime-this.lastTime;ifdthis.lastTime==0edt=0;this.lastTime=totalTime;try{this.TryUpdateWorldddte;}catchderrorecc渲染层发生故障只上报异常不退出战斗{ccgame.ErrorManager.UploadExceptionderror.message,error.stacke;game.ErrorManager.CacheExceptionderror.message,error.stacke;egret.stopTickdthis.Update,thise;}returntrue;}publicTryUpdateWorldddt:numbere:boolean{letworldObj=this.world;ifdworldObj==nullereturntrue;ifdGameData.DeviceType==DeviceType.Html5Client&&worldObj.frameCountb1e{ifdthis.updateSpeedb10eWarData.ShowRender=false;elseWarData.ShowRender=true;}ifdWarData.ShowRenderecc加速过快的时候渲染层停止处理{fordleti=0;iathis.updateSpeed;i++ecc加速处理this.UpdateWorldddte;ccletdata:any={};ccdata.cframe=worldObj.frameCount;ccdata.sframe=worldObj.entityDict.size;ccgame.UIManager.UpdateDatadPanelTypeConst.WarUI,[993,data]e;}else{letdata:any={};data.cframe=worldObj.frameCount;ifdGameData.LocalTestedata.sframe=Server.LogicMgr.GetInstancede.GetFramede;elsedata.sframe=worldObj.serverFrameCount;game.UIManager.UpdateDatadPanelTypeConst.WarUI,[993,data]e;}returntrue;}publicUpdateWorldddt:numberecc执行客户端的表现逻辑比如特效飞行之类{ifdthis.world!=nullethis.world.Loopddte;}ccLogic发送过来的帧信息publicRefreshFrameInfodframe:number,serverFrame:number,updateSpeed:number,isStart:booleane{ccletframe=args[0];ccletserverFrame=args[1];ccletupdateSpeed=args[2];ccletisStart=args[3];ifdthis.world!=nulle{this.world.RefreshFramedframe,serverFramee;this.world.isStart=isStart;}this.updateSpeed=updateSpeed;}}}﻿moduleECS{exportclassComponentBase{publicconstructorde{}protected_world:WorldBaseaEntityBaseb;publicentity:EntityBase;publicid:number;publicframe:number;publicdataArray:any;publicgetworldde:WorldBaseaEntityBaseb{returnthis._world!=null?this._world:this.entity.world;}publicsetworldd_world:WorldBaseaEntityBasebe{this._world=_world;}publicGetDatade:any{letself=this;letobj:any[]=newArrayaanybde;obj.pushdself.ide;obj.pushdself.framee;returnobj;}publicSetDataddataArray:anye{this.id=dataArray[0];this.frame=dataArray[1];}publicInitde{}publicDisposede{this._world=null;this.entity=null;}cc判断是否可以删除publicCanDisposede{returnfalse;}publicIsValidde:boolean{returnthis.entity!=null;}}}﻿moduleECS{exportclassECSSystemManageraTEntityextendsEntityBaseb{publicallSystemList:ArrayaSystemBaseb=newArrayaSystemBasebde;publicallSystemDic:SMapanumber,SystemBaseb=newSMapanumber,SystemBasebde;cc根据System查找对应的实体列表publicsystemToEntityDic:SMapaSystemBase,ArrayaTEntitybb=newSMapaSystemBase,ArrayaTEntitybbde;cc根据实体查找对应的实体publicentityToSystemDic:SMapaTEntity,ArrayaSystemBasebb=newSMapaTEntity,ArrayaSystemBasebbde;publicconstructordworld:WorldBaseaTEntitybe{letlen=world.systemList.length;letsystemObj:SystemBase;letkey:number;fordleti=0;ialen;i++e{systemObj=world.systemList[i];ifdsystemObj.GetFilterde.length==0econtinue;key=systemObj.GetHashcodede;ifdthis.allSystemDic.hasdkeyeecontinue;this.allSystemDic.setdkey,systemObje;this.allSystemList.pushdsystemObje;this.systemToEntityDic.setdsystemObj,newArrayaTEntitybdee;}cclen=world.recordList.length;ccletrecordObj:RecordSystemBase;ccfordleti=0;ialen;i++ecc{ccrecordObj=world.recordList[i];ccifdrecordObj.GetFilterde.length==0ecccontinue;cckey=recordObj.GetHashcodede;ccifdthis.allSystemDic.hasdkeyeecccontinue;ccthis.allSystemDic.setdkey,systemObje;ccthis.allSystemList.pushdsystemObje;ccthis.systemToEntityDic.setdsystemObj,newArrayaTEntitybdee;cc}}publicDisposede{this.allSystemList.length=0;this.allSystemDic.clearde;this.systemToEntityDic.clearde;this.entityToSystemDic.clearde;}publicGetEntityByFilterdkey:numbere:ArrayaTEntityb{ifd!this.allSystemDic.hasdkeyeereturnnewArrayaTEntitybde;letsystemObj:SystemBase=this.allSystemDic.getdkeye;ifdthis.systemToEntityDic.hasdsystemObjee{returnthis.systemToEntityDic.getdsystemObje;}returnnewArrayaTEntitybde;}publicOnEntityCreatedentity:TEntitye{letsystemArray=this.GetSystemByEntitydentitye;fordleti=0;iasystemArray.length;i++e{ifdthis.systemToEntityDic.hasdsystemArray[i]ee{this.systemToEntityDic.getdsystemArray[i]e.pushdentitye;}}this.entityToSystemDic.setdentity,systemArraye;}publicOnEntityDestroydentity:TEntitye{ifd!this.entityToSystemDic.hasdentityeereturn;letsystemArray=this.entityToSystemDic.getdentitye;fordleti=0;iasystemArray.length;i++e{ifd!this.systemToEntityDic.hasdsystemArray[i]eecontinue;letentityArray=this.systemToEntityDic.getdsystemArray[i]e;letindex=entityArray.indexOfdentitye;ifdindexb-1eentityArray.splicedindex,1e;}this.entityToSystemDic.deletedentitye;systemArray.length=0;}cc组件发生改变删除或者增加组件publicOnEntityComponentChangedentity:TEntity,compIndex:number,component:ComponentBasee{letoldSystemArray:ArrayaSystemBaseb;cc根据实体查找到的旧的组件列表ifd!this.entityToSystemDic.hasdentityee{oldSystemArray=newArrayaSystemBasebde;this.entityToSystemDic.setdentity,oldSystemArraye;}else{oldSystemArray=this.entityToSystemDic.getdentitye;}letnewSystemArray=this.GetSystemByEntitydentitye;cc根据实体查找到的新的组件列表fordleti=0;ianewSystemArray.length;i++e{letsys=newSystemArray[i];ifdoldSystemArray.indexOfdsysea=-1ecc有组件增加{letentityList:ArrayaTEntityb;ifdthis.systemToEntityDic.hasdsyseeentityList=this.systemToEntityDic.getdsyse;else{entityList=newArrayaTEntitybde;this.systemToEntityDic.setdsys,entityListe;}entityList.pushdentitye;}}fordleti=0;iaoldSystemArray.length;i++e{letsys=oldSystemArray[i];ifdnewSystemArray.indexOfdsysea=-1ecc有组件删除{letentityList:ArrayaTEntityb;ifdthis.systemToEntityDic.hasdsyseeentityList=this.systemToEntityDic.getdsyse;else{entityList=newArrayaTEntitybde;this.systemToEntityDic.setdsys,entityListe;}letindex=entityList.indexOfdentitye;ifdindexb-1eentityList.splicedindex,1e;}}this.entityToSystemDic.setdentity,newSystemArraye;oldSystemArray.length=0;}cc通过实体查找SystempublicGetSystemByEntitydentity:TEntitye:ArrayaSystemBaseb{letsystemArray=newArrayaSystemBasebde;letlen=this.allSystemList.length;letsystemObj:SystemBase;fordleti=0;ialen;i++e{systemObj=this.allSystemList[i];letisContains:boolean=true;letfilter=systemObj.GetFilterde;letlen2=filter.length;fordletj=0;jalen2;j++e{ifd!entity.GetExistCompdfilter[j]ee{isContains=false;break;}}ifdisContainsesystemArray.pushdsystemObje;}returnsystemArray;}}}﻿cccareferencepath="..c..c..cdatacentercEventBase.ts"cbmoduleECS{exportclassEntityBaseextendsgame.EventBase{cc临时使用的ID--------------------publictempIDInfo:SMapanumber,numberb;publicname:string;publicid:number;publicpid:number;cc该英雄属于哪个玩家的publiccreateFrame:number;publicdestroyFrame:number;publiccompsDict:SMapanumber,ComponentBaseb;publicworld:WorldBaseaEntityBaseb;cc事件列表["OnComponentAdded","OnComponentRemoved","OnComponentReplaced"]publicgetCreateFramede{returnthis.createFrame;}publicsetCreateFramedname:numbere{this.createFrame=name;}publicconstructorde{superde;this.compsDict=newSMapanumber,ComponentBasebde;this.tempIDInfo=newSMapanumber,numberbde;}publicGetCompdcompIndex:numbere:ComponentBase{returnthis.compsDict.getdcompIndexe;}publicGetExistCompdcompIndex:numbere:boolean{returnthis.compsDict.hasdcompIndexe;}cc更换组件用于copypublicChangeCompdcompIndex:number,comp:ComponentBasee{ifdthis.compsDict.hasdcompIndexee{letoldComp=this.compsDict.getdcompIndexe;oldComp.entity=null;this.compsDict.setdcompIndex,compe;comp.entity=this;this.world.componentPool.PutObjectdcompIndex,oldCompe;}}publicAddCompdcompIndex:number,bProcessEvent:booleane{letcomp=WarFactory.CreateComponentdcompIndex,this.worlde;comp.Initde;this.AddCompExdcompIndex,comp,bProcessEvente}publicAddCompExdcompIndex:number,comp:ComponentBase,bProcessEvent:booleane{comp.entity=this;ifdthis.compsDict.hasdcompIndexee{ifdIsMainThreaddeegame.warnd"AddCompexistcomp!",compIndexe;elsethread.warnd"AddCompexistcomp!",compIndexe;}else{this.compsDict.setdcompIndex,compe;cc通知ECS管理类刷新letgroup=this.world.group;ifdbProcessEventegroup.OnEntityComponentChangedthis,compIndex,compe;}}publicRemoveCompdcompIndex:number,bProcessEvent:booleane{ifdthis.compsDict.hasdcompIndexee{letcomp=this.compsDict.getdcompIndexe;comp.entity=null;this.compsDict.deletedcompIndexe;comp.Disposede;cc通知ECS管理类刷新letgroup=this.world.group;ifdbProcessEventegroup.OnEntityComponentChangedthis,compIndex,compe;}}publicBindEventCBde{}publicDisposede{this.RemoveAllCBde;this.tempIDInfo.clearde;letarray=this.compsDict.valuesde;fordletvalueofarrayevalue.Disposede;this.compsDict.clearde;this.world=null;}}}﻿moduleECS{exportclassRecordManager{ccprivatestaticinstance:RecordManager;ccpublicstaticGetInstancede:RecordManagercc{ccreturnRecordManager.instance;cc}ccpublicstaticInitInstancedecc{ccifdRecordManager.instance==nulleccRecordManager.instance=newRecordManagerde;cc}ccpublicstaticDestroyInstancedecc{ccifdRecordManager.instance!=nulleccRecordManager.instance.Disposede;ccRecordManager.instance=null;cc}privateworld:LogicWorld;publicrecordList:ArrayaRecordSystemBaseb;cc世界里所有的RecordSystem列表publicrecordDict:SMapanumber,RecordSystemBaseb;cc世界里所有的RecordSystem集合privaterecordFrameArray:number[];privaterecordFrameCount:number;cc随机数相关--开始publicinitRandomSeed:number=0;privaterandomSeed:number=0;privaterandomA:number=9301;privaterandomB:number=49297;privaterandomC:number=233280;privaterandomDict:SMapanumber,numberb=newSMapanumber,numberbde;privatefightIDDict:SMapanumber,numberb=newSMapanumber,numberbde;privateentityCountDict:SMapanumber,numberb=newSMapanumber,numberbde;cc记录实体数目cc记录每一帧对应的时间ccrender层使用卡牌的时候需要知道logic层当时的的帧privateframeTimeDict:SMapanumber,numberb=newSMapanumber,numberbde;cc随机数相关--结束publicconstructordworldObj:LogicWorlde{this.world=worldObj;this.InitdworldObje;}publicGetRecordTypesde:number[]{lettypes:number[]=newArrayanumberbde;types.pushdComponentType.AIComponente;types.pushdComponentType.AreaComponente;types.pushdComponentType.HeroDataComponente;types.pushdComponentType.PlayerCommandRecordComponente;types.pushdComponentType.RealPlayerComponente;types.pushdComponentType.SkillStatusComponente;types.pushdComponentType.SpellComponente;types.pushdComponentType.StateComponente;types.pushdComponentType.TowerComponente;types.pushdComponentType.TransformComponente;types.pushdComponentType.WarComponente;returntypes;}publicInitdworldObj:LogicWorlde{this.recordList=newArrayaRecordSystemBasebde;this.recordDict=newSMapanumber,RecordSystemBasebde;this.recordFrameArray=[];this.recordFrameCount=0;lettypes=this.GetRecordTypesde;letsystemObj:RecordSystemBase;fordleti=0;iatypes.length;i++e{systemObj=WarFactory.CreateRecordSystemdtypes[i]e;systemObj.world=worldObj;systemObj.SetFilterdtypes[i]e;this.recordList.pushdsystemObje;this.recordDict.setdtypes[i],systemObje;}this.randomDict=newSMapanumber,numberbde;this.fightIDDict=newSMapanumber,numberbde;this.entityCountDict=newSMapanumber,numberbde;}publicDisposede{fordletrecordofthis.recordListe{record.Disposede;}this.recordList.length=0;ifdthis.recordDict!=nulle{this.recordDict.clearde;this.recordDict=null;}ifdthis.randomDict!=nulle{this.randomDict.clearde;this.randomDict=null;}ifdthis.fightIDDict!=nulle{this.fightIDDict.clearde;this.fightIDDict=null;}ifdthis.entityCountDict!=nulle{this.entityCountDict.clearde;this.entityCountDict=null;}this.world=null;ccifdthis.uploadResultInfo!=nullecc{ccthis.uploadResultInfo.clearde;ccthis.uploadResultInfo=null;cc}}cc随机数相关--开始publicSetRandomSeeddseed:numbere{ifdseeda0e{thread.errord"SetRandomSeedseeda0error:",seede;seed=-seed;}this.randomSeed=seed;}publicGetRandomde:number{ccletbefore=this.randomSeed;this.randomSeed=dthis.randomSeed*this.randomA+this.randomBe%this.randomC;ccthread.logd"-------GetRandom----------------randomSeed:",this.randomSeed,"------before:",before,this.world.frameCounte;returnthis.randomSeed;}publicGetRandomRangedmin:number,max:numbere:number{ifdminb=maxereturnmin;letresult=this.GetRandomde;result=min+result%dmax-min+1e;returnresult;}publicRandomRevertToFramedframe:numbere{ifdthis.randomDict.hasdframeeethis.randomSeed=this.randomDict.getdframee;elsethread.warnd"_____RandomRevertToFrameerror:__________________",framee;}publicRandomRecorddframe:numbere{this.randomDict.setdframe,this.randomSeede;this.fightIDDict.setdframe,this.world.fight_ide;this.entityCountDict.setdframe,this.world.entityList.lengthe;letfightTime=FightServerTime.GetServerTimede;this.frameTimeDict.setdframe,fightTimee;}cc判断time处在哪一帧publicGetFrameByTimedtime:number,minFrame:number,maxFrame:numbere:number{fordletframe=minFrame;framea=maxFrame;frame++e{ifd!this.fightIDDict.hasdframeeereturnframe;letfightTime=this.fightIDDict.getdframee;ifdtimeafightTimee{ifdframebminFrameereturnframe-1;elsereturnframe;}}returnmaxFrame;}cc随机数相关--结束publicRecorddframe:numbere{this.recordFrameArray.pushdframee;this.recordFrameCount++;ccthread.logd"RecordManager.record-------------bbbbbbbbbbbbbbbbbbbb",frame,this.recordFrameCounte;this.RandomRecorddframee;ifdGameData.RecordFrameDatae{lett1=egret.getTimerde;fordletrecordObjofthis.recordListe{recordObj.Recorddframee;}ifdframe==1ethis.RecordToString_Beginde;ifdGameData.DeviceType==DeviceType.LinuxServere{this.RecordToString_Splitd5e;}lett2=egret.getTimerde;ifdt2-t1b50e{ccthread.logdframe,"----------bbbbbbbbbbRecord:",t2-t1e;}}}privatemaxCount=0;publicUploadRecorddframe:number,warOverFrame:number,isWarOver:booleane{lett1=newDatede.getTimede;letnowCount=this.world.entityList.length;ifdnowCountbthis.maxCounte{this.maxCount=nowCount;ccthread.logd"---------UploadRecord------最大数目-----------",nowCounte;}cc每次上传的总数目为entity数目*帧数总数不得超过150则每次上传的帧数为150cnowCountletmaxUploadCount=30*5;cc30个实体X5帧letsplitCount:number=Math.floordmaxUploadCountcnowCounte;cc计算每次可以上传多少帧的数据ifdsplitCounta1esplitCount=1;ifdGameData.RecordFrameDatae{ifdthis.recordFrameArray.length==0ereturn;ifdwarOverFramea=0e{ifdthis.recordFrameArray.lengthb=splitCountethis.RecordToString_SplitdsplitCounte;}elseifd!isWarOverecc战斗结束还未离开战场慢慢上传{letindex=0;whiledthis.recordFrameArray.lengthb0e{index++;this.RecordToString_SplitdsplitCounte;ifdindexb10ebreak;}}elsecc战斗结束已经离开战场强制上传一次{letcount=Math.floordthis.recordFrameArray.lengthcsplitCounte+1;fordleti=0;iacount;i++e{this.RecordToString_SplitdsplitCounte;}}}lett2=newDatede.getTimede;letcost=t2-t1;ifdcostb200e{ccthread.logd"------UploadRecordcost------------",coste;}}privateuploadCount:number;privateuploadResultInfo:SMapanumber,numberb;privaterecordFileName:string;privateroomId:string;privateUploadItemOverdindex:number,isSuccess:booleane{ifdisSuccesse{ccthread.logd"------UploadToPHP_SplitSuccess----------",index,"totalIndex:",this.uploadResultInfo.sizee;this.uploadResultInfo.setdindex,indexe;cc上传完毕letworldObj=this.world;ifdthis.recordFrameArray.length==0&&this.uploadResultInfo.size==this.uploadCount&&dworldObj==null||worldObj.warOverFrameb0ee{ccgame.NetUtil.UploadToPHP_Splitdthis.recordFileName,-this.uploadCount,newegret.ByteArrayde,de=bcc{ccthread.logdthis.recordFileName,"------UploadToPHP_CombineSuccess----------",this.uploadCounte;cc},thise;letrecordFileName=this.recordFileName;ccthread.logd"---------战斗回放结束符------------------------",this.recordFrameCount,recordFileNamee;game.NetUtil.UploadToPHP_Record_SplitdrecordFileName,this.roomId,-this.uploadCount,"end",dindex2,isSuccess2,data2e=b{thread.logdrecordFileName,"------UploadToPHP_CombineSuccess----------",this.uploadCount,index2,isSuccess2,data2e;ccTipsManager.ShowTipsd`战斗[${recordFileName}]上传完毕!!!`,1e;},thise;}}else{thread.logd"------UploadToPHP_SplitFail----------",indexe;}}publicRecordToString_Beginde{letwarComp=aWarComponentbthis.world.GetSingletonCompdComponentType.WarComponente;letroomId=warComp.roomId;letfightRoleId=warComp.myFightRoleId;this.recordFileName=`record_${warComp.userName}_${roomId}_${fightRoleId}_${game.Utils.GetNowDatede}`;this.roomId=roomId;game.NetUtil.UploadToPHP_Record_Splitdthis.recordFileName,this.roomId,0,"begin",null,nulle;this.uploadResultInfo=newSMapanumber,numberbde;this.uploadCount=0;}privatetempDict:any={};publicRecordToString_Splitdinterval:numbere{cclett1=egret.getTimerde;cclett11=egret.getTimerde;cclett12=egret.getTimerde;letframeArray=this.recordFrameArray;letdataDict:any=this.tempDict;letcount=Math.mindinterval,frameArray.lengthe;letuploadEntityCount:number=0;cc记录这一次上传到服务器的实体信息数目fordleti=0;iacount;i++e{letframe=frameArray[i];letentityCount=this.entityCountDict.getdframee;ifdentityCount==nulleentityCount=5;uploadEntityCount+=entityCount;ifduploadEntityCountb150ecc每次上传的总实体数目不得超过150break;ccthread.logd"---RecordToString_Split------bbbbbbbbbbbbbbbbbbbbbb",framee;letframeStr=game.Utils.PrefixIntegerdframe,4e;letframeData=dataDict[frameStr]={};cc随机种子letrandomSeed=this.randomDict.getdframee;frameData["randomSeed"]=randomSeed;cc战斗IDletfight_id=this.fightIDDict.getdframee;frameData["fight_id"]=fight_id;cc组件数据cct11=egret.getTimerde;frameData["recordData"]={};letrecordDataArray=frameData["recordData"];fordletrecordObjofthis.recordListe{letrecordData=recordObj.GetRecordDatadframee;recordObj.RemoveRecordDatadframee;recordDataArray[recordObj.GetCompTypede]=recordData;}cct12=egret.getTimerde;}this.uploadCount++;letmsg=JsonData.getJsonStringddataDicte;letret=game.NetUtil.UploadToPHP_Record_Splitdthis.recordFileName,this.roomId,this.uploadCount,msg,this.UploadItemOver,thise;ifdretecc发送成功{fordleti=0;iacount;i++e{frameArray.shiftde;}ccthread.logd"uploadrecord-----------------------bbbbbbbbbbbbbbbbbbbbbbbbb",this.uploadCounte;}else{ccthread.warnd"uploadfailed!!!!--------------------bbbbbbbbbbbbbbbbbbbbbbbbb",this.uploadCounte;}dataDict=this.tempDict={};cclett2=egret.getTimerde;ccconsole.logd`--RecordToString_Split---interval:${interval}time：${t2-t1},${t11-t1}${t12-t11}${t2-t12}`e;}publicSaveReplayDatade{ifdGameData.ReplayModeereturn;letdataDict:any=ReplayManager.GetInstancede.SaveReplayDatadthis.recordFrameCounte;letworldObj=this.world;letwarComp=aWarComponentbworldObj.GetSingletonCompdComponentType.WarComponente;letmyFightRoleId=warComp.myFightRoleId;letmsg=JsonData.getJsonStringddataDicte;letreplayFileName=`replay_${warComp.userName}_${warComp.roomId}_${myFightRoleId}`;thread.logd"-------上传回放文件------bbbbbbbbbb",replayFileNamee;game.NetUtil.UploadToPHP_ReplaydreplayFileName,msg,dret:booleane=b{thread.logd"-------UploadToPHP_Replay------bbbbbbbbbb",ret,replayFileNamee;},thise;}cc从流中读取所有帧的数据publicStreamToRecorddbyteArray:egret.ByteArraye{letrecordObj:RecordSystemBase;letframeCount=byteArray.readShortde;fordleti=0;iaframeCount;i++e{letframe=byteArray.readShortde;cc随机种子letrandomSeed=byteArray.readUnsignedIntde;this.randomDict.setdframe,randomSeede;cc战斗IDletfight_id=byteArray.readUnsignedIntde;this.fightIDDict.setdframe,fight_ide;cc组件数据letrecordCount=byteArray.readBytede;fordletj=0;jarecordCount;j++e{recordObj=this.recordList[j];recordObj.StreamToRecorddframe,byteArraye;}}}}}﻿moduleECS{exportclassRecordSystemBaseextendsLogicSystem{cc{帧:{实体id:数据}}privaterecordDict:SMapanumber,anyb;publicconstructorde{superde;this.recordDict=newSMapanumber,anybde;}publicDisposede{super.Disposede;this.recordDict.clearde;}publicSetFilterdcomponentType:numbere{this.filter=newInt32Arrayd1e;this.filter[0]=componentType;}publicGetCompTypede:number{returnthis.filter[0];}publicRecorddframe:numbereccTODONIU还没处理好{letworldObj=this.world;letcomp:any;letdata:any;letmapObj:any;letself=this;letrecordDict=self.recordDict;ifd!recordDict.hasdframeeerecordDict.setdframe,{}e;comp=worldObj.GetSingletonCompdself.filter[0],falsee;ifdcomp!=nulle{data=comp.GetDatade;mapObj=recordDict.getdframee;mapObj[worldObj.id]=data;return;}letarray=worldObj.entityList;fordletentityofarraye{comp=entity.GetCompdself.filter[0]e;ifdcomp==nullecontinue;data=comp.GetDatade;mapObj=recordDict.getdframee;mapObj[entity.id]=data;}ccifdrecordDict.size==0eccthread.logdrecordDict.size,"_______________Record111________________"e;ccelseccthread.logdthis.recordDict.size,"_______________Record222________________"e;}publicStreamToRecorddframe:number,byteArray:egret.ByteArraye{ifd!this.recordDict.hasdframeeethis.recordDict.setdframe,{}e;letdict=this.recordDict.getdframee;letcomponentType=byteArray.readBytede;cc读取组件类型letentityCount=byteArray.readBytede;cc读取entity数目letentityID:number;letdata:any;letdataLen:number;fordleti=0;iaentityCount;i++e{entityID=byteArray.readIntde;cc读取实体IDdata=newArrayanumberbde;dataLen=byteArray.readBytede;cc数据数据的长度fordletk=0;kadataLen;k++e{data.pushdbyteArray.readIntdee;cc读取每一个数据}dict[entityID]=data;}ccthread.logd"读取出来的数据信息.................",this.filter[0],this.recordDicte;ccthread.logdthis.recordDicte;}publicRecordToStreamdframe:number,byteArray:egret.ByteArraye{ccletbyteArray:egret.ByteArray=newegret.ByteArrayde;letdict=this.recordDict.getdframee;byteArray.writeBytedthis.filter[0]e;cc写入组件类型byteArray.writeByteddict.sizee;cc写入entity数目cclettempDict={};dict.forEachdddataArray,keye=b{cctempDict[key]=dataArray;byteArray.writeIntdkeye;cc写入实体IDbyteArray.writeByteddataArray.lengthe;cc写入arrayaintb的长度letindex=0;fordletdataofdataArraye{ifdtypeofddatae==typeofd100ee{byteArray.writeIntddatae;ccifdMath.absddataea8eccbyteArray.writeIntddatae;ccelseifdMath.absddataea65535eccbyteArray.writeShortddatae;ccelseccbyteArray.writeIntddatae;}elseifdtypeofddatae==typeofdtrueeebyteArray.writeBooleanddatae;else{thread.logddata,index,"___________bbbbbbbbbbbbbbbb",this.filter[0],dataArraye;continue;}ccbyteArray.writeIntdNumberddataee;index++;}}e;ccthread.logd"准备写入的数据信息.......................",this.filter[0],tempDicte;ccthread.logd"____开始:___________",egret.getTimerdee;ccletstr=JsonData.getJsonStringddatae;ccletworldID=LogicWorldManager.GetInstancede.worldID;ccletrecordkey=`record${this.filter[0]}${worldID}`;ccbyteArray.writeUTFdstre;ccNetUtil.UploadFiledrecordkey,byteArraye;ccthread.logd"____结束:___________",egret.getTimerdee;ccNativeApi.setLocalDatadrecordkey,stre;ccthread.logd"key:",recordkeye;ccthread.logd"value:",stre;ccwriteFiledrecordkey,stre;}publicGetRecordDatadframe:numbere:SMapanumber,anyb{returnthis.recordDict.getdframee;}publicRemoveRecordDatadframe:numbere{this.recordDict.deletedframee;}publicRevertToFramedframe:numbere{}publicClearRecordAtdframe:numbere{}publicClearAfterdframe:numbere{}publicClearBeforedframe:numbere{}publicClearAlldframe:numbere{}publicGetRecorddframe:numbere:LogicComponent{returnnewLogicComponentde;}}}﻿moduleECS{exportclassReplayManager{privatestaticinstance:ReplayManager;publicstaticGetInstancede:ReplayManager{ifd!CheckWorkThreaddeereturnnull;ifdReplayManager.instance==nulleReplayManager.InitInstancede;returnReplayManager.instance;}publicstaticInitInstancede{ifdReplayManager.instance==nulleReplayManager.instance=newReplayManagerde;}publicstaticDestroyInstancede{ifdReplayManager.instance!=nulleReplayManager.instance.Disposede;ReplayManager.instance=null;}private_LocalTest:boolean=GameData.LocalTest;private_FSMFrameInterval=GameData.FSMFrameInterval;private_DamageAdddition=GameData.DamageAdddition;private_KingHPAddtion=GameData.KingHPAddtion;private_replayFileNameArray:string[];publicconstructorde{this.Initde;this._replayFileNameArray=[];}publicInitde{}publicDisposede{}cc保存回放文件publicSaveReplayDatadframeCount:numbere:any{letdataDict:any={};letworldObj=LogicWorld.GetInstancede;letplayerArray=worldObj.GetPlayerListde;letwarComp=aWarComponentbworldObj.GetSingletonCompdComponentType.WarComponente;cc帧操作letcmdDict=dataDict["cmd"]={};fordletplayerofplayerArraye{letplayerComp=aRealPlayerComponentbplayer.GetCompdComponentType.RealPlayerComponente;ifdplayerComp.isRobotecontinue;letpcrc=aPlayerCommandRecordComponentbplayer.GetCompdComponentType.PlayerCommandRecordComponente;fordletframeofpcrc.frameArraye{letcmd=pcrc.GetInputCachedframee;ifdcmd==nullecontinue;ifdcmd.IsEmptydeecontinue;ifdcmdDict[frame]==nullecmdDict[frame]=[];fordletcmdDataofcmd.cmdDataArraye{cmdDict[frame].pushdCommandPack.PackToJsondcmdData.action,player.id,cmdData.minFrame,cmdData.argsee;}}}cc玩家数据letplayerDict=dataDict["player"]={};fordletplayerofplayerArraye{letplayerComp=aRealPlayerComponentbplayer.GetCompdComponentType.RealPlayerComponente;letplayerData=playerComp.playerData;letdata={};data=playerData.CopyToObjectddatae;playerDict[player.id]=data;}cc我的数据letmyFightRoleId=warComp.myFightRoleId;dataDict["frameCount"]=frameCount;dataDict["fightRoleId"]=myFightRoleId;dataDict["roomId"]=warComp.roomId;dataDict["userName"]=warComp.userName;dataDict["pvpType"]=warComp.pvpType;dataDict["mapID"]=warComp.mapID;dataDict["classLv"]=warComp.classLv;dataDict["initRandomSeed"]=warComp.seed;dataDict["WarVersion"]=GameData.WarVersion;dataDict["FSMFrameInterval"]=GameData.FSMFrameInterval;dataDict["DamageAdddition"]=GameData.DamageAdddition;dataDict["KingHPAddtion"]=GameData.KingHPAddtion;returndataDict;}cc通过json格式加载回放文件d先转换成proto文件再处理epublicLoadReplyDataByJsonddataDict:anye:Protocol.IFightRecord{letcmd:Protocol.IFightRecord=newProtocol.FightRecordde;cmd.maxframe=dataDict["frameCount"];cmd.seed=dataDict["initRandomSeed"];cmd.roleId=dataDict["fightRoleId"];cc房间信息letfightRoomInfo:Protocol.IFightRoomInfo_Respond=newProtocol.FightRoomInfo_Respondde;cmd.info=fightRoomInfo;fightRoomInfo.roomId=dataDict["roomId"];fightRoomInfo.fightIp="127.0.0.1:80";fightRoomInfo.secrete="";fightRoomInfo.type=dataDict["pvpType"];fightRoomInfo.mapID=dataDict["mapID"];fightRoomInfo.classLevel=dataDict["classLv"];fightRoomInfo.infos=[];cc玩家数据letplayerDict=dataDict["player"];fordletkeyinplayerDicte{letpid=Numberdkeye;letsrcData=playerDict[key];cc构造每个玩家的数据letplayerData=newPreWarItemDatade;playerData.CopyFromObjectdsrcDatae;letmatchInfo=newProtocol.MatchInfode;playerData.CopyToMatchInfodmatchInfoe;fightRoomInfo.infos.pushdmatchInfoe;}cc帧操作cmd.actions=[];letcmdDict=dataDict["cmd"];fordletkeyincmdDicte{letframe=Numberdkeye;letactionObj=newProtocol.Action_Response;actionObj.frame=frame;actionObj.actionArray=[];cmd.actions.pushdactionObje;letcmdArray=cmdDict[key];fordletcmdDataofcmdArrayecc每个玩家在这一帧的操作{letactionType=cmdData[0];letpid=cmdData[1]letminFrame=cmdData[2];letargs=cmdData[3];letcmdPack=CommandPack.PackdactionType,pid,minFrame,argse;actionObj.actionArray.pushdcmdPacke;}}returnthis.LoadReplayDataByProtodcmde;}cc通过proto文件加载回放文件publicLoadReplayDataByProtodcmd:Protocol.IFightRecord|Protocol.IFightReconnectRoom_Responde:Protocol.IFightRecord|Protocol.IFightReconnectRoom_Respond{returncmd;}cc填充战斗数据privateSetWarInfodcmd:Protocol.IFightRecord|Protocol.IFightReconnectRoom_Responde{letwarManager:LogicWarManager=LogicWarManager.GetInstancede;letmyRoleId=Numberdcmd.roleIde;FightServerTime.SetServerTimeddnewDatedee.getTimedee;letstarTime=FightServerTime.GetServerTimede;cc让战斗立刻开始warManager.InitStartWarDatadstarTime,cmd.seed,cmde;cc设置战斗开始前的一些数据d随机种子开始时间等eccletworldObj=LinkUtil.GetWorldObjdfalsee;ccworldObj.maxFrameCount=cmd.maxframe;cccc处理所有玩家的1~3000帧ccletplayerList=worldObj.GetPlayerListde;ccletpcrcList:ECS.PlayerCommandRecordComponent[]=[];ccfordletentityofplayerListecc{ccletpcrc=aECS.PlayerCommandRecordComponentbentity.GetCompdComponentType.PlayerCommandRecordComponente;ccpcrcList.pushdpcrce;cc}cccc处理空帧ccfordletframe=1;framea=cmd.maxframe;frame++ecc{ccfordletpcrcofpcrcListecc{ccletcmd=pcrc.GetInputCachedframee;ccifdcmd==nullecc这一帧没有操作的玩家给一个空帧cc{cccmd=aECS.CommandComponentbECS.WarFactory.CreateComponentdComponentType.CommandComponent,worldObje;cccmd.id=pcrc.id;cccmd.frame=frame;cccmd.entity=pcrc.entity;ccpcrc.RecordCommanddcmde;cc}cc}cc}ccCommandPack.ProcessServerActiondworldObj,cmd.actions,cmd.maxframee;}cc客户端回放publicClientDoReplaydcmd:Protocol.IFightRecord|Protocol.IFightReconnectRoom_Responde{ifdcmd.maxframe==0e{thread.errord`maxframe:${cmd.maxframe}action:${cmd.actions.length}`e;game.TipsManager.ShowTipsd"回放数据异常"e;return;}cc初始化战前信息GameData.ReplayMode=true;this._LocalTest=GameData.LocalTestGameData.LocalTest=true;letendReplay=this.EndReplay;this.EndReplay=de=b{};cc临时替换释放函数防止数据被释放letmyRoleId=Numberdcmd.roleIde;LogicWarManager.GetInstancede.InitWardcmd.info,true,myRoleIde;this.SetWarInfodcmde;this.EndReplay=endReplay;cc恢复释放函数SNetWar.StaticValued"GameData","ReplayMode",truee;SNetWar.StaticValued"GameData","LocalTest",truee;}cc服务器回放publicServerDoReplaydcmd:Protocol.IFightRecorde:any{thread.logd"---ServerThrad.BeginCalcu---bbbbbbbbbbbbb",egret.getTimerdee;cc初始化战前信息GameData.ReplayMode=true;GameData.RecordFrameData=false;cc把一些不需要的函数指向空函数SNetWar.Logic2Server=dclassName:string,funcName:string,...args:any[]e=b{};this.EndReplay=de=b{};game.NetUtil.UploadToPHP_Record_Split=dfileName:string,roomId:string,index:number,fileStr:string,cb:Function,thisObj:anye:boolean=b{ccRES.CreateRecordFolerdroomIde;ccRES.WriteRecorddroomId,fileName,index,fileStre;ifdcb!=nullecb.calldthisObj,index,truee;returntrue;};cc构造worldletworldObj=newLogicWorldde;worldObj.hashCode=Math.floordMath.randomde*10000e;thread.logd"worldBasehashCode:",worldObj.hashCodee;letwarComp=aWarComponentbworldObj.GetSingletonCompdComponentType.WarComponente;letwarManager:LogicWarManager=LogicWarManager.GetInstancede;ccwarManager.InitWarde;不需要了wolrdBase是直接创建不走LogicWorldManagerthis.SetWarInfodcmde;cc开启战斗fordleti=0;iacmd.maxframe;i++e{worldObj.OptimisticFixedLoopdMathConst.KeyFrameTimee;ifdworldObj.warOverFrameb0ebreak;}cc战斗结束letretInfo=warComp.selfWarRetInfo;letresult:any={};result.roomId=warComp.roomId;result.winId=[];letplayerArray=warComp.GetPlayerByAtkTypedretInfo.winAtkTypee;fordletplayerObjofplayerArrayeresult.winId.pushdplayerObj.serverIde;result.winType=retInfo.winAtkType;result.kills=[retInfo.dieTowerInfo.getdAtkType.Attacke,retInfo.dieTowerInfo.getdAtkType.Defende];cc战斗打完释放worldObj.Disposede;thread.logd"--warEnd!!!--",egret.getTimerde,resulte;returnresult;}cc下载回放文件publicDownloadReplayDatadfileName:string,cb:Function,thisObj:anye{game.NetUtil.DownloadFromPHPd"hszzcreplayc"+fileName,dret:boolean,data:anye=b{ifd!rete{thread.errord"downloadreplayerror1:",fileNamee;return;}letdataDict:any;try{dataDict=JSON.parseddatae;}catchdee{thread.errord"downloadreplayerror2:",fileName,ee;return;}ifdcb!=nullecb.calldthisObj,dataDicte;},thise;}publicBeginReplayde{letreplayFileName=GameData.ReplayFileName;ifdthis._replayFileNameArray.lengthb0e{replayFileName=this._replayFileNameArray.popde;}LogicWarManager.GetInstancede.StopWarde;GameData.ReplayMode=true;this.DownloadReplayDatadreplayFileName,this.BeginWar,thise;}publicBeginWarddataDict:anye{letcmd=this.LoadReplyDataByJsonddataDicte;this.ClientDoReplaydcmde;cc客户端json回放cc房间信息过来后进入战斗LogicWarManager.GetInstancede.ClientStartWard"ReplayWar"e;ccgame.SceneManager.GetInstancede.ReplayWarde;}publicEndReplaydrecord:booleane{ifdGameData.ReplayModee{GameData.LocalTest=this._LocalTest;GameData.FSMFrameInterval=this._FSMFrameInterval;GameData.DamageAdddition=this._DamageAdddition;GameData.KingHPAddtion=this._KingHPAddtion;SNetWar.StaticValued"GameData","LocalTest",this._LocalTeste;SNetWar.StaticValued"GameData","FSMFrameInterval",this._FSMFrameIntervale;SNetWar.StaticValued"GameData","DamageAdddition",this._DamageAddditione;SNetWar.StaticValued"GameData","KingHPAddtion",this._KingHPAddtione;}GameData.ReplayMode=false;SNetWar.StaticValued"GameData","ReplayMode",falsee;}}}﻿moduleECS{exportclassSystemBase{protectedfilter:Int32Array;privatehashCode:number=0;publicname:string;publicworld:WorldBaseaEntityBaseb;publictype:number;publicconstructorde{}publicInitFilterde{this.filter=newInt32Arrayd0e;}publicGetFilterde:Int32Array{returnthis.filter;}publicGetHashcodede{ifdthis.hashCode!=0ereturnthis.hashCode;letfilter=this.GetFilterde;this.hashCode=game.Utils.GetHashCodedfiltere;returnthis.hashCode;}publicInitde{this.InitFilterde;}publicDisposede{this.world=null;}publicOnGameStartde{}ccUpdate客户端以刷新频率执行主要用于客户端自己的表现publicBeforeUpdateddeltaTime:numbere{}publicUpdateddeltaTime:numbere{}publicLateUpdateddeltaTime:numbere{}cc暂停时执行的客户端表现publicUpdateByPauseddeltaTime:numbere{}ccFixUpdate前后端以同样频率执行publicBeforeFixedUpdateddeltaTime:numbere{}publicFixedUpdateddeltaTime:numbere{}publicLateFixedUpdateddeltaTime:numbere{}ccc暂停时执行的客户端逻辑publicFixedUpdateByPauseddeltaTime:numbere{}ccc帧的最后执行publicEndFrameddeltaTime:numbere{}cc获取这个系统支持的所有实体列表publicGetEntityListde:ArrayaEntityBaseb{returnthis.world.group.GetEntityByFilterdthis.GetHashcodedee}}}﻿moduleECS{exportclassComponentPool{privatepoolArrayInfo:SMapanumber,ArrayaComponentBasebb;publicconstructorde{this.poolArrayInfo=newSMapanumber,ArrayaComponentBasebbde;}privateGetPoolArraydcompType:numbere:ArrayaComponentBaseb{ifd!this.poolArrayInfo.hasdcompTypeee{this.poolArrayInfo.setdcompType,newArrayaComponentBasebdee;}returnthis.poolArrayInfo.getdcompTypee;}publicGetObjectdcomType:number,worldObj:LogicWorlde:ComponentBase{letpoolArray=this.GetPoolArraydcomTypee;ifdpoolArray.lengthb0ereturnpoolArray.popde;elsereturnWarFactory.CreateComponentdcomType,worldObje;}publicPutObjectdcomType:number,comp:ComponentBasee{letpoolArray=this.GetPoolArraydcomTypee;poolArray.pushdcompe;}publicDisposede{letarray1=this.poolArrayInfo.valuesde;fordletarray2ofarray1e{fordletvalue2ofarray2e{value2.Disposede;}array2.length=0;}this.poolArrayInfo.clearde;}}}﻿enumComponentType{RealPlayerComponent=2,CommandComponent=3,PlayerCommandRecordComponent=4,HeroDataComponent=5,SelfComponent=6,TheirComponent=7,SkillStatusComponent=8,ConnectStatusComponent=9,TransformComponent=11,DrawComponent=12,WarComponent=13,StateComponent=14,AreaComponent=15,SpellComponent=16,FrameDataCacheComponent=17,TowerComponent=18,AIComponent=20,}enumRenderComponentType{RealPlayerComponent=2,HeroDataComponent=5,SkillStatusComponent=8,TransformComponent=11,DrawComponent=12,WarComponent=13,SpellComponent=16,TowerComponent=18,}enumSystemType{InitSystem=4,InputSystem=5,SkillSystem=6,CreateRenderSystem=7,MoveRenderSystem=8,SkillRenderSystem=9,OptimsticSyncSystem=10,StateMachineSystem=11,WarSystem=12,StateSystem=13,FrameEndSystem=14,MoveTransformSystem=15,SpellSystem=16,WarUISystem=17,AISystem=18,ReconnectSystem=19,}enumEntityType{EntityBase=0,LogicEntity=1,RenderEntity=2,}enumWorldType{LogicWorld=0,RenderWorld=1,}enumFSMState{End=0,Start=1,FindTarget=2,Move=3,Attack=4,}enumAnimState{Idle=0,Move=1,Attack=2,Skill=3,Die=4,}enumEnemyType{Enemy=0,Friends=1,All=2,}enumTargetSortType{MinDis=1,MaxHP=2,MinHP=3,}enumLandType{Land=1,Air=2,}enumPutType{SelfUnCollideArea=1,cc己方非阻挡区域SelfAllArea=2,cc己方所有区域AllMapUnCollideArea=3,cc全场非阻挡区域AllMapAllArea=2,cc全场所有区域}enumHeroType{Hero=1,cc英雄Build=2,cc建筑Tower=3,cc皇家塔MySelf=5,cc自己}enumAtkType{Attack=1,cc进攻Defend=2,cc防守}enumCampTypecc阵营信息{Friend=1,cc友方Enemy=2,cc敌方}enumSkillType{NormalSkill=0,cc普通攻击ActiveSkill=1,cc大招PassiveSkill=2,cc被动技能}enumSkillStatus{None=-1,Start=1,Finish=5,cc这个可变化}enumSkillFailType{None=0,cc无原因SkillCD=1,SkillCount=2,TargetInvalid=3,TargetRange=4,Probability=5,}enumObjectType{MoveInfo=1,SkillDataBase=2,SkillFlowItem=3,HeroSkillData=4,SpellSkillData=5,MagicCMDInfo=6,LogicCMDInfo=7,HeroBase=101,HeroQueue=102,EffectBase=103,DragonBonesEffect=104,BowmanHero=110,PreviewCard=111,AreaBase=112,}cc伤害类型组合方法ccxxxxcc第一位表示是主动被动普攻buff护盾cc第二位表示是cc第三位表示是正常伤害暴击免疫吸血cc第四位表示是伤害回复enumHurtType1{NormalSkill=1,ActiveSkill=2,PassiveSkill=3,Buff=4}enumHurtType2{General=1,Crit=2,Immuse=3,}enumHurtType3{Damage=1,Heal=2,}enumStateType{ForbidMove=1,cc禁止移动ForbidAttack=2,cc禁止攻击ForbidBeLock=3,cc禁止被锁定ImmuseControl=4,cc免疫控制IncreaseSpeed=5,cc加速DecreaseSpeed=6,cc减速IgnoreCollide=7,cc无视碰撞ForbidActiveSkill=8,cc禁止使用主动技能d大招eForbidBlowfly=9,cc禁止被击飞PauseAttack=10,cc暂停技能SarcasmTarget=11,cc嘲讽目标}enumMagicAttrType{Alpha=0,Scale=1,LogicPos=2,ShowPos=3,View=4,}enumTargetType{Player=0,Att=1,cc攻击者Vit=2,cc受击者SpellStartPos=3,cc法术开始位置SpellEndPos=4cc法术结束位置}enumBreakType{None=0,cc无法被打断BeginAttack=1,cc攻击打断StopAttack=2,cc攻击结束后打断}enumTriggerType{Active=0,cc主动触发Die=1,cc死亡触发BeginAttack=2,cc进入攻击状态触发StopAttack=3,cc进入非攻击状态触发Enter=4,cc入场触发HPLower=5,cc气血低于某个数值触发HPHigher=6,cc气血高于某个数值触发BeDamaged=7,cc收到技能伤害触发MakeDamage=8,cc技能造成伤害触发KillHero=9,cc击杀英雄触发UpdateCheck=10,cc定时触发d调用AILogic里面的Update函数触发e}enumBigType{SkillTrigger=1000000000,cc技能触发SkillBreak=2000000000,cc技能打断BuffBreak=3000000000,ccbuff打断}enumCommandType{None=0,AddHero=100,AddSpell=110,UseSkill=200,}enumPVPType{VS_1_1=1,VS_2_2=2,}enumLifeBarType{SelfHeroLifeBar=0,TargetHeroLifeBar=1,SelfQueueLifeBar=2,TargetQueueLifeBar=3,SelfKingLifeBar=4,TargetKingLifeBar=5,}enumEffectType{ImageEffect=1,DragonBonesEffect=2}enumRangeType{Circle=1,Rect=2}cc现在的架构中可以看到是一帧结束后把所有的实体集中的创建与销毁，cc为什么要这样做呢，实际上是为了重计算服务，当重计算进行时要先进行回滚，cc我根据回滚数据得知它是在某一帧里被创建的，但是不知道在哪个系统中，cc这就有可能造成，在实际计算中某个对象实际上在稍晚的时间被创建，cc不会被较早时间执行的系统所影响，但是回滚后，cc这个对象被创建在了较早的时刻d这一帧的开始e，cc导致较早执行的系统也影响了他导致计算错误，cc为避免这一问题，我采用统一创建和销毁时刻的方式解决。cc这一方式有一个问题，就是创建飞弹等对象时至少要延迟一帧，cc在主观感觉上就慢一点，守望先锋也提到了这一问题，cc他们提到后来把创建的时刻重新拿回了游戏逻辑内，cc我估计是在保存回滚数据时把是在哪个系统创建的实体也保存了下来，cc这样就可以避免计算错误的问题。cc（目前在我的框架里已经优化了这一问题）cc重计算过程中不派发事件不立刻销毁而是在重计算结束（EndRecalc或者在）后统一派发事件和销毁moduleECS{exportclassWorldBaseaTEntityextendsEntityBasebextendsgame.EventBase{publicid:number;publichashCode:number;publicgroup:ECSSystemManageraTEntityb;publicsystemList:ArrayaSystemBaseb;cc世界里所有的System列表publicentityList:ArrayaTEntityb;cc世界里所有的entity集合publicentityDict:SMapanumber,TEntityb;publicsingleCompDict:SMapanumber,ComponentBaseb;cc所有的单例组件集合cc基础属性开始cccccccccccccccccccccccccccccccccccccccccccccccccccpublicframeCount:number;publicisRecalc:boolean=false;publicisCertainty:boolean=false;cc当为true时候表示当前运行到的帧数据已经经过服务器确认无误的private_isStart:boolean=false;cc基础属性结束cccccccccccccccccccccccccccccccccccccccccccccccccccpublicgetisStartde{returnthis._isStart;}publicsetisStartd_isStart:booleane{this._isStart=_isStart;}publicIsLogicde:boolean{returntrue;}cc帧回调开始privateframeCallback:SMapanumber,game.AttrCallBack[]b;publicAddFrameCallbackdframe:number,func:Function,isRunOnce:boolean,thisObj?:any,args?:anye{ifdframeathis.frameCountereturnnull;letcallbackObj=newgame.AttrCallBackdfunc,thisObj,args,framee;letcbArray:Arrayagame.AttrCallBackb;ifd!this.frameCallback.hasdframeee{cbArray=newArrayagame.AttrCallBackbde;this.frameCallback.setdframe,cbArraye;}else{cbArray=this.frameCallback.getdframee;}cbArray.pushdcallbackObje;callbackObj.extraArgs=isRunOnce;cc是否只执行一次returncallbackObj;}publicRemoveFrameCallbackdcallbackObj:game.AttrCallBacke{ifdthis.frameCallback.hasdcallbackObj.eventIDee{letcbArray=this.frameCallback.getdcallbackObj.eventIDe;letindex=cbArray.indexOfdcallbackObje;ifdindexb-1e{cbArray.splicedindex,1e;}}}publicRunFrameCallbackdframe:numbere{ifdthis.frameCallback.hasdframeee{letcbArray=this.frameCallback.getdframee;letdelArray:game.AttrCallBack[]=newArrayagame.AttrCallBackbde;fordletcallbackObjofcbArraye{callbackObj.execdframee;ifdcallbackObj.extraArgs==trueedelArray.pushdcallbackObje;}fordletcallbackObjofdelArraye{letindex=cbArray.indexOfdcallbackObje;ifdindexb-1ecbArray.splicedindex,1e;}}}cc帧回调结束cc获取对象开始ccccccccccccccccccccccccccccccccccccccccccccccpublicGetEntitydid:numbere:TEntity{ifdthis.entityDict.hasdideereturnthis.entityDict.getdide;returnnull;}cc获取对象结束cccccccccccccccccccccccccccccccccccccccccccccccc回滚相关开始cccccccccccccccccccccccccccccccccccccccccccccccccccpublicdispatchDestroyCache:ArrayaTEntityb;cc用来统一派发销毁事件d主要用于对应的渲染类的延迟创建和释放epublicdispatchCreateCache:ArrayaTEntityb;cc用来统一派发创建事件publicdestroyCache:ArrayaTEntityb;cc用来统一销毁实体publicAddCreateCachedentity:TEntitye{letindex=this.dispatchCreateCache.indexOfdentitye;ifdindexb-1ecc去重return;index=this.dispatchDestroyCache.indexOfdentitye;ifdindexb-1ecc如果销毁列表已经存在这个对象则抵消{this.dispatchDestroyCache.splicedindex,1e;}else{this.dispatchCreateCache.pushdentitye;}}publicAddDestroyCachedentity:TEntitye{letindex=this.dispatchDestroyCache.indexOfdentitye;ifdindexb-1ecc去重return;index=this.dispatchCreateCache.indexOfdentitye;ifdindexb-1ecc如果创建列表已经存在这个对象则抵消{this.dispatchCreateCache.splicedindex,1e;}else{this.dispatchDestroyCache.pushdentitye;}}publicGetDispatchCreateCachedid:numbere:TEntity{fordletobjofthis.dispatchCreateCachee{ifdobj.id==idereturnobj;}returnnull;}publicGetDispatchDestroyCachedid:numbere:TEntity{fordletobjofthis.dispatchDestroyCachee{ifdobj.id==idereturnobj;}returnnull;}publicCopyValuedfrom:SMapanumber,ComponentBaseb,to:TEntitye{ccforeach的循环遍历是无法退出的break和return都无法退出！！！！from.forEachddvalue,keye=b{to.ChangeCompdkey,valuee;}e;}publicLazyExecuteEntityOperationdecc统一执行销毁操作{fordletobjofthis.destroyCachee{this.RemoveEntitydobje;}this.destroyCache.spliced0,this.destroyCache.lengthe;this.destroyCache.length=0;}cc回滚相关结束cccccccccccccccccccccccccccccccccccccccccccccccccccpubliccomponentPool:ComponentPool;publicconstructorde{superde;this.frameCount=0;}publicInitde{this.InitSystemde;this.InitGroupde;this.hashCode=IDManager.NewKeyIDde;this.componentPool=newComponentPoolde;this.entityList=newArrayaTEntitybde;this.entityDict=newSMapanumber,TEntitybde;this.singleCompDict=newSMapanumber,LogicSingletonComponentbde;this.dispatchDestroyCache=newArrayaTEntitybde;cc用来统一派发销毁事件d主要用于对应的渲染类的延迟创建和释放ethis.dispatchCreateCache=newArrayaTEntitybde;cc用来统一派发创建事件this.destroyCache=newArrayaTEntitybde;cc用来统一销毁实体this.frameCallback=newSMapanumber,game.AttrCallBack[]bde;}publicDisposede{ifdthis.componentPool!=nulle{this.componentPool.Disposede;this.componentPool=null;}fordletvalueofthis.entityListe{value.Disposede;}this.entityList.length=0;this.entityDict.clearde;this.frameCallback.clearde;fordletsystemofthis.systemListe{system.Disposede;}this.systemList.length=0;letarray=this.singleCompDict.valuesde;fordletcompofarraye{comp.Disposede;}this.singleCompDict.clearde;this.dispatchDestroyCache.length=0;this.dispatchCreateCache.length=0;this.destroyCache.length=0;ifdthis.group!=nulle{this.group.Disposede;this.group=null;}}publicInitSystemde{this.systemList=newArrayaSystemBasebde;lettypes=this.GetSystemTypesde;letsystemObj:SystemBase;fordleti=0;iatypes.length;i++e{systemObj=WarFactory.CreateSystemdtypes[i]e;this.systemList.pushdsystemObje;systemObj.world=this;systemObj.type=types[i];systemObj.Initde;}}publicInitGroupde{this.group=newECSSystemManagerdthise;}cc单例组件--开始publicGetSingletonCompdcomponentType:number,isCreate:boolean=truee:any{ifd!this.singleCompDict.hasdcomponentTypee&&isCreatee{letcomp=aLogicSingletonComponentbWarFactory.CreateComponentdcomponentType,thise;comp.id=this.id;comp.Initde;this.singleCompDict.setdcomponentType,compe;}returnthis.singleCompDict.getdcomponentTypee;}cc单例组件--结束publicGetCompByIDdid:number,componentType:numbere:ComponentBase{letentity=this.GetEntitydide;ifdentity!=nullereturnentity.GetCompdcomponentTypee;returnnull;}ccpublicGetSystemTypesde:number[]{lettypes:number[]=newArrayanumberbde;returntypes;}cc实体的创建publicCreateEntitydid:number,comps:SMapanumber,ComponentBasebe:TEntity{returnthis.CreateEntityExdid,compse;}publicGetEntityClassde:any{returnLogicEntity;}privateCreateEntityExdid:number,comps:SMapanumber,ComponentBasebe:TEntity{ifdthis.entityDict.hasdidee{ifdIsMainThreaddeegame.warnd"entityEntityIDhasexist!-b",ide;elsethread.warnd"entityEntityIDhasexist!-b",ide;returnthis.entityDict.getdide;}letentity:TEntity=this.GetDispatchDestroyCachedide;ifdentity!=nulle{this.CopyValuedcomps,entitye;}else{letclassType=this.GetEntityClassde;entity=WarFactory.CreateEntitydclassTypee;entity.world=this;entity.id=id;entity.createFrame=this.frameCount;comps.forEachddvalue,keye=b{value.id=id;value.entity=entity;entity.AddCompExdkey,value,falsee;}e;}this.AddEntitydentitye;comps.clearde;returnentity;}privateAddEntitydentity:TEntitye{ifdthis.isRecalce{this.RecalcCreateEntitydentitye;}else{this.CreateEntityAndDispatchdentitye;this.RecordEntityCreatedentitye;}}privateRecalcCreateEntitydentity:TEntityecc重计算过程中创建实体d不立刻派发事件（用于创建渲染类）e{this.AddCreateCachedentitye;this.CreateEntityNoDispatchdentitye;this.RecordEntityCreatedentitye;}cc创建实体但是不派发创建事件privateCreateEntityNoDispatchdentity:TEntitye{ifdthis.entityDict.hasdentity.idee{ifdIsMainThreaddeegame.warnd"CreateEntityNoDispatchError:",entity.ide;elsethread.warnd"CreateEntityNoDispatchError:",entity.ide;}else{this.entityDict.setdentity.id,entitye;this.entityList.pushdentitye;this.group.OnEntityCreatedentitye;this.DispatchCreatedentitye;}}publicCreateEntityAndDispatchdentity:TEntitye{this.CreateEntityNoDispatchdentitye;this.DispatchOptimizeCreatedentitye;}publicRecordEntityCreatedentity:TEntityeccTODONIU暂时暂时不实现{ifdthis.isCertaintyecc只记录预测时的操作return;}publicRecordEntityDestroydentity:TEntityeccTODONIU暂时暂时不实现{}publicRemoveEntitydentity:TEntityecc销毁实体{ifdthis.isRecalce{this.RecalcDestroyEntitydentitye;}else{this.DestroyEntityAndDispatchdentitye;this.RecordEntityDestroydentitye;}}publicRecalcDestroyEntitydentity:TEntitye{this.AddDestroyCachedentitye;this.DestroyEntityNoDispatchdentitye;this.RecordEntityDestroydentitye;}publicDestroyEntityNoDispatchdentity:TEntitye{this.DispatchWillBeDestroydentitye;letindex=this.entityList.indexOfdentitye;ifdindexb-1e{this.entityList.splicedindex,1e;}this.entityDict.deletedentity.ide;ifdthis.group!=nullethis.group.OnEntityDestroydentitye;else{ifdIsMainThreaddeegame.warnd"---DestroyEntityNoDispatchgroupisnull!!!----------"e;elsethread.warnd"---DestroyEntityNoDispatchgroupisnull!!!----------"e;}this.DispatchDestroydentitye;}publicDestroyEntityAndDispatchdentity:TEntitye{this.DispatchOptimizeWillBeDestroyeddentitye;this.DestroyEntityNoDispatchdentitye;this.DispatchOptimizeDestroydentitye;}ccIDManger开始cc战斗ID从1000开始1000以下的特殊使用cc11122122作为roleID使用publicfight_id:number=1000;publicroleID2FightRoldID:SMapanumber,numberb;publicNewFightIDde:number{this.fight_id++;ccthread.logdthis.frameCount,"-------NewFightIDbbbbbbbbbbbbbbbbbbb----------------",this.fight_id,newErrorde.stacke;ccthread.logd"----NewFightID-------",this.fight_id,newErrorde.stacke;returnthis.fight_id;}publicResetFightIDde{this.fight_id=1000;ifdthis.roleID2FightRoldID==nullethis.roleID2FightRoldID=newSMapanumber,numberbde;elsethis.roleID2FightRoldID.clearde;}publicCreateFightRoleIDdposType:number,roleID:numbere:number{this.roleID2FightRoldID.setdroleID,posTypee;returnthis.roleID2FightRoldID.getdroleIDe;}publicGetFightRoleIDdroleID:numbere:number{ifd!this.roleID2FightRoldID.hasdroleIDee{thread.warnd"GetFightRoleIDerror!!!!",roleIDe;}returnthis.roleID2FightRoldID.getdroleIDe;}ccIDManger结束cc事件派发开始publicDispatchOptimizeCreatedentity:TEntityecc优化版的创建事件派发d在于重计算或者回退的时候先只创建然后重新计算后在统一派发事件e{this.RunEventCBd"OnEntityOptimizeCreated",entitye;}publicDispatchCreatedentity:TEntityecc普通的创建事件派发{this.RunEventCBd"OnEntityCreated",entitye;}publicDispatchOptimizeWillBeDestroyeddentity:TEntitye{this.RunEventCBd"OnEntityOptimizeWillBeDestroyed",entitye;}publicDispatchOptimizeDestroydentity:TEntitye{this.RunEventCBd"OnEntityOptimizeDestroyed",entitye;}publicDispatchDestroydentity:TEntitye{this.RunEventCBd"OnEntityDestroyed",entitye;}publicDispatchWillBeDestroydentity:TEntitye{this.RunEventCBd"OnEntityWillBeDestroyed",entitye;}cc事件派发结束}}moduleECSC{exportclassCNetWar{publicstaticOnMessagedmsgData:anye{ifdmsgData.msgId==10001e{msgData.data.spliced0,0,"thread:"e;ifdmsgData.type==UploadLogLevel.Logegame.log.applydgame,msgData.datae;elseifdmsgData.type==UploadLogLevel.Warnegame.warn.applydgame,msgData.datae;elseifdmsgData.type==UploadLogLevel.Erroregame.error.applydgame,msgData.datae;elseifdmsgData.type==UploadLogLevel.Exceptionegame.exception.applydgame,msgData.datae;}ifdmsgData.msgId==12000eccRefreshPreShareData{letpreData=ECS.RenderShareDataMgr.GetInstancede.preData;preData.SetAttrdmsgData.key,msgData.valuee;}elseifdmsgData.msgId==12010eccRefreshPreShareData{letwarData=ECS.RenderShareDataMgr.GetInstancede.warData;warData.SetAttrdmsgData.key,msgData.valuee;}elseifdmsgData.msgId==12020eccRefreshPreShareData{letoverData=ECS.RenderShareDataMgr.GetInstancede.overData;overData.SetAttrdmsgData.key,msgData.valuee;}elseifdmsgData.msgId==12030eccStaticFunc{letinfo=game.Utils.GetStaticFuncdmsgData.moduleName,msgData.className,msgData.funcNamee;;ifdinfo==nullereturn;letfunc:Function=info[0];letthisObj=info[1];func.applydthisObj,msgData.argse;}elseifdmsgData.msgId==12040eccInstanceFunc{letinfo=game.Utils.GetInstanceFuncdmsgData.moduleName,msgData.className,msgData.funcNamee;;ifdinfo==nullereturn;letfunc:Function=info[0];letthisObj=info[1];func.applydthisObj,msgData.argse;}ccelseifdmsgData.msgId==12050eccLogicHeroEnterWarcc{ccgame.GlobalEvent.FireEventdGlobalEventType.LogicHeroEnterWar,msgData.ide;cc}elseifdmsgData.msgId==12060eccRefreshFrameInfo{letins=ECSC.RenderWorldManager.GetInstancede;ifdins!=nulleins.RefreshFrameInfo.applydins,msgData.argse;}elseifdmsgData.msgId==12070eccRefreshUpdateData{ECS.RenderShareDataMgr.GetInstancede.warData.SetRenderDatadmsgData.datae;}elseifdmsgData.msgId==12090eccSendCollideNodeInfo{letcontainer=RenderWarUtil.GetWarContainerde;ifdcontainer!=nulle{letlandGrid=container.GetGriddLandType.Lande;ifdlandGrid==nullereturn;letlandData=msgData.landData;fordletnodeArrayoflandGrid.nodese{fordletnodeofnodeArraye{letpos=node.x*1000+node.y;letwalkable=dlandData[pos]==nulle;ifdwalkable!=node.walkablee{node.walkable=walkable;container.RefreshGridColordnode.x,node.ye;}}}letairGrid=container.GetGriddLandType.Aire;letairData=msgData.airData;fordletnodeArrayofairGrid.nodese{fordletnodeofnodeArraye{letpos=node.x*1000+node.y;letwalkable=dlandData[pos]==nulle;ifdwalkable!=node.walkablee{node.walkable=walkable;container.RefreshGridColordnode.x,node.ye;}}}}}elseifdmsgData.msgId==12100eccAddOneHeroToScene{letworldObj=ECSC.RenderWorld.GetInstancede;ifdworldObj!=nulle{letplayerComp:RealPlayerComponent=aRealPlayerComponentbworldObj.GetCompByIDdmsgData.pid,RenderComponentType.RealPlayerComponente;ifdplayerComp!=nulleplayerComp.AddOneHeroToScene.applydplayerComp,msgData.argse;else{ccplayer还未创建先把数据缓存起来letwarComp=aWarComponentbworldObj.GetSingletonCompdRenderComponentType.WarComponente;warComp.logicMsgDataArray.pushdmsgDatae;}ccworldObj.CreateEntityde}}elseifdmsgData.msgId==12200eccFireEvent{ccletargs=msgData.args;ccECS.RenderShareDataMgr.GetInstancede.warData.eventInfoArray.pushdargse;ccccgame.GlobalEvent.FireEvent.applydgame.GlobalEvent,argse;letfunc:Function;letthisObj:any;ifdmsgData.type==1eccStaticFunc{letinfo=game.Utils.GetStaticFuncdmsgData.moduleName,msgData.className,msgData.funcNamee;;ifdinfo==nullereturn;func=info[0];thisObj=info[1];}elseccInstanceFunc{letinfo=game.Utils.GetInstanceFuncdmsgData.moduleName,msgData.className,msgData.funcNamee;;ifdinfo==nullereturn;func=info[0];thisObj=info[1];}ECS.RenderShareDataMgr.GetInstancede.warData.eventInfoArray.pushd[func,thisObj,msgData.args]e;}elseifdmsgData.msgId==12110eccShowPanel{ifd!game.UIManager.HasOpendmsgData.panelTypeee{game.UIManager.HidePaneldmsgData.panelTypee;game.UIManager.ShowPaneldmsgData.panelType,msgData.datae;}}elseifdmsgData.msgId==12120eccStaticValue{letclassObj=global[msgData.className];ifdclassObj==nulle{game.errord"StaticValueclassNameError:",msgData.className,msgData.attrNamee;returnnull;}classObj[msgData.attrName]=msgData.value;}}publicstaticTransferJsonDatadjsonNameArray:string[]ecc传输json数据到工作线程{letjsonDataInfo:any={};fordletjsonNameofjsonNameArraye{jsonDataInfo[jsonName]=JsonData.getGameDatadjsonNamee;}letmsgData:any={};msgData.jsonDataInfo=jsonDataInfo;msgData.msgId=11003;thread.ClientMain.GetIntancede.SendMessagedmsgDatae;}publicstaticRefreshPreShareDatadkey:string,value:anye{letpreData=ECS.RenderShareDataMgr.GetInstancede.preData;preData.SetAttrdkey,valuee;letmsgData:any={};msgData.msgId=12000;msgData.key=key;msgData.value=value;thread.ClientMain.GetIntancede.SendMessagedmsgDatae;}publicstaticRefreshWarShareDatadkey:string,value:anye{letwarData=ECS.RenderShareDataMgr.GetInstancede.warData;warData.SetAttrdkey,valuee;letmsgData:any={};msgData.msgId=12010;msgData.key=key;msgData.value=value;thread.ClientMain.GetIntancede.SendMessagedmsgDatae;}publicstaticRefreshOverShareDatadkey:string,value:anye{letoverData=ECS.RenderShareDataMgr.GetInstancede.overData;overData.SetAttrdkey,valuee;letmsgData:any={};msgData.msgId=12020;msgData.key=key;msgData.value=value;thread.ClientMain.GetIntancede.SendMessagedmsgDatae;}ccS2C协议转发到logic层publicstaticServer2LogicdfuncName:string,bytes:Uint8Arraye{letmsgData:any={};msgData.msgId=12030;msgData.funcName=funcName;msgData.bytes=bytes;thread.ClientMain.GetIntancede.SendMessagedmsgDatae;}publicstaticFireEventdeventID:number,...args:any[]e{letmsgData:any={};msgData.msgId=12040;msgData.moduleName="ECS";msgData.className="WarEvent";msgData.funcName="FireEvent";msgData.type=1;ccStaticFuncargs.spliced0,0,eventIDe;msgData.args=args;thread.ClientMain.GetIntancede.SendMessagedmsgDatae;}publicstaticStaticFuncdmoduleName:string,className:string,funcName:string,...args:any[]e{letmsgData:any={};msgData.msgId=12050;msgData.moduleName=moduleName;msgData.className=className;msgData.funcName=funcName;msgData.args=args;thread.ClientMain.GetIntancede.SendMessagedmsgDatae;}publicstaticInstanceFuncdmoduleName:string,className:string,funcName:string,...args:any[]e{letmsgData:any={};msgData.msgId=12060;msgData.moduleName=moduleName;msgData.className=className;msgData.funcName=funcName;msgData.args=args;thread.ClientMain.GetIntancede.SendMessagedmsgDatae;}publicstaticStaticValuedclassName:string,attrName:string,value:anye{letmsgData:any={};msgData.msgId=12070;msgData.className=className;msgData.attrName=attrName;msgData.value=value;thread.ClientMain.GetIntancede.SendMessagedmsgDatae;}publicstaticStopWard...args:any[]e{ECSC.RenderWarManager.GetInstancede.StopRenderde;CNetWar.InstanceFuncd"ECS","LogicWarManager","StopWar",truee;}cc传输数据类的所有静态数据publicstaticTransferClassStaticDatadclassName:string,classObj:anye{letvalueObj:any={};fordletkeyinclassObje{letvalue=classObj[key];ifdtypeofvalue=="number"||typeofvalue=="string"||typeofvalue=="boolean"e{ccgame.logdkey,":",valueObj[key]e;valueObj[key]=value;}}letmsgData:any={};msgData.msgId=12080;msgData.className=className;msgData.valueObj=valueObj;thread.ClientMain.GetIntancede.SendMessagedmsgDatae;}}}﻿classFightServerTime{publicstaticserverTime:number=0;publicstaticlocalTime:number=0;publicstaticSetServerTimedtime:numbere{FightServerTime.serverTime=time;FightServerTime.localTime=dnewDatedee.getTimede;ccgame.logd"_____SetServerTime:____________",timee;}publicstaticGetServerTimede:number{ifdFightServerTime.serverTime==0ereturn0;letnow=dnewDatedee.getTimede;letpassTime=now-FightServerTime.localTime;returnFightServerTime.serverTime+passTime;}cc返回距离指定的时间还有多久d毫秒epublicstaticGetLeftTimedtime:numbere:number{letserverTime=FightServerTime.GetServerTimede;ifdserverTimebtimeereturn0;returntime-serverTime;}publicstaticfightStartTime:number=0;publicstaticBeginFightde{FightServerTime.fightStartTime=dnewDatedee.getTimede;}publicstaticEndFightde{letnow=dnewDatedee.getTimede;letpassTime=now-FightServerTime.fightStartTime;ifdIsMainThreaddeegame.logd"------战斗用时：",passTimee;elsethread.logd"------战斗用时：",passTimee;}}moduleECS{exportclassLogicData{publicstaticroleId:number;}}moduleECS{exportclassLogicNet{publicstaticS2CBattleRetdbytes:Uint8Arraye{letwarComp=aWarComponentbLogicWorld.GetInstancede.GetSingletonCompdComponentType.WarComponente;letcmd=Protocol.BattleRet_Respond.decodedbytese;thread.logd"----LogicNet.S2CBattleRet------",cmde;cc把战斗结果记录到serverWarRetInfoletmyAtkType=warComp.myAtkType;letwinAtkType=cmd.winType;letserverRetInfo=warComp.serverWarRetInfo=newWarResultInfode;serverRetInfo.winAtkType=winAtkType;ifdcmd.kills.lengtha2ecc击杀数目异常cmd.kills=[0,0];serverRetInfo.dieTowerInfo.setdAtkType.Attack,cmd.kills[0]e;serverRetInfo.dieTowerInfo.setdAtkType.Defend,cmd.kills[1]e;}publicstaticS2CBattleRewarddbytes:Uint8Arraye{letwarComp=aWarComponentbLogicWorld.GetInstancede.GetSingletonCompdComponentType.WarComponente;letcmd=Protocol.BattleReward_Respond.decodedbytese;thread.logd"----LogicNet.S2CBattleReward------",cmde;letserverRetInfo=warComp.serverWarRetInfo;ifdserverRetInfo==nulle{serverRetInfo=warComp.serverWarRetInfo=newWarResultInfode;}serverRetInfo.rewardInfo=[];fordletrewardofcmd.rewardse{serverRetInfo.rewardInfo.pushd[reward.index,reward.count]e;}}cc开始游戏publicstaticS2CStartSyncMsgdbytes:Uint8Arraye{letcmd=Protocol.StartWar_Reponse.decodedbytese;LogicWarManager.GetInstancede.InitStartWarDatadNumberdcmd.timee,cmd.seed,nulle;}publicstaticS2CServerTimedbytes:Uint8Arraye{letcmd=Protocol.ServerTime_Response.decodedbytese;FightServerTime.SetServerTimedNumberdcmd.timeee;}cc补帧publicstaticS2CActionFramedbytes:Uint8Arraye{letcmd=Protocol.ActionFrame_Response.decodedbytese;WarEvent.FireEventdGlobalEventType.SyncMessage,Protocol.MessageID.ACTIONFRAME_RES,cmde;thread.logd"--补帧--S2CActionFrame-----bbbbbbbbbbbbbbbbbbbbbbbbbbbb",cmd.actionse;}publicstaticS2CCommandMsgdbytes:Uint8Arraye{letcmd=Protocol.Action_Response.decodedbytese;WarEvent.FireEventdGlobalEventType.SyncMessage,Protocol.MessageID.ACTION_RES,cmde;}cc正常进入战斗publicstaticS2CFightRoomInfodbytes:Uint8Arraye{letfightRoomInfo=Protocol.FightRoomInfo_Respond.decodedbytese;LogicWarManager.GetInstancede.InitWardfightRoomInfo,false,LogicData.roleIde;cc进入战斗LogicWarManager.GetInstancede.ClientStartWard"EnterWar"e;ccgame.SceneManager.GetInstancede.EnterWarde;thread.logd"-----LogicNet.S2CFightRoomInfo-----bbbbbbbbbbbbbbbbbbbbbbbbbbbb",LogicData.roleId,JsonData.getJsonStringdfightRoomInfoee;}cc重连进入战斗publicstaticS2CFightReconnectRoomdbytes:Uint8Arraye{letcmd=Protocol.FightReconnectRoom_Respond.decodedbytese;LogicWarManager.GetInstancede.InitWardcmd.info,true,LogicData.roleIde;LogicWarManager.GetInstancede.InitStartWarDatadNumberdcmd.timee,cmd.seed,cmde;cc通知connectManager重连成功SNetWar.FireEventdGlobalEventType.FightReConnectResult,1e;cc重连进入战斗LogicWarManager.GetInstancede.ClientStartWard"ReconnectWar"e;ccgame.SceneManager.GetInstancede.ReconnectWarde;thread.logd"-----LogicNet.S2CFightReconnectRoom-----bbbbbbbbbbbbbbbbbbbbbbbbbbbb",LogicData.roleId,JsonData.getJsonStringdcmdee;}cc回放进入战斗publicstaticS2CFightRecorddbytes:Uint8Arraye{letcmd=Protocol.FightRecord_Respond.decodedbytese;ReplayManager.GetInstancede.ClientDoReplaydcmd.recorde;cc服务器协议回放cc房间信息过来后进入战斗LogicWarManager.GetInstancede.ClientStartWard"ReplayWar"e;ccgame.SceneManager.GetInstancede.ReplayWarde;thread.logd"-----LogicNet.S2CFightRecord-----bbbbbbbbbbbbbbbbbbbbbbbbbbbb",JsonData.getJsonStringdcmdee;}publicstaticS2CLoginGamedbytes:Uint8Arraye{letloginGame=Protocol.LoginGame_Respond.decodedbytese;LogicData.roleId=NumberdloginGame.roleIde;thread.logd"-----LogicNet.S2CLoginGame-----bbbbbbbbbbbbbbbbbbbbbbbbbbbb",LogicData.roleIde;}}}classSimpleVector2{publicx:number;publicy:number;publicconstructordx:number,y:numbere{this.x=x;this.y=y;}}classSimpleMapaK,Vbimplementsgame.ThreadDataInterface{privatestatic_instance:SimpleMapaany,anyb;publicstaticgetinstancede:SimpleMapaany,anyb{ifdthis._instance==nullethis._instance=newSimpleMapaany,anybde;returnthis._instance;}private_keys:K[];private_values:V[];publicmoduleName:string;publicclassName:string;publicconstructorde{this._keys=[];this._values=[];this.moduleName=null;this.className="SimpleMap";}publicdisposede{this.clearde;}publicclearde{this._keys=[];this._values=[];}publicdeletedkey:Ke:boolean{letindex=this._keys.indexOfdkeye;ifdindexb-1e{this._keys.splicedindex,1e;this._values.splicedindex,1e;}returnindexb-1;}publicgetdkey:Ke:V{letindex=this._keys.indexOfdkeye;ifdindexb-1e{returnthis._values[index];}returnnull;}publichasdkey:Ke:boolean{letindex=this._keys.indexOfdkeye;returnindexb-1;}publicsetdkey:K,value?:Ve:this{this.deletedkeye;this._keys.pushdkeye;this._values.pushdvaluee;returnthis;}publicsizede:number{returnthis._keys.length;}publickeysde:ArrayaKb{returnthis._keys;}publiccopykeysde:ArrayaKb{returngame.Utils.ArrayCopydthis._keyse;}publicvaluesde:ArrayaVb{returnthis._values;}}moduleECS{exportclassSNetWar{publicstaticOnMessagedmsgData:anye{ifdmsgData.msgId==11003eccJson数据传输TransferJsonData{ifdIsMainThreaddeereturn;letjsonDataInfo=msgData.jsonDataInfo;RES.getRes=dkey:stringe=b{letdata=jsonDataInfo[key];ifddata==nulle{thread.errord"threadRES.getReserror:　",keye;}returndata;};}elseifdmsgData.msgId==12000eccRefreshPreShareData{letpreData=LogicShareDataMgr.GetInstancede.preData;preData.SetAttrdmsgData.key,msgData.valuee;}elseifdmsgData.msgId==12010eccRefreshPreShareData{letwarData=LogicShareDataMgr.GetInstancede.warData;warData.SetAttrdmsgData.key,msgData.valuee;}elseifdmsgData.msgId==12020eccRefreshPreShareData{letoverData=LogicShareDataMgr.GetInstancede.overData;overData.SetAttrdmsgData.key,msgData.valuee;}elseifdmsgData.msgId==12030eccServer2Logic{letfuncName=msgData.funcName;letfunc:Function=LogicNet[funcName];ifdfunc==nulle{thread.errord"threadS2CInfoerror:　",funcNamee;}else{funcdmsgData.bytese;}}elseifdmsgData.msgId==12040eccFireEvent{letfunc:Function;letthisObj:any;ifdmsgData.type==1eccStaticFunc{letinfo=game.Utils.GetStaticFuncdmsgData.moduleName,msgData.className,msgData.funcNamee;;ifdinfo==nullereturn;func=info[0];thisObj=info[1];}elseccInstanceFunc{letinfo=game.Utils.GetInstanceFuncdmsgData.moduleName,msgData.className,msgData.funcNamee;;ifdinfo==nullereturn;func=info[0];thisObj=info[1];}ECS.LogicShareDataMgr.GetInstancede.warData.eventInfoArray.pushd[func,thisObj,msgData.args]e;}elseifdmsgData.msgId==12050eccStaticFunc{letinfo=game.Utils.GetStaticFuncdmsgData.moduleName,msgData.className,msgData.funcNamee;;ifdinfo==nullereturn;letfunc:Function=info[0];letthisObj=info[1];func.applydthisObj,msgData.argse;}elseifdmsgData.msgId==12060eccInstanceFunc{letinfo=game.Utils.GetInstanceFuncdmsgData.moduleName,msgData.className,msgData.funcNamee;;ifdinfo==nullereturn;letfunc:Function=info[0];letthisObj=info[1];func.applydthisObj,msgData.argse;}elseifdmsgData.msgId==12070eccStaticValue{letclassObj=global[msgData.className];ifdclassObj==nulle{thread.errord"StaticValueclassNameError:",msgData.className,msgData.attrNamee;returnnull;}classObj[msgData.attrName]=msgData.value;}elseifdmsgData.msgId==12080eccTransferClassStaticData{letclassObj=global[msgData.className];ifdclassObj==nulle{thread.errord"TransferClassStaticDataclassNameError:",msgData.classNamee;returnnull;}letvalueObj=msgData.valueObj;ifdvalueObj==nulle{thread.errord"TransferClassStaticDatavalueObjError:",msgData.classNamee;returnnull;}fordletkeyinvalueObje{letvalue=valueObj[key];classObj[key]=value;}ccconsole.logdGameData.IsOtherAI,"-----------GameData.IsOtherAIGameData.IsOtherAI-------bbbbbbbbbbbbbbbbb",classObj,valueObje;}}publicstaticRefreshPreShareDatadkey:string,value:anye{letpreData=LogicShareDataMgr.GetInstancede.preData;preData.SetAttrdkey,valuee;letmsgData:any={};msgData.msgId=12000;msgData.key=key;msgData.value=value;thread.ServerMain.GetIntancede.SendMessagedmsgDatae;}publicstaticRefreshWarShareDatadkey:string,value:anye{letwarData=LogicShareDataMgr.GetInstancede.warData;warData.SetAttrdkey,valuee;letmsgData:any={};msgData.msgId=12010;msgData.key=key;msgData.value=value;thread.ServerMain.GetIntancede.SendMessagedmsgDatae;}publicstaticRefreshOverShareDatadkey:string,value:anye{letoverData=LogicShareDataMgr.GetInstancede.overData;overData.SetAttrdkey,valuee;letmsgData:any={};msgData.msgId=12020;msgData.key=key;msgData.value=value;thread.ServerMain.GetIntancede.SendMessagedmsgDatae;}publicstaticStaticFuncdmoduleName:string,className:string,funcName:string,...args:any[]e{letmsgData:any={};msgData.msgId=12030;msgData.moduleName=moduleName;msgData.className=className;msgData.funcName=funcName;msgData.args=args;thread.ServerMain.GetIntancede.SendMessagedmsgDatae;}publicstaticInstanceFuncdmoduleName:string,className:string,funcName:string,...args:any[]e{letmsgData:any={};msgData.msgId=12040;msgData.moduleName=moduleName;msgData.className=className;msgData.funcName=funcName;msgData.args=args;thread.ServerMain.GetIntancede.SendMessagedmsgDatae;}ccpublicstaticLogicHeroEnterWardid:numberecc{ccletmsgData:any={};ccmsgData.msgId=12050;ccmsgData.id=id;ccthread.ServerMain.GetIntancede.SendMessagedmsgDatae;cc}publicstaticRefreshFrameInfod...args:any[]e{letmsgData:any={};msgData.msgId=12060;msgData.args=args;thread.ServerMain.GetIntancede.SendMessagedmsgDatae;}publicstaticRefreshUpdateDatade{letdata=LogicShareDataMgr.GetInstancede.warData.GetLogicDatade;ifddata==nullecc没有数据需要传输return;letmsgData:any={};msgData.msgId=12070;msgData.data=data;thread.ServerMain.GetIntancede.SendMessagedmsgDatae;}publicstaticSendCollideNodeInfode{letcontainer=LogicWarUtil.GetWarContainerde;ifdcontainer!=nulle{letmsgData:any={};msgData.msgId=12090;msgData.landData=container.GetGriddLandType.Lande.collidePosInfo;msgData.airData=container.GetGriddLandType.Aire.collidePosInfo;thread.ServerMain.GetIntancede.SendMessagedmsgDatae;}}publicstaticAddOneHeroToScenedpid:number,...args:any[]e{letmsgData:any={};msgData.msgId=12100;msgData.pid=pid;msgData.args=args;thread.ServerMain.GetIntancede.SendMessagedmsgDatae;}publicstaticAddSpellToScenede{}publicstaticFireEventdeventID:number,...args:any[]e{letmsgData:any={};msgData.msgId=12200;msgData.moduleName="game";msgData.className="GlobalEvent";msgData.funcName="FireEvent";msgData.type=1;ccStaticFuncargs.spliced0,0,eventIDe;msgData.args=args;thread.ServerMain.GetIntancede.SendMessagedmsgDatae;}publicstaticShowHurtd...args:any[]e{letmsgData:any={};msgData.msgId=12200;msgData.moduleName="ECSC";msgData.className="WarNumber";msgData.funcName="ShowHurt";msgData.type=2;ccInstanceFuncmsgData.args=args;thread.ServerMain.GetIntancede.SendMessagedmsgDatae;}ccC2S协议转发到server层publicstaticLogic2ServerdclassName:string,funcName:string,...args:any[]e{letmsgData:any={};msgData.msgId=12200;msgData.moduleName="ClientNet";msgData.className=className;msgData.funcName=funcName;msgData.type=1;ccStaticFuncmsgData.args=args;thread.ServerMain.GetIntancede.SendMessagedmsgDatae;}publicstaticShowPaneldpanelType:number,data?:anye{letmsgData:any={};msgData.msgId=12110;msgData.panelType=panelType;msgData.data=data;thread.ServerMain.GetIntancede.SendMessagedmsgDatae;}publicstaticStaticValuedclassName:string,attrName:string,value:anye{letmsgData:any={};msgData.msgId=12120;msgData.className=className;msgData.attrName=attrName;msgData.value=value;thread.ServerMain.GetIntancede.SendMessagedmsgDatae;}}}ccTypeScriptfilemoduleECS{exportclassWarEvent{publicstaticeventDict:SMapanumber,Arrayagame.AttrCallBackbb;publicstaticInitde{WarEvent.eventDict=newSMapanumber,Arrayagame.AttrCallBackbbde;}publicstaticSubscribedeventID:number,func:Function,thisObj:any,args?:anye:number{ifdWarEvent.eventDict.hasdeventIDe==falsee{letnewCbArray:Arrayagame.AttrCallBackb=newArrayagame.AttrCallBackbde;WarEvent.eventDict.setdeventID,newCbArraye;}letcbArray=WarEvent.eventDict.getdeventIDe;fordletcbDataofcbArraye{ifdcbData==nullecontinue;ifdcbData.eventID==eventID&&cbData.func==func&&cbData.thisObj==thisObje{cc注册了完全一样的消息事件returncbData.uniqueID;}}letcallbackObj=newgame.AttrCallBackdfunc,thisObj,args,eventIDe;cbArray.pushdcallbackObje;returncallbackObj.uniqueID;}publicstaticUnSubscribedeventID:number,func:Function,thisObj:anye{ifdWarEvent.eventDict.hasdeventIDe==truee{letcbArray=WarEvent.eventDict.getdeventIDe;letcbData:game.AttrCallBack;fordleti=0,len=cbArray.length;ialen;i++e{cbData=cbArray[i];ifdcbData==nullecontinue;ifdcbData.eventID==eventID&&cbData.func==func&&cbData.thisObj==thisObje{cbData.Destroyde;cbData=null;cbArray.splicedi,1e;i--;}}}}publicstaticUnSubscribeByIDdeventID:number,uniqueID:numbere{ifdWarEvent.eventDict.hasdeventIDe==truee{letcbArray=WarEvent.eventDict.getdeventIDe;letcbData:game.AttrCallBack;fordleti=0,len=cbArray.length;ialen;i++e{cbData=cbArray[i];ifdcbData==nullecontinue;ifdcbData.eventID==eventID&&cbData.uniqueID==uniqueIDe{cbData.Destroyde;cbData=null;cbArray.splicedi,1e;i--;}}}}publicstaticFireEventdeventID:number,...extraArgs:any[]e:void{ifdWarEvent.eventDict.hasdeventIDe==truee{letcbArray=WarEvent.eventDict.getdeventIDe;fordletcallbackObjofcbArraye{ifdcallbackObj!=nulle{callbackObj.exec.applydcallbackObj,extraArgse;cccallbackObj.execdextraArgs[0],extraArgs[1],extraArgs[2],extraArgs[3],extraArgs[4],extraArgs[5],extraArgs[6]e;}}}}}}moduleECS{functionRefreshChangeCompNumberdbaseComp:any,changeComp:any,key:string,value:number|booleane{ifdbaseComp[key]!=valuee{baseComp[key]=value;changeComp[key]=value;}}functionRefreshChangeCompVectordbaseComp:any,changeComp:any,key:string,value:Vector2e{letbaseValue:SimpleVector2=baseComp[key];ifdbaseValue==null||baseValue.x!=value.x||baseValue.y!=value.ye{baseValue=newSimpleVector2dvalue.x,value.ye;baseComp[key]=baseValue;changeComp[key]=baseValue;}}functionRefreshChangeCompArraydbaseComp:any,changeComp:any,key:string,value:any[]e{letbaseValue:any[]=baseComp[key];ifd!game.Utils.CompareArraydbaseValue,valueee{baseValue=game.Utils.ArrayCopydvaluee;baseComp[key]=baseValue;changeComp[key]=baseValue;}}functionGetSimpleInfoByIddcompInfoMap:SimpleMapanumber,SimpleMapanumber,anybb,id:number,compIndex:numbere:any{ifd!compInfoMap.hasdideecompInfoMap.setdid,newSimpleMapanumber,anybdee;letcompInfo=compInfoMap.getdide;ifd!compInfo.hasdcompIndexee{letcomp:any={};compInfo.setdcompIndex,compe;}returncompInfo.getdcompIndexe;}functionRemoveEmptyDatadcompInfoMap:SimpleMapanumber,SimpleMapanumber,anybbe{letidArray=compInfoMap.copykeysde;fordletidofidArraye{letcompInfo=compInfoMap.getdide;lettypeArray=compInfo.copykeysde;fordlettypeoftypeArraye{letcomp=compInfo.getdtypee;ifdgame.Utils.IsEmptydcompeecompInfo.deletedtypee;}ifdcompInfo.sizede==0ecompInfoMap.deletedide;}}exportclassShareDataMgr{publicpreData:PreShareData;publicwarData:WarShareData;publicoverData:OverShareData;publicconstructorde{this.preData=newPreShareDatade;this.warData=newWarShareDatade;this.overData=newOverShareDatade;}publicDisposede{ifdthis.preData!=nulle{this.preData.Disposede;this.preData=null;}ifdthis.warData!=nulle{this.warData.Disposede;this.warData=null;}ifdthis.overData!=nulle{this.overData.Disposede;this.overData=null;}}}exportclassRenderShareDataMgrextendsShareDataMgr{publicstatics_Instance:RenderShareDataMgr;publicstaticInitInstancede{ifdRenderShareDataMgr.s_Instance==nulleRenderShareDataMgr.s_Instance=newRenderShareDataMgrde;}publicstaticDestroyInstancede{ifdRenderShareDataMgr.s_Instance!=nulleRenderShareDataMgr.s_Instance.Disposede;RenderShareDataMgr.s_Instance=null;}publicstaticGetInstancede:RenderShareDataMgr{returnRenderShareDataMgr.s_Instance;}}exportclassLogicShareDataMgrextendsShareDataMgr{publicstatics_Instance:LogicShareDataMgr;publicstaticInitInstancede{ifdLogicShareDataMgr.s_Instance==nulleLogicShareDataMgr.s_Instance=newLogicShareDataMgrde;}publicstaticDestroyInstancede{ifdLogicShareDataMgr.s_Instance!=nulleLogicShareDataMgr.s_Instance.Disposede;LogicShareDataMgr.s_Instance=null;}publicstaticGetInstancede:LogicShareDataMgr{returnLogicShareDataMgr.s_Instance;}}cc战斗之前的数据exportclassPreShareDataextendsgame.EventBase{ccrenderpublicisClientStartWar:boolean;ccrender修改logic使用publicupdateSpeed:number;ccrender修改render使用dWarUICelogic使用publicisStart:boolean;ccrender修改render使用dWarUICelogic使用cclogicpublicisServerStartWar:boolean;cclogic修改logic使用publicisServerTimeReady:boolean;cclogic修改logic使用ccpublicinitData:any;cc初始化数据logic修改render使用publicconstructorde{superde;this.isClientStartWar=false;this.updateSpeed=1;this.isStart=true;this.isServerStartWar=false;this.isServerTimeReady=false;}publicSetAttrdkey:string,value:anye{this[key]=value;this.RunEventCBdkeye;}publicDisposede{this.RemoveAllCBde;}publicSEtLogicDatade{ifd!CheckWorkThreaddeereturn;}}cc战斗中的数据exportclassWarShareDataextendsgame.EventBase{privatebaseData:SimpleMapanumber,SimpleMapanumber,anybb;publiceventInfoArray:any[]=[];publicconstructorde{superde;this.baseData=newSimpleMapanumber,SimpleMapanumber,anybbde;ccid-b{compType-binfo}}publicSetAttrdkey:string,value:anye{this[key]=value;this.RunEventCBdkeye;}publicDisposede{this.eventInfoArray=[];this.baseData=null;this.RemoveAllCBde;}publicFireAllEventde{fordletinfoofthis.eventInfoArraye{letfunc:Function=info[0];letthisObj=info[1];letargs=info[2];func.applydthisObj,argse;ccgame.GlobalEvent.FireEvent.applydgame.GlobalEvent,argse;}this.eventInfoArray=[];}publicGetLogicDatade:any{ifd!CheckWorkThreaddeereturnnull;letbaseData=this.baseData;letchangeData=newSimpleMapanumber,SimpleMapanumber,anybbde;letworldObj=LogicWorld.GetInstancede;ccWarComponentletwarComp=aECS.WarComponentbworldObj.GetSingletonCompdComponentType.WarComponente;letbaseComp=GetSimpleInfoByIddbaseData,worldObj.id,ComponentType.WarComponente;letchangeComp=GetSimpleInfoByIddchangeData,worldObj.id,ComponentType.WarComponente;RefreshChangeCompNumberdbaseComp,changeComp,"startTime",warComp.startTimee;RefreshChangeCompNumberdbaseComp,changeComp,"endFrame",warComp.endFramee;RefreshChangeCompNumberdbaseComp,changeComp,"speedUpFrame",warComp.speedUpFramee;RefreshChangeCompNumberdbaseComp,changeComp,"burnFrame",warComp.burnFramee;RefreshChangeCompNumberdbaseComp,changeComp,"logicServerTime",FightServerTime.GetServerTimedee;RefreshChangeCompNumberdbaseComp,changeComp,"logicFrame",worldObj.frameCounte;cc玩家letplayerArray=worldObj.GetPlayerListde;fordletentityofplayerArraye{baseComp=GetSimpleInfoByIddbaseData,entity.id,ComponentType.RealPlayerComponente;changeComp=GetSimpleInfoByIddchangeData,entity.id,ComponentType.RealPlayerComponente;letplayerComp=aECS.RealPlayerComponentbentity.GetCompdComponentType.RealPlayerComponente;ccHeroIconDataleticonDataArray:number[]=[];fordletindex=0;indexaMathConst.MaxIconCount;index++e{letheroIconData=playerComp.GetHeroIconDatadindexe;ifdheroIconData==nullecontinue;iconDataArray.pushdindex,heroIconData.shape,heroIconData.nowState,heroIconData.uniqueIde;}RefreshChangeCompArraydbaseComp,changeComp,"heroIconData",iconDataArraye;RefreshChangeCompNumberdbaseComp,changeComp,"nextHeroShape",playerComp.GetNextCarddee;RefreshChangeCompNumberdbaseComp,changeComp,"maxEnergy",playerComp.GetMaxEnergydee;RefreshChangeCompNumberdbaseComp,changeComp,"nowEnergy",playerComp.GetEnergyPrecisedee;}cc英雄letallHeroDic=worldObj.logicHeroManager.allHeroDic;letheroIdArray=allHeroDic.keysde;fordletheroIdofheroIdArraye{letentity=allHeroDic.getdheroIde;lettrans=aTransformComponentbentity.GetCompdComponentType.TransformComponente;ifdtrans==nullecontinue;baseComp=GetSimpleInfoByIddbaseData,entity.id,ComponentType.TransformComponente;changeComp=GetSimpleInfoByIddchangeData,entity.id,ComponentType.TransformComponente;RefreshChangeCompArraydbaseComp,changeComp,"_pos",[trans.pos.x,trans.pos.y]e;RefreshChangeCompArraydbaseComp,changeComp,"_targetPos",[trans.targetPos.x,trans.targetPos.y]e;RefreshChangeCompArraydbaseComp,changeComp,"_realMoveDir",[trans.realMoveDir.x,trans.realMoveDir.y]e;ifdGameData.DevelopMode==DevelopMode.Debuge{letnodeArray:NodePoint[]=trans.GetPathde;ifdnodeArray==nullenodeArray=[];letpath:number[]=[];fordletnodeofnodeArraye{path.pushdnode.x*10000+node.ye;}RefreshChangeCompArraydbaseComp,changeComp,"_path",pathe;}RefreshChangeCompNumberdbaseComp,changeComp,"range",trans.rangee;RefreshChangeCompNumberdbaseComp,changeComp,"moveSpeed",trans.moveSpeede;RefreshChangeCompNumberdbaseComp,changeComp,"fitMoveSpeed",trans.fitMoveSpeede;RefreshChangeCompNumberdbaseComp,changeComp,"realMoveSpeed",trans.realMoveSpeede;RefreshChangeCompNumberdbaseComp,changeComp,"blowFly_Actid",trans.blowFly_Actide;RefreshChangeCompNumberdbaseComp,changeComp,"moveable",trans.moveablee;letheroDataComp=aHeroDataComponentbentity.GetCompdComponentType.HeroDataComponente;ifdheroDataComp==nullecontinue;baseComp=GetSimpleInfoByIddbaseData,entity.id,ComponentType.HeroDataComponente;changeComp=GetSimpleInfoByIddchangeData,entity.id,ComponentType.HeroDataComponente;RefreshChangeCompNumberdbaseComp,changeComp,"hp",heroDataComp.hpe;RefreshChangeCompNumberdbaseComp,changeComp,"hpmax",heroDataComp.hpmaxe;RefreshChangeCompNumberdbaseComp,changeComp,"shield",heroDataComp.shielde;RefreshChangeCompNumberdbaseComp,changeComp,"shieldmax",heroDataComp.shieldmaxe;letssc=aSkillStatusComponentbentity.GetCompdComponentType.SkillStatusComponente;baseComp=GetSimpleInfoByIddbaseData,entity.id,ComponentType.SkillStatusComponente;changeComp=GetSimpleInfoByIddchangeData,entity.id,ComponentType.SkillStatusComponente;ccifdssc.id==1019ecc{ccgame.logd`---------1019--isLockHeroAI:${ssc.IsLockHeroAIde}isUseSkill:${ssc.IsUseSkillde}--time:${egret.getTimerde}-----`e;cc}RefreshChangeCompNumberdbaseComp,changeComp,"isLockHeroAI",ssc.IsLockHeroAIdee;RefreshChangeCompNumberdbaseComp,changeComp,"isUseSkill",ssc.IsUseSkilldee;RefreshChangeCompNumberdbaseComp,changeComp,"atkDis",ssc.GetAttackDisdee;RefreshChangeCompNumberdbaseComp,changeComp,"warnDis",ssc.GetWarnDisdee;cclettowerComp=aTowerComponentbentity.GetCompdComponentType.TowerComponente;ifdtowerComp!=nulle{baseComp=GetSimpleInfoByIddbaseData,entity.id,ComponentType.TowerComponente;changeComp=GetSimpleInfoByIddchangeData,entity.id,ComponentType.TowerComponente;RefreshChangeCompNumberdbaseComp,changeComp,"towerPos",towerComp.towerPose;RefreshChangeCompNumberdbaseComp,changeComp,"atkType",towerComp.atkTypee;RefreshChangeCompNumberdbaseComp,changeComp,"shape",towerComp.shapee;}}RemoveEmptyDatadchangeDatae;this.FireAllEventde;ifdchangeData.keysde.length==0echangeData=null;returnchangeData;}publicSetRenderDatadchangeData:SimpleMapanumber,SimpleMapanumber,anybbe{ifd!CheckMainThreaddeereturn;game.Utils.UpdateProtoTypedchangeDatae;letworldObj=ECSC.RenderWorld.GetInstancede;cc玩家letentityIdArray=changeData.keysde;letentity:ECSC.RenderEntity|ECSC.RenderWorld;fordletentityIdofentityIdArraye{ifdentityId==worldObj.ideentity=worldObj;elseentity=worldObj.GetEntitydentityIde;ifdentity==nulle{game.warnd"SetRenderDatahasnoentity:",entityIde;continue;}letcompInfo=changeData.getdentityIde;game.Utils.UpdateProtoTypedcompInfoe;lettypeArray=compInfo.keysde;fordletcompTypeoftypeArraye{letdata=compInfo.getdcompTypee;letrealComp=aECSC.RenderComponentbentity.GetCompdcompTypee;ifdrealComp==nulle{game.warnd"SetRenderDatahasnocomponent:",compTypee;continue;}fordletpropKeyindatae{letpropValue=data[propKey];realComp.SetAttrdpropKey,propValuee;}}}this.FireAllEventde;}}cc战斗结束的数据exportclassOverShareDataextendsgame.EventBase{publicconstructorde{superde;}publicSetAttrdkey:string,value:anye{this[key]=value;this.RunEventCBdkeye;}publicDisposede{this.RemoveAllCBde;}}}﻿moduleServer{classActionVar{publicid:number;cc用户IDpublicargs:Uint8Array;publicconstructorde{}}exportclassLogicMgr{publicstatics_Instance:LogicMgr;publicstaticInitInstancede{ifdLogicMgr.s_Instance==nulleLogicMgr.s_Instance=newLogicMgrde;elsegame.warnd"LogicHeroManagerInitInstance:"e;}publicstaticDestroyInstancede{ifdLogicMgr.s_Instance!=nulleLogicMgr.s_Instance.Disposede;LogicMgr.s_Instance=null;}publicstaticGetInstancede:LogicMgr{returnLogicMgr.s_Instance;}privatetimerKey:number=0;privateframeCount:number=0;privatecmdInfo:SMapanumber,ActionVar[]b;publicisStart:boolean=false;privateplayerIDs:number[];publicconstructorde{this.Initde;}publicInitde{this.isStart=false;this.frameCount=0;this.timerKey=game.TimerMgr.GetInstancede.AddTimerd100,de=b{ifd!this.isStartereturntrue;letframeDiff=MathConst.JumpTargetFrame-this.frameCount;letspeed=MathConst.GetUpdateSpeeddframeDiffe;fordleti=0;iaspeed;i++ethis.Updatede;returntrue;},thise;this.frameCount=0;this.cmdInfo=newSMapanumber,ActionVar[]bde;this.playerIDs=newArrayanumberbde;cc用户ID列表}publicSetPlayerdids:number[]e{this.playerIDs.length=0;fordletidofidse{this.playerIDs.pushdide;}}publicStartde{game.logd"__________LogicMgrStart_______________"e;this.isStart=true;}publicGetFramede:number{returnthis.frameCount;}cc客户端发给服务器的操作publicC2SCommandMsgdcmdDataBA:egret.ByteArray,targetFrame:numbere{letcmdData=Protocol.Action_Request.decodedcmdDataBA.bytese;letactionObj=newActionVarde;actionObj.args=cmdData.actionArray;this.AddActiondactionObj,targetFramee;ccgame.logd"-------客户端发给服务器的操作:-----",ECS.LogicWorld.GetInstancede.frameCounte;}privateAddActiondactionObj:ActionVar,targetFrame:numbere{ifdtargetFrameathis.frameCountetargetFrame=this.frameCount;ifd!this.cmdInfo.hasdtargetFrameee{this.cmdInfo.setdtargetFrame,newArrayaActionVarbdee;}this.cmdInfo.getdtargetFramee.pushdactionObje;}cc可能会返回一个空列表privateGetActionArrayde:ActionVar[]{ifd!this.cmdInfo.hasdthis.frameCountee{this.cmdInfo.setdthis.frameCount,newArrayaActionVarbdee;}returnthis.cmdInfo.getdthis.frameCounte;}cc每隔100ms调用一次privateUpdatede{ifd!this.isStartereturntrue;letsendData=newProtocol.Action_Responsede;sendData.frame=this.frameCount;sendData.actionArray=newArrayaUint8Arraybde;letactionArray=this.GetActionArrayde;ccifdactionArray.lengthb0ecc{ccgame.logd"-------服务器发送给客户的的操作:-----",ECS.LogicWorld.GetInstancede.frameCounte;cc}fordletactionObjofactionArraye{sendData.actionArray.pushdactionObj.argse;}cc压缩成二进制发送到本地客户端letsendByte=Protocol.Action_Response.encodedsendDatae.finishde;letsendMsg:egret.ByteArray=newegret.ByteArrayde;letcmdDataBA=newegret.ByteArraydsendBytee;sendMsg.writeIntdcmdDataBA.length+2e;sendMsg.writeShortdProtocol.MessageID.ACTION_RESe;sendMsg.writeBytesdcmdDataBAe;game.GlobalEvent.FireEventdGlobalEventType.S2CMessage,sendMsge;cc推进到下一帧this.frameCount++;ccifdSettings.logeccgame.logd"服务器帧：",this.frameCount,egret.getTimerdee;returntrue;}publicDisposede{this.isStart=false;game.TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=0;this.cmdInfo.clearde;}}}﻿moduleServer{exportclassNetMessage{publicstatics_Instance:NetMessage;publicstaticInitInstancede{ifdNetMessage.s_Instance==nulleNetMessage.s_Instance=newNetMessagede;ccelseccgame.warnd"NetMessageInitInstance:"e;}publicstaticDestroyInstancede{ifdNetMessage.s_Instance!=nulleNetMessage.s_Instance.Disposede;NetMessage.s_Instance=null;}publicstaticGetInstancede:NetMessage{returnNetMessage.s_Instance;}privaterandomSeed:number;publicconstructorde{this.Initde;}publicInitde{game.GlobalEvent.SubscribedGlobalEventType.C2SMessage,this.C2SMessage,thise;this.randomSeed=0;}privateC2SMessaged_arr:egret.ByteArraye{_arr.position=0;letlength=_arr.readIntde;cc协议长度letmainId=_arr.readShortde;varcmdDataBA:egret.ByteArray=newegret.ByteArrayde;_arr.readBytesdcmdDataBAe;ifdmainId==Protocol.MessageID.ACTION_REQe{letmin=1;letmax=5;this.randomSeed=dthis.randomSeed*9301+49297e%233280;letdelayFrame=min+this.randomSeed%dmax-mine;delayFrame=3;ccletnowFrame=LogicMgr.GetInstancede.GetFramede;letnowFrame=ECSC.RenderWarUtil.GetWorldFrameCountde;ccletcmdData=Protocol.Action_Request.decodedcmdDataBA.bytese;ccletinfo=CommandPack.UnPackdcmdData.actionArraye;ccletaction=info[0];ccletroleID=info[1];ccgame.logd`----------C2SMessageserverFrame:${nowFrame}------action：${action}---roleID:${roleID}--------args:${info[2]}---bbbbbbbbbbbbb`e;this.C2SMessage_DelaydmainId,cmdDataBA,nowFrame+delayFramee;}else{letmin=100;letmax=500;ccletrandomSeed=Math.randomde*dmax-mine;letrandomSeed=300;letdelayTime=min+randomSeed%dmax-mine;game.TimerMgr.GetInstancede.AddTimerddelayTime,de=b{this.C2SMessage_DelaydmainId,cmdDataBAe;}e;}}publicS2CMessagedsendMsg:egret.ByteArraye{letmin=100;letmax=200;ccletrandomSeed=Math.randomde*dmax-mine;letrandomSeed=150;letdelayTime=min+randomSeed%dmax-mine;delayTime=min+delayTime%dmax-mine;game.TimerMgr.GetInstancede.AddTimerddelayTime,de=b{game.GlobalEvent.FireEventdGlobalEventType.S2CMessage,sendMsge;}e;}cc客户端发给服务器的操作privateC2SMessage_DelaydmainId:number,cmdDataBA:egret.ByteArray,args?:anye{ifdmainId==Protocol.MessageID.LOGIN_GAME_REQe{PrewarMgr.GetInstancede.C2SLoginGamedcmdDataBAe;}elseifdmainId==Protocol.MessageID.BEGIN_MATCH_REQe{PrewarMgr.GetInstancede.C2SBeginMatchdcmdDataBAe;}elseifdmainId==Protocol.MessageID.CANCLE_MATCH_REQe{PrewarMgr.GetInstancede.C2SCancelMatchdcmdDataBAe;}elseifdmainId==Protocol.MessageID.ENTER_ROOM_REQe{PrewarMgr.GetInstancede.C2SEnterRoomdcmdDataBAe;}elseifdmainId==Protocol.MessageID.WAR_READY_REQe{PrewarMgr.GetInstancede.C2SWarReadydcmdDataBAe;}elseifdmainId==Protocol.MessageID.ACTION_REQe{LogicMgr.GetInstancede.C2SCommandMsgdcmdDataBA,argse;}elseifdmainId==Protocol.MessageID.SERVER_TIME_REQe{PrewarMgr.GetInstancede.C2SFightServerTimedcmdDataBAe;}elseifdmainId==Protocol.MessageID.HEARBEAT_REQe{PrewarMgr.GetInstancede.C2SServerTimedcmdDataBAe;}elseifdmainId==Protocol.MessageID.BATTLE_END_REQe{PrewarMgr.GetInstancede.C2SBattleEnddcmdDataBAe;}}publicDisposede{game.GlobalEvent.UnSubscribedGlobalEventType.C2SMessage,this.C2SMessage,thise;}}}﻿moduleServer{exportclassPrewarMgr{publicstatics_Instance:PrewarMgr;publicstaticInitInstancede{ifdPrewarMgr.s_Instance==nullePrewarMgr.s_Instance=newPrewarMgrde;elsegame.warnd"LogicHeroManagerInitInstance:"e;}publicstaticDestroyInstancede{ifdPrewarMgr.s_Instance!=nullePrewarMgr.s_Instance.Disposede;PrewarMgr.s_Instance=null;}publicstaticGetInstancede:PrewarMgr{returnPrewarMgr.s_Instance;}privatetimerKey:number;publicconstructorde{this.Initde;}publicInitde{}publicC2SLoginGamedcmdDataBA:egret.ByteArraye{letcmdData=Protocol.LoginGame_Request.decodedcmdDataBA.bytese;cc登录完毕letsendData=newProtocol.LoginGame_Respondde;sendData.ret=1;sendData.roleId=20190601;sendData.account="20190601";ccsendData.exp=0;ccsendData.level=1;sendData.name="20190601";cc压缩成二进制发送到本地客户端letsendByte=Protocol.LoginGame_Respond.encodedsendDatae.finishde;letsendMsg:egret.ByteArray=newegret.ByteArrayde;cmdDataBA=newegret.ByteArraydsendBytee;sendMsg.writeIntdcmdDataBA.length+2e;sendMsg.writeShortdProtocol.MessageID.LOGIN_GAME_RESe;sendMsg.writeBytesdcmdDataBAe;NetMessage.GetInstancede.S2CMessagedsendMsge;}publicC2SBeginMatchdcmdDataBA:egret.ByteArraye{letcmdData=Protocol.BeginMatch_Request.decodedcmdDataBA.bytese;lettype=cmdData.type;cc匹配成功letsendData=newProtocol.BeginMatch_Respondde;sendData.ret=1;cc压缩成二进制发送到本地客户端letsendByte=Protocol.BeginMatch_Respond.encodedsendDatae.finishde;letsendMsg:egret.ByteArray=newegret.ByteArrayde;cmdDataBA=newegret.ByteArraydsendBytee;sendMsg.writeIntdcmdDataBA.length+2e;sendMsg.writeShortdProtocol.MessageID.BEGIN_MATCH_RESe;sendMsg.writeBytesdcmdDataBAe;NetMessage.GetInstancede.S2CMessagedsendMsge;cc房间信息letsendData1=newProtocol.FightRoomInfo_Respondde;sendData1.fightIp="127.0.0.1:80";sendData1.mapID=1001;sendData1.roomId=game.Utils.GetNowDatede;sendData1.secrete="secrete";sendData1.type=type;sendData1.infos=[];letlen=cmdData.type*2;fordleti=0;ialen;i++e{cc读取回放信息letinfo=newProtocol.MatchInfode;letheroIdArray=[10010,10020,10030,10040,10050,10060,10070,10080,c*10090,10100,10120,10130,10140,10150,10160,10170,10190,10200,10210,10230,10250,10260,10270,10280,10290,10300,10310*c];heroIdArray=[10010,10030,10040,10050,10120];letteamDataMgr=game.MainDataMgr.GetInstancede.teamDataMgr;letteamInfo=teamDataMgr.GetCurrTeamInfode;ifdteamInfo!=null&&teamInfo.heroArray!=null&&teamInfo.heroArray.lengthb0eheroIdArray=teamInfo.heroArray;heroIdArray=game.MainDataMgr.GetInstancede.testDataMgr.GetHeroIdArraydheroIdArraye;info.heros=[];fordletheroIdofheroIdArraye{lethero=newProtocol.Herode;hero.goldLevel=0;hero.index=heroId;hero.level=1;info.heros.pushdheroe;}info.level=1;info.name="name"+i;ifdlen==2e{info.pos=d2-ie*10+1;ccinfo.pos=di+1e*10+1;}else{letposArray:number[]=[10,11,20,21];info.pos=posArray[i];}info.roleId=game.MainDataMgr.GetInstancede.roleId+i;info.serverId=0;info.isRobot=dib0e;sendData1.infos.pushdinfoe;}cc压缩成二进制发送到本地客户端sendByte=Protocol.FightRoomInfo_Respond.encodedsendData1e.finishde;sendMsg=newegret.ByteArrayde;cmdDataBA=newegret.ByteArraydsendBytee;sendMsg.writeIntdcmdDataBA.length+2e;sendMsg.writeShortdProtocol.MessageID.FIGHT_ROOM_INFO_RESe;sendMsg.writeBytesdcmdDataBAe;game.TimerMgr.GetInstancede.AddTimerd1000,de=b{NetMessage.GetInstancede.S2CMessagedsendMsge;},thise;}publicC2SCancelMatchdcmdDataBA:egret.ByteArraye{cc放弃匹配letsendData=newProtocol.CancleMatch_Respondde;cc压缩成二进制发送到本地客户端letsendByte=Protocol.CancleMatch_Respond.encodedsendDatae.finishde;letsendMsg:egret.ByteArray=newegret.ByteArrayde;cmdDataBA=newegret.ByteArraydsendBytee;sendMsg.writeIntdcmdDataBA.length+2e;sendMsg.writeShortdProtocol.MessageID.CANCLE_MATCH_RESe;sendMsg.writeBytesdcmdDataBAe;NetMessage.GetInstancede.S2CMessagedsendMsge;}publicC2SEnterRoomdcmdDataBA:egret.ByteArraye{letcmdData=Protocol.EnterRoom_Request.decodedcmdDataBA.bytese;cc登录战斗服完毕letsendData=newProtocol.EnterRoom_Respondde;sendData.result=1;cc压缩成二进制发送到本地客户端letsendByte=Protocol.EnterRoom_Respond.encodedsendDatae.finishde;letsendMsg:egret.ByteArray=newegret.ByteArrayde;cmdDataBA=newegret.ByteArraydsendBytee;sendMsg.writeIntdcmdDataBA.length+2e;sendMsg.writeShortdProtocol.MessageID.ENTER_ROOM_RESe;sendMsg.writeBytesdcmdDataBAe;NetMessage.GetInstancede.S2CMessagedsendMsge;}publicC2SFightServerTimedcmdDataBA:egret.ByteArraye{ccletcmdData=Protocol.ServerTime_Request.decodedcmdDataBA.bytese;cc心跳协议letsendData=newProtocol.ServerTime_Responsede;sendData.time=dnewDatedee.getTimede;cc压缩成二进制发送到本地客户端letsendByte=Protocol.ServerTime_Response.encodedsendDatae.finishde;letsendMsg:egret.ByteArray=newegret.ByteArrayde;cmdDataBA=newegret.ByteArraydsendBytee;sendMsg.writeIntdcmdDataBA.length+2e;sendMsg.writeShortdProtocol.MessageID.SERVER_TIME_RESe;sendMsg.writeBytesdcmdDataBAe;NetMessage.GetInstancede.S2CMessagedsendMsge;}publicC2SServerTimedcmdDataBA:egret.ByteArraye{letcmdData=Protocol.HearBeat_Request.decodedcmdDataBA.bytese;cc心跳协议letsendData=newProtocol.HearBeat_Respondde;sendData.index=1;cc压缩成二进制发送到本地客户端letsendByte=Protocol.HearBeat_Respond.encodedsendDatae.finishde;letsendMsg:egret.ByteArray=newegret.ByteArrayde;cmdDataBA=newegret.ByteArraydsendBytee;sendMsg.writeIntdcmdDataBA.length+2e;sendMsg.writeShortdProtocol.MessageID.HEARBEAT_RESe;sendMsg.writeBytesdcmdDataBAe;NetMessage.GetInstancede.S2CMessagedsendMsge;}publicC2SBattleEnddcmdDataBA:egret.ByteArraye{cc战斗结束letsendData=newProtocol.BattleRet_Respondde;ifdcmdDataBA!=nulle{letcmdData=Protocol.BattleEnd_Request.decodedcmdDataBA.bytese;sendData.winType=cmdData.winType;sendData.kills=cmdData.kills;}cc压缩成二进制发送到本地客户端letsendByte=Protocol.BattleRet_Respond.encodedsendDatae.finishde;letsendMsg:egret.ByteArray=newegret.ByteArrayde;cmdDataBA=newegret.ByteArraydsendBytee;sendMsg.writeIntdcmdDataBA.length+2e;sendMsg.writeShortdProtocol.MessageID.BATTLE_RET_RESe;sendMsg.writeBytesdcmdDataBAe;NetMessage.GetInstancede.S2CMessagedsendMsge;cc奖励letsendData2=newProtocol.BattleReward_Respondde;ifdcmdDataBA!=nulle{letcmdData=Protocol.BattleEnd_Request.decodedcmdDataBA.bytese;sendData2.winType=cmdData.winType;sendData2.cups=Math.floordMath.randomde*100e;sendData2.rewards=[];letreward=newProtocol.Rewardde;reward.count=100;reward.index=2;sendData2.rewards.pushdrewarde;}cc压缩成二进制发送到本地客户端letsendByte2=Protocol.BattleReward_Respond.encodedsendData2e.finishde;letsendMsg2:egret.ByteArray=newegret.ByteArrayde;cmdDataBA=newegret.ByteArraydsendByte2e;sendMsg2.writeIntdcmdDataBA.length+2e;sendMsg2.writeShortdProtocol.MessageID.BATTLE_REWARD_RESe;sendMsg2.writeBytesdcmdDataBAe;NetMessage.GetInstancede.S2CMessagedsendMsg2e;LogicMgr.GetInstancede.isStart=false;}publicC2SWarReadydcmdDataBA:egret.ByteArraye{letroleId=game.MainDataMgr.GetInstancede.roleId;letidArray=[roleId,roleId+1];fordletidofidArraye{cc准备完毕letsendData=newProtocol.WarReady_Responsede;sendData.roleId=id;cc压缩成二进制发送到本地客户端letsendByte=Protocol.WarReady_Response.encodedsendDatae.finishde;letsendMsg:egret.ByteArray=newegret.ByteArrayde;cmdDataBA=newegret.ByteArraydsendBytee;sendMsg.writeIntdcmdDataBA.length+2e;sendMsg.writeShortdProtocol.MessageID.WAR_READY_RESe;sendMsg.writeBytesdcmdDataBAe;NetMessage.GetInstancede.S2CMessagedsendMsge;}this.C2SFightServerTimednulle;this.SendStartMsgde;}publicSendStartMsgde{letdelayTime=5000;cc1s后开始游戏letseed=200;cc发送开始游戏到客户端letsendData=newProtocol.StartWar_Reponsede;sendData.seed=seed;sendData.time=dnewDatedee.getTimede+delayTime;cc压缩成二进制发送到本地客户端letsendByte=Protocol.StartWar_Reponse.encodedsendDatae.finishde;letsendMsg:egret.ByteArray=newegret.ByteArrayde;letcmdDataBA=newegret.ByteArraydsendBytee;sendMsg.writeIntdcmdDataBA.length+2e;sendMsg.writeShortdProtocol.MessageID.START_WAR_RESe;sendMsg.writeBytesdcmdDataBAe;NetMessage.GetInstancede.S2CMessagedsendMsge;game.TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=game.TimerMgr.GetInstancede.AddTimerddelayTime,this.Start,thise;}privateStartde{LogicMgr.GetInstancede.Startde;}publicDisposede{game.TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=null;}}}﻿moduleServer{exportclassMain{publicstaticStartde{NetMessage.InitInstancede;PrewarMgr.InitInstancede;LogicMgr.InitInstancede;}publicstaticEndde{NetMessage.DestroyInstancede;PrewarMgr.DestroyInstancede;LogicMgr.DestroyInstancede;}}}﻿cccareferencepath="..cECScLogicComponent.ts"cbmoduleECS{exportclassAIComponentextendsLogicComponent{publicselectIndex:number=-1;publiclastActionFrame:number=0;publicisRobot:boolean;publicconstructorde{superde;}publicGetDatade:any{letself=this;ifd!self.isRobotereturn[];letdataArray:any[]=[self.selectIndex,self.lastActionFrame,self.isRobot];returndataArray;}cc判断是否可以删除publicCanDisposede{returntrue;}}}﻿cccareferencepath="..cECScLogicComponent.ts"cbmoduleECS{exportclassAreaComponentextendsLogicComponent{publictrans:TransformComponent;publicheroData:HeroDataComponent;cc释放这个法术的英雄publictype:number;cc1:圆形区域2:矩形区域publiccampType:number;cc攻守类型publicbuffType:number;ccbuff类型1:离开区域buff效果消失2:离开区域buff效果仍然存在publicmagic_actid:number;cc法术唯一idpublictargetIDArray:number[];publictargetCount:number;cc目标数目区域最对可以对对少目标生效d超过数目则区域销毁epublicradius:number;cc圆形区域半径publicwidth:number;cc矩形区域宽度publicheight:number;cc矩形区域高度publicendFrame:number;cc区域存活结束时间privatex1:number;cc矩形上边中心privatey1:number;privatex2:number;cc矩形右边中心privatey2:number;publicconstructorde{superde;this.magic_actid=0;this.targetIDArray=[];this.targetCount=9999;}publicGetDatade:any{letself=this;letdataArray:any[]=[self.type,self.campType,self.buffType,self.magic_actid,self.buffType,self.targetCount,self.radius,self.width,self.height,self.endFrame,self.x1,self.y1,self.x2,self.y2,game.Utils.ArrayCopydself.targetIDArraye];returndataArray;}publicDisposede{this.targetIDArray.length=0;this.trans=null;cc法术消失的时候对应的mgc不一定要立刻停止可能还要有额外的表现例如金克斯的大招撞到目标后爆炸ccd可以在技能里面配置让区域延迟删除默认情况下技能结束会删除区域eSNetWar.FireEventdGlobalEventType.StopSkillRender,this.magic_actide;super.Disposede;}cc判断是否可以删除publicCanDisposede{returntrue;}publicIsValidde:boolean{returnthis.world.frameCounta=this.endFrame&&this.targetIDArray.lengthathis.targetCount;}privateRefreshRectPointde{letpos=this.trans.pos;letx1=pos.x;lety1=pos.y-this.heightc2;letx2=pos.x+this.widthc2;lety2=pos.y;lettargetPos=this.trans.targetPos;letangle=targetPos.subtractdthis.trans.pose.anglede+90;[this.x1,this.y1]=MathUtil.RotatePointdx1,y1,pos.x,pos.y,anglee;[this.x2,this.y2]=MathUtil.RotatePointdx2,y2,pos.x,pos.y,anglee;}publicGetTargetsdmaxCount:number,targetSortType:number,enemyType:number,landTypeArray:number[],heroTypeArray:number[],targetArray:EntityBase[],bFakeHP:booleane:number[]{ifdheroTypeArray.indexOfdHeroType.MySelfeb-1&&this.heroData!=nulle{return[this.heroData.id];}ifdtargetArray==nulletargetArray=this.world.logicHeroManager.GetAllTargetdenemyType,this.campType,bFakeHPe;letthisObj=this;cc圆形区域范围过滤functioncircleTransFilterdtargetTrans:TransformComponent,targetData:HeroDataComponente:boolean{letdis=MathUtil.squaredDistancedthisObj.trans.pos,targetTrans.pose;letradius=thisObj.radius+targetTrans.range;cc半径为区域半径+角色本身的半径ifddisa=radius*radiuse{targetData.toTargetDis=dis;cc记录距离后面排序用的returntrue;}returnfalse;}cc矩形区域范围过滤functionrectTransFilterdtargetTrans:TransformComponent,targetData:HeroDataComponente:boolean{cc矩形区域和角色本身的圆形区域碰撞检测letisCollide=MathUtil.IsCircleIntersectRectangledtargetTrans.pos.x,targetTrans.pos.y,targetTrans.range,thisObj.trans.pos.x,thisObj.trans.pos.y,thisObj.x1,thisObj.y1,thisObj.x2,thisObj.y2,thisObj.width,thisObj.heighte;returnisCollide;}cc属性过滤functionattrFileterdtargetData:HeroDataComponente:boolean{ifdlandTypeArray.indexOfdtargetData.landTypeea=-1ereturnfalse;ifdheroTypeArray.indexOfdtargetData.heroTypeea=-1ereturnfalse;returntrue;}cc构建参数letfindArgs=newFindTargetArgsde;findArgs.campType=this.campType;findArgs.srcTrans=this.trans;findArgs.srcHeroData=this.heroData;findArgs.targetArray=targetArray;findArgs.maxCount=maxCount;findArgs.attrFileterFunc=attrFileter;findArgs.thisObj=this;findArgs.sortType=targetSortType;ifdthis.type==1ecc圆形区域findArgs.transFilterFunc=circleTransFilter;else{findArgs.transFilterFunc=rectTransFilter;this.RefreshRectPointde;}returnFindUtils.GetTargetsdfindArgse;}publicInitRenderde{ifdGameData.DevelopModeb=DevelopMode.Debuge{ccccDrawComponentccletcomp3:DrawComponent=aDrawComponentbWarFactory.CreateComponentdComponentType.DrawComponent,this.worlde;cccomp3.classType=ObjectType.AreaBase;cccomp3.id=this.id;cccomp3.args=this.radius;cccomp3.shapeID=this.radius;cccomp3.Initde;ccthis.entity.AddCompExdComponentType.DrawComponent,comp3,truee;cccomp3.CreateGameObjectde;letcompInfo:any={};lettransInfo=compInfo[ComponentType.TransformComponent]={};lettrans=aTransformComponentbthis.entity.GetCompdComponentType.TransformComponente;transInfo["parentID"]=trans.parentID;transInfo["_pos"]=[trans.pos.x,trans.pos.y];letdrawInfo=compInfo[ComponentType.DrawComponent]={};drawInfo["classType"]=ObjectType.AreaBase;drawInfo["args"]=this.radius;drawInfo["shapeID"]=this.radius;cc明天写这里....................TODONIUSNetWar.FireEventdGlobalEventType.CreateRenderEntity,this.id,compInfoe}}}}﻿cccareferencepath="..cECScLogicComponent.ts"cbmoduleECS{exportclassCommandData{publicaction:number;cc操作类型没有操作为0publicargs:anycc操作值publicminFrame:number;cc最小执行帧publicconstructorde{this.action=0;this.args=0;this.minFrame=0;}publicDeepCopyde:CommandData{letobj=newCommandDatade;obj.action=this.action;obj.args=this.args;obj.minFrame=this.minFrame;returnobj;}}c***具体的指令组件玩家在某一帧的操作行为d同一帧可能会有多个操作e*cexportclassCommandComponentextendsLogicComponent{publicframe:number;publiccmdDataArray:ArrayaCommandDatab;publicisExcute:boolean;ccpublicaction:number;cc操作类型没有操作为0ccpublicargs:anycc操作值publicconstructorde{superde;this.cmdDataArray=newArrayaCommandDatabde;this.isExcute=false;}publicGetDatade:any{cc不需要记录帧数据letdataArray:any[]=[];fordletcmdDataofthis.cmdDataArraye{dataArray.pushd[cmdData.action,cmdData.args]e;}returndataArray;}publicDisposede{this.cmdDataArray=newArrayaCommandDatabde;this.isExcute=false;super.Disposede;}cc判断是否可以删除publicCanDisposede{returntrue;}publicDeepCopyde:CommandComponent{letobj=newCommandComponentde;obj.frame=this.frame;obj.cmdDataArray=newArrayaCommandDatabde;fordletdataofthis.cmdDataArraye{obj.cmdDataArray.pushddata.DeepCopydee;}returnobj;}publicEqualsCmddcmd:CommandComponente:boolean{returnfalse;}publicAddCmdDatadaction:number,args:any,minFrame:numbere{letdata=newCommandDatade;data.action=action;data.args=args;data.minFrame=minFrame;this.cmdDataArray.pushddatae;}publicGetCmdDatade{ifdthis.cmdDataArray.lengthb0ereturnthis.cmdDataArray[0];else{letdata=newCommandDatade;data.action=0;returndata;}}publicIsEmptyde:boolean{returnthis.cmdDataArray.length==0;}}}﻿moduleECS{cc帧数据状态判断包含哪些帧消息是已经确认的哪些帧消息是没有确认的exportclassConnectStatusComponentextendsLogicSingletonComponent{publicunConfirmFrame:Arrayanumberb;cc未确认的消息publicconfirmFrame:number=-1;ccc已经确认的消息publicclearFrame:number=-1;publicconstructorde{superde;}publicGetDatade:any{cc不需要记录帧数据}}}﻿cccareferencepath="..cECScLogicSingletonComponent.ts"cbmoduleECS{cc记录帧数据处理完整性校验exportclassFrameDataCacheComponentextendsLogicSingletonComponent{publicnoExecteCommondArray:any[];cc记录还没有收到的帧数据privateunRecievedFrameInfo:SMapanumber,numberb;cc记录收到的最大帧数据privaterecievedMaxFrame:number;publicconstructorde{superde;}publicInitde{this.noExecteCommondArray=newArrayaanybde;this.unRecievedFrameInfo=newSMapanumber,numberbde;fordleti=1;ia=3000;i++ethis.unRecievedFrameInfo.setdi,ie;this.recievedMaxFrame=-1;super.Initde;}publicGetDatade:any{cc不需要记录帧数据}cc判断是否可以删除publicCanDisposede{returntrue;}publicResetde{this.noExecteCommondArray=newArrayaanybde;}publicAddToFrameInfodframe:numbere{ifdthis.unRecievedFrameInfo.hasdframeeethis.unRecievedFrameInfo.deletedframee;ifdframebthis.recievedMaxFrameethis.recievedMaxFrame=frame;}publicIsRecievedFramedframe:numbere:boolean{return!this.unRecievedFrameInfo.hasdframee;}cc完整性校验获取缺失的帧publicGetMissFrameArrayde:number[]{letkeys=this.unRecievedFrameInfo.keysde;letframeArray:number[]=[];fordletframeofkeyse{ifdframeathis.recievedMaxFrameeframeArray.pushdframee;elsebreak;ifdframeArray.lengthb=50ebreak;}returnframeArray;}publicDisposede{this.Resetde;this.unRecievedFrameInfo.clearde;super.Disposede;}}}﻿cccareferencepath="..cECScLogicComponent.ts"cbcccareferencepath="..c..cClientLogiccRendercWarNumber.ts"cbmoduleECS{exportclassHeroDataComponentextendsLogicComponent{cc临时存储到目标的距离publictoTargetDis:number;cc是否有可以直接攻击的目标publichasValidTarget:boolean;cc临时存储八方向站位信息publictempPos:Vector2=newVector2de;publicname:string;publicshape:number;cc英雄造型publicskillEnergy:numbercc技能能量publicmass:number;publicdelayFrame:number;cc血量publichpmax:number;private_hp:number;publicgethpde:number{returnthis._hp;}publicsethpd_hp:numbere{this._hp=_hp;this.fakeHP=_hp;}publicfakeHP:number;publicisFakeDamge:boolean;cc是否是虚假结算cc属性加成ccpublicattBase:number;cc基础攻击力ccpublicdefBase:number;cc基础防御力publicattAdd:number=0;cc攻击加成单位百分比publicdefAdd:number=0;cc防御加成单位百分比publicfitAttackTime:number;cc匹配人物动作的攻击时间d用于加速epublicattackSpeedBase:number;cc基础攻速单位毫秒publicattackSpeedAdd:number=0;cc攻速加成单位百分比publiccallHeroType:number=0;cc召唤类英雄类型d空中召唤地面召唤等等eccpublicgetattde:numbercc{ccreturnMath.floorddthis.attAddc100+1e*this.attBasee;cc}ccpublicgetdefde:numbercc{ccreturnMath.floorddthis.defAddc100+1e*this.defBasee;cc}publicgetattackSpeedde:numbercc实际的攻击一次所需时间{letvalue=100cd100+this.attackSpeedAdde*this.attackSpeedBase;returnvalue;}publicgetattackSpeedUpde:numbercc攻速加速倍数{letvalue=d100+this.attackSpeedAddec100*this.attackSpeedBasecthis.fitAttackTime;ccletvalue=2;returnvalue;}publiclv:number;cc等级publicshieldmax:number=0;cc护盾最大值publicshield:number=0;cc护盾publicdieFrame:number=MathConst.MaxNumber;cc英雄死亡时间有些英雄只存活一段时间publiccreatedFrame:number;cc记录英雄创建时间publicstoppedFrame:number;cc被禁锢的总时间private_stopStartFrame:number;cc开始禁锢的时间publiclandType:number;cc陆空类型publicheroType:number;cc英雄类型publicputType:number;cc放置类型publichurtAdd:number=0;cc伤害加成单位百分比publichealAdd:number=0;cc治疗加成单位百分比publiccrit:number=0;cc暴击率单位百分比publicsuck:number=0;cc吸血率单位百分比cc目标部队idpublictargetID:number;cc目标位置（八方向站位信息）publictargetPos:Vector2=newVector2de;publicisReTarget:boolean=false;cc是否重新索敌cc嘲讽目标d优先攻击epublicsarcasmTargetID:number=0;cc阵营类型d敌方还是我方epubliccampType:number;publicatkType:number;publicdeployTime:number;cc部署时间cc上次的行为d只有两种攻击和移动连续攻击使用非首次攻击技能移动后使用首次攻击技能epubliclastAction:number;cc特殊效果publicforbidMoveCount=0;cc禁止移动publicforbidAttackCount=0;cc禁止攻击publicimmuneControlCount=0;cc免疫控制publicforbidBeLock=0;cc禁止被锁定publichideTypeCountInfo:SMapanumber,numberb;cc隐身类型heroType-bcountpublicforbidActiveSkillCount=0;cc禁止主动技能publicpauseAttackCount=0;cc技能暂停publiccbInfo:CallbackInfo;publicnextFSMFrame:number;cc下一次执行状态机的帧cc彻底从world里面删除的实际d每个单位死亡后要额外停留10帧ecc比如朱雀的技能追踪目标然后造成范围伤害如果追踪过程中目标死亡也要在目标死亡位置造成范围伤害cc所以需要目标的位置死亡后保留10帧publicdisposeFrame:number=0;publicconstructorde{superde;}publicInitde{super.Initde;this.cbInfo=newCallbackInfode;this.skillEnergy=0;this.lastAction=FSMState.Move;this.stoppedFrame=0;this._stopStartFrame=0;this.attAdd=0;cc攻击加成单位百分比this.defAdd=0;cc防御加成单位百分比this.attackSpeedAdd=0;cc攻速加成单位百分比this.callHeroType=0;this.nextFSMFrame=-1000;this.delayFrame=0;this.hideTypeCountInfo=newSMapanumber,numberbde;this.disposeFrame=0;}publicGetDatade:any{letself=this;ccletdataArray1:Arrayaanyb=newArrayaanybde;letdataArray:any[]=[self.toTargetDis,self.hasValidTarget,self.hasValidTarget,self.tempPos.x,self.tempPos.y,self.name,self.shape,self.skillEnergy,self.mass,self.delayFrame,self.hpmax,self.hp,self.fakeHP,ccself.attBase,ccself.defBase,self.attAdd,self.defAdd,self.fitAttackTime,self.attackSpeedBase,self.attackSpeedAdd,self.callHeroType,self.lv,self.shieldmax,self.shield,self.dieFrame,self.createdFrame,self.stoppedFrame,self._stopStartFrame,self.landType,self.heroType,self.putType,self.hurtAdd,self.healAdd,self.crit,self.suck,self.targetID,Math.floordself.targetPos.x*100000e,Math.floordself.targetPos.y*100000e,self.atkType,self.deployTime,self.lastAction,self.forbidMoveCount,self.forbidAttackCount,self.immuneControlCount,self.forbidBeLock,self.forbidActiveSkillCount,self.pauseAttackCount,self.nextFSMFrame,self.disposeFrame,];returndataArray;}cc判断是否可以删除publicCanDisposede{returnthis.world.frameCountb=this.disposeFrame;}publicDisposede{ifdthis.cbInfo!=nulle{this.cbInfo.Disposede;this.cbInfo=null;}super.Disposede;}cc检测目标合法性ccsrcData来源目标d谁找我epublicIsTargetValiddsrcData:HeroDataComponente:boolean{ifdthis.hpa=0ereturnfalse;ifdsrcData==nullereturntrue;cc隐身只对敌对阵营有效果ifddthis.forbidBeLockb0||this.GetHideTypeCountdsrcData.heroTypeeb0e&&srcData.campType!=this.campTypeereturnfalse;returntrue;}publicAddSkillEnergydnum:numbere{this.skillEnergy+=num;ifdthis.skillEnergybWarSettings.MaxSkillEnergyethis.skillEnergy=WarSettings.MaxSkillEnergy;ifdthis.skillEnergya0ethis.skillEnergy=0;}publicGetSkillEnergyde:number{returnthis.skillEnergy;}publicSetDamagedsrcHeroData,skobj,damage,type1,type2e{ccdamage=damagec100;ifdthis.hpa=0e{ccWarNumber.GetInstancede.ShowHurtdthis.id,0,damage,0e;return0;}damage=damageb0?Math.ceilddamagee:-Math.ceild-damagee;damage=this.ModifyHPddamage,srcHeroDatae;ifddamage==0etype2=HurtType2.Immuse;lettype3=HurtType3.Damage;ifddamagea0etype3=HurtType3.Heal;ifdthis.isFakeDamgeereturndamage;lethurtType=type1*100+type2*10+type3;ifdskobj==nulleSNetWar.ShowHurtdthis.id,0,damage,hurtTypee;elseSNetWar.ShowHurtdthis.id,skobj.id,damage,hurtTypee;ccWarNumber.GetInstancede.AddOneHurtdthis.id,skobj.actid,damage,hurtType,skobj.ide;ifddamageb0ecc伤害会增加能量{this.AddSkillEnergydWarSettings.AddSkllEnergye;ifdsrcHeroData!=null&&srcHeroData.hpb0esrcHeroData.AddSkillEnergydWarSettings.AddSkllEnergye;}returndamage;}publicModifyHPdvalue:number,srcHeroData:HeroDataComponente:number{ifdvalue==0ereturn0;ifdthis.hpa=0ereturn0;ifdvaluea0ecc治疗加成{ifdsrcHeroData!=nullevalue=value*d1+srcHeroData.healAddc100e;}elsecc伤害加成{ifdsrcHeroData!=nullevalue=value*d1+srcHeroData.hurtAddc100e;}cc治疗ifdvaluea0e{this.hp-=value;ifdthis.hpbthis.hpmaxethis.hp=this.hpmax;this.hp=Math.floordthis.hpe;ifd!this.isFakeDamgeeSkillCB.RunOnHPChangeCBdthise;returnvalue;}cc伤害处理cc先扣除buff的护盾letstateComp=aStateComponentbthis.entity.GetCompdComponentType.StateComponente;ifdstateComp!=nulle{letobj:any={damage:value};ifdthis.isFakeDamgeestateComp.SaveDatade;stateComp.ProtectModifydobje;ifdthis.isFakeDamgeestateComp.LoadDatade;ccbuff护盾值恢复value=obj.damage;ifdvalue==0ereturn0;}cc扣除英雄自身的护盾ifdthis.shieldb0ecc护盾值无论剩下多少都可以抵挡一次伤害{ifdthis.isFakeDamgeecc如果有护盾虚假计算直接略过return0;this.shield-=value;ifdthis.shielda=0ethis.shield=0;returnvalue;}this.hp-=value;ifdthis.hpa0ethis.hp=0;this.hp=Math.floordthis.hpe;ifdGameData.TestFighte{ifdLogicWarUtil.IsTowerdthis.shapee&&this.hpa=0e{this.hpmax=Math.floordthis.hpmax*1.1e;this.hp=this.hpmax;}}ifdthis.isFakeDamgeereturnvalue;SkillCB.RunOnHPChangeCBdthise;ifdthis.hpa=0e{SkillCB.RunOnDieCBdthis,srcHeroDatae;cc英雄自己死亡复活在这里处理}ifdthis.hpa=0ecc死亡后打断所有技能TODONIU死亡后已经射出去的弓箭类技能不能打断就是unlockHero之后这个技能无论如何不能打断{this.OnDiedsrcHeroDatae;}returnvalue;}cc死亡publicOnDiedsrcHeroData:HeroDataComponente{ifdthis.hpb0ereturn;SkillCB.RunOnKillHeroCBdsrcHeroData,thise;cc杀死英雄SkillCB.RunOnAnyHeroDieCBdthis.world,this,srcHeroDatae;cc任意英雄死亡ccthread.logd"--------英雄死亡播放死亡动画----------",this.ide;letactid=this.world.NewFightIDde;SNetWar.FireEventdGlobalEventType.DoSkillRender,this.entity.id,MathConst.DieMagicID,actid,[],1e;ccTODONIU这里还没处理完这里注意这里移除最后一个组件的时候第二个参数才设置为truecc死亡后不能立刻删除因为死亡后触发技能还需要这些组件来计算技能伤害ccthis.entity.RemoveCompdComponentType.StateComponent,truee;letssc=aSkillStatusComponentbthis.entity.GetCompdComponentType.SkillStatusComponente;ifdssc!=nulle{ssc.StopAllSkilldthis.world.frameCount+1e;cc下一帧打断技能}letstateComp=aStateComponentbthis.entity.GetCompdComponentType.StateComponente;ifdstateComp!=nulle{stateComp.DisposeAllStatede;}letwarComp=aWarComponentbthis.world.GetSingletonCompdComponentType.WarComponente;warComp.SetHeroDiedthis.atkType,this.shape,this.ide;cc解锁位置锁定this.world.warContainer.UnlockHerodthis.id,this.landTypee;cc死亡后解除碰撞停止移动lettrans=aTransformComponentbthis.entity.GetCompdComponentType.TransformComponente;ifdtrans!=nulle{trans.ReleaseCollidede;trans.moveable=false;trans.moveSpeedBase=0;}lettowerComp=aTowerComponentbthis.entity.GetCompdComponentType.TowerComponente;ifdtowerComp!=nulle{towerComp.ReleaseCollidede;}cc死亡后额外等待10帧this.disposeFrame=this.world.frameCount+11;}cc特殊效果ccpublicSetIsForbidMovedisForbid:booleane{ifdisForbidethis.forbidMoveCount+=1;else{ifdthis.forbidMoveCountb0ethis.forbidMoveCount-=1;}ifdthis.forbidMoveCountb0ecc被定身后强制同步渲染层位置{SNetWar.FireEventdGlobalEventType.ForceSyncRenderPos,this.entity.ide;}}publicSetIsForbidAttackdisForbid:booleane{ifdisForbidethis.forbidAttackCount+=1;else{ifdthis.forbidAttackCountb0ethis.forbidAttackCount-=1;}ifdthis.forbidAttackCountb0e{letssc:SkillStatusComponent=aSkillStatusComponentbthis.entity.GetCompdComponentType.SkillStatusComponente;ifdssc!=nullessc.StopAllSkilldthis.world.frameCounte;}this.CheckForbidAttackde;}publicSetIsPauseAttackdisPause:booleane{ifdisPausee{this.pauseAttackCount+=1;}else{ifdthis.pauseAttackCountb0ethis.pauseAttackCount-=1;}letssc:SkillStatusComponent=aSkillStatusComponentbthis.entity.GetCompdComponentType.SkillStatusComponente;ifdssc!=nullessc.PauseSkilldthis.pauseAttackCountb0e;this.CheckForbidAttackde;}privateCheckForbidAttackde{ifdthis.HasBuffdMathConst.PrepareMagicIDe||this.HasBuffdMathConst.DeployMagicIDee{this.stoppedFrame=0;return;cc部署或者准备中不计算禁锢时间}ifdthis.pauseAttackCountb0||this.forbidAttackCountb0e{this.targetID=0;cc技能打断失去当前目标lettrans:TransformComponent=aTransformComponentbthis.entity.GetCompdComponentType.TransformComponente;ifdtrans!=nullecc打断位移累计trans.totalMoveDis=0;ifdthis._stopStartFrame==0ethis._stopStartFrame=this.world.frameCount;}else{ifdthis._stopStartFrame!=0e{cc累加禁锢时间this.stoppedFrame+=this.world.frameCount-this._stopStartFrame;this._stopStartFrame=0;}}}publicSetIsImmuseContrldisImmuse:booleane{ifdisImmuseethis.immuneControlCount+=1;else{ifdthis.immuneControlCountb0ethis.immuneControlCount-=1;}}publicSetIsForbidBeLockdisForbid:booleane{ifdisForbidethis.forbidBeLock+=1;else{ifdthis.forbidBeLockb0ethis.forbidBeLock-=1;}}publicSetIsForbidActiveSkilldisForbid:booleane{ifdisForbidethis.forbidActiveSkillCount+=1;else{ifdthis.forbidActiveSkillCountb0ethis.forbidActiveSkillCount-=1;}}cc嘲讽目标publicSetSarcasmTargetdtargetID:number,isEnable:booleane{ifdisEnablee{ifdthis.sarcasmTargetID==0ethis.sarcasmTargetID=targetID;}else{ifdthis.sarcasmTargetID==targetIDethis.sarcasmTargetID=0;}}publicSetHideTypedtypeArray:number[]e{fordlettypeoftypeArraye{ifd!this.hideTypeCountInfo.hasdtypeeethis.hideTypeCountInfo.setdtype,0e;letcount=this.hideTypeCountInfo.getdtypee;this.hideTypeCountInfo.setdtype,count+1e;}}publicGetHideTypeCountdtype:numbere:number{ifd!this.hideTypeCountInfo.hasdtypeeereturn0;returnthis.hideTypeCountInfo.getdtypee;}publicHasBuffdbuffId:numbere:boolean{letstateComp=aStateComponentbthis.entity.GetCompdComponentType.StateComponente;ifdstateComp==nullereturnfalse;returnstateComp.GetStatedbuffIde!=null;}publicAddBuffdbuffId:numbere{letstateComp=aStateComponentbthis.entity.GetCompdComponentType.StateComponente;ifdstateComp!=nullestateComp.AddStatedbuffId,this.id,nulle;}publicGetDistancedtarget:HeroDataComponente:number{letmyTrans=aTransformComponentbthis.entity.GetCompdComponentType.TransformComponente;lettargetTrans=aTransformComponentbtarget.entity.GetCompdComponentType.TransformComponente;ifdmyTrans==null||targetTrans==nullereturn0;else{returnMathUtil.distancedmyTrans.pos,targetTrans.pose;}}publicgettotalMoveDisde:number{lettrans:TransformComponent=aTransformComponentbthis.entity.GetCompdComponentType.TransformComponente;ifdtrans!=nullereturntrans.totalMoveDis;return0;}publicsettotalMoveDisddis:numbere{lettrans:TransformComponent=aTransformComponentbthis.entity.GetCompdComponentType.TransformComponente;ifdtrans!=nulletrans.totalMoveDis=0;}publicUseSkilldid:numbere{letssc=aSkillStatusComponentbthis.entity.GetCompdComponentType.SkillStatusComponente;ifdssc!=nulle{lettemplate=ssc.GetValidSkill2dide;ifdtemplate!=nulle{letskobj=ssc.UseSkilldtemplatee;}else{thread.warnd"--------HeroDataComponent.UseSkillerror-------------",ide;}}}cc强制移动到指定位置publicForceMoveTodx:number,y:numbere{lettrans:TransformComponent=aTransformComponentbthis.entity.GetCompdComponentType.TransformComponente;ifdtrans!=nulletrans.forceTargetPos=newVector2d[x,y]e;}}}﻿cccareferencepath="..cECScLogicComponent.ts"cbmoduleECS{exportclassPlayerCommandRecordComponentextendsLogicComponent{publicdefaultInput:CommandComponent;publicinputCache:SMapanumber,CommandComponentb=newSMapanumber,CommandComponentbde;cc输入缓存publicframeArray:number[]=[];publicconflictCache:SMapanumber,booleanb=newSMapanumber,booleanbde;cc冲突缓存publicisConflict:boolean=false;publiclastInputFrame:number=-1;publicconstructorde{superde;}publicInitde{super.Initde;this.defaultInput=newCommandComponentde;this.inputCache=newSMapanumber,CommandComponentbde;this.frameArray=[];this.conflictCache=newSMapanumber,booleanbde;this.isConflict=false;this.lastInputFrame=-1;}publicDisposede{this.frameArray.length=0;this.ClearCachede;this.conflictCache.clearde;super.Disposede;}publicGetDatade:any{cc不需要记录帧数据letself=this;letframe=this.world.frameCount;letcmdComp=this.GetInputCachedframee;letdataArray:any[]=[];ifdcmdComp!=nulledataArray.pushdcmdComp.GetDatadee;returndataArray;}cc判断是否可以删除publicCanDisposede{returntrue;}publicGetInputCachedframe:numbere:CommandComponent{ifdthis.inputCache.hasdframeeereturnthis.inputCache.getdframee;returnnull;}cc预测输入publicGetForecastInputdframe:numbere:CommandComponent{cc取出上一帧的缓存赋值给下一帧做预测用letrecord=this.GetInputCachedthis.lastInputFramee;cc没有则取默认值ifdrecord==nulle{record=this.defaultInput;}letcmd=record.DeepCopyde;cmd.id=this.entity.id;cmd.frame=frame;returncmd;}publicRecordCommanddcmd:CommandComponente{ccthread.logd"RecordCommand:id:",this.id,"frame:",cmd.framee;this.inputCache.setdcmd.frame,cmde;this.frameArray.pushdcmd.framee;ccletnewFrameArray:number[]=[];ccfordletframeofthis.frameArrayecc{ccifdcmd.frame-frameb20ecc太久远的帧数据不要了TODONIU缓存起来cc{ccletcmd1=this.inputCache.getdframee;cccmd1.Disposede;ccthis.inputCache.deletedframee;cc}ccelsecc{ccnewFrameArray.pushdframee;cc}cc}ccthis.frameArray=newFrameArray;}publicIsServerReadydframe:numbere:boolean{returnthis.inputCache.hasdframee;}publicClearCachede{letvalues=this.inputCache.valuesde;fordletvalueofvaluese{value.Disposede;}this.inputCache.clearde;}cc这个函数只有服务器数据过来的时候才会调用publicSetConflictdframe:number,isConfict:booleane{this.conflictCache.setdframe,isConficte;}publicGetConflictdframe:numbere:boolean{ifdthis.conflictCache.hasdframeeereturnthis.conflictCache.getdframee;returnfalse;}cc判定服务器的帧数据是否已经回来了publicGetAllMessagedframe:numbere:boolean{returnthis.conflictCache.hasdframee;}}}﻿cccareferencepath="..cECScLogicComponent.ts"cbmoduleECS{cc记录当前可拖拽和可放技能英雄的数据exportclassHeroIconData{publicuniqueId:number;publicindex:number;publiciconType:number;cc1：unitIcon2：skillIconpublicid:number;cc记录这种卡牌对应战场中哪个英雄publicshape:number;publiccost:number;publiclockedStartFrame:number;publicworld:WorldBaseaEntityBaseb;cc0:没有任何操作cc1:客户端已经使用该卡牌等待服务器回应dalpha为0ecc2:使用卡牌失败dalpha重置为1eccpubliclastState:number;publicnowState:number;publicconstructordworldObj:WorldBaseaEntityBaseb,uniqueId:numbere{this.world=worldObj;ccthis.lastState=0;this.nowState=0;this.uniqueId=uniqueId;}publicDisposede{this.world=null;ccthis.lastState=0;this.nowState=0;}publicIsLockedde:boolean{returnthis.world.frameCount-this.lockedStartFramea=10&&this.nowState==1;}}c***具有玩家数据的组件*cexportclassRealPlayerComponentextendsLogicComponent{publicplayerData:PreWarItemData;publicposType:number;cc11攻击1号位12攻击2号位21防守1号位22防守2号位publicisRobot:boolean;publickingTowerID:number;publicqueenTowerID:number;publiccampType:number;cc阵营信息publicatkType:number;publicsceneID:number;privatemaxEnergy:number;privatenowEnergy:number;privatecostEnergyInfo:SMapanumber,numberb;privateheroDataMap:SMapanumber,game.CardDataItemb;privatecardQueue:number[];cc卡牌队列privatetowerIdArray:number[];privatenextHeroShape:number;privateindex2HeroIconMap:SMapanumber,HeroIconDatab;privateshape2HeroIconMap:SMapanumber,numberb;publicconstructorde{superde;}publicInitde{super.Initde;this.isRobot=false;this.costEnergyInfo=newSMapanumber,numberbde;this.heroDataMap=newSMapanumber,game.CardDataItembde;this.cardQueue=[];this.nextHeroShape=null;this.index2HeroIconMap=newSMapanumber,HeroIconDatabde;this.shape2HeroIconMap=newSMapanumber,numberbde;this.towerIdArray=[];letwarComp=aWarComponentbthis.world.GetSingletonCompdComponentType.WarComponente;this.sceneID=warComp.sceneID;}publicGetDatade:any{letself=this;letdataArray:any[]=[self.posType,self.atkType,self.sceneID,self.isRobot,self.maxEnergy,Math.floordself.nowEnergy*100e,game.Utils.ArrayCopydself.cardQueuee,self.kingTowerID,self.queenTowerID,game.Utils.ArrayCopydself.towerIdArraye,self.nextHeroShape,];letkeys=this.index2HeroIconMap.keysde;fordletkeyofkeyse{leticonData=this.index2HeroIconMap.getdkeye;letdata:number[];ifdthis.isRobotedata=[iconData.index,iconData.iconType,iconData.id,iconData.shape,iconData.lockedStartFrame,iconData.nowState];elsedata=[iconData.index,iconData.iconType,iconData.id,iconData.shape];dataArray.pushddatae;}returndataArray;}cc判断是否可以删除publicCanDisposede{returntrue;}publicDisposede{this.DisposeHerode;this.towerIdArray=[];this.costEnergyInfo.clearde;super.Disposede;}publicDisposeHerode{letheroDataArray=this.heroDataMap.valuesde;fordletheroDataofheroDataArraye{heroData.Destroyde;}this.heroDataMap.clearde;ifdthis.index2HeroIconMap!=nullethis.index2HeroIconMap.clearde;ifdthis.shape2HeroIconMap!=nullethis.shape2HeroIconMap.clearde;this.nowEnergy=WarSettings.InitHeroEnergy;this.maxEnergy=WarSettings.InitMaxHeroEnergy;}privatecmdID:number=0;publicGetCmdIDde:number{this.cmdID++;returnthis.cmdID;}cc收到服务器开始战斗数据publicInitStartWarDatade{cc该函数需要服务器的随机种子才能继续执行this.InitHeroIconde;}publicStartde{this.nowEnergy=WarSettings.InitHeroEnergy;this.maxEnergy=WarSettings.InitMaxHeroEnergy;}publicInitPlayerDatadplayerData:PreWarItemDatae{this.DisposeHerode;letwarComp=aWarComponentbthis.world.GetSingletonCompdComponentType.WarComponente;this.playerData=playerData;this.isRobot=playerData.isRobot;ccthread.logd"-------InitPlayerDataInitPlayerData----bbbbbbbbbbbbbbbbbb",this.id,data.pos,warComp.myAtkTypee;this.posType=playerData.posType;this.atkType=playerData.atkType;ifdthis.atkType==warComp.myAtkTypeethis.campType=CampType.Friend;elsethis.campType=CampType.Enemy;cc兵种和防御塔fordletheroDataofplayerData.teamInfoe{letheroObj=this.AddHeroObjdheroData.id,heroData.lve;heroObj.goldLevel=heroData.goldLv;ccfordletskillDataofheroData.skillsecc{ccheroObj.AddSkilldskillData.id,skillData.lve;cc}}this.kingTowerID=playerData.kingTowerID;this.queenTowerID=playerData.queenTowerID;}publicAddHeroObjdshape:number,lv:numbere:game.CardDataItem{ifdthis.heroDataMap.hasdshapeeereturnthis.heroDataMap.getdshapee;this.heroDataMap.setdshape,WarFactory.CreateCardDataItemdshapeee;letcardObj=this.heroDataMap.getdshapee;cardObj.id=shape;cardObj.cost=cardObj.cost*WarSettings.EnergyRatio;cardObj.SetLvdlve;ifd!LogicWarUtil.IsSpelldshapeee{letheroObj=agame.HeroDataItembcardObj;fordletinfoofheroObj.mainheroe{letsubShape=info[0];this.AddHeroObjdsubShape,lve;}fordletinfoofheroObj.childheroe{letsubShape=info[0];this.AddHeroObjdsubShape,lve;}}returncardObj;}publicGetHeroDatadshape:numbere:game.CardDataItem{letheroObj=this.heroDataMap.getdshapee;returnheroObj;}publicIsLogicReverserPosde:boolean{returnthis.campType==CampType.Enemy;}publicIsMySelfde:boolean{letwarComp=aWarComponentbthis.world.GetSingletonCompdComponentType.WarComponente;returnthis.id==warComp.myFightRoleId;}cc创建两边的防御塔publicInitTowerde{ifd!LogicWarUtil.IsLeaderdthis.posTypeeereturn;letworldObj=this.world;lettowerPosArray=this.atkType==AtkType.Attack?MathConst.AttackTowerPos:MathConst.DefendTowerPos;lettowerIdArray=[this.queenTowerID,this.kingTowerID,this.queenTowerID];fordletindex=0;indexatowerIdArray.length;index++e{lettowerId=towerIdArray[index];letheroObj=this.GetHeroDatadtowerIde;ifdheroObj==nullecc不存在的防御塔{thread.logd"towerIdnotexist",towerIde;continue;}letposInfo=towerPosArray[index];letx=posInfo[0];lety=posInfo[1];letentityID=this.AddOneHeroToScenedheroObj,this.campType,x,y,this.sceneID,0e;letentity=worldObj.GetEntitydentityIDe;letcomp:TowerComponent=aTowerComponentbWarFactory.CreateComponentdComponentType.TowerComponent,worldObje;comp.id=entityID;comp.entity=entity;comp.towerPos=this.atkType*10+index;comp.atkType=this.atkType;comp.shape=towerId;comp.Initde;entity.AddCompExdComponentType.TowerComponent,comp,truee;this.towerIdArray.pushdentityIDe;}}publicAddOneHeroToScened_heroObj:game.CardDataItem,campType:number,x:number,y:number,parentID:number,delayFrame:numbere:number{letheroObj=agame.HeroDataItemb_heroObj;letworldObj=this.world;letid=this.world.NewFightIDde;letcomps=newSMapanumber,LogicComponentbde;ccHeroDataComponentletcomp:HeroDataComponent=aHeroDataComponentbWarFactory.CreateComponentdComponentType.HeroDataComponent,worldObje;comp.Initde;comp.id=id;comp.shape=heroObj.id;comp.name=heroObj.name;comp.hpmax=heroObj.hp;comp.hp=heroObj.hp;comp.fakeHP=heroObj.hp;comp.shield=heroObj.shield;comp.shieldmax=heroObj.shield;cccomp.attBase=heroObj.att;cccomp.defBase=heroObj.def;comp.fitAttackTime=heroObj.attackSpeed;comp.attackSpeedBase=heroObj.attackSpeed;comp.targetID=0;comp.campType=campType;comp.atkType=this.atkType;comp.lv=heroObj.lv;comp.shield=heroObj.shield;comp.shieldmax=heroObj.shield;comp.heroType=heroObj.heroType;comp.landType=heroObj.landType;comp.putType=heroObj.putType;comp.deployTime=heroObj.deployTime;comp.callHeroType=heroObj.callHeroType;comp.mass=heroObj.mass;comp.delayFrame=delayFrame;ifdheroObj.lifeTime==0ecomp.dieFrame=0;elsecomp.dieFrame=worldObj.frameCount+heroObj.lifeTimecMathConst.KeyFrameTime;comp.createdFrame=worldObj.frameCount;comps.setdComponentType.HeroDataComponent,compe;ccTransformComponentletcomp1:TransformComponent=aTransformComponentbWarFactory.CreateComponentdComponentType.TransformComponent,worldObje;comp1.Initde;ifdparentID==0ecomp1.parentID=this.sceneID;elsecomp1.parentID=parentID;comp1.id=id;comp1.hasCollide=false;x=game.Utils.toFixedNumberdxe;y=game.Utils.toFixedNumberdye;ifd!LogicWarUtil.IsTowerdheroObj.idee{letpos=this.world.warContainer.GetWalkablePosdx,y,heroObj.landType,heroObj.putType,campType,this.atkTypee;x=pos[0];y=pos[1];}comp1.landType=heroObj.landType;comp1.collideType=game.Utils.ArrayCopydheroObj.collideTypee;ifdcomp1.collideType.lengthb=2&&comp1.collideType[0]!=comp1.collideType[1]ecc可以越过全部阻挡comp1.putOnCollide=true;elseifdcomp1.collideType.length==0ecc不填任何阻挡空军可以越过全部阻挡comp1.putOnCollide=dheroObj.landType==LandType.Aire;elsecomp1.putOnCollide=false;cc不能越过阻挡comp1.fitMoveSpeed=heroObj.moveSpeed;comp1.moveSpeedBase=heroObj.moveSpeed;comp1.scale=heroObj.scale;comp1.range=heroObj.range;ifdLogicWarUtil.IsKingTowerdheroObj.idee{cccomp1.searchCenterPos=newVector2d[x,y]e;cccomp1.searchRadius=MathConst.KingSearchRadius;comp1.hasCollide=false;cc国王塔无视碰撞}comp1.SetTransPosdx,y,truee;comps.setdComponentType.TransformComponent,comp1e;ccSkillStatusComponentletcomp2:SkillStatusComponent=aSkillStatusComponentbWarFactory.CreateComponentdComponentType.SkillStatusComponent,worldObje;comp2.Initde;letskData:game.SkillDataItem;fordletskillIDofheroObj.normalSkillIdArraye{letskid=skillID;skData=heroObj.GetSkilldskide;comp2.AddSkillTemplatedskDatae;}fordletskillIDofheroObj.askillIdArraye{letskid=skillID;skData=heroObj.GetSkilldskide;comp2.AddSkillTemplatedskDatae;}fordletskillIDofheroObj.pskillIdArraye{letskid=skillID;skData=heroObj.GetSkilldskide;comp2.AddSkillTemplatedskDatae;}comps.setdComponentType.SkillStatusComponent,comp2e;ccDrawComponentletcomp3:DrawComponent=aDrawComponentbWarFactory.CreateComponentdComponentType.DrawComponent,worldObje;ifdLogicWarUtil.IsQueenTowerdheroObj.idee{comp3.classType=ObjectType.HeroQueue;ifdthis.campType==CampType.Friendecomp3.args=`hero_${heroObj.clipName}`;elsecomp3.args=`hero_${heroObj.clipName+1}`;}else{comp3.classType=ObjectType.HeroBase;comp3.args=`hero_${heroObj.clipName}`;}comp3.shapeID=heroObj.id;comp3.Initde;comps.setdComponentType.DrawComponent,comp3e;ccStateComponentletcomp4:StateComponent=aStateComponentbWarFactory.CreateComponentdComponentType.StateComponent,worldObje;comp4.Initde;comps.setdComponentType.StateComponent,comp4e;letentity=worldObj.CreateEntitydid,compse;entity.pid=this.id;cc设置英雄属于哪个玩家阵营SNetWar.AddOneHeroToScenedthis.id,id,heroObj.id,heroObj.lv,campType,x,y,parentID,delayFramee;returnid;}cc添加英雄返回进入战场的英雄publicAddHeroToScenedshape:number,campType:number,x:number,y:number,cardID:numbere:number[]{letidArray:number[]=[];letheroObj=agame.HeroDataItembthis.GetHeroDatadshapee;ifdheroObj==nulle{thread.warnd"youuseinvalidshapeheroshapeis:",shapee;returnidArray;}letworldObj=this.world;letmainHeroID:number=0;fordletinfoofheroObj.mainheroe{letshape=info[0];letoffsetX=info[1];letoffsetY=info[2];letdelayFrame=info[3];letlv=heroObj.lv;letmainHeroObj=this.AddHeroObjdshape,lve;ccthread.logd`----实际释放的位置--PreviewCard.InitRender---cardX:${x}cardY:${y}---offsetX:${offsetX}offsetY:${offsetY}-------`e;mainHeroID=this.AddOneHeroToScenedmainHeroObj,campType,x+offsetX,y+offsetY,0,delayFramee;idArray.pushdmainHeroIDe;}fordletinfoofheroObj.childheroe{letshape=info[0];letoffsetX=info[1];letoffsetY=info[2];letdelayFrame=info[3];letlv=heroObj.lv;letchildHeroObj=this.AddHeroObjdshape,lve;letchildHeroID=this.AddOneHeroToScenedchildHeroObj,campType,offsetX,offsetY,mainHeroID,delayFramee;idArray.pushdchildHeroIDe;}ifdidArray.length==0e{letchildHeroID=this.AddOneHeroToScenedheroObj,campType,x,y,0,0e;idArray.pushdchildHeroIDe;}returnidArray;}cc添加一个法术publicAddSpellToScenedshape:number,x:number,y:number,cardID:numbere{letcomp=aSpellComponentbthis.entity.GetCompdComponentType.SpellComponente;comp.UseSpelldshape,this.campType,this.atkType,x,ye;}publicGetEnergyde:number{returnMath.floordthis.nowEnergye;}publicGetMaxEnergyde:number{returnthis.maxEnergy;}cc这个函数只是给界面UI调用要扣除已经虚假使用过的能量publicGetEnergyPrecisede:number{letusedCount=0;letvalues=this.costEnergyInfo.valuesde;fordletvalueofvalueseusedCount+=value;ifdthis.nowEnergy-usedCounta0e{thread.errord"GetEnergyPreciseenergya0error:",this.nowEnergy-usedCountereturn0;}returnthis.nowEnergy-usedCount;}cc这个函数只是给界面UI调用要扣除已经虚假使用过的能量publicGetShowEnergyde:number{returnthis.GetEnergyPrecisedecWarSettings.EnergyRatio;}publicAddEnergydnum:numbere:boolean{ifdnumb0e{this.nowEnergy+=num;ifdthis.nowEnergybthis.maxEnergyethis.nowEnergy=this.maxEnergy;returntrue;}else{ifdthis.nowEnergy+numb=0e{this.nowEnergy+=num;returntrue;}returnfalse;}}cc客户端先行扣除能量（不是真正的扣除只是打个标记用于界面刷新）publicFakeUseEnergydnum:number,cmdIDe:boolean{cc标记能量已经扣除this.costEnergyInfo.setdcmdID,nume;returntrue;}publicUseEnergydnum:numbere:boolean{cc开始扣除能量ifdthis.AddEnergyd-numee{returntrue;}elsecc扣除能量失败{returnfalse;}}cc服务器数据确认释放成功或者失败或者服务器超过2s没有回包虚假使用的能量恢复publicRecoverEnergydcmdID:numbere{ifdthis.costEnergyInfo.hasdcmdIDee{this.costEnergyInfo.deletedcmdIDe;}}publicUpdateEnergyddeltaTime:numbere{letframeCount=this.world.frameCount;this.maxEnergy=WarSettings.InitMaxHeroEnergy+Math.floordframeCountc300e*WarSettings.EnergyRatio;cc能量上限每间隔30s增加一点ifdthis.maxEnergybWarSettings.MaxMaxHeroEnergyecc不能超过总上限this.maxEnergy=WarSettings.MaxMaxHeroEnergy;ifdframeCount%WarSettings.AddEnergyInterval==0ecc每隔3帧恢复一次能量{letaddEnery=WarSettings.AddHeroEnergy*4+Math.floordframeCountc300e*WarSettings.AddHeroEnergy;ifdaddEneryb280eaddEnery=280;this.nowEnergy+=deltaTimec1000*addEnery;ifdthis.nowEnergybthis.maxEnergyethis.nowEnergy=this.maxEnergy;}ccthis.CheckHeroDiede;}publicUpdateTowerBurnddieTowerShapes:number[]ecc防御塔燃烧{letpercent=1;ifddieTowerShapes==null||dieTowerShapes.length==0ecc未损失水晶每3帧损失1%percent=1;elseifddieTowerShapes.length==1ecc损失1水晶每3帧损失2%percent=2;elsecc损失2水晶每3帧损失3%percent=3;fordlettowerIdofthis.towerIdArraye{letheroData=aHeroDataComponentbthis.world.GetCompByIDdtowerId,ComponentType.HeroDataComponente;ifdheroData!=nulle{letdamage=Math.floordheroData.hpmax*percentc100e;heroData.SetDamagednull,null,damage,HurtType1.Buff,HurtType2.Generale;}letstateCom=aStateComponentbthis.world.GetCompByIDdtowerId,ComponentType.StateComponente;ifdstateCom!=nulle{ifdheroData!=null&&heroData.hpb0e{ifd!stateCom.GetStated9001eecc燃烧buffstateCom.AddStated9001,0,nulle;}else{stateCom.RemoveStated9001,1000e;}}}}cc获取下一张卡牌privateGetNextHeroShapede{ccfordletshapeofthis.heroDataMap.keysdeecc{ccletheroObj=this.GetHeroDatadshapee;ccifdLogicWarUtil.IsTowerdheroObj.ideecccontinue;ccifdthis.shape2HeroIconMap.hasdshapeeecccontinue;ccreturnshape;cc}ifdthis.cardQueue.lengthb0ereturnthis.cardQueue.shiftde;returnnull;}privateInitHeroIconde{fordletshapeofthis.heroDataMap.keysdee{letheroObj=this.GetHeroDatadshapee;ifdLogicWarUtil.IsTowerdheroObj.ideecontinue;this.cardQueue.pushdshapee;}cc随机打乱顺序letnewQueue:number[]=[];letcardCount=this.cardQueue.length;letdescStr:string="";fordleti=0;iacardCount;i++e{letrandomIndex=this.world.GetRandomRanged0,this.cardQueue.length-1e;newQueue.pushdthis.cardQueue[randomIndex]e;this.cardQueue.splicedrandomIndex,1e;descStr+=`index:${randomIndex}shape::${this.cardQueue[randomIndex]}`;}this.cardQueue=newQueue;letindex=0;fordleti=0;iaMathConst.MaxIconCount;i++e{ifdthis.cardQueue.length==0ebreak;ifdindexb=MathConst.MaxIconCountebreak;letshape=this.cardQueue.shiftde;ccifdthis.shape2HeroIconMap.hasdshapeeecccontinue;ifdshape==nulle{thread.logd"desc:",descStre;}this.AddUnitIcondshape,indexe;index++;}this.GetNextCardde;}privateCheckHeroDiede{letvalues=this.index2HeroIconMap.valuesde;fordleticonObjofvaluese{ifdiconObj.iconType==1econtinue;letheroDataComp=this.world.logicHeroManager.GetHeroDatadiconObj.ide;ifdheroDataComp.hpa=0e{this.RemoveIcondiconObj.indexe;ifdthis.nextHeroShape!=nulle{this.AddUnitIcondthis.nextHeroShape,iconObj.indexe;this.nextHeroShape=null;}else{letnextComineID=this.GetNextHeroShapede;ifdnextComineID!=nullethis.AddUnitIcondnextComineID,iconObj.indexe;}this.GetNextCardde;}}}publicGetNextCardde:number{ifdthis.nextHeroShape==nullethis.nextHeroShape=this.GetNextHeroShapede;returnthis.nextHeroShape;}publicServerReadyAddHerodshape:number,index:number,success:booleane{ccthis.AddSkillIcondid,shape,indexe;cc使用卡牌英雄失败ifd!successe{letheroIconData=this.index2HeroIconMap.getdindexe;ifdheroIconData!=nulle{heroIconData.nowState=2;}return;}this.RemoveIcondindexe;this.cardQueue.pushdshapee;ifdthis.nextHeroShape!=nulle{this.AddUnitIcondthis.nextHeroShape,indexe;this.nextHeroShape=null;}else{letnextComineID=this.GetNextHeroShapede;ifdnextComineID!=nullethis.AddUnitIcondnextComineID,indexe;}this.GetNextCardde;}publicServerReadyAddSpelldshape:number,index:number,success:booleane{ifd!successe{leticonObj=this.index2HeroIconMap.getdindexe;ifdiconObj!=nulle{iconObj.nowState=2;}return;}this.RemoveIcondindexe;this.cardQueue.pushdshapee;ifdthis.nextHeroShape!=nulle{this.AddUnitIcondthis.nextHeroShape,indexe;this.nextHeroShape=null;}else{letnextComineID=this.GetNextHeroShapede;ifdnextComineID!=nullethis.AddUnitIcondnextComineID,indexe;}this.GetNextCardde;}publicHeroSkillSuccessdid:number,index:numbere{leticonObj=this.GetHeroIconDatadindexe;ifdiconObj!=nulle{ccthread.logd"---------HeroSkillSuccess-------",id,indexe;iconObj.lockedStartFrame=0;}}privateAddUnitIcondshape:number,index:numbere{this.RemoveIcondindexe;leticonObj=newHeroIconDatadthis.world,this.GetCmdIDdee;iconObj.index=index;iconObj.iconType=1;iconObj.shape=shape;iconObj.lockedStartFrame=0;letheroObj=this.GetHeroDatadshapee;ifdheroObj!=nulleiconObj.cost=heroObj.cost;else{iconObj.cost=100;thread.errord"---------AddUnitIconerror:----------bbbbbbbbbbbbbbbb",shapee;}this.index2HeroIconMap.setdindex,iconObje;this.shape2HeroIconMap.setdshape,shapee;}privateAddSkillIcondid:number,shape:number,index:numbere{this.RemoveIcondindexe;leticonObj=newHeroIconDatadthis.world,0e;iconObj.index=index;iconObj.iconType=2;iconObj.shape=shape;iconObj.id=id;iconObj.lockedStartFrame=0;this.index2HeroIconMap.setdindex,iconObje;this.shape2HeroIconMap.setdshape,shapee;}privateRemoveIcondindex:numbere{leticonObj=this.index2HeroIconMap.getdindexe;ifdiconObj!=nulle{iconObj.Disposede;ifdthis.shape2HeroIconMap.hasdiconObj.shapeeethis.shape2HeroIconMap.deletediconObj.shapee;this.index2HeroIconMap.deletedindexe;}}publicGetHeroIconDatadindex:numbere:HeroIconData{returnthis.index2HeroIconMap.getdindexe;}publicLockHeroIcondindex:numbere{leticonObj=this.GetHeroIconDatadindexe;ifdiconObj!=nulle{ccthread.logd"---------LockHeroIcon-------",iconObj.id,indexe;iconObj.lockedStartFrame=this.world.frameCount;}}}}﻿cccareferencepath="..cECScLogicComponent.ts"cbmoduleECS{exportclassSelfComponentextendsLogicComponent{publicconstructorde{superde;}publicGetDatade:any{cc不需要记录帧数据}cc判断是否可以删除publicCanDisposede{returntrue;}}}﻿cccareferencepath="..cECScLogicComponent.ts"cbmoduleECS{exportclassSkillStatusComponentextendsLogicComponent{publicskillArray:ArrayaHeroSkillDatab;cc主动技能privatetemplateDict:SMapanumber,SkillDataTemplateb;privatetemplateArray:ArrayaSkillDataTemplateb;cc被动技能privatepSkillTemplateDict:SMapanumber,SkillDataTemplateb;cc替换普攻privatenextSkillTemplateArray:ArrayaSkillDataTemplateb;privatestopSkillFrame:number;publicconstructorde{superde;}publicGetDatade:any{letself=this;letdataArray:any[]=[self.stopSkillFrame];letdata:number[];fordletskobjofself.skillArraye{dataArray.pushdskobj.GetDatadee;}dataArray.pushdself.nextSkillTemplateArray.lengthe;fordletskobjofself.nextSkillTemplateArrayedataArray.pushdskobj.ide;returndataArray;}cc判断是否可以删除publicCanDisposede{cc技能没释放完不能销毁ifdthis.skillArray.lengthb0ereturnfalse;returntrue;}publicInitde{super.Initde;this.templateDict=newSMapanumber,SkillDataTemplatebde;this.templateArray=newArrayaSkillDataTemplatebde;this.skillArray=newArrayaHeroSkillDatabde;this.pSkillTemplateDict=newSMapanumber,SkillDataTemplatebde;this.nextSkillTemplateArray=newArrayaSkillDataTemplatebde;this.stopSkillFrame=99999;}publicDisposede{fordletvalueofthis.templateArraye{value.Disposede;}this.templateArray.length=0this.templateDict.clearde;letvalues=this.pSkillTemplateDict.valuesde;fordletvalueofvaluese{value.Disposede;}this.pSkillTemplateDict.clearde;fordletskillObjofthis.skillArraye{WarFactory.DestroyObjectdskillObj,ObjectType.HeroSkillData,nulle;}this.skillArray.length=0;this.nextSkillTemplateArray.length=0;super.Disposede;}publicGetTemplateDatadid:numbere:SkillDataTemplate{ifdthis.templateDict.hasdideereturnthis.templateDict.getdide;returnnull;}publicAddSkillTemplatedskData:game.SkillDataItemecc技能模板{ifd!this.templateDict.hasdskData.idee{letdata=newSkillDataTemplatedskData,this.worlde;data.skillType=skData.skillType;ifddata.skillType==SkillType.PassiveSkillethis.pSkillTemplateDict.setdskData.id,datae;else{this.templateDict.setdskData.id,datae;this.templateArray.pushddatae;}}}cc初始化共用cdpublicInitCDSourcede{lettemplateArray=this.templateDict.valuesde;fordlettemplateoftemplateArraye{template.InitCDSourcedthis.templateDicte;}templateArray=this.pSkillTemplateDict.valuesde;fordlettemplateoftemplateArraye{template.InitCDSourcedthis.templateDicte;}}publicInitSkillTriggerde{lettemplateArray=this.pSkillTemplateDict.valuesde;fordlettemplateoftemplateArraye{letheroData=aHeroDataComponentbthis.entity.GetCompdComponentType.HeroDataComponente;template.InitTriggerdheroData,this.TriggerPSkill,thise;}}publicDisposeSkillTriggerde{lettemplateArray=this.pSkillTemplateDict.valuesde;fordlettemplateoftemplateArraye{letheroData=aHeroDataComponentbthis.entity.GetCompdComponentType.HeroDataComponente;template.DisposeTriggerdheroDatae;}}privateTriggerPSkilldargs:anyecc触发被动技能{letid=args[0];letlv=args[1];letentity=this.entity;lettemplate=this.pSkillTemplateDict.getdide;letstateComp=aStateComponentbentity.GetCompdComponentType.StateComponente;cc灵魂状态d死亡触发的技能立刻触发eifdstateComp!=null&&stateComp.GetStatedMathConst.SoulMagicIDe!=nulle{this.UseSkilldtemplatee;return;}fordletnspofthis.nextSkillTemplateArraye{ifdnsp.id==template.idecc被动技能已经在触发列表里面了不再触发第二次return;}this.nextSkillTemplateArray.pushdtemplatee;ccTODONIU有些技能不需要有目标进入攻击距离就要释放}cc从被动技能池触发被动如果没有需要lockhero的技能，返回false否则返回truepublicCheckUsePSkillde:boolean{letisLockHero:boolean=false;letnewArray:SkillDataTemplate[]=[];fordlettemplateofthis.nextSkillTemplateArraye{ifdtemplate.isLockHero&&isLockHeroecc同时只能有一个锁定英雄的技能{newArray.pushdtemplatee;continue;}letskObj=this.UseSkilldtemplatee;ifdtemplate.isLockHeroe{isLockHero=true;skObj.Updatede;cc立刻执行第一帧保证AI锁定}}this.nextSkillTemplateArray=newArray;returnisLockHero;}publicUseSkilldtemplate:SkillDataTemplatee:HeroSkillData{letentity=this.entity;letskillObj=aHeroSkillDatabWarFactory.CreateSkillObjectdtemplate,ObjectType.HeroSkillDatae;skillObj.Initdtemplate,entitye;template.ResetdskillObj.attackSpeedUpe;this.skillArray.pushdskillObje;returnskillObj;}publicUpdateCDddeltaTime:numbere{fordlettemplateofthis.templateArraye{template.UpdateCDddeltaTimee;}letvalues=this.pSkillTemplateDict.valuesde;fordletvalueofvaluese{value.UpdateCDddeltaTimee;}}cc检查是否有技能可用publicGetValidSkilldskillType:number,index:number=0e:SkillDataTemplate{letentity=this.entity;letresult:number;letarray:SkillDataTemplate[]=[];fordlet_templateofthis.templateArraye{ifd_template.skillType==skillTypee{array.pushd_templatee;}}ifdarray.length==0ereturnnull;lettemplate:SkillDataTemplate=null;ifdindexb=0&&indexaarray.lengthetemplate=array[index];elsetemplate=array[0];result=template.IsSkillValiddentitye;ifdresult==SkillFailType.Noneereturntemplate;returnnull;}publicGetValidSkill2did:numbere:SkillDataTemplate{letentity=this.entity;letresult:number;lettemplate:SkillDataTemplate=null;fordlet_templateofthis.templateArraye{ifd_template.id==ide{template=_template;}}letvalues=this.pSkillTemplateDict.valuesde;fordlet_templateofvaluese{ifd_template.id==ide{template=_template;}}ifdtemplate==nullereturnnull;result=template.IsSkillValiddentitye;ifdresult==SkillFailType.Noneereturntemplate;returnnull;}ccpublicUseSkilldid:numberecc{ccletentity=this.entity;ccletskillObj=aHeroSkillDatabWarFactory.CreateSkillObjectdtemplate,ObjectType.HeroSkillDatae;ccskillObj.Initdtemplate,entitye;cctemplate.Resetde;ccthis.skillArray.pushdskillObje;ccreturnskillObj;cc}cc只能删除已经锁定英雄AI的技能cc如果某个技能已经不再英雄英雄AI那么这个技能无法终止publicStopAllSkilldframe:numbere{this.stopSkillFrame=frame;ifdthis.world.frameCountb=frameethis.StopAllSkillImmde;}privateStopAllSkillImmde{this.stopSkillFrame=99999;fordletskillObjofthis.skillArraye{ifdskillObj.IsLockHeroAIdee{skillObj.BreakSkillde;}}}publicPauseSkilldisPause:booleane{fordletskillObjofthis.skillArraye{skillObj.PauseSkilldisPausee}}publicIsLockHeroAIde:boolean{fordletskillofthis.skillArraye{ifdskill.IsLockHeroAIdeereturntrue;}returnfalse;}cc是否有技能在使用中d后摇也算epublicIsUseSkillde:boolean{returnthis.skillArray.lengthb0;}publicGetAISkillTemplatede:SkillDataTemplate{returnthis.templateArray[0];}ccai索敌只找最近的publicGetAITargetdentity:LogicEntitye:number{ifdthis.templateArray.length==0ereturn0;returnthis.templateArray[0].GetAITargetdentitye;}publicGetAttackDisde:number{ifdthis.templateArray.length==0ereturn0;returnthis.templateArray[0].atkDis;}publicGetWarnDisde:number{ifdthis.templateArray.length==0ereturn0;returnthis.templateArray[0].warnDis;}publicUpdateSkilltimeddeltaTime:numbere{this.UpdateCDddeltaTimee;letdelArray:HeroSkillData[]=[];letleftArray:HeroSkillData[]=[];fordletskillObjofthis.skillArraye{ifdskillObj.IsSkillEnddee{delArray.pushdskillObje;}else{leftArray.pushdskillObje;}}fordletskillObjofdelArraye{WarFactory.DestroyObjectdskillObj,ObjectType.HeroSkillData,nulle;}delArray.length=0;this.skillArray.length=0;this.skillArray=leftArray;}publicUpdateLogicde{ifdthis.world.frameCountb=this.stopSkillFramee{this.StopAllSkillImmde;}fordletskillObjofthis.skillArraye{skillObj.Updatede;}}}}﻿cccareferencepath="..cECScLogicComponent.ts"cbmoduleECS{exportclassSpellDataTemplate{publicid:number;cc法术idpublictemplate:SkillDataTemplate;publicstartpos:number;publiclifeTime:number;publicconstructordspellData:game.SpellDataItem,skData:game.SkillDataItem,world:WorldBaseaEntityBasebe{this.id=spellData.id;this.template=newSkillDataTemplatedskData,worlde;this.template.skillType=skData.skillType;this.startpos=spellData.startPos;this.lifeTime=spellData.lifeTime;}publicDisposede{ifdthis.template!=nulle{this.template.Disposede;this.template=null;}}}exportclassSpellComponentextendsLogicComponent{publicskillArray:SpellSkillData[];privatetemplateDict:SMapanumber,SpellDataTemplateb;privatetemplateArray:ArrayaSpellDataTemplateb;publicdeloyEndFrame:number;publicconstructorde{superde;}publicGetDatade:any{letself=this;letdataArray:any[]=[self.deloyEndFrame];letdata:number[];fordletskobjofself.skillArraye{dataArray.pushdskobj.GetDatadee;}returndataArray;}publicInitde{super.Initde;this.templateDict=newSMapanumber,SpellDataTemplatebde;this.templateArray=newArrayaSpellDataTemplatebde;this.skillArray=newArrayaSpellSkillDatabde;}cc判断是否可以删除publicCanDisposede{returntrue;}publicDisposede{fordletvalueofthis.templateArraye{value.Disposede;}this.templateArray.length=0this.templateDict.clearde;fordletskillObjofthis.skillArraye{WarFactory.DestroyObjectdskillObj,ObjectType.SpellSkillData,nulle;}this.skillArray.length=0;super.Disposede;}publicAddSpellTemplatedspellData:game.SpellDataItemecc技能模板{ifdspellData.normalSkillIdArray.length==0ereturn;letskillId=spellData.normalSkillIdArray[0];ifd!this.templateDict.hasdspellData.idee{letskData=spellData.GetSkilldskillIdeletdata=newSpellDataTemplatedspellData,skData,this.worlde;this.templateDict.setdspellData.id,datae;this.templateArray=this.templateDict.valuesde;}}publicGetSkillDataTemplatedspellId:numbere:SkillDataTemplate{ifd!this.templateDict.hasdspellIdeereturnnull;returnthis.templateDict.getdspellIde.template;}cc部署时间是否结束publicIsDeloyEndde{returnthis.world.frameCountb=this.deloyEndFrame;}publicUseSpelldid:number,campType:number,atkType:number,x:number,y:numbere:SpellSkillData{ifd!this.templateDict.hasdideereturnnull;letentity=this.entity;letworldObj=this.world;lettemplate=this.templateDict.getdide;letskillTemplate=template.template;letskillObj=aSpellSkillDatabWarFactory.CreateSkillObjectdskillTemplate,ObjectType.SpellSkillDatae;skillObj.InitdskillTemplate,entitye;ifdtemplate.lifeTime==0ecc没有存活时间限制skillObj.endFrame=worldObj.frameCount+100000;elseskillObj.endFrame=worldObj.frameCount+Math.floordtemplate.lifeTimecMathConst.KeyFrameTimee;ifdtemplate.startpos==0ecc0：从当前触摸位置开始释放{skillObj.SetSkillPosdx,y,0,0e;}elsecc1：从国王塔位置开始释放{letspos;ifdatkType==AtkType.Attackespos=MathConst.AttackTowerPos[1];elsespos=MathConst.DefendTowerPos[1];skillObj.SetSkillPosdspos[0],spos[1],x,ye;}skillObj.StartMagicde;this.skillArray.pushdskillObje;ccletplayerComp=aRealPlayerComponentbentity.GetCompdComponentType.RealPlayerComponente;ccletcomps=newSMapanumber,LogicComponentbde;ccccTransformComponentccletcomp1:TransformComponent=aTransformComponentbWarFactory.CreateComponentdComponentType.TransformComponent,worldObje;cccomp1.Initde;cccomp1.parentID=playerComp.sceneID;cccomp1.id=id;cccomp1.hasCollide=false;cccomps.setdComponentType.TransformComponent,comp1e;ccccDrawComponentccletcomp3:DrawComponent=aDrawComponentbWarFactory.CreateComponentdComponentType.DrawComponent,worldObje;cccomp3.classType=ObjectType.HeroBase;cccomp3.clipName=`hero_${id}`;cccomp3.shapeID=id;cccomp3.Initde;cccomps.setdComponentType.DrawComponent,comp3e;ccletcreateEntity=worldObj.CreateEntitydid,compse;cccreateEntity.pid=this.id;cc设置英雄属于哪个玩家阵营returnskillObj;}privateCheckSpellEndde{}publicUpdateSkilltimeddeltaTime:numbere{letdelArray:SpellSkillData[]=[];letleftArray:SpellSkillData[]=[];fordletskillObjofthis.skillArraye{ifdskillObj.IsSkillEnddee{delArray.pushdskillObje;}else{leftArray.pushdskillObje;}}fordletskillObjofdelArraye{WarFactory.DestroyObjectdskillObj,ObjectType.SpellSkillData,nulle;}delArray.length=0;this.skillArray.length=0;this.skillArray=leftArray;}publicUpdateLogicde{fordletskillObjofthis.skillArraye{skillObj.Updatede;}}}}﻿cccareferencepath="..cECScLogicComponent.ts"cbmoduleECS{exportclassStateComponentextendsLogicComponent{publicstateArray:StateDataBase[];publicstateDict:SMapanumber,StateDataBaseb;publicconstructorde{superde;this.stateArray=newArrayaStateDataBasebde;this.stateDict=newSMapanumber,StateDataBasebde;}publicInitde{super.Initde;}publicGetDatade:any{letself=this;letdataArray:any[]=[];fordletstateObjofself.stateArrayedataArray.pushdstateObj.GetDatadee;returndataArray;}cc判断是否可以删除publicCanDisposede{returntrue;}publicDisposeAllStatede{fordletstateObjofthis.stateArrayestateObj.Disposede;this.stateArray.length=0;this.stateDict.clearde;}publicDisposede{this.DisposeAllStatede;super.Disposede;}publicAddStatedid:number,fromID:number,args:anye:StateDataBase{letheroData:HeroDataComponent=aHeroDataComponentbthis.entity.GetCompdComponentType.HeroDataComponente;ifdheroData.hpa=0ecc已经死亡returnnull;ifd!this.stateDict.hasdidee{letstateObj=newStateDataBasedide;stateObj.fromID=fromID;stateObj.world=this.world;stateObj.heroDataComp=heroData;stateObj.entity=this.entity;stateObj.InitArgsdargse;stateObj.AddKeyIdde;cc添加新的keyIdthis.stateDict.setdid,stateObje;this.stateArray=this.stateDict.valuesde;stateObj.Initde;returnstateObj;}else{letstateObj=this.stateDict.getdide;stateObj.InitArgsdargse;ifdstateObj.layerCountastateObj.maxLayerCountecc可叠加buff{stateObj.DelBuffde;cc层数叠加先还原人物属性stateObj.layerCount+=1;stateObj.Resetde;stateObj.DoBuffde;cc再重新计算buff属性}elsecc不可叠加buff{stateObj.ResetTimede;cc重置时间stateObj.AddKeyIdde;cc添加新的keyId添加引用}returnstateObj;}}publicGetStatedid:numbere:StateDataBase{returnthis.stateDict.getdide;}publicRemoveStatedid:number,count:numbere{ifd!this.stateDict.hasdideereturn;letstateObj=this.stateDict.getdide;ifd!stateObj.RemoveKeyIddcounteethis.RemoveStateByObjdstateObje;}publicRemoveStateByObjdstateObj:StateDataBasee{ifdthis.stateDict.hasdstateObj.idee{this.stateDict.deletedstateObj.ide;this.stateArray=this.stateDict.valuesde;stateObj.Disposede;}}publicSaveDatadecc记录当前时刻的数据{fordletstateObjofthis.stateArrayestateObj.SaveDatade;}publicLoadDatadecc恢复记录数据{fordletstateObjofthis.stateArrayestateObj.LoadDatade;}cc护盾减免伤害cc返回true表示伤害被护盾完全挡住了publicProtectModifydobj:anye:boolean{fordletstateObjofthis.stateArraye{ifdstateObj.ProtectModifydobjee{returntrue;}}returnfalse;}publicUpdatede{letdelObjArray:StateDataBase[]=newArrayaStateDataBasebde;fordletstateObjofthis.stateArraye{stateObj.Updatede;ifdstateObj.IsEnddee{stateObj.RemoveKeyIdd100e;ccbuff时间结束直接全部移除delObjArray.pushdstateObje;}}fordletstateObjofdelObjArraye{this.RemoveStateByObjdstateObje;}delObjArray.length=0;}cc特殊效果cc}}﻿cccareferencepath="..cECScLogicComponent.ts"cbmoduleECS{exportclassTheirComponentextendsLogicComponent{publicconstructorde{superde;}publicGetDatade:any{cc不需要记录帧数据}cc判断是否可以删除publicCanDisposede{returntrue;}}}﻿cccareferencepath="..cECScLogicComponent.ts"cbmoduleECS{exportclassTowerComponentextendsLogicComponent{cc101112分别为攻方上中下塔cc202122分别为守方上中下塔publictowerPos:number;publictowerNodeArray:NodePoint[];cc防御塔挂在的节点publicatkType:number;publicshape:number;publicconstructorde{superde;this.towerNodeArray=[];}publicGetDatade:any{letself=this;letdataArray:any[]=[self.towerPos,self.atkType,self.shape,];letnodePosArray:any[]=[];fordletnodeofself.towerNodeArraye{nodePosArray.pushd[node.x,node.y]e;}dataArray.pushdnodePosArraye;returndataArray;}publicInitde{super.Initde;this.world.warContainer.MakeTowerCollidedthise;}publicDisposede{this.ReleaseCollidede;this.towerNodeArray=[];super.Disposede;}cc判断是否可以删除publicCanDisposede{returntrue;}publicReleaseCollidede{letcontainerObj=this.world.warContainer;ifdthis.towerNodeArray!=nulle{fordletnodeofthis.towerNodeArraye{ifdnode.removeHerodthis.idee{containerObj.RefreshGridColordnode.x,node.ye;}}this.towerNodeArray=[];}containerObj.RelaseTowerCollidedthise;}}}﻿cccareferencepath="..cECScLogicComponent.ts"cbmoduleECS{exportclassTransformComponentextendsLogicComponent{private_parentID:number;publicnodeX:number;cc列publicnodeY:number;cc行private_pos:Vector2;private_dir:Vector2;publicscale:number;cc半径publicrange:number;publicmoveSpeedBase:number=0;publicfitMoveSpeed:number=0;cc匹配人物动作的移动速度d用于加速epublicmoveSpeedAdd:number=0;cc移速加成d百分比epublicmoveSpeedDirAdd:Vector2;publicgetmoveSpeedde{letspeedAdd=this.moveSpeedAddc100+1;ifdspeedAdda0espeedAdd=0;returnMath.floordspeedAdd*this.moveSpeedBasee;}cc有了buff加成后的真实移动速度publicrealMoveSpeed:number=0;publicrealMoveDir:Vector2;publiclandType:number;cc寻路路径点private_realTargetPos:Vector2;cc真正的目标点private_targetPos:Vector2;cc8方向站位点publicforceTargetPos:Vector2;cc强制移动的目标点privatepath:NodePoint[];cc原始路径（）privatemovePath:NodePoint[];cc移动路径（弗洛伊德平滑后的路径）publichasCollide:boolean=true;cc本身是否会产生碰撞publicputOnCollide:boolean=true;cc是否可以越过其他阻挡publiccollideType:number[]=[];cc阻挡类型publicmindis:number;publicmoveable:boolean;cc是否可以移动publicnode:NodePoint;cc挂载导航节点cc索敌范围中心点位置如果索敌范围为全屏则此值为空（只适用于国王塔）publicsearchCenterPos:Vector2;publicsearchRadius:number;cc记录移动的距离publictotalMoveDis:number=0;publicconstructorde{superde;this._pos=newVector2de;this._dir=newVector2de;this.moveSpeedAdd=0;this.moveSpeedDirAdd=newVector2d[0,0]e;this.realMoveDir=newVector2d[0,0]e;this._realTargetPos=newVector2de;this._targetPos=newVector2de;this.hasCollide=true;this.moveable=false;this.node=null;this.searchCenterPos=null;this.range=0;}publicGetDatade:any{letself=this;letdataArray:any[]=[self.nodeX,self.nodeY,self.range,self.landType,self.totalMoveDis,Math.floordself.pos.x*100000e,Math.floordself.pos.y*100000e,Math.floordself.dir.x*100000e,Math.floordself.dir.y*100000e,Math.floordself.scale*100000e,Math.floordself.moveSpeedBasee,Math.floordself.fitMoveSpeede,Math.floordself.moveSpeedAdde,Math.floordself.moveSpeedDirAdd.x*100000e,Math.floordself.moveSpeedDirAdd.y*100000e,Math.floordself.realMoveSpeed*100000e,Math.floordself.realMoveDir.x*100000e,Math.floordself.realMoveDir.y*100000e,Math.floordself._realTargetPos.x*100000e,Math.floordself._realTargetPos.y*100000e,Math.floordself._targetPos.x*100000e,Math.floordself._targetPos.y*100000e,Math.floordself.mindis*100000e,Numberdself.hasCollidee,Numberdself.moveablee];letpath=self.path;ifdpath==nullepath=[];letposArray:any[]=[];fordletnodeofpathe{posArray.pushd[node.x,node.y]e;}dataArray.pushdposArraye;returndataArray;}cc判断是否可以删除publicCanDisposede{returntrue;}publicDisposede{this.path=null;this.world.warContainer.UnlockHerodthis.id,this.landTypee;this.ReleaseCollidede;super.Disposede;}publicReleaseCollidede{ifdthis.node!=nulle{ifdthis.node.removeHerodthis.idee{this.world.warContainer.RefreshGridColordthis.node.x,this.node.ye;}this.node=null;}}publicsetparentIDdid:numbere{this._parentID=id;}publicgetparentIDde{returnthis._parentID;}ccpublicsetposdp:Vector2ecc不让直接写pos属性cc{ccthis._pos=p;cc}publicgetposde{returnthis._pos;}publicsetdirdp:Vector2e{this._dir.x=p.x;this._dir.y=p.y;}publicgetdirde{returnthis._dir;}publicSetPathdpath:NodePoint[],sx:number,sy:number,ex:number,ey:numbere{this.path=path;ifd!this.hasCollide&&this.putOnCollideecc自身产生碰撞且可以越过其他阻挡上面直接走过去不寻路也不做平滑处理{return;}ifdpath!=nulle{cc在路径中去掉startNode开始节点，避免玩家对象走回头路ifdthis.hasCollidee{lettargetX=excMathConst.MapCellSize-0.5;lettargetY=eycMathConst.MapCellSize-0.5;targetX=game.Utils.toFixedNumberdtargetXe;targetY=game.Utils.toFixedNumberdtargetYe;letnewNode=newNodePointdtargetX,targetY,nulle;letlastNode=path[path.length-1];letnodeX=Math.floordexcMathConst.MapCellSizee;letnodeY=Math.floordeycMathConst.MapCellSizee;ifdnodeX==lastNode.x&&nodeY==lastNode.yecc如果目标点和路径的终点在一个格子上用目标点格子替换最后一个格子{path[path.length-1]=newNode;}else{ifdnewNode.x!=lastNode.x||newNode.y!=lastNode.yepath.pushdnewNodee;}ifdthis.path.lengthb1ethis.path.shiftde;}elsethis.path=this.world.warContainer.FloydPathdpath,this.landType,sx,sy,ex,eye;ccletstr="";ccletcellSize=MathConst.MapCellSize;ccfordletnodeofthis.pathecc{ccstr+=`[x:${node.x*cellSize+cellSizec2},y:${node.y*cellSize+cellSizec2}]`;cc}ccifdthis.id==1023ecc{ccthread.logdthis.id,this.pos.tostringde,"-----------SetPath--------bbbbbbbbbbbbbbbbbbbbbbb",stre;cc}ccifdthis.id==1015||this.id==1019||this.id==1033ecc{ccthread.logdthis.id,"-----------SetPath-------bbbbbbbbbbbbbbbbbbbbbbb",stre;cc}}ccelseccthis.movePath=null;}cc移除一个节点path和movePath要分开处理publicRemoveFirstNodede{this.path.shiftde;ccthis.movePath.shiftde;ccifdthis.movePath.length==0ecc{ccthis.path.length=0;ccreturn;cc}ccletfirstNode=this.movePath[0];ccletdelCount=0;ccfordletnodeofthis.pathecc{ccifdnode.x==firstNode.x&&node.y==firstNode.yeccbreak;ccdelCount++;cc}ccthis.path.spliced0,delCounte;}publicGetPathde:NodePoint[]{ccreturnthis.movePath;returnthis.path;}ccpublicsettargetPosdp:Vector2ecc{ccthis._targetPos=newVector2d[p.x,p.y]e;cc}cc找最近的八方向站位点publicGetNearestTargetPosdpos:Vector2,attackDis:numbere:Vector2{letcellSize=MathConst.MapCellSize;letx=pos.x;lety=pos.y;letx1:number;lety1:number;letx2:number;lety2:number;letdis:number=0;letmindis:number=9999999;letvalidPos:Vector2=newVector2d[0,0]e;letcontainerObj=this.world.warContainer;letlockedPos=containerObj.UnlockHerodthis.id,this.landTypee;letisChangeNode=false;ifdthis.node!=nullecc先临时撤掉自己的阻挡d防止找八方向站位的时候被自己卡住e{isChangeNode=this.node.removeHerodthis.ide;}letpointArray=MathConst.GetAttackPointArraydattackDise;fordletptofpointArrayecc八方向站位{x1=x+pt[0]*attackDis;y1=y+pt[1]*attackDis;x2=Math.floordx1ccellSizee;y2=Math.floordy1ccellSizee;ifd!containerObj.GetWalkabledx2,y2,this.landTypeeecc该位置是阻挡区域d被自己阻挡的不算e{ccifdthis.id==1016&&pos.x==485&&pos.y==225ecc{ccthread.logd"-------1016-b1015---bbbbb1111-----",pt.toStringdee;cc}continue;}ifdcontainerObj.IsPosLockeddx2,y2,this.landTypeeecc该位置已经被锁定{ccifdthis.id==1016&&pos.x==485&&pos.y==225ecc{ccthread.logd"-------1016-b1015---bbbbb2222-----",pt.toStringde,x2,y2e;cc}continue;}dis=dthis._pos.x-x1e*dthis._pos.x-x1e+dthis._pos.y-y1e*dthis._pos.y-y1e;ccifdthis.id==1016&&pos.x==485&&pos.y==225ecc{ccthread.logd"-------1016-b1015---bbbbb3333-----",pt.toStringde,Math.sqrtddise,mindise;cc}ifddisamindise{mindis=dis;validPos.x=x1;validPos.y=y1;}}ifdisChangeNode&&this.node!=nullecc恢复阻挡{this.node.addHerodthis.ide;}ifdlockedPosb=0ecc恢复站位锁定{letlockX=Math.floordlockedPoscMathConst.GridCountYe;letlockY=lockedPos%MathConst.GridCountY;containerObj.TryLockPosdlockX,lockY,this.id,this.landTypee;}ifd!validPos.equalsdVector2.zero,0ee{returnvalidPos;}else{returnnull;}}publicSetTargetPosdtargetPos:Vector2,realTargetPos:Vector2,attackDis:numbere{this._realTargetPos=realTargetPos.copydthis._realTargetPose;cc死亡时切换目标时移动的时候都要重新解锁目标位置但是当目标位置没有发生变化时可以考虑不解锁letcontainerObj=this.world.warContainer;containerObj.UnlockHerodthis.id,this.landTypee;ifdattackDis==0||this.moveSpeed==0||!this.moveableecc直接走到脸上d比如可移动范围圈等e{this.FindPathdrealTargetPose;return;}letpath=this.FindPathdtargetPose;ccifddthis.id==1080||this.id==1062e&&this.path!=nullecc{ccletstr="";ccfordletnodeofthis.pathecc{ccletkeys=node.heroInfo.keysde;ccccifdkeys!=null&&keys.lengthb0eccccstr+=`[x:${node.x.toFixedd1e},y:${node.y.toFixedd1e},heroInfo:${keys[0]}]`;ccstr+=`[x:${node.x.toFixedd1e},y:${node.y.toFixedd1e}]`;cc}ccthread.logdthis.id,this.world.frameCount,"----------------寻路bbbbbbbbbbbbbbbbbbbbbbbthis.node:",this.node.x,this.node.y,"path:",stre;cc}ifdpath!=null&&path.lengthb0ecc八方向站位可以行走过去{this._targetPos=targetPos.copydthis._targetPose;letcellSize=MathConst.MapCellSize;letx=Math.floordtargetPos.xccellSizee;lety=Math.floordtargetPos.yccellSizee;ccifdx==19&&y==7ecc{ccthread.logd"------TryLockPos19,7------------",this.id,newErrorde.stacke;cc}containerObj.TryLockPosdx,y,this.id,this.landTypee;}elsecc找不到可行走路径就不锁定位置并且往前行走{ifd!targetPos.equalsdthis._poseethis.MoveForwardde;else{cc已经走到目标位置了}}}publicgettargetPosde{returnthis._targetPos;}publicSetTransPosdx:number,y:number,isHero:boolean=falsee{ccifdthis.id==1217ecc{ccthread.logd"-------1217----SetPos--bbbbbbbbbbbbbbbbbbbbbb",x,y,dnewErrordee.stacke;cc}ifd!game.Utils.isFixedNumberdxe||!game.Utils.isFixedNumberdyee{thread.warnd"TransformComponentSetTransPosfixederror:",x,ye;}this.pos.x=x;this.pos.y=y;letcellSize=MathConst.MapCellSize;this.nodeX=Math.floordxccellSizee;this.nodeY=Math.floordyccellSizee;this.ReleaseCollidede;lethasHeroData=dthis.entity!=null&&this.entity.GetCompdComponentType.HeroDataComponente!=nulle;cc判断是否是英雄ifddisHero||hasHeroDataee{letnode=this.world.warContainer.GetNodedx,y,this.landTypee;ifdthis.hasCollideecc本身产生阻挡{this.node=node;ccletframeCount=this.world.frameCount;ccifddthis.id==1085||this.id==1448e&&this.path!=nullecc{ccletstr="";ccfordletnodeofthis.pathecc{ccletkeys=node.heroInfo.keysde;ccccifdkeys!=null&&keys.lengthb0eccccstr+=`[x:${node.x.toFixedd1e},y:${node.y.toFixedd1e},heroInfo:${keys[0]}]`;ccstr+=`[x:${node.x.toFixedd1e},y:${node.y.toFixedd1e}]`;cc}ccthread.logdthis.id,frameCount,"-------setpos---------bbbbbbbbbbbbbbbbbbbbbbbnode:",node.x,node.y,"path:",stre;cc}ifdnode==null||!node.walkablee{ifdnode==nullethread.errordthis.id,"hasCollide:bugnodeisnull！！！！！！！！！！！！",x.toFixedd2e,y.toFixedd2e,this.world.frameCounte;elsethread.errordthis.id,"hasCollide:bug！！！！！！！！！！！！",x.toFixedd2e,y.toFixedd2e,node.walkable,node.heroInfo.keysde[0],this.world.frameCounte;}ifdnode!=null&&node.addHerodthis.idee{this.world.warContainer.RefreshGridColordnode.x,node.ye;}}elsecc没有阻挡{ccifdnode==null||!node.walkableeifdnode==null||!node.canPutOnNodedthiseecc该单位不能放置在该格子上面{ifdnode==nullethread.errordthis.id,"hasNoCollide:bugnodeisnull！！！！！！！！！！！！",x.toFixedd2e,y.toFixedd2e,this.world.frameCounte;elsethread.errordthis.id,"hasNoCollide:bug！！！！！！！！！！！！",x.toFixedd2e,y.toFixedd2e,node.walkable,node.heroInfo.keysde[0],this.world.frameCounte;}}}ccifdthis.id==1015||this.id==1016||this.id==1017ecc{ccthread.logdthis.world.frameCount,this.id,"----------setpos-----------bbbbbbbbbbbb",this.pos.tostringdee;cc}}ccpublicSetBlowFlydblowFlyType:number,destPos:Vector2,time:numberecc{ccthis._blowFlyType=blowFlyType;ccifdblowFlyTypeb0ecc开始击飞cc{ccthis._pos.copydthis._blowFlyStartPose;ccdestPos.copydthis._pose;ccthis.SetPathdnulle;ccSNetWar.FireEventdGlobalEventType.BlowFlyRender,this.entity.id,this._blowFlyStartPos,blowFlyType,timee;cc}ccelsecc停止击飞cc{ccSNetWar.FireEventdGlobalEventType.BlowFlyRender,this.entity.id,this._blowFlyStartPos,blowFlyType,timee;cc}cc}publicblowFly_Actid:number=0;privateblowFly_StartSpeed:number;privateblowFly_AccSpeed:number;privateblowFly_MoveDir:number;privateblowFly_CenterPos:Vector2=newVector2de;privateblowFly_StartPos:Vector2=newVector2de;privateblowFly_StartFrame:number;privateblowFly_EndFrame:number;cctime：单位毫秒publicSetBlowFlydactid:number,startSpeed:number,accSpeed:number,centerPos:Vector2,moveDir:number,time:numbere{this.blowFly_Actid=actid;this.blowFly_StartSpeed=startSpeed;this.blowFly_AccSpeed=accSpeed;centerPos.copydthis.blowFly_CenterPose;this._pos.copydthis.blowFly_StartPose;this.blowFly_MoveDir=moveDir;this.blowFly_StartFrame=this.world.frameCount;ifdstartSpeedb0&&accSpeeda0eccbuff时间到了或者速度减小到0都会停止time=Math.mindtime,-startSpeedcaccSpeed*1000e;letmoveFrame=Math.floordtimecMathConst.KeyFrameTimee;time=moveFrame*MathConst.KeyFrameTime;this.blowFly_EndFrame=this.world.frameCount+moveFrame;ccthis.hasCollide=false;ccthis.ReleaseCollidede;letdir:Vector2;cc击飞方向ifdthis.blowFly_MoveDir==2ecc远离中心方向{dir=Vector2.directiondthis._pos,this.blowFly_CenterPose;}elsecc指向中心方向{dir=Vector2.directiondthis.blowFly_CenterPos,this._pose;}ifddir.x==0&&dir.y==0edir.x=1;SNetWar.FireEventdGlobalEventType.BlowFlyRender,this.entity.id,actid,startSpeed,accSpeed,dir,timee;}publicStopBlowFlydactid:numbere{ifdthis.blowFly_Actid==actide{this.blowFly_Actid=0;SNetWar.FireEventdGlobalEventType.BlowFlyRender,this.entity.id,0,0,0,Vector2.zeroe;}}publicUpdateBlowFlyddt:numbere{ifdthis.blowFly_Actid==0ereturn;letpassTime=dthis.world.frameCount-this.blowFly_StartFrameec10;ifdthis.world.frameCountbthis.blowFly_EndFrameereturn;ccx=0.5*a*t*t+v0*tletmoveDis=0.5*this.blowFly_AccSpeed*passTime*passTime+this.blowFly_StartSpeed*passTime;letdir:Vector2;ifdthis.blowFly_MoveDir==2ecc远离中心方向{dir=Vector2.directiondthis._pos,this.blowFly_CenterPose;}elsecc指向中心方向{dir=Vector2.directiondthis.blowFly_CenterPos,this._pose;}ifddir.x==0&&dir.y==0edir.x=1;letdestPos=Vector2.sumdthis.blowFly_StartPos,dir.scaledmoveDisee;cc限制目标点别出界了destPos=LogicWarUtil.ClampTargetPosdthis.blowFly_StartPos,destPose;destPos=destPos.toFixedde;ccthread.logd"------UpdateBlowFly-------",passTime,moveDis,"----------",destPos.tostringdee;this.SetTransPosddestPos.x,destPos.y,falsee;this.SetPathdnull,0,0,0,0e;}publicIsPathValidde:boolean{ifdthis.path==null||this.path.length==0ecc||this.movePath==nullcc||this.movePath.length==0ereturnfalse;letret=true;fordletnodeofthis.pathe{ifd!node.walkable&&!node.hasOnlyHerodthis.ideecc{ret=false;break;}}ccifdthis.id==1023&&this.world.frameCount==55ecc{ccthread.logd"--1023.IsPathValid------bbbbbbbbb",this.world.frameCount,ret,this.path.lengthe;cc}returnret;}cc回到原始位置d针对固定建筑和国王塔epublicGoBackHomede{ifdthis.searchCenterPos==nulle{thread.warnd"thiskingsearchCenterPosisnull!!!!",this.id,this.landTypee;return;}this.SetTargetPosdthis.searchCenterPos,this.searchCenterPos,0e;}cc移动到指定位置publicMoveToPosdx:number,y:numbere{letheroData=aHeroDataComponentbthis.entity.GetCompdComponentType.HeroDataComponente;ifdheroData==nulle{this.SetPathdnull,0,0,0,0e;returnnull;}ifdLogicWarUtil.IsTowerdheroData.shapeeecc防御塔剔除掉returnnull;lettargetPos=newVector2d[x,y]e;this.SetTargetPosdtargetPos,targetPos,0e;}cc向前移动publicMoveForwardde:NodePoint[]{letheroData=aHeroDataComponentbthis.entity.GetCompdComponentType.HeroDataComponente;ifdheroData==nulle{this.SetPathdnull,0,0,0,0e;returnnull;}ifdLogicWarUtil.IsTowerdheroData.shapeeecc防御塔剔除掉returnnull;ccthread.logd"______MoveForward_____________",this.ide;letcontainerObj=this.world.warContainer;this.SetTargetPosdthis._pos,this._pos,0e;cc这里是为什么????????????letcellSize=MathConst.MapCellSize;letx=Math.floordthis._pos.xccellSizee;lety=Math.floordthis._pos.yccellSizee;letindex=0;letxIndex:number=-1;letyIndex:number=0;ifdheroData.atkType==AtkType.Attackecc攻击方在左侧向前走的话就是x++{cc往距离自己最近路径终点走xIndex=MathConst.GridCountX-1;letroad1Mid=dMathConst.Road1StartY+MathConst.Road1EndYec2;letroad2Mid=dMathConst.Road2StartY+MathConst.Road2EndYec2;letmidY=dMathConst.Road1EndY+MathConst.Road2StartYec2;ifdya=road1MideyIndex=MathConst.Road1StartY;elseifdya=midYeyIndex=MathConst.Road1EndY;elseifdya=road2MideyIndex=MathConst.Road2StartY;elseyIndex=MathConst.Road2EndY;ccfordleti=1;ia=5;i++ecc{ccifdcontainerObj.GetWalkabledx+i,y,this.landTypeeeccindex=i;ccelseccbreak;cc}}elsecc防守方在右侧向前走的话就是x--{cc往距离自己最近路径终点走xIndex=0;letroad1Mid=dMathConst.Road1StartY+MathConst.Road1EndYec2;letroad2Mid=dMathConst.Road2StartY+MathConst.Road2EndYec2;letmidY=dMathConst.Road1EndY+MathConst.Road2StartYec2;ifdya=road1MideyIndex=MathConst.Road1StartY;elseifdya=midYeyIndex=MathConst.Road1EndY;elseifdya=road2MideyIndex=MathConst.Road2StartY;elseyIndex=MathConst.Road2EndY;}ifdxIndex!=-1e{x=xIndex*cellSize+cellSizec2;y=yIndex*cellSize+cellSizec2;lettargetPos=newVector2d[x,y]e;this.SetTargetPosdtargetPos,targetPos,0e;}else{this.SetPathdnull,0,0,0,0e;}returnthis.path;}cc寻路publicFindPathdtargetPos:Vector2e:NodePoint[]{ifdtargetPos.equalsdthis._poseecc目标位置就是当前自己的位置（8方向站位导致的）{this.SetPathdnull,0,0,0,0e;returnnull;}ifd!this.hasCollide&&this.putOnCollideecc自身产生碰撞且可以越过其他阻挡上面直接走过去不寻路{lettargetX=targetPos.xcMathConst.MapCellSize-0.5;lettargetY=targetPos.ycMathConst.MapCellSize-0.5;targetX=game.Utils.toFixedNumberdtargetXe;targetY=game.Utils.toFixedNumberdtargetYe;letendNode:NodePoint=newNodePointdtargetX,targetY,nulle;this.SetPathd[endNode],this._pos.x,this._pos.y,targetPos.x,targetPos.ye;returnthis.path;}letcontainerObj=this.world.warContainer;ifdtargetPos.equalsdthis._targetPosee{ifd!this.IsPathValiddee{letpath:NodePoint[];containerObj.SetStartEndPosdthis.pos.x,this.pos.y,targetPos.x,targetPos.y,this.landTypee;ifdthis.node!=null&&this.node.hasHerodthis.idee{this.node.removeHerodthis.ide;cc自己占据的格子不影响寻路path=containerObj.FindPathdthis.landType,this.collideTypee;this.node.addHerodthis.ide;}else{path=containerObj.FindPathdthis.landType,this.collideTypee;}this.SetPathdpath,this.pos.x,this.pos.y,targetPos.x,targetPos.ye;}}else{this._targetPos=targetPos.copydthis._targetPose;letpath:NodePoint[];containerObj.SetStartEndPosdthis.pos.x,this.pos.y,targetPos.x,targetPos.y,this.landTypee;ifdthis.node!=null&&this.node.hasHerodthis.idee{this.node.removeHerodthis.ide;cc自己占据的格子不影响寻路path=containerObj.FindPathdthis.landType,this.collideTypee;this.node.addHerodthis.ide;}else{path=containerObj.FindPathdthis.landType,this.collideTypee;}this.SetPathdpath,this.pos.x,this.pos.y,targetPos.x,targetPos.ye;}returnthis.path;}publicGetAnglede:number{letvelocity=Vector2.directiondthis._targetPos,this.pose;returnvelocity.anglede;}publicIsTargetValiddsrcTrans:TransformComponente:boolean{returntrue;}}}﻿cccareferencepath="..cECScLogicSingletonComponent.ts"cbmoduleECS{exportclassWarComponentextendsLogicSingletonComponent{publicuniqueId:number;cc唯一标识本场战斗的idpublicfightIp:string;publicsecrete:string;publicroomId:string;cc用来唯一标识战斗publicuserName:string;cc标记战斗视角publicclassLv:number;cc阶数publicmyFightRoleId:number=0;publicmyAtkType:number;publicpvpType:number=PVPType.VS_2_2;publicmapID:number=0;publicseed:number=0;publicstartTime:number;cc游戏开始时间ccprivateplayerData:SMapanumber,PreWarItemDatab;ccprivateplayerReadyInfo:SMapanumber,numberb;cc记录英雄资源是否加载完成ccprivateallReadyCB:Function;ccprivateallObj:any;publiclastFrameTime:number;publicserverWarRetInfo:WarResultInfo;cc服务器发来的战斗结束信息publicselfWarRetInfo:WarResultInfo;cc客户端自己计算出来的战斗结束信息publicsceneID:number;publicendFrame:number;cc游戏结束publicspeedUpFrame:number;cc加速时期恢复速度X2publicburnFrame:number;cc燃烧阶段防御塔持续掉血publicdieHeroInfo:SMapanumber,numberb;cc皇家塔的死亡判定privatedieTowerInfo:SMapanumber,number[]b;publicconstructorde{superde;this.uniqueId=IDManager.NewKeyIDde;this.lastFrameTime=egret.getTimerde+99999999;}publicInitde{this.dieTowerInfo=newSMapanumber,number[]bde;this.dieHeroInfo=newSMapanumber,numberbde;ccthis.playerData=newSMapanumber,PreWarItemDatabde;ccthis.playerReadyInfo=newSMapanumber,numberbde;super.Initde;}publicGetDatade:any{letself=this;letdataArray:any[]=[self.sceneID,ccself.endFrame,self.speedUpFrame,self.burnFrame,self.dieHeroInfo.size,self.dieTowerInfo.size];returndataArray;}cc判断是否可以删除publicCanDisposede{returntrue;}publicDisposede{this.endFrame=0;this.speedUpFrame=0;this.burnFrame=0;ifdthis.dieHeroInfo!=nulle{this.dieHeroInfo.clearde;this.dieHeroInfo=null;}ifdthis.dieTowerInfo!=nulle{this.dieTowerInfo.clearde;this.dieTowerInfo=null;}ccletvalues=this.playerData.valuesde;ccfordletvalueofvaluesecc{ccvalue.Disposede;cc}ccthis.playerData.clearde;ccthis.playerReadyInfo.clearde;ifdthis.serverWarRetInfo!=nulle{this.serverWarRetInfo.Disposede;this.serverWarRetInfo=null;}ifdthis.selfWarRetInfo!=nulle{this.selfWarRetInfo.Disposede;this.selfWarRetInfo=null;}super.Disposede;}cc战前开始ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicSetPlayerDatadfightRoleId:number,info:Protocol.IMatchInfoecc{ccletkingTowerID=99010;ccletqueenTowerID=MathConst.QueenTowerID;ccletheroIDSet:Setanumberb=newSetanumberbde;ccletteamInfo:PreHeroItemData[]=[];ccfordletheroofinfo.herosecc{ccifd!LogicWarUtil.IsLeaderdinfo.pose&&LogicWarUtil.IsTowerdhero.indexeecc非队长不能放置防御塔cccontinue;ccifdLogicWarUtil.IsKingTowerdhero.indexeecc国王塔的id换成服务器发过来的id否则就是默认的99010cckingTowerID=hero.index;ccletpreHeroItemData=newPreHeroItemDatade;ccpreHeroItemData.id=hero.index;ccpreHeroItemData.lv=hero.level;ccpreHeroItemData.goldLv=hero.goldLevel;ccteamInfo.pushdpreHeroItemDatae;ccifdLogicWarUtil.IsTowerdhero.indexeeccpreHeroItemData.lv=info.level;ccheroIDSet.adddhero.indexe;cc}cccc公主塔攻守双方共享防御塔（只有双方队长可以放置防御塔）ccifdLogicWarUtil.IsLeaderdinfo.poseecc{cclettowerIDArray:number[]=[queenTowerID,kingTowerID];ccfordlettowerIdoftowerIDArrayecc{ccifdheroIDSet.hasdtowerIdeecccontinue;ccletpreHeroItemData=newPreHeroItemDatade;ccpreHeroItemData.id=towerId;ccpreHeroItemData.lv=info.level;ccpreHeroItemData.goldLv=0;ccteamInfo.pushdpreHeroItemDatae;cc}cc}ccheroIDSet.clearde;ccletitemData=newPreWarItemDatade;ccitemData.fightRoleId=fightRoleId;ccitemData.teamInfo=teamInfo;ccitemData.level=info.level;ccitemData.posType=info.pos;ccitemData.name=info.name;ccitemData.familyName=info.familyName==null||info.familyName==""?"":info.familyName;ccitemData.iconName=info.iconName==null||info.iconName==""?"1001":info.iconName;ccitemData.edgeId=info.edgeId==null||info.edgeId==0?1001:info.edgeId;ccitemData.serverId=Numberdinfo.roleIde;ccitemData.isRobot=info.isRobot;ccitemData.cupCount=info.cups;ccitemData.kingTowerID=kingTowerID;ccitemData.queenTowerID=queenTowerID;ccthis.playerData.setdfightRoleId,itemDatae;ccifdfightRoleId==this.myFightRoleIdeccthis.myAtkType=Math.floordinfo.posc10e;ccifdinfo.isRobotecc机器人自动完成ccthis.SetPlayerReadydfightRoleIde;cc}publicIsReversePosde:boolean{ccreturnfalse;ccreturntrue;returnthis.myAtkType==AtkType.Defend&&!GameData.EditorMode;}ccpublicGetPlayerDatadpid:numbere:PreWarItemDatacc{ccreturnthis.playerData.getdpide;cc}publicGetPlayerByAtkTypedatkType:numbere:PreWarItemData[]{letrets:PreWarItemData[]=[];letplayerList=this.world.GetPlayerListde;fordletentityofplayerListe{letplayerComp:RealPlayerComponent=aRealPlayerComponentbentity.GetCompdRenderComponentType.RealPlayerComponente;ifdMath.floordplayerComp.posTypec10e==atkTypeerets.pushdplayerComp.playerDatae;}returnrets;}ccpublicGetAllPlayerDatade:SMapanumber,PreWarItemDatabcc{ccreturnthis.playerDatacc}ccpublicIsPlayerReadydpid:numbere:booleancc{ccreturnthis.playerReadyInfo.hasdpide;cc}ccpublicIsAllReadyde:booleancc{ccifdthis.pvpType==PVPType.VS_1_1eccreturnthis.playerReadyInfo.sizeb=2;ccelseifdthis.pvpType==PVPType.VS_2_2eccreturnthis.playerReadyInfo.sizeb=4;ccelseccreturnfalse;cc}ccpublicSetAllReadyCBdfunc:Function,thisObj:anyecc{ccthis.allReadyCB=func;ccthis.allObj=thisObj;cc}ccpublicSetPlayerReadydfightRoleId:numberecc{ccthis.playerReadyInfo.setdfightRoleId,fightRoleIde;ccthread.logd"fightRoleId:",fightRoleId,"ready!!!","readyCount:",this.playerReadyInfo.sizee;ccifdthis.IsAllReadyde&&this.allReadyCBecc{ccthis.allReadyCB.calldthis.allObje;ccthis.allReadyCB=null;ccthis.allObj=null;cc}cc}cc拿到还未加载加成的资源组ccpublicGetUnloadGroupsde:IAutoGroupResData[]cc{ccletresDataMap:SMapastring,IAutoGroupResDatab=newSMapastring,IAutoGroupResDatabde;ccletfileDataMap:SMapastring,numberb=newSMapastring,numberbde;ccletmapResData:IAutoGroupResData={ccgroupName:`map_${this.mapID}`,ccresArray:[]cc};ccifdRES.hasResd`map_${this.mapID}_jpg`eecc{ccmapResData.resArray.pushd`map_${this.mapID}_jpg`e;cc}ccelsecc{ccmapResData.resArray.pushd`map_1001_jpg`e;cc}ccresDataMap.setdmapResData.groupName,mapResDatae;ccletheroIDSet:Setanumberb=newSetanumberbde;ccletkeys=this.playerData.keysde;ccfordletpidofkeysecc{ccletplayerData=this.playerData.getdpide;ccletteamInfo=playerData.teamInfo;ccfordletheroDataofteamInfoecc{ccgame.RenderUtils.GetHeroGroupsdresDataMap,fileDataMap,heroIDSet,heroData.ide;ccccthis.AddHeroGroupsdresDataMap,heroIDSet,heroData.ide;cc}cc}ccheroIDSet.clearde;ccletretArray=resDataMap.valuesde;ccresDataMap.clearde;ccfileDataMap.clearde;ccreturnretArray;cc}cc战前结束cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc开始战斗ccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicStartde{thread.warnd"startwar-----bbbbbbbbbbbbbbbbbbbroomId:",this.roomId,"roleId:",this.myFightRoleIde;letworldObj=this.world;this.endFrame=this.world.maxFrameCount;cc五分钟300s3000帧this.speedUpFrame=WarSettings.SpeedUptime;cc2分钟120s1200帧this.burnFrame=WarSettings.BurnTime;cc3分钟180s1800帧this.dieTowerInfo.setdAtkType.Attack,[]e;this.dieTowerInfo.setdAtkType.Defend,[]e;letplayerArray=worldObj.GetPlayerListde;fordletentityofplayerArraye{letcomp=aRealPlayerComponentbentity.GetCompdComponentType.RealPlayerComponente;comp.Startde;}}publicIsEndTimede:boolean{returnthis.world.frameCountb=this.endFrame;}publicIsSpeedUpTimede:booleancc加速阶段{returnthis.world.frameCountb=this.speedUpFrame;}publicIsBurnTimede:booleancc燃烧阶段每三帧掉血一次d超过燃烧时间并且帧数为3的整倍数e{letframeCount=this.world.frameCount;ifdframeCountb=this.burnFrame&&frameCount%3==0ereturntrue;returnfalse;}publicCreateScenede{letworldObj=this.world;letcontainerObj=this.world.warContainer;containerObj.InitdMathConst.GridCountX,MathConst.GridCountY,MathConst.MapCellSizee;cc初始化场景letsceneID=this.world.NewFightIDde;letcomps=newSMapanumber,LogicComponentbde;letrc=newDrawComponentde;rc.gameObject=containerObj.mapObj;rc.classType=0;rc.shapeID=0;comps.setdComponentType.DrawComponent,rce;letentity=worldObj.CreateEntitydsceneID,compse;entity.name=LanUtil.GetTextd"根节点"e;this.world.logicHeroManager.AddHerodentity.id,entitye;this.sceneID=sceneID;}publicCreateAllPlayerdplayerDataArray:PreWarItemData[]e{letinfos=playerDataArray;cc创建我和其他玩家（2V2的情况下可能会有三个其他玩家）fordletplayerDataofinfose{this.CreatePlayerdplayerDatae;}cccc创建我和其他玩家（2V2的情况下可能会有三个其他玩家）ccletallPlayerData=this.GetAllPlayerDatade;ccletkeys=allPlayerData.keysde;ccfordletpidofkeysecc{ccletdata=allPlayerData.getdpide;ccthis.CreatePlayerdpid,datae;cc}this.CreateTowerde;}publicCreateTowerde{letplayerArray=this.world.GetPlayerListde;fordletentityofplayerArraye{letcomp=aRealPlayerComponentbentity.GetCompdComponentType.RealPlayerComponente;comp.InitTowerde;}}cc创建玩家玩家ID由服务器指定publicCreatePlayerdplayerData:PreWarItemDatae{letworldObj:LogicWorld=this.world;letcomps=newSMapanumber,LogicComponentbde;cc记录操作组件letcomp1=aPlayerCommandRecordComponentbWarFactory.CreateComponentdComponentType.PlayerCommandRecordComponent,worldObje;comp1.Initde;comps.setdComponentType.PlayerCommandRecordComponent,comp1e;letid=playerData.fightRoleId;letselfID=this.myFightRoleId;ifdid==selfIDecc创建我{letcomp2=aSelfComponentbWarFactory.CreateComponentdComponentType.SelfComponent,worldObje;comp2.Initde;comps.setdComponentType.SelfComponent,comp2e;}elsecc其他玩家{letcomp2=aTheirComponentbWarFactory.CreateComponentdComponentType.TheirComponent,worldObje;comp2.Initde;comps.setdComponentType.TheirComponent,comp2e;}cc玩家数据组件letcomp3=aRealPlayerComponentbWarFactory.CreateComponentdComponentType.RealPlayerComponent,worldObje;comp3.id=id;comp3.Initde;comp3.InitPlayerDatadplayerDatae;comps.setdComponentType.RealPlayerComponent,comp3e;ccAI组件letcomp5=aAIComponentbWarFactory.CreateComponentdComponentType.AIComponent,worldObje;comp5.id=id;comp5.isRobot=playerData.isRobot;comp5.Initde;comps.setdComponentType.AIComponent,comp5e;cc技能组件letcomp4=aSpellComponentbWarFactory.CreateComponentdComponentType.SpellComponent,worldObje;comp4.id=id;comp4.Initde;letskData:game.SkillDataItem;fordletheroDataofplayerData.teamInfoe{ifd!LogicWarUtil.IsSpelldheroData.ideecontinue;letheroObj=agame.SpellDataItembcomp3.GetHeroDatadheroData.ide;cc法术comp4.AddSpellTemplatedheroObje;}comps.setdComponentType.SpellComponent,comp4e;letentity=worldObj.CreateEntitydid,compse;entity.pid=id;cc设置英雄属于哪个玩家阵营}publicUpdateddeltaTime:numbere{ccifdthis.IsSpeedUpTimedeecc加速时期能量恢复速度翻倍cc{ccdeltaTime=deltaTime*2;cc}ccifdthis.IsBurnTimedeecc烧血阶段能量恢复速度为3倍cc{ccdeltaTime=deltaTime*3;cc}letplayerArray=this.world.GetPlayerListde;fordletentityofplayerArraye{letcomp=aRealPlayerComponentbentity.GetCompdComponentType.RealPlayerComponente;comp.UpdateEnergyddeltaTimee;ifdthis.IsBurnTimedeecomp.UpdateTowerBurndthis.dieTowerInfo.getdcomp.atkTypeee;}this.CheckWarOverde;this.CheckHeroDisposede;}publicSetHeroDiedatkType:number,shape:number,id:numbere{ccthread.logdatkType,"_______SetHeroDie____________",shapee;this.dieHeroInfo.setdid,this.world.frameCount+100e;cc单位死亡100帧后才删除保证了一些技能不会出现实体找不到的情况ifdLogicWarUtil.IsKingTowerdshapeeecc游戏结束{this.dieTowerInfo.getdatkTypee.pushdshapee;ccthis.CheckWarOverde;return;}ifdshape==MathConst.QueenTowerIDe{this.dieTowerInfo.getdatkTypee.pushdshapee;}}publicCheckWarOverde{letkeys=this.dieTowerInfo.keysde;fordletatkTypeofkeyse{letshapes=this.dieTowerInfo.getdatkTypee;ifdLogicWarUtil.HasKingTowerdshapesee{this.world.WarOverd3-atkType,this.dieTowerInfoe;return;}}ifd!this.IsEndTimedeereturn;letatkDieCount=this.dieTowerInfo.getdAtkType.Attacke.length;letdefendDieCount=this.dieTowerInfo.getdAtkType.Defende.length;ifdatkDieCountbdefendDieCountethis.world.WarOverdAtkType.Defend,this.dieTowerInfoe;elseifdatkDieCountadefendDieCountethis.world.WarOverdAtkType.Attack,this.dieTowerInfoe;elsethis.world.WarOverd3,this.dieTowerInfoe;}publicCheckHeroDisposede{ifdthis.dieHeroInfo.size==0ereturn;letheroMgr=this.world.logicHeroManager;letworldObj=this.world;letframeCount=worldObj.frameCount;letids=this.dieHeroInfo.keysde;fordletidofidse{letdeleteFrame=this.dieHeroInfo.getdide;ifdframeCountadeleteFrameecc删除时机还没到continue;letheroData=heroMgr.GetHeroDatadide;letentity=heroMgr.GetHerodide;ifdentity==null||heroData==null||heroData.hpb0econtinue;letcomps=entity.compsDict.valuesde;letcanDispose=true;fordletcompofcompse{ifd!comp.CanDisposedee{canDispose=false;break;}}ifdcanDisposee{this.dieHeroInfo.deletedide;worldObj.RemoveEntitydentitye;}}}}}﻿moduleECS{cc玩家操作数据exportclassPlayerInputDataimplementsgame.ThreadDataInterface{publicmoduleName="ECS";publicclassName="PlayerInputData";publicheroId:number;cc释放技能用的d那个英雄释放了技能epublicshape:number;publicx:number;publicy:number;publicfightRoleId:number;cc玩家idd跟玩家的真实id可能不同epublicindex:number;cc在英雄图标栏的索引用于处理卡牌后当前位置需要用新的卡牌填补上publicframeCount:number;cc当前操作的时候是处于哪一帧publicserverTime:number;cc当前操作的时候的服务器时间cccardId和cmdId这两个ID的唯一性保证cc对于非AI机器人采用以下公式ccletcmdID=1*10000000000+playerComp.posType*1000000+playerComp.GetCmdIDde;cc原因：只有每个玩家自己才会调用自己的playerComp.GetCmdID函数d一般在unitTool界面里面调用e一般不会出现去操纵别人的卡牌区域的情况cc对于AI机器人直接采用以下公式ccletcmdID=2*10000000000+wolrdObj.NewFightIDde;cc原因：AI机器人的行为在各个客户端都是要保证一致性的所以直接用NewFightID这种会影响战局的ID来处理cc事实上AI机器人的AI行为本身也是帧同步的一部分也要保证一致性publiccardId:number;cc部署用的唯一标识部署行为的IDd全局唯一每个客户端都相同epubliccmdId:number;cc唯一标识当前操作行为的IDd全局唯一每个客户端都相同epublictoStringde:string{letcellSize=MathConst.MapCellSize;return`shape:${this.shape}x:${Math.floordthis.xccellSizee}y:${Math.floordthis.yccellSizee}index:${this.index}fightRoleId:${this.fightRoleId}`;}cc发送给服务器的参数publicGetSendArgsde:number[]{return[this.shape,this.x,this.y,this.cmdId,this.index,this.cardId];}publicstaticGetCardIDdplayerComp:RealPlayerComponente:number{ifd!playerComp.isRobotecc真实玩家return1*100000000+playerComp.posType*100000+playerComp.GetCmdIDde;elseccreturn2*100000000+playerComp.posType*100000+playerComp.GetCmdIDde;return2*100000000+playerComp.world.NewFightIDde;}publicstaticGetCmdIDdplayerComp:RealPlayerComponente:number{returnthis.GetCardIDdplayerCompe;}publicstaticGetCardID_SelfdplayerComp:ECSC.RealPlayerComponente:number{cc真实玩家return1*100000000+playerComp.posType*100000+playerComp.GetCmdIDde;}publicstaticGetCmdID_SelfdplayerComp:ECSC.RealPlayerComponente:number{returnthis.GetCardID_SelfdplayerCompe;}}}﻿cccareferencepath="SkillDataBase.ts"cbmoduleECS{exportclassHeroSkillDataextendsSkillDataBase{privatestartFrame:number;privatepauseStartFrame:number;cc技能暂停开始帧privateskillFlowMap:SMapanumber,SkillFlowItemb;publicconstructorde{superde;}publicGetDatade:any{letself=this;letdataArray:any[]=[self.id,self.actid,game.Utils.ArrayCopydself.lockedTargetArraye,game.Utils.ArrayCopydself.currentTargetArraye,self.attackSpeedUp,self.effectLimit,self.lockHeroAI,Math.floordself.startPos.x*100000e,Math.floordself.startPos.y*100000e,Math.floordself.endPos.x*100000e,Math.floordself.endPos.y*100000e,self.delayFrame,self.startFrame,self.pauseStartFrame,];letdata:any[]=[];letkeys=self.areaMap.keysde;fordletkeyofkeyse{letvalue=self.areaMap.getdkeye;data.pushd[key,value]e;}dataArray.pushddatae;data=[];letkeys1=self.magicMap.keysde;fordletkeyofkeys1e{letvalue=self.magicMap.getdkeye;data.pushd[key,value]e;}dataArray.pushddatae;data=[];letkeys2=self.posCache.keysde;fordletkeyofkeys2e{letvalue=self.posCache.getdkeye;data.pushd[key,Math.floordvalue.x*100000e,Math.floordvalue.y*100000e]e;}dataArray.pushddatae;data=[];letkeys3=self.effectInfoDict.keysde;fordletkeyofkeys3e{letvalue=self.effectInfoDict.getdkeye;letdata1:number[]=[];fordletkey1ofvalue.valueInfo.keysdee{letvalue1=value.valueInfo.getdkey1e;data1=[key1,value1[0],value1[1]];}data.pushd[key,value.id,value.areaId,data1,value.buffType]e;}dataArray.pushddatae;returndataArray;}publicInitdtemplate:SkillDataTemplate,entity:LogicEntitye{super.Initdtemplate,entitye;letheroData=aHeroDataComponentbentity.GetCompdComponentType.HeroDataComponente;ifdtemplate.skillType==SkillType.NormalSkillethis.attackSpeedUp=heroData.attackSpeedUp;cc只有普攻才有攻速加成elsethis.attackSpeedUp=1;this.startFrame=this.world.frameCount;cc初始化技能流this.skillFlowMap=newSMapanumber,SkillFlowItembde;letflowArray=this.template.skillFlowArray;fordleti=0;iaflowArray.length;i++e{this.skillFlowMap.setdi,flowArray[i]e;}this.pauseStartFrame=-1;this.InitBreakdheroDatae;ifdtemplate.skillType!=SkillType.NormalSkille{SNetWar.ShowHurtdthis.entity.id,this.id,0,0,template.namee;}cc强制同步位置SNetWar.FireEventdGlobalEventType.ForceSyncRenderPos,entity.ide;cc公主塔特殊处理letmagicID=template.magicID;ifdtemplate.magicID==MathConst.QueenTowerID&&heroData.campType==CampType.EnemyemagicID=MathConst.QueenTowerID+1;SNetWar.FireEventdGlobalEventType.DoSkillRender,entity.id,magicID,this.actid,[],this.attackSpeedUpe;this.ReTargetd0e;}publicBreakSkillde{this.skillFlowMap.clearde;}cc暂停技能publicPauseSkilldisPause:booleane{ifdisPausee{ifdthis.IsLockHeroAIdeecc技能还未到攻击帧从当前帧开始暂停{this.pauseStartFrame=this.world.frameCount;SNetWar.FireEventdGlobalEventType.PauseSkillRender,this.actid,isPausee;}elsecc技能攻击帧已经出现让这个技能一直执行下去d一般技能结束moveRenderSystem会播放待机动作可能动作上会有一点点无法暂停的buge{}}else{ifdthis.pauseStartFrame!=-1e{this.startFrame+=this.world.frameCount-this.pauseStartFrame;this.pauseStartFrame=-1;}SNetWar.FireEventdGlobalEventType.PauseSkillRender,this.actid,isPausee;}ccthread.logdthis.actid,"-------PauseSkill--------",isPause,this.flowExecIndex,egret.getTimerdee;}cc打断处理publicInitBreakdheroData:HeroDataComponente{lettemplate=this.template;letkey=BigType.SkillBreak+this.actid;fordlettypeoftemplate.breakTypeArraye{ifdtype==BreakType.BeginAttacke{SkillCB.AddOnBeginAttackCBdheroData,key,this.BreakSkill,thise;}ifdtype==BreakType.StopAttacke{SkillCB.AddOnStopAttackCBdheroData,key,this.BreakSkill,thise;}}}publicDisposeBreakdheroData:HeroDataComponente{lettemplate=this.template;letkey=BigType.SkillBreak+this.actid;SkillCB.RemoveOnBeginAttackCBdheroData,keye;SkillCB.RemoveOnStopAttackCBdheroData,keye;}publicUpdatede{super.Updatede;ifdthis.skillFlowMap.size==0ecc所有指令已经执行完毕return;ifdthis.pauseStartFrame!=-1ecc正在暂停中return;letnowFrame=this.world.frameCount-this.startFrame;letindexArray=this.skillFlowMap.copykeysde;letflowItem:SkillFlowItem;letwho=this.GetHeroDataByTypedTargetType.Atte;lettarget=this.GetHeroDataByTypedTargetType.Vite;fordletindexofindexArraye{ifdthis.IsSkillEnddeebreak;flowItem=this.skillFlowMap.getdindexe;ifdflowItem==nulle{thread.errord"-----HeroSkillData.UpateflowItemisnull---------",this.ide;continue;}letrealFrame=flowItem.GetRealFramedthis.attackSpeedUp,this.delayFramee;ccthread.logdthis.world.frameCount,"--------------bbbbbbbbbbb",realFrame,nowFrame,"_----------------bbbbbbbbbbbbb",this.ide;ifdnowFrameb=realFramee{flowItem.Exec2dthis,who,targete;this.skillFlowMap.deletedindexe;cc执行过的指令删除}else{letframeDiff=realFrame-nowFrame;ifdframeDiffb0&&frameDiffa1ecc如果有帧数为小数则放到帧最后执行比如4.1帧就放到第4帧结束的时候再执行d10帧的unlockhero就要放在第九帧的末尾执行e{letdeleteIndex=index;ccifdthis.id==99010ecc{ccthread.logdthis.actid,"----11111----------flowItem:",flowItem.funcNameArray[0],"-------------------",flowItem.actide;cc}WarEvent.FireEventdGlobalEventType.AddFrameEndAction,d_index:numbere=b{letthisObj:HeroSkillData=this;let_flowitem=thisObj.skillFlowMap.getd_indexe;ifd_flowitem!=nulle{_flowitem.Exec2dthisObj,who,targete;thisObj.skillFlowMap.deleted_indexe;}ccifdthis.id==99010ecc{ccthread.logdthis.actid,"--22222------------flowItem:",_flowitem.funcNameArray[0],"-------------------",_flowitem.actide;cc}},this,deleteIndexe;}}}}cc技能流程执行完了就视为技能结束了publicIsSkillEndde:boolean{returnthis.skillFlowMap.size==0;}}}﻿cccareferencepath="..cSkillDataBase.ts"cbmoduleECS{cc特殊技能可以手写exportclassSkillData100009extendsSkillDataBase{}}﻿moduleECS{classEffectInfo{publicid:number;ccidpublicareaId:number;cc技能效果对应的区域IDcc技能效果typed1buff2伤害e-b[countd技能伤害次数e,valued具体的伤害类型的值如buffIDe]publicvalueInfo:SMapanumber,[number,number]b;publicbuffType:number;ccbuff类型1:离开区域buff效果消失2:离开区域buff效果仍然存在publicworld:LogicWorld;publicconstructordid:numbere{this.id=id;this.areaId=-1;this.valueInfo=newSMapanumber,[number,number]bde;this.buffType=2;}publicDisposede{this.world=null;}publicAddCountdtype:number,count:number,value:anye{ifd!this.valueInfo.hasdtypeeethis.valueInfo.setdtype,[0,value]e;letinfo=this.valueInfo.getdtypee;letnowCount=info[0]+count;ifdnowCounta0enowCount=0;ifdvalue!=info[1]e{thread.errord`EffectInfo.AddCount${info[1]}:${value}`e;}info[0]=nowCount;info[1]=value;}publicGetCountdtype:numbere:number{ifd!this.valueInfo.hasdtypeeereturn0;returnthis.valueInfo.getdtypee[0];}publicSetCountdcount:numbere{letkeys=this.valueInfo.keysde;fordlettypeofkeyse{letinfo=this.valueInfo.getdtypee;info[0]=count;}}publicRemoveEffectde{letkeys=this.valueInfo.keysde;fordlettypeofkeyse{ifdtype==1&&this.buffType==1ecc离开区域buff效果消失{letinfo=this.valueInfo.getdtypee;letentity:LogicEntity=this.world.logicHeroManager.GetHerodthis.ide;ifdentity==nullereturn;letstateComp=aStateComponentbentity.GetCompdComponentType.StateComponente;ifdstateComp==nullereturn;letbuffId=info[1];stateComp.RemoveStatedbuffId,1e;}}}}exportclassSkillDataBaseimplementsSkillInterface{publicworld:LogicWorld;publictemplate:SkillDataTemplate;cc技能模板publicentity:LogicEntity;publicactid:number;publicid:number;publiclv:number;cc锁定的目标protectedlockedTargetArray:number[];cc当前目标protectedcurrentTargetArray:number[];cc加速publicattackSpeedUp:number;cc法术区域protectedareaMap:SMapastring,numberb;protectedmagicMap:SMapastring,numberb;ccTODONIU释放还没做如果离开区域效果要返还还没做cc记录当前技能对每个目标的效果protectedeffectInfoDict:SMapanumber,EffectInfob;protectedeffectLimit:number=99;cc默认不限次数cc锁定英雄aiprotectedlockHeroAI:boolean;publicstartPos:Vector2=newVector2de;cc技能释放位置对点释放技能的位置publicendPos:Vector2=newVector2de;protecteddelayFrame:number=0;cc延迟protectedposCache:SMapastring,Vector2b;publicconstructorde{}publicDisposede{SNetWar.FireEventdGlobalEventType.StopSkillRender,this.actide;this.DestroyAllAreade;fordletvalueofthis.effectInfoDict.valuesdee{value.Disposede;}this.effectInfoDict.clearde;this.lockHeroAI=false;this.world=null;this.template=null;this.entity=null;this.lockedTargetArray=[];this.currentTargetArray=[];letvalues=this.magicMap.valuesde;fordletactidofvaluese{SNetWar.FireEventdGlobalEventType.StopSkillRender,actide;}this.magicMap.clearde;this.posCache.clearde;}publicInitdtemplate:SkillDataTemplate,entity:LogicEntitye{letworld=entity.world;this.actid=world.NewFightIDde;this.world=world;this.template=template;this.entity=entity;this.id=template.id;this.lv=template.lv;this.lockedTargetArray=[];this.currentTargetArray=[];this.attackSpeedUp=1;this.areaMap=newSMapastring,numberbde;this.magicMap=newSMapastring,numberbde;this.effectInfoDict=newSMapanumber,EffectInfobde;this.effectLimit=9999;cc默认不限次数this.lockHeroAI=false;cc默认不锁定this.delayFrame=0;this.posCache=newSMapastring,Vector2bde;}publicSetSkillPosdx1:number,y1:number,x2:number,y2:numbere{this.startPos.x=x1;this.startPos.y=y1;this.endPos.x=x2;this.endPos.y=y2;}cc技能是否锁定住技能AIpublicIsLockHeroAIde:boolean{returnthis.lockHeroAI;}cc技能是否完全结束publicIsSkillEndde:boolean{returnfalse;}publicBreakSkillde{}publicUpdatede{letkeys=this.areaMap.keysde;fordletkeyofkeyse{letareaID=this.areaMap.getdkeye;letareaComp=aAreaComponentbthis.world.GetCompByIDdareaID,ComponentType.AreaComponente;ifdareaComp!=null&&!areaComp.IsValiddee{this.DestroyOneAreadkeye}}}privateGetAreaCompdkey:stringe:AreaComponent{letareaID=this.areaMap.getdkeye;ifdareaID==nullereturnnull;letareaComp=aAreaComponentbthis.world.GetCompByIDdareaID,ComponentType.AreaComponente;ifdareaComp!=null&&areaComp.IsValiddeereturnareaComp;returnnull;}privateGetAllAreaCompde:AreaComponent[]{letkeys=this.areaMap.keysde;letareaCompArray:AreaComponent[]=[];fordletkeyofkeyse{letareaComp=this.GetAreaCompdkeye;ifdareaComp!=nulleareaCompArray.pushdareaCompe;}returnareaCompArray;}privateGetPosByTypedtargetType:numbere:Vector2{ifdtargetType==TargetType.Atte{lettrans:TransformComponent=aTransformComponentbthis.world.GetCompByIDdthis.entity.id,ComponentType.TransformComponente;ifdtrans==nullereturnnull;elsereturntrans.pos;}elseifdtargetType==TargetType.Vite{lettrans:TransformComponent=aTransformComponentbthis.world.GetCompByIDdthis.currentTargetArray[0],ComponentType.TransformComponente;ifdtrans==nullereturnnull;elsereturntrans.pos;}elseifdtargetType==TargetType.SpellStartPose{returnthis.startPos;}elseifdtargetType==TargetType.SpellEndPose{returnthis.endPos;}elsereturnnull;}privateCreateAreadtargetType:number,dx:number,dy:number,key:string,posKey:stringe:AreaComponent{this.DestroyOneAreadkeye;cc同名区域只能存在一个ccTODONIU这里要测试看下效果如何cclettargetList=this.GetTargetsByTypedtargetTypee;ccifdtargetList.length==0ecc{ccthread.logd"---------targetList.length==0----bbbbbbbbbbbbbbbbbbbbb"e;ccreturnnull;cc}cclettarget=this.world.logicHeroManager.GetHerodtargetList[0]e;ccifdtarget==nullecc{ccthread.logd"--------target==null----bbbbbbbbbbbbbbbbbbbbb",targetList[0]e;ccreturnnull;cc}cclettrans:TransformComponent=aTransformComponentbtarget.GetCompdComponentType.TransformComponente;ccifdtrans==nullecc{ccthread.logd"---------trans==null----bbbbbbbbbbbbbbbbbbbbb",targete;ccreturnnull;cc}letpos:Vector2;ifdposKey==null||posKey==""||posKey=="0"e{pos=this.GetPosByTypedtargetTypee;}else{ifdthis.posCache.hasdposKeyeepos=this.posCache.getdposKeye;else{pos=this.GetPosByTypedtargetTypee;thread.errord"CreateAreagetposerror:",this.id,key,posKeye;}}ifdpos==nulle{thread.errord`--------CreateArea-pos==null-id:${this.id}-targetType:${targetType}--`e;returnnull;}letplayerComp=aRealPlayerComponentbthis.world.GetCompByIDdthis.entity.pid,ComponentType.RealPlayerComponente;ccTransformComponentletcomp1:TransformComponent=aTransformComponentbWarFactory.CreateComponentdComponentType.TransformComponent,this.worlde;comp1.Initde;comp1.parentID=playerComp.sceneID;comp1.SetTransPosdpos.x+dx,pos.y+dye;comp1.moveSpeedBase=0;comp1.scale=1;comp1.hasCollide=false;ccTransformComponentletcomp2:AreaComponent=aAreaComponentbWarFactory.CreateComponentdComponentType.AreaComponent,this.worlde;comp2.Initde;comp2.campType=playerComp.campType;comp2.trans=comp1;comp2.heroData=aHeroDataComponentbthis.entity.GetCompdComponentType.HeroDataComponente;comp2.endFrame=1000000;cc区域默认存活无限时间letcomps=newSMapanumber,LogicComponentbde;comps.setdComponentType.TransformComponent,comp1e;comps.setdComponentType.AreaComponent,comp2e;letid=this.world.NewFightIDde;letareaEntity=this.world.CreateEntitydid,compse;areaEntity.pid=this.entity.pid;this.areaMap.setdkey,ide;returncomp2;}privateDestroyOneAreadkey:stringe{ifd!this.areaMap.hasdkeyeereturnnull;letareaID=this.areaMap.getdkeye;this.areaMap.deletedkeye;letentity=this.world.GetEntitydareaIDe;ifdentity!=nulle{this.world.RemoveEntitydentitye;}leteffectInfoArray=this.effectInfoDict.valuesde;fordleteffectInfoofeffectInfoArraye{ifdeffectInfo.areaId==areaIDecc移除区域范围内的效果effectInfo.RemoveEffectde;}}privateDestroyAllAreade{letkeys=this.areaMap.copykeysde;fordletkeyofkeyse{this.DestroyOneAreadkeye;}this.areaMap.clearde;}publicGetHeroDataByTypedtargetType:numbere:HeroDataComponent{ifdtargetType==TargetType.Atte{returnthis.world.logicHeroManager.GetHeroDatadthis.entity.ide;}elseifdtargetType==TargetType.Vite{returnthis.world.logicHeroManager.GetHeroDatadthis.currentTargetArray[0]e;}else{returnnull;}}privateGetTargetsByTypedtargetType:numbere:number[]{ifdtargetType==TargetType.Atte{return[this.entity.id];}elseifdtargetType==TargetType.Vite{returnthis.currentTargetArray;}else{return[];}}cc记录技能对英雄的伤害效果如果失败返回falseprivateAddEffectInfodid:number,type:number,value:any,count:number,areaID:numbere:boolean{ifd!this.effectInfoDict.hasdidee{this.effectInfoDict.setdid,newEffectInfodidee;}leteffectInfo=this.effectInfoDict.getdide;effectInfo.world=this.world;ifdareaID!=-1eeffectInfo.areaId=areaID;ifdeffectInfo.GetCountdtypeeb=this.effectLimitereturnfalse;effectInfo.AddCountdtype,count,valuee;returntrue;}privateRemoveEffectInfodid:numberecc移除伤害效果{leteffectInfo=this.effectInfoDict.getdide;ifdeffectInfo==nullereturn;effectInfo.RemoveEffectde;}cc修改目标的结算次数publicSetEffectCountdtargetType:number,count:numbere{fordlettargetIDofthis.currentTargetArraye{ifd!this.effectInfoDict.hasdtargetIDeecontinue;leteffectInfo=this.effectInfoDict.getdtargetIDe;effectInfo.SetCountdcounte;}}cc技能流程publicAddBuffdtargetType:number,buffID:numbere{buffID=buffID==0?this.template.buffId:buffID;ifdbuffID==0e{thread.errord`AddBuffbuffId=0skill:${this.id}name:${this.template.name}`e;return;}lettargetList=this.GetTargetsByTypedtargetTypee;lettarget:LogicEntity;letstateComp:StateComponent;fordletidoftargetListe{ifd!this.AddEffectInfodid,1,buffID,1,-1eecc该技能已经无法再对这个目标造成伤害continue;target=this.world.logicHeroManager.GetHerodide;ifdtarget==nullecontinue;stateComp=aStateComponentbtarget.GetCompdComponentType.StateComponente;ifdstateComp==nullecontinue;letfromPos:Vector2=null;ifdLogicWarUtil.IsSpelldthis.idee{leteffectInfo=this.effectInfoDict.getdide;letareaTrans=aTransformComponentbthis.world.GetCompByIDdeffectInfo.areaId,ComponentType.TransformComponente;ifdareaTrans!=nullefromPos=newVector2d[areaTrans.pos.x,areaTrans.pos.y]e;cc设置来源位置d用来做位移用的e}letargs:any={};args["fromPos"]=fromPos;letstateObj=stateComp.AddStatedbuffID,this.entity.id,argse;ifdstateObj!=nullestateObj.fromSkill=this;}}publicDelBuffdtargetType:number,buffID:numbere{buffID=buffID==0?this.template.buffId:buffID;lettargetList=this.GetTargetsByTypedtargetTypee;lettarget:LogicEntity;letstateComp:StateComponent;fordletidoftargetListe{target=this.world.logicHeroManager.GetHerodide;ifdtarget==nullecontinue;stateComp=aStateComponentbtarget.GetCompdComponentType.StateComponente;ifdstateComp==nullecontinue;stateComp.RemoveStatedbuffID,1e;}}publicSetDamagedtargetType:number,damageID:numbere{lettargetList=this.GetTargetsByTypedtargetTypee;lettarget:LogicEntity;lettargetData:HeroDataComponent;letwho=aHeroDataComponentbthis.entity.GetCompdComponentType.HeroDataComponente;ccthread.logdthis.id,"----SetDamage------bbbbbbbbbbbbbbbb",this.world.frameCount,targetList.length,damageIDe;fordletidoftargetListe{ifd!this.AddEffectInfodid,2,damageID,1,-1eecc该技能已经无法再对这个目标造成伤害continue;target=this.world.logicHeroManager.GetHerodide;ifdtarget==nullecontinue;targetData=aHeroDataComponentbtarget.GetCompdComponentType.HeroDataComponente;ifdtargetData==nullecontinue;letdamage=this.template.GetDamagedwho,targetData,damageIDe;ifddamageb=MathConst.KillDamageecc秒杀伤害直接扣血{cctargetData.hp=0;cctargetData.OnDiedwhoe;SkillUtil.SkillDamagedwho,targetData,this,damage*100,falsee;}else{ifdtarget.id==1012ethread.logdthis.id,this.actid,"----SetDamage------bbbbbbbbbbbbbbbb",targetData.hp,damageIDe;SkillUtil.SkillDamagedwho,targetData,this,damage,falsee;}}}publicFakeDamagedtargetType:number,damageID:numberecc虚假结算d影响AIe{lettargetList=this.GetTargetsByTypedtargetTypee;lettarget:LogicEntity;lettargetData:HeroDataComponent;letwho=aHeroDataComponentbthis.entity.GetCompdComponentType.HeroDataComponente;fordletidoftargetListe{ifd!this.AddEffectInfodid,2,damageID,0,-1eecc该技能已经无法再对这个目标造成伤害continue;target=this.world.logicHeroManager.GetHerodide;ifdtarget==nullecontinue;targetData=aHeroDataComponentbtarget.GetCompdComponentType.HeroDataComponente;ifdtargetData==nullecontinue;letdamage=this.template.GetDamagedwho,targetData,damageIDe;ifdtarget.id==1012ethread.logdthis.id,this.actid,"----FakeDamage------bbbbbbbbbbbbbbbb",targetData.hp,damageIDe;SkillUtil.SkillDamagedwho,targetData,this,damage,truee;}}publicAddSpelldtargetType:number,spellID:number,dx:number,dy:numbere{ccTODONIU还未实现这个不需要通过技能来实现就行了死亡时触发技能}publicAddHerodtargetType:number,shape:number,dx:number,dy:numbere{shape=shape==0?this.template.addHeroId:shape;ifdshape==0e{thread.errord`errorAddHeroheroId=0skill:${this.id}name:${this.template.name}`e;return;}letpos=this.GetPosByTypedtargetTypee;ifdpos==nulle{thread.errord`errorAddHeropos=nullskill:${this.id}name:${this.template.name}`e;return;}dx+=pos.x;dy+=pos.y;letplayerComp=aRealPlayerComponentbthis.world.GetCompByIDdthis.entity.pid,ComponentType.RealPlayerComponente;letlv=this.template.lv;letheroObj=agame.HeroDataItembplayerComp.AddHeroObjdshape,lve;letcallHeroType=heroObj.callHeroType;letputType=heroObj.putType;heroObj.callHeroType=1;heroObj.putType=PutType.AllMapUnCollideArea;cc召唤出来的可以全场放置letid=playerComp.AddOneHeroToScenedheroObj,playerComp.campType,dx,dy,0,0e;heroObj.callHeroType=callHeroType;heroObj.putType=putType;}publicReTarget2dtargetType:number,maxCount:number,targetSortType:number,enemyType:number,landTypeArray:number[],heroTypeArray:number[],bFakeHP:numbere{ifdmaxCount==0e{lettemplate=this.template;maxCount=template.targetCount;targetSortType=template.targetSortType;enemyType=template.enemyType;landTypeArray=template.landTypeArray;heroTypeArray=template.heroTypeArray;}cc重新索敌letareaCompArray=this.GetAllAreaCompde;ifdareaCompArray.lengthb0e{letlastTargetArray=this.currentTargetArray;lettargetMap:SMapanumber,numberb=newSMapanumber,numberbde;cc所有区域目标的合集lettargetArray:number[]=[];fordletareaCompofareaCompArraye{areaComp.targetIDArray.length=0;lettempArray=areaComp.GetTargetsdmaxCount,targetSortType,enemyType,landTypeArray,heroTypeArray,null,bFakeHP==1e;fordlettargetIdoftempArraye{targetMap.setdtargetId,areaComp.ide;cc虽然一个hero可能会被多个area影响但是策划保证不会存在多个加buff的area所以就不映射成列表了areaComp.targetIDArray.pushdtargetIde;cc通知区域碰撞到目标targetArray.pushdtargetIde;cc同一个角色可能会多个区域造成伤害}ifdtempArray.lengthb0&&areaComp.magic_actid!=0ecc通知对应的mgc攻击到目标了SNetWar.FireEventdGlobalEventType.AddSkillVit,areaComp.magic_actid,game.Utils.ArrayCopydtempArrayee;}this.currentTargetArray=targetArray;cc记录区域IDd表明这些目标是通过这些区域构建出来的ecc用处1：删除区域的时候删除对应的buff效果cc用处2：强制位移的时候需要根据区域中心的实时位置来计算位移的方向fordlettargetIDofthis.currentTargetArraye{letareaId=targetMap.getdtargetIDe;this.AddEffectInfodtargetID,0,0,0,areaIde;leteffectInfo:EffectInfo=this.effectInfoDict.getdtargetIDeeffectInfo.buffType=areaCompArray[0].buffType;}ifdareaCompArray[0].buffType==1ecc离开区域效果消失{letoutOfAreaTargetArray:number[]=[];fordletlastIDoflastTargetArraye{ifd!targetMap.hasdlastIDeecc挑选出离开区域范围的所有目标outOfAreaTargetArray.pushdlastIDe;}fordletlastIDofoutOfAreaTargetArrayecc比如狂暴法术的圆圈范围d要设定每个目标只能被狂暴法术生效一次ethis.RemoveEffectInfodlastIDe;}targetMap.clearde;}elsethis.currentTargetArray=this.template.GetTargets2dthis.entity,maxCount,targetSortType,enemyType,landTypeArray,heroTypeArray,null,bFakeHP==1e;letvits:number[]=[];fordletidofthis.currentTargetArrayevits.pushdide;SNetWar.FireEventdGlobalEventType.AddSkillVit,this.actid,vitse;}cc出手帧索敌攻击帧索敌d在子弹射出弓箭射出砍刀砍下的时候索敌行为cc如果当前敌人活着直接攻击当前目标否则重新索敌一次如果索到敌人则面向目标否则直接技能结束epublicAttackRetargetdtargetType:number,maxCount:number,targetSortType:number,enemyType:number,landTypeArray:number[],heroTypeArray:number[],bFakeHP:numbere{cc优先判断当前目标是否活着letnewTargetIdArray:number[]=[];fordlettargetIdofthis.currentTargetArraye{lettargetHeroData=this.world.logicHeroManager.GetHeroDatadtargetIde;ifdtargetHeroData!=null&&targetHeroData.hpb0&&targetHeroData.fakeHPb0enewTargetIdArray.pushdtargetIde;}this.currentTargetArray=newTargetIdArray;cc当前目标已经死亡重新索敌ifdthis.currentTargetArray.length==0e{this.ReTarget2dtargetType,maxCount,targetSortType,enemyType,landTypeArray,heroTypeArray,bFakeHPe;}ifdthis.currentTargetArray.length==0ecc如果找不到目标直接退出技能this.EnddtargetTypee;elsecc面向目标{SNetWar.FireEventdGlobalEventType.FaceToTarget,this.entity.id,this.currentTargetArray[0]e;ccSNetWar.FireEventdGlobalEventType.AddSkillVit,this.actid,vitse;}}publicReTargetdtargetType:numbere{lettemplate=this.template;this.ReTarget2dtargetType,template.targetCount,template.targetSortType,template.enemyType,template.landTypeArray,template.heroTypeArray,1e;}publicCheckTargetValidde:boolean{fordletidofthis.currentTargetArraye{lettargetData=this.world.logicHeroManager.GetHeroDatadide;ifdtargetData!=null&&targetData.hpb0ecc有合法目标{returntrue;}}returnfalse;}publicAddEnergydtargetType:number,count:numbere{letplayerComp=aRealPlayerComponentbthis.world.GetCompByIDdthis.entity.pid,ComponentType.RealPlayerComponente;playerComp.AddEnergydcounte;}publicHurtLimitdtargetType:number,count:numbere{this.effectLimit=count;}publicCreateCircleAreadtargetType:number,dx:number,dy:number,radius:number,areaKey:string,posKey:stringe{letareaComp=this.CreateAreadtargetType,dx,dy,areaKey,posKeye;ifdareaComp!=nulle{areaComp.type=1;areaComp.radius=radius;areaComp.InitRenderde;}else{thread.errord"---CreateCircleArea-areaCompisnull-"e;}}ccx方向为widthy方向为heightdTODONIU矩形区域还要测试epublicCreateRectAreadtargetType:number,dx:number,dy:number,width:number,height:number,areaKey:string,posKey:stringe{letareaComp=this.CreateAreadtargetType,dx,dy,areaKey,posKeye;ifdareaComp!=nulle{areaComp.type=2;areaComp.width=width;areaComp.height=height;}else{thread.warnd"---CreateRectArea-areaCompisnull-"e;}}publicAreaMovedtargetType:number,moveType:number,angle:number,dis:number,time:number,areaKey:stringe{letareaComp=this.GetAreaCompdareaKeye;ifdareaComp==nulle{thread.warnd"_____areahasdestroyed!!!__________",this.ide;return;}lettrans=areaComp.trans;ifdmoveType==1ecc指向目标的方向{ifdthis.currentTargetArray.length==0ereturn;lettarget=this.world.logicHeroManager.GetHerodthis.currentTargetArray[0]e;ifdtarget==nullereturn;lettargetTrans=aTransformComponentbtarget.GetCompdComponentType.TransformComponente;ifdtargetTrans==nullereturn;letdir=targetTrans.pos.copyde.subtractdtrans.pose.normalizede;lettargetPos=trans.pos.copyde.addddir.scaleddisee;ifdangle!=0e{let[tx,ty]=MathUtil.RotatePointdtargetPos.x,targetPos.y,trans.pos.x,trans.pos.y,anglee;targetPos.x=tx;targetPos.y=ty;}cc限制目标点别出界了targetPos=LogicWarUtil.ClampTargetPosdtrans.pos,targetPose;trans.SetTargetPosdtargetPos,targetPos,0e;trans.moveSpeedBase=disctime*1000;trans.moveable=true;}elseifdmoveType==2ecc正前方方向{lettargetPos=trans.pos.copyde;targetPos.x+=dis;cc限制目标点别出界了targetPos=LogicWarUtil.ClampTargetPosdtrans.pos,targetPose;trans.SetTargetPosdtargetPos,targetPos,0e;trans.moveSpeedBase=disctime*1000;trans.moveable=true;}}publicDelAreadtargetType:number,key:stringe{this.DestroyOneAreadkeye;}publicSetAreaEffectTypedtargetType:number,buffType:number,key:stringe{letareaComp=this.GetAreaCompdkeye;ifdareaComp==nulle{thread.warnd"___SetAreaEffectType__areahasdestroyed!!!__________",this.ide;return;}areaComp.buffType=buffType;}publicSetAreaTargetCountdtargetType:number,count:number,key:stringe{letareaComp=this.GetAreaCompdkeye;ifdareaComp==nulle{thread.warnd"___SetAreaTargetCount__areahasdestroyed!!!__________",this.ide;return;}areaComp.targetCount=count;}publicLockHerodtargetType:numbere{ifd!this.lockHeroAIe{this.lockHeroAI=true;cc触发攻击时触发的技能letheroData=aHeroDataComponentbthis.entity.GetCompdComponentType.HeroDataComponente;SkillCB.RunOnBeginAttackCBdheroDatae;}}publicUnlockHerodtargetType:numbere{this.lockHeroAI=false;cc触发攻击结束时的技能letheroData=aHeroDataComponentbthis.entity.GetCompdComponentType.HeroDataComponente;SkillCB.RunOnStopAttackCBdheroDatae;}cc过滤目标publicSelectTargetdtargetType:number,maxCount:number,targetSortType:number,enemyType:number,landTypeArray:number[],heroTypeArray:number[],bFakeHP:numbere{cc过滤目标从当前目标列表里面过滤掉letlastTargetArray=this.currentTargetArray;lettargetArray:LogicEntity[]=[];fordletlastIDoflastTargetArraye{letentity=this.world.logicHeroManager.GetHerodlastIDe;ifdentity!=nulletargetArray.pushdentitye;}cc重新索敌letareaCompArray=this.GetAllAreaCompde;ifdareaCompArray.lengthb0e{letlastTargetArray=this.currentTargetArray;lettargetMap:SMapanumber,numberb=newSMapanumber,numberbde;cc所有区域目标的合集fordletareaCompofareaCompArraye{lettempArray=areaComp.GetTargetsdmaxCount,targetSortType,enemyType,landTypeArray,heroTypeArray,targetArray,bFakeHP==1e;fordlettargetIdoftempArrayetargetMap.setdtargetId,areaComp.ide;}this.currentTargetArray=targetMap.copykeysde;targetMap.clearde;}elsethis.currentTargetArray=this.template.GetTargets2dthis.entity,maxCount,targetSortType,enemyType,landTypeArray,heroTypeArray,targetArray,bFakeHP==1e;ccTODONIU这里暂时就不转发受击列表到渲染层了cc因为需要过滤目标处理的都是击退这类型的效果cc如果是伤害值不同的话直接走damage表处理就好ccletvits:number[]=[];ccfordletidofthis.currentTargetArrayeccvits.pushdide;ccSNetWar.FireEventdGlobalEventType.AddSkillVit,this.actid,vitse;}cc延迟时间publicSetDelayFramedtargetType:number,frame:numbere{this.delayFrame=Math.floordframee;}cc保存位置点publicSetPosInCachedtargetType:number,key:stringe{letpos=this.GetPosByTypedtargetTypee;this.posCache.setdkey,pos.copydee}cc计算距离publicGetDisancedfromType:number,toType:numbere:number{letpos1=this.GetPosByTypedfromTypee;letpos2=this.GetPosByTypedtoTypee;ifdpos1!=null&&pos2!=nulle{returnMathUtil.distancedpos1,pos2e;}else{thread.errord"SkillDataBaseGetDisanceerror:",this.id,fromType,toTypee;}return0;}publicGetFlySpeedde:number{ifdthis.template.flySpeed==null||this.template.flySpeed==0e{thread.errord"GetFlySpeederror:",this.ide;return150;}elsereturnthis.template.flySpeed;}cc强制移动到指定位置publicForceMoveTodtargetType:number,x:number,y:numbere{lettargetList=this.GetTargetsByTypedtargetTypee;lettarget:LogicEntity;lettargetTrans:TransformComponent;fordlettargetIdoftargetListe{target=this.world.logicHeroManager.GetHerodtargetIde;targetTrans=aTransformComponentbtarget.GetCompdComponentType.TransformComponente;ifdtargetTrans!=nulletargetTrans.forceTargetPos=newVector2d[x,y]e;}}cc发送指令到渲染层publicSendCMDToMagicdtargetType:number,key:string,type:number,value:anye{ifdtype==DataType.Inte{value=Numberdvaluee;}SNetWar.FireEventdGlobalEventType.SendLogicCMD,this.actid,key,valuee;}cc调用法术publicStartMagicdtargetType:number,id:number,key:string,areaKey:stringe{ifdthis.magicMap.hasdkeyee{thread.errord"SkillDataBase.CallMagickeyrepeat!!!",key,ide;this.StopMagicdtargetType,keye;}letactid=this.world.NewFightIDde;this.magicMap.setdkey,actide;letareaComp=this.GetAreaCompdareaKeye;ifdareaComp!=nulle{areaComp.magic_actid=actid;SNetWar.FireEventdGlobalEventType.DoSpellRender,id,actid,areaComp.trans.pos.toArrayde,areaComp.trans.targetPos.toArrayde,1e;}else{SNetWar.FireEventdGlobalEventType.DoSpellRender,id,actid,[0,0],[0,0],1e;}}publicStopMagicdtargetType:number,key:stringe{ifd!this.magicMap.hasdkeyeereturn;letactid=this.magicMap.getdkeye;SNetWar.FireEventdGlobalEventType.StopSkillRender,actide;}ccpublicEnddtargetType:numbere{this.BreakSkillde;}}}﻿moduleECS{exportclassSkillFlowItem{cc法术要用的数据publicstartFrame:number;publicendFrame:number;publicframeCD:number;cc技能要用的数据publicframe:number;publiclockHero:boolean;publicdelayType:number;publicfuncArray:Function[];publicfuncNameArray:string[];publictype:string;publicactid:number;cc是否已经执行完毕privateisDone:boolean;publicconstructorde{this.funcArray=newArrayaFunctionbde;this.funcNameArray=[];this.isDone=false;}publicInitde{this.funcArray=newArrayaFunctionbde;this.isDone=false;this.actid=IDManager.NewKeyIDde;}publicDisposede{this.funcArray.length=0;this.funcNameArray.length=0;this.isDone=false;}publicAddFuncdfunc:Function,name:stringe{this.funcArray.pushdfunce;this.funcNameArray.pushdnamee;}publicGetRealFramedattackSpeedUp:number,delayFrame:numbere{letrealFrame=0;cc攻击加成后的帧letframe=this.frame;ifdthis.delayType==1ecc是否需要延迟frame+=delayFrame;ifdattackSpeedUp==1e{realFrame=frame;}else{realFrame=Math.floordframecattackSpeedUp+0.5e;cc攻速加成后四舍五入ifdframe%1b0erealFrame=realFrame-MathConst.FrameError;}returnrealFrame;}cc返回true表示这一帧行为执行了cc返回false表示未执行publicExecdnowFrame:number,skobj:SkillDataBase,attackSpeedUp:number=1e:boolean{ccifdthis.isDoneeccreturntrue;letrealFrame=0;cc攻击加成后的帧ifdattackSpeedUp==1e{realFrame=this.frame;}else{realFrame=Math.floordthis.framecattackSpeedUp+0.5e;cc攻速加成后四舍五入ifdthis.frame%1b0erealFrame=realFrame-MathConst.FrameError;}ifdnowFrameb=realFramee{ccthread.logd"--------------bbbbbbbbbbbbbbbbbbb---------",this.frame,realFramee;this.isDone=true;fordletfuncofthis.funcArraye{funcdskobje;}returntrue;}returnfalse;}publicExec2dskobj:SkillDataBase,who:HeroDataComponent,target:HeroDataComponente{fordletfuncofthis.funcArraye{funcdskobj,who,targete;}}}exportclassSkillDataTemplate{publicactid:number;publicid:number;publiclv:number;cc技能等级publicname:string;publictriggerTypeArray:any[];cc触发方式publicbreakTypeArray:number[];cc打断方式publicprobability:number;cc触发概率protectedoriginCD:number;protectedcdSource:number;ccCD源protectedcdSourceSkill:SkillDataTemplate;protectedcd:number;publictargetCount:number;cc目标数目publictargetSortType:number;cc排序方式publicenemyType:number;cc敌我类型publicattackCurrent:number;cc是否优先攻击当前目标publiclandTypeArray:number[];cc空地类型publicheroTypeArray:number[];cc兵种类型publicatkDis:number;cc攻击距离publicwarnDis:number;cc警戒距离publicaddHeroId:number;publicflySpeed:number;publicbuffId:number;publiclogicFlowID:number;cc技能流程IDpublicmagicID:number;cc法术流程IDpublicskillFlowArray:SkillFlowItem[]=[];publicskillType:number=0;publicisLockHero:boolean;publichasDelayFrame:boolean;cc是否有延迟的帧cc加速protectedattackSpeedUp:number;publicconstructordskData:game.SkillDataItem,world:WorldBaseaEntityBasebe{this.id=skData.id;this.lv=skData.lv;this.InitdskData,worlde;}publicInitdskData:game.SkillDataItem,world:WorldBaseaEntityBasebe{this.actid=world.NewFightIDde;this.name=skData.name;this.triggerTypeArray=skData.triggerTypeArray;this.breakTypeArray=skData.breakTypeArray;this.probability=skData.probability;this.originCD=skData.cd;this.cdSource=skData.cdSource;this.cd=0;this.targetCount=skData.targetCount;this.targetSortType=skData.targetSortType;this.enemyType=skData.enemyType;this.attackCurrent=skData.attackCurrent;this.landTypeArray=skData.landTypeArray;this.heroTypeArray=skData.heroTypeArray;this.atkDis=skData.atkDis;this.warnDis=skData.warnDis;this.addHeroId=skData.addHeroId;this.flySpeed=skData.flySpeed;this.buffId=skData.buffId;this.logicFlowID=skData.logicFlowID;this.magicID=skData.magicID;this.isLockHero=false;this.hasDelayFrame=false;this.skillType=skData.skillType;this.attackSpeedUp=1;cc法术流程不受攻速buff等影响ifd!LogicWarUtil.IsSpelldthis.ideethis.InitHeroSkillFlowde;elsecc法术this.InitSpellFlowde;}publicDisposede{fordletflowItemObjofthis.skillFlowArraye{WarFactory.DestroyObjectdflowItemObj,ObjectType.SkillFlowItem,nulle;}this.skillFlowArray.length=0;this.cdSourceSkill=null;}publicInitCDSourcedtemplateDict:SMapanumber,SkillDataTemplatebe{letcdSource=this.cdSource;ifdcdSource==0||cdSource==this.idethis.cdSourceSkill=this;else{this.cdSourceSkill=templateDict.getdcdSourcee;ifdthis.cdSourceSkill==nulle{thread.errord"InitCDSourceerror:",this.id,this.cdSourcee;this.cdSourceSkill=this;}}}cc剩余CD时间publicGetCDde:number{returnthis.cdSourceSkill.cd;}publicResetdattackSpeedUp:numbere{ifdthis.cdSourceSkill!=nulle{this.cdSourceSkill.cd=Math.floordthis.originCDcattackSpeedUpe;this.cdSourceSkill.attackSpeedUp=attackSpeedUp;}else{thread.errord"SkillDataTemplateResetError:",this.id,this.cdSourcee;}}publicUpdateCDddeltalTime:numbere{this.cd-=deltalTime;ifdthis.cda0ethis.cd=0;}cc概率触发privateCheckSkillValiddargs:any,args2:anye{letfunc:Function=args[0];letthisObj:any=args[1];letentity=args[2];ifdthis.IsSkillValiddentitye==SkillFailType.Noneefunc.calldthisObj,[this.id,this.lv]e;}publicInitTriggerdheroData:HeroDataComponent,func:Function,thisObj:anye{letkey=BigType.SkillTrigger+this.actid;fordletargsofthis.triggerTypeArraye{lettype=args[0];ifdtype==TriggerType.Diee{SkillCB.AddOnDieCBdheroData,key,de=b{heroData.hp=1;letstateComp=aStateComponentbheroData.entity.GetCompdComponentType.StateComponente;stateComp.AddStatedMathConst.SoulMagicID,0,nulle;cc进入灵魂状态this.CheckSkillValidd[func,thisObj,heroData.entity],nulle;heroData.hp=0;},thise;}elseifdtype==TriggerType.BeginAttacke{SkillCB.AddOnBeginAttackCBdheroData,key,this.CheckSkillValid,this,[func,thisObj,heroData.entity]e;}elseifdtype==TriggerType.StopAttacke{SkillCB.AddOnStopAttackCBdheroData,key,this.CheckSkillValid,this,[func,thisObj,heroData.entity]e;}elseifdtype==TriggerType.Entere{SkillCB.AddOnEnterCBdheroData,key,this.CheckSkillValid,this,[func,thisObj,heroData.entity]e;}elseifdtype==TriggerType.HPLowere{SkillCB.AddOnHPChangeCBdheroData,key,de=b{letvalue=args[1];letpercent=heroData.hpcheroData.hpmax*100;ifdheroData.hpb0&&percenta=valueethis.CheckSkillValidd[func,thisObj,heroData.entity],nulle;},thise;}elseifdtype==TriggerType.HPHighere{SkillCB.AddOnHPChangeCBdheroData,key,de=b{letvalue=args[1];letpercent=heroData.hpcheroData.hpmax*100;ifdheroData.hpb0&&percentb=valueethis.CheckSkillValidd[func,thisObj,heroData.entity],nulle;},thise;}elseifdtype==TriggerType.BeDamagede{SkillCB.AddOnSkillBeDamagedCBdheroData,key,this.CheckSkillValid,this,[func,thisObj,heroData.entity]e;}elseifdtype==TriggerType.MakeDamagee{SkillCB.AddOnSkillDamageCBdheroData,key,this.CheckSkillValid,this,[func,thisObj,heroData.entity]e;}elseifdtype==TriggerType.KillHeroe{SkillCB.AddOnKillHeroCBdheroData,key,this.CheckSkillValid,this,[func,thisObj,heroData.entity]e;}elseifdtype==TriggerType.UpdateChecke{}}}publicDisposeTriggerdheroData:HeroDataComponente{letkey=BigType.SkillTrigger+this.actid;SkillCB.RemoveOnDieCBdheroData,keye;SkillCB.RemoveOnBeginAttackCBdheroData,keye;SkillCB.RemoveOnStopAttackCBdheroData,keye;SkillCB.RemoveOnEnterCBdheroData,keye;SkillCB.RemoveOnHPChangeCBdheroData,keye;SkillCB.RemoveOnSkillBeDamagedCBdheroData,keye;SkillCB.RemoveOnSkillDamageCBdheroData,keye;SkillCB.RemoveOnKillHeroCBdheroData,keye;}publicIsSkillValiddentity:LogicEntitye:number{ifdthis.GetCDdeb0ereturnSkillFailType.SkillCD;ifdthis.GetTargetsdentitye.length==0ereturnSkillFailType.TargetInvalid;ifdthis.probabilitya100e{letrand=entity.world.GetRandomRanged1,100e;ifdrandbthis.probabilityereturnSkillFailType.Probability;}returnSkillFailType.None;}ccai索敌只找最近的publicGetAITargetdentity:LogicEntitye:number{letmyHeroData=aHeroDataComponentbentity.GetCompdComponentType.HeroDataComponente;letmyTrans=aTransformComponentbentity.GetCompdComponentType.TransformComponente;letthisObj=this;cc属性过滤functionattrFileterdtargetData:HeroDataComponente:boolean{ifdthisObj.landTypeArray.indexOfdtargetData.landTypeea=-1ereturnfalse;ccAI索敌的时候对于嘲讽目标忽略类型判断直接攻击ifdtargetData.id!=myHeroData.sarcasmTargetID&&thisObj.heroTypeArray.indexOfdtargetData.heroTypeea=-1ereturnfalse;returntrue;}cc固定位置建筑和兵种的索敌范围过滤函数functiontowerTransFilterdtargetTrans:TransformComponent,targetData:HeroDataComponente:boolean{ifdLogicWarUtil.IsKingTowerdmyHeroData.shapeeecc国王塔攻击范围是矩形{lettargetPos=targetTrans.pos;cc我的攻击范围是我方区域内cc判断敌方单位是否在我的敌方区域范围内d在我的敌方区域内就表示不在我的区域内也就不在我的攻击范围内eletareaType=myHeroData.world.warContainer.IsInEnemyLockAreadtargetPos.x,targetPos.y,myHeroData.atkType,MathConst.MapCellSizee;ifdareaType==0e{letdis=LogicWarUtil.GetDistancedmyTrans,targetTranse;targetData.toTargetDis=dis;cc记录距离后面排序用的returntrue;}elsereturnfalse;}else{letdis=LogicWarUtil.GetDistancedmyTrans,targetTranse;ifddisbthisObj.atkDisecc固定不动的建筑超出攻击距离就不管了{returnfalse;}targetData.toTargetDis=dis;cc记录距离后面排序用的returntrue;}}cc可移动兵种的索敌范围过滤函数functionheroTransFilterdtargetTrans:TransformComponent,targetData:HeroDataComponente:boolean{letdis=LogicWarUtil.GetDistancedmyTrans,targetTranse;ifddisbthisObj.warnDisecc超过警戒范围不处理{returnfalse;}ifddisa=thisObj.atkDise{targetData.toTargetDis=dis;cc记录距离后面排序用的myTrans.pos.copydtargetData.tempPose;cc记录可用的站位信息myHeroData.hasValidTarget=true;returntrue;}ifdmyHeroData.hasValidTargetecc如果攻击范围内有可直接攻击的敌人就不找八方向站位了returnfalse;cc找到可用的站位信息d目标点为中心atkDis+range为半径的圆找站位点eletatkDis=thisObj.atkDis+targetTrans.range;letvalidPos=myTrans.GetNearestTargetPosdtargetTrans.pos,atkDise;ifdvalidPos==nullecc无可用的站位信息returnfalse;letdis2=MathUtil.distancedmyTrans.pos,validPose;ccifdmyTrans.id==1016&&targetData.id==1015ecc{ccthread.logd`-----1016-b1015-------dis2:${Math.sqrtddis2e.toFixedd1e}---pos:${validPos.tostringde}-targetPos:${targetTrans.pos.tostringde}-frame:${entity.world.frameCount}`e;cc}ccifdmyTrans.id==1016&&targetData.id==1017ecc{ccthread.logd`-----1016-b1017-------dis2:${Math.sqrtddis2e.toFixedd1e}---pos:${validPos.tostringde}-targetPos:${targetTrans.pos.tostringde}-frame:${entity.world.frameCount}`e;cc}ccifdmyTrans.id==1033&&targetData.id==1019ecc{ccthread.logd`-----1033-b1019-------dis2:${Math.sqrtddis2e.toFixedd1e}---pos:${validPos.tostringde}-targetPos:${targetTrans.pos.tostringde}-frame:${entity.world.frameCount}`e;cc}ccifdmyTrans.id==1015&&targetData.id==1033ecc{ccthread.logd`-----1015-b1033-------dis2:${Math.sqrtddis2e.toFixedd1e}---pos:${validPos.tostringde}-targetPos:${targetTrans.pos.tostringde}-frame:${entity.world.frameCount}`e;cc}cc记录距离后面排序用的d加上一个很大的数字表示站位距离优先级低于可直接攻击距离优先级etargetData.toTargetDis=MathConst.MaxDistance+dis2;validPos.copydtargetData.tempPose;cc记录可用的站位信息returntrue;}lettargetArray=entity.world.logicHeroManager.GetAllTargetdthis.enemyType,myHeroData.campType,truee;myHeroData.hasValidTarget=false;cc构建参数letfindArgs=newFindTargetArgsde;findArgs.campType=myHeroData.campType;findArgs.srcTrans=myTrans;findArgs.srcHeroData=myHeroData;findArgs.targetArray=targetArray;findArgs.attrFileterFunc=attrFileter;findArgs.thisObj=this;ifdmyTrans.moveSpeed==0||myHeroData.forbidMoveCountb0ecc固定建筑或者被定身了只找范围内的敌人{findArgs.transFilterFunc=towerTransFilter;}else{findArgs.transFilterFunc=heroTransFilter;}returnFindUtils.GetAITargetdfindArgse;}publicGetTargetsdentity:LogicEntitye:Arrayanumberb{returnthis.GetTargets2dentity,this.targetCount,this.targetSortType,this.enemyType,this.landTypeArray,this.heroTypeArray,null,truee;}publicGetTargets2dentity:LogicEntity,maxCount:number,targetSortType:number,enemyType:number,landTypeArray:number[],heroTypeArray:number[],targetArray:LogicEntity[],bFakeHP:booleane:Arrayanumberb{ifdheroTypeArray.indexOfdHeroType.MySelfeb-1e{return[entity.id];}letmyTrans=aTransformComponentbentity.GetCompdComponentType.TransformComponente;letmyHeroData=aHeroDataComponentbentity.GetCompdComponentType.HeroDataComponente;ifdmyTrans==null||myHeroData==nulle{thread.errord"SkillDataTemplate.GetTargets2error:",this.ide;return[];}letthisObj=this;cc攻击范围过滤functiontransFilterdtargetTrans:TransformComponent,targetData:HeroDataComponente:boolean{ifdLogicWarUtil.IsKingTowerdmyHeroData.shapeeecc国王塔攻击范围是矩形{lettargetPos=targetTrans.pos;cc我的攻击范围是我方区域内cc判断敌方单位是否在我的敌方区域范围内d在我的敌方区域内就表示不在我的区域内也就不在我的攻击范围内eletareaType=myHeroData.world.warContainer.IsInEnemyLockAreadtargetPos.x,targetPos.y,myHeroData.atkType,MathConst.MapCellSizee;ifdareaType==0e{letdis=LogicWarUtil.GetDistancedmyTrans,targetTranse;targetData.toTargetDis=dis;cc记录距离后面排序用的returntrue;}elsereturnfalse;}else{letdis=LogicWarUtil.GetDistancedmyTrans,targetTranse;ifddisa=thisObj.atkDis+MathConst.attackErroDisecc允许有误差范围{targetData.toTargetDis=dis;cc记录距离后面排序用的returntrue;}returnfalse;}}cc属性过滤functionattrFileterdtargetData:HeroDataComponente:boolean{ifdlandTypeArray.indexOfdtargetData.landTypeea=-1ereturnfalse;ifdheroTypeArray.indexOfdtargetData.heroTypeea=-1ereturnfalse;returntrue;}ifdthis.attackCurrent==1&&myHeroData.targetID!=0ecc当需要优先攻击当前目标时{lettarget=entity.world.logicHeroManager.GetHerodmyHeroData.targetIDe;ifdtarget!=nulle{cc构建参数letfindArgs=newFindTargetArgsde;findArgs.campType=myHeroData.campType;findArgs.srcTrans=myTrans;findArgs.srcHeroData=myHeroData;findArgs.targetArray=[target];findArgs.maxCount=maxCount;findArgs.transFilterFunc=transFilter;findArgs.attrFileterFunc=attrFileter;findArgs.thisObj=this;findArgs.sortType=targetSortType;letidArray=FindUtils.GetTargetsdfindArgse;ifdidArray.lengthb0ereturnidArray;}}ifdtargetArray==nulletargetArray=entity.world.logicHeroManager.GetAllTargetdenemyType,myHeroData.campType,bFakeHPe;ccifdentity.id==1005ecc{ccfordlettargetoftargetArrayecc{cclettargetHeroData=aHeroDataComponentbtarget.GetCompdComponentType.HeroDataComponente;ccifdLogicWarUtil.IsTowerdtargetHeroData.shapeeecccontinue;ccthread.logd`1005索敌${target.id}hp:${targetHeroData.hp}fakeHP:${targetHeroData.fakeHP}---------------------`e;cc}cc}cc构建参数letfindArgs=newFindTargetArgsde;findArgs.campType=myHeroData.campType;findArgs.srcTrans=myTrans;findArgs.srcHeroData=myHeroData;findArgs.targetArray=targetArray;findArgs.maxCount=maxCount;findArgs.transFilterFunc=transFilter;findArgs.attrFileterFunc=attrFileter;findArgs.thisObj=this;findArgs.sortType=targetSortType;returnFindUtils.GetTargetsdfindArgse;}publicGetDamagedwho:HeroDataComponent,target:HeroDataComponent,damageID:number=0e:number{letkey=this.id*100+this.lv;letdamageInfo=Data.damage[key];ifddamageInfo==nulle{key=this.id*100+1;damageInfo=Data.damage[key];}ifddamageInfo==nulle{thread.warnd"skillhasnodamageid:",this.id,this.lve;return0;}ifddamageID==0edamageID=target.heroType;letfunc=damageInfo[damageID];func=func?func:damageInfo[0];ifdfunc==nulle{thread.warnd"skillhasnodamageid:",this.ide;return0;}returnfuncdwho,target,thise*GameData.DamageAdddition;}cc英雄技能流程publicInitHeroSkillFlowde{letarray=data_logicflow[this.logicFlowID];ifdarray==nulle{thread.warnd"cannotfindskillflow:",this.logicFlowIDe;return;}letstartFrame,endFrame,frameCD,delayType;letframeInfo,func;letframeNum=0;letlockHero,type,funcName;letflowItemObj:SkillFlowItem;letflowMap:SMapanumber,SkillFlowItemb=newSMapanumber,SkillFlowItembde;letfirstSortIndex:number=0;letsecondSortIndex:number=0;letcombineSortIndex:number=0;fordletitemofarraye{secondSortIndex++;frameInfo=item["frame"];func=item["action"];lockHero=item["lockhero"];cc这个是在python导表的时候添加的属性ifdlockHeroethis.isLockHero=lockHero;type=item["type"];cc这个是在python导表的时候添加的属性行为类型funcName=LogicActionName[type];startFrame=frameInfo[0];endFrame=frameInfo[1];frameCD=Math.maxdframeInfo[2],1e;delayType=frameInfo[3];ifddelayType==1ethis.hasDelayFrame=true;fordleti=startFrame;ia=endFrame;i+=frameCDe{frameNum=i;ifdtype==LogicActionType.UnlockHeroe{frameNum=frameNum-MathConst.FrameError;cc解除锁定的帧放到前一帧的末尾执行}firstSortIndex=frameNum;combineSortIndex=firstSortIndex*1000000+secondSortIndex;ifd!flowMap.hasdcombineSortIndexee{flowItemObj=WarFactory.CreateObjectdObjectType.SkillFlowItem,null,nulle;flowItemObj.Initde;flowItemObj.frame=frameNum;flowItemObj.lockHero=lockHero;flowItemObj.type=type;flowItemObj.delayType=delayType;flowMap.setdcombineSortIndex,flowItemObje;}flowMap.getdcombineSortIndexe.AddFuncdfunc,funcNamee;}}letkeys=flowMap.keysde;keys.sortdda,be=b{ifdaabereturn-1;elsereturn1;}ethis.skillFlowArray=newArrayaSkillFlowItembde;fordletkeyofkeyse{this.skillFlowArray.pushdflowMap.getdkeyee;}flowMap.clearde;}cc法术流程publicInitSpellFlowde{letarray=data_logicflow[this.logicFlowID];ifdarray==nulle{thread.warnd"cannotfindskillflow:",this.logicFlowIDe;return;}letstartFrame,endFrame,frameCD,delayType;letframeInfo;letfunc:Function;letframeNum=0;lettype,funcName;letflowItemObj:SkillFlowItem;letflowMap:SMapanumber,SkillFlowItemb=newSMapanumber,SkillFlowItembde;letfirstSortIndex:number=0;letsecondSortIndex:number=0;letcombineSortIndex:number=0;fordletitemofarraye{secondSortIndex++;frameInfo=item["frame"];func=item["action"];type=item["type"];cc这个是在python导表的时候添加的属性行为类型funcName=LogicActionName[type];startFrame=frameInfo[0];endFrame=frameInfo[1];frameCD=Math.maxdframeInfo[2],1e;delayType=frameInfo[3];ifddelayType==1ethis.hasDelayFrame=true;fordleti=startFrame;ia=endFrame;i+=frameCDe{firstSortIndex=i;combineSortIndex=firstSortIndex*1000000+secondSortIndex;frameNum=i;ifd!flowMap.hasdcombineSortIndexee{flowItemObj=WarFactory.CreateObjectdObjectType.SkillFlowItem,null,nulle;flowItemObj.Initde;flowItemObj.frame=frameNum;flowItemObj.type=type;flowItemObj.delayType=delayType;flowMap.setdcombineSortIndex,flowItemObje;}flowMap.getdcombineSortIndexe.AddFuncdfunc,funcNamee;}}letkeys=flowMap.keysde;keys.sortdda,be=b{ifdaabereturn-1;elsereturn1;}ethis.skillFlowArray=newArrayaSkillFlowItembde;fordletkeyofkeyse{this.skillFlowArray.pushdflowMap.getdkeyee;}flowMap.clearde;}}}﻿moduleECS{exportinterfaceSkillInterface{startPos:Vector2;endPos:Vector2;AddBuffdtargetType:number,buffID:numbere;DelBuffdtargetType:number,buffID:numbere;SetDamagedtargetType:number,damageID:numbere;FakeDamagedtargetType:number,damageID:numbere;AddSpelldtargetType:number,spellID:number,dx:number,dy:numbere;AddHerodtargetType:number,heroID:number,dx:number,dy:numbere;ReTargetdtargetType:numbere;ReTarget2dtargetType:number,maxCount:number,targetSortType:number,enemyType:number,landTypeArray:number[],heroTypeArray:number[],bFakeHP:numbere;AttackRetargetdtargetType:number,maxCount:number,targetSortType:number,enemyType:number,landTypeArray:number[],heroTypeArray:number[],bFakeHP:numbere;SelectTargetdtargetType:number,maxCount:number,targetSortType:number,enemyType:number,landTypeArray:number[],heroTypeArray:number[],bFakeHP:numbere;CheckTargetValidde:boolean;AddEnergydtargetType:number,count:numbere;HurtLimitdtargetType:number,count:numbere;CreateCircleAreadtargetType:number,dx:number,dy:number,radius:number,areaKey:string,posKey:stringe;CreateRectAreadtargetType:number,dx:number,dy:number,width:number,height:number,areaKey:string,posKey:stringe;AreaMovedtargetType:number,moveType:number,angle:number,dis:number,time:number,areaKey:stringe;DelAreadtargetType:number,key:stringe;SetAreaEffectTypedtargetType:number,areaType:number,key:stringe;SetAreaTargetCountdtargetType:number,count:number,key:stringe;LockHerodtargetType:numbere;UnlockHerodtargetType:numbere;SetEffectCountdtargetType:number,count:numbere;SetDelayFramedtargetType:number,frame:numbere;SetPosInCachedtargetType:number,posKey:stringe;GetDisancedfromType:number,toType:numbere:number;GetFlySpeedde:number;SendCMDToMagicdtargetType:number,key:string,type:number,value:anye;StartMagicdtargetType:number,id:number,key:string,areaKey:stringe;StopMagicdtargetType:number,key:stringe;EnddtargetType:numbere;}}﻿cccareferencepath="SkillDataBase.ts"cbmoduleECS{exportclassSpellSkillDataextendsSkillDataBase{privateskillFlowMap:SMapanumber,SkillFlowItemb;privatestartFrame:number;publicendFrame:number;cc结束帧策划配表来控制每个法术不同等级的时候持续时间publicconstructorde{superde;}publicGetDatade:any{letself=this;letdataArray:any[]=[self.id,self.actid,game.Utils.ArrayCopydself.lockedTargetArraye,game.Utils.ArrayCopydself.currentTargetArraye,self.attackSpeedUp,self.effectLimit,self.lockHeroAI,Math.floordself.startPos.x*100000e,Math.floordself.startPos.y*100000e,Math.floordself.endPos.x*100000e,Math.floordself.endPos.y*100000e,self.delayFrame,self.startFrame,self.endFrame];letdata:any[]=[];letkeys=self.areaMap.keysde;fordletkeyofkeyse{letvalue=self.areaMap.getdkeye;data.pushd[key,value]e;}dataArray.pushddatae;data=[];letkeys1=self.magicMap.keysde;fordletkeyofkeys1e{letvalue=self.magicMap.getdkeye;data.pushd[key,value]e;}dataArray.pushddatae;data=[];letkeys2=self.posCache.keysde;fordletkeyofkeys2e{letvalue=self.posCache.getdkeye;data.pushd[key,Math.floordvalue.x*100000e,Math.floordvalue.y*100000e]e;}dataArray.pushddatae;data=[];letkeys3=self.effectInfoDict.keysde;fordletkeyofkeys3e{letvalue=self.effectInfoDict.getdkeye;letdata1:number[]=[];fordletkey1ofvalue.valueInfo.keysdee{letvalue1=value.valueInfo.getdkey1e;data1=[key1,value1[0],value1[1]];}data.pushd[key,value.id,value.areaId,data1,value.buffType]e;}dataArray.pushddatae;returndataArray;}publicInitdtemplate:SkillDataTemplate,entity:LogicEntitye{super.Initdtemplate,entitye;this.startFrame=this.world.frameCount;cc初始化技能流this.skillFlowMap=newSMapanumber,SkillFlowItembde;letflowArray=this.template.skillFlowArray;fordleti=0;iaflowArray.length;i++e{this.skillFlowMap.setdi,flowArray[i]e;}SNetWar.FireEventdGlobalEventType.ForceSyncRenderPos,entity.ide;ccthis.ReTargetd0e;cc法术暂时不索敌}publicStartMagicde{letmagicID=this.template.magicID;SNetWar.FireEventdGlobalEventType.DoSpellRender,magicID,this.actid,this.startPos.toArrayde,this.endPos.toArrayde,1e;}publicBreakSkillde{this.skillFlowMap.clearde;}publicUpdatede{super.Updatede;ifdthis.skillFlowMap.size==0ecc所有指令已经执行完毕return;letnowFrame=this.world.frameCount-this.startFrame;letindexArray=this.skillFlowMap.copykeysde;letflowItem:SkillFlowItem;letwho=this.GetHeroDataByTypedTargetType.Atte;lettarget=this.GetHeroDataByTypedTargetType.Vite;fordletindexofindexArraye{ifdthis.IsSkillEnddeebreak;flowItem=this.skillFlowMap.getdindexe;ifdflowItem==nulle{thread.errord"-----SpellSkillData.UpateflowItemisnull---------",this.ide;continue;}letrealFrame=flowItem.GetRealFramed1,this.delayFramee;ccthread.logdthis.world.frameCount,"--------------bbbbbbbbbbb",realFrame,nowFrame,"_----------------bbbbbbbbbbbbb",this.flowExecIndexe;ifdnowFrameb=realFramee{flowItem.Exec2dthis,who,targete;this.skillFlowMap.deletedindexe;cc执行过的指令删除}else{}}}cc技能流程执行完了就视为技能结束了publicIsSkillEndde:boolean{returnthis.skillFlowMap.size==0;}}}﻿moduleECS{exportclassStateDataBase{publicid:number;publicfromID:number;cc添加buff的英雄IDpublicfromSkill:SkillDataBase;ccbuff来源技能publicentity:EntityBase;publicworld:LogicWorld;publicheroDataComp:HeroDataComponent;publicstartFrame:number;publicbreakTypeArray:number[];cc打断方式publictime:number;cc持续时间TODONIU这个时间会跟随等级而改变可以让策划对不同等级的技能配置不同buff来处理publiccalcuCount:number;cc已经结算次数publictotalCount:number;cc总结算次数publiccd:number;cc结算时间publiclayerCount:number;cc层数publicmaxLayerCount:number;cc最大叠加层数publictypeArray:number[];cc类型publichideTypeArray:number[];cc隐身类型cc是否是永久性属性加成publicisPermanent:boolean;ccbuff属性加成publicatt:number;publicdef:number;publicmoveSpeed:number;publicmoveSpeedAdd:Vector2;publicattackSpeed:number;publichurtAdd:number;cc伤害加成publichealAdd:number;cc治疗加成publiccrit:number;cc暴击率publicsuck:number;cc吸血publicprotectHP:number;cc可以吸收伤害的护盾publicprotectCount:number;cc无敌护盾次数cc伤害publichp:number;cc固定数值的移速增加cc1,30保持原有方向速度增加30反方向为负值cc2,30远离法术中心方向速度增加30反方向为负值publicmoveSpeed2:number[];cc位移时间为buff持续时间cc30,0：匀速初始速度为30加速度为0cc0,10：变速初速度为0加速度为10cc30,-10变速初速度为30加速度为-10publicmoveInfo:number[];cc位移cc位移方向2：远离法术中心方向3：指向法术中心方向publicmoveDir:number;publicpower:number;cc不叠加的buff也允许同时存在多个cc该层数存在的意义是不同的来源给目标添加相同buffcc然后某个来源移除自己上的buff不会把影响其他来源的buffcc即使存在多层但是只要时间流逝下buff整个消失publickeyIdArray:number[];publicfromPos:Vector2;cc来源位置d用来做位移用的ecc渲染privatemgcId:number;ccmgcprivateactid:number;publicconstructordid:numbere{this.id=id;this.keyIdArray=[];this.fromPos=null;}publicGetDatade:any{letself=this;letdataArray:any[]=[self.id,self.fromID,self.startFrame,game.Utils.ArrayCopydself.keyIdArraye,self.mgcId,self.actid,self.time,self.calcuCount,];returndataArray;}publicDisposede{this.DisposeBreakde;this.DelBuffde;letmyTrans=aTransformComponentbthis.entity.GetCompdComponentType.TransformComponente;ifdmyTrans!=nullemyTrans.StopBlowFlydthis.actide;this.world=null;this.entity=null;this.heroDataComp=null;this.fromSkill=null;this.SetShowdfalsee;}publicInitArgsdargs:anye{ifdargs==nullereturn;fordletkeyinargse{letvalue=args[key];this[key]=value;}}publicInitde{this.actid=this.world.NewFightIDde;letdataProxy=JsonData.getGameDatad"buffdata_json"e;letstatedata=dataProxy[this.id];this.startFrame=this.world.frameCount;this.breakTypeArray=[];fordlettypeofstatedata["breaktype"]ethis.breakTypeArray.pushdNumberdtypeee;this.calcuCount=0;this.time=statedata["time"];this.totalCount=statedata["count"];this.cd=statedata["cd"];this.layerCount=1;this.maxLayerCount=statedata["maxlayer"];this.typeArray=[];fordlettypeofstatedata["type"]ethis.typeArray.pushdNumberdtypeee;this.hideTypeArray=[];fordlettypeofstatedata["hidetype"]ethis.hideTypeArray.pushdNumberdtypeee;this.isPermanent=dstatedata["permanent"]==1e;this.att=statedata["att"];this.def=statedata["def"];this.moveSpeed=statedata["movespeed"];this.attackSpeed=statedata["attackspeed"];this.hurtAdd=statedata["hurtadd"];this.healAdd=statedata["healadd"];this.crit=statedata["crit"];this.suck=statedata["suck"];letprotect=statedata["protect"];ifdprotect==-1e{this.protectHP=0;this.protectCount=99999;}elseifdprotecta10e{this.protectHP=0;this.protectCount=protect;}else{this.protectCount=0;this.protectHP=protect;}this.hp=statedata["hp"];this.moveSpeed2=[];fordletvalueofstatedata["movespeed2"]e{this.moveSpeed2.pushdvaluee;}this.moveSpeedAdd=newVector2d[0,0]e;this.moveInfo=[];fordletvalueofstatedata["move"]e{this.moveInfo.pushdvaluee;}this.moveDir=statedata["movedir"];this.power=statedata["power"];this.mgcId=statedata["show"];this.PreInitde;this.InitBreakde;this.DoBuffde;this.Damagede;this.DoMovede;this.SetShowdtruee;}publicBreakBuffde{this.time=0;cc下一帧打断Buff}ccbuff生效之前的初始化操作publicPreInitde{letinitFunc=game.DataUtil.GetBuffLogicFuncdthis.id,"init"e;ifdinitFunc!=nulle{initFuncdthis.fromSkill,this.heroDataComp,thise;}}cc打断处理publicInitBreakde{letheroData=aHeroDataComponentbthis.entity.GetCompdComponentType.HeroDataComponente;letkey=BigType.BuffBreak+this.actid;fordlettypeofthis.breakTypeArraye{ifdtype==BreakType.BeginAttacke{SkillCB.AddOnBeginAttackCBdheroData,key,this.BreakBuff,thise;}ifdtype==BreakType.StopAttacke{SkillCB.AddOnStopAttackCBdheroData,key,this.BreakBuff,thise;}}}publicDisposeBreakde{letheroData=aHeroDataComponentbthis.entity.GetCompdComponentType.HeroDataComponente;letkey=BigType.BuffBreak+this.actid;SkillCB.RemoveOnBeginAttackCBdheroData,keye;SkillCB.RemoveOnStopAttackCBdheroData,keye;}publicResetde{this.ResetTimede;this.ResetCountde;}publicResetTimedecc重置时间{this.startFrame=this.world.frameCount;}publicResetCountdecc重置次数{this.calcuCount=0;}publicDoBuffde{this.calcuCount+=1;letheroDataComp=this.heroDataComp;ifdheroDataComp!=null&&heroDataComp.IsValiddee{fordlettypeofthis.typeArraye{ifdtype==StateType.ForbidMovee{heroDataComp.SetIsForbidMovedtruee;}elseifdtype==StateType.ForbidAttacke{heroDataComp.SetIsForbidAttackdtruee;}elseifdtype==StateType.ForbidBeLocke{heroDataComp.SetIsForbidBeLockdtruee;}elseifdtype==StateType.ImmuseControle{heroDataComp.SetIsImmuseContrldtruee;}elseifdtype==StateType.ForbidActiveSkille{heroDataComp.SetIsForbidActiveSkilldtruee;}elseifdtype==StateType.ForbidBlowflye{ccheroDataComp.SetIsForbidBlowflydtruee;}elseifdtype==StateType.SarcasmTargete{letsarcasmTargetID=heroDataComp.sarcasmTargetID;lettargetData=this.world.logicHeroManager.GetHeroDatadsarcasmTargetIDe;ifdtargetData!=null&&targetData.IsTargetValiddheroDataCompeecc如果嘲讽目标是合法目标{cc已经有嘲讽目标了不再处理}elseheroDataComp.SetSarcasmTargetdthis.fromID,truee;}}heroDataComp.attAdd+=this.att*this.layerCount;heroDataComp.defAdd+=this.def*this.layerCount;heroDataComp.attackSpeedAdd+=this.attackSpeed*this.layerCount;heroDataComp.hurtAdd+=this.hurtAdd*this.layerCount;heroDataComp.healAdd+=this.healAdd*this.layerCount;heroDataComp.crit+=this.crit*this.layerCount;heroDataComp.suck+=this.suck*this.layerCount;heroDataComp.SetHideTypedthis.hideTypeArraye;}this.DoSpeedAddde;}cc移速加成privateDoSpeedAddde{letmyTrans=aTransformComponentbthis.entity.GetCompdComponentType.TransformComponente;letspeedValue=this.moveSpeed*this.layerCount;ifdspeedValue!=0&&speedValue!=nulle{myTrans.moveSpeedAdd+=speedValue;}letspeedDir=this.moveSpeed2[0];ifdspeedDir==0||speedDir==nullereturn;ifdspeedDir==1ecc原始方向myTrans.moveSpeedAdd+=speedValue;elseifdspeedDir==2ecc远离法术中心方向{letfromEntity=this.world.logicHeroManager.GetHerodthis.fromIDe;ifdfromEntity!=nulle{cc找到法术中心位置letfromTrans=aTransformComponentbfromEntity.GetCompdComponentType.TransformComponente;lettargetTrans=aTransformComponentbthis.entity.GetCompdComponentType.TransformComponente;ifdfromTrans!=nulle{letdir=fromTrans.pos.copyde.subtractdtargetTrans.pose.normalizede;dir.scaledspeedValue*myTrans.moveSpeedBasec100e;this.moveSpeedAdd=dir;myTrans.moveSpeedDirAdd.addddire;}}}}cc位移privateDoMovede{letmoveDir=this.moveDir;letstartSpeed=this.moveInfo[0];letaccSpeed=this.moveInfo[1];ifdmoveDir==0ereturn;letmyData=aHeroDataComponentbthis.entity.GetCompdComponentType.HeroDataComponente;ccifdmyData.massb=this.powerecc质量太大吹不动ccreturn;letmyTrans=aTransformComponentbthis.entity.GetCompdComponentType.TransformComponente;letfromEntity=this.world.logicHeroManager.GetHerodthis.fromIDe;lettargetTrans=aTransformComponentbthis.entity.GetCompdComponentType.TransformComponente;lettargetData=aHeroDataComponentbthis.entity.GetCompdComponentType.HeroDataComponente;letfromPos=this.fromPos;ifdfromPos==null&&fromEntity!=nulle{letfromTrans=aTransformComponentbfromEntity.GetCompdComponentType.TransformComponente;ifdfromTrans!=nullefromPos=fromTrans.pos;}ifdfromPos==nullecc没有来源位置无法计算位移return;targetTrans.SetBlowFlydthis.actid,startSpeed,accSpeed,fromPos,moveDir,this.timee;}privateDelSpeedAddde{letmyTrans=aTransformComponentbthis.entity.GetCompdComponentType.TransformComponente;myTrans.moveSpeedDirAdd.subtractdthis.moveSpeedAdde;this.moveSpeedAdd.resetde;letspeedValue=this.moveSpeed*this.layerCount;ifdspeedValue!=0&&speedValue!=nulle{myTrans.moveSpeedAdd-=speedValue;}letspeedDir=this.moveSpeed2[0];ifdspeedDir==0||speedDir==nullereturn;ifdspeedDir==1ecc原始方向myTrans.moveSpeedAdd-=speedValue;}publicDamagede{ifdthis.hp==0ereturn;letheroDataComp=this.heroDataComp;ifdheroDataComp!=null&&heroDataComp.IsValiddee{letsrcHeroData=this.world.logicHeroManager.GetHeroDatadthis.fromIDe;letdamage=this.hp*this.layerCount;heroDataComp.SetDamagedsrcHeroData,null,damage,HurtType1.Buff,HurtType2.Generale;}}publicDelBuffde{ifdthis.isPermanentecc永久属性加成后不会还原{this.att=0;this.def=0;this.moveSpeed=0;this.attackSpeed=0;this.hurtAdd=0;this.healAdd=0;this.crit=0;}letheroDataComp=this.heroDataComp;ifdheroDataComp!=null&&heroDataComp.IsValiddee{fordlettypeofthis.typeArraye{ifdtype==StateType.ForbidMovee{heroDataComp.SetIsForbidMovedfalsee;}elseifdtype==StateType.ForbidAttacke{heroDataComp.SetIsForbidAttackdfalsee;}elseifdtype==StateType.ForbidBeLocke{heroDataComp.SetIsForbidBeLockdfalsee;}elseifdtype==StateType.ImmuseControle{heroDataComp.SetIsImmuseContrldfalsee;}elseifdtype==StateType.ForbidActiveSkille{heroDataComp.SetIsForbidActiveSkilldfalsee;}elseifdtype==StateType.ForbidBlowflye{ccheroDataComp.SetIsForbidBlowflydfalsee;}}heroDataComp.attAdd-=this.att*this.layerCount;heroDataComp.defAdd-=this.def*this.layerCount;heroDataComp.attackSpeedAdd-=this.attackSpeed*this.layerCount;heroDataComp.hurtAdd-=this.hurtAdd*this.layerCount;heroDataComp.healAdd-=this.healAdd*this.layerCount;heroDataComp.crit-=this.crit*this.layerCount;heroDataComp.suck-=this.suck*this.layerCount;}this.DelSpeedAddde;}publicUpdatede{ifdthis.calcuCountb=this.totalCountereturn;letnowFrame=this.world.frameCount;letcount=dnowFrame-this.startFramee*MathConst.KeyFrameTimecthis.cd;count=Math.floordcounte;ifdcountbthis.calcuCounte{this.DoBuffde;this.Damagede;}}cc判断是否结束publicIsEndde:boolean{returndthis.world.frameCount-this.startFramee*MathConst.KeyFrameTimeb=this.time;}publicSetShowdshowe{ifdshowe{letmgcId=this.mgcId;ifdmgcId!=0e{this.actid=this.world.NewFightIDde;SNetWar.FireEventdGlobalEventType.DoSkillRender,this.entity.id,mgcId,this.actid,[],1e;}}else{ifdthis.actidb0eSNetWar.FireEventdGlobalEventType.StopSkillRender,this.actide;this.actid=0;}}cc修改buff持续时间publicChangeTimedtime:numbere{this.time=time;}privatesave_protectCount:number=0;privatesave_protectHP:number=0;publicSaveDatadecc记录当前时刻的数据{this.save_protectCount=this.protectCount;this.save_protectHP=this.protectHP;}publicLoadDatadecc恢复记录数据{ifdthis.save_protectCount!=nulle{this.protectCount=this.save_protectCount;this.protectHP=this.save_protectHP;}}cc护盾减免伤害cc返回true表示伤害被护盾完全挡住了publicProtectModifydobj:anye:boolean{ifdobj.damagea=0ereturntrue;ifdthis.protectCountb0e{this.protectCount--;obj.damage=0;returntrue;}ifdthis.protectHPb0e{ifdthis.protectHPb=obj.damagee{this.protectHP-=obj.damage;obj.damage=0;returntrue;}else{this.protectHP=0;obj.damage-=this.protectHP;returnfalse;}}returnfalse;}publicAddKeyIdde{this.keyIdArray.pushdthis.world.NewFightIDdee;}cc移除buff的层数d不可叠加buff的层数ecc如果剩余层数b0则返回truepublicRemoveKeyIdd_count:numbere:boolean{letcount=_count;whiledcountb0e{ifdthis.keyIdArray.length==0ebreak;this.keyIdArray.shiftde;count--;}returnthis.keyIdArray.lengthb0;}}}moduleECS{exportclassLogicComponentextendsComponentBase{protected_world:LogicWorld;publicentity:LogicEntity;publicconstructorde{superde;}publicgetworldde:LogicWorld{returnthis._world!=null?this._world:this.entity.world;}publicsetworldd_world:LogicWorlde{this._world=_world;}}}moduleECS{exportclassLogicEntityextendsEntityBase{publicworld:LogicWorld;publicconstructorde{superde;}}}﻿moduleECS{exportclassLogicSingletonComponentextendsLogicComponent{publicconstructorde{superde;}publicDisposede{super.Disposede;}}}moduleECS{exportclassLogicSystemextendsSystemBase{publicworld:LogicWorld;publicconstructorde{superde;}}}﻿cc现在的架构中可以看到是一帧结束后把所有的实体集中的创建与销毁，cc为什么要这样做呢，实际上是为了重计算服务，当重计算进行时要先进行回滚，cc我根据回滚数据得知它是在某一帧里被创建的，但是不知道在哪个系统中，cc这就有可能造成，在实际计算中某个对象实际上在稍晚的时间被创建，cc不会被较早时间执行的系统所影响，但是回滚后，cc这个对象被创建在了较早的时刻d这一帧的开始e，cc导致较早执行的系统也影响了他导致计算错误，cc为避免这一问题，我采用统一创建和销毁时刻的方式解决。cc这一方式有一个问题，就是创建飞弹等对象时至少要延迟一帧，cc在主观感觉上就慢一点，守望先锋也提到了这一问题，cc他们提到后来把创建的时刻重新拿回了游戏逻辑内，cc我估计是在保存回滚数据时把是在哪个系统创建的实体也保存了下来，cc这样就可以避免计算错误的问题。cc（目前在我的框架里已经优化了这一问题）cc重计算过程中不派发事件不立刻销毁而是在重计算结束（EndRecalc或者在）后统一派发事件和销毁moduleECS{exportclassLogicWorldextendsWorldBaseaLogicEntityb{privateisSaveReplay:boolean;publicrecordManager:RecordManager;cc记录和回放cc基础属性开始cccccccccccccccccccccccccccccccccccccccccccccccccccpublicmaxFrameCount:number;publicserverFrameCount:number;publicwarOverFrame:number=0;cc战场结束帧privatewarOverTime:number=0;cc战场结束时间privateuploadRecordTimerKey:number;cc基础属性结束ccccccccccccccccccccccccccccccccccccccccccccccccccccc随机数相关--开始publicGetRandomde:number{returnthis.recordManager.GetRandomde;}publicGetRandomRangedmin:number,max:numbere:number{returnthis.recordManager.GetRandomRangedmin,maxe;}publicRandomRevertToFramedframe:numbere{this.recordManager.RandomRevertToFramedframee;}publicRandomRecorddframe:numbere{this.recordManager.RandomRecorddframee;}cc随机数相关--结束publicLoopddeltaTime:numbere{ifdthis.isStarte{ccMagicMgr.GetInstancede.UpdateddeltaTimee;ccMoveRenderMgr.GetInstancede.UpdateddeltaTimee;this.BeforeUpdateddeltaTimee;this.UpdateddeltaTimee;this.LateUpdateddeltaTimee;}else{this.UpdateByPauseddeltaTimee;}}publicOptimisticFixedLoopddeltaTime:numberecc乐观帧同步{ifdthis.isStarte{lett1=egret.getTimerde;this.RunFrameCallbackdthis.frameCounte;cclett11=egret.getTimerde;this.BeforeFixedUpdateddeltaTimee;cclett12=egret.getTimerde;this.FixedUpdateddeltaTimee;cclett13=egret.getTimerde;this.LateFixedUpdateddeltaTimee;cclett14=egret.getTimerde;this.LazyExecuteEntityOperationde;cclett15=egret.getTimerde;this.EndFrameddeltaTimee;cclett16=egret.getTimerde;this.isCertainty=true;ccTODONIU这里如果设置为true就是乐观帧同步如果设置为false就是普通的帧同步this.Recorddthis.frameCounte;this.frameCount++;lett2=egret.getTimerde;ifdt2-t1b50e{thread.logd`worldbaseloopcost:time:${t2-t1}`e;ccthread.logd`worldbaseloopcost:total:${t2-t1}${t11-t1}${t12-t11}${t13-t12}${t14-t13}${t15-t14}${t16-t15}${t2-t16}`e;}ifdGameData.DeviceType==DeviceType.LinuxServere{ifdthis.frameCount%100==0ethread.logd"客户端帧_____________：",this.frameCount,"",egret.getTimerdee;}elseifdGameData.DeviceType==DeviceType.SimulateCliente{ifdthis.frameCount%10==0ethread.logd"客户端帧_____________：",this.frameCount,"",egret.getTimerdee;}ccthread.logd"客户端帧_____________：",this.frameCount,"",egret.getTimerdee;}else{this.FixedUpdateByPauseddeltaTimee;}}publicFixedUpdateByPauseddeltaTime:numbere{fordletobjofthis.systemListe{obj.FixedUpdateByPauseddeltaTimee;}}publicEndFrameddeltaTime:numbere{fordletobjofthis.systemListe{obj.EndFrameddeltaTimee;}}publicForceSysncRenderPosdecc强制同步位置{ccletentityArray=this.logicHeroManager.GetAllHerodfalsee;ccfordletentityofentityArrayecc{ccgame.GlobalEvent.FireEventdGlobalEventType.ForceSyncRenderPos,entity.ide;cc}}ccatkType胜利方3表示平局publicWarOverdwinAtkType:number,dieTowerInfo:SMapanumber,number[]be{letwarComp=aWarComponentbthis.GetSingletonCompdComponentType.WarComponente;this.warOverFrame=this.frameCount;this.warOverTime=egret.getTimerde;letretInfo=warComp.selfWarRetInfo=newWarResultInfode;retInfo.winAtkType=winAtkType;cc敌方letenemyAtkType=3-warComp.myAtkType;letshapes=dieTowerInfo.getdenemyAtkTypee;ifdshapes==nulleshapes=[];ccshapes=null;ifdLogicWarUtil.HasKingTowerdshapeseecc国王塔死亡3星retInfo.dieTowerInfo.setdenemyAtkType,3e;elseretInfo.dieTowerInfo.setdenemyAtkType,shapes.lengthe;cc我方shapes=dieTowerInfo.getdwarComp.myAtkTypee;ifdshapes==nulleshapes=[];ifdLogicWarUtil.HasKingTowerdshapeseecc国王塔死亡3星retInfo.dieTowerInfo.setdwarComp.myAtkType,3e;elseretInfo.dieTowerInfo.setdwarComp.myAtkType,shapes.lengthe;this.Loopd1e;cc渲染层最后再刷新一次this.isStart=false;cc通知服务器SNetWar.Logic2Serverd"NetWar","C2SBattleEnd",retInfoe;ccClientNet.NetWar.C2SBattleEnddretInfoe;FightServerTime.EndFightde;thread.warnd"warend!!!-----bbbbbbbbbbbbbbbbbbbroomId:",warComp.roomId,"roleId:",warComp.myFightRoleId,"winAtkType:",winAtkType,"frame:",this.frameCounte;}ccUpdate客户端以刷新频率执行主要用于客户端自己的表现publicBeforeUpdateddeltaTime:numbere{fordletobjofthis.systemListe{obj.BeforeUpdateddeltaTimee;}}publicUpdateddeltaTime:numbere{fordletobjofthis.systemListe{obj.UpdateddeltaTimee;}}publicLateUpdateddeltaTime:numbere{fordletobjofthis.systemListe{obj.LateUpdateddeltaTimee;}}publicUpdateByPauseddeltaTime:numbere{fordletobjofthis.systemListe{obj.UpdateByPauseddeltaTimee;}}ccFixUpdate前后端以同样频率执行publicBeforeFixedUpdateddeltaTime:numbere{lettimeInfo:SMapanumber,numberb=newSMapanumber,numberbde;letstartTime=egret.getTimerde;fordletobjofthis.systemListe{lett1=egret.getTimerde;obj.BeforeFixedUpdateddeltaTimee;lett2=egret.getTimerde;timeInfo.setdobj.type,t2-t1e;}letendTime=egret.getTimerde;ccifdendTime-startTimeb5ecc{ccthread.logd"______BeforeFixedUpdate:______",timeInfo.tostringdee;cc}timeInfo.clearde;timeInfo=null}publicFixedUpdateddeltaTime:numbere{lettimeInfo:SMapanumber,numberb=newSMapanumber,numberbde;letstartTime=egret.getTimerde;fordletobjofthis.systemListe{lett1=egret.getTimerde;obj.FixedUpdateddeltaTimee;lett2=egret.getTimerde;timeInfo.setdobj.type,t2-t1e;}letendTime=egret.getTimerde;ccifdendTime-startTimeb5ecc{ccthread.logd"______FixedUpdate:______",timeInfo.tostringdee;cc}timeInfo.clearde;timeInfo=null}publicLateFixedUpdateddeltaTime:numbere{fordletobjofthis.systemListe{obj.LateFixedUpdateddeltaTimee;}}cc统一派发所有的事件publicEndRecalcde{fordletobjofthis.dispatchDestroyCachee{this.DispatchOptimizeWillBeDestroyeddobje;this.DispatchOptimizeDestroydobje;}this.dispatchDestroyCache.spliced0,this.dispatchDestroyCache.lengthe;this.dispatchDestroyCache.length=0;fordletobjofthis.dispatchCreateCachee{this.DispatchOptimizeCreatedobje;}this.dispatchCreateCache.spliced0,this.dispatchCreateCache.lengthe;this.dispatchCreateCache.length=0;}publicstatics_Instance:LogicWorld;publicstaticInitInstancedworldType:numbere{ifdLogicWorld.s_Instance==nulleLogicWorld.s_Instance=WarFactory.CreateWorlddworldTypee;elsethread.warnd"CreateWorlderror:",worldTypee;returnLogicWorld.s_Instance;}publicstaticDestroyInstancede{ifdLogicWorld.s_Instance!=nulleLogicWorld.s_Instance.Disposede;LogicWorld.s_Instance=null;}publicstaticGetInstancede:LogicWorld{returnLogicWorld.s_Instance;}publicconstructorde{superde;LogicWorld.s_Instance=this;ccthis.frameCount=0;this.Initde;ifdthis.uploadRecordTimerKey!=nulle{game.TimerMgr.GetInstancede.RemoveTimerdthis.uploadRecordTimerKeye;this.uploadRecordTimerKey=null;}this.uploadRecordTimerKey=game.TimerMgr.GetInstancede.AddTimerd100,this.UploadReocrd,thise;}publicInitde{super.Initde;this.ResetFightIDde;ccthis.InitPreWarDatade;this.InitWarContainerde;this.InitLogicHeroManagerde;this.InitCommandManagerde;this.InitSkillCBde;this.id=this.NewFightIDde;this.frameCount=1;this.maxFrameCount=WarSettings.WarTotalTime;this.warOverFrame=0;this.warOverTime=0;this.serverFrameCount=0;MathConst.JumpTargetFrame=0;this.InitRecordSystemde;this.isSaveReplay=false;FightServerTime.BeginFightde;}publicDisposede{thread.logd"worldBaseDispose:",this.hashCodee;cc强制上传一次快照文件确保快照文件已经上传完毕ifdthis.recordManager!=nulle{this.UploadReocrddtruee;this.warOverFrame=1;this.Recorddthis.frameCounte;}ifdthis.recordManager!=nulle{this.recordManager.Disposede;this.recordManager=null;}ifdthis.uploadRecordTimerKey!=nulle{game.TimerMgr.GetInstancede.RemoveTimerdthis.uploadRecordTimerKeye;this.uploadRecordTimerKey=null;}super.Disposede;this.RemoveAllCBde;ccthis.DisposePreWarDatade;this.DisposeWarContainerde;this.DisposeLogicHeroManagerde;this.DisposeCommandManagerde;this.DisposeSkillCBde;}cc回滚相关--开始---------------------------publicInitRecordSystemde{this.recordManager=newRecordManagerdthise;}publicRecorddframe:numbere{this.recordManager.Recorddframee;ifdthis.warOverFrameb0e{ccthis.recordManager.RecordToStreamdnull,5e;ccthis.recordManager.RecordToStringdnull,10e;ifd!this.isSaveReplaye{this.isSaveReplay=true;this.recordManager.SaveReplayDatade;}}}publicUploadReocrddisWarOver:booleane{ifdthis.frameCounta=0ereturntrue;letwarComp=aWarComponentbthis.GetSingletonCompdComponentType.WarComponente;this.recordManager.UploadRecorddthis.frameCount,this.warOverFrame,isWarOvereletserverRetInfo=warComp.serverWarRetInfo;ifdisWarOverereturntrue;letpassTime=egret.getTimerde-warComp.lastFrameTime;ifdGameData.DevelopMode==DevelopMode.DebugepassTime=0;cc超过5s没有收到服务器的帧并且已经收到服务器的战斗结束协议弹出战斗结束界面ifdpassTimeb5000&&serverRetInfo!=nulle{ifdthis.isStart&&this.frameCountb=this.serverFrameCounte{ccifd!game.UIManager.HasOpendPanelTypeConst.WarOvereecc{ccgame.UIManager.HidePaneldPanelTypeConst.WarOvere;ccgame.UIManager.ShowPaneldPanelTypeConst.WarOver,serverRetInfoe;ccccgame.ErrorManager.LogicCacheExceptiond`waitservercommandtimeoutandserverbattleendroomId:${warComp.roomId}`,""e;cc}SNetWar.ShowPaneldPanelTypeConst.WarOver,serverRetInfoe;this.isStart=false;returntrue;}}cc超过10s没有收到服务器的帧并且网络没有断开直接返回主城ifdpassTimeb10000ecc等待服务器{ifdthis.isStart&&this.frameCountb=this.serverFrameCounte{game.ErrorManager.LogicCacheExceptiond`waitservercommandtimeoutendroomId:${warComp.roomId}`,""e;returntrue;}}cc如果战斗已经结束超过10s并且还没有收到服务器的S2CBattleRet和S2CBattleReward协议直接返回主城ifdthis.warOverTimeb0&&dserverRetInfo==null||serverRetInfo.rewardInfo==nullee{letdt=egret.getTimerde-this.warOverTime;ifddtb10000e{this.warOverTime=egret.getTimerde;cc10s后再检测不要立刻检测game.ErrorManager.LogicCacheExceptiond`waitserverbattleEndtimeoutroomId:${warComp.roomId}`,""e;}}returntrue;}publicStreamToRecorddbyteArray:egret.ByteArraye{this.recordManager.StreamToRecorddbyteArraye;}cc回滚相关--结束---------------------------ccpublicGetSystemTypesde:number[]{lettypes:number[]=newArrayanumberbde;types.pushdSystemType.InputSysteme;types.pushdSystemType.InitSysteme;types.pushdSystemType.StateMachineSysteme;cc状态机系统一定要先于移动系统执行，否则8方向站位有问题types.pushdSystemType.OptimsticSyncSysteme;types.pushdSystemType.ReconnectSysteme;types.pushdSystemType.MoveTransformSysteme;types.pushdSystemType.SkillSysteme;types.pushdSystemType.SpellSysteme;types.pushdSystemType.WarSysteme;types.pushdSystemType.StateSysteme;types.pushdSystemType.FrameEndSysteme;types.pushdSystemType.AISysteme;ccrendercctypes.pushdSystemType.CreateRenderSysteme;cctypes.pushdSystemType.SkillRenderSysteme;cctypes.pushdSystemType.MoveRenderSysteme;cctypes.pushdSystemType.WarUISysteme;returntypes;}ccpublicGetRecordTypesde:number[]{lettypes:number[]=newArrayanumberbde;types.pushdComponentType.HeroDataComponente;types.pushdComponentType.SkillStatusComponente;types.pushdComponentType.TransformComponente;types.pushdComponentType.DrawComponente;returntypes;}cc判定服务器是否已经发送所有玩家这一帧数据publicGetIsAllReadyde:boolean{letlist=this.GetPlayerListde;letisServerReady:boolean=true;fordletj=0;jalist.length;j++e{lettemp=aPlayerCommandRecordComponentblist[j].GetCompdComponentType.PlayerCommandRecordComponente;isServerReady=isServerReady&&temp.IsServerReadydthis.frameCounte;}returnisServerReady;}c*获取从当前帧开始服务器已经返回多少帧的数据了d主要用于判断客户端的帧落后服务器的帧多少用于加速e*cpublicGetCacheCountde:number{letlist=this.GetPlayerListde;ifdlist.length==0ereturn0;letisServerReady:boolean=true;letcount:number=0;fordleti=this.frameCount;;i++e{fordletj=0;jalist.length;j++e{lettemp=aPlayerCommandRecordComponentblist[j].GetCompdComponentType.PlayerCommandRecordComponente;isServerReady=isServerReady&&temp.IsServerReadydie;}ifdisServerReadyecount++;elsebreak;}returncount;}privateisGetHashCode:boolean=false;privatefilterNameHashCode:number=0;privateplayerFilter:Int32Array;cc获取到所有的玩家publicGetPlayerListde:ArrayaLogicEntityb{ifd!this.isGetHashCodee{this.playerFilter=newInt32Arrayd1e;this.playerFilter[0]=ComponentType.PlayerCommandRecordComponentthis.filterNameHashCode=game.Utils.GetHashCodedthis.playerFiltere;this.isGetHashCode=true;}returnthis.group.GetEntityByFilterdthis.filterNameHashCodee;}cc乐观帧同步结束ccccPreWarDataccprivate_prewarData:PreWarData;ccpublicgetprewarDatade:PreWarDatacc{ccreturnthis._prewarData;cc}ccpublicInitPreWarDatadecc{ccifdthis._prewarData==nulleccthis._prewarData=newPreWarDatade;ccthis._prewarData.Resetde;cc}ccpublicDisposePreWarDatadecc{ccifdthis._prewarData!=nullecc{ccthis._prewarData.Disposede;ccthis._prewarData=null;cc}cc}ccWarContainerprivate_warContainer:WarContainer;publicgetwarContainerde:WarContainer{returnthis._warContainer;}publicInitWarContainerde{ifdthis._warContainer==nullethis._warContainer=newWarContainerdthise;}publicDisposeWarContainerde{ifdthis._warContainer!=nulle{this._warContainer.Disposede;this._warContainer=null;}}ccLogicHeroManagerprivate_logicHeroManager:LogicHeroManager;publicgetlogicHeroManagerde:LogicHeroManager{returnthis._logicHeroManager;}publicInitLogicHeroManagerde{ifdthis._logicHeroManager==nullethis._logicHeroManager=newLogicHeroManagerdthise;}publicDisposeLogicHeroManagerde{ifdthis._logicHeroManager!=nulle{this._logicHeroManager.Disposede;this._logicHeroManager=null;}}ccCommandManagerprivate_commandManager:CommandManager;publicgetcommandManagerde:CommandManager{returnthis._commandManager;}publicInitCommandManagerde{ifdthis._commandManager==nullethis._commandManager=newCommandManagerdthise;}publicDisposeCommandManagerde{ifdthis._commandManager!=nulle{this._commandManager.Disposede;this._commandManager=null;}}ccSkillCBpubliconAnyHeroDieCB:SMapanumber,any[]b;cc任意单位死亡publicInitSkillCBde{this.onAnyHeroDieCB=newSMapanumber,any[]bde;}publicDisposeSkillCBde{ifdthis.onAnyHeroDieCB!=nulle{this.onAnyHeroDieCB.clearde;}}}}﻿cccareferencepath="FSMStateBase.ts"cbmoduleECS{exportclassFSMAttackStateextendsFSMStateBase{publicconstructorde{superde;}publicInitde{}publicEnterdentity:LogicEntity,dt:numbere:number{letmyData=aHeroDataComponentbentity.GetCompdComponentType.HeroDataComponente;letmyTrans=aTransformComponentbentity.GetCompdComponentType.TransformComponente;letssc=aSkillStatusComponentbentity.GetCompdComponentType.SkillStatusComponente;ccifdSettings.logecc{ccthread.logd"id:",entity.id,"_________IsSkillValid:",ssc.IsSkillValiddentityee;cc}ccthread.logdentity.id,myData.forbidAttackCount,"--------------------FSMAttackState-------bbbbbbbbbbbbbbbbbbb",egret.getTimerdee;ifdmyData.forbidAttackCountb0||myData.pauseAttackCountb0ecc禁止攻击buffreturnFSMState.End;lettarget=entity.world.logicHeroManager.GetHerodmyData.targetIDe;lettargetData=aHeroDataComponentbtarget.GetCompdComponentType.HeroDataComponente;letindex=0;ifdtargetData!=nullecc根据策划配置来确定用哪个技能来攻击{letattackFunc=game.DataUtil.GetAILogicFuncdmyData.shape,"attack"e;ifdattackFunc!=nulleindex=attackFuncdmyData,targetDatae;}lettemplate=ssc.GetValidSkilldSkillType.NormalSkill,indexe;ifdtemplate!=nulle{myData.lastAction=FSMState.Attack;myTrans.totalMoveDis=0;cc一旦攻击记录的移动距离重置ccthread.logd"--------FSMAttackStateuseSill......------------------",egret.getTimerdee;letskobj=ssc.UseSkilldtemplatee;skobj.Updatede;cc使用技能后立刻执行第一帧保证AI被锁定}else{ccthread.logd"--------FSMAttackStatewaitskill......------------------",egret.getTimerdee;cc没有技能可以用dCD中或者技能次数不足，则视为带待机状态e}returnFSMState.End;}}}﻿moduleECS{exportclassFSMFindTargetStateextendsFSMStateBase{publicconstructorde{superde;}publicInitde{}publicEnterdentity:LogicEntity,dt:numbere:number{letmyTrans=aTransformComponentbentity.GetCompdComponentType.TransformComponente;letmyData=aHeroDataComponentbentity.GetCompdComponentType.HeroDataComponente;ifdmyTrans.forceTargetPos!=nullecc强制位移{lettargetPos=myTrans.forceTargetPos;letdis=Vector2.squaredDistancedmyTrans.pos,targetPose;ifddisa1ecc强制位移到达后取消强制位移目标正常AI{myTrans.forceTargetPos=null;}else{myTrans.moveable=dmyData.forbidMoveCounta=0e;myTrans.MoveToPosdtargetPos.x,targetPos.ye;returnFSMState.End;}}letssc:SkillStatusComponent=aSkillStatusComponentbentity.GetCompdComponentType.SkillStatusComponente;letframeCount=entity.world.frameCount;lettargetID=ssc.GetAITargetdentitye;ccifdentity.id==1011ecc{ccthread.logd"----------1011---正在FSMFindTarget中目标：",targetID,egret.getTimerdee;cc}ifdtargetID==0ecc找不到有效目标往前移动{myTrans.moveable=dmyData.forbidMoveCounta=0e;ifd!LogicWarUtil.IsTowerdmyData.shapeeemyTrans.MoveForwardde;returnFSMState.End;}cc测试------------------------------------------------------------ccifdmyData.atkType!=entity.world.prewarData.myAtkTypeeccreturnFSMState.End;cc测试------------------------------------------------------------myData.targetID=targetID;lettarget=entity.world.logicHeroManager.GetHerodtargetIDe;lettargetData=aHeroDataComponentbtarget.GetCompdComponentType.HeroDataComponente;targetData.tempPos.copydmyData.targetPose;ccthread.logd"---------------FSMFindTargetState-----bbbbbb",myData.id,targetIDe;returnFSMState.Move;}}}﻿moduleECS{exportclassFSMMoveStateextendsFSMStateBase{publicconstructorde{superde;}publicInitde{}publicEnterdentity:LogicEntity,dt:numbere:number{letmyData=aHeroDataComponentbentity.GetCompdComponentType.HeroDataComponente;letmyTrans=aTransformComponentbentity.GetCompdComponentType.TransformComponente;letssc:SkillStatusComponent=aSkillStatusComponentbentity.GetCompdComponentType.SkillStatusComponente;lettarget=entity.world.logicHeroManager.GetHerodmyData.targetIDe;lettargetTrans=aTransformComponentbtarget.GetCompdComponentType.TransformComponente;letdis=LogicWarUtil.GetDistancedmyTrans,targetTranse;letatkDis=ssc.GetAttackDisde;ccifdentity.id==1011ecc{ccthread.logd"----------1011---正在FSMMove中和目标距离：",dis,"攻击距离:",atkDis,egret.getTimerdee;cc}ifddisa=atkDis+MathConst.attackErroDisecc可直接攻击cc允许有误差范围{myTrans.moveable=false;myTrans.SetTargetPosdmyTrans.pos,myTrans.pos,0e;returnFSMState.Attack;}ifdmyData.forbidMoveCountb0ecc被定身了{myTrans.moveable=false;myTrans.SetTargetPosdtargetTrans.pos,targetTrans.pos,0e;}else{myTrans.moveable=true;myTrans.SetTargetPosdmyData.targetPos,targetTrans.pos,atkDis+targetTrans.rangee;myData.lastAction=FSMState.Move;cc主动移动把状态设置为移动状态}returnFSMState.End;}}}﻿moduleECS{exportclassFSMStartStateextendsFSMStateBase{publicconstructorde{superde;}publicInitde{}publicEnterdentity:LogicEntity,dt:numbere:number{letmyData=aHeroDataComponentbentity.GetCompdComponentType.HeroDataComponente;ifdmyData.hpa=0ecc死亡{returnFSMState.End;}ifdLogicWarUtil.IsQueenTowerdmyData.shapeeecc公主塔没有AIreturnFSMState.End;letssc=aSkillStatusComponentbentity.GetCompdComponentType.SkillStatusComponente;ifdssc.IsLockHeroAIdee{ccthread.logd"-----FSMStartState----------------------",egret.getTimerdee;returnFSMState.End;}ifdssc.CheckUsePSkilldeecc触发锁定英雄的被动returnFSMState.End;ccreturnFSMState.End;cc寻找目标ifdmyData.isReTarget||myData.targetID==0e{returnFSMState.FindTarget;}else{lettarget=entity.world.logicHeroManager.GetHeroDatadmyData.targetIDe;ifdtarget!=null&&target.IsTargetValiddmyDataeereturnFSMState.Move;elsereturnFSMState.FindTarget;}}}}﻿moduleECS{exportclassFSMStateBase{publicInitde{}publicEnterdentity:EntityBase,dt:numbere:number{returnFSMState.End;}}}﻿cccareferencepath="..c..cFrameWorkcECScSystemBase.ts"cbmoduleECS{exportclassAISystemextendsLogicSystem{privatecallbackArray:Arrayagame.AttrCallBackb;publicInitde{super.Initde;this.callbackArray=newArrayagame.AttrCallBackbde;}publicDisposede{super.Disposede;}publicInitFilterde{this.filter=newInt32Arrayd1e;this.filter[0]=ComponentType.RealPlayerComponent;}cc响应服务器返回帧的操作行为publicFixedUpdateddeltaTime:numbere{letlist=this.GetEntityListde;fordletentityofliste{this.DoAIdentitye;}}privateDoAIdentity:EntityBasee{letplayerComp=aRealPlayerComponentbentity.GetCompdComponentType.RealPlayerComponente;ifdplayerComp==nullereturn;letwarComp=aWarComponentbthis.world.GetSingletonCompdComponentType.WarComponente;letselfFightRoleId=warComp.myFightRoleId;ifdselfFightRoleId!=playerComp.ide{ifdplayerComp.isRobot&&GameData.IsOtherAIethis.DoPlayerAIdplayerCompe;}else{ifdGameData.IsSelfAI&&!GameData.ReplayModeecc回放中不能操作this.DoPlayerAIdplayerCompe;}}privateTryAddHerodplayerComp:RealPlayerComponent,heroIconData:HeroIconData,heroData:game.CardDataItem,nodeArray:NodePoint[],atkType:numbere:boolean{letworldObj=this.world;letcontainerObj=worldObj.warContainer;letx,y;letcellSize=MathConst.MapCellSize;letnowFrame=worldObj.frameCount;letisPutSelfArea:boolean=LogicWarUtil.IsSelfAreadheroData.putTypee;letisRobot=playerComp.isRobot;letnode:NodePoint=null;letindex=nodeArray.length;whiledindexb=0ecc防止死循环{index--;ifdisRobotenode=LogicWarUtil.GetRandomItemdnodeArray,worldObje;elsenode=LogicWarUtil.GetRandomItem2dnodeArray,worldObje;ifd!node.walkableecontinue;x=node.x+0.5;y=node.y+0.5;ifdisPutSelfArea&&containerObj.IsInEnemyLockAreadx,y,atkType,1eecc只能放置在己方区域的卡牌continue;break;}ifdindexa=0ecc全部遍历完毕还是灭有找到合适的此次释放卡牌失败returnfalse;ccthread.logd"-------------此次遍历了:",nodeArray.length-index,"次"e;x=node.x+0.5;y=node.y+0.5;letshape=heroData.id;letinputData=newPlayerInputDatade;inputData.shape=shape;inputData.x=x*cellSize;inputData.y=y*cellSize;inputData.fightRoleId=playerComp.id;inputData.index=heroIconData.index;inputData.cardId=PlayerInputData.GetCardIDdplayerCompe;inputData.cmdId=PlayerInputData.GetCmdIDdplayerCompe;inputData.frameCount=this.world.frameCount;inputData.serverTime=FightServerTime.GetServerTimede;WarEvent.FireEventdGlobalEventType.InputAddHero,inputDatae;returntrue;}privateTryAddSpelldplayerComp:RealPlayerComponent,heroIconData:HeroIconData,cardData:game.CardDataItem,nodeArray:NodePoint[],atkType:numbere:boolean{letworldObj=this.world;letcontainerObj=worldObj.warContainer;letx,y;letcellSize=MathConst.MapCellSize;letnowFrame=worldObj.frameCount;letspellData=agame.SpellDataItembcardData;letisPutSelfArea:boolean=LogicWarUtil.IsSelfAreadspellData.putTypee;letisRobot=playerComp.isRobot;cc获取到所有符合条件的目标letskillId=spellData.normalSkillIdArray[0];letskobj=spellData.GetSkilldskillIde;ifdskobj==nulle{thread.errord"TryUseSpellerror1:",spellData.ide;returnfalse;}lettargetArray=worldObj.logicHeroManager.GetAllTargetdskobj.enemyType,playerComp.campType,falsee;letvalidHeroArray:EntityBase[]=[];letvalidTowerArray:EntityBase[]=[];cc统计所有的普通英雄单位和防御塔单位fordlettargetoftargetArraye{lettargetHeroData=aHeroDataComponentbtarget.GetCompdComponentType.HeroDataComponente;ifdskobj.landTypeArray.indexOfdtargetHeroData.landTypeea=-1econtinue;ifdskobj.heroTypeArray.indexOfdtargetHeroData.heroTypeea=-1econtinue;ifdisPutSelfAreaecc只能在己方区域放置的法术{lettrans=aTransformComponentbtarget.GetCompdComponentType.TransformComponente;ifdtrans==nullecontinue;x=trans.nodeX;y=trans.nodeY;ifdcontainerObj.IsInEnemyLockAreadx,y,atkType,1eecc敌方区域的所有目标都视为防御塔validTowerArray.pushdtargete;elsevalidHeroArray.pushdtargete;}else{ifdLogicWarUtil.IsTowerdtargetHeroData.shapeeecc防御塔validTowerArray.pushdtargete;elsevalidHeroArray.pushdtargete;}}cc随机出一个目标优先英雄其次是防御塔cc如果随机出来的英雄在敌方区域并且法术只能在己方区域释放cc把位置往己方区域x方向挪动ifdvalidHeroArray.lengthb0ecc优先英雄{lettarget=LogicWarUtil.GetRandomItemdvalidHeroArray,worldObje;lettrans=aTransformComponentbtarget.GetCompdComponentType.TransformComponente;x=trans.nodeX+0.5;y=trans.nodeY+0.5;}elseifdvalidTowerArray.lengthb0e{lettarget=LogicWarUtil.GetRandomItemdvalidTowerArray,worldObje;lettrans=aTransformComponentbtarget.GetCompdComponentType.TransformComponente;ifdisPutSelfAreaecc只能在己方放置随机到位置后x轴方向移动到己方位置为止{x=trans.nodeX+0.5;y=trans.nodeY+0.5;ifdplayerComp.atkType==AtkType.Attackecc如果攻击方左移x--{fordletx1=x;xb0;x--e{ifd!containerObj.IsInEnemyLockAreadx1,y,atkType,1ee{x=x1;break;}}}elsecc如果防守方右移x++{fordletx1=x;xaMathConst.GridCountX;x++e{ifd!containerObj.IsInEnemyLockAreadx1,y,atkType,1ee{x=x1;break;}}}}elsecc全场放置的法术{x=trans.nodeX+0.5;y=trans.nodeY+0.5;}}else{thread.logd"TryUseSpellerror2:",spellData.ide;returnfalse;}letshape=spellData.id;letinputData=newPlayerInputDatade;inputData.shape=shape;inputData.x=x*cellSize;inputData.y=y*cellSize;inputData.fightRoleId=playerComp.id;inputData.index=heroIconData.index;inputData.cardId=PlayerInputData.GetCardIDdplayerCompe;inputData.cmdId=PlayerInputData.GetCmdIDdplayerCompe;inputData.frameCount=this.world.frameCount;inputData.serverTime=FightServerTime.GetServerTimede;WarEvent.FireEventdGlobalEventType.InputAddSpell,inputDatae;returntrue;}cc选择一张卡牌坑位privateSelectCarddplayerComp:RealPlayerComponent,aiComp:AIComponente{letindexArray:number[]=[];fordletindex=0;indexaMathConst.MaxIconCount;index++e{letheroIconData=playerComp.GetHeroIconDatadindexe;ifdheroIconData==nullecontinue;ifdheroIconData.IsLockeddeecontinue;ifdheroIconData.costbplayerComp.GetMaxEnergydeecc最大能量不足continue;indexArray.pushdheroIconData.indexe;}ifdindexArray.lengthb0e{ifdplayerComp.isRobote{aiComp.selectIndex=LogicWarUtil.GetRandomItemdindexArray,this.worlde;}else{aiComp.selectIndex=LogicWarUtil.GetRandomItem2dindexArray,this.worlde;}}}cc使用这张卡牌privateTryUseCarddplayerComp:RealPlayerComponent,aiComp:AIComponente{letheroIconData=playerComp.GetHeroIconDatadaiComp.selectIndexe;ifdheroIconData==nulle{thread.errord"AISystem.TryUseCardselectIndexisnullerror:",aiComp.selectIndexe;aiComp.selectIndex=-1;return;}letheroObj=agame.HeroDataItembplayerComp.GetHeroDatadheroIconData.shapee;ifdheroObj==nulle{thread.errord"AISystem.TryUseCardheroObjisnullerror:",heroIconData.shapee;aiComp.selectIndex=-1;return;}ifdheroObj.costbplayerComp.GetEnergyPrecisedeereturn;letnowFrame=this.world.frameCount;letcontainerObj=this.world.warContainer;letatkType=playerComp.atkType;letlandGridNodeArray=containerObj.landGridNodePointInfo.getdatkTypee;letairGridNodeArray=containerObj.airGridNodePointInfo.getdatkTypee;letaddHeroRet:boolean=false;ifdLogicWarUtil.IsSpelldheroObj.idee{ifdheroObj.landType==LandType.LandeaddHeroRet=this.TryAddSpelldplayerComp,heroIconData,heroObj,landGridNodeArray,atkTypee;elseaddHeroRet=this.TryAddSpelldplayerComp,heroIconData,heroObj,airGridNodeArray,atkTypee;}else{ifdheroObj.landType==LandType.LandeaddHeroRet=this.TryAddHerodplayerComp,heroIconData,heroObj,landGridNodeArray,atkTypee;elseaddHeroRet=this.TryAddHerodplayerComp,heroIconData,heroObj,airGridNodeArray,atkTypee;}aiComp.selectIndex=-1;ifd!addHeroRete{return;}cc每一帧只做一次操作aiComp.lastActionFrame=nowFrame;}privateDoPlayerAIdplayerComp:RealPlayerComponente{letaiComp=aAIComponentbplayerComp.entity.GetCompdComponentType.AIComponente;letnowFrame=this.world.frameCount;ifdnowFramea50ecc开局5s内不下兵return;ifdnowFrame-aiComp.lastActionFramea=5ecc操作间隔不得超过5帧return;ifdaiComp.selectIndex==-1ethis.SelectCarddplayerComp,aiCompe;elsethis.TryUseCarddplayerComp,aiCompe;}privateDoOtherAIdplayerComp:RealPlayerComponente{letaiComp=aAIComponentbplayerComp.entity.GetCompdComponentType.AIComponente;letnowFrame=this.world.frameCount;ifdnowFrame-aiComp.lastActionFramea=5ecc操作间隔不得超过帧return;letcontainerObj=this.world.warContainer;letatkType=playerComp.atkType;letlandGridNodeArray=containerObj.landGridNodePointInfo.getdatkTypee;letairGridNodeArray=containerObj.airGridNodePointInfo.getdatkTypee;letlandDragHeroData;fordletindex=0;indexaMathConst.MaxIconCount;index++e{letheroIconData=playerComp.GetHeroIconDatadindexe;ifdheroIconData==nullecontinue;ifdheroIconData.IsLockeddeecontinue;ifdheroIconData.iconType==2ecc放技能{letheroDataComp=this.world.logicHeroManager.GetHeroDatadheroIconData.ide;ifdheroDataComp!=null&&heroDataComp.forbidActiveSkillCounta=0&&heroDataComp.GetSkillEnergydeb=WarSettings.MaxSkillEnergyecc每一帧只做一次操作{ccplayerComp.LockHeroIcondindexe;letinputData=newPlayerInputDatade;inputData.heroId=heroIconData.id;inputData.fightRoleId=playerComp.id;inputData.index=heroIconData.index;inputData.cardId=PlayerInputData.GetCardIDdplayerCompe;inputData.cmdId=PlayerInputData.GetCmdIDdplayerCompe;inputData.frameCount=this.world.frameCount;inputData.serverTime=FightServerTime.GetServerTimede;WarEvent.FireEventdGlobalEventType.InputHeroSkill,inputDatae;cc优先释放技能aiComp.lastActionFrame=nowFrame;return;}}elsecc拖拽英雄{letheroObj=agame.HeroDataItembplayerComp.GetHeroDatadheroIconData.shapee;ifdheroObj!=null&&heroObj.costa=playerComp.GetEnergyPrecisedee{letaddHeroRet:boolean=false;ifdheroObj.landType==LandType.LandeaddHeroRet=this.TryAddHerodplayerComp,heroIconData,heroObj,landGridNodeArray,atkTypee;elseaddHeroRet=this.TryAddHerodplayerComp,heroIconData,heroObj,airGridNodeArray,atkTypee;ifdaddHeroRetecc每一帧只做一次操作{aiComp.lastActionFrame=nowFrame;return;}}}}}privateDoSelfAIdplayerComp:RealPlayerComponente{letaiComp=aAIComponentbplayerComp.entity.GetCompdComponentType.AIComponente;letnowFrame=this.world.frameCount;ifdnowFrame-aiComp.lastActionFramea=Math.randomde*100ecc操作间隔不得超过帧return;letcontainerObj=this.world.warContainer;letatkType=playerComp.atkType;letlandGridNodeArray=containerObj.landGridNodePointInfo.getdatkTypee;letairGridNodeArray=containerObj.airGridNodePointInfo.getdatkTypee;letlandDragHeroData;fordletindex=0;indexaMathConst.MaxIconCount;index++e{letheroIconData=playerComp.GetHeroIconDatadindexe;ifdheroIconData==nullecontinue;ifdheroIconData.IsLockeddeecontinue;ifdheroIconData.iconType==2ecc放技能{letheroDataComp=this.world.logicHeroManager.GetHeroDatadheroIconData.ide;ifdheroDataComp!=null&&heroDataComp.forbidActiveSkillCounta=0&&heroDataComp.GetSkillEnergydeb=WarSettings.MaxSkillEnergyecc每一帧只做一次操作{ccplayerComp.LockHeroIcondindexe;letinputData=newPlayerInputDatade;inputData.heroId=heroIconData.id;inputData.fightRoleId=playerComp.id;inputData.index=heroIconData.index;inputData.cardId=PlayerInputData.GetCardIDdplayerCompe;inputData.cmdId=PlayerInputData.GetCmdIDdplayerCompe;inputData.frameCount=this.world.frameCount;inputData.serverTime=FightServerTime.GetServerTimede;WarEvent.FireEventdGlobalEventType.InputHeroSkill,inputDatae;cc优先释放技能aiComp.lastActionFrame=nowFrame;ccthread.logd"---开始自动放技能---------------------------------------------------------------",index,egret.getTimerdee;return;}}elsecc拖拽英雄{letheroObj=agame.HeroDataItembplayerComp.GetHeroDatadheroIconData.shapee;ifdheroObj!=null&&heroObj.costa=playerComp.GetEnergyPrecisedee{letaddHeroRet:boolean=false;ifdheroObj.landType==LandType.LandeaddHeroRet=this.TryAddHerodplayerComp,heroIconData,heroObj,landGridNodeArray,atkTypee;elseaddHeroRet=this.TryAddHerodplayerComp,heroIconData,heroObj,airGridNodeArray,atkTypee;ifdaddHeroRetecc每一帧只做一次操作{aiComp.lastActionFrame=nowFrame;return;}}}}}}}﻿moduleECS{cc帧结束系统部分操作需要放到帧的最后执行统一放到这里exportclassFrameEndSystemextendsLogicSystem{privateframeEndActionArray:Arrayaanyb;publicInitde{super.Initde;WarEvent.SubscribedGlobalEventType.AddFrameEndAction,this.AddFrameEndAction,thise;this.frameEndActionArray=[];}publicDisposede{WarEvent.UnSubscribedGlobalEventType.AddFrameEndAction,this.AddFrameEndAction,thise;this.frameEndActionArray.length=0;super.Disposede;}cc在帧结束需要执行的行为privateAddFrameEndActiondfunc:Function,thisObj:any,args:anye{this.frameEndActionArray.pushd[func,thisObj,args]e;}publicFixedUpdateddeltaTime:numbere{fordletinfoofthis.frameEndActionArraye{letfunc:Function=info[0];letthisObj:any=info[1];letargs:any=info[2];func.calldthisObj,argse;}this.frameEndActionArray.length=0;}}}﻿moduleECS{exportclassInitSystemextendsLogicSystem{publiceventIdArray:Arraya[string,number]b;publicconstructorde{superde;}publicInitde{super.Initde;this.eventIdArray=newArraya[string,number]bde;letkey_info=this.world.addEventCBd"OnEntityOptimizeCreated",this.OnEntityOptimizeCreated,thise;this.eventIdArray.pushdkey_infoe;key_info=this.world.addEventCBd"OnEntityOptimizeDestroyed",this.OnEntityOptimizeDestroyed,thise;this.eventIdArray.pushdkey_infoe;WarEvent.SubscribedGlobalEventType.ClientReadyAddHero,this.ClientReadyAddHero,thise;WarEvent.SubscribedGlobalEventType.ClientReadyAddSpell,this.ClientReadyAddSpell,thise;WarEvent.SubscribedGlobalEventType.ServerReadyAddHero,this.ServerReadyAddHero,thise;WarEvent.SubscribedGlobalEventType.ServerReadyAddSpell,this.ServerReadyAddSpell,thise;}publicDisposede{letkey_info;fordvari=0;iathis.eventIdArray.length;++ie{key_info=this.eventIdArray[i];this.world.removeEventCBdkey_info[0],key_info[1]e;}WarEvent.UnSubscribedGlobalEventType.ServerReadyAddHero,this.ServerReadyAddHero,thise;WarEvent.UnSubscribedGlobalEventType.ServerReadyAddSpell,this.ServerReadyAddSpell,thise;super.Disposede;}publicOnEntityOptimizeCreateddentity:LogicEntitye{ccthread.logd"-----InitSystem.-OnEntityOptimizeCreated----bbbbbbbbbbbb",entity.ide;letheroData=aHeroDataComponentbentity.GetCompdComponentType.HeroDataComponente;ifdheroData==nullereturn;this.world.logicHeroManager.AddHerodentity.id,entitye;letssc=aSkillStatusComponentbentity.GetCompdComponentType.SkillStatusComponente;ifdssc!=nulle{ssc.InitCDSourcede;ssc.InitSkillTriggerde;}this.OnEnterWardentitye;}publicOnEnterWardentity:EntityBaseecc登场{letheroData=aHeroDataComponentbentity.GetCompdComponentType.HeroDataComponente;ifdheroData==nulle{thread.errord"--InitSystem.OnCreateRenderObjectheroDataisnull!!!--",entity.ide;return;}ifdLogicWarUtil.IsTowerdheroData.shapeeecc防御塔直接上场{this.HeroEnterWardentitye;return;}ifdheroData.callHeroTypeb0e{ifdheroData.callHeroType==1ethis.OnCallHeroReadydentitye;elsethis.OnCallHeroReadydentitye;return;}}publicClientReadyAddHerodcardId:number,playeId:numbere{ccthread.logd"------InitSystem.ClientReadyAddHero-------",cardId,FightServerTime.GetServerTimede,this.world.frameCounte;letplayerComp=aRealPlayerComponentbLogicWorld.GetInstancede.GetCompByIDdplayeId,ComponentType.RealPlayerComponente;ifdplayerComp!=null&&playerComp.IsMySelfde&&!GameData.IsSelfAIeSNetWar.FireEventdGlobalEventType.ClientReadyAddHero,cardIde;}publicClientReadyAddSpelldcardId:number,playeId:numbere{letplayerComp=aRealPlayerComponentbLogicWorld.GetInstancede.GetCompByIDdplayeId,ComponentType.RealPlayerComponente;ifdplayerComp!=null&&playerComp.IsMySelfdeeSNetWar.FireEventdGlobalEventType.ClientReadyAddSpell,cardIde;}publicServerReadyAddHerodcardId:number,shape:number,x:number,y:number,playeId:number,idArray:number[]e{ccthread.logd"-------ServerReadyAddHero-------",egret.getTimerde,this.world.frameCounte;SNetWar.FireEventdGlobalEventType.ServerReadyAddHero,cardId,shape,x,y,playeId,idArraye;ifdshape==0ecc使用英雄卡牌失败{thread.logd"------ServerFailAddHero-----------",egret.getTimerdee;return;}letplayerComp=aRealPlayerComponentbLogicWorld.GetInstancede.GetCompByIDdplayeId,ComponentType.RealPlayerComponente;letheroDataItem=agame.HeroDataItembplayerComp.GetHeroDatadshapee;ifdheroDataItem==nulle{thread.errord"ServerReadyAddHeroerror",shapee;return;}fordletheroIdofidArraye{letentity=this.world.GetEntitydheroIde;letstateComp=aStateComponentbentity.GetCompdComponentType.StateComponente;letheroData=aHeroDataComponentbentity.GetCompdComponentType.HeroDataComponente;letstateObj:StateDataBase;cc准备中d禁止移动禁止攻击不可以被锁定不可以被攻击ecc军团卡牌里面的每个英雄的延迟时间不一致d配表eifdheroData.delayFrameb0e{stateObj=stateComp.AddStatedMathConst.PrepareMagicID,0,nulle;ifdstateObj!=nulle{stateObj.ChangeTimedheroData.delayFrame*100e;cc设置准备时间}else{thread.errord"AddPrepareMagicIDBuffError---bbbbbbbbbbbb!!!!"e;}}cc真正的部署时间为d部署时间+延迟时间ecc策划要求：比如骷髅军团每个小骷髅的出现时间有延迟d不止是表现延迟在延迟时间内不可被攻击ecc每个骷髅军团的部署时间也不一致比如第一只的部署时间1s+0s第二只的部署时间为1s+0.1sd其中0.1为延迟时间eletdeployTime=heroDataItem.deployTime+heroData.delayFrame*100;cc计算部署结束帧letpreDeployEndFrame=this.world.frameCount+deployTimecMathConst.KeyFrameTime;this.world.AddFrameCallbackdpreDeployEndFrame,this.HeroEnterWar,true,this,entitye;cc部署中d禁止移动禁止攻击可以被攻击estateObj=stateComp.AddStatedMathConst.DeployMagicID,0,nulle;ifdstateObj!=nulle{stateObj.ChangeTimeddeployTimee;cc设置部署时间}else{thread.errord"AddDeployMagicIDBuffError---bbbbbbbbbbbb!!!!"e;}ifdheroData!=nulle{cc触发入场技能SkillCB.RunOnEnterCBdheroDatae;}}}publicServerReadyAddSpelldcardId:number,shape:number,x:number,y:number,playeId:numbere{SNetWar.FireEventdGlobalEventType.ServerReadyAddSpell,cardId,shape,x,y,playeIde;ifdshape==0ecc使用法术失败{thread.logd"------ServerFailAddSpell-----------",egret.getTimerdee;}letplayerComp=aRealPlayerComponentbLogicWorld.GetInstancede.GetCompByIDdplayeId,ComponentType.RealPlayerComponente;letheroData=agame.SpellDataItembplayerComp.GetHeroDatadshapee;ifdheroData==nulle{thread.errord"ServerReadyAddSpellerror",shapee;return;}}cc英雄正式上场privateHeroEnterWardentity:EntityBasee{ccifdSettings.logecc{ccthread.logd"HeroEnterWar---bbbbframe:",this.world.frameCount,"time:",egret.getTimerdee;ccreturn;cc}letheroData=aHeroDataComponentbentity.GetCompdComponentType.HeroDataComponente;letstateComp=aStateComponentbentity.GetCompdComponentType.StateComponente;stateComp.RemoveStatedMathConst.PrepareMagicID,1e;cc删除准备状态stateComp.RemoveStatedMathConst.DeployMagicID,1e;cc删除部署状态ifd!LogicWarUtil.IsTowerdheroData.shapee&&heroData.hpb0e{lettrans=aTransformComponentbentity.GetCompdComponentType.TransformComponente;trans.hasCollide=GameData.HeroCollide;cc部署完毕开始产生碰撞cc找一个没有阻挡的位置摆放英雄ifdtrans.node!=nulletrans.node.removeHerodtrans.ide;cc临时移除该格子的碰撞letpos=this.world.warContainer.GetWalkablePosdtrans.pos.x,trans.pos.y,trans.landType,heroData.putType,heroData.campType,heroData.atkTypee;ifdtrans.node!=nulletrans.node.addHerodtrans.ide;cc碰撞恢复ifdpos==nulle{thread.errordtrans.id,"---HeroEnterWar--GetWalkablePosError:"e;}else{trans.SetTransPosdpos[0],pos[1],truee;}ccthread.logdtrans.id,"---HeroEnterWar--after:",trans.pos.tostringde,"before:",str1,"----bbb",pos.toStringdee;}SNetWar.FireEventdGlobalEventType.LogicHeroEnterWar,entity.ide;}cc召唤类英雄出场动画publicOnCallHeroReadydentity:EntityBasee{letheroData=aHeroDataComponentbentity.GetCompdComponentType.HeroDataComponente;letprepareFrame:number=WarData.CallHeroAni_Time1cMathConst.KeyFrameTime;cc准备中d不可被攻击禁止移动禁止攻击eletstateComp=aStateComponentbentity.GetCompdComponentType.StateComponente;letstateObj=stateComp.AddStatedMathConst.PrepareMagicID,0,nulle;ifdstateObj!=nulle{stateObj.ChangeTimedprepareFrame*100e;}else{thread.errord"OnCallHeroReadyAddPrepareMagicIDBuffError---bbbbbbbbbbbb!!!!"e;return;}cccc计算准备准备结束帧letpreDeployEndFrame=this.world.frameCount+prepareFrame;this.world.AddFrameCallbackdpreDeployEndFrame,this.HeroEnterWar,true,this,entitye;}publicOnEntityOptimizeDestroyeddentity:EntityBasee{letssc=aSkillStatusComponentbentity.GetCompdComponentType.SkillStatusComponente;ifdssc!=nulle{ssc.DisposeSkillTriggerde;}letheroData=aHeroDataComponentbentity.GetCompdComponentType.HeroDataComponente;ifdheroData!=nulle{this.world.logicHeroManager.RemoveHerodentity.ide;}entity.Disposede;cc在这里做彻底的释放}publicFixedUpdateddeltaTime:numbere{}}}﻿moduleECS{exportclassInputSystemextendsLogicSystem{privateselfCommandArray:CommandComponent[];privateotherCommandArray:CommandComponent[];publicInitde{super.Initde;this.selfCommandArray=newArrayaCommandComponentbde;this.otherCommandArray=newArrayaCommandComponentbde;WarEvent.SubscribedGlobalEventType.InputAddHero,this.InputAddHero,thise;WarEvent.SubscribedGlobalEventType.InputAddSpell,this.InputAddSpell,thise;WarEvent.SubscribedGlobalEventType.InputHeroSkill,this.InputHeroSkill,thise;}publicDisposede{super.Disposede;WarEvent.UnSubscribedGlobalEventType.InputAddHero,this.InputAddHero,thise;WarEvent.UnSubscribedGlobalEventType.InputAddSpell,this.InputAddSpell,thise;WarEvent.UnSubscribedGlobalEventType.InputHeroSkill,this.InputHeroSkill,thise;}publicInitFilterde{this.filter=newInt32Arrayd1e;this.filter[0]=ComponentType.PlayerCommandRecordComponent;}publicInputAddHerodinputData:PlayerInputDatae{game.Utils.UpdateProtoTypedinputDatae;cc告诉服务器我这个英雄放下去之后要延迟1s才能放到场景中d播放法力消耗动画同时对抗网络延迟eletdelayFrame=Math.floordWarData.DeployAni_Time1cMathConst.KeyFrameTimee;ccletminFrame=this.world.recordManager.GetFrameByTimedinputData.serverTime,inputData.frameCount,this.world.frameCounte+delayFrame;letminFrame=this.world.frameCount+delayFrame;ifdSettings.logethread.logd"InputAddHerobbb",this.world.frameCount,inputData.toStringdee;letcmd=aCommandComponentbWarFactory.CreateComponentdComponentType.CommandComponent,this.worlde;cmd.id=inputData.fightRoleId;letargs=inputData.GetSendArgsde;cmd.AddCmdDatadCommandType.AddHero,args,minFramee;letplayerComp=aRealPlayerComponentbthis.world.GetCompByIDdcmd.id,ComponentType.RealPlayerComponente;ifd!playerComp.isRobotethis.selfCommandArray.spliced0,0,cmde;elsethis.otherCommandArray.spliced0,0,cmde;}publicInputAddSpelldinputData:PlayerInputDatae{game.Utils.UpdateProtoTypedinputDatae;cc告诉服务器我这个英雄放下去之后要延迟1s才能放到场景中d播放法力消耗动画同时对抗网络延迟eletdelayFrame=Math.floordWarData.DeployAni_Time1cMathConst.KeyFrameTimee;ccletminFrame=this.world.recordManager.GetFrameByTimedinputData.serverTime,inputData.frameCount,this.world.frameCounte+delayFrame;letminFrame=this.world.frameCount+delayFrame;ifdSettings.logethread.logd"InputAddSpellbbb",this.world.frameCount,inputData.toStringdee;letcmd=aCommandComponentbWarFactory.CreateComponentdComponentType.CommandComponent,this.worlde;cmd.id=inputData.fightRoleId;letargs=inputData.GetSendArgsde;cmd.AddCmdDatadCommandType.AddSpell,args,minFramee;letplayerComp=aRealPlayerComponentbthis.world.GetCompByIDdcmd.id,ComponentType.RealPlayerComponente;ifd!playerComp.isRobotethis.selfCommandArray.spliced0,0,cmde;elsethis.otherCommandArray.spliced0,0,cmde;}publicInputHeroSkilldinputData:PlayerInputDatae{game.Utils.UpdateProtoTypedinputDatae;letminFrame=0;ccthread.logd"InputHeroSkillbbbid:",id,"time:",egret.getTimerdee;letcmd=aCommandComponentbWarFactory.CreateComponentdComponentType.CommandComponent,this.worlde;cmd.id=inputData.fightRoleId;letargs=[inputData.heroId,inputData.cmdId,inputData.index];cmd.AddCmdDatadCommandType.UseSkill,args,minFramee;letplayerComp=aRealPlayerComponentbthis.world.GetCompByIDdcmd.id,ComponentType.RealPlayerComponente;ifd!playerComp.isRobotethis.selfCommandArray.spliced0,0,cmde;elsethis.otherCommandArray.spliced0,0,cmde;}cc响应服务器返回帧的操作行为publicFixedUpdateddeltaTime:numbere{letlist:ArrayaEntityBaseb=this.GetEntityListde;letentity:EntityBase;letframeCount=this.world.frameCount;fordleti=0;ialist.length;++ie{entity=list[i];letpcrc:PlayerCommandRecordComponent=aPlayerCommandRecordComponentbentity.GetCompdComponentType.PlayerCommandRecordComponente;letcmd:CommandComponent=pcrc.GetInputCachedframeCounte;ifdcmd==null||cmd.IsEmptyde||cmd.isExcuteecontinue;ifdSettings.loge{ccthread.logd"InputSystemExecuteCommand---bbbbframe:",this.world.frameCount,"time:",egret.getTimerdee;}cc真正执行操作比如部署完毕后让英雄进入战斗this.world.commandManager.ExecuteCommanddcmd,truee;cc防止某个操作多次执行cmd.isExcute=true;}}cc处理用户的输入并打包发送到服务器publicBeforeFixedUpdateddeltaTime:numbere{letwarComp=aWarComponentbthis.world.GetSingletonCompdComponentType.WarComponente;ifdthis.selfCommandArray.lengthb0ecc自己的操作要发送到服务器等服务器回包再真正执行客户端每一帧最多发出一个操作数据{letcmd=this.selfCommandArray.popde;cccc客户端自己先行执行不影响流程的逻辑比如先部署英雄等服务器数据回来后再真正进入战斗this.world.commandManager.ExecuteCommanddcmd,falsee;letcmdData=cmd.GetCmdDatade;ccC2S的指令客户端保证每帧只有一条指令SNetWar.Logic2Serverd"NetWar","C2SCommandMsg",warComp.roomId,cmdData.action,cmd.id,cmdData.minFrame,cmdData.argse;cmd.Disposede;ifdSettings.loge{ccthread.logd"SelfCommandLogicC2SCommandMsg---bbbbframe:",this.world.frameCount,"time:",egret.getTimerdee;}}ifdthis.otherCommandArray.lengthb0ecc其他人的操作直接放到帧队列里去等待执行{letcmd=this.otherCommandArray.popde;cccc客户端自己先行执行不影响流程的逻辑比如先部署英雄等服务器数据回来后再真正进入战斗this.world.commandManager.ExecuteCommanddcmd,falsee;letpcrc=aPlayerCommandRecordComponentbthis.world.GetCompByIDdcmd.id,ComponentType.PlayerCommandRecordComponente;cc机器人的操作不走服务器转发直接客户端内部处理d需要保证不同机器上的AI行为是一致的ecc机器人的操作放到下一帧执行letnextCmd=pcrc.GetInputCachedthis.world.frameCount+1e;ifdnextCmd==nulle{nextCmd=aCommandComponentbWarFactory.CreateComponentdComponentType.CommandComponent,this.worlde;nextCmd.id=pcrc.id;nextCmd.frame=this.world.frameCount+1;nextCmd.entity=pcrc.entity;pcrc.RecordCommanddnextCmde;}letcmdData=cmd.GetCmdDatade;ifdcmdData.action!=0enextCmd.AddCmdDatadcmdData.action,cmdData.args,cmdData.minFramee;cmd.Disposede;ifdSettings.loge{ccthread.logd"SelfCommandLogicC2SCommandMsg---bbbbframe:",this.world.frameCount,"time:",egret.getTimerdee;}}this.FrameCheckde;ccletlist:ArrayaEntityBaseb=this.GetEntityListde;ccletentity:EntityBase;ccfordleti=0;ialist.length;++iecc{ccentity=list[i];ccifdentity.GetExistCompdComponentType.SelfComponenteecc{ccthis.SelfCommandLogicdentitye;cc}ccelsecc{ccthis.OtherCommandLogicdentitye;cc}cc}}publicUpdateddeltaTime:numbere{this.FrameCheckde;}publicUpdateByPauseddeltaTime:numbere{this.FrameCheckde;}privatelastCheckTime:number=0;cc完整性校验publicFrameCheckde{letnowTime=egret.getTimerde;cc1秒校验一次ifdnowTime-this.lastCheckTimea1000ereturn;this.lastCheckTime=nowTime;letworldObj=this.world;letfdcc=aFrameDataCacheComponentbworldObj.GetSingletonCompdComponentType.FrameDataCacheComponente;letmissFrameArray=fdcc.GetMissFrameArrayde;ifdmissFrameArray.lengthb0ecc补帧{SNetWar.Logic2Serverd"NetWar","C2SActionFrame",missFrameArraye;}}publicSelfCommandLogicdentity:EntityBasee{ccifdthis.selfCommandArray.lengthb0ecc客户端每一帧最多发出一个操作数据cc{ccletcmd=this.selfCommandArray.popde;cccc客户度自己先行执行不影响流程的逻辑比如先部署英雄等服务器数据回来后再真正进入战斗ccthis.world.commandManager.ExecuteCommanddcmd,falsee;ccClientNet.NetWar.C2SCommandMsgdthis.world.prewarData.roomId,cmde;ccifdSettings.logecc{ccccthread.logd"SelfCommandLogicC2SCommandMsg---bbbbframe:",this.world.frameCount,"time:",egret.getTimerdee;cc}ccreturn;cc}ccletpcrc:PlayerCommandRecordComponent=aPlayerCommandRecordComponentbentity.GetCompdComponentType.PlayerCommandRecordComponente;ccletframeCount=this.world.frameCount;ccletcmd:CommandComponent=pcrc.GetInputCachedframeCounte;ccifdcmd==nullecc{ccccTODONIU客户端自己不预测等待服务器过来后写入缓存cccccmd=newCommandComponentde;cccccmd.frame=frameCount;ccccthis.BuildCommanddcmde;ccccrc.RecordCommanddcmde;cc}cc读取上一帧的数据发送给服务器ccletrecord=rc.GetInputCachedframeCount-1e;ccifdrecord!=null&&record.EqualsCmddcmdeecc如果在这一帧的操作和上一帧相同cc{ccthis.sameCmdCache.frame=frameCount;ccthis.sameCmdCache.id=entity.id;ccNetWar.C2SSameCommanddthis.sameCmdCachee;cc}ccelsecc{cccmd.frame=frameCount;cccmd.id=entity.id;ccNetWar.C2SSameCommanddcmde;cc}ccentity.ChangeCompdcmde;TODONIU这个暂时用不上吧}publicOtherCommandLogicdentity:EntityBasee{ccletrc:PlayerCommandRecordComponent=aPlayerCommandRecordComponentbentity.GetCompdComponentType.PlayerCommandRecordComponente;ccletframeCount=this.world.frameCount;cccc先读取服务器缓存ccletcmd:CommandComponent=rc.GetInputCachedframeCounte;ccifdcmd==nullecc{cccc没有的话预测一份cccccmd=rc.GetForecastInputdframeCounte;cc}ccentity.ChangeCompdcmde;ccTODONIU这个暂时用不上吧}}}﻿moduleECS{exportclassMoveTransformSystemextendsLogicSystem{publicconstructorde{superde;}publicInitFilterde{this.filter=newInt32Arrayd1e;this.filter[0]=ComponentType.TransformComponent;}publicInitde{super.Initde;}publicDisposede{super.Disposede;}publicFixedUpdateddt:numbere{letlist=this.GetEntityListde;fordleti=0;ialist.length;++ie{this.DoMovedlist[i],dte;this.DoBloyFlydlist[i],dte;}}publicDoMovedentity:EntityBase,dt:numbere{lettrans=aTransformComponentbentity.GetCompdComponentType.TransformComponente;ifdtrans==nullereturn;ifdtrans.moveSpeed==0ereturn;ifd!trans.moveableereturn;letpath:NodePoint[]=trans.GetPathde;ifdpath==null||path.length==0ecc没有路径{ccthread.logd"____找不到路径_______________",trans.pathe;return;}letlen=path.length;letnode:NodePoint=path[0];ifd!node.canPutOnNodedtranseecc该单位不能放置在该格子上面return;ifd!game.Utils.isFixedNumberdnode.xe||!game.Utils.isFixedNumberdnode.yee{thread.warnd"MoveTransformSystemnodefixederror:",node.x,node.ye;}letcellSize=MathConst.MapCellSize;lettargetX:number=node.x*cellSize+cellSizec2;lettargetY:number=node.y*cellSize+cellSizec2;letdx:number=targetX-trans.pos.x;letdy:number=targetY-trans.pos.y;letmoveSpeed=trans.moveSpeed;moveSpeed=moveSpeed*dtc1000;lettargetDis=Math.sqrtddx*dx+dy*dye;cc距离目标点的距离ifdtargetDis==0e{ccTODO这里的thread.warn不能注释掉这里是因为js本身的浮点数误差造成的比如一个数字是4.99993赋值给Vector2.x后就变成了5ccthread.warnd"---bbbbbbbb这是一个bugbbbbbbpos:",trans.pos.tostringde,"-----bbbtarget:",targetX,targetY,"-------id:",trans.id,"",this.world.frameCounte;trans.RemoveFirstNodede;this.DoMovedentity,dte;return;ccthread.logd"---bbbbbbbbbbbbbbpos:",trans.pos.tostringde,"-----bbbtarget:",targetX,targetY,"-------id:",trans.id,"",path.lengthe;}ccifdtrans.id==1023ecc{ccletstr="";ccfordletnodeofpathecc{ccccstr+=`[x:${node.x*cellSize+cellSizec2},y:${node.y*cellSize+cellSizec2}]`;ccletkeys=node.heroInfo.keysde;ccifdkeys.lengthb0eccstr+=`[x:${node.x},y:${node.y},heroInfo:${keys[0]}]`;cc}ccthread.logd"--1023MoveTransformSystem.DoMove-bbbbbbbbbbbbbbpos:",trans.pos.tostringde,"-----bbbtarget:",targetX,targetY,"-------frame:",this.world.frameCount,"",stre;ccccifdMath.floordtrans.pos.xe==427&&Math.floordtrans.pos.ye==217ecccc{ccccthread.logd"---bbbbbbbbbbbbbb额外的打印.............."e;cccc}cc}letdir=newVector2d[dxctargetDis*moveSpeed,dyctargetDis*moveSpeed]e;dir.adddtrans.moveSpeedDirAdde;cc加上buff加成的移动速度trans.realMoveSpeed=dir.lengthde*1000cdt;dir.copydtrans.realMoveDire;letrealMoveDis=dir.lengthde;ifdrealMoveDisb=targetDisecc这一段路径移动完毕{letnextNode=this.world.warContainer.GetNodedtargetX,targetY,trans.landTypee;cc如果要移动的下一个格子上已经有单位在上面了就不移动ifd!nextNode.canPutOnNodedtranseecc该单位不能放置在该格子上面{thread.errord"------------走到了阻挡上面了-------22222222-----"e;return;}letscaleValue=targetDiscrealMoveDis;dir.scaledscaleValuee;targetX=game.Utils.toFixedNumberdtargetXe;cc精度处理targetY=game.Utils.toFixedNumberdtargetYe;trans.SetTransPosdtargetX,targetYe;trans.totalMoveDis+=targetDis;cc累加移动的距离trans.RemoveFirstNodede;ifdscaleValuea1ethis.DoMovedentity,dt*d1-scaleValueee;}else{targetX=trans.pos.x+dir.x;targetY=trans.pos.y+dir.y;targetX=game.Utils.toFixedNumberdtargetXe;cc精度处理targetY=game.Utils.toFixedNumberdtargetYe;realMoveDis=MathUtil.distance2dtrans.pos.x,trans.pos.y,targetX,targetYe;letnextNode=this.world.warContainer.GetNodedtargetX,targetY,trans.landTypee;cc如果要移动的下一个格子上已经有单位在上面了就不移动ifd!nextNode.canPutOnNodedtranseecc该单位不能放置在该格子上面{thread.errord"------------走到了阻挡上面了-------22222222-----"e;return;}trans.SetTransPosdtargetX,targetYe;trans.totalMoveDis+=realMoveDis;cc累加移动的距离}ccifdtrans.id==1015eccthread.logd"________MoveTransformSystem_11111_________________",trans.pos.tostringde,path.length,egret.getTimerdee;}publicDoBloyFlydentity:EntityBase,dt:numbere{lettrans=aTransformComponentbentity.GetCompdComponentType.TransformComponente;ifdtrans==nullereturn;trans.UpdateBlowFlyddte;}}}﻿moduleECS{exportclassOptimsticSyncSystemextendsLogicSystem{privatetimerKey:number;publicInitde{super.Initde;WarEvent.SubscribedGlobalEventType.SyncMessage,this.OnRecieveSyncMessage,thise;thread.logd"-----OptimsticSyncSystem.initde-----bbbbbbbbbbbbbbbbbbbbbbbbbbbb"e;}publicDisposede{WarEvent.UnSubscribedGlobalEventType.SyncMessage,this.OnRecieveSyncMessage,thise;game.TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=null;super.Disposede;}privateOnRecieveSyncMessagedmainID:number,data:anye{ifdmainID==Protocol.MessageID.FIGHT_RECONNECT_ACTION_RESethis.ReceviceReconnectMsgddatae;elseifdmainID==Protocol.MessageID.ACTIONFRAME_RESethis.ReceviceCommandMsgArrayddatae;ccelseifdmainID==NetS2CConst.AffirmMsgeccthis.ReceviceAffirmMsgddatae;elseifdmainID==Protocol.MessageID.ACTION_RESethis.RecieveCommandMsgddata,truee;}cc重连帧privateReceviceReconnectMsgddata:anye{letmsg=aProtocol.FightReconnectRoom_Respondbdata;letworldObj=this.world;cc处理有操作的帧letprocessedInfo:SMapanumber,numberb=newSMapanumber,numberbde;fordletactionofmsg.actionse{processedInfo.setdaction.frame,action.framee;this.RecieveCommandMsgdaction,falsee;}cc处理空帧letemptyAction;fordleti=1;ia=msg.maxframe;i++e{ifdprocessedInfo.hasdieecontinue;emptyAction=newProtocol.Action_Responsede;emptyAction.actionArray=[];emptyAction.frame=i;this.RecieveCommandMsgdemptyAction,falsee;}}cc补帧privateReceviceCommandMsgArrayddata:anye{ccifddata!=nulleccreturn;letmsg=aProtocol.ActionFrame_Responsebdata;letworldObj=this.world;cc处理有操作的帧letprocessedInfo:SMapanumber,numberb=newSMapanumber,numberbde;fordletactionofmsg.actionse{processedInfo.setdaction.frame,action.framee;this.RecieveCommandMsgdaction,falsee;}}privateReceviceAffirmMsgddata:anye{ccletcmd=aCommandComponentbdata;ccletworldObj=this.world;}cc正常帧推送privateRecieveCommandMsgddata:any,check:booleane{letmsg=aProtocol.Action_Responsebdata;letwarComp=aWarComponentbthis.world.GetSingletonCompdComponentType.WarComponente;warComp.lastFrameTime=egret.getTimerde;letworldObj=this.world;ccthread.logdmsg.frame,"_______RecieveCommandMsg_____________isStart:_",worldObj.isStarte;ifdworldObj==nullereturn;letfdcc=aFrameDataCacheComponentbworldObj.GetSingletonCompdComponentType.FrameDataCacheComponente;ifd!worldObj.isStarte{fdcc.noExecteCommondArray.pushddatae;return;}fdcc.AddToFrameInfodmsg.framee;cc执行未处理的命令letfdcc2=aFrameDataCacheComponentbworldObj.GetSingletonCompdComponentType.FrameDataCacheComponente;ifdfdcc2.noExecteCommondArray.lengthb0e{letcmdArry=fdcc2.noExecteCommondArray;fdcc2.Resetde;fordletcmdofcmdArrye{this.RecieveCommandMsgdcmd,truee;}}worldObj.serverFrameCount=msg.frame;CommandPack.ProcessServerActiondworldObj,[msg],0e;cc这下面注释掉的部分是关于客户端主动预测帧数据的行为暂时不用如果玩家网络不好的话就让其先卡一下ccTODONIU这里还会涉及一个问题我们现在用的是TCP所以服务器的帧一定是有顺序的推送cc如果是UDP的话服务器的帧可能会无需需要做完整性校验ccletrecord:CommandComponent=pcrc.GetInputCachedcmd.framee;cccc判断和本地的预测有没有冲突ccifdrecord==null||!record.EqualsCmddcmdeeccpcrc.SetConflictdcmd.frame,truee;ccelseccpcrc.SetConflictdcmd.frame,falsee;ccifdpcrc.lastInputFrameacmd.frameecc设置服务器过来这一帧为最后的输入指令帧ccpcrc.lastInputFrame=cmd.frame;cccc完整性校验d检查上一帧的服务器数据是否到来如果为到达请求一下eccifdcmd.frame!=0&&pcrc.GetAllMessagedcmd.framee&&!pcrc.GetAllMessagedcmd.frame-1eecc{ccletqc=newQueryCommandde;ccqc.frame=cmd.frame-1;ccqc.id=cmd.id;ccNetWar.C2SQueryCommanddcmde;cc}}}}﻿moduleECS{exportclassReconnectSystemextendsLogicSystem{publicreConnectTime:number=5;cc延迟重连publicFixedUpdateddeltaTime:numbere{ccifd!ConnectManager.GetInstancede.isConnectedecc客户端暂停中cc{ccthis.world.isStart=false;cc}}cccc客户端暂停时运行ccpublicFixedUpdateByPauseddeltaTime:numberecc{ccifd!SocketManager.IsConnectdeecc{ccthis.reConnectTime--;ccifdthis.reConnectTimea0ecc{ccthis.reConnectTime=5;ccSocketManager.ReConnectde;cc}cc}cc}}}﻿moduleECS{exportclassSkillSystemextendsLogicSystem{publicInitFilterde{this.filter=newInt32Arrayd1e;this.filter[0]=ComponentType.SkillStatusComponent;}publicFixedUpdateddeltaTime:numbere{letlist=this.GetEntityListde;letentity:EntityBase;fordleti=0;ialist.length;++ie{entity=list[i];this.SkillStatusLogicdentity,deltaTimee;this.SkillLogicdentity,deltaTimee;}}privateSkillStatusLogicdentity:EntityBase,deltaTime:numbere{letssc:SkillStatusComponent=aSkillStatusComponentbentity.GetCompdComponentType.SkillStatusComponente;ssc.UpdateSkilltimeddeltaTimee;}privateSkillLogicdentity:EntityBase,deltaTime:numbere{letssc:SkillStatusComponent=aSkillStatusComponentbentity.GetCompdComponentType.SkillStatusComponente;ssc.UpdateLogicde;}}}﻿moduleECS{exportclassSpellSystemextendsLogicSystem{publicInitFilterde{this.filter=newInt32Arrayd1e;this.filter[0]=ComponentType.SpellComponent;}publicFixedUpdateddeltaTime:numbere{letlist=this.GetEntityListde;letentity:EntityBase;fordleti=0;ialist.length;++ie{entity=list[i];this.SpellLogicdentity,deltaTimee;}}privateSpellLogicdentity:EntityBase,deltaTime:numbere{letsc:SpellComponent=aSpellComponentbentity.GetCompdComponentType.SpellComponente;sc.UpdateSkilltimeddeltaTimee;sc.UpdateLogicde;}}}﻿moduleECS{exportclassStateMachineSystemextendsLogicSystem{publicstateDic:SMapanumber,FSMStateBaseb=newSMapanumber,FSMStateBasebde;publicstartState:FSMStateBase;publicconstructorde{superde;}publicInitde{super.Initde;this.InitStatede;}publicDisposede{this.stateDic.clearde;this.stateDic=null;super.Disposede;}privateInitStatede{this.AddStatedFSMState.Start,newFSMStartStatedee;this.AddStatedFSMState.FindTarget,newFSMFindTargetStatedee;this.AddStatedFSMState.Move,newFSMMoveStatedee;this.AddStatedFSMState.Attack,newFSMAttackStatedee;this.SetStartStatedFSMState.Starte;}privateAddStateditype:number,state:FSMStateBasee{this.stateDic.setditype,statee;}privateGetStateditype:numbere:FSMStateBase{ifdthis.stateDic.hasditypeeereturnthis.stateDic.getditypee;returnnull;}privateSetStartStateditype:numbere{ifdthis.stateDic.hasditypeeethis.startState=this.stateDic.getditypee;elsethread.warnd"_______SetStartStateerror______:",itypee}publicFixedUpdateddeltaTime:numbere{letheroDataArray=this.world.logicHeroManager.GetAllHeroDataArrayde;letnowFrame=this.world.frameCount;letworldObj=this.world;fordletheroDataofheroDataArraye{cc状态机5帧执行一次d导致寻路信息没有跟上应该在moveTransformsystem的时候检查路径的合法性eifdnowFrameb=heroData.nextFSMFrame||LogicWarUtil.IsKingTowerdheroData.shapeeecc国王塔要响应非常及时{heroData.isReTarget=true;this.StateMachineLogicdheroData.entity,deltaTimee;heroData.nextFSMFrame=nowFrame+worldObj.GetRandomRanged1,GameData.FSMFrameIntervale;}else{heroData.isReTarget=false;ccthis.StateMachineLogicdheroData.entity,deltaTimee;}this.UpdateCheckdheroDatae;}}publicUpdateCheckdheroData:HeroDataComponente{ccifdheroData.forbidAttackCountb0||heroData.pauseAttackCountb0ecc被禁锢了ccreturn;letupateFunc=game.DataUtil.GetAILogicFuncdheroData.shape,"update"e;ifdupateFunc!=nulle{letpassFrame=this.world.frameCount-heroData.createdFrame-heroData.stoppedFrame;upateFuncdheroData,passFramee;}}publicStateMachineLogicdentity:EntityBase,deltaTime:numbere{letnextState=this.startState.Enterdentity,deltaTimee;whilednextState!=FSMState.Ende{nextState=this.GetStatednextStatee.Enterdentity,deltaTimee;}}}}﻿moduleECS{exportclassStateSystemextendsLogicSystem{publicconstructorde{superde;}publicInitde{super.Initde;}publicInitFilterde{this.filter=newInt32Arrayd1e;this.filter[0]=ComponentType.StateComponent;}publicDisposede{super.Disposede;}publicFixedUpdateddeltaTime:numbere{letlist=this.GetEntityListde;letentity:EntityBase;letstateComp:StateComponent;fordleti=0;ialist.length;++ie{entity=list[i];stateComp=aStateComponentbentity.GetCompdComponentType.StateComponente;stateComp.Updatede;}}}}﻿moduleECS{exportclassWarSystemextendsLogicSystem{publicFixedUpdateddeltaTime:numbere{letwarComp=aWarComponentbthis.world.GetSingletonCompdComponentType.WarComponente;warComp.UpdateddeltaTimee;}}}﻿moduleECS{exportclassFindTargetArgs{publiccampType:number;publicsrcTrans:TransformComponent;publicsrcHeroData:HeroDataComponent;publictargetArray:EntityBase[];publicmaxCount:number;publictransFilterFunc:Function;publicattrFileterFunc:Function;publicthisObj:any;publicsortType:number;publicconstructorde{}publicDisposede{this.srcTrans=null;this.srcHeroData=null;this.targetArray=null;this.transFilterFunc=null;this.thisObj=null;this.attrFileterFunc=null;}}exportclassFindUtils{ccai索敌只找最近的publicstaticGetAITargetdargs:FindTargetArgse:number{lettargetTrans:TransformComponent;lettargetData:HeroDataComponent;letvalidTargetArray:ArrayaHeroDataComponentb=newArrayaHeroDataComponentbde;fordlettargetofargs.targetArraye{targetData=aHeroDataComponentbtarget.GetCompdComponentType.HeroDataComponente;ifdtargetData==nullecontinue;targetTrans=aTransformComponentbtarget.GetCompdComponentType.TransformComponente;ifdtargetTrans==nullecontinue;ifd!targetData.IsTargetValiddargs.srcHeroDataeecontinue;ifd!targetTrans.IsTargetValiddargs.srcTranseecontinue;ifdargs.attrFileterFunc!=null&&!args.attrFileterFunc.calldargs.thisObj,targetDataeecc属性信息过滤不通过continue;ifd!args.transFilterFunc.calldargs.thisObj,targetTrans,targetDataeecc位置信息过滤不通过continue;validTargetArray.pushdtargetDatae;}functionminDisSortda:HeroDataComponent,b:HeroDataComponente:number{ifda.toTargetDisbb.toTargetDisereturn1;elseifda.toTargetDisab.toTargetDisereturn-1;else{ifda.idbb.idereturn1;elsereturn-1;}}ifdvalidTargetArray.lengthb1e{validTargetArray.sortdminDisSorte;}letresult=0;ifdvalidTargetArray.lengthb0e{ccifdvalidTargetArray.lengthb1ecc{ccletobj1=validTargetArray[0];ccletobj2=validTargetArray[1];cc}letatkDis=args.thisObj.atkDis;letwarnDis=args.thisObj.warnDis;atkDis=atkDis*atkDis;warnDis=warnDis*warnDis;lettempDis=validTargetArray[0].toTargetDis;ifdtempDisb=MathConst.MaxDistanceetempDis=tempDis-MathConst.MaxDistance;ifdtempDisa=atkDisecc攻击范围内有敌人{fordlettargetofvalidTargetArraye{ifdtarget.toTargetDisbatkDisecc攻击范围外的敌人不处理break;cc如果有嘲讽目标直接攻击嘲讽目标ifdtarget.id==args.srcHeroData.sarcasmTargetIDe{result=target.id;break;}cc记录当前正在攻击的目标d如果没有嘲讽目标这就是攻击目标eifdargs.thisObj.attackCurrent==1&&target.id==args.srcHeroData.targetIDe{result=target.id;}}ifdresult==0eresult=validTargetArray[0].id;}elseifdtempDisawarnDisecc警戒范围内有敌人{fordlettargetofvalidTargetArraye{tempDis=target.toTargetDis;ifdtempDisb=MathConst.MaxDistanceetempDis=tempDis-MathConst.MaxDistance;ifdtempDisbwarnDisecc警戒范围外的敌人不处理break;cc如果有嘲讽目标直接攻击嘲讽目标ifdtarget.id==args.srcHeroData.sarcasmTargetIDe{result=target.id;break;}cc记录当前正在攻击的目标d如果没有嘲讽目标这就是攻击目标eifdargs.thisObj.attackCurrent==1&&target.id==args.srcHeroData.targetIDe{result=target.id;}}ifdresult==0eresult=validTargetArray[0].id;}ccifdargs.srcHeroData.id==1015ecc{ccletstr="";ccfordlettargetofvalidTargetArrayeccstr+=`d${target.id}:${Math.sqrtdtarget.toTargetDis-MathConst.MaxDistancee.toFixedd2e}e`;ccthread.logd`-----1015--target:${result}-----frame:${targetTrans.world.frameCount}${str}`e;cc}validTargetArray.length=0;}args.Disposede;returnresult;}publicstaticGetTargetsdargs:FindTargetArgse:number[]{lettargetTrans:TransformComponent;lettargetData:HeroDataComponent;letvalidTargetArray:ArrayaHeroDataComponentb=newArrayaHeroDataComponentbde;fordlettargetofargs.targetArraye{targetData=aHeroDataComponentbtarget.GetCompdComponentType.HeroDataComponente;ifdtargetData==nullecontinue;targetTrans=aTransformComponentbtarget.GetCompdComponentType.TransformComponente;ifdtargetTrans==nullecontinue;ifd!targetData.IsTargetValiddargs.srcHeroDataeecontinue;ifd!targetTrans.IsTargetValiddargs.srcTranseecontinue;ifdargs.attrFileterFunc!=null&&!args.attrFileterFunc.calldargs.thisObj,targetDataeecc属性信息过滤不通过continue;ifd!args.transFilterFunc.calldargs.thisObj,targetTrans,targetDataeecc位置信息过滤不通过continue;validTargetArray.pushdtargetDatae;}ccTODONIU排序一定要彻底排序防止一切意外的产生functionminDisSortda:HeroDataComponent,b:HeroDataComponente:number{ifda.toTargetDisbb.toTargetDisereturn1;elseifda.toTargetDisab.toTargetDisereturn-1;else{ifda.idbb.idereturn1;elsereturn-1;}}functionmaxHPSortda:HeroDataComponent,b:HeroDataComponente:number{ifda.hpab.hpereturn1;elseifda.hpbb.hpereturn-1;else{ifda.idbb.idereturn1;elsereturn-1;}}functionminHPSortda:HeroDataComponent,b:HeroDataComponente:number{ifda.hpbb.hpereturn1;elseifda.hpab.hpereturn-1;else{ifda.idbb.idereturn1;elsereturn-1;}}ifdvalidTargetArray.lengthbargs.maxCounte{switchdargs.sortTypee{caseTargetSortType.MinDis:validTargetArray.sortdminDisSorte;caseTargetSortType.MaxHP:validTargetArray.sortdmaxHPSorte;caseTargetSortType.MinHP:validTargetArray.sortdminHPSorte;}}letresult:number[]=[];letindex=0;fordlettargetDataofvalidTargetArraye{index++;ifdindexa=args.maxCounteresult.pushdtargetData.ide;}validTargetArray.length=0;args.Disposede;returnresult;}}}﻿moduleECS{exportclassLogicWarUtil{publicstaticIsKingTowerdshape:numbere:boolean{ifdshapeb=99010&&shapea=99999ereturntrue;returnfalse;}publicstaticIsQueenTowerdshape:numbere:boolean{ifdshape==MathConst.QueenTowerIDereturntrue;returnfalse;}publicstaticIsTowerdshape:numbere:boolean{returnLogicWarUtil.IsKingTowerdshapee||LogicWarUtil.IsQueenTowerdshapee;}publicstaticHasKingTowerdshapes:number[]e:boolean{fordletshapeofshapese{ifdLogicWarUtil.IsKingTowerdshapeeereturntrue;}returnfalse;}publicstaticIsSpelldshape:numbere:boolean{ifdshapeb=30000&&shapea40000ereturntrue;returnfalse;}publicstaticIsCarddshape:numbere:boolean{ifdshapeb=10000&&shapea20000ereturntrue;elseifdshapeb=30000&&shapea40000ereturntrue;elsereturnfalse;}publicstaticIsSelfAreadputType:numbere:boolean{returnputType==PutType.SelfAllArea||putType==PutType.SelfUnCollideArea;}publicstaticIsAllAreadputTypee:boolean{returnputType==PutType.AllMapAllArea||putType==PutType.AllMapUnCollideArea;}cc使用服务器的随机种子进行随机d随机种子相同随机出来的数必然相同epublicstaticGetRandomItemaTbdarray:T[],worldObj:LogicWorlde:T{letrandomIndex=worldObj.GetRandomRanged0,array.length-1e;returnarray[randomIndex];}cc使用客户端自己的随机函数进行随机publicstaticGetRandomItem2aTbdarray:T[],worldObj:LogicWorlde:T{letmax=array.length-1;letrandomIndex=Math.floordMath.randomde*maxe;returnarray[randomIndex];}cc队长判断publicstaticIsLeaderdpos:numbere{returnpos%10==1;}publicstaticClampTargetPosdfrom:Vector2,to:Vector2e:Vector2{ifdto.xa=MathConst.MapPosMaxX&&to.xb=0&&to.ya=MathConst.MapPosMaxY&&to.yb=0ereturnto;lettox=to.x;tox=Math.mindtox,MathConst.MapPosMaxXe;tox=Math.maxdtox,0e;lettoy=to.y;toy=Math.mindtoy,MathConst.MapPosMaxYe;toy=Math.maxdtoy,0e;letminScale=999999;letscaleX=999998;ifdto.x!=from.xescaleX=dtox-from.xecdto.x-from.xe;letscaleY=999998;ifdto.y!=from.yescaleY=dtoy-from.yecdto.y-from.ye;minScale=Math.mindminScale,Math.absdscaleXee;minScale=Math.mindminScale,Math.absdscaleYee;ccletdis=MathUtil.distancedfrom,toe;letdir=newVector2d[to.x-from.x,to.y-from.y]e;to=newVector2d[dir.x*minScale+from.x,dir.y*minScale+from.y]e;returnto;}publicstaticGetDistancedmyTrans:TransformComponent,targetTrans:TransformComponente:number{letdis=MathUtil.distancedmyTrans.pos,targetTrans.pose;dis=dis-targetTrans.range;ifddisa0edis=0;returndis;}publicstaticGetWarContainerdcheck:boolean=truee:WarContainer{ifd!CheckWorkThreaddeereturnnull;letworldObj=LogicWorld.GetInstancede;ifdworldObj!=nullereturnworldObj.warContainer;returnnull;}}}﻿moduleECS{exportclassCallbackInfo{cc各种回调函数publiconDieCB:SMapanumber,any[]b;cc自己死亡publiconBeginAttackCB:SMapanumber,any[]b;cc进入攻击状态publiconStopAttackCB:SMapanumber,any[]b;cc退出攻击状态publiconEnterCB:SMapanumber,any[]b;cc进场publiconSkillDamageCB:SMapanumber,any[]b;cc技能造成伤害publiconSkillBeDamagedCB:SMapanumber,any[]b;cc被技能伤害publiconHPChangeCB:SMapanumber,any[]b;cc血量发生改变publiconKillHeroCB:SMapanumber,any[]b;cc杀死敌方英雄publicconstructorde{this.onDieCB=newSMapanumber,any[]bde;this.onBeginAttackCB=newSMapanumber,any[]bde;this.onStopAttackCB=newSMapanumber,any[]bde;this.onEnterCB=newSMapanumber,any[]bde;this.onSkillDamageCB=newSMapanumber,any[]bde;this.onSkillBeDamagedCB=newSMapanumber,any[]bde;this.onHPChangeCB=newSMapanumber,any[]bde;this.onKillHeroCB=newSMapanumber,any[]bde;}publicDisposede{this.onDieCB.clearde;this.onBeginAttackCB.clearde;this.onStopAttackCB.clearde;this.onEnterCB.clearde;this.onSkillDamageCB.clearde;this.onSkillBeDamagedCB.clearde;this.onHPChangeCB.clearde;this.onKillHeroCB.clearde;}}exportclassSkillCB{ccpublicstaticonAnyHeroDieCB:SMapanumber,any[]b;cc任意单位死亡ccpublicstaticInitdecc{ccSkillCB.onAnyHeroDieCB=newSMapanumber,any[]bde;cc}ccpublicstaticDestroydecc{ccifdSkillCB.onAnyHeroDieCB!=nulleccSkillCB.onAnyHeroDieCB.clearde;ccSkillCB.onAnyHeroDieCB=null;cc}cc场上任意英雄死亡publicstaticAddOnAnyHeroDieCBdworldObj:LogicWorld,key:number,func:Function,thisObj:any,args?:anye{ifdworldObj.onAnyHeroDieCB==nullereturn;letonAnyHeroDieCB=worldObj.onAnyHeroDieCB;ifdonAnyHeroDieCB.hasdkeyee{thread.warnd"______AddOnAnyHeroDieCB____repeatkey:",keye}else{onAnyHeroDieCB.setdkey,[func,thisObj,args]e;}}publicstaticRemoveOnAnyHeroDieCBdworldObj:LogicWorld,key:numbere{letonAnyHeroDieCB=worldObj.onAnyHeroDieCB;onAnyHeroDieCB.deletedkeye;}publicstaticRunOnAnyHeroDieCBdworldObj:LogicWorld,dieHeroData:HeroDataComponent,srcHeroData:HeroDataComponente{letonAnyHeroDieCB=worldObj.onAnyHeroDieCB;letvalues=onAnyHeroDieCB.valuesde;fordletvalueofvaluese{value[0].calldvalue[1],dieHeroData,srcHeroData,value[2]e;}onAnyHeroDieCB.clearde;cc死亡回调只能调用一次}publicstaticAddOnDieCBdheroData:HeroDataComponent,key:number,func:Function,thisObj:any,args?:anye{letonDieCB=heroData.cbInfo.onDieCB;ifdonDieCB.hasdkeyee{thread.warnd"______AddOnDieCB____repeatkey:",keye}else{onDieCB.setdkey,[func,thisObj,args]e;}}publicstaticRemoveOnDieCBdheroData:HeroDataComponent,key:numbere{ifdheroData.cbInfo==nullereturn;letonDieCB=heroData.cbInfo.onDieCB;onDieCB.deletedkeye;}publicstaticRunOnDieCBdheroData:HeroDataComponent,srcHeroData:HeroDataComponente{letonDieCB=heroData.cbInfo.onDieCB;letvalues=onDieCB.valuesde;fordletvalueofvaluese{value[0].calldvalue[1],value[2],srcHeroDatae;}onDieCB.clearde;cc死亡回调只能调用一次}publicstaticAddOnBeginAttackCBdheroData:HeroDataComponent,key:number,func:Function,thisObj:any,args?:anye{letonBeginAttackCB=heroData.cbInfo.onBeginAttackCB;ifdonBeginAttackCB.hasdkeyee{thread.warnd"______onBeginAttackCB____repeatkey:",keye}else{onBeginAttackCB.setdkey,[func,thisObj,args]e;}}publicstaticRemoveOnBeginAttackCBdheroData:HeroDataComponent,key:numbere{ifdheroData.cbInfo==nullereturn;letonBeginAttackCB=heroData.cbInfo.onBeginAttackCB;onBeginAttackCB.deletedkeye;}publicstaticRunOnBeginAttackCBdheroData:HeroDataComponente{letonBeginAttackCB=heroData.cbInfo.onBeginAttackCB;letvalues=onBeginAttackCB.valuesde;fordletvalueofvaluese{value[0].calldvalue[1],value[2]e;}}publicstaticAddOnStopAttackCBdheroData:HeroDataComponent,key:number,func:Function,thisObj:any,args?:anye{letonStopAttackCB=heroData.cbInfo.onStopAttackCB;ifdonStopAttackCB.hasdkeyee{thread.warnd"______onStopAttackCB____repeatkey:",keye}else{onStopAttackCB.setdkey,[func,thisObj,args]e;}}publicstaticRemoveOnStopAttackCBdheroData:HeroDataComponent,key:numbere{ifdheroData.cbInfo==nullereturn;letonStopAttackCB=heroData.cbInfo.onStopAttackCB;onStopAttackCB.deletedkeye;}publicstaticRunOnStopAttackCBdheroData:HeroDataComponente{letonStopAttackCB=heroData.cbInfo.onStopAttackCB;letvalues=onStopAttackCB.valuesde;fordletvalueofvaluese{value[0].calldvalue[1],value[2]e;}}publicstaticAddOnEnterCBdheroData:HeroDataComponent,key:number,func:Function,thisObj:any,args?:anye{letonEnterCB=heroData.cbInfo.onEnterCB;ifdonEnterCB.hasdkeyee{thread.warnd"______onEnterCB____repeatkey:",keye}else{onEnterCB.setdkey,[func,thisObj,args]e;}}publicstaticRemoveOnEnterCBdheroData:HeroDataComponent,key:numbere{ifdheroData.cbInfo==nullereturn;letonEnterCB=heroData.cbInfo.onEnterCB;onEnterCB.deletedkeye;}publicstaticRunOnEnterCBdheroData:HeroDataComponente{letonEnterCB=heroData.cbInfo.onEnterCB;letvalues=onEnterCB.valuesde;fordletvalueofvaluese{value[0].calldvalue[1],value[2]e;}}publicstaticAddOnSkillDamageCBdheroData:HeroDataComponent,key:number,func:Function,thisObj:any,args?:anye{letonSkillDamageCB=heroData.cbInfo.onSkillDamageCB;ifdonSkillDamageCB.hasdkeyee{thread.warnd"______onSkillDamageCB____repeatkey:",keye}else{onSkillDamageCB.setdkey,[func,thisObj,args]e;}}publicstaticRemoveOnSkillDamageCBdheroData:HeroDataComponent,key:numbere{ifdheroData.cbInfo==nullereturn;letonSkillDamageCB=heroData.cbInfo.onSkillDamageCB;onSkillDamageCB.deletedkeye;}publicstaticRunOnSkillDamageCBdheroData:HeroDataComponente{ifdheroData==nullereturn;letonSkillDamageCB=heroData.cbInfo.onSkillDamageCB;letvalues=onSkillDamageCB.valuesde;fordletvalueofvaluese{value[0].calldvalue[1],value[2]e;}}publicstaticAddOnSkillBeDamagedCBdheroData:HeroDataComponent,key:number,func:Function,thisObj:any,args?:anye{letonSkillBeDamagedCB=heroData.cbInfo.onSkillBeDamagedCB;ifdonSkillBeDamagedCB.hasdkeyee{thread.warnd"______onSkillBeDamagedCB____repeatkey:",keye}else{onSkillBeDamagedCB.setdkey,[func,thisObj,args]e;}}publicstaticRemoveOnSkillBeDamagedCBdheroData:HeroDataComponent,key:numbere{ifdheroData.cbInfo==nullereturn;letonSkillBeDamagedCB=heroData.cbInfo.onSkillBeDamagedCB;onSkillBeDamagedCB.deletedkeye;}publicstaticRunOnSkillBeDamagedCBdheroData:HeroDataComponente{letonSkillBeDamagedCB=heroData.cbInfo.onSkillBeDamagedCB;letvalues=onSkillBeDamagedCB.valuesde;fordletvalueofvaluese{value[0].calldvalue[1],value[2]e;}}publicstaticAddOnHPChangeCBdheroData:HeroDataComponent,key:number,func:Function,thisObj:any,args?:anye{letonHPChangeCB=heroData.cbInfo.onHPChangeCB;ifdonHPChangeCB.hasdkeyee{thread.warnd"______onHPChangeCB____repeatkey:",keye}else{onHPChangeCB.setdkey,[func,thisObj,args]e;}}publicstaticRemoveOnHPChangeCBdheroData:HeroDataComponent,key:numbere{ifdheroData.cbInfo==nullereturn;letonHPChangeCB=heroData.cbInfo.onHPChangeCB;onHPChangeCB.deletedkeye;}publicstaticRunOnHPChangeCBdheroData:HeroDataComponente{letonHPChangeCB=heroData.cbInfo.onHPChangeCB;letvalues=onHPChangeCB.valuesde;fordletvalueofvaluese{value[0].calldvalue[1],value[2]e;}}publicstaticAddOnKillHeroCBdheroData:HeroDataComponent,key:number,func:Function,thisObj:any,args?:anye{letonKillHeroCB=heroData.cbInfo.onKillHeroCB;ifdonKillHeroCB.hasdkeyee{thread.warnd"______onKillHeroCB____repeatkey:",keye}else{onKillHeroCB.setdkey,[func,thisObj,args]e;}}publicstaticRemoveOnKillHeroCBdheroData:HeroDataComponent,key:numbere{ifdheroData.cbInfo==nullereturn;letonKillHeroCB=heroData.cbInfo.onKillHeroCB;onKillHeroCB.deletedkeye;}publicstaticRunOnKillHeroCBdheroData:HeroDataComponent,dieHeroData:HeroDataComponente{ifdheroData==nullereturn;letonKillHeroCB=heroData.cbInfo.onKillHeroCB;letvalues=onKillHeroCB.valuesde;fordletvalueofvaluese{value[0].calldvalue[1],value[2],dieHeroDatae;}}}}﻿moduleECS{exportclassSkillUtil{publicstaticSkillDamagedwho:HeroDataComponent,target:HeroDataComponent,skobj:SkillDataBase,damage:number,isFake:booleane{ccletworldObj=who.world;letisCrit=false;ifdskobj.template.skillType==SkillType.NormalSkille{cc暂时去掉暴击吸血cccc暴击ccletrandom=worldObj.GetRandomRanged1,100e;ccifdrandoma=who.critecc{ccisCrit=true;ccdamage*=1.5;cc}cccc吸血ccifddamageb0ecc{ccletsuckHP=who.suck*damagec100;ccifdsuckHPb0ecc{ccwho.SetDamaged-suckHP,null,HurtType1.NormalSkill,HurtType2.General,HurtType3.Heale;cc}cc}}cc结算和通知客户度表现lettype1=0;ifdskobj.template.skillType==SkillType.ActiveSkilletype1=HurtType1.ActiveSkill;elseifdskobj.template.skillType==SkillType.NormalSkilletype1=HurtType1.NormalSkill;elseifdskobj.template.skillType==SkillType.PassiveSkilletype1=HurtType1.PassiveSkill;lettype2=0;ifddamage==0e{type2=HurtType2.Immuse;}else{ifdisCritetype2=HurtType2.Crit;elsetype2=HurtType2.General;}target.isFakeDamge=isFake;ifdisFakeecc虚假结算{letoldHP=target.hp;letoldHpMax=target.hpmax;damage=target.SetDamagedwho,skobj,damage,type1,type2e;cc虚假结算完毕后要把血量归位letfakeHP=target.hp;target.hp=oldHP;target.hpmax=oldHpMax;target.fakeHP=fakeHP;}else{damage=target.SetDamagedwho,skobj,damage,type1,type2e;}target.isFakeDamge=false;cc技能伤害回调d分别通知攻击者和受击者eifddamageb0&&!isFakee{ifdskobj.template.skillType==SkillType.NormalSkill&&who!=nulle{SkillCB.RunOnSkillDamageCBdwhoe;}SkillCB.RunOnSkillBeDamagedCBdtargete;}}}}﻿moduleECS{exportclassWarSettings{publicstaticAutoSkill:boolean=true;cc自动使用技能publicstaticEnergyRatio=120;cc系数publicstaticInitHeroEnergy=6*WarSettings.EnergyRatio;cc初始法力publicstaticInitMaxHeroEnergy=6*WarSettings.EnergyRatio;cc初始最大法力publicstaticMaxMaxHeroEnergy=10*WarSettings.EnergyRatio;cc最大法力上限publicstaticAddHeroEnergy=100;cc1c12*120cc每秒恢复的能量基数publicstaticAddEnergyInterval=1;publicstaticMaxSkillEnergy=100;publicstaticAddSkllEnergy=10;publicstaticWarTotalTime=300000;publicstaticSpeedUptime=1200;publicstaticBurnTime=1800;publicstaticShowTotalTime=1800;}}﻿moduleECS{classCommandItem{publiccmdID:number;publicplayerId:number;publicstartTime:number;publicstartFrame:number;privateserverReady:boolean;privatewaitServerTimer:number;publicconstructorde{this.waitServerTimer=0;}publicDisposede{this.DisposeTimerde;}privateDisposeTimerde{ifdthis.waitServerTimer!=0e{game.TimerMgr.GetInstancede.RemoveTimerdthis.waitServerTimere;this.waitServerTimer=0;}}privateOnTimeOutde{returnfalse;}publicSetIsServerReadydserverReady:boolean,func:Function,thisObj:any,args:anye{this.serverReady=serverReady;this.DisposeTimerde;ifd!serverReadye{cc2s的超时时间this.waitServerTimer=game.TimerMgr.GetInstancede.AddTimerd2000,func,thisObj,argse;}}}cc用于处理玩家操作d快速响应延迟生效eexportclassCommandManager{ccpublicstatics_Instance:CommandManager;ccpublicstaticInitInstancedecc{ccifdCommandManager.s_Instance==nulleccCommandManager.s_Instance=newCommandManagerde;ccelseccthread.warnd"LogicHeroManagerInitInstance:"e;cc}ccpublicstaticDestroyInstancedecc{ccifdCommandManager.s_Instance!=nulleccCommandManager.s_Instance.Disposede;ccCommandManager.s_Instance=null;cc}ccpublicstaticGetInstancede:CommandManagercc{ccreturnCommandManager.s_Instance;cc}privateworld:LogicWorld;privatecmdInfo:SMapanumber,CommandItemb;publicconstructordworldObj:LogicWorlde{this.world=worldObj;this.Initde;}publicInitde{this.cmdInfo=newSMapanumber,CommandItembde;}publicDisposede{this.cmdInfo.clearde;}publicExecuteCommanddcmd:CommandComponent,serverReady:booleane{fordletdataofcmd.cmdDataArraye{this.ExecuteOneCommanddcmd.id,data,serverReadye;}}publicExecuteOneCommanddplayerId:number,cmd:CommandData,serverReady:booleane{ccthread.logd"______ExecuteOneCommand_______________",playerId,cmd.action,serverReady,typeofdcmd.actione,cmd.action==CommandType.AddHeroe;ifdcmd.action==CommandType.AddHeroe{this.ExcuteAddHerodplayerId,cmd,serverReadye;}elseifdcmd.action==CommandType.AddSpelle{this.ExcuteAddSpelldplayerId,cmd,serverReadye;}elseifdcmd.action==CommandType.UseSkille{this.ExcuteUseSkilldplayerId,cmd,serverReadye;}elseifdcmd.action==CommandType.Nonee{}else{thread.warnd"ExecuteCommandunknowtype:",cmd.actione;}}privateAddCommandItemduniqueID:numbere:CommandItem{ifd!this.cmdInfo.hasduniqueIDee{letcmdObj=newCommandItemde;this.cmdInfo.setduniqueID,cmdObje;cmdObj.startTime=egret.getTimerde;cmdObj.startFrame=this.world.frameCount;}returnthis.cmdInfo.getduniqueIDe;}privateExcuteAddHerodplayerId:number,cmd:CommandData,serverReady:booleane{letworldObj=this.world;letplayerComp=aRealPlayerComponentbworldObj.GetCompByIDdplayerId,ComponentType.RealPlayerComponente;letheroID=cmd.args[0];letx=cmd.args[1];lety=cmd.args[2];letcmdID=cmd.args[3];cc唯一标识操作的IDletindex=cmd.args[4];cc战场UI界面的图标索引letcardID=cmd.args[5];cc唯一标识previewCard的IDccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccletuniqueID=cmdID;letcmdItem=this.AddCommandItemduniqueIDe;cmdItem.SetIsServerReadydserverReady,dargs:anye=b{cc释放超时let_playerId=args[0];let_heroID=args[1];let_index=args[2];let_cmdID=args[3];let_cardID=args[4];let_playerComp=aRealPlayerComponentbworldObj.GetCompByIDd_playerId,ComponentType.RealPlayerComponente;ifd_playerComp!=nulle{_playerComp.RecoverEnergyd_cmdIDe;_playerComp.ServerReadyAddHerod_heroID,_index,falsee;WarEvent.FireEventdGlobalEventType.ServerReadyAddHero,_cardID,0,0,0,_playerComp.id,[]e;}},this,[playerId,heroID,index,cmdID,cardID]e;ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccletheroData=playerComp.GetHeroDatadheroIDe;ifd!serverReadyecc客户端先行操作{letheroIconData=playerComp.GetHeroIconDatadindexe;ifdheroIconData!=nulle{heroIconData.nowState=1;cc等待服务器确认}playerComp.LockHeroIcondindexe;playerComp.FakeUseEnergydheroData.cost,cmdIDe;WarEvent.FireEventdGlobalEventType.ClientReadyAddHero,cardID,playerComp.ide;return;}cmdItem.Disposede;this.cmdInfo.deleteduniqueIDe;playerComp.RecoverEnergydcmdIDe;ifdplayerComp.GetEnergydeaheroData.costecc释放失败{playerComp.ServerReadyAddHerodheroID,index,falsee;WarEvent.FireEventdGlobalEventType.ServerReadyAddHero,cardID,0,0,0,playerComp.id,[]e;thread.errord"AddHeroFailenergynotfull!!!",playerComp.GetEnergydee;return;}cc释放成功playerComp.UseEnergydheroData.coste;letidArray=playerComp.AddHeroToScenedheroID,playerComp.campType,x,y,cardIDe;playerComp.ServerReadyAddHerodheroID,index,truee;WarEvent.FireEventdGlobalEventType.ServerReadyAddHero,cardID,heroID,x,y,playerComp.id,idArraye;}privateExcuteAddSpelldplayerId:number,cmd:CommandData,serverReady:booleane{letworldObj=this.world;letplayerComp=aRealPlayerComponentbworldObj.GetCompByIDdplayerId,ComponentType.RealPlayerComponente;letheroID=cmd.args[0];letx=cmd.args[1];lety=cmd.args[2];letcmdID=cmd.args[3];cc唯一标识操作的IDletindex=cmd.args[4];cc战场UI界面的图标索引letcardID=cmd.args[5];cc唯一标识previewCard的IDccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccletuniqueID=cmdID;letcmdItem=this.AddCommandItemduniqueIDe;cmdItem.SetIsServerReadydserverReady,dargs:anye=b{cc释放超时let_playerId=args[0];let_heroID=args[1];let_index=args[2];let_cmdID=args[3];let_cardID=args[4];let_playerComp=aRealPlayerComponentbworldObj.GetCompByIDd_playerId,ComponentType.RealPlayerComponente;ifd_playerComp!=nulle{_playerComp.RecoverEnergyd_cmdIDe;_playerComp.ServerReadyAddSpelld_heroID,_index,falsee;WarEvent.FireEventdGlobalEventType.ServerReadyAddSpell,_cardID,0,0,0,_playerComp.ide;}},this,[playerId,heroID,index,cmdID,cardID]e;ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccletheroData=playerComp.GetHeroDatadheroIDe;ifd!serverReadyecc客户端先行操作{letheroIconData=playerComp.GetHeroIconDatadindexe;ifdheroIconData!=nulle{heroIconData.nowState=1;cc等待服务器确认}playerComp.LockHeroIcondindexe;playerComp.FakeUseEnergydheroData.cost,cmdIDe;WarEvent.FireEventdGlobalEventType.ClientReadyAddSpell,cardID,playerComp.ide;return;}cmdItem.Disposede;this.cmdInfo.deleteduniqueIDe;playerComp.RecoverEnergydcmdIDe;ifdplayerComp.GetEnergydeaheroData.costecc释放失败{playerComp.ServerReadyAddSpelldheroID,index,falsee;WarEvent.FireEventdGlobalEventType.ServerReadyAddSpell,cardID,0,0,0,playerComp.ide;thread.errord"AddSpellFailenergynotfull!!!",playerComp.GetEnergydee;return;}cc释放成功playerComp.UseEnergydheroData.coste;playerComp.AddSpellToScenedheroID,x,y,cardIDe;playerComp.ServerReadyAddSpelldheroID,index,truee;WarEvent.FireEventdGlobalEventType.ServerReadyAddSpell,cardID,heroID,x,y,playerComp.ide;}privateExcuteUseSkilldplayerId:number,cmd:CommandData,serverReady:booleane{letworldObj=this.world;letplayerComp=aRealPlayerComponentbworldObj.GetCompByIDdplayerId,ComponentType.RealPlayerComponente;letid=cmd.args[0];letcmdID=cmd.args[1];letindex=cmd.args[2];cc战场UI界面的图标索引letheroData=worldObj.logicHeroManager.GetHeroDatadide;playerComp.HeroSkillSuccessdid,indexe;ccifdplayerComp.IsMySelfdeeccWarEvent.FireEventdGlobalEventType.HeroSkillSuccess,playerId,id,indexe;cc能量不足ifdheroData==nulle{thread.warnd"_____UseSkill____error:heroisnotexisted!!!!______",heroData==nulle;return;}elseifdheroData.GetSkillEnergydeaWarSettings.MaxSkillEnergye{thread.warnd"_____UseSkill____error:energynotfull!!!!______",heroData.GetSkillEnergydee;return;}elseifdheroData.forbidActiveSkillCountb0e{thread.warnd"_____UseSkill____error:heroisforbidActiveSkillCount!!!!______",heroData.forbidActiveSkillCounte;return;}cc技能不符合条件letssc=aSkillStatusComponentbheroData.entity.GetCompdComponentType.SkillStatusComponente;lettemplate=ssc.GetValidSkilldSkillType.ActiveSkille;ifdtemplate==nulle{thread.warnd"_____UseSkill____error:skillnotvalid!!!!______"e;return;}ssc.StopAllSkilldworldObj.frameCounte;letskobj=ssc.UseSkilldtemplatee;skobj.Updatede;cc使用技能后立刻执行第一帧保证AI被锁定heroData.AddSkillEnergyd-1000e;ccifdplayerComp.IsMySelfdeecc{ccthread.logd"--执行技能--ExcuteUseSkill---bbbbframe:",worldObj.frameCount,"index:",index,"time:",egret.getTimerdee;cc}}}}﻿moduleECS{cc只是用于快速查询战场中的某个英雄数据exportclassLogicHeroManager{publicallHeroDic:SMapanumber,LogicEntityb;publicfriendHeroList:ArrayaLogicEntityb;publicenemyHeroList:ArrayaLogicEntityb;publicallHeroDataDict:SMapanumber,HeroDataComponentb;privateworld:LogicWorld;ccpublicstatics_Instance:LogicHeroManager;ccpublicstaticInitInstancedecc{ccifdLogicHeroManager.s_Instance==nulleccLogicHeroManager.s_Instance=newLogicHeroManagerde;ccccelseccccthread.warnd"LogicHeroManagerInitInstance:"e;cc}ccpublicstaticDestroyInstancedecc{ccifdLogicHeroManager.s_Instance!=nulleccLogicHeroManager.s_Instance.Disposede;ccLogicHeroManager.s_Instance=null;cc}ccpublicstaticGetInstancede:LogicHeroManagercc{ccreturnLogicHeroManager.s_Instance;cc}publicconstructordworldObj:LogicWorlde{this.world=worldObj;this.Initde;}publicInitde{this.allHeroDic=newSMapanumber,LogicEntitybde;this.friendHeroList=newArrayaLogicEntitybde;this.enemyHeroList=newArrayaLogicEntitybde;this.allHeroDataDict=newSMapanumber,HeroDataComponentbde;}privateGetValidTargetdarray:ArrayaLogicEntityb,bFakeHP:booleane{letnewArray:ArrayaLogicEntityb=newArrayaLogicEntitybde;fordletentityofarraye{letcomp=aHeroDataComponentbentity.GetCompdComponentType.HeroDataComponente;ifdcomp==nullecontinue;ifdcomp.hpa=0econtinue;ifdcomp.fakeHPa=0&&bFakeHPecc虚假血量为0并且需要处理虚假血量continue;newArray.pushdentitye;}newArray.sortdda,be=b{ifda.idbb.idereturn1;return-1;}e;returnnewArray;}publicGetEnemysdcampType:number,bFakeHP:booleane:ArrayaLogicEntityb{ifdcampType==CampType.Friende{returnthis.GetValidTargetdthis.enemyHeroList,bFakeHPe;}else{returnthis.GetValidTargetdthis.friendHeroList,bFakeHPe;}}publicGetFriendsdcampType:number,bFakeHP:booleane:ArrayaLogicEntityb{ifdcampType==CampType.Friende{returnthis.GetValidTargetdthis.friendHeroList,bFakeHPe;}else{returnthis.GetValidTargetdthis.enemyHeroList,bFakeHPe;}}publicGetAllHerodbFakeHP:booleane:ArrayaLogicEntityb{letnewArray:ArrayaLogicEntityb=newArrayaLogicEntitybde;fordletentityofthis.allHeroDic.valuesdee{letcomp=aHeroDataComponentbentity.GetCompdComponentType.HeroDataComponente;ifdcomp==nullecontinue;ifdcomp.hpa=0econtinue;ifdcomp.fakeHPa=0&&bFakeHPecc虚假血量为0并且需要处理虚假血量continue;newArray.pushdentitye;}newArray.sortdda,be=b{ifda.idbb.idereturn1;return-1;}e;returnnewArray;}publicGetAllHeroDataArrayde:HeroDataComponent[]{letheroDataArray:HeroDataComponent[]=[];letvalues=this.allHeroDataDict.valuesde;fordletheroDataofvaluese{ifdheroData.hpb0eheroDataArray.pushdheroDatae;}heroDataArray.sortdda,be=b{ifda.idbb.idereturn1;elsereturn-1;}e;returnheroDataArray;}ccbFakeHP:是否考虑虚假血量publicGetAllTargetdenemyType:number,myCampType:number,bFakeHP:booleane:LogicEntity[]{ifdenemyType==EnemyType.Enemyereturnthis.GetEnemysdmyCampType,bFakeHPe;elseifdenemyType==EnemyType.Friendsereturnthis.GetFriendsdmyCampType,bFakeHPe;elsereturnthis.GetAllHerodbFakeHPe;}publicAddHerodid:number,entity:LogicEntitye{ccifdSettings.logeccthread.logd"LogicHeroManager.AddHero:",id,entity.ide;ifdthis.allHeroDic.hasdidee{thread.warnd"LogicHeroManager.AddHerorepeaterror:",ide;}else{this.allHeroDic.setdid,entitye;letcomp=aHeroDataComponentbentity.GetCompdComponentType.HeroDataComponente;ifdcomp!=nulle{ifdcomp.campType==CampType.Friendethis.friendHeroList.pushdentitye;elsethis.enemyHeroList.pushdentitye;this.allHeroDataDict.setdid,compe;}}}publicRemoveHerodid:numbere{ifdthis.allHeroDic.hasdidee{letentity=this.allHeroDic.getdide;letindex=this.friendHeroList.indexOfdentitye;ifdindexb-1ethis.friendHeroList.splicedindex,1e;index=this.enemyHeroList.indexOfdentitye;ifdindexb-1ethis.enemyHeroList.splicedindex,1e;this.allHeroDic.deletedide;this.allHeroDataDict.deletedide;}}publicGetHerodid:numbere:LogicEntity{returnthis.allHeroDic.getdide;}publicGetHeroDatadid:numbere:HeroDataComponent{returnthis.allHeroDataDict.getdide;}privatetestAngle:number=0;publicTestFuncde{fordleti=0;iathis.friendHeroList.length;i++e{letentity=this.friendHeroList[i];letrender=aDrawComponentbentity.GetCompdComponentType.DrawComponente;lettrans=aTransformComponentbentity.GetCompdComponentType.TransformComponente;ifdrender!=null&&trans!=nulle{ccrender.gameObject.SetAngledthis.testAnglee;ccrender.gameObject.scaleX=-1;ccletangleArray:number[]=[0,5,30,45,65,90,125,175];ccthis.testAngle=this.testAngle%8;ccletangle=angleArray[this.testAngle];ccTipsManager.ShowTipsd`${angle}度`,1e;ccrender.gameObject.SetAniAngledanglee;ccrender.gameObject.SetAnimStatedAnimState.Move,angle,CampType.Enemye;render.gameObject.TestFuncde;break;ccreturn;}}ccfordleti=0;iathis.enemyHeroList.length;i++ecc{ccletentity=this.enemyHeroList[i];ccletrender=aDrawComponentbentity.GetCompdComponentType.DrawComponente;cclettrans=aTransformComponentbentity.GetCompdComponentType.TransformComponente;ccifdrender!=null&&trans!=nullecc{ccrender.gameObject.SetAnimStatedAnimState.Attack,this.testAngle,CampType.Enemye;ccccrender.gameObject.SetAngledthis.testAnglee;ccccrender.gameObject.SetScaled2,2e;cc}cc}this.testAngle+=1;ifdthis.testAngleb360ethis.testAngle=0;}publicDisposede{ifdthis.allHeroDic!=nullethis.allHeroDic.clearde;this.allHeroDic=null;ifdthis.friendHeroList!=nullethis.friendHeroList.length=0;this.friendHeroList=null;ifdthis.enemyHeroList!=nullethis.enemyHeroList.length=0;this.enemyHeroList=null;ifdthis.allHeroDataDict!=nullethis.allHeroDataDict.clearde;this.allHeroDataDict=null;this.world=null;}}}﻿moduleECS{exportclassLogicWarManager{publicstatics_Instance:LogicWarManager;publicstaticGetInstancede:LogicWarManager{ifd!CheckWorkThreaddeereturnnull;ifdLogicWarManager.s_Instance==nulleLogicWarManager.s_Instance=newLogicWarManagerde;returnLogicWarManager.s_Instance;}privatedelayTimerKey:number=0;publicconstructorde{}cc初始化战前信息privatePreInitde{thread.logd"----------------bbbbbLogicWarManager.InitWar"e;this.StopWardfalsee;SMap.BeginRecordde;WarEvent.Initde;ccWarData.ResetWarDatade;LogicShareDataMgr.InitInstancede;LogicWorldManager.InitInstancede;ccMagicMgr.InitMagicDatade;ccMagicMgr.InitInstancede;ccMoveRenderMgr.InitInstancede;ccWarNumber.InitInstancede;ccHurtNumberRenderMgr.InitInstancede;}cc初始化玩家卡牌数据privateInitFightRoomInfodfightRoomInfo:Protocol.IFightRoomInfo_Respond,myRoleId:numbere:PreWarItemData[]{thread.logd"----------------bbbbbLogicWarManager.InitFightRoomInfo"e;letworldObj=LogicWorld.GetInstancede;letwarComp=aWarComponentbworldObj.GetSingletonCompdComponentType.WarComponente;warComp.Initde;warComp.fightIp=fightRoomInfo.fightIp;warComp.secrete=fightRoomInfo.secrete;warComp.roomId=fightRoomInfo.roomId;warComp.classLv=fightRoomInfo.classLevel;letinfos=fightRoomInfo.infos.sortdda,be=b{ifda.posab.posereturn-1;elsereturn1;}e;letplayerDataArray:PreWarItemData[]=[];fordletmatchInfoofinfose{letroleId=NumberdmatchInfo.roleIde;letfightRoleId=LogicWorld.GetInstancede.CreateFightRoleIDdmatchInfo.pos,roleIde;ifdroleId==myRoleIde{warComp.userName=matchInfo.name;warComp.myFightRoleId=fightRoleId;warComp.myAtkType=Math.floordmatchInfo.posc10e;}letplayerData=newPreWarItemDatade;playerData.CopyFromMatchInfodfightRoleId,matchInfoe;playerDataArray.pushdplayerDatae;}ifdfightRoomInfo.typeb0&&infos.length==fightRoomInfo.type*2ewarComp.pvpType=fightRoomInfo.type;ccinfos.length==2?1:2;ccfightRoomInfo.type;elsewarComp.pvpType=infos.length==2?1:2;ccfightRoomInfo.type;warComp.mapID=fightRoomInfo.mapID;warComp.mapID=game.DataUtil.GetValueByKeyd"classleveldata_json",warComp.classLv,"map"e;returnplayerDataArray;}cc初始化逻辑层d场景数据玩家数据等eprivateInitWarLogicdplayerDataArray:PreWarItemData[]e{thread.logd"----------------bbbbbLogicWarManager.InitWarLogic"e;letworldObj=LogicWorld.GetInstancede;letwarComp=aWarComponentbworldObj.GetSingletonCompdComponentType.WarComponente;cc创建场景和玩家数据warComp.CreateScenede;warComp.CreateAllPlayerdplayerDataArraye;}publicInitWardfightRoomInfo:Protocol.IFightRoomInfo_Respond,isOtherReady:boolean,myRoleId:numbere{SNetWar.InstanceFuncd"ECSC","RenderWarManager","PreInitWar"e;cc调用渲染层PreInitWar函数this.PreInitde;letplayerDataArray=this.InitFightRoomInfodfightRoomInfo,myRoleIde;this.InitWarLogicdplayerDataArraye;letworldObj=LogicWorld.GetInstancede;letwarComp=aWarComponentbworldObj.GetSingletonCompdComponentType.WarComponente;SNetWar.InstanceFuncd"ECSC","RenderWarManager","InitWar",fightRoomInfo,isOtherReady,myRoleId,warComp.sceneID,worldObj.ide;cc调用渲染层PreInitWar函数SNetWar.SendCollideNodeInfode;}publicClientStartWardfuncName:stringe{SNetWar.InstanceFuncd"game","SceneManager",funcNamee;cc调用game.SceneManager.GetInstancede.ReconnectWarde;}cc3：初始化开战数据d随机种子开战时间等等epublicInitStartWarDatadstartTime:number,seed:number,cmd:Protocol.IFightRecord|Protocol.IFightReconnectRoom_Responde{thread.logd"----------------bbbbbLogicWarManager.InitStartWarData"e;letworldObj=LogicWorld.GetInstancede;letwarComp=aWarComponentbworldObj.GetSingletonCompdComponentType.WarComponente;warComp.seed=seed;warComp.startTime=NumberdstartTimee;worldObj.recordManager.SetRandomSeeddseede;worldObj.recordManager.initRandomSeed=seed;letplayerArray=worldObj.GetPlayerListde;fordletentityofplayerArraye{letcomp=aRealPlayerComponentbentity.GetCompdComponentType.RealPlayerComponente;comp.InitStartWarDatade;}ifdcmd!=nulle{CommandPack.ProcessServerActiondworldObj,cmd.actions,cmd.maxframee;ifdGameData.ReplayModeeworldObj.maxFrameCount=cmd.maxframe;}ifdplayerArray.length==0e{thread.errord"InitStartWarDatainittooearly!!!!"e;}letpreData=LogicShareDataMgr.GetInstancede.preData;preData.addEventCBd"isServerTimeReady",this.CheckServerTime,thise;cc等待服务器时间到来this.CheckServerTimede;}privateCheckServerTimede{letpreData=LogicShareDataMgr.GetInstancede.preData;ifd!preData.isServerTimeReadyereturn;preData.removeEventCB2d"isServerTimeReady"e;letworldObj=LogicWorld.GetInstancede;letwarComp=aWarComponentbworldObj.GetSingletonCompdComponentType.WarComponente;letleftTime=FightServerTime.GetLeftTimedwarComp.startTimee;game.TimerMgr.GetInstancede.RemoveTimerdthis.delayTimerKeye;this.delayTimerKey=game.TimerMgr.GetInstancede.AddTimerdleftTime,de=b{preData.addEventCBd"isServerStartWar",this.CheckStartWar,thise;preData.addEventCBd"isClientStartWar",this.CheckStartWar,thise;SNetWar.RefreshPreShareDatad"isServerStartWar",truee;},thise;}cc检查战斗是否开始privateCheckStartWarde{letpreData=LogicShareDataMgr.GetInstancede.preData;letisClientStartWar=preData.isClientStartWar;letisServerStartWar=preData.isServerStartWar;ifdisClientStartWar&&isServerStartWare{this.StartWarde;cc战斗已经开始移除回调letpreData=LogicShareDataMgr.GetInstancede.preData;preData.removeEventCB2d"isServerStartWar"e;preData.removeEventCB2d"isClientStartWar"e;}}cc100：战斗正式开始privateStartWarde{letworldObj=LogicWorld.GetInstancede;letwarComp=aWarComponentbworldObj.GetSingletonCompdComponentType.WarComponente;warComp.Startde;worldObj.frameCount=1;worldObj.isStart=true;}private_StopWarde{game.TimerMgr.GetInstancede.RemoveTimerdthis.delayTimerKeye;ccMagicMgr.DestroyInstancede;ccMoveRenderMgr.DestroyInstancede;ccWarNumber.DestroyInstancede;ccHurtNumberRenderMgr.DestroyInstancede;LogicWorldManager.DestroyInstancede;ccDeployCardMgr.GetInstancede.Disposede;ccServer.Main.Endde;ccServer.Main.Startde;ccClientNet.NetWar.StopHeartTimede;ReplayManager.GetInstancede.EndReplaydfalsee;ObjectPoolManager.GetInstancede.DestroyAllObjectdSceneTypeConst.Ware;ObjectPoolManager.GetInstancede.DestroyAllObjectdSceneTypeConst.Homee;ccEffectPool.GetInstancede.DestroyAllde;LogicShareDataMgr.DestroyInstancede;SMap.EndRecordde;}publicStopWardstopRender:boolean=truee{try{this._StopWarde;}catchderrore{game.ErrorManager.LogicUploadExceptionderror.message,error.stacke;}ifdstopRendereSNetWar.InstanceFuncd"ECSC","RenderWarManager","StopWar"e;cc调用渲染层StopWar函数}}}﻿moduleECS{exportclassLogicWorldManager{publicstatics_Instance:LogicWorldManager;publicstaticInitInstancede{ifdLogicWorldManager.s_Instance==nulleLogicWorldManager.s_Instance=newLogicWorldManagerde;}publicstaticDestroyInstancede{ifdLogicWorldManager.s_Instance!=nulleLogicWorldManager.s_Instance.Disposede;LogicWorldManager.s_Instance=null;}publicstaticGetInstancede:LogicWorldManager{ifd!CheckWorkThreaddeereturnnull;returnLogicWorldManager.s_Instance;}publicupdateSpeed:number=1;publicupdateTime:number=0;privatelastTime:number=0;privateworld:LogicWorld;privatelastTotalPauseTime:number=0;publicconstructorde{this.Initde;}publicInitde{this.CreateWorlddWorldType.LogicWorlde;this.lastTime=0;this.lastTotalPauseTime=GameData.TotalPauseTime;this.updateTime=0;egret.startTickdthis.Update,thise;}publicDisposede{ccegret.Ticker.getInstancede.unregisterdthis.Update,thise;this.world=null;egret.stopTickdthis.Update,thise;LogicWorld.DestroyInstancede;}publicCreateWorlddworldType:numbere{LogicWorld.InitInstancedworldTypee;this.world=LogicWorld.GetInstancede;this.InitCBde;}privategetintervalTimede{returnMathConst.KeyFrameTime;}publicUpdatedtotalTime:numbere:boolean{ifdthis.world==nullereturntrue;totalTime-=GameData.TotalPauseTime-this.lastTotalPauseTime;ccifdSettings.logeccthread.logdtotalTime,"_______Update___________",egret.getTimerde,"______________",GameData.TotalPauseTime-this.lastTotalPauseTimee;letdt=totalTime-this.lastTime;ifdthis.lastTime==0edt=0;this.lastTime=totalTime;cctrycc{ccthis.TryUpdateWorldddte;cc}cccatchderrorecc渲染层发生故障只上报异常不退出战斗cc{ccccgame.ErrorManager.UploadExceptionderror.message,error.stacke;ccgame.ErrorManager.LogicCacheExceptionderror.message,error.stacke;ccegret.stopTickdthis.Update,thise;cc}try{returnthis.TryUpdateLogicddte;}catchderrorecc逻辑层发生故障直接上报{game.ErrorManager.LogicCacheExceptionderror.message,error.stacke;egret.stopTickdthis.Update,thise;returnfalse;}}publicTryUpdateLogicddt:numbere:boolean{this.updateTime+=dt;ifdthis.updateTimeathis.intervalTimeereturntrue;ccthread.logdtotalTime,"_______Update________",dt,this.updateTimee;this.updateTime-=this.intervalTime;this.SpeedControlde;this.UpdateShareDatade;dt=this.intervalTime;ifdthis.updateSpeeda1ecc减速处理dt*=this.updateSpeed;fordleti=0;iathis.updateSpeed;i++ecc加速处理this.OptimisticFixedUpdateWorldddte;returntrue;}publicTryUpdateWorldddt:numbere:boolean{letworldObj=this.world;ccifdGameData.DeviceType==DeviceType.Html5Client&&worldObj.frameCountb1ecc{ccifdthis.updateSpeedb10eccWarData.ShowRender=false;ccelseccWarData.ShowRender=true;cc}ifdWarData.ShowRenderecc加速过快的时候渲染层停止处理{fordleti=0;iathis.updateSpeed;i++ecc加速处理this.UpdateWorldddte;}else{letdata:any={};data.cframe=worldObj.frameCount;ifdGameData.LocalTestedata.sframe=Server.LogicMgr.GetInstancede.GetFramede;elsedata.sframe=worldObj.serverFrameCount;game.UIManager.UpdateDatadPanelTypeConst.WarUI,[993,data]e;}returntrue;}publicUpdateWorldddt:numberecc执行客户端的表现逻辑比如特效飞行之类{ifdthis.world!=nullethis.world.Loopddte;}publicOptimisticFixedUpdateWorldddt:numberecc执行真正的帧逻辑{letworldObj=this.world;ifdworldObj==nullereturn;ifdworldObj.GetIsAllReadydeecc服务器推这一帧数据回来了{worldObj.OptimisticFixedLoopddte;}}cc取出World进行速度控制publicSpeedControlde{ifdGameData.ReplayMode||GameData.SpeedUpModeecc回放和加速模式{cc回放的加速处理默认情况下MathConst.JumpTargetFrame-this.world.frameCount小于0cc所以算出来this.updateSpeed为preData.updateSpeedthis.updateSpeed=MathConst.GetUpdateSpeeddMathConst.JumpTargetFrame-this.world.frameCounte;ifdMathConst.JumpTargetFrame==this.world.frameCount-1e{SNetWar.FireEventdGlobalEventType.JumpFrameOvere;}return;}letworldObj=this.world;ifdworldObj!=nulle{letcacheCount=worldObj.GetCacheCountde;ifdcacheCounta=2ethis.updateSpeed=1;elseifdcacheCounta4ethis.updateSpeed=2;elseifdcacheCounta8ethis.updateSpeed=4;elseifdcacheCounta16ethis.updateSpeed=8;elseifdcacheCounta32ethis.updateSpeed=16;else{cc加速追赶目标this.updateSpeed=MathConst.GetUpdateSpeeddcacheCounte;cccc立刻追赶目标ccfordleti=0;iacacheCount;i++ecc{ccworldObj.OptimisticFixedLoopdthis.intervalTimee;cc}}}else{this.updateSpeed=1;}}publicInitCBde{letins=LogicShareDataMgr.GetInstancede;ifdins==nulle{thread.errord"LogicWorldManagerInitCBerror!!!"e;return;}letpreData=ins.preData;letthisObj=this;cc监听render是否主动修改了isStart属性preData.addEventCBd"isStart",de=b{letworldObj=this.world;ifdworldObj==nullereturn;worldObj.isStart=preData.isStart;},thise;}publicUpdateShareDatade{letworldObj=this.world;ifdworldObj==nullereturn;cc发送帧数等基本信息到renderSNetWar.RefreshFrameInfodworldObj.frameCount,worldObj.serverFrameCount,this.updateSpeed,worldObj.isStarte;SNetWar.RefreshUpdateDatade;}}}﻿interfaceIAutoGroupResData{groupName:string;resArray:string[];}ccclassPreSkillItemDatacc{ccpublicid:number;ccpubliclv:number;ccpublicconstructordecc{cc}ccpublicDisposedecc{cc}cc}classPreHeroItemData{publicid:number;publiclv:number;publicgoldLv:number;publicconstructorde{}publicDisposede{}}classPreWarItemData{publicfightRoleId:number;publicposType:number;publicatkType:number;publicname:string;publicfamilyName:string;publiciconName:string;publicedgeId:number;publiccupCount:number=500;publiclevel:number;publicserverId:number;publicisRobot:boolean;publicteamInfo:PreHeroItemData[];publickingTowerID:number;publicqueenTowerID:number;publicconstructorde{this.kingTowerID=99010;this.queenTowerID=MathConst.QueenTowerID;}cc用来保存数据到自定义json回放数据publicCopyToObjectddestData:anye:any{destData["fightRoleId"]=this.fightRoleId;destData["posType"]=this.posType;destData["atkType"]=this.atkType;destData["name"]=this.name;destData["familyName"]=this.familyName;destData["iconName"]=this.iconName;destData["edgeId"]=this.edgeId;destData["cupCount"]=this.cupCount;destData["level"]=this.level;destData["serverId"]=this.serverId;destData["isRobot"]=this.isRobot;destData["kingTowerID"]=this.kingTowerID;destData["queenTowerID"]=this.queenTowerID;letteamInfo=destData["teamInfo"]=[];fordlettempHeroDataofthis.teamInfoe{letheroData:any={};heroData["id"]=tempHeroData.id;heroData["lv"]=tempHeroData.lv;heroData["goldLv"]=tempHeroData.goldLv;teamInfo.pushdheroDatae;}returndestData;}cc加载自定义的json回放数据publicCopyToMatchInfoddestData:Protocol.IMatchInfoe:Protocol.IMatchInfo{destData.roleId=this.fightRoleId;destData.pos=this.posType;destData.name=this.name;destData.familyName=this.familyName;destData.iconName=this.iconName;destData.edgeId=this.edgeId;destData.cups=this.cupCount;destData.level=this.level;destData.serverId=this.serverId;destData.isRobot=this.isRobot;ccdestData.kingTowerID=this.kingTowerID;ccdestData.queenTowerID=this.queenTowerID;letheros=destData.heros=[];fordlettempHeroDataofthis.teamInfoe{letheroData=newProtocol.Herode;heroData.index=tempHeroData.id;heroData.level=tempHeroData.lv;heroData.goldLevel=tempHeroData.goldLv;heros.pushdheroDatae;}returndestData;}cc加载自定义的json回放数据publicCopyFromObjectdsrcData:anye{this.fightRoleId=srcData["fightRoleId"];this.posType=srcData["posType"];this.atkType=srcData["atkType"];this.name=srcData["name"];this.familyName=srcData["familyName"];this.iconName=srcData["iconName"];this.edgeId=srcData["edgeId"];this.cupCount=srcData["cupCount"];this.level=srcData["level"];this.serverId=srcData["serverId"];this.isRobot=srcData["isRobot"];this.kingTowerID=srcData["kingTowerID"];this.queenTowerID=srcData["queenTowerID"];this.teamInfo=[];letteamInfo:any[]=srcData["teamInfo"];fordlettempHeroDataofteamInfoe{letheroData=newPreHeroItemDatade;heroData.id=NumberdtempHeroData["id"]e;heroData.lv=NumberdtempHeroData["lv"]e;heroData.goldLv=NumberdtempHeroData["goldLv"]e;this.teamInfo.pushdheroDatae;}}publicCopyFromMatchInfodfightRoleId:number,srcData:Protocol.IMatchInfoe{letkingTowerID=99010;letqueenTowerID=MathConst.QueenTowerID;letheroIDSet:Setanumberb=newSetanumberbde;letteamInfo:PreHeroItemData[]=[];fordletheroofsrcData.herose{ifd!ECS.LogicWarUtil.IsLeaderdsrcData.pose&&ECS.LogicWarUtil.IsTowerdhero.indexeecc非队长不能放置防御塔continue;ifdECS.LogicWarUtil.IsKingTowerdhero.indexeecc国王塔的id换成服务器发过来的id否则就是默认的99010kingTowerID=hero.index;letpreHeroItemData=newPreHeroItemDatade;preHeroItemData.id=hero.index;preHeroItemData.lv=hero.level;preHeroItemData.goldLv=hero.goldLevel;teamInfo.pushdpreHeroItemDatae;ifdECS.LogicWarUtil.IsTowerdhero.indexeepreHeroItemData.lv=srcData.level;heroIDSet.adddhero.indexe;}cc公主塔攻守双方共享防御塔（只有双方队长可以放置防御塔）ifdECS.LogicWarUtil.IsLeaderdsrcData.posee{lettowerIDArray:number[]=[queenTowerID,kingTowerID];fordlettowerIdoftowerIDArraye{ifdheroIDSet.hasdtowerIdeecontinue;letpreHeroItemData=newPreHeroItemDatade;preHeroItemData.id=towerId;preHeroItemData.lv=srcData.level;preHeroItemData.goldLv=0;teamInfo.pushdpreHeroItemDatae;}}heroIDSet.clearde;this.fightRoleId=fightRoleId;this.teamInfo=teamInfo;this.level=srcData.level;this.posType=srcData.pos;this.atkType=Math.floordsrcData.posc10e;this.name=srcData.name;this.familyName=srcData.familyName==null||srcData.familyName==""?"":srcData.familyName;this.iconName=srcData.iconName==null||srcData.iconName==""?"1001":srcData.iconName;this.edgeId=srcData.edgeId==null||srcData.edgeId==0?1001:srcData.edgeId;this.serverId=NumberdsrcData.roleIde;this.isRobot=srcData.isRobot;this.cupCount=srcData.cups;this.kingTowerID=kingTowerID;this.queenTowerID=queenTowerID;}ccpublicCopyFromInstancedsrcData:PreWarItemDataecc{ccthis.posType=srcData.posType;ccthis.fightRoleId=srcData.fightRoleId;ccthis.name=srcData.name;ccthis.familyName=srcData.familyName;ccthis.iconName=srcData.iconName;ccthis.edgeId=srcData.edgeId;ccthis.cupCount=srcData.cupCount;ccthis.level=srcData.level;ccthis.serverId=srcData.serverId;ccthis.isRobot=srcData.isRobot;ccthis.kingTowerID=srcData.kingTowerID;ccthis.queenTowerID=srcData.queenTowerID;ccthis.teamInfo=[];ccfordletheroofsrcData.teamInfoecc{ccletpreHeroItemData=newPreHeroItemDatade;ccpreHeroItemData.id=hero.id;ccpreHeroItemData.lv=hero.lv;ccpreHeroItemData.goldLv=hero.goldLv;ccthis.teamInfo.pushdpreHeroItemDatae;cc}cc}publicDisposede{ifdthis.teamInfo!=nullethis.teamInfo.length=0;}}classWarResultInfo{publicwinAtkType:number;publicdieTowerInfo:SimpleMapanumber,numberb;publicrewardInfo:any[];publicconstructorde{this.dieTowerInfo=newSimpleMapanumber,numberbde;this.rewardInfo=null;}publicDisposede{ifdthis.dieTowerInfo!=nulle{this.dieTowerInfo.clearde;this.dieTowerInfo=null;}this.rewardInfo=null;}}﻿c****@author**cmoduleECS{classLockArea{publicminX:number;publicminY:number;publicmaxX:number;publicmaxY:number;publicindex:number;privatetowerPosArray:number[];cc当前锁定区域存在所需防御塔publicconstructordstartX:any,startY:any,endX:any,endY:anye{this.minX=Math.mindstartX,endXe;this.maxX=Math.maxdstartX,endXe;this.minY=Math.mindstartY,endYe;this.maxY=Math.maxdstartY,endYe;this.towerPosArray=[];}publicAddTowerPosdpos:numbere{ifdthis.towerPosArray.indexOfdposea=-1ethis.towerPosArray.pushdpose;}publicRemoveTowerPosdpos:numbere:boolean{letindex=this.towerPosArray.indexOfdpose;ifdindexb-1e{this.towerPosArray.splicedindex,1e;returntrue;}returnfalse;}publicIsValidde:booleancc当前锁定区域是否存在{returnthis.towerPosArray.lengthb0;}ccpublic}cc这个类比较特殊主线程和工作线程各有一份实例cc工作线程修改数据会同步到主线程d操作界面需要这里的很多数据eexportclassWarContainer{private_cellSize:number=MathConst.MapCellSize;private_landGrid:Grid;private_airGrid:Grid;private_index:number;private_path:NodePoint[];privatetowerCollideInfo:SMapanumber,Vector2[]b;privatelockAreaInfo:SMapanumber,LockArea[]b;privateshowLockArea:boolean;cc是否显示锁定区域cc可以摆放兵的格子列表d用来做AI机器人epubliclandGridNodePointInfo:SMapanumber,NodePoint[]b;publicairGridNodePointInfo:SMapanumber,NodePoint[]b;privateworld:WorldBaseaEntityBaseb;publicmapObj:ECSC.WarMap;publicconstructordworldObj:WorldBaseaEntityBasebe{this.world=worldObj;ifdIsMainThreadde&&!worldObj.IsLogicdeecc渲染层{this.mapObj=newECSC.WarMapdworldObje;}else{ccthis.mapObj=newWarMapdworldObje;}}publicInitdnumCols:number,numRows:number,cellSize:numbere{this._cellSize=cellSize;this.MakeGriddnumCols,numRows,cellSizee;ifdthis.mapObj!=nullethis.mapObj.Initdthis._landGrid,numCols,numRows,cellSizee;}publicDisposedeccTODONIU{ifdthis.towerCollideInfo!=nulle{this.towerCollideInfo.clearde;this.towerCollideInfo=null;}ifdthis.lockAreaInfo!=nulle{this.lockAreaInfo.clearde;this.lockAreaInfo=null;}this._path=null;ifdthis.landGridNodePointInfo!=nulle{this.landGridNodePointInfo.clearde;this.landGridNodePointInfo=null;}ifdthis.airGridNodePointInfo!=nulle{this.airGridNodePointInfo.clearde;this.airGridNodePointInfo=null;}ifdthis._landGrid!=nulle{this._landGrid.Disposede;this._landGrid=null;}ifdthis._airGrid!=nulle{this._airGrid.Disposede;this._airGrid=null;}this.DisposeMapde;this.world=null;}publicDisposeMapde{ifdthis.mapObj!=nulle{this.mapObj.Disposede;this.mapObj=null;}}publicGetGriddlandType:numbere:Grid{ifdlandType==LandType.Landereturnthis._landGrid;elsereturnthis._airGrid;}publicMakeTowerCollidedtowerComp:TowerComponente{ifdthis.mapObj!=nullethis.mapObj.MakeTowerCollidede;lettowerPos=towerComp.towerPos;letcollideArray=this.towerCollideInfo.getdtowerPose;ifdcollideArray==nulle{ifdIsMainThreaddeegame.warnd"_______MakeTowerCollide:towerPos:_______",towerPose;elsethread.warnd"_______MakeTowerCollide:towerPos:_______",towerPose;return;}towerComp.towerNodeArray=[];fordletptofcollideArraye{leti=pt.x;letj=pt.y;ifdib=0&&iaMathConst.GridCountX&&jb=0&&jaMathConst.GridCountYe{cc地面阻挡letnode=this._landGrid.getNodedi,je;node.addHerodtowerComp.ide;towerComp.towerNodeArray.pushdnodee;this.RefreshGridColordnode.x,node.ye;cc空中阻挡node=this._airGrid.getNodedi,je;node.addHerodtowerComp.ide;towerComp.towerNodeArray.pushdnodee;this.RefreshGridColordnode.x,node.ye;}else{ifdIsMainThreaddeegame.warnd"mapInfocollideerror:",i,je;elsethread.warnd"mapInfocollideerror:",i,je;}}}publicRelaseTowerCollidedtowerComp:TowerComponente{letlockAreaChange:boolean=false;letatkType=3-Math.floordtowerComp.towerPosc10e;letlockAreaArray=this.lockAreaInfo.getdatkTypee;fordletlockAreaObjoflockAreaArraye{ifdlockAreaObj.RemoveTowerPosdtowerComp.towerPosee{lockAreaChange=true;}}letwarComp=this.world.GetSingletonCompdComponentType.WarComponente;letmyAtkType:number=warComp.myAtkType;ifdlockAreaChange&&atkType==myAtkTypeethis.RefreshEnemyLockAreadthis.showLockArea,nulle;}publicRefreshEnemyLockAreadshow:boolean,heroData:game.CardDataIteme{ifdheroData!=nullethis.showLockArea=show&&LogicWarUtil.IsSelfAreadheroData.putTypee;elsethis.showLockArea=show;letwarComp=this.world.GetSingletonCompdComponentType.WarComponente;letmyAtkType:number=warComp.myAtkType;letlockAreaArray=this.lockAreaInfo.getdmyAtkTypee;letposIndex:number=0;fordletlockAreaObjoflockAreaArraye{letcellSize=MathConst.MapCellSize;ifd!lockAreaObj.IsValiddeecontinue;posIndex+=lockAreaObj.index;}ifdthis.mapObj!=nullethis.mapObj.RefreshEnemyLockAreadshow,heroData,posIndexe;}cc返回锁定区域的位置索引1,2,3,4不在锁定区域返回0publicIsInEnemyLockAreadx:number,y:number,atkType:number,cellSize:number=MathConst.MapCellSizee:number{letlockAreaArray=this.lockAreaInfo.getdatkTypeefordletlockAreaObjoflockAreaArraye{ifd!lockAreaObj.IsValiddeecontinue;ifdxb=lockAreaObj.minX*cellSize&&xalockAreaObj.maxX*cellSize&&yb=lockAreaObj.minY*cellSize&&yalockAreaObj.maxY*cellSizeereturnlockAreaObj.index;}return0;}cc根据当前位置寻找一个不是敌方锁定区域的位置publicGetValidPutPosdx:number,y:number,atkType:numbere:number[]{letthisObj=this;function_moveLeftde{cc往左偏移letmoveX=0;whiledtruee{ifdx+moveXa0ebreak;ifdthisObj.IsInEnemyLockAreadx+moveX,y,atkTypeeb0e{moveX-=MathConst.MapCellSize;}elsebreak;}returnmoveX;}function_moveRightde{cc往左偏移letmoveX=0;whiledtruee{ifdx+moveXa0ebreak;ifdthisObj.IsInEnemyLockAreadx+moveX,y,atkTypeeb0e{moveX+=MathConst.MapCellSize;}elsebreak;}returnmoveX;}function_moveTopde{cc往上偏移letmoveTopY=0;whiledtruee{ifdy+moveTopYa0e{moveTopY=-99999;break;}ifdthisObj.IsInEnemyLockAreadx,y+moveTopY,atkTypeeb0e{moveTopY-=MathConst.MapCellSize;}elsebreak;}returnmoveTopY;}function_moveBottomde{cc往下偏移letmoveBottomY=0;whiledtruee{ifdy+moveBottomYb=MathConst.MapPosMaxYe{moveBottomY=99999;break;}ifdthisObj.IsInEnemyLockAreadx,y+moveBottomY,atkTypeeb0e{moveBottomY+=MathConst.MapCellSize;}elsebreak;}returnmoveBottomY;}letposIndex=0;letlockAreaArray=this.lockAreaInfo.getdatkTypee;fordletlockAreaObjoflockAreaArraye{ifd!lockAreaObj.IsValiddeecontinue;posIndex+=lockAreaObj.index;}letwarComp=this.world.GetSingletonCompdComponentType.WarComponente;letisReverse:boolean=warComp.IsReversePosde;letcellSize=MathConst.MapCellSize;ifdposIndex==10||posIndex==4e{letmoveX=isReverse?_moveRight.calldthise:_moveLeft.calldthise;x+=moveX;}elseifdposIndex==9e{letpos=MathConst.CornerPosArray[posIndex];lettx=dpos[0]-1e*cellSize+cellSizec2;letty=dpos[1]-1e*cellSize+cellSizec2;ifdisReversee{tx=MathConst.MapPosMaxX-tx;ty=MathConst.MapPosMaxY-ty;}letmoveX=isReverse?_moveRight.calldthise:_moveLeft.calldthise;letmoveY=isReverse?_moveBottom.calldthise:_moveTop.calldthise;ccletmoveY=_moveTop.calldthise;letmoveCorner=Math.sqrtdMath.powdtx-x,2e+Math.powdty-y,2ee;ifdMath.absdmoveXea=Math.absdmoveYe&&Math.absdmoveXea=Math.absdmoveCorneree{x+=moveX;}elseifdMath.absdmoveYea=Math.absdmoveXe&&Math.absdmoveYea=Math.absdmoveCorneree{y+=moveY;}elseifdMath.absdmoveCornerea=Math.absdmoveXe&&Math.absdmoveCornerea=Math.absdmoveYee{x=tx;y=ty;}}elseifdposIndex==7e{letpos=MathConst.CornerPosArray[posIndex];lettx=dpos[0]-1e*cellSize+cellSizec2;letty=pos[1]*cellSize+cellSizec2;ifdisReversee{tx=MathConst.MapPosMaxX-tx;ty=MathConst.MapPosMaxY-ty;}letmoveX=isReverse?_moveRight.calldthise:_moveLeft.calldthise;letmoveY=isReverse?_moveTop.calldthise:_moveBottom.calldthise;ccletmoveY=_moveBottom.calldthise;letmoveCorner=Math.sqrtdMath.powdtx-x,2e+Math.powdty-y,2ee;ccgame.logd"moveX:",moveX,"moveY:",moveY,"__moveCorner:",moveCornere;ifdMath.absdmoveXea=Math.absdmoveYe&&Math.absdmoveXea=Math.absdmoveCorneree{x+=moveX;}elseifdMath.absdmoveYea=Math.absdmoveXe&&Math.absdmoveYea=Math.absdmoveCorneree{y+=moveY;}elseifdMath.absdmoveCornerea=Math.absdmoveXe&&Math.absdmoveCornerea=Math.absdmoveYee{x=tx;y=ty;}}else{ifdIsMainThreaddeegame.warnd"enemyLockAreaInfoposIndex:",posIndexe;elsethread.warnd"enemyLockAreaInfoposIndex:",posIndexe;}x=Math.floordxccellSizee*cellSize+cellSizec2;y=Math.floordyccellSizee*cellSize+cellSizec2;this.mapObj.RefreshPlayerPosdx,ye;return[x,y];}c***Createsagridwithabunchofrandomunwalkablenodes.*cprivateMakeGriddnumCols:number,numRows:number,cellSize:numbere:void{this.showLockArea=false;this._landGrid=newGriddnumCols,numRows,cellSizee;this._airGrid=newGriddnumCols,numRows,cellSizee;this.towerCollideInfo=newSMapanumber,Vector2[]bde;cc读取防御塔阻挡letmapInfo=JsonData.getGameDatad"mapinfo_json"e;lettypeArray:number[]=[10,11,12,20,21,22];fordlettypeoftypeArraye{this.towerCollideInfo.setdtype,[]e;letcollideArray:Vector2[]=this.towerCollideInfo.getdtypee;fordlet[x,y]ofmapInfo[type]e{collideArray.pushdnewVector2d[x,y]ee;}}cc读取障碍物阻挡letcollideArray=mapInfo[100];fordlet[x,y]ofcollideArraye{leti=x;letj=y;ifdib=0&&iaMathConst.GridCountX&&jb=0&&jaMathConst.GridCountYe{letnode=this._landGrid.getNodedi,je;cc障碍物阻挡只能阻挡陆军node.addHerod-1e;node.addHerod-2e;}else{ifdIsMainThreaddeegame.warnd"mapInfocollideerror:",i,je;elsethread.warnd"mapInfocollideerror:",i,je;}}cc不能放兵的区域d敌方锁定区域ethis.lockAreaInfo=newSMapanumber,LockArea[]bde;this.lockAreaInfo.setdAtkType.Attack,[]e;this.lockAreaInfo.setdAtkType.Defend,[]e;fordletareaInfoofMathConst.EnemyLockedAreaArraye{cc攻击方letattackLockAreaObj=newLockAreadareaInfo[0],areaInfo[1],areaInfo[2],areaInfo[3]e;attackLockAreaObj.index=NumberdareaInfo[4]e;lettowerPosArray=anumber[]bareaInfo[5];fordletposoftowerPosArraye{attackLockAreaObj.AddTowerPosdpose;}this.lockAreaInfo.getdAtkType.Attacke.pushdattackLockAreaObje;cc防守方letdefendLockAreaObj=newLockAreadMathConst.GridCountX-NumberdareaInfo[0]e,MathConst.GridCountY-NumberdareaInfo[1]e,MathConst.GridCountX-NumberdareaInfo[2]e,MathConst.GridCountY-NumberdareaInfo[3]ee;defendLockAreaObj.index=NumberdareaInfo[4]e;towerPosArray=anumber[]bareaInfo[5];fordletposoftowerPosArraye{letatkType=Math.floordposc10e;letindex=pos%10;pos=d3-atkTypee*10+2-index;defendLockAreaObj.AddTowerPosdpose;}this.lockAreaInfo.getdAtkType.Defende.pushddefendLockAreaObje;}cc可以摆放兵的格子列表d用来做AI机器人ecc陆地格子this.landGridNodePointInfo=newSMapanumber,NodePoint[]bde;this.landGridNodePointInfo.setdAtkType.Attack,[]e;this.landGridNodePointInfo.setdAtkType.Defend,[]e;letlandGridAttackNodeArray:NodePoint[]=this.landGridNodePointInfo.getdAtkType.Attacke;letlandGridDefendNodeArray:NodePoint[]=this.landGridNodePointInfo.getdAtkType.Defende;cc空中格子this.airGridNodePointInfo=newSMapanumber,NodePoint[]bde;this.airGridNodePointInfo.setdAtkType.Attack,[]e;this.airGridNodePointInfo.setdAtkType.Defend,[]e;letairGridAttackNodeArray:NodePoint[]=this.airGridNodePointInfo.getdAtkType.Attacke;letairGridDefendNodeArray:NodePoint[]=this.airGridNodePointInfo.getdAtkType.Defende;cc攻击方国王塔位置letattackKingPos=MathConst.AttackTowerPos[1];letattackX=attackKingPos[0];letattackY=attackKingPos[1];cc防守方国王塔位置letdefendKingPos=MathConst.DefendTowerPos[1];letdefendX=defendKingPos[0];letdefendY=defendKingPos[1];cc遍历fordletx=0;xanumCols;x++e{fordlety=0;yanumRows;y++e{cc不在最前后面2列以及最上2行以及最下2行放兵ifdxa2||xb=numCols-2||ya2||yb=numRows-2econtinue;cc陆地攻击方格子letattackNode1=this._landGrid.getNodedx,ye;attackNode1.tempDistance1=MathUtil.squaredDistance2ddefendX,defendY,attackNode1.x*cellSize+cellSizec2,attackNode1.y*cellSize+cellSizec2e;landGridAttackNodeArray.pushdattackNode1e;cc空中攻击方格子letattackNode2=this._airGrid.getNodedx,ye;attackNode2.tempDistance1=MathUtil.squaredDistance2ddefendX,defendY,attackNode2.x*cellSize+cellSizec2,attackNode2.y*cellSize+cellSizec2e;airGridAttackNodeArray.pushdattackNode2e;cc陆地防守方格子letdefendNode1=this._landGrid.getNodedx,ye;defendNode1.tempDistance2=MathUtil.squaredDistance2dattackX,attackY,defendNode1.x*cellSize+cellSizec2,defendNode1.y*cellSize+cellSizec2e;landGridDefendNodeArray.pushddefendNode1e;cc空中防守方格子letdefendNode2=this._airGrid.getNodedx,ye;defendNode2.tempDistance2=MathUtil.squaredDistance2dattackX,attackY,defendNode2.x*cellSize+cellSizec2,defendNode2.y*cellSize+cellSizec2e;airGridDefendNodeArray.pushddefendNode2e;}}function_sortFunc1da:NodePoint,b:NodePointe:number{ifda.tempDistance1bb.tempDistance1ereturn1;elseifda.tempDistance1ab.tempDistance1ereturn-1;else{ifda.x*100+a.yab.x*100+b.yereturn1;elsereturn-1;}}function_sortFunc2da:NodePoint,b:NodePointe:number{ifda.tempDistance2bb.tempDistance2ereturn1;elseifda.tempDistance2ab.tempDistance2ereturn-1;else{ifda.x*100+a.yab.x*100+b.yereturn1;elsereturn-1;}}landGridAttackNodeArray.sortd_sortFunc1e;airGridAttackNodeArray.sortd_sortFunc1e;landGridDefendNodeArray.sortd_sortFunc2e;airGridDefendNodeArray.sortd_sortFunc2e;}cc根据实际的坐标位置设置寻路的起始目标点publicSetStartEndPosdxpos1,ypos1,xpos2,ypos2,landTypee{letgrid=this.GetGriddlandTypee;xpos1=Math.floordxpos1cgrid.cellSizee;ypos1=Math.floordypos1cgrid.cellSizee;xpos2=Math.floordxpos2cgrid.cellSizee;ypos2=Math.floordypos2cgrid.cellSizee;grid.setStartNodedxpos1,ypos1e;grid.setEndNodedxpos2,ypos2e;}cc寻路collideType：可以越过的阻挡类型列表publicFindPathdlandType:number,collideType:number[]e:NodePoint[]{letgrid=this.GetGriddlandTypee;letnodeArray:NodePoint[]=[];ifdcollideType.lengthb0enodeArray=grid.GetCollideNodeByTypedcollideTypee;cc把可以越过的阻挡暂时设置为无阻挡fordletnodeofnodeArraye{ifdnode.walkablee{ifdIsMainThreaddeegame.errord"---------GetCollideNodeByTypeerror:---",node.x,node.ye;elsethread.errord"---------GetCollideNodeByTypeerror:---",node.x,node.ye;}node.walkable=true;}varastar:AStar=newAStarde;ifdastar.findPathdgridee{this._path=astar.path;}else{this._path=null;}cc还原可以越过的阻挡fordletnodeofnodeArraye{node.walkable=false;}returnthis._path;}cc检测得到的路径是否合法publicCheckPathValiddpath:NodePoint[]e:boolean{fordleti=0;iapath.length;++ie{ifd!path[i].walkableereturnfalse;}returntrue;}publicFloydPathdpath:NodePoint[],landType:number,sx:number,sy:number,ex:number,ey:numbere:NodePoint[]{letgrid=this.GetGriddlandTypee;returnAStar.floydPathdpath,grid,sx,sy,ex,eye;}publicGetNodedx:number,y:number,landType:number,cellSize=MathConst.MapCellSizee:NodePoint{letgrid=this.GetGriddlandTypee;x=Math.floordxccellSizee;y=Math.floordyccellSizee;letnode:NodePoint=grid.getNodedx,ye;returnnode;}publicSetWalkabledx:number,y:number,size:number,value:boolean,id:number,landType:numbere{letcellSize=MathConst.MapCellSize;x=Math.floordxccellSizee;y=Math.floordyccellSizee;letgrid=this.GetGriddlandTypee;grid.setWalkabledx,y,valuee;this.RefreshGridColordx,ye;}publicRefreshGridColordx:number,y:number,color:number=-1e{ifdthis.mapObj!=nullethis.mapObj.RefreshGridColordthis._landGrid,x,y,colore;}publicGetWalkabledx:number,y:number,landType:numbere:boolean{ifdxa0ereturnfalse;ifdya0ereturnfalse;ifdxb=MathConst.GridCountXereturnfalse;ifdyb=MathConst.GridCountYereturnfalse;letgrid=this.GetGriddlandTypee;letnode=grid.getNodedx,ye;ifdnode==nulle{ifdIsMainThreaddeegame.logd"GetWalkableError:",x,ye;elsethread.logd"GetWalkableError:",x,ye;returnfalse;}returnnode.walkable;}publicGetWalkablePosd_x:number,_y:number,landType:number,putType:number,campType:number,atkType:numbere:number[]{letcellSize=MathConst.MapCellSize;let_x1=Math.floord_xccellSizee;let_y1=Math.floord_yccellSizee;letcountY:number=MathConst.GridCountY;letposArrayArray=MathConst.ValidPosArrayArray;letdebug_pos_array:any[]=[];letx,y;fordletposArrayofposArrayArraye{fordletposofposArraye{x=_x1+pos[0];y=_y1+pos[1];cc判断是否在锁定区域内TODONIU这里的判断有点复杂先不处理letisInLockArea:boolean=false;letisWalkable:boolean=true;ifdLogicWarUtil.IsSelfAreadputTypeeecc只有putType为selfArea才会检测敌我区域范围isInLockArea=this.IsInEnemyLockAreadx+0.5,y+0.5,atkType,1eb0;ifdputType==PutType.SelfUnCollideArea||putType==PutType.AllMapUnCollideAreaeisWalkable=this.GetWalkabledx,y,landTypee;ifd!isInLockArea&&isWalkablee{ccgame.logd"x:",x,"y:",y,isInLockAreae;debug_pos_array.pushd[x*cellSize,y*cellSize,true]eifdthis.mapObj!=nulle{this.mapObj.RefreshDebugCellPosddebug_pos_arraye;}ccreturn[x*cellSize+cellSizec2,y*cellSize+cellSizec2];ifdpos[0]==0&&pos[1]==0ereturn[_x,_y];elsereturn[x*cellSize+cellSizec2,y*cellSize+cellSizec2];}else{debug_pos_array.pushd[x*cellSize,y*cellSize,false]e}}}ifdIsMainThreaddeegame.errord"WarContainerGetWalkablePoserror:",_x,_ye;elsethread.errord"WarContainerGetWalkablePoserror:",_x,_ye;return[_x,_y];}cccccccc格子锁定ccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicIsPosLockeddx:number,y:number,landType:numbere:boolean{letgrid=this.GetGriddlandTypee;returngrid.IsPosLockeddx,ye;}cc尝试锁定该格子返回false表示锁定失败publicTryLockPosdx:number,y:number,heroID:number,landType:numbere:boolean{letgrid=this.GetGriddlandTypee;returngrid.TryLockPosdx,y,heroIDe;}publicUnlockHerodheroID:number,landType:numbere:number{letgrid=this.GetGriddlandTypee;returngrid.UnlockHerodheroIDe;}}}ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccCopyrightdce2014-present,EgretTechnology.ccAllrightsreserved.ccRedistributionanduseinsourceandbinaryforms,withorwithoutccmodification,arepermittedprovidedthatthefollowingconditionsaremet:cccc*Redistributionsofsourcecodemustretaintheabovecopyrightccnotice,thislistofconditionsandthefollowingdisclaimer.cc*Redistributionsinbinaryformmustreproducetheabovecopyrightccnotice,thislistofconditionsandthefollowingdisclaimerintheccdocumentationandcorothermaterialsprovidedwiththedistribution.cc*NeitherthenameoftheEgretnortheccnamesofitscontributorsmaybeusedtoendorseorpromoteproductsccderivedfromthissoftwarewithoutspecificpriorwrittenpermission.ccccTHISSOFTWAREISPROVIDEDBYEGRETANDCONTRIBUTORS"ASIS"ANDANYEXPRESSccORIMPLIEDWARRANTIES,INCLUDING,BUTNOTLIMITEDTO,THEIMPLIEDWARRANTIESccOFMERCHANTABILITYANDFITNESSFORAPARTICULARPURPOSEAREDISCLAIMED.ccINNOEVENTSHALLEGRETANDCONTRIBUTORSBELIABLEFORANYDIRECT,INDIRECT,ccINCIDENTAL,SPECIAL,EXEMPLARY,ORCONSEQUENTIALDAMAGESdINCLUDING,BUTNOTccLIMITEDTO,PROCUREMENTOFSUBSTITUTEGOODSORSERVICES;LOSSOFUSE,DATA,ccORPROFITS;ORBUSINESSINTERRUPTIONeHOWEVERCAUSEDANDONANYTHEORYOFccLIABILITY,WHETHERINCONTRACT,STRICTLIABILITY,ORTORTdINCLUDINGccNEGLIGENCEOROTHERWISEeARISINGINANYWAYOUTOFTHEUSEOFTHISSOFTWARE,ccEVENIFADVISEDOFTHEPOSSIBILITYOFSUCHDAMAGE.ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccclassThemeAdapterimplementseui.IThemeAdapter{c***解析主题*@paramurl待解析的主题url*@paramonSuccess解析完成回调函数，示例：compFuncde:egret.Evente:void;*@paramonError解析失败回调函数，示例：errorFuncde:void;*@paramthisObject回调的this引用*cpublicgetThemedurl:string,onSuccess:Function,onError:Function,thisObject:anye:void{functiononResGetde:stringe:void{onSuccess.calldthisObject,ee;}functiononResErrorde:RES.ResourceEvente:void{ifde.resItem.url==urle{RES.removeEventListenerdRES.ResourceEvent.ITEM_LOAD_ERROR,onResError,nulle;onError.calldthisObjecte;}}ifdtypeofgenerateEUI!=='undefined'e{egret.callLaterdde=b{onSuccess.calldthisObject,generateEUIe;},thise;}elseifdtypeofgenerateEUI2!=='undefined'e{RES.getResByUrld"resourcecgameEui.json",ddata,urle=b{window["JSONParseClass"]["setData"]ddatae;egret.callLaterdde=b{onSuccess.calldthisObject,generateEUI2e;},thise;},this,RES.ResourceItem.TYPE_JSONe;}elseifdtypeofgenerateJSON!=='undefined'e{ifdurl.indexOfd".exml"eb-1e{letdataPath=url.splitd"c"e;dataPath.popde;letdirPath=dataPath.joind"c"e+"_EUI.json";ifd!generateJSON.paths[url]e{RES.getResByUrlddirPath,ddatae=b{window["JSONParseClass"]["setData"]ddatae;egret.callLaterdde=b{onSuccess.calldthisObject,generateJSON.paths[url]e;},thise;},this,RES.ResourceItem.TYPE_JSONe;}else{egret.callLaterdde=b{onSuccess.calldthisObject,generateJSON.paths[url]e;},thise;}}else{egret.callLaterdde=b{onSuccess.calldthisObject,generateJSONe;},thise;}}else{RES.addEventListenerdRES.ResourceEvent.ITEM_LOAD_ERROR,onResError,nulle;RES.getResByUrldurl,onResGet,this,RES.ResourceItem.TYPE_TEXTe;}}}declarevargenerateEUI:{paths:string[],skins:any}declarevargenerateEUI2:{paths:string[],skins:any}declarevargenerateJSON:{paths:string[],skins:any}modulegame{classTimerItem{publictotalTime:number;publicleftTime:number;publicfunc:Function;publicthisObj:any;publicargs:number;publicisNoBreak:boolean=false;cc是否可以打断publicstack:string;publicconstructorde{}publicExecde:boolean{ifdthis.thisObj==nullereturnthis.funcdthis.args,this.stacke;elsereturnthis.func.calldthis.thisObj,this.args,this.stacke;}publicDisposede{this.func=null;this.thisObj=null;this.args=null;this.stack=null;}}exportclassTimerMgr{privatestaticinstance:TimerMgr;publicstaticGetInstancede:TimerMgr{ifdTimerMgr.instance==nulle{TimerMgr.instance=newTimerMgrde;}returnTimerMgr.instance;}privatetimerDict:SMapanumber,TimerItemb;privatetimerKeys:number[];privateisChange:boolean=false;privatelastTime:number=0;publicfixedTimer:number=0;publicconstructorde{this.timerDict=newSMapanumber,TimerItembde;this.timerKeys=[];egret.startTickdthis.Update,thise;}privateUpdatedtotalTime:numbere:boolean{returnthis.TryUpdatedtotalTimee;cctrycc{ccreturnthis.TryUpdatedtotalTimee;cc}cccatchderrorecc{ccgame.ErrorManager.CacheExceptionderror.message,error.stacke;ccreturntrue;cc}}privateTryUpdatedtotalTime:numbere:boolean{letdt=totalTime-this.lastTime;GameData.FPS=1000cdt;ifdthis.lastTime==0e{dt=0;GameData.FPS=60;}this.lastTime=totalTime;this.fixedTimer+=dt;cc更新定时器this.UpdateTimerddte;ifdthis.fixedTimerb200ecc一些更新频率不高需求{this.fixedTimer=0;}try{NetUtil.UploadLogOneByOnede;}catchderrore{console.errord"-----UploadLogOneByOneerror:---",error.message,error.stacke;}returntrue;}publicAddNoBreakTimerdtime:number,func:Function,thisObj:any=null,args:any=nulle:number{letkey=this.AddTimerdtime,func,thisObj,argse;lettimerObj=this.timerDict.getdkeye;timerObj.isNoBreak=true;returnkey;}cc添加定时器cctime:间隔时间（毫秒）fun:调用函数args:参数publicAddTimerdtime:number,func:Function,thisObj:any=null,args:any=nulle:number{lettimerObj=newTimerItemde;timerObj.totalTime=time;timerObj.leftTime=time;timerObj.func=func;timerObj.thisObj=thisObj;timerObj.args=args;timerObj.isNoBreak=false;ifdtimea=0e{timerObj.Execde;timerObj.Disposede;return0;}ifdGameData.DevelopModeb=DevelopMode.Debuge{timerObj.stack=newErrorde.stack;}letkey_id=IDManager.NewKeyIDde;this.timerDict.setdkey_id,timerObje;this.isChange=true;returnkey_id;}publicRemoveTimerdkeye{ifdthis.timerDict.hasdkeyee{this.timerDict.deletedkeye;this.isChange=true;}}publicUpdateTimerddeltaTime:numbere{ifdthis.isChangee{this.timerKeys=Utils.ArrayCopyanumberbdthis.timerDict.keysdee;this.isChange=false;}letkeys=this.timerKeys;letdict=this.timerDict;lettimerObj:TimerItem;lettotalTime,leftTime,func,args,isContinue;fordletkeyofkeyse{timerObj=dict.getdkeye;ifdtimerObj==nullecontinue;timerObj.leftTime-=deltaTime;ifdtimerObj.leftTimea=0e{try{isContinue=timerObj.Execde;}catchderrore{ifdIsMainThreaddeegame.ErrorManager.UploadExceptionderror.message,error.stacke;elsegame.ErrorManager.LogicUploadExceptionderror.message,error.stacke;isContinue=false;}ifdtimerObj.isNoBreakecc不可以打断的定时器isContinue=true;ifd!isContinuee{timerObj.Disposede;dict.deletedkeye;this.isChange=true;}else{timerObj.leftTime=timerObj.totalTime;}}}}}}﻿c***游戏容器类*bydily*dcecopyright2014-2035*AllRightsReserved.*EgerPro显示对象层级*Main-GameScene（sceneLayer、mainLayer、popLayer、effectLayer、maskLayer、loadLayer）**cmodulegame{exportclassGameSceneLayerextendseui.UILayer{publicmapLayer:eui.UILayer=neweui.UILayerde;cc地图层publicobjectLayer:eui.UILayer=neweui.UILayerde;cc怪物层、士兵层、英雄层、塔层publicweaponLayer:eui.UILayer=neweui.UILayerde;cc弓箭、炮弹层privatestatic_instance:GameSceneLayer;cc构造方法publicconstructorde{superde;this.initde;}cc游戏容器管理器单例publicstaticgameLayerde:GameSceneLayer{ifd!this._instanceethis._instance=newGameSceneLayerde;returnthis._instance;}cc初始化场景类publicinitde:void{this.touchThrough=false;this.touchEnabled=false;this.touchChildren=false;this.mapLayer.touchThrough=false;this.mapLayer.touchEnabled=false;this.mapLayer.name="mapLayer";this.objectLayer.touchThrough=false;this.objectLayer.touchEnabled=false;this.objectLayer.name="objectLayer";this.objectLayer.anchorOffsetX=GameData.Widthc2;this.objectLayer.anchorOffsetY=GameData.Heightc2;this.objectLayer.width=GameData.Width;this.objectLayer.height=GameData.Height;this.objectLayer.x=GameData.Widthc2;this.objectLayer.y=GameData.Heightc2;this.weaponLayer.touchThrough=false;this.weaponLayer.touchEnabled=false;this.weaponLayer.name="weaponLayer";this.addChilddthis.mapLayere;this.addChilddthis.objectLayere;this.addChilddthis.weaponLayere;}}exportclassGameLayerManagerextendseui.UILayer{cc场景层如战场、主城、副本战场之类的没有事件响应publicsceneLayer:GameSceneLayer=GameSceneLayer.gameLayerde;cc为场景层设置的一个可以点击的层publicclickSceneLayer:eui.UILayer=neweui.UILayerde;publicmainCenterLayer:game.MainCenter;cc主UI层如底部功能栏publicmainLayer:eui.UILayer=neweui.UILayerde;cc弹窗层如设置、背包、装备之类的publicpanelLayer:eui.UILayer=neweui.UILayerde;cc特效层如闪烁、飘字之类的publiceffectLayer:eui.UILayer=neweui.UILayerde;cc通讯遮罩层和服务器通讯UIpublicmaskLayer:eui.UILayer=neweui.UILayerde;cc加载遮罩层场景切换的时候加载资源UIpublicloadLayer:eui.UILayer=neweui.UILayerde;privatestatic_instance:GameLayerManager;cc构造方法publicconstructorde{superde;this.initde;}cc游戏容器管理器单例publicstaticgameLayerde:GameLayerManager{ifd!this._instanceethis._instance=newGameLayerManagerde;returnthis._instance;}cc初始化场景类publicinitde:void{this.touchThrough=true;this.sceneLayer.touchThrough=false;this.sceneLayer.name="sceneLayer";this.clickSceneLayer.touchThrough=true;this.clickSceneLayer.name="clickSceneLayer";this.mainLayer.touchThrough=true;this.mainLayer.name="mainLayer";this.panelLayer.touchThrough=true;this.panelLayer.name="panelLayer";this.effectLayer.touchThrough=true;this.effectLayer.name="effectLayer";this.maskLayer.touchThrough=true;this.maskLayer.name="maskLayer";this.loadLayer.touchThrough=true;this.loadLayer.name="loadLayer";this.addChilddthis.sceneLayere;this.addChilddthis.clickSceneLayere;this.addChilddthis.mainLayere;this.addChilddthis.panelLayere;this.addChilddthis.effectLayere;this.addChilddthis.maskLayere;this.addChilddthis.loadLayere;}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassAchieveDescTipsCextendsUICtrlBase{publicconstructorde{superde;}cc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnAchieveDescTipsPanel;}cc做一下类型转换方便调用一定要有!!!protectedgettestPanelde{returnaAchieveDescTipsPanelbthis.panel;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0e;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}c***初始化面板数据*cpublicInitDatade:void{}}}﻿c****cmodulegame{exportclassAchieveDescTipsPanelextendsUIComponentBase{publicconstructorde{superd"AchieveDescTipsSkin"e;}publicroot:eui.Group;publiccloseBtn:SButton;publicbottomBtn:SButton;publicgradeLabel1:eui.Label;publicgradeLabel2:eui.Label;publicgradeLabel3:eui.Label;publicgradeLabel4:eui.Label;publicgradeLabel5:eui.Label;publicgradeLabel6:eui.Label;protectedchildrenCreatedde{super.childrenCreatedde;this.InitCBde;this.gradeLabel1.text="";letdataProxy=JsonData.getGameDatad"achieve_stardata_json"e;letlabelList=[this.gradeLabel1,this.gradeLabel2,this.gradeLabel3,this.gradeLabel4,this.gradeLabel5,this.gradeLabel6,];letindex=0;fordletlvindataProxye{letdata=dataProxy[lv];ifddata["upgrade"]!=0e{letlabel=labelList[index];ifdlabel!=nullelabel.text=data["name"];index++;}}}privateInitCBde{this.AddTouchEventdthis.closeBtn,de=b{UIManager.HidePaneldPanelTypeConst.AchieveDescTipse;},thise;this.AddTouchEventdthis.bottomBtn,de=b{UIManager.HidePaneldPanelTypeConst.AchieveDescTipse;},thise;}protectedDestroyde{}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassAchieveFullTipsCextendsUICtrlBase{publicconstructorde{superde;}cc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnAchieveFullTipsPanel;}cc做一下类型转换方便调用一定要有!!!protectedgettestPanelde{returnaAchieveFullTipsPanelbthis.panel;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0e;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}c***初始化面板数据*cpublicInitDatade:void{}}}﻿c****cmodulegame{exportclassAchieveFullTipsPanelextendsUIComponentBase{publicroot:eui.Group;publicconstructorde{superd"AchieveFullTipsSkin",truee;}protectedchildrenCreatedde{super.childrenCreatedde;}protectedDestroyde{}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassAchieveGradeInfoCextendsUICtrlBase{publicconstructorde{superde;}cc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnAchieveGradeInfoPanel;}cc做一下类型转换方便调用一定要有!!!protectedgettestPanelde{returnaAchieveGradeInfoPanelbthis.panel;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0e;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}c***初始化面板数据*cpublicInitDatade:void{}}}﻿c****cmodulegame{exportclassAchieveGradeInfoPanelextendsUIComponentBase{publicroot:eui.Group;publiccloseBtn:SButton;publicbottomBtn:SButton;publicdescLabel:eui.Label;publictitle:eui.Label;publicrewardGroup:eui.Group;publicitemArray:CommonItem[];privateisTaskDone:boolean;publicconstructorde{superd"AchieveGradeInfoSkin"e;this.itemArray=[];this.isTaskDone=false;}protectedchildrenCreatedde{super.childrenCreatedde;this.InitCBde;}privateInitCBde{this.AddTouchEventdthis.closeBtn,de=b{UIManager.HidePaneldPanelTypeConst.AchieveGradeInfoe;},thise;this.AddTouchEventdthis.bottomBtn,de=b{ifdthis.isTaskDoneegame.logd"任务完成开始晋级任务"e;},thise;letachieveDataMgr=MainDataMgr.GetInstancede.achieveDataMgr;lettaskObj=achieveDataMgr.upgradTask;ifdtaskObj==nulle{game.errord"achieveDataMgr.upgradTaskerror:"e;return;}this.AddPropCBdtaskObj,"nowCount",this.RefreshInfoe;}privateRefreshInfode{letachieveDataMgr=MainDataMgr.GetInstancede.achieveDataMgr;lettaskObj=achieveDataMgr.upgradTask;ifdtaskObj==nullereturn;this.DestroyRewardde;cc奖励letrewardList=taskObj.GetRewardde;fordletrewardofrewardListe{letitemId=reward["itemid"];letitemCount=reward["count"];letitemObj:CommonItem;itemObj=newCommonItemd"WarOverRewardItemSkin"e;this.itemArray.pushditemObje;this.rewardGroup.addChildditemObje;itemObj.SetCreateOverCBdde=b{letobj=itemObj;obj["icon"].source=RES.getResdDataUtil.GetItemSourceditemIdee;obj["count"].text=itemCount.toStringde;},itemObje;}this.isTaskDone=dtaskObj.nowCount==taskObj.totalCounte;this.bottomBtn.SetTextd"开始挑战"e;RenderUtils.SetGreydthis.bottomBtn,!this.isTaskDoneeletnameStr=DataUtil.GetValueByKeyd"achieve_stardata_json",achieveDataMgr.upgradeLv,"name"e;ifdnameStr==nullenameStr=achieveDataMgr.name;this.title.text=nameStr;}privateDestroyRewardde{fordletitemObjofthis.itemArraye{itemObj.DestroyAllde;}this.itemArray=[];}protectedDestroyde{this.DestroyRewardde;}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassAchieveInfoCextendsUICtrlBase{publicconstructorde{superde;}cc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return["home_achieve"];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnAchieveInfoPanel;}cc做一下类型转换方便调用一定要有!!!protectedgettestPanelde{returnaAchieveInfoPanelbthis.panel;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0e;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}c***初始化面板数据*cpublicInitDatade:void{}}}﻿c****cmodulegame{exportclassAchieveInfoPanelextendsUIComponentBase{publicroot:eui.Group;publiccloseBtn:SButton;publiclvLabel:eui.Label;publicstar1Img:eui.Image;publicstar2Img:eui.Image;publicstar3Img:eui.Image;publicstar4Img:eui.Image;publicstar5Img:eui.Image;publiciconBtn:SButton;publicleftBtn:SButton;publicfullTipsLabel:eui.Label;publicgame_list_scroller:eui.Scroller;publicgame_list:eui.List;publicgameCellDatas:AchieveItemData[];publicconstructorde{superd"AchieveInfoSkin"e;this.gameCellDatas=[];}protectedchildrenCreatedde{super.childrenCreatedde;this.InitCBde;}privateInitCBde{this.AddTouchEventdthis.closeBtn,de=b{UIManager.HidePaneldPanelTypeConst.AchieveInfoe;},thise;this.AddTouchEventdthis.iconBtn,this.OnIconBtnClicked,thise;this.AddTouchEventdthis.leftBtn,de=b{UIManager.ShowPaneldPanelTypeConst.AchieveGradeInfoe;},thise;letachieveDataMgr=MainDataMgr.GetInstancede.achieveDataMgr;this.AddPropCBdachieveDataMgr,"lv",this.RefreshListe;}privateOnIconBtnClickedde{letachieveDataMgr=MainDataMgr.GetInstancede.achieveDataMgr;UIManager.ShowPaneldPanelTypeConst.AchieveDescTipse;}publicRefreshListde{this.DestroyListde;letachieveDataMgr=MainDataMgr.GetInstancede.achieveDataMgr;letindex=0;fordlettaskDataofachieveDataMgr.taskArraye{letcellData=newAchieveItemDatade;cellData.index=index;this.gameCellDatas.pushdcellDatae;index++;}this.game_list.itemRenderer=AchieveItem;this.game_list_scroller.viewport=this.game_list;letlistData=neweui.ArrayCollectiondthis.gameCellDatase;this.game_list.dataProvider=listData;this.game_list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.ItemSelected,thise;this.lvLabel.text=achieveDataMgr.name;letstartImgList=[this.star1Img,this.star2Img,this.star3Img,this.star4Img,this.star5Img,];fordleti=0;ia5;i++e{letimg=startImgList[i];ifdia=achieveDataMgr.star-1eimg.source=RES.getResd"home_ui_hero_json.icon_hero_star_1"e;elseimg.source=RES.getResd"home_ui_hero_json.icon_hero_star_0"e;}this.fullTipsLabel.visible=dachieveDataMgr.lvb=Const.MaxGradeLve;this.leftBtn.visible=dachieveDataMgr.lvaConst.MaxGradeLve;}protectedItemSelectedde:eui.ItemTapEvente:void{UIManager.ShowPaneldPanelTypeConst.AchieveTaskInfo,e.itemIndexe;}publicDestroyListde{this.gameCellDatas=[];fordleti=0;iathis.game_list.numChildren;i++e{letcellView=this.game_list.getChildAtdieasAchieveItem;cellView.DestroyAllde;}}protectedDestroyde{this.DestroyListde;}}}﻿modulegame{exportclassAchieveItemData{publicindex:number;publicconstructorde{}}exportclassAchieveItemextendsItemRenderBase{publicbg:eui.Image;publicnameLabel:eui.Label;publictipsLabel:eui.Label;publicprogressBar:eui.ProgressBar;publicconstructorde{superd"AchieveItemSkin"e;}privateisCreated:boolean=false;protectedchildrenCreatedde{super.childrenCreatedde;this.isCreated=true;ifdthis.data!=nulle{this.UpdateViewdthis.datae;}}dataChangedde{this.UpdateViewdthis.datae;}privateUpdateViewddata:FriendLeftItemDatae{ifd!this.isCreatedereturn;this.UpdateDatade;}privateUpdateDatade{letachieveDataMgr=MainDataMgr.GetInstancede.achieveDataMgr;lettaskObj=achieveDataMgr.GetTaskDatadthis.data.indexe;ifdtaskObj==nullereturn;this.nameLabel.text=taskObj.name;this.progressBar.minimum=0;this.progressBar.maximum=taskObj.totalCount;this.progressBar.value=taskObj.nowCountthis.tipsLabel.visible=dtaskObj.nowCount==taskObj.totalCounte;ifdtaskObj.state==0ethis.tipsLabel.text="可领取";elsethis.tipsLabel.text="已完成";}protectedDestroyde{}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassAchieveTaskInfoCextendsUICtrlBase{publicconstructorde{superde;}cc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnAchieveTaskInfoPanel;}cc做一下类型转换方便调用一定要有!!!protectedgettestPanelde{returnaAchieveTaskInfoPanelbthis.panel;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0,false,false,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}c***初始化面板数据*cpublicInitDatade:void{}}}﻿c****cmodulegame{exportclassAchieveTaskInfoPanelextendsUIComponentBase{publicroot:eui.Group;publiccloseBtn:SButton;publicbottomBtn:SButton;publicdescLabel:eui.Label;publicitem:AchieveItem;publicrewardGroup:eui.Group;publicitemArray:CommonItem[];privateindex:number;privateisTaskDone:boolean;publicconstructorde{superd"AchieveTaskInfoSkin"e;this.itemArray=[];this.isTaskDone=false;}protectedchildrenCreatedde{super.childrenCreatedde;}publicInitDatadindex:numbere{super.InitDatadindexe;this.InitCBdindexe;}privateInitCBdindex:numbere{this.AddTouchEventdthis.closeBtn,de=b{UIManager.HidePaneldPanelTypeConst.AchieveTaskInfoe;},thise;this.AddTouchEventdthis.bottomBtn,de=b{ifdthis.isTaskDoneegame.logd"任务完成发送领奖协议"e;UIManager.HidePaneldPanelTypeConst.AchieveTaskInfoe;},thise;letachieveDataMgr=MainDataMgr.GetInstancede.achieveDataMgr;lettaskObj=achieveDataMgr.GetTaskDatadindexe;ifdtaskObj==nulle{game.errord"achieveDataMgr.GetTaskDataerror:",indexe;return;}this.index=index;this.AddPropCBdtaskObj,"nowCount",this.RefreshInfoe;}privateRefreshInfode{letachieveDataMgr=MainDataMgr.GetInstancede.achieveDataMgr;lettaskObj=achieveDataMgr.GetTaskDatadthis.indexe;ifdtaskObj==nullereturn;this.descLabel.text=taskObj.desc;letcellData=newAchieveItemDatade;cellData.index=this.index;this.item.data=cellData;this.DestroyRewardde;cc奖励letrewardList=taskObj.GetRewardde;fordletrewardofrewardListe{letitemId=reward["itemid"];letitemCount=reward["count"];letitemObj:CommonItem;itemObj=newCommonItemd"WarOverRewardItemSkin"e;this.itemArray.pushditemObje;this.rewardGroup.addChildditemObje;itemObj.SetCreateOverCBdde=b{letobj=itemObj;obj["icon"].source=RES.getResdDataUtil.GetItemSourceditemIdee;obj["count"].text=itemCount.toStringde;},itemObje;}ifdtaskObj.nowCount==taskObj.totalCountethis.bottomBtn.SetTextd"领取奖励"e;elsethis.bottomBtn.SetTextd"关闭"e;this.isTaskDone=dtaskObj.nowCount==taskObj.totalCounte;}privateDestroyRewardde{fordletitemObjofthis.itemArraye{itemObj.DestroyAllde;}this.itemArray=[];}protectedDestroyde{this.DestroyRewardde;}}}﻿modulegame{exportclassPWSBoxItemextendsItemRenderBase{publicicon:eui.Image;publicnameLabel:eui.Label;publiccheckImg:eui.Image;publicbtn:SGroup;publicconstructorde{superd"PWSBoxItemSkin"e;this.isRemoveCBOnDataChanged=false;}privateisCreated:boolean=false;protectedchildrenCreatedde{super.childrenCreatedde;this.btn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnBtnClicked,thise;this.isCreated=true;ifdthis.data!=nulle{this.UpdateViewdthis.datae;}};privateOnBtnClickedde{letrewardData:PWSRewardInfo=this.GetRewardDatade;ifdrewardData.state==1e{cc发送领取协议ccUIManager.ShowPaneldPanelTypeConst.BoxTips,[]e;}else{letrewardData:PWSRewardInfo=this.GetRewardDatade;UIManager.ShowPaneldPanelTypeConst.BoxTips,[rewardData.itemId]e;cc弹出tips}}privateUpdateViewddata:anye{ifd!this.isCreatedereturn;letrewardData:PWSRewardInfo=this.GetRewardDatade;ifdrewardData.itemId==0e{game.errord"---taskrewardhasnoreward:------",rewardData.rewardIde;return;}leturl=DataUtil.GetItemSourcedrewardData.itemIde;this.icon.source=RES.getResdurle;this.nameLabel.text=`x${rewardData.itemCount}`;this.checkImg.visible=rewardData.state==2;}privateGetRewardDatade:PWSRewardInfo{letrewardType:number=this.data[0];letrewardIndex:number=this.data[1];letpwsDataMgr=MainDataMgr.GetInstancede.pwsDataMgr;letrewardData:PWSRewardInfo;ifdrewardType==1erewardData=pwsDataMgr.freeRewardInfoArray[rewardIndex];elserewardData=pwsDataMgr.vipRewardInfoArray[rewardIndex];returnrewardData;}dataChangedde{this.UpdateViewdthis.datae;}protectedDestroyde{this.btn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnBtnClicked,thise;}}}﻿modulegame{exportclassPWSInfoCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.effectLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnPWSInfoPanel;}cc做一下类型转换方便调用一定要有!!!protectedgetPWSInfoPanelde{returnaPWSInfoPanelbthis.panel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,false,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld0e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}c***初始化面板数据*cpublicInitDatade:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}}}modulegame{exportclassPWSInfoPanelextendsUIComponentBase{privatebtn1:RankPlayerBtn;privatebtn2:RankPlayerBtn;privatebtn5:RankPlayerBtn;privatebtn6:RankPlayerBtn;publiccloseBtn:SButton;privaterankGroup:eui.Group;privatelist:eui.List;privatescro:eui.Scroller;privatenoneTips:eui.Image;privaterewardGroup:eui.Group;privatesubGroup1:eui.Group;privatecupCount:eui.Label;privatesubGroup2:eui.Group;privatesubGroup3:eui.Group;privatesubGroup4:eui.Group;privatebar:eui.ProgressBar;privatedescGroup:eui.Group;privatedescLabel:eui.Label;privateupdateList:eui.ArrayCollection;privatecurrBtn:RankPlayerBtn;publicconstructorde{superd"PWSInfoSkin"e;}protectedchildrenCreatedde{super.childrenCreatedde;}publicInitDatade{this.updateList=neweui.ArrayCollectionde;this.list.itemRenderer=RankPlayerItem3;this.list.dataProvider=this.updateList;this.btn1.type=Const.RankType.GLOBAL;this.btn2.type=Const.RankType.PRE_GLOBAL;this.btn5.type=100;this.btn6.type=200;this.list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;this.scro.addEventListenerdeui.UIEvent.CHANGE,this.OnChange,thise;this.scro.addEventListenerdeui.UIEvent.CHANGE_END,this.OnChangeEnd,thise;ccGlobalEvent.SubscribedGlobalEventType.RankAddItem,this.OnAddItem,thise;this.ChangeTypedthis.btn1e;cc当实现此页面功能时，恢复这些代码ccletrankInfo=MainDataMgr.GetInstancede.rankDataMgr.GetRankInfodConst.RankInfoType.FIGHTe;ccrankInfo.ResetIndexde;ccMainDataMgr.GetInstancede.rankDataMgr.ReqNewRankInfodConst.RankInfoType.FIGHT,Const.RankType.GLOBALe;ccMainDataMgr.GetInstancede.rankDataMgr.ReqNewRankInfodConst.RankInfoType.FIGHT,Const.RankType.LOCALe;cc不应该一次性请求两个的this.AddTouchEventdthis.btn1,this.OnRankTypeTap,thise;this.AddTouchEventdthis.btn2,this.OnRankTypeTap,thise;this.AddTouchEventdthis.btn5,this.OnRankTypeTap,thise;this.AddTouchEventdthis.btn6,this.OnRankTypeTap,thise;ccthis.btn1.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRankTypeTap,thise;ccthis.btn2.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRankTypeTap,thise;this.AddTouchEventdthis.closeBtn,de=b{UIManager.HidePaneldPanelTypeConst.PWSInfoe;},thise;}protectedDestroyde{this.DestroyRewardInfode;this.RemoveAllUpdateListde;this.updateList=null;this.currBtn=null;this.btn1.Destroyde;this.btn2.Destroyde;this.btn5.Destroyde;this.btn6.Destroyde;this.list.removeEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;this.scro.removeEventListenerdeui.UIEvent.CHANGE,this.OnChange,thise;this.scro.removeEventListenerdeui.UIEvent.CHANGE_END,this.OnChangeEnd,thise;ccthis.btn1.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRankTypeTap,thise;ccthis.btn2.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRankTypeTap,thise;GlobalEvent.UnSubscribedGlobalEventType.RankAddItem,this.OnAddItem,thise;}cc----------------------------------------------------------------------EditprivateChangeTypedbtn:RankPlayerBtne{ifdthis.currBtn!=nullethis.currBtn.selected=false;this.currBtn=btn;this.currBtn.selected=true;ifdbtn.typea100ethis.RefreshRankInfodbtn.typee;cc排行榜elseifdbtn.type==100ethis.RefreshRewardInfode;cc奖励界面elsethis.RefreshDescInfode;cc说明界面}privateRefreshRankInfodtype:numbere{this.rankGroup.visible=true;this.rewardGroup.visible=false;this.descGroup.visible=false;this.RemoveAllUpdateListde;this.scro.viewport.scrollV=0;letgData=MainDataMgr.GetInstancede.rankDataMgr.GetRankByTypedConst.RankInfoType.FIGHT,typee;ifdgData==nullereturn;letgArray=gData.valuesde;ifdgArray.lengthb0e{fordleti=0,len=gArray.length;ialen;i++e{letitem=newRankPlayerDatItem3de;item.rank=gArray[i].rank;item.rankType=gArray[i].type;item.glolocType=this.currBtn.type;this.updateList.addItemditeme;}this.noneTips.visible=false;this.scro.visible=true;}else{this.noneTips.visible=true;this.scro.visible=false;}}privateboxItemArray:PWSBoxItem[]=[];privateScoreItemArray:CommonItem[]=[];privateDestroyRewardInfode{fordletboxItemofthis.boxItemArraye{boxItem.DestroyAlldtruee;}this.boxItemArray=[];fordletrewardItemofthis.ScoreItemArraye{rewardItem.DestroyAlldtruee;}this.ScoreItemArray=[];}privateRefreshRewardInfode{this.DestroyRewardInfode;this.rankGroup.visible=false;this.rewardGroup.visible=true;this.descGroup.visible=false;letcupCount=MainDataMgr.GetInstancede.cupCount;this.cupCount.text=cupCount.toStringde;letpwsDataMgr=MainDataMgr.GetInstancede.pwsDataMgr;letcount=pwsDataMgr.maxRewardCount;letitemHeight=200;this.bar.width=count*itemHeight;this.bar.y=count*itemHeight;this.bar.minimum=0;this.bar.maximum=100;ifdcupCounta4000ecupCount=4000;cupCount=5000;this.bar.value=dcupCount-4000ec2000*100;letrewardInfoArray=pwsDataMgr.freeRewardInfoArray.reversede;letindex=0;fordletrewardInfoofrewardInfoArraye{cc中间的积分letitemObj=newCommonItemd"PWSCupItemSkin"e;itemObj["label"].text=rewardInfo.minScore.toStringde;itemObj.x=0;itemObj.y=index*itemHeight+100;this.subGroup4.addChildditemObje;this.ScoreItemArray.pushditemObje;cc左边的vip奖励letboxItem=newPWSBoxItemde;boxItem.data=[1,index];boxItem.dataChangedde;this.subGroup3.addChilddboxIteme;this.boxItemArray.pushdboxIteme;index++;}rewardInfoArray=pwsDataMgr.vipRewardInfoArray.reversede;index=0;fordletrewardInfoofrewardInfoArraye{cc右边免费奖励letboxItem=newPWSBoxItemde;boxItem.data=[2,index];boxItem.dataChangedde;this.subGroup2.addChilddboxIteme;this.boxItemArray.pushdboxIteme;index++;}ccfordleti=0;iacount;i++ecc{ccletitemObj=newCommonItemd"PWSCupItemSkin"e;ccitemObj["label"].text=d4000+i*100e.toStringde;ccitemObj.x=0;ccitemObj.y=dcount-ie*itemHeight-100;ccthis.subGroup4.addChildditemObje;cc}cclettaskDataArray=pwsDataMgr.taskDataArray;ccfordlettaskDataoftaskDataArrayecc{ccletboxItem=newPWSBoxItemde;ccboxItem.data=taskData.id;ccboxItem.dataChangedde;ccthis.subGroup2.addChilddboxIteme;ccthis.boxItemArray.pushdboxIteme;cc}ccletrewardIdArray=pwsDataMgr.rewardIdArray;ccfordletrewardIdofrewardIdArrayecc{ccletrewardItem=newPWSRewardItemde;ccrewardItem.data=rewardId;ccrewardItem.dataChangedde;ccthis.subGroup4.addChilddrewardIteme;ccthis.ScoreItemArray.pushdrewardIteme;cc}}privateRefreshDescInfode{this.rankGroup.visible=false;this.rewardGroup.visible=false;this.descGroup.visible=true;this.descLabel.text=LanUtil.GetText2d50001e;}cc----------------------------------------------------------------------EventprivateOnItemTapde:eui.ItemTapEvente{ifde.item!=nulle{SoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;letdata=e.itemasRankPlayerDatItem3;letinfo=dnewPlayerInfoMainPanelDatadee.PackRankPlayerGlobalddata.ranke;UIManager.ShowPaneldPanelTypeConst.PlayerInfoMainPanel,infoe;}}privateOnRankTypeTapde:egret.TouchEvente{SoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;ifdegret.isde.target,"RankPlayerBtn"e==true||egret.isde.target,"eui.Button"e==trueethis.ChangeTypede.targete}privateisChangeEnd:boolean=true;privateOnChangede:eui.UIEvente{ifdthis.scro.viewport.scrollVb=this.list.measuredHeight-this.list.heighte{ifdthis.isChangeEnd==truee{this.isChangeEnd=false;letpRankInfo=MainDataMgr.GetInstancede.rankDataMgr.GetRankInfodConst.RankInfoType.FIGHTe;letgloIndex=pRankInfo.gloCurrIndex;letlocIndex=pRankInfo.localCurrIndex;ifdthis.currBtn.type==Const.RankType.GLOBAL&&gloIndexapRankInfo.maxRankNume{letend=Math.mindgloIndex+pRankInfo.reqSpace,pRankInfo.maxRankNume;ClientNet.NetRank.C2SRankInfodgloIndex,end,1e;}elseifdthis.currBtn.type==Const.RankType.LOCAL&&locIndexapRankInfo.maxRankNume{letend=Math.mindlocIndex+pRankInfo.reqSpace,pRankInfo.maxRankNume;ClientNet.NetRank.C2SRankInfodlocIndex,end,2e;}}}}privateOnChangeEndde:eui.UIEvente{this.isChangeEnd=true;}privateOnAddItemdtype:number,beign:number,end:numbere{letrMap:SMapanumber,RankDataItemb=MainDataMgr.GetInstancede.rankDataMgr.GetRankByTypedConst.RankInfoType.FIGHT,typee;fordleti=beign,len=end;ialen;i++e{ifdthis.updateList.lengthaie{letitem=newRankPlayerDatItem3de;letinfo=rMap.getdie;ifdinfo==nullecontinue;item.rank=info.rank;item.rankType=type;item.glolocType=this.currBtn.type;this.updateList.addItemditeme}else{letitem=this.updateList.getItemAtdbeign-1eifditem!=nullethis.updateList.itemUpdatedditeme;}}this.noneTips.visible=false;this.scro.visible=true;}privateRemoveAllUpdateListde{letitem:RankPlayerDatItem3;fordleti=0,len=this.updateList.length;ialen;i++e{item=this.updateList.getItemAtdie;item.Destroyde;}this.updateList.removeAllde;}}}﻿modulegame{exportclassPWSRewardItemextendsItemRenderBase{publicicon:eui.Image;publicnameLabel:eui.Label;publicitemIcon1:eui.Image;publicitemIcon2:eui.Image;publicitemIcon3:eui.Image;publicitemCount1:eui.Label;publicitemCount2:eui.Label;publicitemCount3:eui.Label;publicconstructorde{superd"PWSRewardItemSkin"e;}privateisCreated:boolean=false;protectedchildrenCreatedde{super.childrenCreatedde;this.isCreated=true;ifdthis.data!=nulle{this.UpdateViewdthis.datae;}};privateUpdateViewddata:anye{ifd!this.isCreatedereturn;letrewardId:number=data;letpwsDataMgr=MainDataMgr.GetInstancede.pwsDataMgr;letrewardData=DataUtil.GetValueByKeyd"common_rewarddata_json",rewardIde;ifdrewardData==nulle{game.errord"DataUtil.GetValueByKeyerror:",rewardIde;}this.nameLabel.text=rewardData["desc"];letitemArray=rewardData["items"];letidx:number=0;fordletinfoofitemArraye{letitemId=info[0];letitemCount=info[1];ifdDataUtil.IsBoxditemIdeethis.InitBoxInfoditemIde;else{leturl=DataUtil.GetItemSourceditemIde;ifdidx==0e{this.itemIcon1.source=RES.getResdurle;this.itemCount1.text=`${itemCount}`;}else{this.itemIcon2.source=RES.getResdurle;this.itemCount2.text=`${itemCount}`;}idx++;}}this.itemCount1.visible=didxb=1ethis.itemIcon1.visible=didxb=1ethis.itemCount2.visible=didxb=2ethis.itemIcon2.visible=didxb=2e}privateInitBoxInfoditemId:numbere{this.itemIcon3.source=DataUtil.GetItemSourceditemIde;letboxData=DataUtil.GetBoxDataditemIde;this.itemCount3.text=`卡牌：${boxData.totalCount}张`;}dataChangedde{this.UpdateViewdthis.datae;}protectedDestroyde{}}}﻿modulegame{exportclassRankPlayerDatItem3{rank:number;rankType:number;glolocType:number;publicDestroyde{}}exportclassRankPlayerItem3extendsItemRenderBase{privaterank:RankNum;privatecups:eui.Button;privatebg:eui.Image;privatepName:eui.Label;privatefamilyName:eui.Label;privatemySel:eui.Image;privatefamilyIcon:FamilyIcon;publicinfo:RankPlayerDatItem3;publicconstructorde{superd"RankPlayerItem3Skin"e;}publicDestroyde{this.info.Destroyde;}publicdataChangedde{this.info=this.data;ifdthis.info==nullereturn;}}}﻿modulegame{exportclassBagCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnBagPanel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,falsee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld0e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿modulegame{exportclassBagPanelextendsUIComponentBase{privatecloseButton:eui.Button;privatelist:eui.List;publicconstructorde{superd"BagPanelSkin"e;}protectedchildrenCreatedde{super.childrenCreatedde;this.closeButton.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnTap,thise;this.InitCBde;}privateInitCBde{letitemDataMgr=MainDataMgr.GetInstancede.itemDataMgr;this.AddPropCBditemDataMgr,"allItemArray",this.RefreshItemCount,thise;}privateRefreshItemCountde{this.DestroyItemde;letitemDataMgr=MainDataMgr.GetInstancede.itemDataMgr;this.list.itemRenderer=GoodsItem;this.list.dataProvider=neweui.ArrayCollectionditemDataMgr.allItemArraye;}privateOnTapde:egret.TouchEvente{ifde.target==this.closeButtone{UIManager.HidePaneldPanelTypeConst.Bage;};}publicDestroyItemde{fordleti=0;iathis.list.numChildren;i++e{letgameCellView=this.list.getChildAtdieasGoodsItem;gameCellView.DestroyAllde;}}protectedDestroyde{this.closeButton.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnTap,thise;this.DestroyItemde;}}}﻿modulegame{exportclassGoodsItemextendsItemRenderBase{privateiconImg:eui.Image;privatecount:eui.Label;privateitemName:eui.Label;publicconstructorde{superd"GoodsItemSkin"e;}dataChangedde{letdata=this.dataasItemDataItem;letdataProxy=JsonData.getGameDatad"itemdata_json"e[data.id];ifddataProxy==nullereturn;this.iconImg.source=game.DataUtil.GetItemSourceddata.ide;this.count.text=`${data.count}`;this.itemName.text=`${dataProxy.name}`;}protectedDestroyde{}}}﻿modulegame{exportclassBoxTipsCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.effectLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnBoxTipsPanel;}cc做一下类型转换方便调用一定要有!!!protectedgetBoxTipsPanelde{returnaBoxTipsPanelbthis.panel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,false,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld0e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}c***初始化面板数据*cpublicInitDatade:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}}}﻿modulegame{exportclassBoxTipsPanelextendsUIComponentBase{publiccloseBtn:SButton;publicnameLabel:eui.Label;privatedescLabel:eui.Label;privatesubGroup:eui.Group;publicitemArray:CommonItem[];publicconstructorde{superd"BoxTipsSkin"e;this.itemArray=[];}protectedchildrenCreatedde:void{super.childrenCreatedde;}publicInitDataddata:anye{this.AddTouchEventdthis.closeBtn,de=b{UIManager.HidePaneldPanelTypeConst.BoxTipse;},thise;letboxId:number=data[0];letboxData=DataUtil.GetBoxDatadboxIde;this.nameLabel.text=boxData.name;this.descLabel.text=boxData.desc;cc金币ifdboxData.gold.lengthb0e{letgoldObj=newCommonItemd"ItemBaseInfoSkin"e;goldObj.SetCreateOverCBdde=b{letobj=goldObj;obj["icon"].source=RES.getResdDataUtil.GetItemSourcedProtocol.PropertyEnum.MONEYee;letcountStr="";ifdboxData.gold.length==2ecountStr=`X${boxData.gold[0]}~${boxData.gold[1]}`;elsecountStr=`X${boxData.gold[0]}`;obj["count"].text=countStr;},goldObje;this.itemArray.pushdgoldObje;this.subGroup.addChilddgoldObje;}cc钻石ifdboxData.diamond.lengthb0e{letdiamondObj=newCommonItemd"ItemBaseInfoSkin"e;diamondObj.SetCreateOverCBdde=b{letobj=diamondObj;obj["icon"].source=RES.getResdDataUtil.GetItemSourcedProtocol.PropertyEnum.DIAMONDee;letcountStr=`X${boxData.diamond[1]}`;obj["count"].text=countStr;},diamondObje;this.itemArray.pushddiamondObje;this.subGroup.addChildddiamondObje;}cc卡牌ifdboxData.totalCountb0e{letcardObj=newCommonItemd"ItemBaseInfoSkin"e;cardObj.SetCreateOverCBdde=b{letobj=cardObj;obj["icon"].source=RES.getResdDataUtil.GetItemSourced99ee;letcountStr=`X${boxData.totalCount}`;ifdboxData.count1.lengthb0ecountStr+=`\n最少1张传奇卡`;ifdboxData.count2.lengthb0ecountStr+=`\n最少1张史诗卡`;ifdboxData.count3.lengthb0ecountStr+=`\n最少${boxData.count3[0]}张稀有卡`;obj["count"].text=countStr;},cardObje;this.itemArray.pushdcardObje;this.subGroup.addChilddcardObje;}}protectedDestroyde{fordletitemObjofthis.itemArraye{itemObj.DestroyAllde;}this.itemArray=[];}}}﻿modulegame{exportclassCMDDlgextendsUIComponentBase{publicokBtn:SButton;publiccancelBtn:SButton;publiccloseBtn:SButton;publicfightBtn:SButton;publicreplayBtn:SButton;publictitle:eui.Label;publicdesc:SInputLabel;privatebtn1:SButton;privatebtn2:SButton;privatebtn3:SButton;privatebtn4:SButton;privatebtn5:SButton;privatebtn6:SButton;privatelist:eui.List;privateupdateList:eui.ArrayCollection;publicconstructorde{superd"CMDDlgSkin"e;}publicInitDataddata:anye{super.InitDataddatae;this.updateList=neweui.ArrayCollectionde;this.list.itemRenderer=CMDDItem1;this.list.dataProvider=this.updateList;lethMgr=MainDataMgr.GetInstancede.heroDataMgr;fordletheroInfoofhMgr.herosMap.valuesdee{this.updateList.addItemdheroInfo.ide}this.list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;this.okBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnOKClick,thise;this.cancelBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCancelClick,thise;this.fightBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnFightClick,thise;this.replayBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnReplayClick,thise;this.closeBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseClick,thise;this.AddTouchEventdthis.btn1,this.OnBtnTap,thise;this.AddTouchEventdthis.btn2,this.OnBtnTap,thise;this.AddTouchEventdthis.btn3,this.OnBtnTap,thise;this.AddTouchEventdthis.btn4,this.OnBtnTap,thise;this.AddTouchEventdthis.btn5,this.OnBtnTap,thise;this.AddTouchEventdthis.btn6,this.OnBtnTap,thise;this.desc.SetDefaultTextd"请输入指令..."e;}privateOnOKClickde{lettext=this.desc.text;ifdtext.substringd0,1e=="$"e{ifdtext.indexOfd"$allhero"eb-1ecc添加所有英雄{letcount=Numberdtext.substringd8ee;ifdisNaNdcounte||counta0ecount=100;letheroKeys=MainDataMgr.GetInstancede.heroDataMgr.herosMap.keysde;fordletheroIdofheroKeyse{ifdECS.LogicWarUtil.IsCarddheroIdeeClientNet.NetChat.C2SGMCommandd`hero,${heroId},${count}`e;}}elseifdtext=="$loadall"e{this.LoadAllResde;}elseifdtext.indexOfd"$hero_"eb-1e{letheroId=text.splitd"_"e[1];letpriority=text.splitd"_"e[2];this.LoadOneResdNumberdheroIde,Numberdpriorityee;}}elseClientNet.NetChat.C2SGMCommanddthis.desc.texte;ccletlabel=newegret.TextFieldde;cclabel.text="nihao"+Math.randomde;cclabel.x=0;cclabel.y=this.lableList.length*30;ccthis.addChilddlabele;ccthis.lableList.pushdlabele;ccUIManager.HidePaneldPanelTypeConst.CMDDlge;}cc单机战斗测试privateOnFightClickde{GameData.IsSelfAI=true;GameData.LocalTest=true;GameData.IsOtherAI=true;cc敌方AI是否自动出兵GameData.DamageAdddition=0.0001;cc伤害倍数加成d2表示所有伤害加倍0.1表示所有伤害减少90%eGameData.KingHPAddtion=1;GameData.TestFight=false;GameData.DevelopMode=DevelopMode.Publish;GameData.DevelopMode=DevelopMode.Debug;GameData.EditorMode=false;GameData.ReplayMode=false;GameData.SpeedUpMode=true;ECSC.CNetWar.TransferClassStaticDatad"GameData",GameDatae;ClientNet.NetMatch.C2SBeginMatchdPVPType.VS_1_1e;ccClientNet.NetMatch.C2SBeginMatchdPVPType.VS_2_2e;}cc回放privateOnReplayClickde{ccGameData.IsSelfAI=false;ccGameData.LocalTest=true;ccGameData.IsOtherAI=false;cc敌方AI是否自动出兵ccGameData.DamageAdddition=1;cc伤害倍数加成d2表示所有伤害加倍0.1表示所有伤害减少90%eccGameData.KingHPAddtion=1;ccGameData.DevelopMode=DevelopMode.Publish;ccGameData.DevelopMode=DevelopMode.Debug;ccGameData.EditorMode=false;ccGameData.ReplayMode=false;ccGameData.SpeedUpMode=false;ccECS.ReplayManager.GetInstancede.BeginReplayde;ECSC.CNetWar.InstanceFuncd"ECS","ReplayManager","BeginReplay"e;}privateLoadAllResde{game.logd"--------LoadAllRes------"e;letheroIdArray=game.MainDataMgr.GetInstancede.heroDataMgr.herosMap.keysde;letresDataMap:SMapastring,IAutoGroupResDatab=newSMapastring,IAutoGroupResDatabde;letfileDataMap:SMapastring,numberb=newSMapastring,numberbde;letheroIDSet:Setanumberb=newSetanumberbde;fordletheroIdofheroIdArraye{RenderUtils.GetHeroGroupsdresDataMap,fileDataMap,heroIDSet,heroIde;}heroIDSet.clearde;letresDataArray=resDataMap.valuesde;resDataMap.clearde;fileDataMap.clearde;letrets=ResUtils.GetInstancede.LoadResArrayWithProdresDataArray,de=b{game.logd"---------所有资源加载完成"e;},devent:RES.ResourceEvente=b{},this,0e;}privateLoadOneResdheroId:number,priority:numbere{game.logd"--------LoadOneRes------",heroId,prioritye;letheroIdArray=game.MainDataMgr.GetInstancede.heroDataMgr.herosMap.keysde;letresDataMap:SMapastring,IAutoGroupResDatab=newSMapastring,IAutoGroupResDatabde;letfileDataMap:SMapastring,numberb=newSMapastring,numberbde;letheroIDSet:Setanumberb=newSetanumberbde;RenderUtils.GetHeroGroupsdresDataMap,fileDataMap,heroIDSet,heroIde;heroIDSet.clearde;letresDataArray=resDataMap.valuesde;resDataMap.clearde;fileDataMap.clearde;letrets=ResUtils.GetInstancede.LoadResArrayWithProdresDataArray,de=b{game.logd"---------单个源加载完成"e;},devent:RES.ResourceEvente=b{},this,prioritye;}ccprivatelableList:egret.TextField[]=[];privateOnCancelClickde{UIManager.HidePaneldPanelTypeConst.CMDDlge;}privateOnCloseClickde{UIManager.HidePaneldPanelTypeConst.CMDDlge;}protectedDestroyde{this.okBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnOKClick,thise;this.cancelBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCancelClick,thise;this.fightBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnFightClick,thise;this.replayBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnReplayClick,thise;this.closeBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseClick,thise;this.list.removeEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;}protectedchildrenCreatedde:void{super.childrenCreatedde;}privateOnBtnTapde:egret.TouchEvente{letmMgr=MainDataMgr.GetInstancede;switchde.targete{casethis.btn1:letexp=mMgr.exp+1000;ClientNet.NetChat.C2SGMCommandd`prop,1,${exp}`e;break;casethis.btn2:letgold=mMgr.gold+1000;ClientNet.NetChat.C2SGMCommandd`prop,2,${gold}`e;break;casethis.btn3:letdiamand=mMgr.diamand+1000;ClientNet.NetChat.C2SGMCommandd`prop,3,${diamand}`e;break;casethis.btn4:letcups=mMgr.cupCount+100;ClientNet.NetChat.C2SGMCommandd`prop,4,${cups}`e;break;casethis.btn5:letlv=mMgr.level+1ClientNet.NetChat.C2SGMCommandd`prop,5,${lv}`e;break;casethis.btn6:ClientNet.NetChat.C2SGMCommandd`prop,1,9999`e;ClientNet.NetChat.C2SGMCommandd`prop,2,9999`e;ClientNet.NetChat.C2SGMCommandd`prop,3,9999`e;ClientNet.NetChat.C2SGMCommandd`prop,4,9999`e;ClientNet.NetChat.C2SGMCommandd`prop,5,9`e;break;}}privateheroList=[];privateOnItemTapde:eui.ItemTapEvente{letheroId:number=e.item;letindex=this.heroList.indexOfdheroIde;ifdindexa0e{this.heroList.pushdheroIde;de.itemRendererasCMDDItem1e.ch.selected=true;}else{this.heroList.splicedindex,1e;de.itemRendererasCMDDItem1e.ch.selected=false;}game.MainDataMgr.GetInstancede.testDataMgr.UpdateHeroIdArraydthis.heroListe;console.logdthis.heroListe}}}modulegame{exportclassCMDDItem1extendsItemRenderBase{ch:eui.CheckBoxpublicconstructorde{superd"CMDDItem1Skin"e;this.touchChildren=false;}Destroyde{}dataChangedde{lethMgr=MainDataMgr.GetInstancede.heroDataMgr;letheroInfo=hMgr.GetHerodthis.datae;this.ch.label=`${heroInfo.id},${heroInfo.name}`}}}﻿modulegame{exportclassCMDDlgCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.effectLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnCMDDlg;}cc做一下类型转换方便调用一定要有!!!protectedgetcmdDlgPanelde{returnaCMDDlgbthis.panel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,false,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld0e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}c***初始化面板数据*cpublicInitDatade:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}}}﻿modulegame{exportclassCommonDlgData{publicleftText:string;publicleftFunc:Function;publicleftIcon:string;publicleftTextColor:number;publicrightText:string;publicrightFunc:Function;publicrightIcon:string;publicrightTextColor:number;publiccloseFunc:Function;publiccloseIcon:string;publiccontent:string;publicthisObj:any;publictitleText:string;publicconstructorde{}publicDestroyde{this.leftFunc=null;this.rightFunc=null;this.closeFunc=null;this.thisObj=null;this.leftIcon=this.rightIcon=this.closeIcon=null;this.content=null;}cce事件publicexecOKde:any,...parame:void{ifdthis.thisObj!=null&&this.leftFunce{this.leftFunc.calldthis.thisObj,e,parame;}}publicexecCancelde:any,...parame:void{ifdthis.thisObj!=null&&this.rightFunce{this.rightFunc.calldthis.thisObj,e,parame;}}publicexecClosede:any,...parame:void{ifdthis.thisObj!=null&&this.closeFunce{this.closeFunc.calldthis.thisObj,e,parame;}}}exportclassCommonDlgextendsUIComponentBase{publicleftBtn:SButton;publicrightBtn:SButton;privatecomWin:CommonWin;privatecontent:eui.Label;privatedata:CommonDlgData;publicconstructorde{superd"CommonDlgSkin"e;}protectedchildrenCreatedde:void{super.childrenCreatedde;}protectedDestroyde{ifdthis.leftBtn.hasEventListenerdegret.TouchEvent.TOUCH_TAPeethis.leftBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnOKClick,thise;ifdthis.rightBtn.hasEventListenerdegret.TouchEvent.TOUCH_TAPeethis.rightBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCancelClick,thise;this.data.Destroyde;this.comWin.Destroyde;}publicInitDataddata:CommonDlgDatae{this.data=data;this.InitOkAndCancelInfode;this.comWin.currentState="common";this.comWin.validateNowde;this.comWin.Initddata.titleText,this.OnCloseClick,thise;this.content.textFlow=newegret.HtmlTextParserde.parserddata.contente}privateInitOkAndCancelInfode{letdata=this.dataifddata.thisObj!=nulle{ifddata.leftFunc!=null&&data.rightFunc!=nullecc二者都有{this.leftBtn.horizontalCenter=-120;this.SetLeftUIde;this.leftBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnOKClick,thise;this.rightBtn.horizontalCenter=120;this.SetRightUIde;this.rightBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCancelClick,thise;}else{this.leftBtn.horizontalCenter=this.rightBtn.horizontalCenter=0;ifddata.leftFunc!=nulle{this.leftBtn.visible=true;this.SetLeftUIde;this.leftBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnOKClick,thise;}else{this.leftBtn.visible=false;}ifddata.rightFunc!=nulle{this.rightBtn.visible=true;this.SetRightUIde;this.rightBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnOKClick,thise;}else{this.rightBtn.visible=false;}}}else{this.rightBtn.visible=this.leftBtn.visible=false;}}privateSetRightUIde{letdata=this.data;data.rightText!=null&&dthis.rightBtn.label=data.rightTexte;dthis.data.rightIcon!=nulle&&dthis.rightBtn.icon=this.data.rightIcone;data.rightTextColor!=null&&this.rightBtn.SetLabelColorddata.rightTextColore;}privateSetLeftUIde{letdata=this.data;data.leftText!=null&&dthis.leftBtn.label=data.leftTexte;dthis.data.leftIcon!=nulle&&dthis.leftBtn.icon=this.data.leftIcone;data.leftTextColor!=null&&this.leftBtn.SetLabelColorddata.leftTextColore;}privateOnOKClickde:egret.TouchEvente{ifdthis.data!=nulle{this.data.execOKdee;}UIManager.HidePaneldPanelTypeConst.CommonDlge;}privateOnCancelClickde:egret.TouchEvente{ifdthis.data!=nulle{this.data.execCanceldee;}UIManager.HidePaneldPanelTypeConst.CommonDlge;}privateOnCloseClickde:egret.TouchEvente{ifdthis.data!=nulle{this.data.execClosedee;}UIManager.HidePaneldPanelTypeConst.CommonDlge;}}}﻿modulegame{exportclassCommonDlgCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.effectLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnCommonDlg;}cc做一下类型转换方便调用一定要有!!!protectedgetcommonDlgPanelde{returnaCommonDlgbthis.panel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,false,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld0e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}c***初始化面板数据*cpublicInitDatade:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}}}﻿c****cmodulegame{exportclassCommonPlayerInfoextendsUIComponentBase{publicroot:eui.Group;publicplayerIcon:eui.Image;publicedgeIcon:eui.Image;publicplayerName:eui.Label;publicfamilyName:eui.Label;publicprogressBar:eui.ProgressBar;publicnameInfo:eui.Group;publicnoIcon:eui.Group;publiciconInfo:eui.Group;publiceffectObj:ECSC.EffectBase;publicenemyType:number;cc0：己方1：敌方privatetimerKey:number;privatepercent:number;publicfightRoleId:number;publicoriginX:number;publicoriginY:number;publicconstructordenemyType:numbere{ifdenemyType==0ecc己方superd"MyPlayerInfoSkin2"e;elsecc敌方superd"TargetPlayerInfoSkin2"e;this.enemyType=enemyType;this.timerKey=null;this.percent=0;this.fightRoleId=0;}protectedchildrenCreatedde{super.childrenCreatedde;this.progressBar.labelFunction=dvalue:number,maxValue:numbere=b{letpercent=Math.floordvaluee;return`${percent}%`};}privateDestroyEffectde{ifdthis.effectObj!=nulle{ifdSceneManager.GetInstancede.IsInHomedeeRenderUtils.DestroyEffectdSceneTypeConst.Home,this.effectObje;elseRenderUtils.DestroyEffectdSceneTypeConst.War,this.effectObje;this.effectObj=null;}}privateCreateEffectdeffectID:numbere{this.DestroyEffectde;ifdSceneManager.GetInstancede.IsInHomedeethis.effectObj=RenderUtils.CreateEffectdSceneTypeConst.Home,effectID,1.2,-1e;elsethis.effectObj=RenderUtils.CreateEffectdSceneTypeConst.War,effectID,1.2,-1e;ifdeffectID==2001e{this.effectObj.x=120;this.effectObj.y=70;}else{this.effectObj.x=300;this.effectObj.y=70;}cc敌方2035this.root.addChilddthis.effectObje;}privateRefreshPercentInfode{this.progressBar.minimum=0;this.progressBar.maximum=100;this.progressBar.value=this.percent;}privateDestroyTimerKeyde{ifdthis.timerKey!=nulle{TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=null;}}privateAutoIncreaPercentde{this.DestroyTimerKeyde;ifdthis.percenta=0||this.percentb=100e{this.RefreshPercentInfode;return;}this.timerKey=TimerMgr.GetInstancede.AddTimerd100,de=b{ifdthis.percenta30ethis.percent+=5;elseifdthis.percenta50ethis.percent+=4;elseifdthis.percenta80ethis.percent+=3;elseifdthis.percenta90ethis.percent+=2;elsethis.percent+=1;this.percent=Math.floordthis.percente;this.RefreshPercentInfode;ccgame.logdthis.percent,"------AutoIncreaPercent----bbbbbbbbbbbbbbbbb",this.fightRoleIde;ifdthis.percentb=99ereturnfalse;returntrue;}e;}publicSetDataddata:anye{ifd!this.isCreateOvere{this.SetCreateOverCBdde=b{this.SetDataddatae;},thise;return;}ifddata[1]==1ecc匹配中{ifdthis.enemyType==0ethis.CreateEffectd2001e;elsethis.CreateEffectd2002e;this.progressBar.visible=false;this.nameInfo.visible=false;this.iconInfo.visible=false;this.noIcon.visible=true;}ccelseifddata[1]==2ecc搜索中cc{ccthis.CreateEffectd2001e;ccthis.playerName.visible=false;ccthis.familyName.visible=false;ccifddata[0]==0ecc己方ccthis.playerIcon.source=RES.getResd`common_ui_loading_json.bg_phb_heroicon_xz_blue`e;ccelseccthis.playerIcon.source=RES.getResd`common_ui_loading_json.bg_phb_heroicon_xz_red`e;ccthis.playerIcon.x=0;ccthis.playerIcon.y=10;cc}ccelseifddata[1]==3ecc未开始搜索cc{ccthis.DestroyEffectde;ccthis.playerName.visible=false;ccthis.familyName.visible=false;ccifddata[0]==0ecc己方ccthis.playerIcon.source=RES.getResd`common_ui_loading_json.bg_phb_heroicon_xz_blue`e;ccelseccthis.playerIcon.source=RES.getResd`common_ui_loading_json.bg_phb_heroicon_xz_red`e;ccthis.playerIcon.x=0;ccthis.playerIcon.y=10;cc}elsecc已经搜索到4{this.DestroyEffectde;this.nameInfo.visible=true;this.iconInfo.visible=true;this.progressBar.visible=true;this.noIcon.visible=false;}this.playerName.text=data[2];this.familyName.text=data[3];this.percent=data[4];this.AutoIncreaPercentde;}publicSetWarOverDataddatae{this.DestroyTimerKeyde;this.DestroyEffectde;this.nameInfo.visible=true;this.iconInfo.visible=true;this.progressBar.visible=false;this.noIcon.visible=false;this.playerName.text=data[1];this.familyName.text=data[2];this.playerIcon.source=DataUtil.GetPlayerIconSourceddata[3]e;this.edgeIcon.source=DataUtil.GetEdgeIconSourceddata[4]e;this.playerIcon.x=22;this.playerIcon.y=27}publicSetWarUIDataddatae{this.SetWarOverDataddatae;}publicSetProgressBarShowdshow:booleane{ifd!this.isCreateOvere{this.SetCreateOverCBdde=b{this.progressBar.visible=show;},thise;return;}this.progressBar.visible=show;}protectedDestroyde{this.DestroyEffectde;}}}﻿modulegame{exportclassDialogOnlyLabelextendseui.Component{privatecontent:eui.Label;publicconstructorde{superde;this.skinName="DialogOnlyLabelSkin";}publicInitde{}publicDestroyde{}cc----------------------------------------------------------------------apipublicPackTextdc:anye{this.content.text=c;}publicPackHtmlTextdc:anye{this.content.textFlow=c;}}}﻿modulegame{exportclassDialogRefreshRWextendseui.Component{privateiconText:IconText;privatetips:eui.Label;publicconstructorde{superde;this.skinName="DialogRefreshRWSkin";}publicInitde{}publicDestroyde{}cc----------------------------------------------------------------------apipublicUpdateCostddata:IconTextDatae{this.iconText.Initddatae;}publicUpdateTipsdtext:string,textColor:number=nulle{ifdtextColor!=nullethis.tips.textColor=textColor;this.tips.text=text;}}}modulegame{exportclassHeroInfoPanelDataextendsDataBase{publicheroId:number;publiclevel:number;cc下面这些属性是当需要展示经验条和升级按钮的情况下才会用到publicshowExpAndUpgradeBtn:boolean=false;publicupCost:number;publicupCostGold:number;publicexp:number;publicexpId:number;publicupGradeBtnInfo:HeroInfoUpgradeBtnData;publicDestroyde{}c***我的卡牌*cpublicPackPlayerDatadheroId:numbere{this.heroId=heroId;this.showExpAndUpgradeBtn=true;letheroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetHerodheroIde;ifdheroInfo==nullereturnthis;let_thatt=this;functionaaade{letheroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetHerodheroIde;_thatt.upCost=heroInfo.GetUpCostCardde;_thatt.exp=heroInfo.exp;_thatt.upCostGold=heroInfo.GetUpCostGoldde;ifd_thatt.upGradeBtnInfo!=nulle_thatt.upGradeBtnInfo.Destroyde;_thatt.upGradeBtnInfo=dnewHeroInfoUpgradeBtnDatae.PackMyHeroDatadheroIde;_thatt.SetAttrd"level",heroInfo.lve;}_thatt.expId=heroInfo.AddAttrListenerd"lv",aaa,_thatte;_thatt.expId=heroInfo.AddAttrListenerd"exp",aaa,_thatte;returnthis;}c***我的家族成员的数据d当在我的家族中查看我的数据时，也是从这里获取数据e*cpublicPackMyFamilydplayerId:number,heroId:numbere{this.heroId=heroId;this.showExpAndUpgradeBtn=false;letplayerInfo:MemberDataItem=MainDataMgr.GetInstancede.familyDataMgr.myFamily.allMemberMap.getdplayerIde;ifdplayerInfo==nullereturnthis;letheroInfo=playerInfo.GetHerodheroIde;ifdheroInfo==nullereturnthis;this.level=heroInfo.level;returnthis;}c***排行榜-玩家-全球*cpublicPackRankPlayerGlobaldrank:number,heroId:numbere{this.heroId=heroId;this.showExpAndUpgradeBtn=false;letplayerInfo:RankDataItem=MainDataMgr.GetInstancede.rankDataMgr.playerRankData.gloRankMap.getdranke;ifdplayerInfo==nullereturnthis;letheroInfo=playerInfo.GetHerodheroIde;ifdheroInfo==nullereturnthis;this.level=heroInfo.level;returnthis;}c***排行榜-玩家-本地*cpublicPackRankPlayerLocaldrank:number,heroId:numbere{this.heroId=heroId;this.showExpAndUpgradeBtn=false;letplayerInfo:RankDataItem=MainDataMgr.GetInstancede.rankDataMgr.playerRankData.locRankMap.getdranke;ifdplayerInfo==nullereturnthis;letheroInfo=playerInfo.GetHerodheroIde;ifdheroInfo==nullereturnthis;this.level=heroInfo.level;returnthis;}publicPackRankDatade{returnthis;}}exportclassHeroInfoPanelextendsUIComponentBase{privateprogExp:ProgressExp;privatetitle:eui.Label;privateheroInfo:HeroKa;privateupgradeBtn:HeroInfoUpgradeBtn;privatecamp:eui.Button;privatequality:eui.Label;privatedesc:eui.Label;privateattrGroup:eui.Group;privateattrTips:AttrTipsItem;privatetipGroup:eui.Group;privateaddExp:eui.BitmapLabel;publicinfo:HeroInfoPanelData;publicconstructorde{superd"HeroInfoPanel2Skin",truee;this.cacheAsBitmap=true;cc常规情况下是一个静态页面}cc----------------------------------------------------------------------EditpublicInitDataddata:HeroInfoPanelDatae{ifddata==nullereturn;this.info=data;letheroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetCfgdthis.info.heroIde;ifdheroInfo==nullereturn;this.title.text=`${heroInfo.name}`;this.quality.text=`${Const.QualityName[`Q${heroInfo.quality}`]}`;this.quality.textColor=this.title.textColor=Const.QualityColor[`Q${heroInfo.quality}`];this.desc.text=heroInfo.desc;ifdheroInfo.camp!=0e{this.camp.currentState="hasCamp";this.camp.validateNowde;this.camp.label=Const.CampName[`CAMP_${heroInfo.camp}`];this.camp.icon=`home_ui_kz_json.icon_sl_0${heroInfo.camp}_s`;}else{this.camp.currentState="noCamp";this.camp.validateNowde;};this.RemoveAllCBde;ifdthis.info.showExpAndUpgradeBtn==truee{this.progExp.visible=true;this.upgradeBtn.visible=true;this.tipGroup.visible=true;}else{this.progExp.visible=false;this.upgradeBtn.visible=false;this.tipGroup.visible=false;}this.AddPropCBdthis.info,"level",this.UpdateExpe;this.upgradeBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnUpgradeTap,thise;GlobalEvent.SubscribedGlobalEventType.ShowAttrTips,this.OnSHowAttrTips,thise;GlobalEvent.SubscribedGlobalEventType.HideAttrTips,this.OnHideAttrTips,thise;}publicDestroyde{ifdthis.info!=nullethis.info.Destroyde;GlobalEvent.UnSubscribedGlobalEventType.ShowAttrTips,this.OnSHowAttrTips,thise;GlobalEvent.UnSubscribedGlobalEventType.HideAttrTips,this.OnHideAttrTips,thise;this.upgradeBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnUpgradeTap,thise;}privateUpdateExpde{letupCost=this.info.upCost;letexp=this.info.exp;this.progExp.SetSataQuickdupCost,expe;this.RemoveAllAttrde;this.UpdateAttrGroupde;letheroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetHerodthis.info.heroIde;letmaxLv=heroInfo.GetHeroMaxLevelde;letmyGold=MainDataMgr.GetInstancede.gold;ifdthis.info.levelamaxLv&&this.info.levelb0e{ifdmyGoldb=this.info.upCostGold&&expb=upCoste{this.upgradeBtn.currentState="canUpgrade";this.upgradeBtn.validateNowde;}else{this.upgradeBtn.currentState="cannotUpgrade";this.upgradeBtn.validateNowde;}this.addExp.text=`+${heroInfo.upExp}`;}else{this.upgradeBtn.visible=false;this.tipGroup.visible=false;}this.upgradeBtn.Destroyde;this.upgradeBtn.InitDatadthis.info.upGradeBtnInfoe;this.heroInfo.DestroyAllde;letkaInfo=dnewHeroKaDatae.PackDatadthis.info.heroId,this.info.levele;this.heroInfo.data=kaInfo;}privateUpdateAttrGroupde{this.RemoveAllAttrde;letlv=Math.maxdthis.info.level-1,0e;letheroCfg=MainDataMgr.GetInstancede.heroDataMgr.GetCfgdthis.info.heroIde[lv];ifdheroCfg==null||heroCfg.showattr==nullereturn;fordletshowattrofheroCfg.showattre{letattrItem=newAttrInfoItemde;attrItem.id=this.info.heroId;attrItem.data=showattr;cc[type,value];this.attrGroup.addChilddattrIteme;}}privateRemoveAllAttrde{letattrItem:AttrInfoItem;whiledthis.attrGroup.numChildrenb0e{attrItem=this.attrGroup.removeChildAtd0easAttrInfoItem;attrItem.Destroyde;attrItem=null;}}privateOnSHowAttrTipsdheroId:number,lv:number,stageX,stageYe{this.attrTips.visible=true;letheroLv=MainDataMgr.GetInstancede.heroDataMgr.GetHerodthis.info.heroIde.lv;this.attrTips.data=[heroId,lv,stageX,stageY,heroLv];}privateOnUpgradeTapde:egret.TouchEvente{letexp=this.info.exp;letupCost=this.info.upCost;ifdexpaupCostereturnTipsManager.ShowTipsdLanUtil.GetTextd`卡牌数量不足`ee;letgold=MainDataMgr.GetInstancede.gold;letupCostGold=this.info.upCostGold;ifdgoldaupCostGoldereturnTipsManager.ShowTipsdLanUtil.GetTextd`金币数量不足`ee;ClientNet.NetHero.C2SUpgradeHerodthis.info.heroIde;}privateOnHideAttrTipsde{this.attrTips.visible=false;}}}﻿modulegame{exportclassHeroInfoPanelCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnHeroInfoPanel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,false,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿c***角色信息*cmodulegame{exportclassKingSkillIconextendsUIComponentBase{publiccontainer:SGroup;publicbg:eui.Image;publicicon:eui.Image;privateonSelectFunc:Function;privatethisObj:any;privateargs:any;publicconstructordargs:anye{superd"KingSkillIconSkin"e;this.args=args;}protectedDestroyde{this.container.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnClicked,thise;this.onSelectFunc=null;this.thisObj=null;this.args=null;}protectedchildrenCreatedde:void{super.childrenCreatedde;this.icon.source=RES.getResdthis.args[0]e;this.x=this.args[1];this.y=this.args[2];this.onSelectFunc=this.args[3];this.thisObj=this.args[4];this.container.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnClicked,thise;}publicOnClickedde{}}}modulegame{exportclassPlayerInfoMainPanelData{publicplayerInfo:PlayerInfoPanelData;publicDestroyde{}c***组装排行榜玩家全球数据*cpublicPackRankPlayerGlobaldrank:numbere{this.playerInfo=dnewPlayerInfoPanelDatae.PackRankMemberdranke;returnthis;}c***组装排行榜玩家本地数据*cpublicPackRankPlayerLocaldrank:numbere{this.playerInfo=dnewPlayerInfoPanelDatae.PackRankLocalDatadranke;returnthis;}c***家族-成员*cpublicPackMyFamilyMemberdplayerId:numbere{this.playerInfo=dnewPlayerInfoPanelDatae.PackMyFamilyMemberDatadplayerIde;returnthis;}}exportclassPlayerInfoMainPanelextendsUIComponentBase{privateinfoBtn:TabItem1;privatemainBg:MainPanelBg;publicinfo:PlayerInfoMainPanelData;publicconstructorde{superd"PlayerInfoMainPanelSkin"e;}publicDestroyde{this.mainBg.Destroyde;}publicInitDataddata:PlayerInfoMainPanelDatae{ifddata==nullereturn;this.info=data;letinfo=dnewMainPanelBgDatadee.PackData1d"button_return_grzl",this.OnCloseTap,thise;this.mainBg.Initdinfoe;lettab1Info=dnewMainPanelBgTabDatadee.PackDatad1,TabItem1,PlayerInfoPanel,this.info.playerInfoe;this.infoBtn=this.mainBg.AddTabdtab1InfoeasTabItem1;this.infoBtn.Initd"button_jd_lz_0","button_jd_lz"e;this.mainBg.SetTabIndexd1e;}privateOnCloseTapde:egret.TouchEvente{UIManager.HidePaneldPanelTypeConst.PlayerInfoMainPanele;}}}modulegame{exportclassPlayerInfoMainPanelCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnPlayerInfoMainPanel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,true,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}modulegame{exportinterfacePlayerInfoPanelDataCfg{showEditBtn?:boolean}exportclassPlayerInfoHeroData{heroId:number;level:number;}exportclassPlayerInfoPanelDataextendsDataBase{publicplayerId:number;publicplayerName:string;publicplayerNameName="playerName";publicsex:number;publiccups:number;publiccalssLv:number;publiclevel:number;publicfamilyId:string;publicfamilyName:string="无家族"publiclocalName:string;publicherosArray:PlayerInfoHeroData[]=[];publicavaCost:string;publicshowEditBtn:boolean=true;publicrank:number;cc当数据为排行榜时才用到publictype:number;cc数据源类型publicMyFamily=1;publicRankPlayerGlobal=2;publicRankPlayerLocal=3;publicDestroyde{}c***家族-成员*cpublicPackMyFamilyMemberDatadplayerId:numbere:PlayerInfoPanelData{letmyFamily=MainDataMgr.GetInstancede.familyDataMgr.myFamily;letplayerInfo=myFamily.allMemberMap.getdplayerIde;ifdplayerInfo==nullereturnnull;this.PackFamilyMemberDatadplayerInfo,myFamily.id,myFamily.namee;this.showEditBtn=false;this.type=this.MyFamily;returnthis;}c***组装玩家排行榜的全球数据*cpublicPackRankMemberdrank:numbere:PlayerInfoPanelData{letplayerInfo=MainDataMgr.GetInstancede.rankDataMgr.playerRankData.gloRankMap.getdranke;ifdplayerInfo==nullereturnnull;this.PackRankDatadplayerInfoe;this.type=this.RankPlayerGlobal;this.rank=rank;returnthis;}c***组装玩家排行榜的本地数据*cpublicPackRankLocalDatadrank:numbere{letplayerInfo=MainDataMgr.GetInstancede.rankDataMgr.playerRankData.locRankMap.getdranke;ifdplayerInfo==nullereturnnull;this.PackRankDatadplayerInfoe;this.type=this.RankPlayerLocal;this.rank=rank;returnthis;}c***根据type创建不同的infod点开界面英雄卡牌时用e*cpublicPackHeroInfodheroId:numbere{letinfo:HeroInfoPanelData;ifdthis.type==this.MyFamilyeinfo=dnewHeroInfoPanelDatae.PackMyFamilydthis.playerId,heroIde;ifdthis.type==this.RankPlayerGlobaleinfo=dnewHeroInfoPanelDatae.PackRankPlayerGlobaldthis.rank,heroIde;ifdthis.type==this.RankPlayerLocaleinfo=dnewHeroInfoPanelDatae.PackRankPlayerLocaldthis.rank,heroIde;returninfo;}privatePackRankDatadplayerInfo:RankDataIteme{this.playerId=playerInfo.playerId;this.calssLv=playerInfo.classLv;this.cups=playerInfo.cups;this.familyId=playerInfo.familyId;this.familyName=playerInfo.familyName;this.level=playerInfo.lv;this.localName=MainDataMgr.GetInstancede.GetLocalNamedplayerInfo.locale;this.playerName=playerInfo.playerName;this.sex=playerInfo.sex;this.herosArray=[];letitem:PlayerInfoHeroData;fordletheroofplayerInfo.teame{item=newPlayerInfoHeroDatade;item.heroId=hero.heroId;item.level=hero.level;this.herosArray.pushditeme;}this.showEditBtn=false;this.avaCost=this.CalcAvgCostde;}privatePackFamilyMemberDatadplayerInfo:MemberDataItem,familyId:string,familyName:stringe{this.playerId=playerInfo.id;this.calssLv=playerInfo.classLv;this.cups=playerInfo.cups;this.familyId=familyId;this.familyName=familyName;this.level=playerInfo.level;this.localName=MainDataMgr.GetInstancede.GetLocalNamedplayerInfo.locale;this.playerName=playerInfo.name;this.sex=playerInfo.sex;this.showEditBtn=false;this.avaCost=this.CalcAvgCostde;}privateCalcAvgCostde:string{letheroArray=this.herosArray;letheroInfo:CardDataItem,heroId:number,totalCost:number=0,avgCost:string="",len:number=heroArray.length;ifdlena=0ereturn"0";fordleti=0;ialen;i++e{heroId=heroArray[i].heroId;heroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetHerodheroIde;totalCost+=heroInfo.cost;}avgCost=dtotalCostclene.toFixedd1e;returnavgCost.replaced".","#"e;}}cc----------------------------------------------------------------------ViewexportclassPlayerInfoPanelextendsUIComponentBase{privateheadIcon:HeadIcon;privateuserName:eui.Label;privatecodeNum:eui.Label;privatelevelLb:eui.Label;privatefamilyName:eui.Label;privatelocalName:eui.Label;privatecupsLb:eui.Label;privatestepLb:eui.Label;privateaverageCost:eui.BitmapLabel;privateheroGroup:eui.Group;privatesex:eui.Image;privateeditNameBtn:SButton;publicinfo:PlayerInfoPanelData;publicconstructorde{superd"PlayerInfoPanelSkin"e;}publicInitDataddata:PlayerInfoPanelDatae{ifddata==nullereturnthis.info=data;this.levelLb.text=`${data.level}`;this.cupsLb.text=`${data.cups}`;this.stepLb.text=`${data.calssLv}`;this.localName.text=`${data.localName}`;this.familyName.text=`${data.familyName}`;this.averageCost.text=data.avaCost;this.AddPropCBdthis.info,this.info.playerNameName,this.RefreshNamee;letherosArray:PlayerInfoHeroData[]=data.herosArray;letchild:HeroKa;letheroInfo:HeroKaData;fordleti=0,len=this.heroGroup.numChildren;ialen;i++e{child=this.heroGroup.getChildAtdieasHeroKa;ifdchild==nullecontinue;heroInfo=dnewHeroKaDatae.PackDatadherosArray[i].heroId,herosArray[i].levele;child.data=heroInfo;}this.heroGroup.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnHeroKaTap,thise;this.AddTouchEventdthis.editNameBtn,this.OnEditNameTap,thise;this.editNameBtn.visible=this.info.showEditBtn;}publicDestroyde{this.info.Destroyde;this.heroGroup.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnHeroKaTap,thise;}privateRefreshNamede{this.userName.text=this.info.playerName;}privateOnHeroKaTapde:egret.TouchEvente{ifdegret.isde.target,"game.HeroKa"e==truee{letheroId=de.targetasHeroKae.info.heroId;letinfo=this.info.PackHeroInfodheroIde;ifdinfo==nullereturn;UIManager.ShowPaneldPanelTypeConst.HeroInfoPanel,infoe;SoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;}}privateOnEditNameTapde:egret.TouchEvente{}}}﻿c****cmodulegame{exportclassWarPlayerInfoextendsUIComponentBase{publicroot:eui.Group;publicplayerIcon:eui.Image;publicedgeIcon:eui.Image;publicplayerName:eui.Label;publicfamilyName:eui.Label;publicnameInfo:eui.Group;publiccupCount:eui.BitmapLabel;privateenemyType:number;cc0：己方1：敌方publicfightRoleId:number;publicconstructordenemyType:numbere{ifdenemyType==0ecc己方superd"MyPlayerInfoSkin"e;elsecc敌方superd"TargetPlayerInfoSkin"e;this.enemyType=enemyType;this.fightRoleId=0;}protectedchildrenCreatedde{super.childrenCreatedde;}publicSetWarUIDataddatae{ifd!this.isCreateOvere{this.SetCreateOverCBdde=b{this.SetWarUIDataddatae;},thise;return;}this.nameInfo.visible=true;this.playerName.text=data[1];this.familyName.text=data[2];this.playerIcon.source=DataUtil.GetPlayerIconSourceddata[3]e;this.edgeIcon.source=DataUtil.GetEdgeIconSourceddata[4]e;this.cupCount.text=`${data[5]}!`;this.playerIcon.x=22;this.playerIcon.y=27}protectedDestroyde{}}}﻿modulegame{exportclassCommonWinextendseui.Component{privatecloseBtn:SButton;privatetitle:eui.Label;publiccloseCB:Function;publicp:UIComponentBase;publicconstructorde{superde;this.skinName="CommonWinSkin";}protectedchildrenCreatedde:void{super.childrenCreatedde;ccTimerMgr.GetInstancede.AddTimerd100,de=b{ccthis.closeBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseTap,thise;ccthis.closeBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseTap,thise;cc},thise;}publicInitdtitle:string,closeCB:Function,thisObj:UIComponentBasee{this.p=thisObj;this.closeCB=closeCB;this.title.text=title;this.closeBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseTap,thise;}publicDestroyde{this.p=null;this.closeCB=null;this.closeBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseTap,thise;}cc----------------------------------------------------------------------Editcc----------------------------------------------------------------------EventprivateOnCloseTapde:egret.TouchEvente{ifdthis.p!=null&&this.closeCB!=nullethis.closeCB.calldthis.pe;}}}﻿modulegame{exportclassMainPanelBgTabData{publictab:ITabItem;publicview:UIComponentBase;publicindex:number;publictabClass:any;publicviewClass:any;publicparam:any;publicDestroyde{ifdthis.tab!=null&&this.tab["destroy"]!=nulle{this.tab["destroy"]de;this.tab=null;}ifdthis.view!=nulle{this.view.DestroyAllde;this.view=null;}this.tabClass=null;this.viewClass=null;this.param=null;}publicPackDatadindex:number,tabClass:any,viewClass:any,param:any=nulle{this.index=index;this.tabClass=tabClass;this.viewClass=viewClass;this.param=param;returnthis;}}exportclassMainPanelBgData{publiccloseBtnIcon:string;publiccloseCB:Function;publicparent:any;publicselectCB:Function;publicparam:any;publiccurrTab:MainPanelBgTabData;publicDestroyde{this.closeCB=null;this.parent=null;this.currTab=null;this.selectCB=null;this.param=null;}c**主要是注册关闭界面的相关信息*cpublicPackData1dcloseBtnIcon:string,closeCB:Function,parent:UIComponentBase,selectCB:Function=null,param:any=nulle{this.closeBtnIcon=closeBtnIcon;this.closeCB=closeCB;this.parent=parent;this.selectCB=selectCB;this.param=param;returnthis;}publicExecdindex:numbere{ifdthis.parent!=null&&this.selectCB!=nulle{this.selectCB.calldthis.parent,index,this.parame;}}}exportclassMainPanelBgextendsUIComponentBase{privatecloseBtn:SButton;privatecostInfo:CostInfo;privatetabGroup:eui.Group;privateviewGroup:eui.Group;publictabMap:SMapanumber,MainPanelBgTabDatab;publicinfo:MainPanelBgData;publicconstructorde{superd"MainPanelBgSkin"e;}cc----------------------------------------------------------------------必须要执行的apipublicInitdinfo:MainPanelBgDatae{this.info=info;this.closeBtn.icon=info.closeBtnIcon;this.tabMap=newSMapanumber,MainPanelBgTabDatabde;this.AddTouchEventdthis.closeBtn,this.OnCloseTap,thise;}publicDestroyde{this.info.Destroyde;fordlettabDataofthis.tabMap.valuesdee{tabData.Destroyde;}letitem:UIComponentBasefordleti=0,len=this.viewGroup.numChildren;ialen;i++e{item=this.viewGroup.getChildAtdieasUIComponentBase;item.DestroyAllde;}lettab:ITabItem;fordleti=0,len=this.tabGroup.numChildren;ialen;i++e{tab=this.tabGroup.getChildAtdieasITabItem;tab.Destroyde;}this.tabMap=null;this.info.currTab=null;this.closeBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseTap,thise;}publicAddTabdinfo:MainPanelBgTabDatae{ifdthis.tabMap.hasdinfo.indexe==trueereturn;lettab=newinfo.tabClassde;info.tab=tab;this.tabMap.setdinfo.index,infoe;this.tabGroup.addChilddtabe;this.AddTouchEventdtab,this.OnChangeTab,thise;returntab;}publicSetTabIndexdindex:numbere{ifdthis.info.currTab!=nulle{this.info.currTab.tab.selected=false;ifdthis.info.currTab.view!=nulle{this.info.currTab.view.visible=falsethis.info.currTab.view.Hidede;}}lettabData=this.tabMap.getdindexe;this.info.currTab=tabData;ifdthis.info.currTab!=nulle{this.info.currTab.tab.selected=true;ifdthis.info.currTab.view==nulle{letnewView:UIComponentBase=newtabData.viewClassde;tabData.view=newView;this.viewGroup.addChilddnewViewe;newView.InitDatadtabData.parame;}this.info.currTab.view.visible=true;this.info.currTab.view.Showde;this.info.Execdindexe;}}cc----------------------------------------------------------------------EventprivateOnCloseTapde:egret.TouchEvente{this.info.closeCB.calldthis.info.parent,ee;}privateOnChangeTabde:egret.TouchEvente{fordlettabDataofthis.tabMap.valuesdee{ifdtabData.tab==e.targete{ifdtabData.index==this.info.currTab.indexebreak;this.SetTabIndexdtabData.indexe;break;}}}}}modulegame{cc显示和卡牌经验有关的进度条exportclassProgressExpextendseui.Component{privatekaPaiNumProg:eui.ProgressBar;privateprogLb:eui.BitmapLabel;privatenonTips:eui.Label;privatemaxLevelImg:eui.Image;publicNONE:number=1;publicMAX_LV:number=2;publicCOMMON:number=3;publicCAN_UPGRADE:number=4;publicLOCK:number=5;publicconstructorde{superde;this.skinName="ProgressExpSkin";}publicInitde{}publicDestroyde{}publicSetSataQuickdmax:number,value:number=0e{ifdmaxa0ethis.SetNoneViewde;elseifdmax==0ethis.SetMaxLvViewde;elseifdvalueamaxethis.SetCommonViewd0,max,valuee;elseifdvaluebmaxethis.SetCanUpgradeViewd0,max,valuee;}publicSetStatedstate:number=this.NONE,...param:any[]e{ifdstate==this.NONEethis.SetNoneViewde;elseifdstate==this.MAX_LVethis.SetMaxLvViewde;elseifdstate==this.COMMONethis.SetCommonViewdparam[0],param[1],param[2]e;elseifdstate==this.CAN_UPGRADEethis.SetCanUpgradeViewdparam[0],param[1],param[2]e;elseifdstate==this.LOCKethis.SetLockViewdparam[0]e;}privateSetNoneViewde{this.currentState="none";this.validateNowde;this.nonTips.text=`未获得卡牌`;}privateSetMaxLvViewde{this.currentState="maxLv";}privateSetCommonViewdmin:number,max:number,value:numbere{this.currentState="common";this.validateNowde;this.kaPaiNumProg.minimum=min;this.kaPaiNumProg.maximum=max;this.kaPaiNumProg.value=value;this.progLb.text=`${value}!${max}`;}privateSetCanUpgradeViewdmin:number,max:number,value:numbere{this.currentState="canUpgrade";this.kaPaiNumProg.minimum=min;this.kaPaiNumProg.maximum=max;this.kaPaiNumProg.value=value;this.progLb.text=`${value}!${max}`;}privateSetLockViewdstr:stringe{this.currentState="lock";this.validateNowde;this.nonTips.text=str;}}}﻿modulegame{exportclassFamilyApplyItemData{publicplayerId:number;publicPackDatadplayerId:numbere{this.playerId=playerId;returnthis;}publicDestroyde{}}exportclassFamilyApplyItemextendseui.ItemRenderer{privateheadIcon:HeadIcon;privateplayerName:eui.Label;privatecups:eui.Button;privateaccept:SButton;privaterefuse:SButton;privatelevel:eui.Button;publicinfo:FamilyApplyItemData;publicconstructorde{superde;this.skinName="FamilyApplyItemSkin";}publicDestroyde{ifdthis.info!=nullethis.info.Destroyde;}dataChangedde{ifdthis.data==nullereturn;this.info=this.data;letapplyPlayers=game.MainDataMgr.GetInstancede.familyDataMgr.myFamily.applyPlayers;ifdapplyPlayers!=nulle{fordletplayerofapplyPlayerse{ifdthis.info.playerId==player.ide{this.playerName.text=player.name;this.cups.label=LanUtil.GetFormatd`{0}`,player.cupse;this.headIcon.SetIcondplayer.iconIde;this.headIcon.SetFramedplayer.iconBge;this.level.label=`${player.level}`;}}}}}}﻿modulegame{exportclassFamilyApplyPanelextendsUIComponentBase{privatelist:eui.List;privateupdateList:eui.ArrayCollection;privatecomWin:CommonWin;privatenoTips:eui.Button;publicconstructorde{superd"FamilyApplyPanelSkin"e;}publicInitDatade{this.comWin.Initd"申请列表",this.OnCloseDlg,thise;this.list.itemRenderer=FamilyApplyItem;this.updateList=neweui.ArrayCollectionde;this.list.dataProvider=this.updateList;letmyFamily=game.MainDataMgr.GetInstancede.familyDataMgr.myFamily;this.AddPropCB_NotCalldmyFamily,myFamily.applyPlayersName,this.OnUpdateListe;this.list.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnListItemTap,thise;ClientNet.NetFamily.C2SFamilyApplyde;}protectedDestroyde{this.comWin.Destroyde;RenderUtils.RemoveUpdateListdthis.updateListe;RenderUtils.RemoveListdthis.liste;this.list.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnListItemTap,thise;}privateOnUpdateListdparam?:anye{ifdparam==null||param.lengtha=0e{letitem:FamilyApplyItemData;letmyFamily=game.MainDataMgr.GetInstancede.familyDataMgr.myFamily;letplayers=myFamily.applyPlayers;ifdplayers.lengthb0e{this.noTips.visible=false;letarr:FamilyApplyItemData[]=[];fordleti=0;iaplayers.length;i++e{item=dnewFamilyApplyItemDatae.PackDatadplayers[i].ide;arr.pushditeme;}this.updateList.replaceAlldarre;}else{this.noTips.visible=true;}}else{this.noTips.visible=false;letid=param[1];this.RemovePlayerdide;}}privateRemovePlayerdid:numbere{letitem:FamilyApplyItemData;fordleti=0;iathis.updateList.length;i++e{item=this.updateList.getItemAtdie;ifditem==nulle{break;}elseifditem.playerId==ide{this.updateList.removeItemAtdie;item.Destroyde;break;}}}cc----------------------------------------------------------------------EventprivateOnListItemTapde:egret.Evente{lettarget:egret.DisplayObject=e.target;ifdegret.isdtarget,"SButton"ee{letparent=target.parentasFamilyApplyItem;ifdtarget.name=="refuseBtn"e{TipsManager.ShowTipsd"拒绝"e;parent.info!=null&&ClientNet.NetFamily.C2SDoApplydfalse,parent.info.playerIde;}elseifdtarget.name=="acceptBtn"e{TipsManager.ShowTipsd"接受"e;parent.info!=null&&ClientNet.NetFamily.C2SDoApplydtrue,parent.info.playerIde;}}}}}﻿modulegame{exportclassFamilyApplyPanelCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnFamilyApplyPanel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,falsee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿modulegame{exportclassFamilyAskPanelextendsUIComponentBase{privatelist:eui.Group;privatekaGroup:eui.Group;privatetip1:eui.Label;privatetip2:eui.Label;privatetip3:eui.Label;privateinfoBtn:SButton;privateqqBtn:SButton;privatehasTips:eui.Scroller;privatenoTips:eui.Button;privatecurrChangingHero:number;publicconstructorde{superd"FamilyAskPanelSkin"e;}protectedchildrenCreatedde{super.childrenCreatedde;this.InitDatade;}publicInitDatade{cc理论上应该一个label就可以搞定这个tips，但官方的富文本设置属性貌似出了点问题，需要研究一下。this.tip1.text=`50张普通卡`;this.tip2.text=`5张稀有卡`;this.tip3.text=`2张史诗卡`;this.OnRefreshListde;this.list.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnSelHeroListTap,thise;this.AddTouchEventdthis.infoBtn,this.OnInfoBtnTap,thise;}protectedDestroyde{fordleti=0,len=this.list.numChildren;ialen;i++e{dthis.list.getChildAtdieasHeroKa4e.DestroyAllde;}ccGlobalEvent.UnSubscribedGlobalEventType.familyAskChangeItem,this.OnChangeItem,thise;ccthis.currItem=null;ccthis.RemoveAllItemde;}privateOnRefreshListde{lethArray=MainDataMgr.GetInstancede.heroDataMgr.heroKeysArray;ifdhArray.lengthb0e{letitem:HeroKa4;letj:number=0;fordleti=0,len=hArray.length;ialen;i++e{item=newHeroKa4de;item.data=dnewHeroKa4Datae.PackDatadhArray[i]e;item.x=216*dj%4e;item.y=170*Math.floordjc4e;this.list.addChildditeme;j++;}this.noTips.visible=false;this.hasTips.visible=true;}else{this.noTips.visible=false;this.hasTips.visible=false;}}cc切换需要查看消息的英雄privateChangeChangingHerodhero:numbere{ifdthis.currChangingHero==heroereturn;letlist=this.list;letitem:HeroKa4;lettarItem:HeroKa4;fordleti=0,len=list.numChildren;ialen;i++e{item=list.getChildAtdieasHeroKa4;ifditem.info.heroId==this.currChangingHeroe{item.Selected=false;}ifditem.info.heroId==heroe{tarItem=item;}}ifdtarItem!=nulle{tarItem.Selected=true;this.list.setChildIndexdtarItem,777e;}this.currChangingHero=hero;}privateOnSelHeroListTapde:egret.TouchEvente{ifdegret.isde.target,"game.HeroKa1"eecc点击卡牌{letka4=e.target.parentasHeroKa4;letcanUse=false;lethMgr=MainDataMgr.GetInstancede.heroDataMgr;letheroInfo=hMgr.GetHerodka4.info.heroIde;ifdheroInfo.camp==0e{canUse=true;}else{letteamInfo=MainDataMgr.GetInstancede.teamDataMgr.GetCurrTeamInfode;letleaderInfo=hMgr.GetHerodteamInfo.leadere;ifdheroInfo.camp==leaderInfo.campecanUse=true;}ifdcanUse==falseereturnTipsManager.ShowTipsdLanUtil.GetTextd"该领主无法使用这张卡"ee;ifdegret.isdka4,"game.HeroKa4"e==falseereturn;SoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;this.ChangeChangingHerodka4.info.heroIde;}ccelseifdegret.isde.target,"game.HeroKa3"eecc点击展开后的卡牌cc{ccthis.ChangeChangingHerodnulle;cc}elseifdegret.isde.target,"SButton"ee{letka4:HeroKa4=e.target.parent;ifdde.targetasSButtone.name=="infoBtn"e{letinfo=dnewHeroInfoPanelDatae.PackPlayerDatadka4.info.heroIde;UIManager.ShowPaneldPanelTypeConst.HeroInfoPanel,infoe;}elseifdde.targetasSButtone.name=="qqBtn"e{UIManager.HidePaneldPanelTypeConst.FamilyChangeKaPanele;ClientNet.NetFamily.C2SSendInfodF_CHAT_TYPE.ASK,this.currChangingHeroe;}}}privateOnInfoBtnTapde:egret.TouchEvente{}ccprivateShowListdecc{ccthis.RemoveAllItemde;ccletitem:HeroAskItem;ccfordleti=this.kaList.length-1;ib=0;i--ecc{ccitem=newHeroAskItemde;ccitem.x=di%5e*146;ccitem.y=Math.floordic5e*200;ccitem.data=this.kaList[i];ccthis.kaGroup.addChildditeme;cc}cc}ccprivateRemoveAllItemdecc{ccletitem:HeroAskItem;ccwhiledthis.kaGroup.numChildrenb0ecc{ccitem=this.kaGroup.removeChildAtd0easHeroAskItem;ccitem.Destroyde;ccitem=null;cc}ccthis.kaGroup.removeChildrende;cc}cccc切换当前itemccprivateOnChangeItemdcurrItem:HeroAskItemecc{ccifdcurrItem==null||this.currItem==currItemereturn;ccifdthis.currItem!=nullecc{ccthis.currItem.sel=false;cc}ccthis.currItem=currItem;ccthis.currItem.sel=true;cc}cc----------------------------------------------------------------------datterccprivategetcurrItemde:HeroAskItemcc{cccc当skin有类时，会创建该类的实例化，同时会遍历访问器，此时还没有以下参数，需要做检测ccifdgame.MainDataMgr!=null&&game.MainDataMgr.GetInstancede!=null&&game.MainDataMgr.GetInstancede.familyDataMgr!=nulleccreturngame.MainDataMgr.GetInstancede.familyDataMgr.FamilyAsk_currItem;ccreturnnull;cc}ccprivatesetcurrItemdvalue:HeroAskItemecc{ccgame.MainDataMgr.GetInstancede.familyDataMgr.FamilyAsk_currItem=value;cc}ccprivategetkaListde:any[]cc{ccifdgame.MainDataMgr!=null&&game.MainDataMgr.GetInstancede!=null&&game.MainDataMgr.GetInstancede.familyDataMgr!=nulleccreturngame.MainDataMgr.GetInstancede.familyDataMgr.FamilyAsk_kaList;ccreturnnull;cc}ccprivatesetkaListdvalue:any[]ecc{ccgame.MainDataMgr.GetInstancede.familyDataMgr.FamilyAsk_kaList=value;cc}}}﻿modulegame{exportclassFamilyChangeKaPanelextendsUIComponentBase{privateask:eui.ToggleButton;privateswap:eui.ToggleButton;privatecomWin:CommonWin;privateaskPanel:FamilyAskPanel;publicconstructorde{superd"FamilyChangeKaPanelSkin"e;}publicInitDatade{this.comWin.Initd"选择您想要的卡牌",this.OnCloseDlg,thise;this.ShowViewd1e;this.AddTouchEventdthis.ask,this.OnTabTap,this,1e;this.AddTouchEventdthis.swap,this.OnTabTap,this,2e;}protectedDestroyde{this.comWin.Destroyde;this.askPanel.DestroyAllde;}privateShowViewdtype:numbere{ifdtype==1e{this.askPanel.visible=true;this.ask.currentState="down";this.swap.currentState="up";}else{this.askPanel.visible=false;this.ask.currentState="up";this.swap.currentState="down";}}privateOnTabTapde:egret.TouchEvent,param:numbere{this.ShowViewdparame;}}}﻿modulegame{exportclassFamilyChangeKaPanelCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnFamilyChangeKaPanel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,falsee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿modulegame{exportclassFamilyChatAskItemextendsItemRenderBase{privateplayerInfo:FamilyChatItemTitle;privateheroka:HeroKa1;privatehasCount:eui.Label;privateupgradeCount:eui.Label;privatepresentBtn:SButton;privateprog:eui.ProgressBar;privateleftTime:eui.Label;privateinfo:FamilyChatData;publicconstructorde{superd"FamilyChatAskItemSkin"e;}publicDestroyde{ifdthis.presentBtn.hasEventListenerdegret.TouchEvent.TOUCH_TAPe==trueethis.presentBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnPreTap,thise}publicdataChangedde{this.info=this.data;ifdthis.info==nullereturn;letmainData=game.MainDataMgr.GetInstancede;cc如果想让state显示正确，不要同时使用left和right来确定位置？改用xyifdthis.info.member==mainData.roleIdecc我{this.currentState="me";this.validateNowde;}else{this.currentState="other";this.validateNowde;ifdthis.presentBtn.hasEventListenerdegret.TouchEvent.TOUCH_TAPe==falseethis.presentBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnPreTap,thise}letmember=mainData.familyDataMgr.myFamily.allMemberMap.getdthis.info.membere;this.prog.minimum=0;this.prog.maximum=member.totalAskHeroCount;this.prog.value=member.currAskHeroCount;this.leftTime.text=Stringdmember.endTimee;this.heroka.data=dnewHeroKa1Datae.PackCfgDatadmember.askHero,1e;lethero=mainData.heroDataMgr.GetHerodmember.askHeroeasHeroDataItem;ifdhero==nullereturn;this.hasCount.text=`${hero.exp}`;this.upgradeCount.text=`${hero.GetUpCostCardde}`;}privateOnPreTapde:egret.TouchEvente{TipsManager.ShowTipsdLanUtil.GetTextd"点击了捐赠按钮"ee;}}}﻿modulegame{exportclassFamilyChatEmjItemextendsItemRenderBase{privateplayerInfo:FamilyChatItemTitle;privatecontent:eui.Image;privateroot:eui.Group;privateinfo:FamilyChatData;publicconstructorde{superd"FamilyChatEmjItemSkin"e;}publicDestroyde{this.playerInfo.Destroyde;ifdthis.info!=nullethis.info.Destroyde;}publicdataChangedde{this.info=this.data;ifdthis.info==nullereturn;letmainData=game.MainDataMgr.GetInstancede;ifdthis.info.member==mainData.roleIdecc我{this.currentState="me";this.validateNowde;}else{this.currentState="other";this.validateNowde;}this.playerInfo.Initdthis.infoe;this.content.source=this.info.content;cc到时候应该传入表情id，再根据id获取对应表情this.measure}}}modulegame{exportclassFamilyChatEmjListextendseui.Component{privateemjGroup:eui.Group;publicconstructorde{superde;this.skinName="FamilyChatEmjListSkin"}publicInitDatademjId:number[]e{letemj:eui.Image;fordletidofemjIde{emj=neweui.Imagede;emj.source=JsonData.getGameDatad"emjdata_json"e[id].icon;this.emjGroup.addChilddemje;}}publicDestroyde{}}}modulegame{exportclassFamilyChatEmjWinextendseui.Component{publicbgGroup:eui.Group;publicemjGroup:eui.Group;publicconstructorde{superde;this.skinName="FamilyChatEmjWinSkin"}publicInitDatade{letcfg=JsonData.getGameDatad"emjdata_json"e;letid:string;letkey:string;letidJson={};fordletemjIdincfge{ifdemjId==nullecontinue;id=StringdemjIde;key=id[0];ifdidJson[key]==nulleidJson[key]=[];idJson[key].pushdNumberdidee;}fordletkeyinidJsone{letemjList=newFamilyChatEmjListde;emjList.touchEnabled=false;emjList.InitDatadidJson[key]e;this.emjGroup.addChilddemjListe;}}publicDestroyde{letitem:FamilyChatEmjList;fordleti=0,len=this.emjGroup.numChildren;ialen;i++e{item=this.emjGroup.getChildAtdieasFamilyChatEmjList;item.Destroyde;}}}}modulegame{ccexportclassFamilyChatItemTitleDatacc{ccpublicinfo:FamilyChatData;ccpublicDestroydecc{ccthis.info.Destroyde;cc}cc}exportclassFamilyChatItemTitleextendseui.Component{privatejob:eui.Button;privateheadIcon:HeadIcon;privateplayerMsg:eui.Label;publicinfo:FamilyChatData;publicconstructorde{superde;this.skinName="FamilyChatItemTitleSkin";}publicDestroyde{ifdthis.info!=nullethis.info.Destroyde;}publicInitdinfo:FamilyChatDatae{this.info=info;letmainData=game.MainDataMgr.GetInstancede;ifdthis.info.member==mainData.roleIdecc我{this.currentState="me";this.validateNowde;}else{this.currentState="other";this.validateNowde;}letmember=mainData.familyDataMgr.myFamily.allMemberMap.getdthis.info.membere;ifdmember!=nulle{this.job.label=`${member.GetJobNamede}`;letonLineArray=member.ShowPlayerOnLineStatede;this.playerMsg.textFlow=dnewegret.HtmlTextParsere.parserd`${member.name}afontcolor="0xa7845e"size="20"fontFamily="desc_font"bd${onLineArray[1]}eacfontb`e;}}}}modulegame{exportclassFamilyChatKaTipsextendseui.Component{publicconstructorde{superde;this.skinName="FamilyChatKaTipsSkin";}}}﻿modulegame{exportclassFamilyChatNoticeItemextendsItemRenderBase{privatecontent:eui.Label;privateinfo:FamilyChatData;publicconstructorde{superd"FamilyChatNoticeItemSkin"e;}publicDestroyde{}publicdataChangedde{this.info=this.data;ifdthis.info==nullereturn;ccletmember=mainData.familyDataMgr.myFamily.GetMemberdthis.info.membere;this.content.text=this.info.content;ccthis.measure}}}﻿modulegame{exportclassFamilyChatPanelextendsUIComponentBase{privatetextContent:SInputLabel;privatesend:SButton;privatekapaiBtn:SButton;privatevoice:SButton;privateemj:SButton;privateemjWin:FamilyChatEmjWin;privatelist:eui.List;privatescro:eui.Scroller;privateupdateList:eui.ArrayCollection;publicconstructorde{superd"FamilyChatPanelSkin"e;}publicInitDatade{this.list.itemRendererFunction=this.ListItemRendererFunction;letfMgr=game.MainDataMgr.GetInstancede.familyDataMgr;this.updateList=neweui.ArrayCollectiondfMgr.chatArraye;this.list.dataProvider=this.updateList;this.AddPropCB_NotCalldfMgr,"chatMap",this.OnUpdateChatListe;this.index=1;this.OnRefreshChatLitde;this.OnRefreshChatLitde;this.emjWin.InitDatade;this.updateList.addEventListenerdeui.CollectionEvent.COLLECTION_CHANGE,this.OnRefreshChatLit,thise;this.AddTouchEventdthis.send,this.OnSendTap,thise;this.AddTouchEventdthis.kapaiBtn,this.OnKaPaiTap,thise;this.AddTouchEventdthis.voice,this.OnVoiceTap,thise;this.AddTouchEventdthis.emj,this.OnEmjTap,thise;this.AddTouchEventdthis.emjWin.bgGroup,this.OnEmjWinBgTap,thise;this.emjWin.emjGroup.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnEmjItemTap,thise;ccGlobalEvent.SubscribedGlobalEventType.familyChat,this.OnUpdateChatList,thise;}protectedDestroyde{this.emjWin.emjGroup.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnEmjItemTap,thise;this.emjWin.Destroyde;this.updateList&&this.updateList.removeEventListenerdeui.CollectionEvent.COLLECTION_CHANGE,this.OnRefreshChatLit,thise;this.updateList=null;this.index=1;ccGlobalEvent.UnSubscribedGlobalEventType.familyChat,this.OnUpdateChatList,thise;}publicShowde{}publicHidede{}publicShowEmjWindshow:booleane{ifdshow==truee{this.emjWin.visible=true;}else{this.emjWin.visible=false;}}publicSendEmjdid:numbere{}cc增删改聊天消息privateOnUpdateChatListdparam:any[]e{lettype=param[0];letchatInfo:FamilyChatData=param[1];ccaddifdtype==1e{this.updateList.addItemdchatInfoe;}ccremoveelseifdtype==2e{letlist=this.updateList;letitem:FamilyChatData;fordleti=0,len=list.length;ialen;i++e{item=list.getItemAtdie;ifditem.sendTime==chatInfo.sendTimee{this.updateList.removeItemAtdie;break;}}}}cc----------------------------------------------------------------------CallBackprivateindex:number=1;publicOnRefreshChatLitde{ifdthis.scro==null||this.scro.viewport==nullereturn;setTimeoutdde=b{ifdthis.scro.viewport.contentHeightbthis.scro.viewport.heighte{this.scro.viewport.scrollV=this.scro.viewport.contentHeight-this.scro.viewport.height;}this.index--;},100*this.indexe;this.index++;}cc----------------------------------------------------------------------EventprivateOnSendTapde:egret.TouchEvente{ClientNet.NetFamily.C2SSendInfodF_CHAT_TYPE.TEXT,this.textContent.texte;}privateOnKaPaiTapde:egret.TouchEvente{UIManager.ShowPaneldPanelTypeConst.FamilyChangeKaPanele;ccClientNet.NetFamily.C2SSendInfodF_CHAT_TYPE.ASK,this.textContent.texte;}privateOnVoiceTapde:egret.TouchEvente{ccClientNet.NetFamily.C2SSendInfodF_CHAT_TYPE.VOICE,this.textContent.texte;}privateOnEmjTapde:egret.TouchEvente{this.ShowEmjWind!this.emjWin.visiblee;ccClientNet.NetFamily.C2SSendInfodF_CHAT_TYPE.EMJ,"icon_hero_new"e;ccClientNet.NetFamily.C2SSendInfodF_CHAT_TYPE.VOICE,this.textContent.texte;}privateOnEmjWinBgTapde:egret.TouchEvente{this.ShowEmjWindfalsee;}privateOnEmjItemTapde:egret.TouchEvente{this.ShowEmjWindfalsee;letimg=e.targetaseui.Image;ClientNet.NetFamily.C2SSendInfodF_CHAT_TYPE.EMJ,img.sourcee;}cc----------------------------------------------------------------------privateprivateListItemRendererFunctionddata:FamilyChatDatae{letitem:any;switchddata.typee{caseF_CHAT_TYPE.TEXT:item=FamilyChatTextItem;break;caseF_CHAT_TYPE.EMJ:item=FamilyChatEmjItem;break;caseF_CHAT_TYPE.VOICE:item=FamilyChatVoiceItem;break;caseF_CHAT_TYPE.NOTICE:item=FamilyChatNoticeItem;break;caseF_CHAT_TYPE.ASK:item=FamilyChatAskItem;break;caseF_CHAT_TYPE.SWAP:item=FamilyChatSwapItem;break;}returnitem;}}}﻿modulegame{exportclassFamilyChatSwapItemextendsItemRenderBase{privateinfo:FamilyChatData;publicconstructorde{superd"FamilyChatSwapItemSkin"e;}publicDestroyde{}publicdataChangedde{this.info=this.data;ifdthis.info==nullereturn;letmainData=game.MainDataMgr.GetInstancede;cc如果想让state显示正确，不要同时使用left和right来确定位置？ifdthis.info.member==mainData.roleIdecc我{this.currentState="me";this.validateNowde;}else{this.currentState="other";this.validateNowde;}}}}﻿modulegame{exportclassFamilyChatTextItemextendsItemRenderBase{privateplayerInfo:FamilyChatItemTitle;privatecontent:eui.Label;privateroot:eui.Group;privateinfo:FamilyChatData;publicconstructorde{superd"FamilyChatTextItemSkin"e;}publicDestroyde{this.playerInfo.Destroyde;ifdthis.info!=nullethis.info.Destroyde;}publicdataChangedde{this.info=this.data;ifdthis.info==nullereturn;letmainData=game.MainDataMgr.GetInstancede;ifdthis.info.member==mainData.roleIdecc我{this.currentState="me";this.validateNowde;}else{this.currentState="other";this.validateNowde;}this.content.text=this.info.content;this.playerInfo.Initdthis.infoe;}}}﻿modulegame{exportclassFamilyChatVoiceItemextendsItemRenderBase{privateheadIcon:HeadIcon;privateplayerMsg:eui.Label;privatecontent:SButton;privateroot:eui.Group;privateinfo:FamilyChatData;publicconstructorde{superd"FamilyChatVoiceItemSkin"e;}publicDestroyde{}publicdataChangedde{this.info=this.data;ifdthis.info==nullereturn;letmainData=game.MainDataMgr.GetInstancede;cc如果想让state显示正确，不要同时使用left和right来确定位置？ifdthis.info.member==mainData.roleIdecc我{this.currentState="me";this.validateNowde;}else{this.currentState="other";this.validateNowde;}letmember=mainData.familyDataMgr.myFamily.allMemberMap.getdthis.info.membere;ifdmember!=nulle{this.playerMsg.text=`${member.name}d${member.GetJobNamede}e`;}ccthis.content.label=this.info.content;cc录音按钮this.measure}}}﻿modulegame{exportclassFamilySwapPanelextendsUIComponentBase{privatejuankaGroup:eui.Group;privatehuankaGroup:eui.Group;publicconstructorde{superd"FamilySwapPanelSkin"e;}publicInitDatade{}publicDestroyde{}}}﻿modulegame{exportclassHeroAskItemextendsItemRenderBase{privatebg:eui.Rect;privateinfoBtn:SButton;privateaskBtn:SButton;privateshowGroup:eui.Group;privateka:HeroKaItem;publicconstructorde{superd"HeroAskItemSkin"e;this.touchEnabled=false;}publicDestroyde{ccifdthis.ka.hasEventListenerdegret.TouchEvent.TOUCH_TAPe==trueeccthis.ka.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnBgTap,thiseccifdthis.infoBtn.hasEventListenerdegret.TouchEvent.TOUCH_TAPe==trueeccthis.infoBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnInfoTap,thiseccifdthis.askBtn.hasEventListenerdegret.TouchEvent.TOUCH_TAPe==trueeccthis.askBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnAskTap,thise}publicdataChangedde{ccifdthis.currItem!=thisecc{ccthis.sel=false;cc}ccelsecc{ccthis.sel=true;cc}ccifdthis.ka.hasEventListenerdegret.TouchEvent.TOUCH_TAPe==falseeccthis.ka.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnBgTap,thiseccifdthis.infoBtn.hasEventListenerdegret.TouchEvent.TOUCH_TAPe==falseeccthis.infoBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnInfoTap,thiseccifdthis.askBtn.hasEventListenerdegret.TouchEvent.TOUCH_TAPe==falseeccthis.askBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnAskTap,thise}privateOnAskTapde{}privateOnBgTapde{GlobalEvent.FireEventdGlobalEventType.familyAskChangeItem,thise;}privateOnInfoTapde{}publicsetseldflag:booleane{ifdflag==truee{this.showGroup.visible=true;ccthis.ka.visible=false;}else{this.showGroup.visible=false;ccthis.ka.visible=true;}}ccprivategetcurrItemde:HeroAskItemcc{ccreturngame.MainDataMgr.GetInstancede.familyDataMgr.FamilyAsk_currItem;cc}ccprivatesetcurrItemdvalue:HeroAskItemecc{ccgame.MainDataMgr.GetInstancede.familyDataMgr.FamilyAsk_currItem=value;cc}}}﻿modulegame{exportclassHeroKaItemextendsItemRenderBase{publicconstructorde{superd"HeroKaItemSkin"e;}publicDestroyde{}publicdataChangedde{}}}﻿modulegame{exportclassFamilyFightPanelextendsUIComponentBase{publicconstructorde{superd"FamilyFightPanelSkin"e;}protectedchildrenCreatedde{super.childrenCreatedde;this.InitCBde;}privateInitCBde{}protectedDestroyde{}privateOnCloseTapde:egret.TouchEvente{}}}﻿modulegame{exportclassFamilyIconDataextendsDataBase{publicicon:number;publiciconBg:number;publicisSel:boolean;publicisLock:boolean;publicDestroyde{}publicPackDatadicon:number=null,iconBg:number=null,isSel:boolean=false,isLock:boolean=falsee{this.icon=icon;this.iconBg=iconBg;this.isLock=isLock;this.isSel=isSel;returnthis;}publicGetIconde:string{fordletitemofMainDataMgr.GetInstancede.familyDataMgr.BadgeData.icone{ifditem.id==this.iconereturnitem.icon;}return""}publicGetIconBgde:string{fordletitemofMainDataMgr.GetInstancede.familyDataMgr.BadgeData.iconBge{ifditem.id==this.iconBgereturnitem.icon;}return""}}exportclassFamilyIconextendsItemRenderBase{publicfamilyIcon:eui.Image;publicfamilyIconBg:eui.Image;privateselImg:eui.Group;publiclockGroup:eui.Group;privatebg:eui.Image;publicinfo:FamilyIconData;publichasBg:boolean=true;cc可在exml中设置publicconstructorde{superd"FamilyIconSkin"e;}publicDestroyde{ifdthis.info!=nullethis.info.Destroyde;}dataChangedde{ifdthis.data==nullereturn;this.info=this.data;this.bg.visible=this.hasBg;this.RemoveAllCBde;this.AddPropCBdthis.info,"icon",this.UpdateIcone;this.AddPropCBdthis.info,"iconBg",this.UpdateIconBge;this.AddPropCBdthis.info,"isLock",this.UpdateLocke;this.AddPropCBdthis.info,"isSel",this.Sele;}privateSelde{this.selImg.visible=this.info.isSel;}privateUpdateIconde{this.familyIcon.source=this.info.GetIconde;}privateUpdateIconBgde{this.familyIconBg.source=this.info.GetIconBgde;}privateUpdateLockde{this.lockGroup.visible=this.info.isLock;}}}﻿modulegame{exportclassFamilyMainPanelData{publicindex:number;}exportclassFamilyMainPanelextendsUIComponentBase{privatemainBg:MainPanelBg;privatechatBtn:TabItem1;privatefamilyBtn:TabItem1;privateshopBtn:TabItem1;privatecurrView:any;publicconstructorde{superd"FamilyMainPanelSkin"e;}publicInitDatadindex:number=1e{letinfo=dnewMainPanelBgDatadee.PackData1d"button_return_jz",this.OnCloseTap,thise;this.mainBg.Initdinfoe;lettab1Info=dnewMainPanelBgTabDatadee.PackDatad1,TabItem1,FamilyChatPanele;lettab2Info=dnewMainPanelBgTabDatadee.PackDatad2,TabItem1,FamilyPanele;lettab3Info=dnewMainPanelBgTabDatadee.PackDatad3,TabItem1,FamilyShopPanele;this.chatBtn=this.mainBg.AddTabdtab1InfoeasTabItem1;this.familyBtn=this.mainBg.AddTabdtab2InfoeasTabItem1;this.shopBtn=this.mainBg.AddTabdtab3InfoeasTabItem1;this.chatBtn.Initd"button_jz_lt_0","button_jz_lt"e;this.familyBtn.Initd"button_jz_zy_0","button_jz_zy"e;this.shopBtn.Initd"button_jz_sd_0","button_jz_sd"e;this.mainBg.SetTabIndexd2e;ClientNet.NetFamily.C2SFamilyInfodgame.MainDataMgr.GetInstancede.familyDataMgr.myFamily.ide;}protectedDestroyde{this.mainBg.Destroyde;}privateOnCloseTapde:egret.TouchEvente{UIManager.HidePaneldPanelTypeConst.FamilyMainPanele;}}}﻿modulegame{exportclassFamilyMainPanelCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnFamilyMainPanel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,falsee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿modulegame{exportclassFamilyPanelextendsUIComponentBase{privatequitBtn:SButton;privateapplyBtn:SButton;privatesetting:SButton;privatefamilyIcon:FamilyIcon;privatelist:eui.List;privateupdateList:eui.ArrayCollection;privatefamilyName:eui.Label;privatedesc:eui.Label;privatezhanli:eui.Button;privatemember:eui.Label;privatecups:eui.Buttonprivatelocal:eui.Label;privateneedCups:eui.Label;privatecurrOpenMember:FamilyPanelItemDataItem;publicconstructorde{superd"FamilyPanelSkin"e;}protectedDestroyde{letitem:FamilyPanelItemDataItem;RenderUtils.RemoveUpdateListdthis.updateListe;RenderUtils.RemoveListdthis.liste;this.currOpenMember=null;this.list.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnItemTap,thise;}publicInitDatade:void{letinfo=MainDataMgr.GetInstancede.familyDataMgr.myFamily;this.AddPropCBdinfo,"desc",this.UpdateView,thise;this.AddPropCB_NotCalldinfo,"iconId",this.UpdateView,thise;this.AddPropCB_NotCalldinfo,"iconBg",this.UpdateView,thise;this.AddPropCB_NotCalldinfo,"needCups",this.UpdateView,thise;this.AddPropCB_NotCalldinfo,"zhanli",this.UpdateView,thise;this.AddPropCB_NotCalldinfo,"cups",this.UpdateView,thise;this.list.itemRenderer=FamilyPanelItem;this.updateList=neweui.ArrayCollectionde;this.list.dataProvider=this.updateList;this.AddPropCBdinfo,info.allMemberMapName,this.UpdateMmeberListe;this.AddTouchEventdthis.quitBtn,this.OnQuitTap,thise;this.AddTouchEventdthis.applyBtn,this.OnApplyTap,thise;this.AddTouchEventdthis.setting,this.OnSettingTap,thise;this.list.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnItemTap,thise;this.AddPropCB_NotCalldinfo,"id",this.OnLeaveFamily,thise;}privateUpdateViewde{letinfo=MainDataMgr.GetInstancede.familyDataMgr.myFamily;this.familyName.text=`${info.name}`;this.desc.text=`${info.desc}`;this.zhanli.label=`${info.zhanli}`;this.cups.label=`${info.cups}`;this.familyIcon.data=dnewFamilyIconDatae.PackDatadinfo.iconId,info.iconBge;this.local.text=`${MainDataMgr.GetInstancede.GetLocalNamedinfo.locale}`;this.member.text=`${info.allMemberMap.valuesde.length}c${info.mMaxNum}`;this.needCups.text=`需要奖杯:${info.needCups}`;}privateUpdateMmeberListdparam?:anye{ifdparam==null||param.lengtha=0e{letinfo=MainDataMgr.GetInstancede.familyDataMgr.myFamily;letarr=[],item:FamilyPanelItemDataItem;letarray=info.allMemberMap.valuesde;fordleti=0,len=array.length;ialen;i++e{item=newFamilyPanelItemDataItem;item.id=array[i].id;arr.pushditeme;}this.updateList.replaceAlldarre;}else{lettype=param[0];letid=param[1];ifdtype==1ecc添加成员{letnewMember=newFamilyPanelItemDataItemde;newMember.id=id;this.updateList.addItemdnewMembere;}elseifdtype==2e{letitem:FamilyPanelItemDataItem;fordleti=0,len=this.updateList.length;ialen;i++e{item=this.updateList.getItemAtdie;ifditem.id==ide{this.updateList.removeItemAtdie;break;}}}}letinfo=MainDataMgr.GetInstancede.familyDataMgr.myFamily;this.member.text=`${info.allMemberMap.valuesde.length}c${info.mMaxNum}`;}cc----------------------------------------------------------------------EventprivateOnItemTapde:egret.TouchEvente{lettarget=e.target;ifdegret.isdtarget,"eui.Image"e&&target.name=="bg"e{letinfo=target.parent.parent.info;letdataItem:FamilyPanelItemDataItem;letcurrIndex:number=null;letnextIndex:number=null;fordleti=0,len=this.updateList.length;ialen;i++e{dataItem=this.updateList.getItemAtdie;ifdthis.currOpenMember!=null&&dataItem.id==this.currOpenMember.ide{currIndex=i;}ifddataItem.id==info.ide{nextIndex=i;}}ifdcurrIndex!=nextIndexe{ifdcurrIndex!=nulle{dataItem=this.updateList.getItemAtdcurrIndexe;dataItem.SetAttrd"selected",falsee;}ifdnextIndex!=nulle{dataItem=this.updateList.getItemAtdnextIndexe;dataItem.SetAttrd"selected",truee;this.currOpenMember=info;}}elseifdnextIndex!=nulle{dataItem=this.updateList.getItemAtdnextIndexe;dataItem.SetAttrd"selected",!dataItem.selectede;this.currOpenMember=info;}}cc按钮操作elseifdegret.isdtarget,"SButton"ee{letinfo=dtarget.parent.parentasFamilyPanelIteme.info;ifdtarget.name=="changeJob"e{ClientNet.NetFamily.C2SJobdinfo.ide;}elseifdtarget.name=="rmMemberBtn"e{ClientNet.NetFamily.C2SRemoveMemberdinfo.ide;}elseifdtarget.name=="showInfoBtn"e{letdata=dnewPlayerInfoMainPanelDatadee.PackMyFamilyMemberdinfo.ide;UIManager.ShowPaneldPanelTypeConst.PlayerInfoMainPanel,datae;}}}privateOnQuitTapde:egret.TouchEvente{lettext=`\nafontsize="24"b退出家族将清除所拥有的所有贡献，请先使用后再退出\n\nacfontbafontcolor="0xb97432"size="24"b当前拥有贡献：${1}acfontb`letdata:CommonDlgData=newCommonDlgData;data.leftText=LanUtil.GetTextd"关闭"e;data.rightText=LanUtil.GetTextd"退出"e;data.titleText=LanUtil.GetTextd"提示"e;data.content=text;data.thisObj=this;data.leftFunc=de=b{};data.rightFunc=de=b{ClientNet.NetFamily.C2SLeaveFamilydgame.MainDataMgr.GetInstancede.familyDataMgr.myFamily.ide;};UIManager.ShowPaneldPanelTypeConst.CommonDlg,datae;}privateOnApplyTapde:egret.TouchEvente{UIManager.ShowPaneldPanelTypeConst.FamilyApplyPanele;}privateOnSettingTapde:egret.TouchEvente{UIManager.ShowPaneldPanelTypeConst.FamilySettingPanele;}privateOnLeaveFamilyde{lethasFamily=MainDataMgr.GetInstancede.familyDataMgr.CheckHasFamilyde;ifdhasFamily==falseeUIManager.HidePaneldPanelTypeConst.FamilyMainPanele;}}}﻿modulegame{exportclassFamilyPanelItemDataItemextendsDataBase{publicid:number;publicselected:boolean=false;publicconstructorde{superde;};publicInitde{};publicDestroyde{};}exportclassFamilyPanelItemextendsItemRenderBase{privateheadIcon:HeadIcon;privaterank:RankNum;privatejob:eui.Button;privateplayerName:eui.Label;privateonline:eui.Label;privatecups:eui.Button;privatecontribute:eui.Button;publicchangeJob:SButton;publicrmMemberBtn:SButton;publicshowInfoBtn:SButton;publicbg:eui.Image;publicinfo:FamilyPanelItemDataItempublicconstructorde{superd"FamilyPanelItemSkin"e;}protectedDestroyde{ifdthis.data!=nullethis.data.Destroyde;}publicdataChangedde{ifdthis.data==nullereturn;this.info=this.data;letmyFamily=game.MainDataMgr.GetInstancede.familyDataMgr.myFamily;ifdmyFamily.allMemberMap.hasdthis.info.ide==falseereturn;this.RemoveAllCBde;this.AddPropCBdthis.info,"selected",this.Sele;letmember=myFamily.allMemberMap.getdthis.info.ide;this.AddPropCBdmember,"cups",this.OnRefreshCups,membere;this.AddPropCBdmember,"job",this.OnRefreshBtn,membere;this.AddPropCBdmember,"contribute",this.OnRefreshContribute,membere;this.rank.rank=member.rank;this.playerName.text=member.name;this.online.text=member.ShowPlayerOnLineStatede[1];}privateSelde{ifdthis.info.selected==truee{this.currentState="active";}else{this.currentState="common";}this.validateNowde;}privateOnRefreshCupsdmember:MemberDataIteme{this.cups.label=`${member.cups}`;}privateOnRefreshContributedmember:MemberDataIteme{this.contribute.label=`${member.contribute}`;}privateOnRefreshBtndmember:MemberDataIteme{letmyInfo=MainDataMgr.GetInstancede.familyDataMgr.MyMemberInfode;ifdmyInfo==nullereturn;this.changeJob.visible=false;this.rmMemberBtn.visible=false;ifdmember.IsMede==falsee{ifdmyInfo.IsLeaderde==truee{this.changeJob.visible=true;this.rmMemberBtn.visible=true;}elseifdmyInfo.IsSecondHandde==truee{ifdmember.IsMemberde==truee{this.changeJob.visible=true;this.rmMemberBtn.visible=true;}}}ifdmember.IsMemberde==truee{this.changeJob.icon=`button_jz_zy_szz`;}elseifdmember.IsSecondHandde==truee{this.changeJob.icon=`button_jz_zy_jz`;}this.job.label=member.GetJobNamede;}}}﻿modulegame{exportclassFamilyCreatePanelDataextendsDataBase{}exportclassFamilyCreatePanelextendsUIComponentBase{privatecreateBtn:SButton;privateautoJoin:eui.CheckBox;privatefamilyInput:eui.TextInput;privatedescInput:eui.TextInput;privateiconId:number;privatefamilyIcon:FamilyIcon;privatemenuBtn:FamilyDrowMenu;privatelist:eui.List;privatelist2:eui.List;privatescro1:eui.Scroller;privateupdateList:eui.ArrayCollection;privateupdateList2:eui.ArrayCollection;publicconstructorde{superd"FamilyCreatePanelSkin"e;}publicInitDataddata:FamilyCreatePanelData=nulle{MainDataMgr.GetInstancede.familyDataMgr.createData.Initde;this.list.itemRenderer=FamilyIcon;this.updateList=neweui.ArrayCollectionde;this.list.dataProvider=this.updateList;this.list2.itemRenderer=FamilyIcon;this.updateList2=neweui.ArrayCollectionde;this.list2.dataProvider=this.updateList2;letcData=MainDataMgr.GetInstancede.familyDataMgr.createData;this.familyIcon.data=dnewFamilyIconDatae.PackDatadcData.icon,cData.iconBge;this.familyInput.prompt=cData.fName;this.descInput.prompt=cData.desc;this.autoJoin.selected=cData.isAuto;letinfo=dnewFamilyDrowMenuDatae.PackDatadthis.OnChangeCups,this,cData.needCupse;this.menuBtn.Initdinfoe;this.UpdateListde;this.UpdateList2de;this.AddTouchEventdthis.createBtn,this.OnCreateTap,thise;this.AddTouchEventdthis.autoJoin,this.OnAutoJoinTap,thise;this.familyInput.addEventListenerdegret.Event.CHANGE,this.OnInputChange,thise;this.descInput.addEventListenerdegret.Event.CHANGE,this.OnDescInputChange,thise;this.list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;this.list2.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItem2Tap,thise;GlobalEvent.SubscribedGlobalEventType.familyCreate,this.OnCreateCB,thise;}protectedDestroyde{RenderUtils.RemoveUpdateListdthis.updateListe;RenderUtils.RemoveUpdateListdthis.updateList2e;this.menuBtn.Destroyde;MainDataMgr.GetInstancede.familyDataMgr.createData.Destroyde;this.familyIcon.Destroyde;this.familyInput.removeEventListenerdegret.Event.CHANGE,this.OnInputChange,thise;this.descInput.removeEventListenerdegret.Event.CHANGE,this.OnDescInputChange,thise;this.list.removeEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;this.list2.removeEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItem2Tap,thise;GlobalEvent.UnSubscribedGlobalEventType.familyCreate,this.OnCreateCB,thise;}privateUpdateListde{leticonArray=MainDataMgr.GetInstancede.familyDataMgr.GetIconIdArrayde;ifdiconArray==nullereturn;RenderUtils.RemoveUpdateListdthis.updateListe;letcData=MainDataMgr.GetInstancede.familyDataMgr.createData;letitem:FamilyIconData;lettarArray:FamilyIconData[]=[];fordleti=0,len=iconArray.length;ialen;i++e{item=newFamilyIconDatade;leticon=iconArray[i];leticonBg=null;letisSelect=icon==cData.icon;letisLock=false;item.PackDatadicon,iconBg,isSelect,isLocke;tarArray.pushditeme;}this.updateList.replaceAlldtarArraye;}privateUpdateList2de{leticonArray=MainDataMgr.GetInstancede.familyDataMgr.GetIconBgIdArrayde;ifdiconArray==nullereturn;letitem:FamilyIconData;RenderUtils.RemoveUpdateListdthis.updateList2e;letcData=MainDataMgr.GetInstancede.familyDataMgr.createData;lettarArray:FamilyIconData[]=[];fordleti=0,len=iconArray.length;ialen;i++e{item=newFamilyIconDatade;leticon=null;leticonBg=iconArray[i];letisSelect=iconBg==cData.iconBg;letisLock=false;item.PackDatadicon,iconBg,isSelect,isLocke;tarArray.pushditeme;}this.updateList2.replaceAlldtarArraye;}cc----------------------------------------------------------------------EventprivateOnItemTapde:eui.ItemTapEvente{letfCreateData=MainDataMgr.GetInstancede.familyDataMgr.createData;lettarget=e.itemRendererasFamilyIcon;letnewIcon=target.info.icon;letitem:FamilyIconData;fordleti=0,len=this.updateList.length;ialen;i++e{item=this.updateList.getItemAtdie;{ifditem.icon==fCreateData.icone{item.SetAttrd"isSel",falsee;}ifditem.icon==newIcone{item.SetAttrd"isSel",truee;}}}this.familyIcon.info.SetAttrd"icon",newIcone;fCreateData.icon=newIcon;}privateOnItem2Tapde:eui.ItemTapEvente{letfCreateData=MainDataMgr.GetInstancede.familyDataMgr.createData;lettarget=e.itemRendererasFamilyIcon;letnewIconBg=target.info.iconBg;letitem:FamilyIconData;fordleti=0,len=this.updateList2.length;ialen;i++e{item=this.updateList2.getItemAtdie;{ifditem.iconBg==fCreateData.iconBge{item.SetAttrd"isSel",falsee;}ifditem.iconBg==newIconBge{item.SetAttrd"isSel",truee;}}}this.familyIcon.info.SetAttrd"iconBg",newIconBge;fCreateData.RefreshIconBgdnewIconBge;}privateOnInputChangede:egret.Evente{this.familyInput.text=Utils.GetTextByBytedthis.familyInput.text,12e;MainDataMgr.GetInstancede.familyDataMgr.createData.fName=this.familyInput.text;}privateOnDescInputChangede:egret.Evente{this.descInput.text=Utils.GetTextByBytedthis.descInput.text,100e;MainDataMgr.GetInstancede.familyDataMgr.createData.desc=this.descInput.text;}privateOnAutoJoinTapde:egret.TouchEvente{MainDataMgr.GetInstancede.familyDataMgr.createData.isAuto=!this.autoJoin.selected;}privateOnChangeCupsdtype:numbere{MainDataMgr.GetInstancede.familyDataMgr.createData.needCups=type;}privateOnCreateTapde:egret.TouchEvente{letfMgr=MainDataMgr.GetInstancede.familyDataMgr;letinfo=fMgr.createData;ifdinfo.fName.trimde.lengtha=0ereturnTipsManager.ShowTipsdLanUtil.GetFormatd`家族名称不能为空`ee;ifdfMgr.IsEnoughCreatede==falsee{letinfo=dnewShopQuickBuyWinDatae.PackDatadShopType.Diamonde;returnUIManager.ShowPaneldPanelTypeConst.ShopQuickBuyWin,infoe;}ClientNet.NetFamily.C2SCreateFamilydinfo.fName,info.icon,info.iconBg,info.desc,info.isAuto,info.needCupse;}privateOnCreateCBde{UIManager.HidePaneldPanelTypeConst.FamilyNoneMainPanele;UIManager.ShowPaneldPanelTypeConst.FamilyMainPanele;}}}﻿modulegame{exportclassFamilyDropMenuextendseui.Component{publicconstructorde{superde;this.skinName="FamilyDropMenuSkin";}}}modulegame{exportclassFamilyDrowMenuData{publicselCB:Function;publicthisObj:any;publictype:numberpublicisShow:boolean=false;publiccurrItem:FamilyDrowMenuItem;publicDestroyde{}publicPackDatadselCB:Function,thisObj:any,type:numbere{this.selCB=selCB;this.thisObj=thisObj;this.type=type;returnthis;}}exportclassFamilyDrowMenuextendseui.Component{privateshowGroup:eui.Group;privateshowBg:eui.Image;privateshowLb:eui.Label;publicinfo:FamilyDrowMenuData;publicconstructorde{superde;this.skinName="FamilyDrowMenuSkin";}publicInitdinfo:FamilyDrowMenuDatae{this.info=info;this.RemoveItemde;letdata=MainDataMgr.GetInstancede.familyDataMgr.CupsData;letitem:FamilyDrowMenuItem,itemInfo:FamilyDrowMenuItemData;fordletiindatae{item=newFamilyDrowMenuItemde;itemInfo=dnewFamilyDrowMenuItemDatae.PackDataddata[i].text,data[i].typee;item.InitditemInfoe;this.showGroup.addChildditeme;ifdthis.info.type==itemInfo.typee{item.Seldtruee;this.info.currItem=item;this.showLb.text=StringditemInfo.texte;}else{item.Seldfalsee;}}this.ShowGroupdinfo.isShowe;this.showBg.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnToggleShowTap,thise;this.showGroup.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnSelItem,thise;}publicDestroyde{this.RemoveItemde;this.info.Destroyde;this.showBg.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnToggleShowTap,thise;this.showGroup.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnSelItem,thise;}privateRemoveItemde{whiledthis.showGroup.numChildrenb0e{letitem=this.showGroup.removeChildAtd0easFamilyDrowMenuItem;item.Destroyde;}}privateShowGroupdshow:booleane{this.showGroup.visible=show;this.info.isShow=show;ifdthis.info.currItem!=nullethis.info.selCB.calldthis.info.thisObj,this.info.currItem.info.typee;}privateOnToggleShowTapde:egret.TouchEvente{this.ShowGroupd!this.info.isShowe;}privateOnSelItemde:egret.TouchEvente{ifdegret.isde.target,"game.FamilyDrowMenuItem"e==truee{lettarget=e.targetasFamilyDrowMenuItemthis.showLb.text=Stringdtarget.info.texte;this.info.currItem!=null&&this.info.currItem.Seldfalsee;this.info.currItem=target;this.info.currItem!=null&&this.info.currItem.Seldtruee;this.ShowGroupd!this.info.isShowe;}}}}modulegame{exportclassFamilyDrowMenuItemData{publictext:string;publictype:number;publicisMe:boolean=false;publicPackDatadtext:string,type:numbere{this.text=text;this.type=type;returnthis;}}exportclassFamilyDrowMenuItemextendseui.Component{privateshowlabel:eui.Label;privatebg:eui.Image;publicinfo:FamilyDrowMenuItemData;publicconstructorde{superde;this.skinName="FamilyDrowMenuItemSkin";this.touchChildren=false;}publicInitdinfo:FamilyDrowMenuItemDatae{this.info=info;this.showlabel.text=info.text;}publicDestroyde{}publicSeldflag:booleane{ccthis.bg.visible=flag;ifdflag==truee{this.currentState="active";this.validateNowde;}else{this.currentState="common";this.validateNowde;}}}}﻿modulegame{exportclassFamilyInfoCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnFamilyInfoPanel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,false,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿modulegame{exportclassFamilyInfoDataItem2{publicfamilyId:stringpublicid:number;publictype:number;publicconstructorde{}publicPackDatadfamilyId:string,playeId:number,type:numbere{this.familyId=familyId;this.id=playeId;this.type=type;returnthis;}publicDestroyde{}}exportclassFamilyInfoItemextendsItemRenderBase{privateroot:eui.Label;privatefName:eui.Label;privatejob:eui.Label;privaterank:RankNum;privatecups:eui.Label;privatecontribute:eui.Label;privateonlineState:eui.Label;privateheadIcon:HeadIcon;publicinfo:FamilyInfoDataItem2;publicconstructorde{superd"FamilyInfoItemSkin"e;}publicdataChangedde{letdata=this.dataasFamilyInfoDataItem2;this.info=data;letfData=MainDataMgr.GetInstancede.familyDataMgr.GetFamilyByTypedthis.info.type,this.info.familyIdeasFamilyDataItem;ifdfData==nullereturn;letmember=fData.allMemberMap.getdthis.info.ide;ifdmember==nullereturn;this.fName.text=member.name;this.job.text=member.GetJobNamede;this.rank.rank=member.rank;this.cups.text=`${member.cups}`;this.contribute.text=`${member.contribute}`;letarr=member.ShowPlayerOnLineStatede;this.onlineState.text=arr[1];ifdarr[0]==truee{this.onlineState.textColor=0x00ff00;}else{this.onlineState.textColor=0x888888;}this.headIcon.SetIcondmember.iconIde;this.headIcon.SetFramedmember.iconBge;}protectedDestroyde{ifdthis.info!=nullethis.info.Destroyde;this.headIcon.Destroyde;}}}﻿modulegame{exportinterfaceIFamilyInfoData{hasApply?:boolean}exportclassFamilyInfoDataItemextendsDataBase{publicid:string;publicicon:number;publiciconBg:number;publicfamilyName:string;publicneedCups:number;publicdesc:string;publiczhanli:number;publiccups:number;publiclocal:number;publicmembersArray:MemberDataItem[];publichasApply:boolean=true;privatehasApplyId:number;publicPackRecommondDatadid:string,cfg?:IFamilyInfoDatae{letfMgr=MainDataMgr.GetInstancede.familyDataMgr;letfamily=fMgr.allRecommendMap.getdide;ifdfamily==nullereturnnull;this.id=family.id;this.icon=family.iconId;this.iconBg=family.iconBg;this.familyName=family.name;this.needCups=family.needCups;this.desc=family.desc;this.zhanli=family.zhanli;this.cups=family.cups;this.local=family.local;this.hasApplyId=fMgr.AddAttrListenerd"applyList",this.RefreshApply,thise;returnthis;}publicPackSearchDatadid:string,cfg?:IFamilyInfoDatae{letfMgr=MainDataMgr.GetInstancede.familyDataMgr;letfamily=fMgr.searchMap.getdide;ifdfamily==nullereturnnull;this.id=family.id;this.icon=family.iconId;this.iconBg=family.iconBg;this.familyName=family.name;this.needCups=family.needCups;this.desc=family.desc;this.zhanli=family.zhanli;this.cups=family.cups;this.local=family.local;this.hasApplyId=fMgr.AddAttrListenerd"applyList",this.RefreshApply,thise;returnthis;}privateRefreshApplydhasApply:booleane{this.SetAttrd"hasApply",hasApplye;}publicDestroyde{letfMgr=MainDataMgr.GetInstancede.familyDataMgr;fMgr.RemoveOnePropCBd"applyList",this.hasApplyIde;}}c***查看家族信息*cexportclassFamilyInfoPanelextendsUIComponentBase{privatecomWin:CommonWin;privatejoinBtn:SButton;privatelist:eui.List;privatefName:eui.Label;privatedesc:eui.Label;privatezhanli:eui.Label;privatememberNum:eui.Label;privatecups:eui.Label;privatelocal:eui.Label;privatefamilyIcon:FamilyIcon;privateneedCups:eui.Label;privatebg:eui.Rect;publicinfo:FamilyInfoDataItem;privateupdateList:eui.ArrayCollection;publicconstructorde{superd"FamilyInfoPanelSkin"e;}publicInitDataddata:FamilyInfoDataIteme{this.comWin.Initd"家族信息",this.OnCloseDlg,thise;ifddata==nullereturn;this.info=data;this.needCups.text=`d需要奖杯：${data.needCups}e`;this.fName.text=data.familyName;this.desc.text=data.desc;this.zhanli.text=`${data.zhanli}`;this.cups.text=`${data.cups}`;this.local.textFlow=dnewegret.HtmlTextParserdee.parserd`地区：afontcolor="0xad5907"fontFamily="main_font"b${MainDataMgr.GetInstancede.GetLocalNameddata.locale}acfontb`e;this.familyIcon.data=dnewFamilyIconDatae.PackDataddata.icon,data.iconBge;ccthis.memberNum.textFlow=dnewegret.HtmlTextParserdee.parserd`成员：afontcolor="0xad5907"fontFamily="main_font"b${fData.allMemberMap.keysde.length}c${fData.mMaxNum}acfontb`e;this.list.itemRenderer=FamilyInfoItem;this.updateList=neweui.ArrayCollection;this.list.dataProvider=this.updateList;this.AddPropCBddata,"membersArray",this.RefreshListDatae;this.AddPropCBddata,"hasApply",this.OnApplyStatee;this.AddTouchEventdthis.joinBtn,this.OnJoinTap,thise;this.AddTouchEventdthis.bg,this.OnCloseDlg,thise;this.list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;}protectedDestroyde{this.comWin.Destroyde;RenderUtils.RemoveUpdateListdthis.updateListe;RenderUtils.RemoveListdthis.liste;this.info.Destroyde;this.list.removeEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;}privateOnApplyStatede{letfDataMgr=MainDataMgr.GetInstancede.familyDataMgr;ifdfDataMgr.HasApplydthis.info.ide==falsee{this.joinBtn.currentState=`canJoin`;}else{this.joinBtn.currentState=`hasJoin`;}}privateRefreshListDatade:any{ccRenderUtils.RemoveUpdateListdthis.updateListe;ccletfData:FamilyDataItem=MainDataMgr.GetInstancede.familyDataMgr.GetFamilyByTypedthis.info.type,this.info.ide;ccifdfData==nulleccreturn;cclettarArr=[];ccletlist=fData.allMemberMap.valuesde;ccfordleti=0,len=list.length;ialen;i++ecc{ccletdata=list[i]asMemberDataItem;ccletitem=newFamilyInfoDataItem2;ccitem.PackDatadthis.info.id,data.id,this.info.typee;cctarArr.pushditeme;cc}ccthis.updateList.replaceAlldtarArre;}cc----------------------------------------------------------------------EventprivateOnJoinTapde:egret.TouchEvente{letresult=game.MainDataMgr.GetInstancede.familyDataMgr.CheckCanApplydthis.info.ide;TipsManager.ShowTipsdresult[1]e;ifdresult[0]==truee{ClientNet.NetFamily.C2SJoinFamilydthis.info.ide;}}privateOnItemTapde:eui.ItemTapEvente{ccletitem=newFamilyMemberPanelDataItem;ccitem.familyId=this.info.id;ccitem.id=e.item.id;}}}modulegame{exportclassFamilyInfoPanelCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnFamilyInfoPanel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,true,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}modulegame{exportclassFamilyNoneMainPanelextendsUIComponentBase{privatemainBg:MainPanelBg;publicconstructorde{superd"FamilyNoneMainPanelSkin"e;}publicDestroyde{this.mainBg.Destroyde;}publicInitDatade{letinfo=dnewMainPanelBgDatadee.PackData1d"button_return_jz",this.OnCloseTap,thise;this.mainBg.Initdinfoe;lettab1Info=dnewMainPanelBgTabDatadee.PackDatad1,TabItem1,FamilyRecommendPanele;lettab2Info=dnewMainPanelBgTabDatadee.PackDatad2,TabItem1,FamilyCreatePanele;lettjBtn=this.mainBg.AddTabdtab1InfoeasTabItem1;letcjBtn=this.mainBg.AddTabdtab2InfoeasTabItem1;tjBtn.Initd"button_jz_tjjz_0","button_jz_tjjz"e;cjBtn.Initd"button_jz_cjjz_0","button_jz_cjjz"e;this.mainBg.SetTabIndexd1e;}privateOnCloseTapde:egret.TouchEvente{UIManager.HidePaneldPanelTypeConst.FamilyNoneMainPanele;}}}modulegame{exportclassFamilyNoneMainPanelCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnFamilyNoneMainPanel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,truee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿modulegame{exportclassFamilyRecommendDataItem{publicid:string;publictype:number;cc1推荐列表2搜索列表publicDestroyde{}publicPackDatadid:string,type:numbere{this.id=id;this.type=type;returnthis;}}exportclassFamilyRecommendItemextendsItemRenderBase{privateroot:eui.Group;privatefName:eui.Label;privatelocal:eui.Label;privatememberNum:eui.Label;privatecups:eui.Label;privatezhanli:eui.Label;privatefamilyIcon:FamilyIcon;privateinfo:FamilyRecommendDataItem;publicconstructorde{superd"FamilyRecommendItemSkin"e;}publicdataChangedde{ifdthis.data==nullereturn;this.info=this.data;letfData:FamilyDataItem=MainDataMgr.GetInstancede.familyDataMgr.GetFamilyByTypedthis.info.type,this.info.ide;ifdfData==nullereturn;this.fName.text=fData.name;this.local.text=`需要奖杯：${fData.needCups}`;this.memberNum.text=LanUtil.GetFormatd`成员:{0}c{1}`,fData.allMemberMap.keysde.length,fData.mMaxNume;this.cups.text=LanUtil.GetFormatd`{0}`,fData.cupse;this.zhanli.text=LanUtil.GetFormatd`{0}`,fData.zhanlie;this.familyIcon.data=dnewFamilyIconDatae.PackDatadfData.iconId,fData.iconBge;}protectedDestroyde{ifdthis.info!=nullethis.info.Destroyde;}}}﻿modulegame{exportclassFamilyRecommendPanelextendsUIComponentBase{privatesechInput:SInputLabel;privatelist:eui.List;privatenoListTips:eui.Label;privatesarchBtn:SButton;privateclearBtn:SButton;privateupdateList:eui.ArrayCollection;publicconstructorde{superd"FamilyRecommendPanelSkin"e;}publicInitDatade{this.list.itemRenderer=FamilyRecommendItem;this.updateList=neweui.ArrayCollectionde;this.list.dataProvider=this.updateList;letfMgr=MainDataMgr.GetInstancede.familyDataMgr;this.AddPropCB_NotCalldfMgr,fMgr.allRecommendMapName,this.OnUpdateRecommendList,FamilyListType.Recommende;this.AddPropCB_NotCalldfMgr,fMgr.searchMapName,this.OnUpdateRecommendList,FamilyListType.Searche;this.ShowInputViewde;this.sechInput.addEventListenerdegret.Event.CHANGE,this.OnInputChange,thise;this.list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;this.AddTouchEventdthis.sarchBtn,this.OnSearchTap,thise;this.AddTouchEventdthis.clearBtn,this.OnClearTap,thise;ClientNet.NetFamily.C2SRecommendFamilyde;}protectedDestroyde{RenderUtils.RemoveUpdateListdthis.updateListe;RenderUtils.RemoveListdthis.liste;this.sechInput.Destroyde;this.list.removeEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;this.sechInput.removeEventListenerdegret.Event.CHANGE,this.OnInputChange,thise;}publicShowde{this.OnUpdateRecommendListdFamilyListType.Recommende;this.sechInput.text="";this.clearBtn.visible=false;}publicHidede{}privateShowInputViewde{lettext=this.sechInput.text;ifdtext.trimde.lengtha=0e{this.clearBtn.visible=false;}else{this.clearBtn.visible=true;}}privateOnClearTapde:egret.TouchEvente{this.sechInput.text="";this.ShowInputViewde;this.OnUpdateRecommendListdFamilyListType.Recommende;}privateOnSearchTapde:egret.TouchEvente{lettext=this.sechInput.text;ifdtext.trimde.lengtha=0ereturnTipsManager.ShowTipsd"请输入家族名称后再搜索！"e;ClientNet.NetFamily.C2SSearchFamilydtexte;}privateOnInputChangede{this.ShowInputViewde;}privateOnUpdateRecommendListdtype:numbere{RenderUtils.RemoveUpdateListdthis.updateListe;lettarArr=this.ComposeListDatadtypee;ifdtarArr.lengthb0e{this.updateList.replaceAlldtarArre;this.list.visible=true;this.noListTips.text="";}else{this.list.visible=false;this.noListTips.text=LanUtil.GetFormatd`很抱歉，当前没有符合的家族，你可以创建属于自己的家族`e;}}cc----------------------------------------------------------------------EventprivateOnItemTapde:eui.ItemTapEvente{ifde.item!=null&&e.item.id!=nulle{letdata=e.itemasFamilyRecommendDataItemletinfo:FamilyInfoDataItem;ifddata.type==FamilyListType.Recommendeinfo=dnewFamilyInfoDataIteme.PackRecommondDataddata.ide;elseifddata.type==FamilyListType.Searcheinfo=dnewFamilyInfoDataIteme.PackSearchDataddata.ide;elsereturn;UIManager.ShowPaneldPanelTypeConst.FamilyInfoPanel,infoe;}}cc----------------------------------------------------------------------ToolsprivateComposeListDatadtype:numbere{letlist;ifdtype==FamilyListType.Recommendelist=MainDataMgr.GetInstancede.familyDataMgr.SortRecommendListde;elseifdtype==FamilyListType.Searchelist=MainDataMgr.GetInstancede.familyDataMgr.SortSearchListde;ifdlist==nullereturn[];lettarArr=[];fordleti=0,len=list.length;ialen;i++e{letdata=list[i];letitem=newFamilyRecommendDataItem;item.PackDataddata.id,typee;tarArr.pushditeme;}returntarArr;}}}modulegame{exportclassFamilySettingPanelextendsUIComponentBase{privatecomWin:CommonWin;privatefamilyIcon:FamilyIcon;privatedescInput:eui.TextInput;privateautoJoin:eui.CheckBox;privatemenuBtn:FamilyDrowMenu;privatelist:eui.List;privatelist1:eui.List;privatesaveBtn:SButton;privategroup1:eui.Group;privategroup2:eui.Group;privateokBtn:SButton;publicinfo:FamilySettingData;privateupdateList:eui.ArrayCollection;privateupdateList1:eui.ArrayCollection;publicconstructorde{superd"FamilySettingPanelSkin"e;}publicInitDatade{this.comWin.Initd"家族设置",this.OnCloseDlg,thise;this.info=newFamilySettingDatade;this.info.Initde;letinfo=dnewFamilyDrowMenuDatae.PackDatadthis.OnChangeCups,this,this.info.needCupse;this.menuBtn.Initdinfoe;this.list.itemRenderer=FamilyIcon;this.updateList=neweui.ArrayCollectionde;this.list.dataProvider=this.updateList;this.list1.itemRenderer=FamilyIcon;this.updateList1=neweui.ArrayCollectionde;this.list1.dataProvider=this.updateList1;this.familyIcon.data=dnewFamilyIconDatae.PackDatadthis.info.icon,this.info.iconBge;this.UpdateListde;this.UpdateList1de;this.descInput.text=this.info.desc;this.autoJoin.selected=this.info.isAuto;this.descInput.addEventListenerdegret.Event.CHANGE,this.OnDescInputChange,thise;this.AddTouchEventdthis.autoJoin,this.OnAutoJoinTap,thise;this.AddTouchEventdthis.saveBtn,this.OnSaveBtn,thise;this.AddTouchEventdthis.okBtn,this.OnOkBtn,thise;this.list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;this.list1.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap1,thise;}publicDestroyde{this.comWin.Destroyde;this.familyIcon.Destroyde;this.menuBtn.Destroyde;RenderUtils.RemoveUpdateListdthis.updateListe;RenderUtils.RemoveUpdateListdthis.updateList1e;RenderUtils.RemoveListdthis.liste;RenderUtils.RemoveListdthis.list1e;this.descInput.removeEventListenerdegret.Event.CHANGE,this.OnDescInputChange,thise;this.list.removeEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;this.list1.removeEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap1,thise;}privateShowGroupViewdflag:booleane{this.group1.visible=flag;this.group2.visible=!flag;}cc----------------------------------------------------------------------EventprivateOnItemTapde:eui.ItemTapEvente{lettarget=e.itemRendererasFamilyIcon;letnewIcon=target.info.icon;letitem:FamilyIconData;fordleti=0,len=this.updateList.length;ialen;i++e{item=this.updateList.getItemAtdie;ifditem.icon==this.info.icone{item.SetAttrd"isSel",falsee;}ifditem.icon==newIcone{item.SetAttrd"isSel",truee;}}this.familyIcon.info.SetAttrd"icon",newIcone;this.info.icon=newIcon;}privateOnItemTap1de:eui.ItemTapEvente{lettarget=e.itemRendererasFamilyIcon;letnewIconBg=target.info.iconBg;letitem:FamilyIconData;fordleti=0,len=this.updateList1.length;ialen;i++e{item=this.updateList1.getItemAtdie;{ifditem.iconBg==this.info.iconBge{item.SetAttrd"isSel",falsee;}ifditem.iconBg==newIconBge{item.SetAttrd"isSel",truee;}}}this.familyIcon.info.SetAttrd"iconBg",newIconBge;this.info.iconBg=newIconBg;}privateOnChangeCupsdcups:numbere{this.info.needCups=cups;}privateOnDescInputChangede:egret.Evente{this.descInput.text=Utils.GetTextByBytedthis.descInput.text,100e;this.info.desc=this.descInput.text;}privateOnAutoJoinTapde:egret.TouchEvente{this.info.isAuto=!this.autoJoin.selected;}privateOnSaveBtnde{ClientNet.NetFamily.C2SSettingdthis.info.icon,this.info.iconBg,this.info.desc,this.info.isAuto,this.info.needCupse;this.OnCloseDlgde;}privateOnOkBtnde{this.ShowGroupViewdfalsee;}cc----------------------------------------------------------------------ToolprivateUpdateListde{leticonArray=MainDataMgr.GetInstancede.familyDataMgr.GetIconIdArrayde;ifdiconArray==nullereturn;RenderUtils.RemoveUpdateListdthis.updateListe;lettarArray:FamilyIconData[]=[];letitem:FamilyIconData;fordleti=0,len=iconArray.length;ialen;i++e{item=newFamilyIconDatade;leticon=iconArray[i];leticonBg=null;letisSelect=icon==this.info.icon;letisLock=false;item.PackDatadicon,iconBg,isSelect,isLocke;tarArray.pushditeme;}this.updateList.replaceAlldtarArraye;}privateUpdateList1de{leticonArray=MainDataMgr.GetInstancede.familyDataMgr.GetIconBgIdArrayde;ifdiconArray==nullereturn;RenderUtils.RemoveUpdateListdthis.updateList1e;lettarArray:FamilyIconData[]=[];letitem:FamilyIconData;fordleti=0,len=iconArray.length;ialen;i++e{item=newFamilyIconDatade;leticon=null;leticonBg=iconArray[i];letisSelect=iconBg==this.info.iconBg;letisLock=false;item.PackDatadicon,iconBg,isSelect,isLocke;tarArray.pushditeme;}this.updateList1.replaceAlldtarArraye;}}}modulegame{exportclassFamilySettingPanelCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnFamilySettingPanel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,falsee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿modulegame{exportclassFamilyShopBuyPanel1DataextendsDataBase{publicitemId:number;publicdesc:string;publicDestroyde{}publicPackDataditemId:numbere{this.itemId=itemId;returnthis;}}exportclassFamilyShopBuyPanel1extendsUIComponentBase{privatecommWin:CommonWin;privatebuyBtn:SButton;privateshopIcon:FamilyShopItemIcon;privatehasBuy:eui.Label;privatelimitBuy:eui.Label;privatedesc:eui.Label;privatetips:eui.Label;privateprogLb:eui.BitmapLabel;privateprog:eui.ProgressBar;publicinfo:FamilyShopBuyPanel1Data;publicconstructorde{superd"FamilyShopBuyPanel1Skin"e;}publicInitDataddata:FamilyShopBuyPanel1Datae{this.commWin.Initd"确认购买",this.OnCloseDlg,thise;ifddata==nullereturn;this.info=data;this.AddTouchEventdthis.buyBtn,this.OnBuyTap,thise;}protectedDestroyde{ifdthis.info!=nullethis.info.Destroyde;}cc----------------------------------------------------------------------EventprivateOnBuyTapde:egret.TouchEvente{letinfo=dnewFamilyShopBuyPanel3Datae.PackDatadthis.info.itemIde;UIManager.ShowPaneldPanelTypeConst.FamilyShopBuyPanel3,infoe;}}}﻿modulegame{exportclassFamilyShopBuyPanel1CextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnFamilyShopBuyPanel1;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,false,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿modulegame{exportclassFamilyShopBuyPanel3DataextendsDataBase{publicitemId:number;publicdesc:string;publicDestroyde{}publicPackDataditemId:numbere{this.itemId=itemId;returnthis;}}exportclassFamilyShopBuyPanel3extendsUIComponentBase{privatecommWin:CommonWin;publicinfo:FamilyShopBuyPanel3Data;publicconstructorde{superd"FamilyShopBuyPanel3Skin"e;}publicInitDataddata:FamilyShopBuyPanel3Datae{this.commWin.Initd"",this.OnCloseDlg,thise;ifddata==nullereturn;this.info=data;}protectedDestroyde{ifdthis.info!=nullethis.info.Destroyde;}}}﻿modulegame{exportclassFamilyShopBuyPanel3CextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnFamilyShopBuyPanel3;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,false,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿modulegame{exportclassFamilyShopItemData{publicitemId:number;publicinfo:GoodsDataItem;publicDestroyde{}publicPackDataditemId:numbere{this.itemId=itemId;this.info=MainDataMgr.GetInstancede.shopDataMgr.GetItemditemIde;returnthis;}}exportclassFamilyShopItemextendsItemRenderBase{privatetitle:eui.Label;privateiconImg:FamilyShopItemIcon;privatepriceLb:PriceLabel;privatetestId:eui.Label;privatezhekou:ZheKou;info:FamilyShopItemData;publicconstructorde{superd"FamilyShopItemSkin"e;this.touchChildren=false;}protectedDestroyde{}publicdataChangedde{ifdthis.data==nullereturn;this.info=this.data;this.title.name=this.info.info.name;this.testId.text=Stringdthis.info.itemIde;this.testId.visible=GameData.DevelopMode==DevelopMode.Debug;this.iconImg.Destroyde;letinfo=dnewFamilyShopItemIconDatae.PackDatadthis.info.info.itemType,this.info.info.showIcone;this.iconImg.UpdateViewdinfoe;letinfo2=dnewPriceLabelDatae.PackType1dthis.info.info.costType,this.info.info.price,this.info.info.salePricee;this.priceLb.UpdateViewdinfo2e;letinfo3=dnewZheKouDatae.PackDatadthis.info.info.limitTypee;this.zhekou.UpdateViewdinfo3e;}}}modulegame{exportclassFamilyShopItemIconDataextendsDataBase{publictype:number;publicshowIcon:string;publicPackDatadtype:number,showIcon:string,e{this.type=type;this.showIcon=showIcon;returnthis;}publicGetStatede{}}exportclassFamilyShopItemIconextendseui.Component{publicshowIcon:eui.Image;publicinfo:FamilyShopItemIconData;publicconstructorde{superde;this.skinName="FamilyShopItemIconSkin";}publicDestroyde{ifdthis.info!=nullethis.info.Destroyde;}publicUpdateViewdinfo:FamilyShopItemIconDatae{this.info=info;this.info;this.validateNowde;this.showIcon.source=info.showIcon;}}}﻿modulegame{exportclassFamilyShopPanelextendsUIComponentBase{privatelist:eui.List;publicupdateList:eui.ArrayCollection;publicconstructorde{superd"FamilyShopPanelSkin"e;}cc当页面切换到此界面时会被调用publicInitDatade{this.updateList=neweui.ArrayCollectionde;this.list.itemRenderer=FamilyShopItem;this.list.dataProvider=this.updateList;ccthis.AddPropCBdMainDataMgr.GetInstancede.familyDataMgr,"allItemsArray",e;this.OnShopUpdateListde;this.list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;}publicDestroyde{RenderUtils.RemoveUpdateListdthis.updateListe;RenderUtils.RemoveListdthis.liste;this.list.removeEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;}privateOnItemTapde:eui.ItemTapEvente{ifdegret.isde.itemRenderer,"game.FamilyShopItem"e==truee{letdata=e.itemasFamilyShopItemData;letinfo=dnewFamilyShopBuyPanel1Datae.PackDataddata.itemIde;UIManager.ShowPaneldPanelTypeConst.FamilyShopBuyPanel1,infoe;}}privateOnShopUpdateListd...param:any[]e{ifdparam==null||param.lengtha=0e{RenderUtils.RemoveUpdateListdthis.updateListe;letlist=MainDataMgr.GetInstancede.shopDataMgr.GetGoodsArraydShopType.FamilyZBGe;letitem:FamilyShopItemData;fordleti=0,len=list.length;ialen;i++e{item=newFamilyShopItemDatade;item.PackDatadlist[i]e;this.updateList.addItemditeme;}}}}}modulegame{exportclassPriceLabelData{publiccurrState:string;publicpriceType:number;publicp1:number;publicp2:number;publicPackType1dpriceType:number,salePrice:number,zhekouPrice:numbere{this.priceType=priceType;this.p1=salePrice;this.p2=zhekouPrice;this.currState="type1";returnthis;}publicDestroyde{}}exportclassPriceLabelextendseui.Component{privateicon:eui.Image;privatep1:eui.Label;privatep2:eui.Label;publicinfo:PriceLabelData;publicconstructorde{superde;this.skinName="PriceLabelSkin";}publicDestroyde{ifdthis.info!=nullethis.info.Destroyde;}publicUpdateViewdinfo:PriceLabelDatae{ifdinfo==nullereturn;this.info=info;this.currentState=this.info.currState;this.validateNowde;this.p1.text=`${this.info.p1}`;this.p2.text=`${this.info.p2}`;}}}modulegame{exportclassZheKouData{publictype:number;publicPackDatadtype:numbere{this.type=type;returnthis;}publicDestroyde{}}exportclassZheKouextendseui.Component{publicinfo:ZheKouData;publicconstructorde{superde;this.skinName="ZheKouSkin";}publicDestroyde{ifdthis.info!=nullethis.info.Destroyde;}publicUpdateViewdinfo:ZheKouDatae{ifdinfo==nullereturn;this.info=info;this.currentState=`type${info.type}`;}}}modulegame{exportclassHeroKaDataextendsDataBase{publicheroId:number;publiclevel:number;publicDestroyde{}publicPackDatadheroId:number,level:numbere{this.heroId=heroId;this.level=level;returnthis;}}exportclassHeroKaextendsItemRenderBase{privatebg:eui.Image;privateheroIcon:eui.Image;privatetypeIcon:eui.Image;privatecampBg:eui.Image;privatelevel:HeroLevel;privatecost:eui.BitmapLabel;privatetestId:eui.Label;privateupTips:eui.Image;publicinfo:HeroKaData;publicconstructorde{superd"HeroKa1Skin"e;this.Initde;}publicInitde{}publicDestroyde{ifdthis.info!=nullethis.info.Destroyde;this.level.Destroyde;}publicdataChangedde{ifdthis.data==nullereturn;this.info=this.data;this.RemoveAllCBde;this.AddPropCBdthis.info,"level",this.OnUpdateLevele;this.UpdateStaticViewde;}privateUpdateStaticViewde{letheroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetCfgdthis.info.heroIde;ifdheroInfo==nullereturn;this.bg.source=`bg_card_di_${heroInfo.quality}`;this.cost.text=StringdheroInfo.coste;this.testId.text=Stringdthis.info.heroIde;this.testId.visible=GameData.DevelopMode==DevelopMode.Debug;ifdheroInfo.camp!=0e{this.typeIcon.visible=this.campBg.visible=true;this.typeIcon.source=`home_ui_kz_json.icon_sl_0${heroInfo.camp}_s`;}else{this.campBg.visible=false;this.typeIcon.visible=false;}ifdRES.hasResd`common_ui_heroicon_json.${this.info.heroId}`e==trueethis.heroIcon.source=`common_ui_heroicon_json.${this.info.heroId}`;elsethis.heroIcon.source="";}privateOnUpdateLevelde{letheroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetCfgdthis.info.heroIde;ifdheroInfo==nullereturn;this.level.SetLvdthis.info.level,heroInfo.qualitye;}}}﻿modulegame{exportclassFriendChatItemData{publicfromId:number;publictoId:number;publicindex:number;publicimageId:number;publictime:number;publicconstructorde{}}exportclassFriendChatTimeItemextendsItemRenderBase{publictext:eui.Label;publicconstructorde{superd"FriendChatTimeItemSkin"e;}publicdataChangedde{this.UpdateDatade;}privateUpdateDatade{letpassTime=HomeServerTime.GetPassTimedthis.data.timee;letlocalTime=dnewDatedee.getTimede-passTime;letdate=newDatedlocalTimee;letday:string|number=date.getDatede;ifddaya=9eday="0"+day;lethour:string|number=date.getHoursde;ifdhoura=9ehour="0"+hour;letminute:string|number=date.getMinutesde;ifdminutea=9eminute="0"+minute;letsecond:string|number=date.getSecondsde;ifdseconda=9esecond="0"+second;this.text.text=`${date.getFullYearde}c${date.getMonthde+1}c${day}${hour}:${minute}:${second}`;}protectedDestroyde{}}exportclassFriendChatTextItemextendsItemRenderBase{publiciconInfo:eui.Group;publicplayerIcon:eui.Image;publictext:eui.Label;publicbg:eui.Image;publicconstructorde{superd"FriendChatTextItemSkin"e;}privateisCreated:boolean=false;protectedchildrenCreatedde{super.childrenCreatedde;this.isCreated=true;ifdthis.data!=nulle{this.UpdateViewdthis.datae;}};dataChangedde{this.UpdateViewdthis.datae;}privateUpdateViewddata:FriendChatItemDatae{ifd!this.isCreatedereturn;this.UpdateDatade;}privateUpdateDatade{letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;letplayerObj=friendDataMgr.GetFrienddthis.data.fromIde;ifdplayerObj==nulleplayerObj=friendDataMgr.GetFrienddthis.data.toIde;ifdplayerObj==nullereturn;ifdthis.data.index!=null&&this.data.indexb=playerObj.chatList.lengthereturn;letmyRoleId=MainDataMgr.GetInstancede.roleId;letchatItemData=playerObj.chatList[this.data.index];this.playerIcon.source=RES.getResd`common_ui_playericon_json.${playerObj.icon}`e;this.text.text=chatItemData.text;this.text.width=710;ifdthis.data.fromId==myRoleIde{this.iconInfo.x=780;ifdthis.text.textWidthb=710e{this.bg.height=120;}else{this.bg.height=60;}this.bg.width=this.text.textWidth+40;this.bg.x=880-110-this.bg.width;this.text.x=this.bg.x+20;}else{this.iconInfo.x=0;ifdthis.text.textWidthb=710e{this.bg.height=120;}else{this.bg.height=60;}this.bg.width=this.text.textWidth+40;this.bg.x=110;this.text.x=this.bg.x+20;}}privateOnBtnClickedde{}protectedDestroyde{}}exportclassFriendChatImgItemextendsItemRenderBase{publiciconInfo:eui.Group;publicplayerIcon:eui.Image;publicani:eui.Image;publicbg:eui.Image;publicconstructorde{superd"FriendChatImgItemSkin"e;}privateisCreated:boolean=false;protectedchildrenCreatedde{super.childrenCreatedde;this.isCreated=true;ifdthis.data!=nulle{this.UpdateViewdthis.datae;}};dataChangedde{this.UpdateViewdthis.datae;}privateUpdateViewddata:FriendChatItemDatae{ifd!this.isCreatedereturn;this.UpdateDatade;}privateUpdateDatade{letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;letplayerObj=friendDataMgr.GetFrienddthis.data.fromIde;ifdplayerObj==nulleplayerObj=friendDataMgr.GetFrienddthis.data.toIde;ifdplayerObj==nullereturn;ifdthis.data.index!=null&&this.data.indexb=playerObj.chatList.lengthereturn;letmyRoleId=MainDataMgr.GetInstancede.roleId;letchatItemData=playerObj.chatList[this.data.index];this.playerIcon.source=RES.getResd`common_ui_playericon_json.${playerObj.icon}`e;ifdthis.data.fromId==myRoleIde{this.iconInfo.x=780;this.bg.x=880-110-this.bg.width;this.ani.x=this.bg.x+35;}else{this.iconInfo.x=0;this.bg.x=110;this.ani.x=this.bg.x+35;}}privateOnBtnClickedde{}protectedDestroyde{}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassFriendInfoCextendsUICtrlBase{publicconstructorde{superde;}cc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnFriendInfoPanel;}cc做一下类型转换方便调用一定要有!!!protectedgettestPanelde{returnaFriendInfoPanelbthis.panel;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0e;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}c***初始化面板数据*cpublicInitDatade:void{}}}﻿c****cmodulegame{exportclassFriendInfoPanelextendsUIComponentBase{publicconstructorde{superd"FriendInfoSkin"e;}publicroot:eui.Group;publiccloseBtn:SButton;publiccountBar:eui.ProgressBar;publicgame_list_scroller_left:eui.Scroller;publicgame_list_left:eui.List;publicgame_list_scroller_right:eui.Scroller;publicgame_list_right:SEuiList;publicgame_list_scroller_right_copy:eui.Scroller;publicgame_list_right_copy:SEuiList;publicinviteBtn:SButton;publicbottomRedDot:eui.Image;publicinput:SInputLabel;publicsendBtn:SButton;publicdeleteBtn:SButton;privateleftDataList:FriendLeftItemData[];privaterightDataList:FriendChatItemData[];privateselectedPlayerItemData:PlayerDataItem;protectedchildrenCreatedde{super.childrenCreatedde;this.input.SetDefaultTextdLanUtil.GetTextd"输入信息最长50个字"ee;this.input.maxChars=50;this.InitCBde;this.InitRedDotde;}privateInitCBde{letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;this.AddPropCB_NotCalldfriendDataMgr,"friendItemArray",this.RefreshFriendListe;friendDataMgr.RefreshFriendItemArrayde;cc重新排序下this.closeBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseBtnClicked,thise;this.inviteBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnInviteBtnClicked,thise;this.sendBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnSendBtnClicked,thise;this.deleteBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnDeleteBtnClicked,thise;GlobalEvent.SubscribedGlobalEventType.FriendLeftItemClicked,this.OnLeftItemClicked,thise;}protectedDestroyde{this.selectedPlayerItemData=null;GlobalEvent.UnSubscribedGlobalEventType.FriendLeftItemClicked,this.OnLeftItemClicked,thise;this.DestroyLeftListde;this.DestroyRightListde;this.closeBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseBtnClicked,thise;this.inviteBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnInviteBtnClicked,thise;this.sendBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnSendBtnClicked,thise;this.deleteBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnDeleteBtnClicked,thise;}privateInitRedDotde{letredDotObj=RedDotMgr.GetInstancede.GetReddotd"friend_invite"e;ifdredDotObj==nulle{game.errord"reddothasnokey:friend_invite"e;return;}this.AddPropCBdredDotObj,"state",de=b{this.bottomRedDot.visible=redDotObj.GetStatede==1;}e;}privateRefreshLeftListde{this.DestroyRightListde;this.DestroyLeftListde;letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;letcellData:FriendLeftItemData=null;letindex=0;fordletplayerObjoffriendDataMgr.friendItemArraye{cellData=newFriendLeftItemDatade;cellData.index=index;cellData.id=playerObj.id;this.leftDataList.pushdcellDatae;ifdindex==0ethis.OnLeftItemClickeddplayerObj.ide;index++;}this.game_list_left.itemRenderer=FriendLeftItem;this.game_list_left.dataProvider=neweui.ArrayCollectiondthis.leftDataListe;this.game_list_left.updateRenderer=this.LeftUpdateRender.binddthise;}c***List更新数据时调用*cprivateLeftUpdateRenderdrenderer:eui.IItemRenderer,itemIndex:number,data:anye:eui.IItemRenderer{ccgame.logditemIndex,"--------LeftUpdateRender----------",renderer.hashCodee;renderer.data=data;returnrenderer;}privateOnLeftItemClickeddid:numbere{fordletdataofthis.leftDataListe{data.selected=data.id==id;}this.ChangeSelectPlayerdide;fordleti=0;iathis.game_list_left.numChildren;i++e{letgameCellView=this.game_list_left.getChildAtdieasFriendLeftItem;gameCellView.OnSelecteddgameCellView.data.selectede;}}privateChangeSelectPlayerdid:numbere{ifdthis.selectedPlayerItemData!=nulle{this.RemovePropCBdthis.selectedPlayerItemDatae;}letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;this.selectedPlayerItemData=friendDataMgr.GetFrienddide;ifdthis.selectedPlayerItemData!=nulle{this.selectedPlayerItemData.hasUnReadMsg=false;this.AddPropCBdthis.selectedPlayerItemData,"chatList",this.RefreshRightListe;}RedDotMgr.GetInstancede.SetStated`friend_left_item_${id}`,0e;ClientNet.NetFriend.C2SReadFriendChatdide;}privateCreateRightListde{this.rightDataList=[];ifdthis.game_list_scroller_right_copy!=nulle{fordleti=0;iathis.game_list_right_copy.numChildren;i++e{letgameCellView=this.game_list_right_copy.getChildAtdieasItemRenderBase;gameCellView.DestroyAllde;}RenderUtils.RemoveFromParentdthis.game_list_right_copye;this.game_list_scroller_right_copy.viewport=null;RenderUtils.RemoveFromParentdthis.game_list_scroller_right_copye;}letlist=this.game_list_right;letlist_copy=this.game_list_right_copy=newSEuiListde;list_copy.x=list.x;list_copy.y=list.y;list_copy.width=list.width;list_copy.height=list.height;letscroller=this.game_list_scroller_right;letscroller_copy=this.game_list_scroller_right_copy=neweui.Scrollerde;this.root.addChilddscroller_copye;scroller_copy.x=scroller.x;scroller_copy.y=scroller.y;scroller_copy.width=scroller.width;scroller_copy.height=scroller.height;scroller_copy.addChilddlist_copye;scroller_copy.viewport=list_copy;ccthis.deleteBtn.zIndex=1000;this.root.setChildIndexdthis.deleteBtn,1000e;ccRenderUtils.RemoveFromParentdthis.deleteBtne;ccthis.root.addChilddthis.deleteBtne;}privateRefreshRightListde{cclett1=egret.getTimerde;this.CreateRightListde;letcellData:FriendChatItemData=null;letindex=-1;letheight=0;lettodayFirstChatIndex=this.selectedPlayerItemData.todayFirstChatIndex;fordletchatItemDataofthis.selectedPlayerItemData.chatListe{index++;ifdindex==todayFirstChatIndexecc今天第一条消息的时间戳{cellData=newFriendChatItemDatade;cellData.time=chatItemData.time;this.rightDataList.pushdcellDatae;height+=100;}cellData=newFriendChatItemDatade;cellData.fromId=chatItemData.fromId;cellData.toId=chatItemData.toId;cellData.index=index;cellData.imageId=chatItemData.imageId;this.rightDataList.pushdcellDatae;ifdcellData.imageId!=0eheight+=150;elseheight+=100;}this.game_list_right_copy.itemRendererFunction=ditem:FriendChatItemDatae:any=b{ifditem.time!=nullereturnFriendChatTimeItem;elseifditem.imageId==0ereturnFriendChatTextItem;elsereturnFriendChatImgItem;};this.game_list_right_copy.dataProvider=neweui.ArrayCollectiondthis.rightDataListe;this.game_list_right_copy.contentHeight=height;this.game_list_right_copy.contentWidth=this.game_list_right_copy.width;this.game_list_right_copy.measuredHeight=height;this.game_list_right_copy.measuredWidth=this.game_list_right_copy.width;this.game_list_scroller_right_copy.validateNowde;this.game_list_right_copy.scrollV=this.game_list_right_copy.contentHeight-this.game_list_right_copy.height;ifdheighta=this.game_list_scroller_right_copy.heightethis.game_list_scroller_right_copy.scrollPolicyV=eui.ScrollPolicy.OFF;elsethis.game_list_scroller_right_copy.scrollPolicyV=eui.ScrollPolicy.AUTO;ccletscrollV=0;ccwhiledtrueecc{ccthis.game_list_scroller_right.validateNowde;ccscrollV+=this.game_list_right.height;ccifdscrollVbthis.game_list_right.contentHeight-this.game_list_right.heightecc{ccscrollV=this.game_list_right.contentHeight-this.game_list_right.height;ccthis.game_list_right.scrollV=scrollV;ccbreak;cc}ccelseccthis.game_list_right.scrollV=scrollV;cc}cclett2=egret.getTimerde;ccgame.logd"-----------------timeCost:",t2-t1e;}privateRefreshFriendListde{letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;this.countBar.maximum=friendDataMgr.friendMaxCount;this.countBar.minimum=0;this.countBar.labelFunction=dvalue:number,maxValue:numbere=b{return`${value}c${maxValue}`};this.countBar.value=friendDataMgr.friendItemArray.length;this.deleteBtn.visible=friendDataMgr.friendItemArray.lengthb0;this.RefreshLeftListde;}privateOnCloseBtnClickedde{UIManager.HidePaneldPanelTypeConst.FriendInfoe;}privateOnInviteBtnClickedde{UIManager.ShowPaneldPanelTypeConst.FriendInvitede;}privateOnSendBtnClickedde{lettext=this.input.GetTextde;ifdtext==null||text==""ereturn;ClientNet.NetFriend.C2SFriendChatdthis.selectedPlayerItemData.id,texte;ccthis.input.Resetde;ccletchatItem=newChatDataItemde;ccchatItem.fromId=MainDataMgr.GetInstancede.roleId;ccchatItem.toId=this.selectedPlayerItemData.id;ccchatItem.time=HomeServerTime.GetServerTimede;ccchatItem.SetTextdtexte;ccthis.selectedPlayerItemData.AddChatdchatIteme;ccthis.selectedPlayerItemData.RefreshChatDatade;}privateOnDeleteBtnClickedde{letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;ifdthis.selectedPlayerItemData==nullereturn;letfriendObj=friendDataMgr.GetFrienddthis.selectedPlayerItemData.ide;ifdfriendObj==nullereturn;lettext=`afontcolor="0xffffff"b你确定要把acfontbafontcolor="0x00ff00"b${friendObj.name}acfontbafont="0xffffff"b从好友中删除吗?acfontb`letdata:CommonDlgData=newCommonDlgData;data.leftText=LanUtil.GetTextd"确定"e;data.rightText=LanUtil.GetTextd"取消"e;data.titleText=LanUtil.GetTextd"删除好友"e;data.content=text;data.thisObj=this;data.leftFunc=de=b{ClientNet.NetFriend.C2SDelFrienddfriendObj.ide;};data.rightFunc=de=b{};data.closeFunc=de=b{};UIManager.ShowPaneldPanelTypeConst.CommonDlg,datae;}privateDestroyLeftListde{this.leftDataList=[];fordleti=0;iathis.game_list_left.numChildren;i++e{letgameCellView=this.game_list_left.getChildAtdieasItemRenderBase;gameCellView.DestroyAllde;}}privateDestroyRightListde{this.rightDataList=[];ifdthis.game_list_right_copy==nullereturn;fordleti=0;iathis.game_list_right_copy.numChildren;i++e{letgameCellView=this.game_list_right_copy.getChildAtdieasItemRenderBase;gameCellView.DestroyAllde;}this.game_list_right_copy.removeChildrende;}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassFriendInviteCextendsUICtrlBase{publicconstructorde{superde;}cc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnFriendInvitePanel;}cc做一下类型转换方便调用一定要有!!!protectedgettestPanelde{returnaFriendInvitePanelbthis.panel;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0e;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}c***初始化面板数据*cpublicInitDatade:void{}}}﻿modulegame{exportclassFriendInviteItemData{publicid:number;publicindex:number;publicconstructorde{}}exportclassFriendInviteItemextendsItemRenderBase{publicplayerIcon:eui.Image;publicplayerName:eui.Label;publiclvLabel:eui.Label;publiccupCount:eui.BitmapLabel;publicokBtn:SButton;publiccancelBtn:SButton;publicstateLabel:eui.Label;privateplayerObj:PlayerDataItem;publicconstructorde{superd"FriendInviteItemSkin"e;}privateisCreated:boolean=false;protectedchildrenCreatedde{super.childrenCreatedde;this.isCreated=true;ifdthis.data!=nulle{this.UpdateViewdthis.datae;}this.okBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnOkClicked,thise;this.cancelBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCancelClicked,thise;};dataChangedde{this.UpdateViewdthis.datae;}privateUpdateViewddata:FriendLeftItemDatae{ifd!this.isCreatedereturn;this.UpdateDatade;}privateUpdateDatade{letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;ifdthis.data.index!=null&&this.data.indexb=friendDataMgr.invitedList.lengthereturn;letplayerObj:PlayerDataItem=friendDataMgr.invitedList[this.data.index];ifdplayerObj==nullereturn;this.playerIcon.source=RES.getResd`common_ui_playericon_json.${playerObj.icon}`e;this.playerName.text=playerObj.name;this.lvLabel.text=playerObj.lv.toStringde;this.cupCount.text=playerObj.cupCount.toStringde;this.playerObj=playerObj;}privateOnOkClickedde{letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;ifdthis.data.index!=null&&this.data.indexb=friendDataMgr.invitedList.lengthereturn;letplayerObj:PlayerDataItem=friendDataMgr.invitedList[this.data.index];ifdplayerObj==nullereturn;ifdfriendDataMgr.IsFriendFulldeeTipsManager.ShowTipsdLanUtil.GetTextd"您的好友人数已达上限！"ee;elseClientNet.NetFriend.C2SAcceptFrienddplayerObj.id,truee;}privateOnCancelClickedde{letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;ifdthis.data.index!=null&&this.data.indexb=friendDataMgr.invitedList.lengthereturn;letplayerObj:PlayerDataItem=friendDataMgr.invitedList[this.data.index];ifdplayerObj==nullereturn;ClientNet.NetFriend.C2SAcceptFrienddplayerObj.id,falsee;}protectedDestroyde{this.playerObj=null;this.okBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnOkClicked,thise;this.cancelBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCancelClicked,thise;}}}﻿c****cmodulegame{exportclassFriendInvitePanelextendsUIComponentBase{publicconstructorde{superd"FriendInviteSkin"e;}publicroot:eui.Group;publiccloseBtn:SButton;publicinviteBtn:SButton;publicinviteRedDot:eui.Image;publicrecommendBtn:SButton;publicfriendCount:eui.Label;publicrefreshBtn:SButton;publicgame_list_scroller:eui.Scroller;publicgame_list:eui.List;publicemptyTips:eui.Group;publicemptyLabel:eui.Label;privatetype:number=0;privateinviteDataList:FriendInviteItemData[];privaterecommendDataList:FriendRecommendItemData[];privatetimerKey:number=0;protectedchildrenCreatedde{super.childrenCreatedde;this.inviteDataList=[];this.recommendDataList=[];this.InitCBde;this.InitRedDotde;}privateInitCBde{letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;this.SetTyped1e;this.AddPropCBdfriendDataMgr,"friendItemArray",this.RefreshFriendCounte;this.AddPropCB_NotCalldfriendDataMgr,"invitedList",this.RefreshInivteListe;this.AddPropCB_NotCalldfriendDataMgr,"showRecommandList",this.RefreshRecommendListe;this.closeBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseBtnClicked,thise;this.inviteBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnInviteBtnClicked,thise;this.recommendBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRecommendBtnClicked,thise;this.refreshBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRefreshBtnClicked,thise;CdManager.Insde.UpdateCDdfriendDataMgr.refreshKey,this.refreshBtn,this,this.OnRefreshCountDowne;}privateInitRedDotde{letredDotObj=RedDotMgr.GetInstancede.GetReddotd"friend_invite"e;ifdredDotObj==nulle{game.errord"reddothasnokey:friend_invite"e;return;}this.AddPropCBdredDotObj,"state",de=b{this.inviteRedDot.visible=redDotObj.GetStatede==1;}e;}privateOnCloseBtnClickedde{UIManager.HidePaneldPanelTypeConst.FriendInvitede;}privateOnInviteBtnClickedde{this.SetTyped1e;}privateOnRecommendBtnClickedde{this.SetTyped2e;}privateOnRefreshBtnClickedde{letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;ifdCdManager.Insde.IsCdEnddfriendDataMgr.refreshKeye==truee{friendDataMgr.refreshKey=CdManager.Insde.AddCDdthis.refreshBtn,this,this.OnRefreshCountDown,100e;friendDataMgr.RefreshNextRecommandde;}else{TipsManager.ShowTipsdLanUtil.GetTextd"换一批还在冷却中请等待..."ee;}}cc换一批刷新倒计时privateOnRefreshCountDowndleftCd:numbere{ifdleftCdb0e{RenderUtils.SetGreydthis.refreshBtn,truee;this.refreshBtn.SetTextdLanUtil.GetFormatd`{0}秒`,leftCdee;}else{RenderUtils.SetGreydthis.refreshBtn,falsee;this.refreshBtn.SetTextdLanUtil.GetFormatd`换一批`ee;}}cctype1:邀请2：推荐privateSetTypedtype:numbere{ifdthis.type==typeereturn;this.type=type;this.refreshBtn.visible=type==2;ccthis.inviteRedDot.visible=type==1;RenderUtils.SetGreydthis.inviteBtn,type==2e;RenderUtils.SetGreydthis.recommendBtn,type==1e;ifdtype==1ethis.RefreshInivteListde;elsethis.RefreshRecommendListde;}privateRefreshFriendCountde{letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;letcount=friendDataMgr.friendItemArray.length;this.friendCount.text=LanUtil.GetFormatd`您的好友：{0}c{1}人`,count,friendDataMgr.friendMaxCounte;}privateRefreshInivteListde{ifdthis.type!=1ereturn;this.DestroyInviteListde;letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;letcellData:FriendInviteItemData=null;letindex=0;fordletplayerObjoffriendDataMgr.invitedListe{cellData=newFriendInviteItemDatade;cellData.id=playerObj.id;cellData.index=index;index++;this.inviteDataList.pushdcellDatae;}this.game_list.itemRenderer=FriendInviteItem;this.game_list.dataProvider=neweui.ArrayCollectiondthis.inviteDataListe;this.emptyTips.visible=this.inviteDataList.length==0;ifdthis.inviteDataList.length==0e{this.emptyLabel.text=LanUtil.GetTextd"您没有收到好友邀请！"e;}}privateRefreshRecommendListde{ifdthis.type!=2ereturn;this.DestroyRecommendListde;letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;letcellData:FriendRecommendItemData=null;letindex=0;fordletplayerObjoffriendDataMgr.showRecommandListe{cellData=newFriendRecommendItemDatade;cellData.id=playerObj.id;cellData.index=index;index++;this.recommendDataList.pushdcellDatae;}this.game_list.itemRenderer=FriendRecommendItem;this.game_list.dataProvider=neweui.ArrayCollectiondthis.recommendDataListe;this.emptyTips.visible=this.recommendDataList.length==0;ifdthis.recommendDataList.length==0e{this.emptyLabel.text=LanUtil.GetTextd"当前没有合适的玩家推荐！"e;}}privateDestroyInviteListde{this.inviteDataList=[];fordleti=0;iathis.game_list.numChildren;i++e{letgameCellView=this.game_list.getChildAtdieasItemRenderBase;gameCellView.DestroyAllde;}}privateDestroyRecommendListde{this.recommendDataList=[];fordleti=0;iathis.game_list.numChildren;i++e{letgameCellView=this.game_list.getChildAtdieasItemRenderBase;gameCellView.DestroyAllde;}}protectedDestroyde{ifdthis.timerKey!=0e{TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=0;}this.DestroyInviteListde;this.DestroyRecommendListde;CdManager.Insde.RemoveCDdgame.MainDataMgr.GetInstancede.friendDataMgr.refreshKeye;this.closeBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseBtnClicked,thise;this.inviteBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnInviteBtnClicked,thise;this.recommendBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRecommendBtnClicked,thise;this.refreshBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRefreshBtnClicked,thise;}}}﻿modulegame{exportclassFriendLeftItemData{publicindex:number;publicid:number;publicselected:boolean;publicconstructorde{}}exportclassFriendLeftItemextendsItemRenderBase{publicclickBg:eui.Image;publicplayerIcon:eui.Image;publicplayerName:eui.Label;publiclvLabel:eui.Label;publicreddot:eui.Image;publiccupCount:eui.BitmapLabel;publicscaleRoot:SGroup;publicclickBtn:SGroup;publicoffLine:eui.Label;publicconstructorde{superd"FriendLeftItemSkin"e;ccgame.logdthis.hashCode,"---------------FriendLeftItem.constructor----------"e;}privateisCreated:boolean=false;protectedchildrenCreatedde{super.childrenCreatedde;this.isCreated=true;ifdthis.data!=nulle{this.UpdateViewdthis.datae;}this.clickBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnBtnClicked,thise;};publicdataChangedde{this.UpdateViewdthis.datae;}privateUpdateViewddata:FriendLeftItemDatae{ifd!this.isCreatedereturn;this.OnSelectedddata.selectede;this.scaleRoot.scaleX=this.scaleRoot.scaleY=1;this.UpdateDatade;this.InitRedDotddatae;}privateInitRedDotddata:FriendLeftItemDatae{letredDotObj=RedDotMgr.GetInstancede.GetReddotd`friend_left_item_${data.id}`e;ifdredDotObj==nulle{game.errord"reddothasnokey:friend_left_item_",data.ide;return;}this.AddPropCBdredDotObj,"state",de=b{letisSelect=this.data!=null?this.data.selected:false;this.reddot.visible=redDotObj.GetStatede==1&&!isSelect;ifdisSelecteredDotObj.SetState_NotCalld0e;}e;}privateUpdateDatade{letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;letplayerObj=friendDataMgr.GetFrienddthis.data.ide;ifdplayerObj==nullereturn;this.playerIcon.source=RES.getResd`common_ui_playericon_json.${playerObj.icon}`e;this.playerName.text=playerObj.name;this.lvLabel.text=playerObj.lv.toStringde;this.cupCount.text=playerObj.cupCount.toStringde;this.AddPropCBdplayerObj,"isOnline",de=b{this.offLine.visible=!playerObj.isOnline;RenderUtils.SetGreydthis.playerName,!playerObj.isOnlinee;}e;}publicOnSelecteddselect:booleane{this.clickBg.alpha=select?1:0.5;}privateOnBtnClickedde{GlobalEvent.FireEventdGlobalEventType.FriendLeftItemClicked,this.data.ide;}protectedDestroyde{this.clickBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnBtnClicked,thise;}}}﻿modulegame{exportclassFriendRecommendItemData{publicid:number;publicindex:number;publicconstructorde{}}cc推荐好友exportclassFriendRecommendItemextendsItemRenderBase{publicplayerIcon:eui.Image;publicplayerName:eui.Label;publiclvLabel:eui.Label;publiccupCount:eui.BitmapLabel;publicaddBtn:SButton;publicstateLabel:eui.Label;privateplayerObj:PlayerDataItem;publicconstructorde{superd"FriendRecommendItemSkin"e;}privateisCreated:boolean=false;protectedchildrenCreatedde{super.childrenCreatedde;this.isCreated=true;ifdthis.data!=nulle{this.UpdateViewdthis.datae;}this.addBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnAddClicked,thise;};dataChangedde{this.UpdateViewdthis.datae;}privateUpdateViewddata:FriendRecommendItemDatae{ifd!this.isCreatedereturn;this.UpdateDatade;}privateUpdateDatade{letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;ifdthis.data.index!=null&&this.data.indexb=friendDataMgr.showRecommandList.lengthereturn;letplayerObj:PlayerDataItem=friendDataMgr.showRecommandList[this.data.index];ifdplayerObj==nullereturn;this.playerIcon.source=RES.getResd`common_ui_playericon_json.${playerObj.icon}`e;this.playerName.text=playerObj.name;this.lvLabel.text=playerObj.lv.toStringde;this.cupCount.text=playerObj.cupCount.toStringde;this.playerObj=playerObj;this.RemovePropCBdplayerObje;this.AddPropCBdplayerObj,"state",this.RefreshStatee;}publicRefreshStatede{letplayerObj=this.playerObj;ifdplayerObj!=nulle{this.addBtn.visible=playerObj.state==0;this.stateLabel.visible=playerObj.state!=0;this.stateLabel.text=playerObj.state==1?LanUtil.GetTextd"邀请失败"e:LanUtil.GetTextd"已邀请"e;this.stateLabel.textColor=playerObj.state==1?0xffffff:0x00ff00;}}privateOnAddClickedde{letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;ifdthis.data.index!=null&&this.data.indexb=friendDataMgr.showRecommandList.lengthereturn;letplayerObj:PlayerDataItem=friendDataMgr.showRecommandList[this.data.index];ifdplayerObj==nullereturn;ifdfriendDataMgr.IsFriendFulldeeTipsManager.ShowTipsdLanUtil.GetTextd"您的好友人数已达上限！"ee;ccelseifd!playerObj.isOnlineecc{ccTipsManager.ShowTipsd"该玩家已下线，邀请失败！"e;ccplayerObj.state=1;ccthis.RefreshStatede;cc}else{ClientNet.NetFriend.C2SInviteFrienddplayerObj.id,playerObj.serverIde;TipsManager.ShowTipsdLanUtil.GetTextd"邀请成功，请等待对方同意！"ee;playerObj.state=2;this.RefreshStatede;}}protectedDestroyde{this.playerObj=null;this.addBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnAddClicked,thise;}}}﻿modulegame{exportclassHeroLevelData{publiclevel:number=0;publicquality:number=0;publicsuperlevel:number=16;publicheroMaxLevel:number=18;publicDestroyde{}}exportclassHeroLevelextendseui.Component{privatecommon:eui.Group;privatesuperLv:eui.Group;privatelvLb:eui.Label;privatelvLb2:eui.Label;publicinfo:HeroLevelData;publicconstructorde{superde;this.skinName="HeroLevelSkin";this.Initde;}publicInitde{this.info=newHeroLevelDatade;}publicDestroyde{ifdthis.info!=nulle{this.info.Destroyde;this.info=null;}}publicSetLvdvalue:number,quality:numbere{ifdquality==null||qualitya0||qualityb3ereturn;ifdthis.info==nullethis.Initde;this.info.level=value;this.info.quality=quality;this.UpdateViewde;}privateUpdateViewde{ifdthis.info.levelathis.info.superlevelecc正常等级{this.superLv.visible=false;this.common.visible=true;this.lvLb.text=`${this.info.level}`;this.lvLb.textColor=Const.QualityColor[`Q${this.info.quality}`];this.lvLb2.textColor=Const.QualityColor[`Q${this.info.quality}`];}else{this.superLv.visible=true;this.common.visible=false;whiledthis.superLv.numChildrenb0e{this.superLv.removeChildAtd0e;};fordleti=this.info.superlevel;ia=this.info.heroMaxLevel;i++e{letstar=neweui.Image;ifdia=this.info.levele{star.source=`icon_hero_star_1`;}else{star.source=`icon_hero_star_0`;}this.superLv.addChilddstare;}}}}}﻿modulegame{exportclassJunDuiItemextendsItemRenderBase{privateheroKa:HeroKa1;privatetestId:eui.Label;privatenewTips:eui.Label;privateprogExp:ProgressExp;privateheroId:number;privateisInitRedDot:boolean;publicconstructorde{superd"JunDuiItemSkin"e;}publiccreateChildrende{super.createChildrende;this.cacheAsBitmap=true;}publicDestroyde{this.heroKa.Destroyde;}publicdataChangedde{ifdthis.data==nullereturn;this.heroId=this.data;this.testId.text=this.heroId+"";letheroInfo:HeroDataItem=MainDataMgr.GetInstancede.heroDataMgr.GetHerodthis.heroIdeasHeroDataItem;ifdheroInfo==nullereturn;letupgradeCost=heroInfo.GetUpCostCardde;this.heroKa.data=dnewHeroKa1Datae.PackPlayerDatadthis.heroId,falsee;ifdheroInfo.lvb0e{RenderUtils.SetGreydthis.heroKa,falsee;ifdheroInfo.lvb=heroInfo.GetHeroMaxLeveldeecc满级{this.progExp.SetStatedthis.progExp.MAX_LVe;}else{letupCost=heroInfo.GetUpCostCardde;letexp=heroInfo.exp;ifdexpaupCostecc不可升级{this.progExp.SetStatedthis.progExp.COMMON,0,upCost,expe;}elsecc可升级{this.progExp.SetStatedthis.progExp.CAN_UPGRADE,0,upCost,expe;}}}else{RenderUtils.SetGreydthis.heroKa,truee;ifdheroInfo.classLva=MainDataMgr.GetInstancede.classLvecc未获得{this.progExp.SetStatedthis.progExp.NONEe;}elseifdheroInfo.lva=0ecc未解锁{this.progExp.SetStatedthis.progExp.LOCK,LanUtil.GetFormatd`{0}阶竞技场开启`,heroInfo.classLvee;ccRenderUtils.SetGreydthis.heroKa,falsee;}this.progExp.validateNowde;}this.RemovePropCBdheroInfoe;this.AddPropCB_NotCalldheroInfo,"lv",this.OnHeroUpgradee;this.AddPropCB_NotCalldheroInfo,"exp",this.OnHeroUpgradee;letredDotObj=RedDotMgr.GetInstancede.GetReddotd`hero_data_item_${this.heroId}`e;this.RemovePropCBdredDotObje;this.AddPropCB_NotCalldredDotObj,"state",this.RefreshRedDote;this.RefreshRedDotdredDotObj.GetStatedee;ccthis.cacheAsBitmap=true;}privateOnHeroUpgradede{this.dataChangedde;}privateRefreshRedDotdshow:numbere{ifdshow==1e{this.newTips.visible=true;}else{this.newTips.visible=false;}}}}﻿modulegame{exportclassKakuJunDuiPanelextendsUIComponentBase{privatelist:eui.List;privateupdateList:eui.ArrayCollection;privatehasNum:eui.Label;privatetotalNum:eui.Label;privatemenu:DrowMenu;privatetimerArray:number[];publicjuiDuiSortData=["按卡牌品质排序","按卡牌等级排序","按法力消耗排序"];cc[cc{cctype:1,cctext:LanUtil.GetTextdecc},cc{cctype:2,cctext:LanUtil.GetTextdecc},cc{cctype:3,cctext:LanUtil.GetTextdecc}cc]publicconstructorde{superd"KakuJunDuiPanelSkin"e;}publicInitDatade{this.list.itemRenderer=JunDuiItem;this.updateList=neweui.ArrayCollectionde;this.list.dataProvider=this.updateList;lethMgr=MainDataMgr.GetInstancede.heroDataMgr;lettmpHerosArray=hMgr.heroKeysArray;letherosArray=hMgr.SortHerodtmpHerosArray,1e;this.timerArray=[];fordleti=0,len=herosArray.length;ialen;i++e{this.timerArray[i]=setTimeoutdde=b{ifdthis.updateList!=nullethis.updateList.addItemdherosArray[i]e;},30*ie;}lettype=1;letinfo=newDrowMenuDatade.PackDatadthis.juiDuiSortData,0,this.OnSortCB,thise;this.menu.Initdinfoe;this.hasNum.text=hMgr.hasHeros.length+"";this.totalNum.text="!"+hMgr.heroKeysArray.length;this.list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;}protectedDestroyde{fordleti=0,len=this.timerArray.length;ialen;i++e{clearTimeoutdthis.timerArray[i]e}letitem:JunDuiItem;whiledthis.list.numChildrenb0e{item=this.list.removeChildAtd0easJunDuiItem;item.Destroyde;}this.updateList.removeAllde;this.list.removeEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;}cc----------------------------------------------------------------------EditprivateOnSortCBdtype:numbere{lethMgr=MainDataMgr.GetInstancede.heroDataMgr;lettmpHerosArray=hMgr.heroKeysArray;letherosArray:number[]=hMgr.SortHerodtmpHerosArray,typee;this.updateList.replaceAlldherosArraye;}cc----------------------------------------------------------------------EventprivateOnItemTapde:eui.ItemTapEvente{ifde.item!=nulle{SoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;letheroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetHerode.itemeasHeroDataItem;ifdheroInfo==nullereturn;ifdheroInfo.classLvbMainDataMgr.GetInstancede.classLvereturnTipsManager.ShowTipsdLanUtil.GetFormatd`{0}阶竞技场解锁后可收集`,heroInfo.classLvee;RedDotMgr.GetInstancede.SetStated`hero_data_item_${heroInfo.id}`,0e;letheroId=e.item;letinfo=dnewHeroInfoPanelDatae.PackPlayerDatadheroIde;UIManager.ShowPaneldPanelTypeConst.HeroInfoPanel,infoe;}}}}﻿modulegame{exportclassKakuLingZhuPanelextendsUIComponentBase{privatelist:eui.List;privateupdateList:eui.ArrayCollection;privatehasNum:eui.Label;privatetotalNum:eui.Label;publicconstructorde{superd"KakuLingZhuPanelSkin"e;}protectedDestroyde{letitem:JunDuiItem;whiledthis.list.numChildrenb0e{item=this.list.removeChildAtd0easJunDuiItem;item.Destroyde;}this.updateList.removeAllde;}publicInitDatade{this.list.itemRenderer=LingZhuItem;this.updateList=neweui.ArrayCollectionde;this.list.dataProvider=this.updateList;lethMgr=MainDataMgr.GetInstancede.heroDataMgr;letleadersArray=hMgr.leaderKeysArray;this.updateList.replaceAlldleadersArraye;this.hasNum.text=StringdhMgr.hasLeaders.lengthe;this.totalNum.text=`!${hMgr.leaderKeysArray.length}`;}}}﻿modulegame{exportclassKakuMainPanelextendsUIComponentBase{privatemainBg:MainPanelBg;privatejdBtn:TabItem1;privatelzBtn:TabItem1;publicconstructorde{superd"KakuMainPanelSkin"e;}publicDestroyde{this.mainBg.Destroyde;}publicInitDatadindex:number=1e{letinfo=dnewMainPanelBgDatadee.PackData1d"button_return_jd",this.OnCloseTap,thise;this.mainBg.Initdinfoe;lettab1Info=dnewMainPanelBgTabDatadee.PackDatad1,TabItem1,KakuJunDuiPanele;lettab2Info=dnewMainPanelBgTabDatadee.PackDatad2,TabItem1,KakuLingZhuPanele;this.jdBtn=this.mainBg.AddTabdtab1InfoeasTabItem1;this.lzBtn=this.mainBg.AddTabdtab2InfoeasTabItem1;this.jdBtn.Initd"button_jd_jd_0","button_jd_jd"e;this.lzBtn.Initd"button_jd_lz_0","button_jd_lz"e;this.mainBg.SetTabIndexdindexe;letredDotObj1=RedDotMgr.GetInstancede.GetReddotd"jundui_jundui"e;this.AddPropCBdredDotObj1,"state",this.RefreshJunduiRedDote;letredDotObj2=RedDotMgr.GetInstancede.GetReddotd"jundui_lingzhu"e;this.AddPropCBdredDotObj2,"state",this.RefreshLingZhuRedDote;}privateRefreshJunduiRedDotde{letredDotObj1=RedDotMgr.GetInstancede.GetReddotd"jundui_jundui"e;ifdredDotObj1.GetStatede==1e{this.jdBtn.ShowRedDotdtruee;}else{this.jdBtn.ShowRedDotdfalsee;}}privateRefreshLingZhuRedDotdshow:numbere{letredDotObj2=RedDotMgr.GetInstancede.GetReddotd"jundui_lingzhu"e;ifdredDotObj2.GetStatede==1e{this.lzBtn.ShowRedDotdtruee;}else{this.lzBtn.ShowRedDotdfalsee;}}privateOnCloseTapde:egret.TouchEvente{UIManager.HidePaneldPanelTypeConst.KakuMainPanele;}}}﻿modulegame{exportclassKakuMainPanelCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return["home_hero"];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnKakuMainPanel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,true,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿modulegame{exportclassLingZhuItemextendsItemRenderBase{privateinfoBtn:SButton;privatenewTips:eui.Image;privateleaderImg:eui.Image;privatecampIcon:eui.Image;privatecampName:eui.Label;privateleaderName:eui.Label;privatemaskk:eui.Image;privateleaderId:numberpublicconstructorde{superd"LingZhuItemSkin"e;}publicDestroyde{ifdthis.infoBtn.hasEventListenerdegret.TouchEvent.TOUCH_TAPe==trueethis.infoBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnInfoBtnTap,thise}publicdataChangedde{ifdthis.data==nullereturn;this.leaderId=this.data;letleaderInfo=MainDataMgr.GetInstancede.heroDataMgr.GetLeaderdthis.leaderIde;ifdleaderInfo==nullereturn;ifd1ecc暂时全开放{this.currentState="common";this.validateNowde;RenderUtils.SetGreydthis,falsee;}else{this.currentState="lock";this.validateNowde;RenderUtils.SetGreydthis,truee;}this.leaderImg.source=`kingtower_${this.leaderId}_png`;this.leaderImg.mask=this.maskkthis.leaderName.text=leaderInfo.name;this.campIcon.source=`home_ui_kz_json.icon_sl_0${leaderInfo.camp}_s`;this.campName.text=Const.CampName[`CAMP_${leaderInfo.camp}`];ifdthis.infoBtn.hasEventListenerdegret.TouchEvent.TOUCH_TAPe==falseethis.infoBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnInfoBtnTap,thiseletredDotObj=RedDotMgr.GetInstancede.GetReddotd`hero_data_item_${this.leaderId}`e;this.RemovePropCBdredDotObje;this.AddPropCB_NotCalldredDotObj,"state",this.RefreshRedDote;this.RefreshRedDotdredDotObj.GetStatedee}privateOnInfoBtnTapde:eui.ItemTapEvente{ifdthis.leaderId!=nulle{RedDotMgr.GetInstancede.SetStated`hero_data_item_${this.leaderId}`,0e;UIManager.ShowPaneldPanelTypeConst.LeaderInfoPanel,this.leaderIde;}}privateRefreshRedDotdshow:numbere{ifdshow==1e{this.newTips.visible=true;}else{this.newTips.visible=false;}}}}﻿c****cmodulegame{exportclassLoginextendsUIComponentBase{publicconstructorde{superd"LoginSkin"e;}publicroot:eui.Group;publicenterBtn:SButton;publicbackBtn:SButton;publicaccount:SInputLabel;publicpassword:SInputLabel;publicipLabel:SInputLabel;publicportLabel:SInputLabel;publictest1Label:SInputLabel;protectedchildrenCreatedde{super.childrenCreatedde;ccthis.backBtn.SetIconColord0xff0000e;ccthis.test1Label.SetMidlleLinedtruee;}publicInitDataddatae{super.InitDataddatae;this.enterBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnLoginGame,thise;this.backBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnBackGame,thise;this.account.SetDefaultTextdLanUtil.GetTextd"请输入用户名"ee;this.password.SetDefaultTextdLanUtil.GetTextd"请输入密码"ee;letuserName=NativeApi.getLocalDatad"userName"e;letpassword=NativeApi.getLocalDatad"password"e;ifduserName!=null&&password!=nulle{this.account.text=userName;this.password.text=password;}else{this.account.text=Math.floordMath.randomde*1000000e.toStringde;this.password.text="1";}this.ipLabel.text=GameData.LogSocketURL;this.portLabel.text=GameData.LogSocketPort.toStringde;ifdGameData.DevelopMode==DevelopMode.Developethis.backBtn.visible=false;}privateDelayCheckFightReconnectde{letmainData=MainDataMgr.GetInstancede;ifdmainData.fightState==2e{UIManager.HidePaneldPanelTypeConst.Logine;UIManager.ShowPaneldPanelTypeConst.MainUINewe;UIManager.ShowPaneldPanelTypeConst.Homee;ClientNet.NetWar.C2SFightReconnectde;}else{UIManager.HidePaneldPanelTypeConst.Logine;UIManager.ShowPaneldPanelTypeConst.MainUINewe;UIManager.ShowPaneldPanelTypeConst.Homee;HomeInit.InitDatade;ccConnectManager.GetInstancede.SetIsStopCheckdfalsee;}}privateOnLoginGamedevent:egret.TouchEvente:void{GameData.UserName=null;GameData.LogName=null;letuserName=this.account.GetTextde;letpassWord=this.password.GetTextde;ifduserName==null||passWord==nulle{TipsManager.ShowTipsdLanUtil.GetTextd"请输入有效的用户名和密码!!!"e,1e;return;}UIManager.ShowPaneldPanelTypeConst.UILoadinge;ConnectManager.GetInstancede.LoginGameduserName,passWord,drete=b{UIManager.HidePaneldPanelTypeConst.UILoadinge;ifdret==1e{letuserName=this.account.text;letpassword=this.password.text;GameData.UserName=userName;letlogName=Utils.GetNowDatede;GameData.LogName=logName+"_main";ifdGameData.MultiThreade{ECSC.CNetWar.StaticValued"GameData","UserName",GameData.UserNamee;ECSC.CNetWar.StaticValued"GameData","LogName",logName+"_thread"e;ECSC.CNetWar.InstanceFuncd"ClientNet","LogNetManager","SendLoginMessage",userName+"_thread"e;}ClientNet.LogNetManager.GetInstancede.SendLoginMessageduserName+"_main"e;TipsManager.ShowTipsdLanUtil.GetTextd"登录成功!!!"e,1e;game.logd"-------登录成功---bbbbbbbbbbbbbbbbbbbbb"e;NativeApi.setLocalDatad"userName",userNamee;NativeApi.setLocalDatad"password",passworde;TimerMgr.GetInstancede.AddTimerd1,this.DelayCheckFightReconnect,thise;}else{ifdret==2eTipsManager.ShowTipsdLanUtil.GetTextd"请输入有效的用户名和密码!!!"e,1e;elseTipsManager.ShowTipsdLanUtil.GetTextd"登录失败!!!"e,1e;game.logd"-------登录失败---bbbbbbbbbbbbbbbbbbbbb"e;}},thise;ccthis.CheckIPValidde;}privateCheckIPValidde{letip=this.ipLabel.text;letport=this.portLabel.text;letstrArray=ip.splitd"."e;ifdstrArray.length!=4&&Numberdporteb0e{TipsManager.ShowTipsdLanUtil.GetTextd"ip值非法!!!"e,1e;}else{GameData.LogSocketURL=ip;GameData.LogSocketPort=Numberdporte;}}privateOnBackGamede{UIManager.HidePaneldPanelTypeConst.Logine;UIManager.ShowPaneldPanelTypeConst.SelectServere;}protectedDestroyde{this.enterBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnLoginGame,thise;this.backBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnBackGame,thise;this.account.Destroyde;this.password.Destroyde;}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassLoginCextendsUICtrlBase{publicconstructorde{superde;}cc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnLogin;}cc做一下类型转换方便调用一定要有!!!protectedgetloginPanelde{returnaLoginbthis.panel;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0,false,false,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}c***初始化面板数据*cpublicInitDatade:void{}}}﻿c****cmodulegame{classServerCellData{publicip:string;publicport:string;publicname:string;publicindex:number;publicconstructorde{}}classServerCellViewextendsItemRenderBase{publicserverName:eui.Label;publicbg:eui.Image;publicconstructorde{superd"ServerItemSkin"e;}privateisCreated:boolean=false;protectedchildrenCreatedde{super.childrenCreatedde;this.isCreated=true;ifdthis.data!=nullethis.UpdateViewdthis.datae;}publicdataChangedde{this.UpdateViewdthis.datae;}c***更新视图*cprivateUpdateViewddata:ServerCellDatae{ifd!this.isCreatedereturn;this.serverName.text=data.name;ifddata.index%2==0ethis.bg.source=RES.getResd"home_ui_login_json.bg_dl_qbfwq"e;elsethis.bg.source=RES.getResd"home_ui_login_json.bg_dl_xzfwq"e;}protectedDestroyde{}}exportclassSelectServerextendsUIComponentBase{publicconstructorde{superd"SelectServerSkin"e;}publicroot:eui.Group;publicenterBtn:SButton;publicscroll_bg:eui.Image;publicgame_list_scroller:eui.Scroller;publicgame_scroll_bar:eui.VScrollBar;publicgame_list:eui.List;publicgameCellDatas:ServerCellData[];privateselectedItem:ServerCellView;publicselectedData:ServerCellData;publicselectedIndex:number;publicselectLabel:eui.Label;protectedchildrenCreatedde{super.childrenCreatedde;}publicInitDataddata:anye{super.InitDataddatae;this.enterBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnEnterGame,thise;letdataArray:any[]=[];fordletserverDataofNetConst.serverArraye{letdata:any={};data.ip=serverData["ip"];data.port=serverData["port"];data.name=serverData["name"];dataArray.pushddatae;}this.InitListddataArraye;letindexStr=NativeApi.getLocalDatad"serverIndex"e;ifdindexStr==nulleindexStr="0";letindex=NumberdindexStre;ifdindexb=dataArray.lengtheindex=0;this.SetCurrentServerddataArray[index],indexe;}privateOnEnterGamedevent:egret.TouchEvente:void{cc连接服务器letserverData=this.selectedData;UIManager.ShowPaneldPanelTypeConst.UILoadinge;ifdserverData.ip=="127.0.0.1"eGameData.LocalTest=true;elseGameData.LocalTest=false;ConnectManager.GetInstancede.ConnectServerdserverData.ip,serverData.port,drete=b{UIManager.HidePaneldPanelTypeConst.UILoadinge;ifdret==1e{TipsManager.ShowTipsdLanUtil.GetTextd"连接服务器成功!!!"e,1e;NativeApi.setLocalDatad"serverIndex",this.selectedIndex.toStringdee;UIManager.HidePaneldPanelTypeConst.SelectServere;UIManager.ShowPaneldPanelTypeConst.Logine;}else{TipsManager.ShowTipsdLanUtil.GetTextd"连接服务器失败!!!"e,1e;}},thise;}publicInitListddataArray:anye{this.gameCellDatas=[];letindex=0;fordletdataofdataArraye{letgameData=newServerCellDatade;gameData.ip=data.ip;gameData.port=data.port;gameData.name=data.name;gameData.index=index;this.gameCellDatas.pushdgameDatae;index++;}this.game_list.itemRenderer=ServerCellView;letlistData=neweui.ArrayCollectiondthis.gameCellDatase;this.game_list.dataProvider=listData;this.game_list_scroller.viewport=this.game_list;cc刷新数据this.game_list.updateRenderer=this.GameCell.binddthise;this.game_list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.ItemSelected,thise;this.game_list_scroller.validateNowde;this.game_list.scrollV=this.game_list.contentHeight-this.game_list.height; ifdthis.game_list.contentHeighta=this.game_list.heighte{this.game_list_scroller.scrollPolicyV=eui.ScrollPolicy.OFF;this.scroll_bg.height=this.game_list.contentHeight;}else{this.game_list_scroller.scrollPolicyV=eui.ScrollPolicy.AUTO;this.scroll_bg.height=350;}}protectedItemSelectedde:eui.ItemTapEvente:void{ccgame.logd"--------itemSelected----bbbbbbbbbbbbb------",e.itemIndexe;this.SetCurrentServerde.item,e.itemIndexe;}publicSetCurrentServerddata:ServerCellData,index:numbere{ccifdthis.selectedItem==nullecc{ccthis.selectedItem=newServerCellViewde;ccthis.selectedItem.x=240;ccthis.selectedItem.y=260;ccthis.addChilddthis.selectedIteme;cc}ccthis.selectedItem.serverName.text=data.name;this.selectedData=data;this.selectedIndex=index;this.selectLabel.text=data.name;}c***List更新数据时调用*cprivateGameCelldrenderer:eui.IItemRenderer,itemIndex:number,data:anye:eui.IItemRenderer{renderer.data=data;renderer.itemIndex=itemIndex;returnrenderer;}protectedDestroyde{this.gameCellDatas=null;fordleti=0;iathis.game_list.numChildren;i++e{letserverCellView=this.game_list.getChildAtdieasServerCellView;serverCellView.DestroyAllde;}ifdthis.selectedItem!=nullethis.selectedItem.DestroyAllde;this.selectedItem=null;this.selectedData=null;this.enterBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnEnterGame,thise;}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassSelectServerCextendsUICtrlBase{publicconstructorde{superde;}cc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnSelectServer;}cc做一下类型转换方便调用一定要有!!!protectedgetselectServerPanelde{returnaSelectServerbthis.panel;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0,false,falsee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}c***初始化面板数据*cpublicInitDatade:void{}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassMailDetailInfoCextendsUICtrlBase{publicconstructorde{superde;}cc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnMailDetailInfoPanel;}cc做一下类型转换方便调用一定要有!!!protectedgettestPanelde{returnaMailDetailInfoPanelbthis.panel;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0,false,false,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}c***初始化面板数据*cpublicInitDatade:void{}}}﻿c****cmodulegame{exportclassMailDetailInfoPanelextendsUIComponentBase{publicroot:eui.Group;publiccloseBtn:SButton;publicnameLabel:eui.Label;publicdescLabel:eui.Label;publicnameLabel2:eui.Label;publicdescLabel2:eui.Label;publicgetBtn:SButton;publicrewardGroup:eui.Group;publicitemArray:CommonItem[];privatemailId:string;privatecanGetReward:boolean;publicconstructorde{superd"MailDetailInfoSkin",truee;this.itemArray=[];this.canGetReward=false;}protectedchildrenCreatedde{super.childrenCreatedde;}publicInitDatadmailId:stringe{this.mailId=mailId;this.InitCBdmailIde;super.InitDatadmailIde;ClientNet.NetMail.C2SReadMaildmailIde;}privateInitCBdmailId:stringe{this.AddTouchEventdthis.closeBtn,de=b{UIManager.HidePaneldPanelTypeConst.MailDetailInfoe;},thise;this.AddTouchEventdthis.getBtn,de=b{ifd!this.canGetRewarde{ClientNet.NetMail.C2SDeleteMaild[this.mailId]e;ccgame.logd"已经领取过奖励可以删除"e;}else{ClientNet.NetMail.C2SGetMailRewardd[this.mailId]e;ccgame.logd"领取奖励"e;}UIManager.HidePaneldPanelTypeConst.MailDetailInfoe;},thise;letmailDataMgr=MainDataMgr.GetInstancede.mailDataMgr;letmailObj=mailDataMgr.GetMaildthis.mailIde;ifdmailObj==nullereturn;this.AddPropCBdmailObj,"isRead",this.RefreshInfoe;}privateRefreshInfode{letmailDataMgr=MainDataMgr.GetInstancede.mailDataMgr;letmailObj=mailDataMgr.GetMaildthis.mailIde;ifdmailObj==nullereturn;ifdmailObj.itemArray.lengthb0ethis.currentState="hasItem";elsethis.currentState="noItem";this.validateNowde;ifdthis.nameLabel!=nulle{this.nameLabel.text=mailObj.title;this.descLabel.text=mailObj.context;}this.DestroyRewardde;cc奖励letrewardList=mailObj.itemArray;fordletrewardofrewardListe{letitemId=reward["itemid"];letitemCount=reward["count"];letitemObj:CommonItem;itemObj=newCommonItemd"MailRewardItemSkin"e;this.itemArray.pushditemObje;this.rewardGroup.addChildditemObje;itemObj.SetCreateOverCBdde=b{letobj=itemObj;obj["checkImg"].visible=mailObj.isGetReward;obj["icon"].source=RES.getResdDataUtil.GetItemSourceditemIdee;obj["count"].text=itemCount.toStringde;},itemObje;}ifd!mailObj.isGetReward&&rewardList.lengthb0ecc有奖励且未领取this.getBtn.SetTextd"领取"e;elsethis.getBtn.SetTextd"删除"e;this.canGetReward=d!mailObj.isGetReward&&rewardList.lengthb0e;}privateDestroyRewardde{fordletitemObjofthis.itemArraye{itemObj.DestroyAllde;}this.itemArray=[];}protectedDestroyde{this.DestroyRewardde;}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassMailInfoCextendsUICtrlBase{publicconstructorde{superde;}cc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return["home_mail"];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnMailInfoPanel;}cc做一下类型转换方便调用一定要有!!!protectedgettestPanelde{returnaMailInfoPanelbthis.panel;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0e;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}c***初始化面板数据*cpublicInitDatade:void{}}}﻿c****cmodulegame{exportclassMailInfoPanelextendsUIComponentBase{publicroot:eui.Group;publiccomWin:CommonWin;ccpubliccloseBtn:SButton;publicmailInfo:eui.Group;publicnoMailInfo:eui.Group;publictitle:eui.Label;publicmailCount:eui.Label;publicdelBtn:SButton;publicgetBtn:SButton;publicgame_list_scroller:eui.Scroller;publicgame_list:eui.List;publicgameCellDatas:MailItemData[];publicconstructorde{superd"MailInfoSkin",truee;this.gameCellDatas=[];}protectedchildrenCreatedde{super.childrenCreatedde;this.InitCBde;}privateInitCBde{this.comWin.Initd"邮件",de=b{UIManager.HidePaneldPanelTypeConst.MailInfoe;},thise;ccthis.AddTouchEventdthis.closeBtn,de=b{ccUIManager.HidePaneldPanelTypeConst.MailInfoe;cc},thise;this.AddTouchEventdthis.delBtn,de=b{letdeleteArray=mailDataMgr.GetAllDeleteMailde;letidArray:string[]=[];fordletmailDataofdeleteArraye{idArray.pushdmailData.ide;}ClientNet.NetMail.C2SDeleteMaildidArraye;cc全部删除},thise;this.AddTouchEventdthis.getBtn,de=b{letrewardArray=mailDataMgr.GetAllGetRewardMailde;letidArray:string[]=[];fordletmailDataofrewardArraye{idArray.pushdmailData.ide;}ClientNet.NetMail.C2SGetMailRewarddidArraye;cc全部领取},thise;ClientNet.NetMail.C2SAllMailde;letmailDataMgr=MainDataMgr.GetInstancede.mailDataMgr;this.AddPropCBdmailDataMgr,"mailDataArray",this.RefreshListe;this.AddPropCBdmailDataMgr,"isMailChange",this.RefreshMailInfoe;}publicRefreshListde{this.DestroyListde;letmailDataMgr=MainDataMgr.GetInstancede.mailDataMgr;letindex=0;fordletmailDataofmailDataMgr.mailDataArraye{letcellData=newMailItemDatade;cellData.mailId=mailData.id;this.gameCellDatas.pushdcellDatae;index++;}this.game_list.itemRenderer=MailItem;this.game_list_scroller.viewport=this.game_list;letlistData=neweui.ArrayCollectiondthis.gameCellDatase;this.game_list.dataProvider=listData;}publicRefreshMailInfode{letmailDataMgr=MainDataMgr.GetInstancede.mailDataMgr;letcount=mailDataMgr.mailDataArray.length;this.mailInfo.visible=dcountb0e;this.noMailInfo.visible=dcount==0e;this.mailCount.text=`${count}c${mailDataMgr.maxCount}`;letdeleteArray=mailDataMgr.GetAllDeleteMailde;this.delBtn.SetGreyddeleteArray.length==0e;this.delBtn.touchEnabled=deleteArray.lengthb0;letrewardArray=mailDataMgr.GetAllGetRewardMailde;this.getBtn.SetGreydrewardArray.length==0e;this.getBtn.touchEnabled=rewardArray.lengthb0;}publicDestroyListde{this.gameCellDatas=[];fordleti=0;iathis.game_list.numChildren;i++e{letcellView=this.game_list.getChildAtdieasMailItem;cellView.DestroyAllde;}}protectedDestroyde{this.DestroyListde;}}}﻿modulegame{exportclassMailItemData{publicmailId:string;publicconstructorde{}}exportclassMailItemextendsItemRenderBase{publicroot:eui.Group;publicbg:eui.Image;publicclickBg:eui.Group;publicgetBtn:SButton;publicgetImg:eui.Image;publicmailName:eui.Label;publicleftTime:eui.Label;publicitemIcon:eui.Image;publicitemCount:eui.Label;privatetimerKey:number;publicconstructorde{superd"MailItemSkin"e;this.isRemoveCBOnDataChanged=true;}privateisCreated:boolean=false;protectedchildrenCreatedde{super.childrenCreatedde;this.isCreated=true;ifdthis.data!=nulle{this.UpdateViewdthis.datae;}this.clickBg.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.ItemSelected,thise;this.getBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnGetBtnClicked,thise;}privateOnGetBtnClickedde{letmailDataMgr=MainDataMgr.GetInstancede.mailDataMgr;letmailObj=mailDataMgr.GetMaildthis.data.mailIde;ifdmailObj==nullereturn;ClientNet.NetMail.C2SGetMailRewardd[mailObj.id]e;}protectedItemSelectedde:anye:void{ifdthis.data!=nulleUIManager.ShowPaneldPanelTypeConst.MailDetailInfo,this.data.mailIde;}dataChangedde{this.UpdateViewdthis.datae;}privateUpdateViewddata:FriendLeftItemDatae{ifd!this.isCreatedereturn;this.UpdateDatade;}privateUpdateDatade{letmailDataMgr=MainDataMgr.GetInstancede.mailDataMgr;letmailObj=mailDataMgr.GetMaildthis.data.mailIde;ifdmailObj==nullereturn;this.AddPropCBdmailObj,"isRead",this.RefreshStatee;}privateRefreshStatede{letmailDataMgr=MainDataMgr.GetInstancede.mailDataMgr;letmailObj=mailDataMgr.GetMaildthis.data.mailIde;ifdmailObj==nullereturn;ccmailObj.itemArray.length=0;ifdmailObj.itemArray.lengthb0e{letitemId=mailObj.itemArray[0]["itemid"];this.itemIcon.source=RES.getResdDataUtil.GetItemSourceditemIdee;}else{ifdmailObj.isReadethis.itemIcon.source=RES.getResd"home_ui_mail_json.icon_mail_tb02"e;elsethis.itemIcon.source=RES.getResd"home_ui_mail_json.icon_mail_tb01"e;}this.itemCount.visible=false;this.mailName.text=mailObj.title;this.leftTime.text=this.GetFormatTimedmailObj.GetLeftTimedee;ccthis.getBtn.visible=mailObj.itemArray.lengthb0;lethasReward=mailObj.itemArray.lengthb0;this.getBtn.visible=d!mailObj.isGetReward&&hasRewarde;this.getImg.visible=dmailObj.isGetReward&&hasRewarde;ccifdmailObj.isGetRewardecc{ccthis.getBtn.SetTextd"已领取"e;ccthis.getBtn.touchEnabled=false;ccthis.getBtn.SetGreydtruee;cc}ccelsecc{ccthis.getBtn.SetTextd"领取"e;ccthis.getBtn.touchEnabled=true;ccthis.getBtn.SetGreydfalsee;cc}TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=TimerMgr.GetInstancede.AddTimerd1000,this.RefreshTime,thise;}privateRefreshTimede{letmailDataMgr=MainDataMgr.GetInstancede.mailDataMgr;letmailObj=mailDataMgr.GetMaildthis.data.mailIde;ifdmailObj==nullereturntrue;this.leftTime.text=this.GetFormatTimedmailObj.GetLeftTimedee;returntrue;}privateGetFormatTimedtime:numbere:string{letday:number=0;lethour:number=0;letmin:number=0;letsec:number=0;ifdtimeb=3600*24e{day=Math.floordtimec3600c24e;time=time-day*3600*24;}ifdtimeb=3600e{hour=Math.floordtimec3600e;time=time-hour*3600;}ifdtimeb=60e{min=Math.floordtimec60e;time=time-min*60;}sec=time;ifddayb0ereturn`剩余时间：${day}天${hour}时${min}分`;ifdhourb0ereturn`剩余时间：${hour}时${min}分${sec}秒`;ifdminb0ereturn`剩余时间：${min}分${sec}秒`;return`剩余时间：${sec}秒`;}protectedDestroyde{TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.getBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnGetBtnClicked,thise;this.clickBg.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.ItemSelected,thise;}}}﻿c***角色信息*cmodulegame{exportclassBottomItemextendsSButton{publicredDot:eui.Image;publicconstructordargs:anye{superde;this.skinName="BottomItemSkin";}protectedDestroyde{}publicInitRedDotdreddotName:stringe{letredDotObj=RedDotMgr.GetInstancede.GetReddotdreddotNamee;ifdredDotObj==nulle{game.errord"reddothasnokey:",reddotNamee;return;}this.AddPropCBdredDotObj,"state",de=b{this.redDot.visible=redDotObj.GetStatede==1;}e;}}}﻿modulegame{exportclassCostInfoextendsUIComponentBase{publicroot:eui.Group;publicexp_lv:eui.BitmapLabel;publicexp_num:eui.BitmapLabel;privateexpProg:eui.ProgressBar;publicgold_num:eui.BitmapLabel;publicaddGoldBtn:SButton;publicdiamand_num:eui.BitmapLabel;publicaddDiamandBtn:SButton;publicconstructorde{superd"CostInfoSkin"e;}protectedchildrenCreatedde:void{ifdGameData.DevelopMode==DevelopMode.Develope{this.addGoldBtn.visible=false;this.addDiamandBtn.visible=false;}this.expProg.minimum=0;this.expProg.labelFunction=this.ProgressFunction;super.childrenCreatedde;letmainDataMgr=MainDataMgr.GetInstancede;this.AddPropCBdmainDataMgr,"exp",this.RefreshExpAndLv,thise;this.AddPropCBdmainDataMgr,"level",this.RefreshExpAndLv,thisethis.AddPropCBdmainDataMgr,"gold",de=b{this.gold_num.text=mainDataMgr.gold.toStringde;},thise;this.AddPropCBdmainDataMgr,"diamand",de=b{this.diamand_num.text=mainDataMgr.diamand.toStringde;},thise;this.AddTouchEventdthis.addGoldBtn,this.OnGoldBtnTap,thise;this.AddTouchEventdthis.addDiamandBtn,this.OnDimandBtnTap,thise;}privateRefreshUserNamede{}protectedDestroyde{}privateOnGoldBtnTapde{letinfo=dnewShopQuickBuyWinDatadee.PackDatadShopType.Golde;UIManager.ShowPaneldPanelTypeConst.ShopQuickBuyWin,infoe;}privateOnDimandBtnTapde{letinfo=dnewShopQuickBuyWinDatadee.PackDatadShopType.Diamonde;UIManager.ShowPaneldPanelTypeConst.ShopQuickBuyWin,infoe;}protectedProgressFunctiondvalue:number,maxValue:numbere:string{return`${value}!${maxValue}`}protectedRefreshExpAndLvde{letmainDataMgr=MainDataMgr.GetInstancede;letexp=mainDataMgr.exp;letnextExp=mainDataMgr.nextExp;ifdnextExpb0ethis.exp_num.text=`${exp}!${nextExp}`;elsethis.exp_num.text=`${exp}`;this.expProg.maximum=nextExp;this.expProg.value=exp;letlv=mainDataMgr.level;lettransInfo:any={10:"a",11:"b",12:"c",13:"d",14:"e",15:"f"};letlvStr=lv.toStringde;ifdlvb9elvStr=transInfo[lv];this.exp_lv.text=lvStr;}}}﻿modulegame{exportclassHeadIconextendseui.Component{publicplayerIcon:eui.Image;publicedgeIcon:eui.Image;publicconstructorde{superde;this.skinName="HeadIconSkin";this.Initde;}publicInitde{}publicDestroyde{}publicSetIcondiconId:numbere{letid=1000+iconId;cc理论上id应该完全由后端传过来。this.playerIcon.source=`common_ui_playericon_json.${id}`;}publicSetFramedframe:number=3e{ccletframe=3;cc没有边框系统，默认用3this.edgeIcon.source=`common_ui_playericon_json.bg_phb_heroicon_up0${frame}`;}}}﻿c***角色信息*cmodulegame{exportclassLeftItemextendsItemRenderBase{publiciconBg:eui.Image;publicplayerIcon:eui.Image;publiclvIcon:eui.Image;publiccupCount:eui.BitmapLabel;publicplayerName:eui.Label;publicnameBg:eui.Image;publicconstructorde{superd"LeftItemSkin"e;}protectedDestroyde{}publicdataChangedde{ifdthis.data==nullereturn;cccccccccccccccccccccccccccccccccccccccccccccccccletrank=this.data[0];cccccccccccccccccccccccccccccccccccccccccccccccccletrankInfo=MainDataMgr.GetInstancede.rankDataMgr.GetOneRankInfodConst.RankInfoType.PLAYER,Const.RankType.LOCAL,ranke;ifdrankInfo==nullereturn;letcolorArray=[[0xaf7019,0x5b402a],[0x757575,0x5d5d5d],[0x725812,0x4d3827]];this.iconBg.source=RES.getResd`common_ui_playericon_json.bg_phb_heroicon_up0${3}`e;this.playerIcon.source=RES.getResd`common_ui_playericon_json.100${rankInfo.headIconId}`e;this.lvIcon.source=RES.getResd`home_ui_common_json.icon_phb_num0${rank}`e;this.cupCount.text=`${rankInfo.cups}!`;this.playerName.text=`${rankInfo.playerName}`;this.playerName.textColor=colorArray[rank-1][0];this.playerName.strokeColor=colorArray[rank-1][1];this.nameBg.source=RES.getResd`home_ui_common_json.bg_phb_namedi0${rank}`e;}}}﻿c***角色信息*cmodulegame{exportclassMainButtonextendsSButton{ccpubliciconImg:eui.Image;publicredDot:eui.Image;privateonSelectFunc:Function;privatethisObj:any;privateargs:any;publicconstructordargs:anye{superde;this.skinName="MainButtonSkin";this.args=args;}protectedDestroyde{this.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnClicked,thise;this.onSelectFunc=null;this.thisObj=null;this.args=null;}protectedchildrenCreatedde:void{super.childrenCreatedde;ccthis.redDot.visible=false;ccthis.iconImg.source=RES.getResdthis.args[0]e;ccthis.onSelectFunc=this.args[1];ccthis.thisObj=this.args[2];ccthis.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnClicked,thise;ccthis.iconImg.anchorOffsetX=this.iconImg.widthc2;ccthis.iconImg.anchorOffsetY=this.iconImg.heightc2;ccthis.iconImg.x=50;ccthis.iconImg.y=50;ccthis.redDot.x=this.iconImg.widthc2;ccthis.redDot.y=this.iconImg.heightc2;ccthis.x=this.args[3];ccthis.y=this.args[4];}publicInitRedDotdreddotName:stringe{letredDotObj=RedDotMgr.GetInstancede.GetReddotdreddotNamee;ifdredDotObj==nulle{game.errord"reddothasnokey:",reddotNamee;return;}this.AddPropCBdredDotObj,"state",de=b{this.redDot.visible=redDotObj.GetStatede==1;}e;}privateOnClickedde{ifdthis.onSelectFunc!=nulle{this.onSelectFunc.calldthis.thisObje;}}}}﻿modulegame{exportclassMainCenterextendsUIComponentBase{publicconstructorde{superd""e;}protectedDestroyde{}}}﻿modulegame{exportclassRightDZCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.mainCenterLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnRightDZPanel;}cc做一下类型转换方便调用一定要有!!!protectedgetrightDZPanelde{returnaRightDZPanelbthis.panel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,falsee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld0e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}c***初始化面板数据*cpublicInitDatade:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}}}﻿c****cmodulegame{exportclassRightDZItemextendsUIComponentBase{publiciconImg:eui.Image;publiclockImg:eui.Image;privateonSelectFunc:Function;privatethisObj:any;publicargs:any;publiclocked:boolean;publicconstructordargs:anye{superd"RightDZItemSkin"e;this.args=args;this.locked=false;}protectedchildrenCreatedde{super.childrenCreatedde;this.iconImg.source=RES.getResdthis.args[1]e;this.x=this.args[2];this.y=this.args[3];this.onSelectFunc=this.args[4];this.thisObj=this.args[5];this.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnClicked,thise;this.SetLockeddthis.lockede;}protectedDestroyde{this.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnClicked,thise;this.onSelectFunc=null;this.thisObj=null;this.args=null;}publicSetLockeddlocked:booleane{this.locked=locked;ifdthis.iconImg==null||this.lockImg==nullereturn;ifdlockedethis.iconImg.source=RES.getResdthis.args[1]e;elsethis.iconImg.source=RES.getResdthis.args[0]e;this.lockImg.visible=locked;}privateOnClickedde{ifdthis.onSelectFunc!=nulle{this.onSelectFunc.calldthis.thisObje;}}}exportclassRightDZPanelextendsUIComponentBase{publicroot:eui.Group;publickingIcon:eui.Image;publicskillArray:KingSkillIcon[];publicitemArray:RightDZItem[];publicfriendNum:number;publicmemberNum:number;privatekingIconBtn:eui.Group;publicconstructorde{superd"RightDZSkin"e;this.itemArray=[];this.skillArray=[];}protectedchildrenCreatedde{super.childrenCreatedde;this.CreateDZInfode;this.InitCBde;this.RefreshChangeLeaderde;}privateCreateDZInfode{letconfigInfo=[["home_ui_common_json.button_ld_2v2","home_ui_common_json.button_ld_2v2_0",600,110,this.On2V2Clicked,this],["home_ui_common_json.button_ld_1v1","home_ui_common_json.button_ld_1v1_0",600,364,this.On1V1Clicked,this],];this.itemArray=[];fordletargsofconfigInfoe{letitemObj=newRightDZItemdargse;itemObj.SetLockeddfalsee;this.root.addChildditemObje;this.itemArray.pushditemObje;}}privateInitCBde{lettowerDataMgr=MainDataMgr.GetInstancede.towerDataMgr;ccthis.AddPropCBdtowerDataMgr,"currentKingIndex",this.RefreshKingInfo,thise;GlobalEvent.SubscribedGlobalEventType.ChangeLeader,this.RefreshChangeLeader,thise;GlobalEvent.SubscribedGlobalEventType.ChangeTeamIndex,this.RefreshChangeLeader,thise;this.kingIconBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnKingIconClick,thise;}privatestartlickTime:number=0;privatekingIconClickCount:number=0;privateOnKingIconClickde{letnowTime=egret.getTimerde;ifdnowTime-this.startlickTimeb1000e{this.startlickTime=nowTime;this.kingIconClickCount=0;}this.kingIconClickCount++;ifdthis.kingIconClickCountb=5e{this.ShowTestDlgde;this.startlickTime=0;}UIManager.ShowPaneldPanelTypeConst.KakuMainPanel,2e;}privateShowTestDlgde{UIManager.ShowPaneldPanelTypeConst.CMDDlge;}privateRefreshKingInfode{this.DestroyKingInfode;lettowerDataMgr=MainDataMgr.GetInstancede.towerDataMgr;letheroObj=towerDataMgr.GetCurrentKingde;letskillIdArray=heroObj.askillIdArray;skillIdArray=[10010,10020,10030];letx=215;lety=530;fordletskillIdofskillIdArraye{letargs=[`common_ui_skillicon_json.${skillId}`,x,y,this.OnKingIconClicked,this];letitemObj=newKingSkillIcondargse;this.root.addChildditemObje;this.skillArray.pushditemObje;x+=100;}}privateOnKingIconClickedde{}publicDestroyKingInfode{fordletitemObjofthis.skillArraye{itemObj.DestroyAlldtruee;}this.skillArray.length=0;}protectedDestroyde{fordletitemObjofthis.itemArraye{itemObj.DestroyAlldtruee;}this.itemArray.length=0;this.DestroyKingInfode;GlobalEvent.UnSubscribedGlobalEventType.ChangeLeader,this.RefreshChangeLeader,thise;GlobalEvent.UnSubscribedGlobalEventType.ChangeTeamIndex,this.RefreshChangeLeader,thise;this.kingIconBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnKingIconClick,thise;}cc2V2privateOn2V2Clickedde{letmainDataMgr=MainDataMgr.GetInstancede;letcheck=mainDataMgr.dzDataMgr.CheckIsLockdeifdmainDataMgr==null||mainDataMgr.dzDataMgr==null||check[0]==falsee{TipsManager.ShowTipsdLanUtil.GetFormatd`达到{0}奖杯开放组队模式`,check[1]ee;return;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc提审版本用，直接进入匹配ccifd1eccreturnClientNet.NetMatch.C2SBeginMatchdPVPType.VS_2_2e;ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccletdzDataMgr=MainDataMgr.GetInstancede.dzDataMgr;this.friendNum=mainDataMgr.friendDataMgr.GetOnlineFriendddzDataMgr.matchFriendClassLve.length;this.memberNum=0;letmyFamily=mainDataMgr.familyDataMgr.myFamily;ifdmyFamily!=nulle{this.memberNum=myFamily.GetOnlineMemberde.length;}lettext=`\nafontcolor="0xb97432"size="24"b与好友或其他水平相近的玩家组队一起参战，赢得宝箱！d即使战败也不会损失奖杯eacfontb\n\n`+`afontcolor="0xb97432"size="24"b在线好友：${this.friendNum}人在线族员：${this.memberNum}人acfontb`letdata:CommonDlgData=newCommonDlgData;data.leftText=LanUtil.GetTextd"邀请好友"e;data.rightText=LanUtil.GetTextd"随机匹配"e;data.titleText=LanUtil.GetTextd"2V2对战"e;data.content=text;data.thisObj=this;data.leftFunc=de=b{ifdthis.memberNuma=0&&this.friendNuma=0e{TipsManager.ShowTipsdLanUtil.GetTextd"当前没有好友或族员在线，请进行随机匹配！"ee;}else{UIManager.ShowPaneldPanelTypeConst.RightDZRecommende;}};data.rightFunc=de=b{ClientNet.NetMatch.C2SBeginMatchdPVPType.VS_2_2e;};data.closeFunc=de=b{game.logd"---点击了关闭按钮!!!"e;};UIManager.ShowPaneldPanelTypeConst.CommonDlg,datae;}cc1V1privateOn1V1Clickedde{ccUIManager.ShowPaneldPanelTypeConst.WarUIe;ClientNet.NetMatch.C2SBeginMatchdPVPType.VS_1_1e;}privateRefreshChangeLeaderdteamId:number=null,leaderId:number=nulle{lettMgr=MainDataMgr.GetInstancede.teamDataMgrletteamInfo=tMgr.GetCurrTeamInfode;ifdteamInfo==nullereturn;this.kingIcon.source=`kingtower_${teamInfo.leader}_png`;}}}﻿modulegame{exportclassRightDZRecomItemData{publicid:number;publictype:number;cc标记是好友还是成员，即使成员又是好友，则为好友1好友2成员publicconstructorde{}publicDestroyde{}}exportclassRightDZRecomItemextendsItemRenderBase{joinBtn:SButton;headIcon:HeadIcon;privatememberName:eui.Label;privatecups:eui.Label;privatefamilyName:eui.Labelpublicconstructorde{superd"RightDZRecomItemSkin"e;}publiccreateChildrende{super.createChildrende;this.joinBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnJoinTap,thise;this.headIcon.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnHeadIconTap,thise;}publicDestroyde{letdata=this.dataasRightDZRecomItemDataifddata!=null&&data.Destroye{data.Destroyde;}this.joinBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnJoinTap,thise;this.headIcon.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnHeadIconTap,thise;}publicdataChangedde{letdata=this.dataasRightDZRecomItemData;letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;ifdfriendDataMgr!=nulle{letfriend=friendDataMgr.GetFriendddata.ide;this.memberName.text=friend.name;this.cups.text=Stringdfriend.cupCounte;}}publicOnJoinTapde{letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;ifdfriendDataMgr!=nulle{letfriend=friendDataMgr.GetFrienddthis.data.ide;ifdfriend!=nulle{ifdfriend.isOnline==falsee{TipsManager.ShowTipsdLanUtil.GetTextd"玩家已经下线！"ee;return;}}else{return;}}else{return;}ClientNet.NetMatch.C2SBeginMatchdPVPType.VS_2_2e;}publicOnHeadIconTapde{TipsManager.ShowTipsdLanUtil.GetTextd"弹出个人信息界面"ee;}}}﻿modulegame{exportclassRightDZRecommendCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnRightDZRecommendPanel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,falsee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿c****cmodulegame{exportclassRightDZRecommendPanelData{recommList:RightDZRecomItemData[];publicconstructorde{}publicInitde{this.recommList=[];}publicDestroyde{letitem:RightDZRecomItemData;whiledthis.recommList.lengthb0e{item=this.recommList.shiftde;item.Destroyde;}}}exportclassRightDZRecommendPanelextendsUIComponentBase{privatecloseBtn:SButton;privaterecomList:eui.List;privateonLineLb:eui.Label;privateshareBtn:SButton;privatenoneTips:eui.Group;publicinfo:RightDZRecommendPanelData;publicconstructorde{superd"RightDZRecomPanelSkin"e;}protectedchildrenCreatedde{super.childrenCreatedde;this.AddTouchEventdthis.closeBtn,this.OnCloseTap,thise;this.AddTouchEventdthis.shareBtn,this.OnShareTap,thise;this.InitCBde;}privateInitCBde{this.info=newRightDZRecommendPanelDatade;this.RefreshListde;this.RefreshOnLineNumde;}protectedDestroyde{this.RemoveListItemde;this.info.Destroyde;this.info=null;}privateRefreshListde{this.RemoveListItemde;this.recomList.itemRenderer=RightDZRecomItem;this.info.recommList=this.PackListDatade;ifdthis.info.recommList.lengthb0e{this.recomList.visible=true;this.noneTips.visible=false;this.recomList.dataProvider=neweui.ArrayCollectiondthis.info.recommListe;}else{this.recomList.visible=false;this.noneTips.visible=true;}}privateRefreshOnLineNumde{letfamilyDataMgr=MainDataMgr.GetInstancede.familyDataMgr;letmemberOnLineNum=0;ifdfamilyDataMgr!=null&&familyDataMgr.myFamily!=nulle{memberOnLineNum=familyDataMgr.myFamily.GetOnlineMemberde.length;}this.onLineLb.textFlow=dnewegret.HtmlTextParserdee.parserd`当前在线族员:afontcolor="0x23aa1f"b${memberOnLineNum}acfontb人`e;}privateRemoveListItemde{letitem:RightDZRecomItem;whiledthis.recomList.numChildrenb0e{item=this.recomList.removeChildAtd0easRightDZRecomItem;item.Destroyde;}}privatePackListDatade{letarr=[];letfriendDataMgr=MainDataMgr.GetInstancede.friendDataMgr;letdzDataMgr=MainDataMgr.GetInstancede.dzDataMgr;ifdfriendDataMgr!=null&&friendDataMgr.friendItemArray!=null&&dzDataMgr!=nulle{letfriends=friendDataMgr.GetOnlineFriendddzDataMgr.matchFriendClassLve;fordletfriendoffriendse{letd=newRightDZRecomItemDatade;d.id=friend.idarr.pushdde;}}returnarr;}privateOnCloseTapde:egret.TouchEvente{UIManager.HidePaneldPanelTypeConst.RightDZRecommende;}privateOnShareTapde{TipsManager.ShowTipsdLanUtil.GetTextd"点击分享"ee;}}}﻿modulegame{exportclassRightRWCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return["home_rightrw"];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.mainCenterLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnRightRWPanel;}cc做一下类型转换方便调用一定要有!!!protectedgetrightRWPanelde{returnaRightRWPanelbthis.panel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,falsee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld0e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}c***初始化面板数据*cpublicInitDatade:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}}}﻿modulegame{exportclassRWCellData{publictaskId:number;publicstartTime:number;publicconstructorde{}}exportclassRightRWNextItemextendseui.Componentimplementseui.IItemRenderer{cc-------------接口必须实现数据----------------private_data:RWCellData;publicsetdataddata:RWCellDatae{this._data=data;}publicgetdatade:RWCellData{returnthis._data;}publicselected:boolean;publicitemIndex:number;cc-------------接口必须实现数据----------------publicconstructorde{superde;this.skinName="RightRWNextItemSkin";}protectedDestroyde{}}exportclassRightRWItemextendsItemRenderBase{publictaskInfo:eui.Group;publictitleLabel:eui.Label;publicdescLabel:eui.Label;publicprogBar:eui.ProgressBar;publicrewardInfo:eui.Group;publicgetBtn:SButton;publicrefreshBtn:SButton;publicitemIcon1:eui.Image;publicitemIcon2:eui.Image;publicitemCount1:eui.Label;publicitemCount2:eui.Label;publicnextInfo:eui.Group;publicnextTimeLabel:eui.Label;privatetimerKey:number;publicconstructorde{superd"RightRWItemSkin"e;}privateisCreated:boolean=false;protectedchildrenCreatedde{super.childrenCreatedde;this.isCreated=true;ifdthis.data!=nulle{this.UpdateViewdthis.datae;}this.getBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnGetBtnClicked,thise;this.refreshBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRefreshTask,thise;this.getBtn.SetBolddtruee;};dataChangedde{this.UpdateViewdthis.datae;}privateOnGetBtnClickedde:egret.TouchEvente{ClientNet.NetTask.C2SFinishTaskdthis.data.taskIde;}privateOnRefreshTaskde:egret.TouchEvente{letdata:CommonDlgData=newCommonDlgData;data.titleText=LanUtil.GetTextd"刷新任务"e;data.leftText=LanUtil.GetTextd"取消"e;data.leftIcon=Const.ButtonImg.RED;data.leftTextColor=0xca4a4a;lettext="";letcostInfo=newIconTextData;letcost=game.MainDataMgr.GetInstancede.taskDataMgr.refreshCost;costInfo.titleText=LanUtil.GetFormatd`当前花费:`e;costInfo.descColor=0xB97432;costInfo.icon=`home_ui_common_json.icon_top_diamond`;costInfo.descText=Stringdcoste;letenough=game.MainDataMgr.GetInstancede.diamandb=cost;ifdenough==truee{data.rightText=LanUtil.GetTextd"刷新"e;data.rightIcon=Const.ButtonImg.GREEN;costInfo.descColor=0xB97432;text=LanUtil.GetTextd"\nd每日赠送三次免费刷新机会e"e;}else{data.rightText=LanUtil.GetTextd"购买钻石"e;data.rightIcon=Const.ButtonImg.YELLOW;data.rightTextColor=0xc17c1a;letnotEnoughColor=0xda404b;costInfo.descColor=notEnoughColor;text=`\nafontcolor="${notEnoughColor}"bd钻石余额不足eacfontb`;}data.content=text;data.thisObj=this;data.leftFunc=de=b{};data.rightFunc=de=b{ifdenough==trueeClientNet.NetTask.C2SRefreshTaskdthis.data.taskIde;else{TipsManager.ShowTipsdLanUtil.GetTextd"前去购买钻石"ee;}};data.closeFunc=de=b{game.logd"---点击了关闭按钮!!!"e;};UIManager.ShowPaneldPanelTypeConst.CommonDlg,datae;}privateUpdateViewddata:RWCellDatae{ifd!this.isCreatedereturn;ifdthis.data!=null&&this.data.startTime!=0&&this.timerKey==nullethis.timerKey=TimerMgr.GetInstancede.AddTimerd1000,this.UpdateData,thise;this.UpdateDatade;}privateUpdateDatade:boolean{lettaskDataMgr=MainDataMgr.GetInstancede.taskDataMgr;lettaskId=this.data.taskId;lettaskObj=taskDataMgr.GetTaskdtaskIde;this.nextInfo.visible=dtaskObj.startTime!=0e;this.taskInfo.visible=dtaskObj.startTime==0e;ifdtaskObj.startTime!=0e{letleftTime=HomeServerTime.GetLeftTimedtaskObj.startTimee;this.nextTimeLabel.textFlow=this.GetFormatTimedleftTimee;}else{this.titleLabel.text=taskObj.name;this.descLabel.text=taskObj.desc;this.progBar.maximum=taskObj.totalCount;this.progBar.minimum=0;this.progBar.value=taskObj.nowCount;this.getBtn.visible=dtaskObj.nowCountb=taskObj.totalCounte;this.rewardInfo.visible=dtaskObj.nowCountataskObj.totalCounte;letitemInfoArray=taskObj.GetRewardde;ifditemInfoArray.lengtha2e{game.logd"-----taskerror:",taskIde;returntrue;}letitemInfo=itemInfoArray[0];letitemSource=this.GetItemSourceditemInfo.itemide;this.itemIcon1.source=itemSource;this.itemCount1.text=`${itemInfo.count}`;itemInfo=itemInfoArray[1];itemSource=this.GetItemSourceditemInfo.itemide;this.itemIcon2.source=itemSource;this.itemCount2.text=`${itemInfo.count}`;}returntrue;}privateGetItemSourcedid:numbere:string{ifdid==2ereturn"home_ui_common_json.icon_top_coin";elseifdid==3ereturn"home_ui_common_json.icon_top_diamond";elsereturnid.toStringde;}privateGetFormatTimedtime:numbere:any{time=Math.floordtimec1000e;ifdtimeb24*3600e{letday=Math.floordtimec24c3600e;time=time-day*24*3600;lethour=Math.floordtimec3600e;returnaArrayaegret.ITextElementbb[{text:LanUtil.GetTextd"下个任务:"e,style:{"textColor":0xb57962,"size":24,"fontFamily":"desc_font"}},{text:`${day}`,style:{"textColor":0xb57962,"size":26,"fontFamily":"main_font"}},{text:LanUtil.GetFormatd`天`e,style:{"textColor":0xb57962,"size":24,"fontFamily":"desc_font"}},{text:`${hour}`,style:{"textColor":0xb57962,"size":26,"fontFamily":"main_font"}},{text:LanUtil.GetFormatd`小时`e,style:{"textColor":0xb57962,"size":24,"fontFamily":"desc_font"}}];}elseifdtimeb3600e{lethour=Math.floordtimec3600e;time=time-hour*3600;letmin=Math.floordtimec60e;returnaArrayaegret.ITextElementbb[{text:LanUtil.GetTextd"下个任务:"e,style:{"textColor":0xb57962,"size":24,"fontFamily":"desc_font"}},{text:`${hour}`,style:{"textColor":0xb57962,"size":26,"fontFamily":"main_font"}},{text:LanUtil.GetFormatd`小时`e,style:{"textColor":0xb57962,"size":24,"fontFamily":"desc_font"}},{text:`${min}`,style:{"textColor":0xb57962,"size":26,"fontFamily":"main_font"}},{text:LanUtil.GetFormatd`分钟`e,style:{"textColor":0xb57962,"size":24,"fontFamily":"desc_font"}}];}elseifdtimeb0e{letmin=Math.floordtimec60e;time=time-min*60;letsec=time;returnaArrayaegret.ITextElementbb[{text:LanUtil.GetTextd"下个任务:"e,style:{"textColor":0xb57962,"size":24,"fontFamily":"desc_font"}},{text:`${min}`,style:{"textColor":0xb57962,"size":26,"fontFamily":"main_font"}},{text:LanUtil.GetFormatd`分钟`e,style:{"textColor":0xb57962,"size":24,"fontFamily":"desc_font"}},{text:`${sec}`,style:{"textColor":0xb57962,"size":26,"fontFamily":"main_font"}},{text:LanUtil.GetFormatd`秒`e,style:{"textColor":0xb57962,"size":24,"fontFamily":"desc_font"}}];}else{returnaArrayaegret.ITextElementbb[{text:LanUtil.GetTextd"下个任务：即将刷新:"e,style:{"textColor":0xb57962,"size":24,"fontFamily":"desc_font"}}];}}protectedDestroyde{this.getBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnGetBtnClicked,thise;this.refreshBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRefreshTask,thise;ifdthis.timerKey!=nulle{TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=null;}}}}﻿c****cmodulegame{exportclassRightRWPanelextendsUIComponentBase{publicroot:eui.Group;publicgetBtn:SButton;publicscore_bar:eui.ProgressBar;publicgame_list_scroller:eui.Scroller;publicgame_scroll_bar:eui.VScrollBar;publicgame_list1:SEuiList;publicrwCellDatas:RWCellData[];publicconstructorde{superd"RightRWSkin"e;}protectedchildrenCreatedde{super.childrenCreatedde;this.getBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnGetReward,thise;this.getBtn.SetBolddtruee;this.InitCBde;}privateInitCBde{lettaskDataMgr=MainDataMgr.GetInstancede.taskDataMgr;this.AddPropCBdtaskDataMgr,"score",this.RefreshScore,thise;this.AddPropCBdtaskDataMgr,"allTaskArray",this.RefreshList,thise;}privateRefreshScorede{lettaskDataMgr=MainDataMgr.GetInstancede.taskDataMgr;letisFull=dtaskDataMgr.scoreb=taskDataMgr.maxScoree;RenderUtils.SetGreydthis.getBtn,!isFulle;this.score_bar.labelFunction=dvalue:number,maxValue:numbere=b{return`${value}!${maxValue}`};this.score_bar.maximum=taskDataMgr.maxScore;this.score_bar.minimum=0;this.score_bar.value=taskDataMgr.score;}privateRefreshListde{this.DestroyTaskde;this.rwCellDatas=[];lettaskDataMgr=MainDataMgr.GetInstancede.taskDataMgr;lettaskArray=taskDataMgr.GetAllTaskde;letgameData;fordlettaskObjoftaskArraye{gameData=newRWCellDatade;gameData.taskId=taskObj.id;gameData.startTime=taskObj.startTime;this.rwCellDatas.pushdgameDatae;}cc刷新数据this.game_list1.itemRenderer=RightRWItem;this.game_list1.dataProvider=neweui.ArrayCollectiondthis.rwCellDatase;this.game_list1.contentHeight=150*taskArray.length;ccthis.game_list1.updateRenderer=this.GameCell.binddthise;}c***List更新数据时调用*cprivateGameCelldrenderer:eui.IItemRenderer,itemIndex:number,data:anye:eui.IItemRenderer{renderer.data=data;renderer.itemIndex=itemIndex;returnrenderer;}publicDestroyTaskde{this.rwCellDatas=null;fordleti=0;iathis.game_list1.numChildren;i++e{letgameCellView=this.game_list1.getChildAtdieasRightRWItem;gameCellView.DestroyAllde;}}protectedDestroyde{this.getBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnGetReward,thise;this.DestroyTaskde;this.RemoveAllCBde;}cc领奖privateOnGetRewardde{ClientNet.NetTask.C2SRefreshScorede;}}}﻿modulegame{exportclassRightSSCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return["home_rightss"];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.mainCenterLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnRightSSPanel;}cc做一下类型转换方便调用一定要有!!!protectedgetrightSSPanelde{returnaRightSSPanelbthis.panel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,falsee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld0e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}c***初始化面板数据*cpublicInitDatade:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}}}﻿c****cmodulegame{exportclassRightSSPanelextendsUIComponentBase{publicroot:eui.Group;publicpws:SGroup;publicpwsBtn:SButton;publicpwsTimeImg:eui.Image;publicpwsTimeLabel:eui.Label;publicpwsLock:eui.Image;publicpwsTimeBg:eui.Image;publiczbs:SGroup;publiczbsBtn:SButton;publiczbsTimeImg:eui.Image;publiczbsTimeLabel:eui.Label;publiczbsLock:eui.Image;privatetimerKey:number;publicconstructorde{superd"RightSSSkin"e;this.timerKey=TimerMgr.GetInstancede.AddTimerd1000,this.Update,thise;}protectedchildrenCreatedde{super.childrenCreatedde;this.pws.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnZBSClicked,thise;this.zbs.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnPWSClicked,thise;this.InitCBde;}privateInitCBde{letzbsDataMgr=MainDataMgr.GetInstancede.zbsDataMgr;letpwsDataMgr=MainDataMgr.GetInstancede.pwsDataMgr;this.AddPropCBdzbsDataMgr,"endTime",this.RefreshZBSInfo,thise;this.AddPropCBdpwsDataMgr,"endTime",this.RefreshPWSInfo,thise;}privateUpdatede{this.RefreshZBSInfode;this.RefreshPWSInfode;returntrue;}privateRefreshZBSInfode{letmainDataMgr=MainDataMgr.GetInstancede;letzbsDataMgr=MainDataMgr.GetInstancede.zbsDataMgr;this.zbsLock.visible=dmainDataMgr.levelazbsDataMgr.minLevele;letleftTime=zbsDataMgr.GetLeftTimede;ifdleftTimeb24*3600*1000e{this.zbsTimeImg.source=RES.getResd"home_ui_common_json.icon_ss_pws_sz"e;this.zbsTimeLabel.textColor=0x8b6348;ccthis.zbsTimeLabel.text=this.GetFormatTimedleftTimee;this.zbsTimeLabel.textFlow=this.GetFormatTimedleftTimee;}else{this.zbsTimeImg.source=RES.getResd"home_ui_common_json.icon_ss_pws_sz_red"e;this.zbsTimeLabel.textColor=0xa4462a;ccthis.zbsTimeLabel.text=this.GetFormatTimedleftTimee;this.zbsTimeLabel.textFlow=this.GetFormatTimedleftTimee;}}privateRefreshPWSInfode{letmainDataMgr=MainDataMgr.GetInstancede;letpwsDataMgr=MainDataMgr.GetInstancede.pwsDataMgr;this.pwsLock.visible=dmainDataMgr.cupCountapwsDataMgr.minCupCounte;letleftTime=pwsDataMgr.GetLeftTimede;ifdleftTimeb24*3600*1000e{this.pwsTimeImg.source=RES.getResd"home_ui_common_json.icon_ss_pws_sz"e;this.pwsTimeBg.source=RES.getResd"home_ui_common_json.icon_ss_pws_sjx"e;this.pwsTimeLabel.textColor=0x8b6348;ccthis.pwsTimeLabel.text=this.GetFormatTimedleftTimee;this.pwsTimeLabel.textFlow=this.GetFormatTimedleftTimee;}else{this.pwsTimeImg.source=RES.getResd"home_ui_common_json.icon_ss_pws_sz_red"e;this.pwsTimeBg.source=RES.getResd"home_ui_common_json.icon_ss_pws_sjx_red"e;this.pwsTimeLabel.textColor=0xa4462a;ccthis.pwsTimeLabel.text=this.GetFormatTimedleftTimee;this.pwsTimeLabel.textFlow=this.GetFormatTimedleftTimee;}}privateGetFormatTimedtime:numbere:any{cclettextFlow=aArrayaegret.ITextElementbb[cc{text:"距离结束:",style:{"textColor":0x00ff00,"size":18,"fontFamily":"desc_font"}}cc,{text:`在线好友：0人在线组员：2人`,style:{"textColor":0x00ff00,"size":18,"fontFamily":"楷体"}}cc];time=Math.floordtimec1000e;ifdtimeb24*3600e{letday=Math.floordtimec24c3600e;time=time-day*24*3600;lethour=Math.floordtimec3600e;returnaArrayaegret.ITextElementbb[{text:LanUtil.GetTextd"距离结束:"e,style:{"textColor":0xa36844,"size":24,"fontFamily":"desc_font"}},{text:`${day}`,style:{"textColor":0xa36844,"size":24,"fontFamily":"main_font"}},{text:LanUtil.GetFormatd`天`e,style:{"textColor":0xa36844,"size":24,"fontFamily":"desc_font"}},{text:`${hour}`,style:{"textColor":0xa36844,"size":24,"fontFamily":"main_font"}},{text:LanUtil.GetFormatd`小时`e,style:{"textColor":0xa36844,"size":24,"fontFamily":"desc_font"}}];ccreturn`距离结束:${day}天${hour}小时`;}elseifdtimeb3600e{lethour=Math.floordtimec3600e;time=time-hour*3600;letmin=Math.floordtimec60e;returnaArrayaegret.ITextElementbb[{text:LanUtil.GetTextd"距离结束:"e,style:{"textColor":0xc25f42,"size":24,"fontFamily":"desc_font"}},{text:`${hour}`,style:{"textColor":0xc25f42,"size":24,"fontFamily":"main_font"}},{text:LanUtil.GetFormatd`小时`e,style:{"textColor":0xc25f42,"size":24,"fontFamily":"desc_font"}},{text:`${min}`,style:{"textColor":0xc25f42,"size":24,"fontFamily":"main_font"}},{text:LanUtil.GetFormatd`分钟`e,style:{"textColor":0xc25f42,"size":24,"fontFamily":"desc_font"}}];ccreturn`距离结束:${hour}小时${min}分钟`;}elseifdtimeb0e{letmin=Math.floordtimec60e;time=time-min*60;letsec=time;returnaArrayaegret.ITextElementbb[{text:LanUtil.GetTextd"距离结束:"e,style:{"textColor":0xc25f42,"size":24,"fontFamily":"desc_font","bold":true}},{text:`${min}`,style:{"textColor":0xc25f42,"size":24,"fontFamily":"main_font"}},{text:LanUtil.GetFormatd`分钟`e,style:{"textColor":0xc25f42,"size":24,"fontFamily":"desc_font","bold":true}},{text:`${sec}`,style:{"textColor":0xc25f42,"size":24,"fontFamily":"main_font"}},{text:LanUtil.GetFormatd`秒`e,style:{"textColor":0xc25f42,"size":24,"fontFamily":"desc_font","bold":true}}];ccreturn`距离结束:${min}分钟${sec}秒`;}else{returnaArrayaegret.ITextElementbb[{text:LanUtil.GetTextd"近期开启，敬请期待:"e,style:{"textColor":0xff0000,"size":24,"fontFamily":"desc_font"}}];ccreturn`近期开启，敬请期待`;}}protectedDestroyde{this.zbs.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnZBSClicked,thise;this.pws.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnPWSClicked,thise;ifdthis.timerKey!=nulle{TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=null;}}cc争霸赛privateOnZBSClickedde{letzbsDataMgr=MainDataMgr.GetInstancede.zbsDataMgr;ifdzbsDataMgr.GetLeftTimedea=0e{TipsManager.ShowTipsdLanUtil.GetTextd"排位赛近期开启，敬请期待"ee;}else{UIManager.ShowPaneldPanelTypeConst.PWSInfoe;}}cc排位赛privateOnPWSClickedde{letpwsDataMgr=MainDataMgr.GetInstancede.pwsDataMgr;ifdpwsDataMgr.GetLeftTimedea=0e{TipsManager.ShowTipsdLanUtil.GetTextd"排位赛近期开启，敬请期待"ee;}else{UIManager.ShowPaneldPanelTypeConst.PWSInfoe;}}}}﻿modulegame{exportclassRightTFCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return["home_rightss"];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.mainCenterLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnRightTFPanel;}cc做一下类型转换方便调用一定要有!!!protectedgetrightTFPanelde{returnaRightTFPanelbthis.panel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,falsee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld0e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}c***初始化面板数据*cpublicInitDatade:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}}}﻿c****cmodulegame{exportclassRightTFPanelextendsUIComponentBase{publicroot:eui.Group;publicpws:SGroup;publicpwsBtn:SButton;publicpwsTimeImg:eui.Image;publicpwsTimeLabel:eui.Label;publicpwsLock:eui.Image;publicpwsTimeBg:eui.Image;publiczbs:SGroup;publiczbsBtn:SButton;publiczbsTimeImg:eui.Image;publiczbsTimeLabel:eui.Label;publiczbsLock:eui.Image;privatetimerKey:number;publicconstructorde{superd"RightSSSkin"e;this.timerKey=TimerMgr.GetInstancede.AddTimerd1000,this.Update,thise;}protectedchildrenCreatedde{super.childrenCreatedde;this.pws.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnZBSClicked,thise;this.zbs.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnPWSClicked,thise;this.InitCBde;}privateInitCBde{letzbsDataMgr=MainDataMgr.GetInstancede.zbsDataMgr;letpwsDataMgr=MainDataMgr.GetInstancede.pwsDataMgr;this.AddPropCBdzbsDataMgr,"endTime",this.RefreshZBSInfo,thise;this.AddPropCBdpwsDataMgr,"endTime",this.RefreshPWSInfo,thise;}privateUpdatede{this.RefreshZBSInfode;this.RefreshPWSInfode;returntrue;}privateRefreshZBSInfode{letmainDataMgr=MainDataMgr.GetInstancede;letzbsDataMgr=MainDataMgr.GetInstancede.zbsDataMgr;this.zbsLock.visible=dmainDataMgr.levelazbsDataMgr.minLevele;letleftTime=zbsDataMgr.GetLeftTimede;ifdleftTimeb24*3600*1000e{this.zbsTimeImg.source=RES.getResd"home_ui_common_json.icon_ss_pws_sz"e;this.zbsTimeLabel.textColor=0x8b6348;ccthis.zbsTimeLabel.text=this.GetFormatTimedleftTimee;this.zbsTimeLabel.textFlow=this.GetFormatTimedleftTimee;}else{this.zbsTimeImg.source=RES.getResd"home_ui_common_json.icon_ss_pws_sz_red"e;this.zbsTimeLabel.textColor=0xa4462a;ccthis.zbsTimeLabel.text=this.GetFormatTimedleftTimee;this.zbsTimeLabel.textFlow=this.GetFormatTimedleftTimee;}}privateRefreshPWSInfode{letmainDataMgr=MainDataMgr.GetInstancede;letpwsDataMgr=MainDataMgr.GetInstancede.pwsDataMgr;this.pwsLock.visible=dmainDataMgr.cupCountapwsDataMgr.minCupCounte;letleftTime=pwsDataMgr.GetLeftTimede;ifdleftTimeb24*3600*1000e{this.pwsTimeImg.source=RES.getResd"home_ui_common_json.icon_ss_pws_sz"e;this.pwsTimeBg.source=RES.getResd"home_ui_common_json.icon_ss_pws_sjx"e;this.pwsTimeLabel.textColor=0x8b6348;ccthis.pwsTimeLabel.text=this.GetFormatTimedleftTimee;this.pwsTimeLabel.textFlow=this.GetFormatTimedleftTimee;}else{this.pwsTimeImg.source=RES.getResd"home_ui_common_json.icon_ss_pws_sz_red"e;this.pwsTimeBg.source=RES.getResd"home_ui_common_json.icon_ss_pws_sjx_red"e;this.pwsTimeLabel.textColor=0xa4462a;ccthis.pwsTimeLabel.text=this.GetFormatTimedleftTimee;this.pwsTimeLabel.textFlow=this.GetFormatTimedleftTimee;}}privateGetFormatTimedtime:numbere:any{cclettextFlow=aArrayaegret.ITextElementbb[cc{text:"距离结束:",style:{"textColor":0x00ff00,"size":18,"fontFamily":"desc_font"}}cc,{text:`在线好友：0人在线组员：2人`,style:{"textColor":0x00ff00,"size":18,"fontFamily":"楷体"}}cc];time=Math.floordtimec1000e;ifdtimeb24*3600e{letday=Math.floordtimec24c3600e;time=time-day*24*3600;lethour=Math.floordtimec3600e;returnaArrayaegret.ITextElementbb[{text:LanUtil.GetTextd"距离结束:"e,style:{"textColor":0x8b6348,"size":18,"fontFamily":"desc_font"}},{text:`${day}`,style:{"textColor":0x8b6348,"size":18,"fontFamily":"main_font"}},{text:LanUtil.GetFormatd`天`e,style:{"textColor":0x8b6348,"size":18,"fontFamily":"desc_font"}},{text:`${hour}`,style:{"textColor":0x8b6348,"size":18,"fontFamily":"main_font"}},{text:LanUtil.GetFormatd`小时`e,style:{"textColor":0x8b6348,"size":18,"fontFamily":"desc_font"}}];ccreturn`距离结束:${day}天${hour}小时`;}elseifdtimeb3600e{lethour=Math.floordtimec3600e;time=time-hour*3600;letmin=Math.floordtimec60e;returnaArrayaegret.ITextElementbb[{text:LanUtil.GetTextd"距离结束:"e,style:{"textColor":0xa4462a,"size":18,"fontFamily":"desc_font"}},{text:`${hour}`,style:{"textColor":0xa4462a,"size":18,"fontFamily":"main_font"}},{text:LanUtil.GetFormatd`小时`e,style:{"textColor":0xa4462a,"size":18,"fontFamily":"desc_font"}},{text:`${min}`,style:{"textColor":0xa4462a,"size":18,"fontFamily":"main_font"}},{text:LanUtil.GetFormatd`分钟`e,style:{"textColor":0xa4462a,"size":18,"fontFamily":"desc_font"}}];ccreturn`距离结束:${hour}小时${min}分钟`;}elseifdtimeb0e{letmin=Math.floordtimec60e;time=time-min*60;letsec=time;returnaArrayaegret.ITextElementbb[{text:LanUtil.GetTextd"距离结束:"e,style:{"textColor":0xa4462a,"size":18,"fontFamily":"desc_font","bold":true}},{text:`${min}`,style:{"textColor":0xa4462a,"size":18,"fontFamily":"main_font"}},{text:LanUtil.GetFormatd`分钟`e,style:{"textColor":0xa4462a,"size":18,"fontFamily":"desc_font","bold":true}},{text:`${sec}`,style:{"textColor":0xa4462a,"size":18,"fontFamily":"main_font"}},{text:LanUtil.GetFormatd`秒`e,style:{"textColor":0xa4462a,"size":18,"fontFamily":"desc_font","bold":true}}];ccreturn`距离结束:${min}分钟${sec}秒`;}else{returnaArrayaegret.ITextElementbb[{text:LanUtil.GetTextd"近期开启，敬请期待:"e,style:{"textColor":0xff0000,"size":18,"fontFamily":"desc_font"}}];ccreturn`近期开启，敬请期待`;}}protectedDestroyde{this.zbs.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnZBSClicked,thise;this.pws.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnPWSClicked,thise;ifdthis.timerKey!=nulle{TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=null;}}cc争霸赛privateOnZBSClickedde{letzbsDataMgr=MainDataMgr.GetInstancede.zbsDataMgr;ifdzbsDataMgr.GetLeftTimedea=0e{TipsManager.ShowTipsdLanUtil.GetTextd"排位赛近期开启，敬请期待"ee;}else{}}cc排位赛privateOnPWSClickedde{letpwsDataMgr=MainDataMgr.GetInstancede.pwsDataMgr;ifdpwsDataMgr.GetLeftTimedea=0e{TipsManager.ShowTipsdLanUtil.GetTextd"排位赛近期开启，敬请期待"ee;}else{}}}}﻿modulegame{exportclassMainTipsextendsUIComponentBase{publictipsLabel:eui.Label;publicconstructorde{superd""e;}protectedDestroyde{}}}﻿modulegame{exportclassMainUINewextendsUIComponentBase{publicmainCenter:MainCenter;privatebottomGroup:eui.Group;privateleftGroup:eui.Group;privaterightGroup:eui.Group;privatetopGroup:eui.Group;privatebtn1:BottomItem;privatebtn2:BottomItem;privatebtn3:BottomItem;privatebtn4:BottomItem;privatebtn5:BottomItem;privatebtn6:BottomItem;privatebtn7:BottomItem;privatedzBtn:RightItem;privatessBtn:RightItem;privaterwBtn:RightItem;privatetfBtn:RightItem;privaterank1:LeftItem;privaterank2:LeftItem;privaterank3:LeftItem;privateroleInfo:RoleInfo;privatecostInfo:CostInfo;privatemailBtn:MainButton;privatecjBtn:MainButton;privatereplayBtn:MainButton;privateszBtn:MainButton;privatecurrRightTab:RightItem;publicconstructorde{superd"MainUINewSkin"e;}protectedchildrenCreatedde:void{super.childrenCreatedde;GameLayerManager.gameLayerde.mainCenterLayer=this.mainCenter;}publicInitDatade{GlobalEvent.SubscribedGlobalEventType.RankAddItem,this.OnAddItem,thise;ccthis.OnAddItemdConst.RankType.LOCAL,1,5e;letmMgr=MainDataMgr.GetInstancede;this.AddPropCBdmMgr,"cupCount",de=b{this.leftGroup.visible=mMgr.cupCountb=100;}e;ClientNet.NetRank.C2SRankInfod1,3,Const.RankType.LOCALe;this.dzBtn.Initd["button_r_dz_0","button_r_dz_1",PanelTypeConst.RightDZ]e;this.ssBtn.Initd["button_r_ss_0","button_r_ss_1",PanelTypeConst.RightSS]e;this.rwBtn.Initd["button_r_rw_0","button_r_rw_1",PanelTypeConst.RightRW]e;this.tfBtn.Initd["button_r_tf_0","button_r_tf_1",PanelTypeConst.RightTF]e;this.InitTabViewdthis.dzBtne;this.btn1.InitRedDotd"main_bottom_ranking"e;this.btn2.InitRedDotd"main_bottom_kazu"e;this.btn3.InitRedDotd"main_bottom_jundui"e;this.btn4.InitRedDotd"main_bottom_family"e;this.btn5.InitRedDotd"main_bottom_friend"e;this.btn6.InitRedDotd"main_bottom_lingshi"e;this.btn7.InitRedDotd"main_bottom_shop"e;this.mailBtn.InitRedDotd"main_top_mail"e;this.AddTouchEventdthis.btn1,this.OnPHBClicked,thise;this.AddTouchEventdthis.btn2,this.OnKZClicked,thise;this.AddTouchEventdthis.btn3,this.OnJDClicked,thise;this.AddTouchEventdthis.btn4,this.OnJZClicked,thise;this.AddTouchEventdthis.btn5,this.OnHYClicked,thise;this.AddTouchEventdthis.btn6,this.OnLSClicked,thise;this.AddTouchEventdthis.btn7,this.OnSDClicked,thise;this.AddTouchEventdthis.dzBtn,this.OnDZTap,thise;this.AddTouchEventdthis.ssBtn,this.OnSSTap,thise;this.AddTouchEventdthis.rwBtn,this.OnRWTap,thise;this.AddTouchEventdthis.tfBtn,this.OnTFTap,thise;this.AddTouchEventdthis.roleInfo,this.OnRoleInfoTap,thise;this.AddTouchEventdthis.mailBtn,this.OnMailClicked,thise;this.AddTouchEventdthis.cjBtn,this.OnCJClicked,thise;this.AddTouchEventdthis.replayBtn,this.OnReplayClicked,thise;this.AddTouchEventdthis.szBtn,this.OnSZClicked,thise;}publicDestroyde{letleftItem:LeftItem;fordleti=0,len=this.leftGroup.numChildren;ialen;i++e{leftItem=this.leftGroup.getChildAtdieasLeftItem;leftItem.DestroyAllde;}letrightItem:RightItem;fordleti=0,len=this.rightGroup.numChildren;ialen;i++e{rightItem=this.rightGroup.getChildAtdieasRightItem;rightItem.Destroyde;}this.roleInfo.DestroyAllde;this.costInfo.DestroyAllde;this.currRightTab=null;GameLayerManager.gameLayerde.mainCenterLayer=null;GlobalEvent.UnSubscribedGlobalEventType.RankAddItem,this.OnAddItem,thise;this.mainCenter.DestroyAllde;}privateInitTabViewdtab:RightIteme{this.currRightTab=tab;this.currRightTab.selected=true;UIManager.ShowPaneldthis.currRightTab.paneIde;}privateChangeTabdtab:RightIteme{ifdthis.currRightTab!=nulle{this.currRightTab.selected=false;UIManager.HidePaneldthis.currRightTab.paneIde;}this.currRightTab=tab;UIManager.ShowPaneldthis.currRightTab.paneIde;}privateOnAddItemdtype:number,begin:number,end:numbere{ifdtype==Const.RankType.LOCAL&&endb=3e{letlocMap=MainDataMgr.GetInstancede.rankDataMgr.GetRankByTypedConst.RankInfoType.PLAYER,Const.RankType.LOCALe,item:LeftItem;ifdlocMap==nullereturn;fordleti=1;ia=3;i++e{item=this.leftGroup.getChildAtdi-1easLeftItem;ifditem==nullecontinue;item.visible=locMap.hasdie==true;item.data=[i];}}this.leftGroup.visible=MainDataMgr.GetInstancede.cupCountb=100;}cc----------------------------------------------------------------------顶部入口privateOnRoleInfoTapde{UIManager.ShowPaneldPanelTypeConst.RoleMainPanele;}cc邮件privateOnMailClickedde{UIManager.ShowPaneldPanelTypeConst.MailInfoe;}cc成就privateOnCJClickedde{UIManager.ShowPaneldPanelTypeConst.AchieveInfoe;}cc视频privateOnReplayClickedde{UIManager.ShowPaneldPanelTypeConst.ReplayInfoe;}cc设置privateOnSZClickedde{ccUIManager.ShowPaneldPanelTypeConst.EditorUIe;ccSoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;UIManager.ShowPaneldPanelTypeConst.SettingsInfoe;}cc----------------------------------------------------------------------右边入口cc对战privateOnDZTapde:egret.TouchEvente{this.ChangeTabde.targete;}cc赛事privateOnSSTapde:egret.TouchEvente{this.ChangeTabde.targete;}cc任务privateOnRWTapde:egret.TouchEvente{this.ChangeTabde.targete;}cc讨伐privateOnTFTapde:egret.TouchEvente{this.ChangeTabde.targete;}cc----------------------------------------------------------------------底下入口cc排行榜privateOnPHBClickedde{ccTipsManager.ShowTipsd"正在修~~~先屏蔽了"e;UIManager.ShowPaneldPanelTypeConst.RankMainPanele;}cc卡组privateOnKZClickedde{UIManager.ShowPaneldPanelTypeConst.TeamPanele;}cc军队privateOnJDClickedde{UIManager.ShowPaneldPanelTypeConst.KakuMainPanel,1e;}cc家族privateOnJZClickedde{letfamilyDataMgr=MainDataMgr.GetInstancede.familyDataMgr;ifdfamilyDataMgr==nullereturn;ifdfamilyDataMgr.CheckLockde==falseereturnTipsManager.ShowTipsdLanUtil.GetFormatd`{0}级后可以加入家族!`,familyDataMgr.OPEN_LEVELee;ifdfamilyDataMgr.CheckHasFamilyde==truee{UIManager.ShowPaneldPanelTypeConst.FamilyMainPanele;ccClientNet.NetFamily.C2SChatListde;ccClientNet.NetFamily.C2SFamilyInfodgame.MainDataMgr.GetInstancede.familyDataMgr.myFamily.ide;}else{UIManager.ShowPaneldPanelTypeConst.FamilyNoneMainPanele;ccClientNet.NetFamily.C2SRecommendFamilyde;}}cc好友privateOnHYClickedde{UIManager.ShowPaneldPanelTypeConst.FriendInfoe;}cc成就privateOnLSClickedde{UIManager.ShowPaneldPanelTypeConst.CMDDlge;}cc商店privateOnSDClickedde{UIManager.ShowPaneldPanelTypeConst.ShopInfoe;}}}﻿classRightDZRecomPanel{publicconstructorde{}}﻿c***角色信息*cmodulegame{exportclassRightItemextendseui.ToggleButton{publicdefaultBg:eui.Image;publicselectBg:eui.Image;privateredDotImg:eui.Image;private_selected:boolean=false;publicpaneId:number;publicconstructorde{superde;this.skinName="RightItemSkin";}publicInitdinfo:any[]e{this.paneId=info[2];this.defaultBg.source=info[0];this.selectBg.source=info[1];}publicDestroyde{}publicsetselecteddflag:booleane{this._selected=flag;ifdflag==truee{this.defaultBg.visible=false;this.selectBg.visible=true;}else{this.defaultBg.visible=true;this.selectBg.visible=false;}}publicgetselectedde{returnthis._selected;}}}﻿c***角色信息*cmodulegame{exportclassRoleInfoextendsUIComponentBase{publicheadIcon:HeadIcon;publicplayerName:eui.Label;publicfamilyName:eui.Label;publiccupCount:eui.BitmapLabel;publicconstructorde{superd"RoleInfoSkin"e;}protectedchildrenCreatedde:void{super.childrenCreatedde;this.headIconletmMgr=MainDataMgr.GetInstancede;this.playerName.text=mMgr.userName.toStringde;this.familyName.text=mMgr.familyName.toStringde;this.headIcon.SetIcond1e;this.AddPropCBdmMgr,"cupCount",de=b{this.cupCount.text=mMgr.cupCount.toStringde;},thise;}protectedDestroyde{}}}﻿modulegame{exportclassRankHeroKa1extendsItemRenderBase{privatebg:eui.Image;privateheroIcon:eui.Image;privatetypeIcon:eui.Image;privatecampBg:eui.Image;privatelevel:HeroLevel;privatecost:eui.BitmapLabel;privatetestId:eui.Label;privateupTips:eui.Image;publicheroInfo:RankPlayerTeam;privateisC:boolean;publicconstructorde{superd"HeroKa1Skin"e;this.Initde;}publicInitde{this.isC=false;}publicDestroyde{this.isC=falsethis.heroInfo.Destroyde;this.level.Destroyde;}publicdataChangedde{this.heroInfo=this.data;ifdthis.heroInfo==nullereturn;letheroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetCfgdthis.heroInfo.heroIde;ifdheroInfo==nullereturn;this.bg.source=`common_ui_common_json.bg_card_di_${heroInfo.quality}`;ifdRES.hasResd`common_ui_heroicon_json.${this.heroInfo.heroId}`e==trueethis.heroIcon.source=`common_ui_heroicon_json.${this.heroInfo.heroId}`;elsethis.heroIcon.source="";this.cost.text=StringdheroInfo.coste;this.testId.text=Stringdthis.heroInfo.heroIde;this.testId.visible=GameData.DevelopMode==DevelopMode.DebugifdheroInfo.camp!=0e{this.typeIcon.visible=this.campBg.visible=true;this.typeIcon.source=`home_ui_kz_json.icon_sl_0${heroInfo.camp}_s`;}else{this.campBg.visible=false;this.typeIcon.visible=false;}this.level.SetLvdthis.heroInfo.level,heroInfo.qualitye}}}modulegame{exportclassRankJiaZuPanelextendsUIComponentBase{privatebtn1:RankPlayerBtn;privatebtn2:RankPlayerBtn;privatelist:eui.List;privatescro:eui.Scroller;privatenoneTips:eui.Image;privateupdateList:eui.ArrayCollection;privatecurrBtn:RankPlayerBtn;publicconstructorde{superd"RankPlayerPanelSkin"e;}protectedchildrenCreatedde{super.childrenCreatedde;}publicInitDatade{this.updateList=neweui.ArrayCollectionde;this.list.itemRenderer=RankPlayerItem2;this.list.dataProvider=this.updateList;this.btn1.type=Const.RankType.GLOBAL;this.btn2.type=Const.RankType.LOCAL;this.list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;this.scro.addEventListenerdeui.UIEvent.CHANGE,this.OnChange,thise;this.scro.addEventListenerdeui.UIEvent.CHANGE_END,this.OnChangeEnd,thise;ccGlobalEvent.SubscribedGlobalEventType.RankAddItem,this.OnAddItem,thise;this.ChangeTypedthis.btn1e;cc当实现此页面功能时，恢复这些代码ccletrankInfo=MainDataMgr.GetInstancede.rankDataMgr.GetRankInfodConst.RankInfoType.FAMILYe;ccrankInfo.ResetIndexde;ccMainDataMgr.GetInstancede.rankDataMgr.ReqNewRankInfodConst.RankInfoType.FAMILY,Const.RankType.GLOBALe;ccMainDataMgr.GetInstancede.rankDataMgr.ReqNewRankInfodConst.RankInfoType.FAMILY,Const.RankType.LOCALe;cc不应该一次性请求两个的this.AddTouchEventdthis.btn1,this.OnRankTypeTap,thise;this.AddTouchEventdthis.btn2,this.OnRankTypeTap,thise;ccthis.btn1.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRankTypeTap,thise;ccthis.btn2.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRankTypeTap,thise;}protectedDestroyde{this.RemoveAllUpdateListde;this.updateList=null;this.currBtn=null;this.btn1.Destroyde;this.btn2.Destroyde;this.list.removeEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;this.scro.removeEventListenerdeui.UIEvent.CHANGE,this.OnChange,thise;this.scro.removeEventListenerdeui.UIEvent.CHANGE_END,this.OnChangeEnd,thise;ccthis.btn1.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRankTypeTap,thise;ccthis.btn2.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRankTypeTap,thise;GlobalEvent.UnSubscribedGlobalEventType.RankAddItem,this.OnAddItem,thise;}cc----------------------------------------------------------------------EditprivateChangeTypedbtn:RankPlayerBtne{ccifdthis.currBtn!=nulleccthis.currBtn.selected=false;ccthis.currBtn=btn;ccthis.currBtn.selected=true;ccthis.RemoveAllUpdateListde;ccthis.scro.viewport.scrollV=0;cclettype=this.currBtn.type;ccletgData=MainDataMgr.GetInstancede.rankDataMgr.GetRankByTypedConst.RankInfoType.FAMILY,typee;ccifdgData==nullereturn;ccletgArray=gData.valuesde;ccifdgArray.lengthb0ecc{ccfordleti=0,len=gArray.length;ialen;i++ecc{ccletitem=newRankPlayerDatItemde;ccitem.rank=gArray[i].rank;ccitem.rankType=gArray[i].type;ccitem.glolocType=this.currBtn.type;ccthis.updateList.addItemditeme;cc}ccthis.noneTips.visible=false;ccthis.scro.visible=true;cc}ccelsecc{ccthis.noneTips.visible=true;ccthis.scro.visible=false;cc}}cc----------------------------------------------------------------------EventprivateOnItemTapde:eui.ItemTapEvente{ccifde.item!=nullecc{ccSoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;ccletdata=e.itemasRankPlayerDatItem;ccletinfo=newRankPlayerInfoMainPanelDatade.PackDataddata.glolocType,data.rankType,data.ranke;ccUIManager.ShowPaneldPanelTypeConst.RankPlayerInfoMainPanel,infoe;cc}}privateOnRankTypeTapde:egret.TouchEvente{SoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;ifdegret.isde.target,"RankPlayerBtn"e==true||egret.isde.target,"eui.Button"e==trueethis.ChangeTypede.targete}privateisChangeEnd:boolean=true;privateOnChangede:eui.UIEvente{ifdthis.scro.viewport.scrollVb=this.list.measuredHeight-this.list.heighte{ifdthis.isChangeEnd==truee{this.isChangeEnd=false;letpRankInfo=MainDataMgr.GetInstancede.rankDataMgr.GetRankInfodConst.RankInfoType.FAMILYe;letgloIndex=pRankInfo.gloCurrIndex;letlocIndex=pRankInfo.localCurrIndex;ifdthis.currBtn.type==Const.RankType.GLOBAL&&gloIndexapRankInfo.maxRankNume{letend=Math.mindgloIndex+pRankInfo.reqSpace,pRankInfo.maxRankNume;ClientNet.NetRank.C2SRankInfodgloIndex,end,1e;}elseifdthis.currBtn.type==Const.RankType.LOCAL&&locIndexapRankInfo.maxRankNume{letend=Math.mindlocIndex+pRankInfo.reqSpace,pRankInfo.maxRankNume;ClientNet.NetRank.C2SRankInfodlocIndex,end,2e;}}}}privateOnChangeEndde:eui.UIEvente{this.isChangeEnd=true;}privateOnAddItemdtype:number,beign:number,end:numbere{ccletrMap:SMapanumber,RankDataItemb=MainDataMgr.GetInstancede.rankDataMgr.GetRankByTypedConst.RankInfoType.FAMILY,typee;ccfordleti=beign,len=end;ialen;i++ecc{ccifdthis.updateList.lengthaiecc{ccletitem=newRankPlayerDatItemde;ccletinfo=rMap.getdie;ccifdinfo==nullecontinue;ccitem.rank=info.rank;ccitem.rankType=type;ccitem.glolocType=this.currBtn.type;ccthis.updateList.addItemditemecc}ccelsecc{ccletitem=this.updateList.getItemAtdbeign-1eccifditem!=nulleccthis.updateList.itemUpdatedditeme;cc}cc}ccthis.noneTips.visible=false;ccthis.scro.visible=true;}privateRemoveAllUpdateListde{ccletitem:RankPlayerDatItem;ccfordleti=0,len=this.updateList.length;ialen;i++ecc{ccitem=this.updateList.getItemAtdie;ccitem.Destroyde;cc}ccthis.updateList.removeAllde;}}}modulegame{exportclassRankJiaZuZhanPanelextendsUIComponentBase{privatebtn1:RankPlayerBtn;privatebtn2:RankPlayerBtn;privatelist:eui.List;privatescro:eui.Scroller;privatenoneTips:eui.Image;privateupdateList:eui.ArrayCollection;privatecurrBtn:RankPlayerBtn;publicconstructorde{superd"RankPlayerPanelSkin"e;}protectedchildrenCreatedde{super.childrenCreatedde;}publicInitDatade{this.updateList=neweui.ArrayCollectionde;this.list.itemRenderer=RankPlayerItem2;this.list.dataProvider=this.updateList;this.btn1.type=Const.RankType.GLOBAL;this.btn2.type=Const.RankType.LOCAL;this.list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;this.scro.addEventListenerdeui.UIEvent.CHANGE,this.OnChange,thise;this.scro.addEventListenerdeui.UIEvent.CHANGE_END,this.OnChangeEnd,thise;ccGlobalEvent.SubscribedGlobalEventType.RankAddItem,this.OnAddItem,thise;this.ChangeTypedthis.btn1e;cc当实现此页面功能时，恢复这些代码ccletrankInfo=MainDataMgr.GetInstancede.rankDataMgr.GetRankInfodConst.RankInfoType.FIGHTe;ccrankInfo.ResetIndexde;ccMainDataMgr.GetInstancede.rankDataMgr.ReqNewRankInfodConst.RankInfoType.FIGHT,Const.RankType.GLOBALe;ccMainDataMgr.GetInstancede.rankDataMgr.ReqNewRankInfodConst.RankInfoType.FIGHT,Const.RankType.LOCALe;cc不应该一次性请求两个的this.AddTouchEventdthis.btn1,this.OnRankTypeTap,thise;this.AddTouchEventdthis.btn2,this.OnRankTypeTap,thise;ccthis.btn1.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRankTypeTap,thise;ccthis.btn2.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRankTypeTap,thise;}protectedDestroyde{RenderUtils.RemoveUpdateListdthis.updateListe;RenderUtils.RemoveListdthis.liste;this.updateList=null;this.currBtn=null;this.btn1.Destroyde;this.btn2.Destroyde;this.list.removeEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;this.scro.removeEventListenerdeui.UIEvent.CHANGE,this.OnChange,thise;this.scro.removeEventListenerdeui.UIEvent.CHANGE_END,this.OnChangeEnd,thise;ccthis.btn1.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRankTypeTap,thise;ccthis.btn2.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRankTypeTap,thise;GlobalEvent.UnSubscribedGlobalEventType.RankAddItem,this.OnAddItem,thise;}cc----------------------------------------------------------------------EditprivateChangeTypedbtn:RankPlayerBtne{ccifdthis.currBtn!=nulleccthis.currBtn.selected=false;ccthis.currBtn=btn;ccthis.currBtn.selected=true;ccRenderUtils.RemoveUpdateListdthis.updateListe;ccthis.scro.viewport.scrollV=0;cclettype=this.currBtn.type;ccletgData=MainDataMgr.GetInstancede.rankDataMgr.GetRankByTypedConst.RankInfoType.FIGHT,typee;ccifdgData==nullereturn;ccletgArray=gData.valuesde;ccifdgArray.lengthb0ecc{ccfordleti=0,len=gArray.length;ialen;i++ecc{ccletitem=newRankPlayerDatItemde;ccitem.rank=gArray[i].rank;ccitem.rankType=gArray[i].type;ccitem.glolocType=this.currBtn.type;ccthis.updateList.addItemditeme;cc}ccthis.noneTips.visible=false;ccthis.scro.visible=true;cc}ccelsecc{ccthis.noneTips.visible=true;ccthis.scro.visible=false;cc}}cc----------------------------------------------------------------------EventprivateOnItemTapde:eui.ItemTapEvente{ccifde.item!=nullecc{ccSoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;ccletdata=e.itemasRankPlayerDatItem;ccletinfo=newRankPlayerInfoMainPanelDatade.PackDataddata.glolocType,data.rankType,data.ranke;ccUIManager.ShowPaneldPanelTypeConst.RankPlayerInfoMainPanel,infoe;cc}}privateOnRankTypeTapde:egret.TouchEvente{SoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;ifdegret.isde.target,"RankPlayerBtn"e==true||egret.isde.target,"eui.Button"e==trueethis.ChangeTypede.targete}privateisChangeEnd:boolean=true;privateOnChangede:eui.UIEvente{ifdthis.scro.viewport.scrollVb=this.list.measuredHeight-this.list.heighte{ifdthis.isChangeEnd==truee{this.isChangeEnd=false;letpRankInfo=MainDataMgr.GetInstancede.rankDataMgr.GetRankInfodConst.RankInfoType.FIGHTe;letgloIndex=pRankInfo.gloCurrIndex;letlocIndex=pRankInfo.localCurrIndex;ifdthis.currBtn.type==Const.RankType.GLOBAL&&gloIndexapRankInfo.maxRankNume{letend=Math.mindgloIndex+pRankInfo.reqSpace,pRankInfo.maxRankNume;ClientNet.NetRank.C2SRankInfodgloIndex,end,1e;}elseifdthis.currBtn.type==Const.RankType.LOCAL&&locIndexapRankInfo.maxRankNume{letend=Math.mindlocIndex+pRankInfo.reqSpace,pRankInfo.maxRankNume;ClientNet.NetRank.C2SRankInfodlocIndex,end,2e;}}}}privateOnChangeEndde:eui.UIEvente{this.isChangeEnd=true;}privateOnAddItemdtype:number,beign:number,end:numbere{ccletrMap:SMapanumber,RankDataItemb=MainDataMgr.GetInstancede.rankDataMgr.GetRankByTypedConst.RankInfoType.FIGHT,typee;ccfordleti=beign,len=end;ialen;i++ecc{ccifdthis.updateList.lengthaiecc{ccletitem=newRankPlayerDatItemde;ccletinfo=rMap.getdie;ccifdinfo==nullecontinue;ccitem.rank=info.rank;ccitem.rankType=type;ccitem.glolocType=this.currBtn.type;ccthis.updateList.addItemditemecc}ccelsecc{ccletitem=this.updateList.getItemAtdbeign-1eccifditem!=nulleccthis.updateList.itemUpdatedditeme;cc}cc}ccthis.noneTips.visible=false;ccthis.scro.visible=true;}}}﻿modulegame{exportclassRankMainPanelextendsUIComponentBase{privatemainBg:MainPanelBg;publicconstructorde{superd"RankMainPanelSkin"e;}publicDestroyde{this.mainBg.Destroyde;}publicInitDatade{letinfo=dnewMainPanelBgDatadee.PackData1d"button_return_phb",this.OnCloseTap,thise;this.mainBg.Initdinfoe;lettab1Info=dnewMainPanelBgTabDatadee.PackDatad1,TabItem1,RankPlayerPanele;lettab2Info=dnewMainPanelBgTabDatadee.PackDatad2,TabItem1,RankJiaZuPanele;lettab3Info=dnewMainPanelBgTabDatadee.PackDatad3,TabItem1,RankJiaZuZhanPanele;letwjBtn=this.mainBg.AddTabdtab1InfoeasTabItem1;letjzBtn=this.mainBg.AddTabdtab2InfoeasTabItem1;letjzzBtn=this.mainBg.AddTabdtab3InfoeasTabItem1;wjBtn.Initd"button_phb_wj_0","button_phb_wj"e;jzBtn.Initd"button_phb_jz_0","button_phb_jz"e;jzzBtn.Initd"button_phb_jzz_0","button_phb_jzz"e;this.mainBg.SetTabIndexd1e;}privateOnCloseTapde:egret.TouchEvente{UIManager.HidePaneldPanelTypeConst.RankMainPanele;}}}﻿modulegame{exportclassRankMainPanelCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return["home_phb"];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnRankMainPanel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,truee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}modulegame{exportclassRankNumextendseui.Component{private_rank:number;privaterankLb:eui.Label;publicconstructorde{superde;this.skinName="RankNumSkin";}publicsetrankdvalue:numbere{this._rank=value;ifdvaluea=3ethis.currentState=`rank${value}`else{this.currentState=`common`this.validateNowde;this.rankLb.text=`${value}`;}}publicgetrankde{returnthis._rank;}}}﻿modulegame{exportclassRankPlayerBtnextendseui.Button{publictype:numberpublicconstructorde{superde;this.skinName="RankPlayerBtnSkin";}publicDestroyde{}publicsetselecteddvalue:booleane{ifdvalue==truee{this.currentState="down";}else{this.currentState="up";}}}}﻿modulegame{exportclassRankPlayerItemData{publicrank:number;publicicon:number;publiciconBg:number;publicpName:string;publicfName:string;publiccups:number;publicplayerId:number;publicDestroyde{}publicPackGlobalDatadranke{letrankInfo:RankDataItem=MainDataMgr.GetInstancede.rankDataMgr.playerRankData.gloRankMap.getdranke;ifdrankInfo==nullereturnnull;this.rank=rankInfo.rank;this.icon=rankInfo.headIconId;this.iconBg=rankInfo.headIconBg;this.pName=rankInfo.playerName;this.cups=rankInfo.cups;this.playerId=rankInfo.playerId;this.fName=rankInfo.familyName;ifdrankInfo.familyName==null||rankInfo.familyName==""ethis.fName="无家族"returnthis;}}exportclassRankPlayerItemextendsItemRenderBase{privaterank:RankNum;privatebg:eui.Image;privateheadIcon:HeadIcon;privatepName:eui.Label;privatefamilyName:eui.Label;privatemySel:eui.Image;privatecups:eui.Button;publicinfo:RankPlayerItemData;publicconstructorde{superd"RankPlayerItemSkin"e;}publicDestroyde{this.info.Destroyde;}publicdataChangedde{this.info=this.data;ifdthis.info==nullereturn;this.pName.text=this.info.pName;this.familyName.text=this.info.fName;this.cups.label=`${this.info.cups}`;this.headIcon.SetIcondthis.info.icone;this.headIcon.SetFramedthis.info.iconBge;this.rank.rank=this.info.rank;cc我自己ifdthis.info.playerId==MainDataMgr.GetInstancede.roleIde{this.mySel.visible=true;}else{this.mySel.visible=false;}}}}modulegame{exportclassRankPlayerItem2Data{rank:number;type:number;publicDestroyde{}}exportclassRankPlayerItem2extendsItemRenderBase{privatebg:eui.Image;privaterankLb:eui.Label;privaterankBg:eui.Image;privateheadIcon:HeadIcon;privatepName:eui.Label;privatefamilyName:eui.Label;privatecupLb:eui.Label;publicinfo:RankPlayerItem2Data;publicconstructorde{superd"RankPlayerItem2Skin"e;}publicDestroyde{this.info.Destroyde;}publicdataChangedde{ifdthis.data==nullereturn;this.info=this.data;}}}﻿modulegame{exportclassRankPlayerPanelextendsUIComponentBase{privateswitchBtn:RankSwitchBtnGroup;privatelist:eui.List;privatescro:eui.Scroller;privatenoneTips:eui.Image;privateupdateList:eui.ArrayCollection;publicconstructorde{superd"RankPlayerPanelSkin"e;}publicInitDatade{this.updateList=neweui.ArrayCollectionde;this.list.itemRenderer=RankPlayerItem;this.list.dataProvider=this.updateList;this.list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;this.scro.addEventListenerdeui.UIEvent.CHANGE,this.OnChange,thise;this.scro.addEventListenerdeui.UIEvent.CHANGE_END,this.OnChangeEnd,thise;GlobalEvent.SubscribedGlobalEventType.RankAddItem,this.OnAddItem,thise;this.switchBtn.Initdthis.OnSwitchTap,this,1e;letrankInfo=MainDataMgr.GetInstancede.rankDataMgr.GetRankInfodConst.RankInfoType.PLAYERe;rankInfo.ResetIndexde;MainDataMgr.GetInstancede.rankDataMgr.ReqNewRankInfodConst.RankInfoType.PLAYER,Const.RankType.GLOBALe;MainDataMgr.GetInstancede.rankDataMgr.ReqNewRankInfodConst.RankInfoType.PLAYER,Const.RankType.LOCALe;cc不应该一次性请求两个的}protectedDestroyde{RenderUtils.RemoveUpdateListdthis.updateListe;RenderUtils.RemoveListdthis.liste;this.switchBtn.Destoryde;this.list.removeEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;this.scro.removeEventListenerdeui.UIEvent.CHANGE,this.OnChange,thise;this.scro.removeEventListenerdeui.UIEvent.CHANGE_END,this.OnChangeEnd,thise;GlobalEvent.UnSubscribedGlobalEventType.RankAddItem,this.OnAddItem,thise;}cc----------------------------------------------------------------------EditprivateChangeTypedtype:numbere{ccRenderUtils.RemoveUpdateListdthis.updateListe;this.scro.viewport.scrollV=0;letgData=MainDataMgr.GetInstancede.rankDataMgr.GetRankByTypedConst.RankInfoType.PLAYER,typee;ifdgData==nullereturn;letgArray=gData.valuesde;ifdgArray.lengthb0e{lettmpArr=[];fordleti=0,len=gArray.length;ialen;i++e{tmpArr.pushddnewRankPlayerItemDatadee.PackGlobalDatadgArray[i].rankee;}this.updateList.replaceAlldtmpArre;this.noneTips.visible=false;this.scro.visible=true;}else{this.noneTips.visible=true;this.scro.visible=false;}}cc----------------------------------------------------------------------EventprivateOnItemTapde:eui.ItemTapEvente{ifde.item!=nulle{SoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;letdata=e.itemasRankPlayerItemData;letinfo:PlayerInfoMainPanelData;ifdthis.switchBtn.currIndex==Const.RankType.GLOBALeinfo=newPlayerInfoMainPanelDatade.PackRankPlayerGlobalddata.ranke;elseifdthis.switchBtn.currIndex==Const.RankType.LOCALeinfo=newPlayerInfoMainPanelDatade.PackRankPlayerLocalddata.ranke;UIManager.ShowPaneldPanelTypeConst.PlayerInfoMainPanel,infoe;}}privateOnSwitchTapdtype:numbere{SoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;this.ChangeTypedtypee;}privateisChangeEnd:boolean=true;privateOnChangede:eui.UIEvente{ifdthis.scro.viewport.scrollVb=this.list.measuredHeight-this.list.heighte{ifdthis.isChangeEnd==truee{this.isChangeEnd=false;letpRankInfo=MainDataMgr.GetInstancede.rankDataMgr.GetRankInfodConst.RankInfoType.PLAYERe;letgloIndex=pRankInfo.gloCurrIndex;letlocIndex=pRankInfo.localCurrIndex;ifdthis.switchBtn.currIndex==Const.RankType.GLOBAL&&gloIndexapRankInfo.maxRankNume{letend=Math.mindgloIndex+pRankInfo.reqSpace,pRankInfo.maxRankNume;ClientNet.NetRank.C2SRankInfodgloIndex,end,1e;}elseifdthis.switchBtn.currIndex==Const.RankType.LOCAL&&locIndexapRankInfo.maxRankNume{letend=Math.mindlocIndex+pRankInfo.reqSpace,pRankInfo.maxRankNume;ClientNet.NetRank.C2SRankInfodlocIndex,end,2e;}}}}privateOnChangeEndde:eui.UIEvente{this.isChangeEnd=true;}privateOnAddItemdtype:number,beign:number,end:numbere{letrMap:SMapanumber,RankDataItemb=MainDataMgr.GetInstancede.rankDataMgr.GetRankByTypedConst.RankInfoType.PLAYER,typee;fordleti=beign,len=end;ialen;i++e{ifdthis.updateList.lengthaie{letinfo=rMap.getdie;ifdinfo==nullecontinue;letitem=dnewRankPlayerItemDatae.PackGlobalDatadinfo.ranke;this.updateList.addItemditeme}else{letitem=this.updateList.getItemAtdbeign-1eifditem!=nullethis.updateList.itemUpdatedditeme;}}this.noneTips.visible=false;this.scro.visible=true;}}}modulegame{exportclassRankSwitchBtnGroupextendseui.Component{privatebtn1:eui.Button;privatebtn2:eui.Button;privatefunc:Function;privatethisObj:any;publiccurrIndex:number;publicconstructorde{superde;this.skinName="RankSwitchButtonGroupSkin";}publicInitdfunc:Function,thisObj:any,index:number=1e{this.func=func;this.thisObj=thisObj;this.btn1.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnBtnTap,thise;this.btn2.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnBtnTap,thise;this.SetIndexdindexe;}publicDestoryde{this.btn1.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnBtnTap,thise;this.btn2.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnBtnTap,thise;}publicSetIndexdindex:numbere{ifdindex==this.currIndexereturn;ifdthis.currIndex!=nulle{dthis[`btn${this.currIndex}`]aseui.Buttone.currentState=`up1`;}this.currIndex=index;ifdthis.currIndex!=nulle{ifdindex==1edthis[`btn1`]aseui.Buttone.currentState=`down1`;elseifdindex==2edthis[`btn2`]aseui.Buttone.currentState=`down2`;}}privateOnBtnTapde:egret.TouchEvente{switchde.targete{casethis.btn1:this.SetIndexd1e;break;casethis.btn2:this.SetIndexd2e;break;}ifdthis.func!=null&&this.thisObj!=nullethis.func.calldthis.thisObj,this.currIndexe;}}}﻿modulegame{exportclassReplay1V1InfoItemData{publictype:number;cc1世界回放2个人回放publicindex:number;publicconstructorde{}}exportclassReplay1V1InfoItemextendsItemRenderBase{publicheadInfo01:HeadIcon;publicplayerName01:eui.Label;publicfamilyName01:eui.Label;publicattackWinTips01:eui.Image;publicheroCardArray01:HeroKa1[];publicheadInfo02:HeadIcon;publicplayerName02:eui.Label;publicfamilyName02:eui.Label;publicdefendWinTips02:eui.Image;publicheroCardArray02:HeroKa1[];publicleftCard:eui.Group;publicrightCard:eui.Group;publictimeLabel1:eui.Label;publictimeLabel2:eui.Label;publicshareBtn:SButton;publicwatchBtn:SButton;publicinfoGroup:eui.Group;privatetimerKey:number=0;publicconstructorde{superd"Replay1V1InfoItemSkin"e;this.heroCardArray01=[];this.heroCardArray02=[];}privateisCreated:boolean=false;protectedchildrenCreatedde{super.childrenCreatedde;this.isCreated=true;ifdthis.data!=nulle{this.UpdateViewdthis.datae;}this.shareBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnShareClicked,thise;this.watchBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnWatchClicked,thise;this.leftCard.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnHeroIconClick,thise;this.rightCard.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnHeroIconClick,thise;};dataChangedde{this.UpdateViewdthis.datae;}privateUpdateViewddata:Replay1V1InfoItemDatae{ifd!this.isCreatedereturn;this.UpdateDatade;}privateUpdateDatade{letreplayDataMgr=MainDataMgr.GetInstancede.replayDataMgr;letdata:Replay1V1InfoItemData=this.data;ifddata.index==nullereturn;letreplayData=replayDataMgr.GetReplayDataddata.type,data.indexe;ifdreplayData==nullereturn;this.infoGroup.visible=dreplayData.singleType==1e;cc世界录像才显示观看次数等信息this.DestroyHeroInfode;cc左侧信息letplayer1=replayData.playerArray[0];this.headInfo01.SetIcondplayer1.iconNamee;this.headInfo01.SetFramedplayer1.edgeIde;this.playerName01.text=player1.playerName;this.familyName01.text=player1.familyName;ifdplayer1.winType==1ethis.attackWinTips01.source=RES.getResd"home_ui_family_lt_json.icon_jz_lt_dzjl_win"e;elsethis.attackWinTips01.source=RES.getResd"home_ui_family_lt_json.icon_jz_lt_dzjl_lose"e;fordletheroInfoofplayer1.heroInfoArraye{letheroData=newHeroKa1Datade;heroData.heroId=heroInfo[0];heroData.type=3;cc单纯的获取数据heroData.lv=heroInfo[1];letheroObj=newHeroKa1de;heroObj.currentState="replay";heroObj.validateNowde;heroObj.scaleX=heroObj.scaleY=0.5;heroObj.data=heroData;heroObj.dataChangedde;this.leftCard.addChilddheroObje;this.heroCardArray01.pushdheroObje;}cc右侧信息letplayer2=replayData.playerArray[1];this.headInfo02.SetIcondplayer2.iconNamee;this.headInfo02.SetFramedplayer2.edgeIde;this.playerName02.text=player2.playerName;this.familyName02.text=player2.familyName;ifdplayer2.winType==1ethis.defendWinTips02.source=RES.getResd"home_ui_family_lt_json.icon_jz_lt_dzjl_win"e;elsethis.defendWinTips02.source=RES.getResd"home_ui_family_lt_json.icon_jz_lt_dzjl_lose"e;fordletheroInfoofplayer2.heroInfoArraye{letheroData=newHeroKa1Datade;heroData.heroId=heroInfo[0];heroData.type=3;cc单纯的获取数据heroData.lv=heroInfo[1];letheroObj=newHeroKa1de;heroObj.currentState="replay";heroObj.validateNowde;heroObj.scaleX=heroObj.scaleY=0.5;heroObj.data=heroData;heroObj.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnHeroIconClick,thise;heroObj.dataChangedde;this.rightCard.addChilddheroObje;this.heroCardArray02.pushdheroObje;}letpassTime=HomeServerTime.GetPassTimedreplayData.startTimee;this.timeLabel1.text=`${replayData.watchCount}次观看`;passTime=Math.floordpassTimec1000e;ifdpassTimea=3600ethis.timeLabel2.text=`d最新e`;else{lethour=Math.floordpassTimec3600e;this.timeLabel2.text=`d${hour}小时前e`;}TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;TimerMgr.GetInstancede.AddTimerd1000,this.RefreshShareTime,thise;}privateOnHeroIconClickde:egret.TouchEvente{ifde.target!=null&&e.target!=null&&e.target.parent.data!=nulle{letheroData:HeroKa1Data=e.target.parent.data;letinfo=dnewHeroInfoPanelDatae.PackPlayerDatadheroData.heroIde;UIManager.ShowPaneldPanelTypeConst.HeroInfoPanel,infoe;}}privateRefreshShareTimede{letreplayDataMgr=MainDataMgr.GetInstancede.replayDataMgr;letdata:Replay1V1InfoItemData=this.data;ifddata==nullereturntrue;letreplayData=replayDataMgr.GetReplayDataddata.type,data.indexe;ifdreplayData==nullereturntrue;letpassShareTime=HomeServerTime.GetPassTimedreplayData.lastShareTimee;ifdpassShareTime==0ereplayData.lastShareTime=FightServerTime.GetServerTimede;passShareTime=Math.floordpassShareTimec1000e;ifdpassShareTimeb=60e{RenderUtils.SetGreydthis.shareBtn,falsee;this.shareBtn.SetTextd"分享"e;this.shareBtn.touchEnabled=true;}else{letleftTime=60-passShareTime;RenderUtils.SetGreydthis.shareBtn,truee;this.shareBtn.touchEnabled=false;this.shareBtn.SetTextd`${leftTime}秒`e;}returntrue;}privateOnShareClickedde{}privateOnWatchClickedde{letreplayDataMgr=MainDataMgr.GetInstancede.replayDataMgr;letdata:Replay1V1InfoItemData=this.data;letreplayData=replayDataMgr.GetReplayDataddata.type,data.indexe;ifdreplayData==nullereturn;ClientNet.NetMatch.C2SFightRecorddreplayData.uniqueIde;}privateDestroyHeroInfode{fordletheroObjofthis.heroCardArray01e{heroObj.DestroyAlldtruee;}this.heroCardArray01=[];fordletheroObjofthis.heroCardArray02e{heroObj.DestroyAlldtruee;}this.heroCardArray02=[];}protectedDestroyde{TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.DestroyHeroInfode;this.shareBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnShareClicked,thise;this.watchBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnWatchClicked,thise;this.leftCard.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnHeroIconClick,thise;this.rightCard.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnHeroIconClick,thise;}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassReplayInfoCextendsUICtrlBase{publicconstructorde{superde;}cc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return["home_tv"];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnReplayInfoPanel;}cc做一下类型转换方便调用一定要有!!!protectedgettestPanelde{returnaReplayInfoPanelbthis.panel;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0e;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}c***初始化面板数据*cpublicInitDatade:void{}}}﻿c****cmodulegame{exportclassReplayInfoPanelextendsUIComponentBase{publicconstructorde{superd"ReplayInfoSkin",truee;}publicroot:eui.Group;publiccomWin:CommonWin;ccpubliccloseBtn:SButton;publicworldBtn:SButton;publicworldBg1:eui.Image;publicworldBg2:eui.Image;publicmyBtn:SButton;publicmyBg1:eui.Image;publicmyBg2:eui.Image;publicworldInfo:eui.Group;publicleftBtn:SButton;publicrightBtn:SButton;publicworldTipLabel:eui.Label;publicmyInfo:eui.Group;publicmyTipLabel:eui.Label;publicgame_list_scroller:eui.Scroller;publicgame_list:eui.List;publicemptyTips:eui.Group;publicemptyLabel:eui.Label;privatetype:number=0;cc1世界2个人privateclassLv:number=0;privatedataList:Replay1V1InfoItemData[];privatetimerKey:number=0;protectedchildrenCreatedde{super.childrenCreatedde;}publicInitDatade:void{this.dataList=[];this.InitCBde;}privateInitCBde{letreplayDataMgr=MainDataMgr.GetInstancede.replayDataMgr;letthisObj=thisthis.AddPropCB_NotCalldreplayDataMgr,"myItemArray",de=b{ifdthisObj.type==2ethis.RefreshListde;}e;this.AddPropCB_NotCalldreplayDataMgr,"worldItemArray",de=b{ifdthisObj.type==1ethis.RefreshListde;}e;this.comWin.currentState="noSubBg";this.comWin.validateNowde;this.comWin.Initd"精彩录像",this.OnCloseBtnClicked,thise;this.SetTyped2,MainDataMgr.GetInstancede.classLve;ccthis.closeBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseBtnClicked,thise;this.worldBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnWorldBtnClicked,thise;this.myBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnMyBtnClicked,thise;this.leftBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnLeftBtnClicked,thise;this.rightBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRightBtnClicked,thise;ClientNet.NetReplay.C2SSimpleRecordde;}privateOnCloseBtnClickedde{UIManager.HidePaneldPanelTypeConst.ReplayInfoe;}privateOnWorldBtnClickedde{ifdthis.type!=1ethis.SetTyped1,MainDataMgr.GetInstancede.classLve;}privateOnMyBtnClickedde{ifdthis.type!=2ethis.SetTyped2,MainDataMgr.GetInstancede.classLve;}privateOnLeftBtnClickedde{letclassLv=this.classLv-1;ifdclassLva1eclassLv=1;ifdclassLvb10eclassLv=10;this.SetTypedthis.type,classLve;}privateOnRightBtnClickedde{letclassLv=this.classLv+1;ifdclassLva1eclassLv=1;ifdclassLvb10eclassLv=10;this.SetTypedthis.type,classLve;}cctype1:世界2：个人privateSetTypedtype:number,classLv:numbere{ifdthis.type==type&&this.classLv==classLvereturn;this.type=type;this.classLv=classLv;letmaxLv=MainDataMgr.GetInstancede.maxClassLv;RenderUtils.SetGreydthis.leftBtn,classLva=1e;RenderUtils.SetGreydthis.rightBtn,classLvb=maxLve;this.worldInfo.visible=type==1;this.myInfo.visible=type==2;this.worldTipLabel.text=`${this.classLv}阶竞技场`;ifdtype==1e{this.worldBg1.source=RES.getResd"home_ui_family_lt_json.bg_jz_lt_jk_bt01"e;this.worldBg2.source=RES.getResd"home_ui_tv_json.bg_tv_sj"e;this.myBg1.source=RES.getResd"home_ui_family_lt_json.bg_jz_lt_jk_bt02"e;this.myBg2.source=RES.getResd"home_ui_tv_json.bg_tv_gr0"e;}else{this.worldBg1.source=RES.getResd"home_ui_family_lt_json.bg_jz_lt_jk_bt02"e;this.worldBg2.source=RES.getResd"home_ui_tv_json.bg_tv_sj0"e;this.myBg1.source=RES.getResd"home_ui_family_lt_json.bg_jz_lt_jk_bt01"e;this.myBg2.source=RES.getResd"home_ui_tv_json.bg_tv_gr"e;}this.RefreshListde;}privateRefreshListde{this.DestroyListde;letreplayDataMgr=MainDataMgr.GetInstancede.replayDataMgr;letreplayDataArray=replayDataMgr.GetReplayDataArraydthis.type,this.classLve;letcellData:Replay1V1InfoItemData=null;fordletreplayDataofreplayDataArraye{cellData=newReplay1V1InfoItemDatade;cellData.type=this.type;cellData.index=replayData.index;this.dataList.pushdcellDatae;}this.game_list.itemRenderer=Replay1V1InfoItem;this.game_list.dataProvider=neweui.ArrayCollectiondthis.dataListe;this.emptyTips.visible=this.dataList.length==0;ifdthis.dataList.length==0e{this.emptyLabel.text=LanUtil.GetTextd"当前没有最新的录像"e;}}privateDestroyListde{this.dataList=[];fordleti=0;iathis.game_list.numChildren;i++e{letgameCellView=this.game_list.getChildAtdieasItemRenderBase;gameCellView.DestroyAllde;}}protectedDestroyde{ifdthis.timerKey!=0e{TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=0;}this.DestroyListde;this.comWin.Destroyde;this.worldBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnWorldBtnClicked,thise;this.myBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnMyBtnClicked,thise;this.leftBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnLeftBtnClicked,thise;this.rightBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnRightBtnClicked,thise;}}}﻿modulegame{exportclassRoleBtnItemextendseui.Button{privateredDotImg:eui.Image;publictype:number;publicconstructorde{superde;this.skinName="RoleBtnItemSkinSkin";}publicDestroyde{}setselecteddflag:booleane{ifdthis.type==1ecc军队{ifdflag==trueethis.currentState="selected_info";elsethis.currentState="common_info";}this.validateNowde;ifdthis.type==1e{cc处理小红点ccletredDotObj1=RedDotMgr.GetInstancede.GetReddotd"jundui_jundui"e;ccthis.ShowRedDotdredDotObj1.GetStatede==1e;}}ShowRedDotdisShow:booleane{ifdisShow==truee{this.redDotImg.visible=true;}else{this.redDotImg.visible=false;}}}}modulegame{exportclassRoleEditNameWinData{itemId:number;type:number;publicDestroyde{}publicInitByShopDataMgrditemId:number,type:numbere{this.itemId=itemId;this.type=type;returnthis;}}exportclassRoleEditNameWinextendsUIComponentBase{privatecomWin:CommonWin;privateeditName:SInputLabel;privateiconText:IconText;privateleftBtn:SButton;privaterightBtn:SButton;publicinfo:ShopBuyWinData;publicconstructorde{superd"RoleEditNameWinSkin"e;}protectedchildrenCreatedde{super.childrenCreatedde;}publicInitDataddata:ShopBuyWinDatae{this.info=data;this.comWin.Initd`更改名字`,this.OnCloseTap,thise;this.editName.SetDefaultTextdLanUtil.GetTextd"请输入新昵称"ee;leticonData=newIconTextDatade;iconData.icon="item_3";iconData.titleText="花费";iconData.descText=`000`;this.iconText.InitdiconDatae;this.AddTouchEventdthis.leftBtn,this.OnCloseTap,thise;this.AddTouchEventdthis.rightBtn,this.OnRightTap,thise;}protectedDestroyde{this.comWin.Destroyde;}privateOnBuyTapde:egret.TouchEvente{GlobalEvent.FireEventdGlobalEventType.ShopBuyItem,this.infoe;}cc----------------------------------------------------------------------EventprivateOnCloseTapde:egret.TouchEvente{UIManager.HidePaneldPanelTypeConst.RoleEditNameWine;}privateOnRightTapde:egret.TouchEvente{TipsManager.ShowTipsd"假装发了一个改名协议"e;}}}modulegame{exportclassRoleEditNameWinCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnRoleEditNameWin;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,true,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿modulegame{exportclassRoleInfoPanelextendsUIComponentBase{privateuserName:eui.Label;privatecodeNum:eui.Label;privatelevelLb:eui.Label;privatefamilyName:eui.Label;privatelocalName:eui.Label;privatecupsLb:eui.Label;privatestepLb:eui.Label;privateaverageCost:eui.BitmapLabel;privateeditNameBtn:SButton;privateheroGroup:eui.Group;privatesex:eui.Image;publicconstructorde{superd"RoleInfoPanelSkin"e;this.cacheAsBitmap=true;}publicDestroyde{}publicInitDatade{letmInfo=MainDataMgr.GetInstancede;this.userName.text=mInfo.userName;this.codeNum.text=LanUtil.GetFormatd`编号:{0}`,mInfo.serverIde;this.levelLb.text=`${mInfo.level}`;this.familyName.text=`${mInfo.familyName}`;this.localName.text=`${MainDataMgr.GetInstancede.GetLocalNamedmInfo.locale}`;this.cupsLb.text=`${mInfo.cupCount}`;this.stepLb.text=LanUtil.GetFormatd`{0}`,mInfo.classLve;this.averageCost.text=`${this.CalcAvgCostdmInfo.teamDataMgr.currentTeamIndexe}`;this.sex.source=mInfo.sex==1?"icon_xb_n":"icon_xb_nv"letteamInfo=mInfo.teamDataMgr.GetCurrTeamInfode;ifdteamInfo==nullereturn;letherosArray:number[]=teamInfo.heroArray;letchild:HeroKa1;fordleti=0,len=this.heroGroup.numChildren;ialen;i++e{child=this.heroGroup.getChildAtdieasHeroKa1;child.data=dnewHeroKa1Datae.PackPlayerDatadherosArray[i],truee;}this.heroGroup.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnHeroKaTap,thise;this.AddTouchEventdthis.editNameBtn,this.OnEditNameTap,thise;}privateOnHeroKaTapde:egret.TouchEvente{ifdegret.isde.target,"game.HeroKa1"e==truee{letheroId=de.targetasHeroKa1e.info.heroId;letinfo=dnewHeroInfoPanelDatae.PackPlayerDatadheroIde;UIManager.ShowPaneldPanelTypeConst.HeroInfoPanel,infoe;SoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;}}privateOnEditNameTapde:egret.TouchEvente{UIManager.ShowPaneldPanelTypeConst.RoleEditNameWine;}cc----------------------------------------------------------------------ToolprivateCalcAvgCostdteamId:numbere:string{letheroArray=MainDataMgr.GetInstancede.teamDataMgr.GetTeamInfodteamIde.heroArray;letheroInfo:CardDataItem,heroId:number,totalCost:number=0,avgCost:string="",len:number=heroArray.length;ifdlena=0ereturn"0";fordleti=0;ialen;i++e{heroId=heroArray[i];heroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetHerodheroIde;totalCost+=heroInfo.cost;}avgCost=dtotalCostclene.toFixedd1e;returnavgCost.replaced".","#"e;}}}﻿modulegame{exportclassRoleMainPanelextendsUIComponentBase{privateinfoBtn:TabItem1;privaterecordBtn:TabItem1;privatemainBg:MainPanelBg;publicconstructorde{superd"RoleMainPanelSkin"e;}publicDestroyde{this.mainBg.Destroyde;}publicInitDatadindex:number=1e{letinfo=dnewMainPanelBgDatadee.PackData1d"button_return_grzl",this.OnCloseTap,thise;this.mainBg.Initdinfoe;lettab1Info=dnewMainPanelBgTabDatadee.PackDatad1,TabItem1,RoleInfoPanele;lettab2Info=dnewMainPanelBgTabDatadee.PackDatad2,TabItem1,RoleRecordPanele;this.infoBtn=this.mainBg.AddTabdtab1InfoeasTabItem1;this.recordBtn=this.mainBg.AddTabdtab2InfoeasTabItem1;this.infoBtn.Initd"button_jd_lz_0","button_jd_lz"e;this.recordBtn.Initd"button_grzl_zj_0","button_grzl_zj"e;this.mainBg.SetTabIndexd1e;}privateOnCloseTapde:egret.TouchEvente{UIManager.HidePaneldPanelTypeConst.RoleMainPanele;}}}﻿modulegame{exportclassRoleMainPanelCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnRoleMainPanel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,false,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}modulegame{exportclassRoleRecordPanelextendsUIComponentBase{privatelist:eui.List;privateupdateList:eui.ArrayCollection;publicconstructorde{superd"RoleRecordPanelSkin"e;this.cacheAsBitmap=true;}publicInitDatade{this.updateList=neweui.ArrayCollectionde;this.list.itemRenderer=RoleRecordPanelItem;this.list.dataProvider=this.updateList;this.updateList.addItemddnewRoleRecordPanelItemDatae.PackDatadRecordType.ONE_V_ONEee;this.updateList.addItemddnewRoleRecordPanelItemDatae.PackDatadRecordType.LIAN_MENGee;this.updateList.addItemddnewRoleRecordPanelItemDatae.PackDatadRecordType.FAMILYee;}publicDestroyde{fordleti=0,len=this.updateList.length;ialen;i++e{dthis.updateList.getItemAtdieasRoleRecordPanelItemDatae.Destroyde;}this.updateList=null;}}}modulegame{exportclassRoleRecordPanelItemData{publictype:number;publicDestroyde{};publicPackDatadtype:numbere{this.type=type;returnthis;}publicGetTitleNamede:string{ifdthis.type==RecordType.ONE_V_ONEereturn"1V1";elseifdthis.type==RecordType.LIAN_MENGereturn"联盟杯";elseifdthis.type==RecordType.FAMILYereturn"家族战";return"";}}exportclassRoleRecordPanelItemextendsItemRenderBase{privatetitle:eui.Label;privatemaxRank:eui.Label;privatemaxCups:eui.Label;privatefightCount:eui.Label;privatewinCount:eui.Label;publicinfo:RoleRecordPanelItemDatapublicconstructorde{superd"RoleRecordPanelItemSkin"e;}publicDestroyde{}publicdataChangedde{ifdthis.data==nullereturn;this.info=this.data;this.title.text=this.info.GetTitleNamede;this.maxRank.text=`未上榜`;this.maxCups.text=`0`;this.fightCount.text=`0次`;this.winCount.text=`0场`;}}}modulegame{exportclassCommonTextInfoCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.effectLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnCommonTextInfo;}cc做一下类型转换方便调用一定要有!!!protectedgetcommonDlgPanelde{returnaCommonDlgbthis.panel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,false,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld0e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}c***初始化面板数据*cpublicInitDatade:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}}}modulegame{exportclassCommonTextInfoextendsUIComponentBase{ccpublicleftBtn:SButton;ccpublicrightBtn:SButton;privatecomWin:CommonWin;privatecontent:eui.Label;privatedata:CommonDlgData;publicconstructorde{superd"CommonTextInfoSkin"e;}protectedchildrenCreatedde:void{super.childrenCreatedde;}protectedDestroyde{ccifdthis.leftBtn.hasEventListenerdegret.TouchEvent.TOUCH_TAPeeccthis.leftBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnOKClick,thise;ccifdthis.rightBtn.hasEventListenerdegret.TouchEvent.TOUCH_TAPeeccthis.rightBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCancelClick,thise;this.data.Destroyde;this.comWin.Destroyde;}publicInitDataddata:CommonDlgDatae{this.data=data;this.InitOkAndCancelInfode;this.comWin.currentState="noSubBg";this.comWin.validateNowde;this.comWin.Initddata.titleText,this.OnCloseClick,thise;this.content.textFlow=newegret.HtmlTextParserde.parserddata.contente}privateInitOkAndCancelInfode{ccletdata=this.dataccifddata.thisObj!=nullecc{ccifddata.leftFunc!=null&&data.rightFunc!=nullecc二者都有cc{ccthis.leftBtn.horizontalCenter=-120;ccthis.SetLeftUIde;ccthis.leftBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnOKClick,thise;ccthis.rightBtn.horizontalCenter=120;ccthis.SetRightUIde;ccthis.rightBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCancelClick,thise;cc}ccelsecc{ccthis.leftBtn.horizontalCenter=this.rightBtn.horizontalCenter=0;ccifddata.leftFunc!=nullecc{ccthis.leftBtn.visible=true;ccthis.SetLeftUIde;ccthis.leftBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnOKClick,thise;cc}ccelsecc{ccthis.leftBtn.visible=false;cc}ccifddata.rightFunc!=nullecc{ccthis.rightBtn.visible=true;ccthis.SetRightUIde;ccthis.rightBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnOKClick,thise;cc}ccelsecc{ccthis.rightBtn.visible=false;cc}cc}cc}ccelsecc{ccthis.rightBtn.visible=this.leftBtn.visible=false;cc}}privateSetRightUIde{ccletdata=this.data;ccdata.rightText!=null&&dthis.rightBtn.label=data.rightTexte;ccdthis.data.rightIcon!=nulle&&dthis.rightBtn.icon=this.data.rightIcone;ccdata.rightTextColor!=null&&this.rightBtn.SetLabelColorddata.rightTextColore;}privateSetLeftUIde{ccletdata=this.data;ccdata.leftText!=null&&dthis.leftBtn.label=data.leftTexte;ccdthis.data.leftIcon!=nulle&&dthis.leftBtn.icon=this.data.leftIcone;ccdata.leftTextColor!=null&&this.leftBtn.SetLabelColorddata.leftTextColore;}privateOnOKClickde:egret.TouchEvente{ifdthis.data!=nulle{this.data.execOKdee;}UIManager.HidePaneldPanelTypeConst.CommonTextInfoe;}privateOnCancelClickde:egret.TouchEvente{ifdthis.data!=nulle{this.data.execCanceldee;}UIManager.HidePaneldPanelTypeConst.CommonTextInfoe;}privateOnCloseClickde:egret.TouchEvente{ifdthis.data!=nulle{this.data.execClosedee;}UIManager.HidePaneldPanelTypeConst.CommonTextInfoe;}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassSelectLanCextendsUICtrlBase{publicconstructorde{superde;}cc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnSelectLanPanel;}cc做一下类型转换方便调用一定要有!!!protectedgetselectLanPanelde{returnaSelectLanPanelbthis.panel;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0,false,falsee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}c***初始化面板数据*cpublicInitDatade:void{}}}﻿c****cmodulegame{classLanCellData{publiclanType:string;publiclanName:string;publicconstructorde{}}classLanCellViewextendsItemRenderBase{publiclanName:eui.Label;publicbg:eui.Image;publicconstructorde{superd"LanItemSkin"e;}privateisCreated:boolean=false;protectedchildrenCreatedde{super.childrenCreatedde;this.isCreated=true;ifdthis.data!=nullethis.UpdateViewdthis.datae;}publicdataChangedde{this.UpdateViewdthis.datae;}c***更新视图*cprivateUpdateViewddata:LanCellDatae{ifd!this.isCreatedereturn;this.lanName.text=data.lanName;ifd!this.selectedethis.bg.source=RES.getResd"home_ui_login_json.bg_dl_qbfwq"e;elsethis.bg.source=RES.getResd"home_ui_login_json.bg_dl_xzfwq"e;}protectedDestroyde{}}exportclassSelectLanPanelextendsUIComponentBase{publicconstructorde{superd"SelectLanSkin"e;}publicroot:eui.Group;privatecomWin:CommonWin;publicgame_list_scroller:eui.Scroller;publicgame_list:eui.List;publicgameCellDatas:LanCellData[];protectedchildrenCreatedde{super.childrenCreatedde;this.comWin.currentState="noSubBg";this.comWin.validateNowde;this.comWin.Initd"语言",this.OnClose,thise;}publicInitDataddata:anye{super.InitDataddatae;this.InitListdLanUtil.lanInfoArraye;letindexStr=NativeApi.getLocalDatad"LanIndex"e;ifdindexStr==nulleindexStr="0";letindex=0;fordletdataofthis.gameCellDatase{ifddata.lanType==LanUtil.lanTypeebreak;index++;}this.SetCurrentLandindexe;}publicInitListdlanInfo:any[]e{this.gameCellDatas=[];letindex=0;fordletdataoflanInfoe{letgameData=newLanCellDatade;gameData.lanType=data[0];gameData.lanName=data[1];this.gameCellDatas.pushdgameDatae;index++;}this.game_list.itemRenderer=LanCellView;letlistData=neweui.ArrayCollectiondthis.gameCellDatase;this.game_list.dataProvider=listData;this.game_list_scroller.viewport=this.game_list;cc刷新数据this.game_list.updateRenderer=this.GameCell.binddthise;this.game_list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.ItemSelected,thise;this.game_list_scroller.validateNowde;ccthis.game_list.scrollV=this.game_list.contentHeight-this.game_list.height; ifdthis.game_list.contentHeighta=this.game_list.heighte{this.game_list_scroller.scrollPolicyV=eui.ScrollPolicy.OFF;}else{this.game_list_scroller.scrollPolicyV=eui.ScrollPolicy.AUTO;}}protectedItemSelectedde:eui.ItemTapEvente:void{ccgame.logd"--------itemSelected----bbbbbbbbbbbbb------",e.itemIndexe;this.SetCurrentLande.itemIndexe;this.OnClosede;}publicSetCurrentLandindex:numbere{fordleti=0;iathis.game_list.numChildren;i++e{letlanCellView=this.game_list.getChildAtdieasLanCellView;ifdlanCellView==nullecontinue;lanCellView.selected=i==index;lanCellView.dataChangedde;}ifdindexb=this.gameCellDatas.lengthereturn;letdata=this.gameCellDatas[index];LanUtil.SwitchLanddata.lanTypee;GlobalEvent.FireEventdGlobalEventType.ChangeLanguagee;}c***List更新数据时调用*cprivateGameCelldrenderer:eui.IItemRenderer,itemIndex:number,data:anye:eui.IItemRenderer{renderer.data=data;renderer.itemIndex=itemIndex;returnrenderer;}protectedDestroyde{this.gameCellDatas=null;fordleti=0;iathis.game_list.numChildren;i++e{letlanCellView=this.game_list.getChildAtdieasLanCellView;lanCellView.DestroyAllde;}}privateOnClosede{UIManager.HidePaneldPanelTypeConst.SelectLane;}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassSettingsInfoCextendsUICtrlBase{publicconstructorde{superde;}cc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnSettingsInfoPanel;}cc做一下类型转换方便调用一定要有!!!protectedgettestPanelde{returnaSettingsInfoPanelbthis.panel;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0e;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}c***初始化面板数据*cpublicInitDatade:void{}}}﻿c****cmodulegame{exportclassSettingsInfoPanelextendsUIComponentBase{publicconstructorde{superd"SettingsInfoSkin"e;}publicroot:eui.Group;publiccloseBtn:SButton;publiccheck01:eui.CheckBox;publiccheck02:eui.CheckBox;publiccheck031:eui.CheckBox;publiccheck032:eui.CheckBox;publiccheck033:eui.CheckBox;publicbackToLoginBtn:SButton;publiclinkToServerBtn:SButton;publicgroup041:SGroup;cc切换语言publiclabel04:eui.Label;publicgroup05:SGroup;cc服务协议publicgroup06:SGroup;cc隐私政策protectedchildrenCreatedde{super.childrenCreatedde;this.InitCBde;this.check031.$autoSelected=false;this.check032.$autoSelected=false;this.check033.$autoSelected=false;}privateInitCBde{this.AddTouchEventdthis.check01,de=b{SoundManager.Insde.IsPlayBgdthis.check01.selectede;},thise;this.AddTouchEventdthis.check02,de=b{SoundManager.Insde.IsPlayEffdthis.check02.selectede;},thise;this.AddTouchEventdthis.check031,de=b{this.check031.selected=true;this.check032.selected=false;this.check033.selected=false;},thise;this.AddTouchEventdthis.check032,de=b{this.check031.selected=false;this.check032.selected=true;this.check033.selected=false;},thise;this.AddTouchEventdthis.check033,de=b{this.check031.selected=false;this.check032.selected=false;this.check033.selected=true;},thise;this.AddTouchEventdthis.closeBtn,de=b{UIManager.HidePaneldPanelTypeConst.SettingsInfoe;},thise;this.AddTouchEventdthis.backToLoginBtn,de=b{SceneManager.GetInstancede.EnterHomed2e;},thise;this.AddTouchEventdthis.linkToServerBtn,de=b{this.OnCloseDlgde;},thise;this.AddTouchEventdthis.group041,de=b{cc切换语言UIManager.ShowPaneldPanelTypeConst.SelectLane;},thise;this.AddTouchEventdthis.group05,de=b{cc服务协议this.ShowServiceInfode;},thise;this.AddTouchEventdthis.group06,de=b{cc隐私政策this.ShowPrivateInfode;},thise;GlobalEvent.SubscribedGlobalEventType.ChangeLanguage,this.RefreshLanInfo,thise;this.RefreshLanInfode;}privateRefreshLanInfode{this.label04.text=LanUtil.GetLanNamede;}privateShowServiceInfode{letdata:CommonDlgData=newCommonDlgData;data.leftText=LanUtil.GetTextd"确定"e;data.titleText=LanUtil.GetTextd"服务协议"e;data.leftFunc=de=b{};data.content=`您理解并同意：本软件同大多数互联网软件一样，可能会受多种因素影响，包括但不限于用户原因、网络服务质量、社会环境等；也可能会受各种安全问题的侵扰，包括但不限于他人非法利用用户资料，进行现实中的骚扰；用户下载安装的其他软件或访问的其他网站中可能含有病毒、木马程序或其他恶意程序，威胁您的终端设备信息和数据安全，继而影响本软件的正常使用等。因此，您应加强信息安全及个人信息的保护意识，注意密码保护，以免遭受损失。如果本游戏发现或者收到他人举报或投诉用户违反本协议约定的，本游戏有权不经通知随时对相关内容进行删除，并视行为情节对违规账号处以包括但不限于警告，限制或禁止使用全部或部分功能，取消游戏账号由此获得的相关奖励（比如游戏币、游戏积分、参赛资格或者其他游戏道具），账号封禁直至注销的处罚，并公告处理结果；情节严重的将移交有关行政管理机关给予行政处罚，或者追究刑事责任；用户应独自承担由此而产生的一切法律责任。温馨提示：本游戏对于您基于使用本软件及本服务所获得的虚拟货币、游戏币、游戏积分、参赛资格及其他游戏道具等均不提供任何形式的官方回购、直接或变相兑换现金或实物、相互赠予转让等服务及相关功能。您清楚知悉，本游戏严禁用户之间在游戏中及线下进行任何相互叫卖、转让虚拟货币、游戏币、游戏积分、参赛资格及其他游戏道具等行为。一经发现并经本游戏评估后，有权立即采取封号处理；情节严重的，有权移交相关机构依法处理。据此，也希望您能够号召其他用户对上述第7.3条规定的违规行为根据各棋牌游戏的要求开展举报（比如在游戏中点击对方头像，点击“举报”按钮进行举报），与本游戏一同为净化游戏环境共同努力。`;data.thisObj=this;UIManager.ShowPaneldPanelTypeConst.CommonTextInfo,datae;}privateShowPrivateInfode{letdata:CommonDlgData=newCommonDlgData;data.leftText=LanUtil.GetTextd"确定"e;data.titleText=LanUtil.GetTextd"隐私政策"e;data.leftFunc=de=b{};data.content=`您理解并同意：本软件同大多数互联网软件一样，可能会受多种因素影响，包括但不限于用户原因、网络服务质量、社会环境等；也可能会受各种安全问题的侵扰，包括但不限于他人非法利用用户资料，进行现实中的骚扰；用户下载安装的其他软件或访问的其他网站中可能含有病毒、木马程序或其他恶意程序，威胁您的终端设备信息和数据安全，继而影响本软件的正常使用等。因此，您应加强信息安全及个人信息的保护意识，注意密码保护，以免遭受损失。如果本游戏发现或者收到他人举报或投诉用户违反本协议约定的，本游戏有权不经通知随时对相关内容进行删除，并视行为情节对违规账号处以包括但不限于警告，限制或禁止使用全部或部分功能，取消游戏账号由此获得的相关奖励（比如游戏币、游戏积分、参赛资格或者其他游戏道具），账号封禁直至注销的处罚，并公告处理结果；情节严重的将移交有关行政管理机关给予行政处罚，或者追究刑事责任；用户应独自承担由此而产生的一切法律责任。温馨提示：本游戏对于您基于使用本软件及本服务所获得的虚拟货币、游戏币、游戏积分、参赛资格及其他游戏道具等均不提供任何形式的官方回购、直接或变相兑换现金或实物、相互赠予转让等服务及相关功能。您清楚知悉，本游戏严禁用户之间在游戏中及线下进行任何相互叫卖、转让虚拟货币、游戏币、游戏积分、参赛资格及其他游戏道具等行为。一经发现并经本游戏评估后，有权立即采取封号处理；情节严重的，有权移交相关机构依法处理。据此，也希望您能够号召其他用户对上述第7.3条规定的违规行为根据各棋牌游戏的要求开展举报（比如在游戏中点击对方头像，点击“举报”按钮进行举报），与本游戏一同为净化游戏环境共同努力。`;data.thisObj=this;UIManager.ShowPaneldPanelTypeConst.CommonTextInfo,datae;}protectedDestroyde{GlobalEvent.UnSubscribedGlobalEventType.ChangeLanguage,this.RefreshLanInfo,thise;}}}﻿modulegame{exportclassCommonItemextendsUIComponentBase{publicconstructordskinName:stringe{superdskinNamee;}privateisCreated:boolean=false;protectedchildrenCreatedde{super.childrenCreatedde;ccthis.currentState};protectedDestroyde{}}}﻿modulegame{exportclassShopBuyKaPaiWinData{publicitemId:number;publictype:number;publicInitByShopDataMgrditemId:number,type:numbere{this.itemId=itemId;this.type=type;returnthis;}}exportclassShopBuyKaPaiWinextendsUIComponentBase{privatecomWin:CommonWin;privateitemName:eui.Label;privateka:HeroKa1;privatekaBg:eui.Image;privatekaCount:eui.Label;privatebuyBtn:SButton;privatebg:eui.Image;privateexpProg:ProgressExp;privateinfo:ShopBuyKaPaiWinData;publicconstructorde{superd"ShopBuyKaPaiWinSkin"e;}publicDestroyde{this.comWin.Destroyde;this.ka.Destroyde;this.bg.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseTap,thise;}publicInitDataddata:ShopBuyKaPaiWinDatae{ifddata==nullereturnthis.info=data;this.comWin.InitdLanUtil.GetTextd"购买卡牌"e,this.OnCloseTap,thise;letitemInfo:GoodsDataItem=MainDataMgr.GetInstancede.shopDataMgr.GetItemdthis.info.itemIde;ifditemInfo==nullereturn;this.itemName.text=itemInfo.name;this.ka.currentState="shopItem";this.ka.validateNowde;this.ka.data=dnewHeroKa1Datae.PackCfgDataditemInfo.itemId,0e;cc[itemInfo.itemId,3,0];this.kaCount.text=`X${itemInfo.itemCount}`;this.buyBtn.label=`${itemInfo.salePrice}`;letheroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetHeroditemInfo.itemIde;ifdheroInfo==nullereturnthis.kaBg.source=`bg_shop_card_di_${heroInfo.quality}`;letqColor=Const.QualityColor[`Q${heroInfo.quality}`]this.itemName.textColor=qColor;this.kaCount.strokeColor=qColor;letexp=heroInfo.exp;letupCost=heroInfo.GetUpCostCardde;this.expProg.SetSataQuickdupCost,expe;this.AddTouchEventdthis.buyBtn,this.OnBuyTap,thise;this.bg.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseTap,thise;}privateOnCloseTapde:egret.TouchEvente{UIManager.HidePaneldPanelTypeConst.ShopBuyKaPaiWine;}privateOnBuyTapde:egret.TouchEvente{letmMgr=MainDataMgr.GetInstancedeletitem=mMgr.shopDataMgr.GetItemdthis.info.itemIde;ifditem==nullereturn;ifditem.limitCounta1ereturnTipsManager.ShowTipsdLanUtil.GetTextd"购买次数不足"ee;ifdmMgr.diamandaitem.salePriceereturnTipsManager.ShowTipsdLanUtil.GetTextd"钻石不足"ee;ClientNet.NetShop.C2SBuydthis.info.itemIde;UIManager.HidePaneldPanelTypeConst.ShopBuyKaPaiWine;}}}﻿modulegame{exportclassShopBuyKaPaiWinCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnShopBuyKaPaiWin;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,false,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿modulegame{exportclassShopBuyWinData{itemId:number;type:number;publicDestroyde{}publicInitByShopDataMgrditemId:number,type:numbere{this.itemId=itemId;this.type=type;returnthis;}}exportclassShopBuyWinextendsUIComponentBase{privatecomWin:CommonWin;privatetitle:eui.Label;privatebuyBtn:SButton;privateitem:ShopGoodsItem;publicinfo:ShopBuyWinData;publicconstructorde{superd"ShopBuyWinSkin"e;}protectedchildrenCreatedde{super.childrenCreatedde;}publicInitDataddata:ShopBuyWinDatae{this.info=data;this.SetBaseViewde;this.AddTouchEventdthis.buyBtn,this.OnBuyTap,thise;}protectedDestroyde{this.comWin.Destroyde;}privateSetBaseViewde{letitemId=this.info.itemId;letinfo=MainDataMgr.GetInstancede.shopDataMgr.GetItemditemIde;this.item.data=itemId;this.buyBtn.label=`${info.salePrice}`;this.comWin.Initd`购买${info.name}`,this.OnCloseTap,thise;}privateOnBuyTapde:egret.TouchEvente{GlobalEvent.FireEventdGlobalEventType.ShopBuyItem,this.infoe;}cc----------------------------------------------------------------------EventprivateOnCloseTapde:egret.TouchEvente{UIManager.HidePaneldPanelTypeConst.ShopBuyWine;}}}﻿modulegame{exportclassShopBuyWinCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnShopBuyWin;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,false,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿modulegame{exportclassShopDiamandItemData{type:number;publicitemId:number;publicDestroyde{}publicInitditemId:numbere{this.itemId=itemId;this.type=ShopType.Diamond;returnthis;}}exportclassShopDimandItemextendsItemRenderBase{privateiconImg:eui.Image;privatepriceLb:eui.Label;privatetitle:eui.Label;privatetestId:eui.Label;publicconstructorde{superd"ShopDimandItemSkin"e;}publicDestroyde{this.data.Destroyde;}publicdataChangedde{ifdthis.data==nullereturn;letdata=this.dataasShopDiamandItemData;this.SetItemInfoddatae;}privateSetItemInfoddata:ShopDiamandItemDatae{letinfo=MainDataMgr.GetInstancede.shopDataMgr.GetItemddata.itemIde;ifdinfo==nullereturn;this.priceLb.text=`${info.salePrice}`;this.iconImg.source=`${info.showIcon}`;this.title.text=`${info.name}`;this.testId.text=`${info.id}`;this.testId.visible=GameData.DevelopMode==DevelopMode.Debug;}}}﻿modulegame{exportclassShopDimandPanelextendsUIComponentBase{privatelist:eui.List;privateupdateList:eui.ArrayCollection;publicconstructorde{superd"ShopDimandPanelSkin"e;}protectedchildrenCreatedde{super.childrenCreatedde;}publicInitDatade{this.updateList=neweui.ArrayCollectionde;this.list.itemRenderer=ShopDimandItem;this.list.dataProvider=this.updateList;this.list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;letdimandArray=MainDataMgr.GetInstancede.shopDataMgr.GetGoodsArraydShopType.Diamonde;letinfo:ShopDiamandItemData;fordleti=0,len=dimandArray.length;ialen;i++e{info=newShopDiamandItemDatade.InitddimandArray[i]e;this.updateList.addItemdinfoe;}GlobalEvent.SubscribedGlobalEventType.ShopBuyItem,this.OnBuyItem,thise;}protectedDestroyde{letinfo:ShopDiamandItemData;fordleti=0,len=this.updateList.length;ialen;i++e{dthis.updateList.getItemAtdieasShopDiamandItemDatae.Destroyde;}this.updateList=null;this.list.removeEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;GlobalEvent.UnSubscribedGlobalEventType.ShopBuyItem,this.OnBuyItem,thise;}cc----------------------------------------------------------------------EditprivateOnBuyItemdinfo:ShopBuyWinDatae{ifdinfo.type!=ShopType.Diamondereturn;letitemId=info.itemId;letitem=MainDataMgr.GetInstancede.shopDataMgr.GetItemditemIde;ifditem==nullereturn;ifditem.limitCounta1ereturn;ClientNet.NetShop.C2SBuyditemIde;UIManager.HidePaneldPanelTypeConst.ShopBuyWine;}cc----------------------------------------------------------------------EventprivateOnItemTapde:eui.ItemTapEvente{letdata=e.itemasShopDiamandItemDataletinfo=dnewShopBuyWinDatae.InitByShopDataMgrddata.itemId,data.typee;UIManager.ShowPaneldPanelTypeConst.ShopBuyWin,infoe;}}}﻿modulegame{exportclassShopGoldItemData{publicitemId:number;publictype:number;publicDestroyde{}publicInitByShopDataMgrditemId:numbere{this.itemId=itemId;this.type=ShopType.Gold;returnthis;}}exportclassShopGoldItemextendsItemRenderBase{privateiconImg:eui.Image;privatepriceLb:eui.Label;privatetitle:eui.Label;privatetestId:eui.Label;publicconstructorde{superd"ShopGoldItemSkin"e;}publicDestroyde{this.data.Destroyde;}publicdataChangedde{ifdthis.data==nullereturn;letdata=this.dataasShopGoldItemData;ccitemIdthis.SetItemInfoddatae;}cc----------------------------------------------------------------------privateSetItemInfoddata:ShopGoldItemDatae{letinfo=MainDataMgr.GetInstancede.shopDataMgr.GetItemddata.itemIde;this.priceLb.text=`${info.salePrice}`;this.iconImg.source=`${info.showIcon}`;this.title.text=`${info.name}`;this.testId.text=`${info.id}`;this.testId.visible=GameData.DevelopMode==DevelopMode.Debug;}}}﻿modulegame{exportclassShopGoldPanelextendsUIComponentBase{privatelist:eui.List;privateupdateList:eui.ArrayCollection;publicconstructorde{superd"ShopGoldPanelSkin"e;}protectedchildrenCreatedde{super.childrenCreatedde;}publicInitDatade{this.updateList=neweui.ArrayCollectionde;this.list.itemRenderer=ShopGoldItem;this.list.dataProvider=this.updateList;letgoldArray=MainDataMgr.GetInstancede.shopDataMgr.GetGoodsArraydShopType.Golde;letinfo:ShopGoldItemData;fordleti=0,len=goldArray.length;ialen;i++e{info=dnewShopGoldItemDatae.InitByShopDataMgrdgoldArray[i]e;this.updateList.addItemdinfoe;}this.list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;GlobalEvent.SubscribedGlobalEventType.ShopBuyItem,this.OnBuyItem,thise;}protectedDestroyde{letinfo:ShopGoldItemData;fordleti=0,len=this.updateList.length;ialen;i++e{dthis.updateList.getItemAtdieasShopGoldItemDatae.Destroyde;}this.updateList=null;this.list.removeEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;GlobalEvent.UnSubscribedGlobalEventType.ShopBuyItem,this.OnBuyItem,thise;}cc----------------------------------------------------------------------EditprivateOnBuyItemdinfo:ShopBuyWinDatae{ifdinfo.type!=ShopType.Goldereturn;letitemId=info.itemId;letitem=MainDataMgr.GetInstancede.shopDataMgr.GetItemditemIde;ifditem==nullereturn;ifditem.limitCounta1ereturn;ClientNet.NetShop.C2SBuyditemIde;UIManager.HidePaneldPanelTypeConst.ShopBuyWine;}cc----------------------------------------------------------------------EventprivateOnItemTapde:eui.ItemTapEvente{letdata=e.itemasShopGoldItemDataletinfo=dnewShopBuyWinDatae.InitByShopDataMgrddata.itemId,data.typee;UIManager.ShowPaneldPanelTypeConst.ShopBuyWin,infoe;}}}﻿modulegame{exportclassShopGoodsItemextendsItemRenderBase{privateitemName:eui.Label;privateicon:eui.Image;privatecountLb:eui.Label;publicitemId:number;publicconstructorde{superd"ShopGoodsItemSkin"e;}protectedDestroyde{this.itemId=null;}dataChangedde{ifdthis.data==nullereturn;letitem=MainDataMgr.GetInstancede.shopDataMgr.GetItemdthis.datae;ifditem==nullereturn;this.itemId=this.data;this.countLb.text=`${item.limitCount}`;this.itemName.text=`${item.name}`;this.icon.source=`item_${item.itemId}`;}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassShopInfoCextendsUICtrlBase{publicconstructorde{superde;}cc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return["home_shop"];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnShopInfoPanel;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0e;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}c***初始化面板数据*cpublicInitDatade:void{}}}﻿modulegame{exportclassShopInfoPanelextendsUIComponentBase{publicmainBg:MainPanelBg;ccprivateviewGroup:eui.Group;ccprivatedimandPanel:ShopDimandPanel;ccprivategoldPanel:ShopGoldPanel;ccprivatekapaiPanel:ShopKaPaiPanel;ccprivatetabGroup:eui.Group;privatedimandTab:TabItem2;privategoldTab:TabItem2;privatekapaiTab:TabItem2;ccprivatecurrTab:TabItem2;ccprivatecurrView:UIComponentBase;publicconstructorde{superd"ShopInfoSkin"e;}publicDestroyde{this.mainBg.Destroyde;}publicInitDataddata:any[]e{letinfo=dnewMainPanelBgDatae.PackData1d"button_return_shop",this.OnCloseTap,thise;this.mainBg.Initdinfoe;lettab1Info=dnewMainPanelBgTabDatadee.PackDatad1,TabItem2,ShopDimandPanele;lettab2Info=dnewMainPanelBgTabDatadee.PackDatad2,TabItem2,ShopGoldPanele;lettab3Info=dnewMainPanelBgTabDatadee.PackDatad3,TabItem2,ShopKaPaiPanele;this.dimandTab=this.mainBg.AddTabdtab1InfoeasTabItem2;this.goldTab=this.mainBg.AddTabdtab2InfoeasTabItem2;this.kapaiTab=this.mainBg.AddTabdtab3InfoeasTabItem2;this.dimandTab.Initd"钻石","钻石"e;this.goldTab.Initd"金币","金币"e;this.kapaiTab.Initd"精选卡牌","精选卡牌"e;this.mainBg.SetTabIndexd1e;}cc----------------------------------------------------------------------EventprivateOnCloseTapde:egret.TouchEvente{UIManager.HidePaneldPanelTypeConst.ShopInfoe;}}}﻿modulegame{exportclassShopInfoTabData{publictype:number;publicisSel:boolean;privatesrc={}publicGetTypeSrcde{return[""]}}exportclassShopInfoTabextendseui.Button{privateiconImg:eui.Image;publictype:numberpublicconstructorde{superde;this.skinName="ShopInfoTabSkin";this.touchChildren=false;}publicDestroyde{}cc----------------------------------------------------------------------Apisetselecteddflag:booleane{ifdthis.type==1ecc钻石{ifdflag==trueethis.currentState="selected_zs";elsethis.currentState="common_zs";}elseifdthis.type==2e{ifdflag==trueethis.currentState="selected_jb";elsethis.currentState="common_jb";}this.validateNowde;}}}﻿modulegame{exportclassShopKaPaiItemData{publicitemId:number;cc商品idpublictype:number;publicDestroyde{};publicInitByShopDataMgrditemId:numbere{this.itemId=itemId;this.type=ShopType.JXKPreturnthis;}}exportclassShopKaPaiItemextendsItemRenderBase{privatebg:eui.Image;privateitemName:eui.Label;privateprice:eui.Label;privateka:HeroKa1;privatekaCount:eui.Label;privatekapaiBg:eui.Image;privatekaPaiNumProg:eui.ProgressBar;privateprogLb:eui.BitmapLabel;privatecostIcon:eui.Image;privatezhekouIcon:eui.Image;privatezhekou:eui.Label;privatepriceGroup:eui.Group;privateyuanjia:SLabelByLine;privatelimitClassTips:eui.Label;privatefreeTips:eui.Label;privatehasBuyTips:eui.Label;privategreyBox:eui.Group;privatehasBuyIcon:eui.Image;publicinfo:ShopKaPaiItemData;publicconstructorde{superd"ShopKaPaiItemSkin"e;}publicDestroyde{this.info.Destroyde;}publicdataChangedde{ifdthis.data==nullereturn;this.info=this.data;letinfo=MainDataMgr.GetInstancede.shopDataMgr.GetItemdthis.info.itemIde;this.AddPropCBdinfo,"hasBuy",this.UpdateAllUIe}cc----------------------------------------------------------------------未解锁privateShowLockViewde{this.bg.source=`bg_shop_spdi04`;RenderUtils.SetGreydthis.greyBox,truee;this.priceGroup.visible=false;this.freeTips.visible=false;this.hasBuyTips.visible=false;this.hasBuyIcon.visible=false;this.itemName.textColor=this.limitClassTips.textColor;}cc----------------------------------------------------------------------免费privateShowFreeViewde{this.bg.source=`bg_shop_spdi03`;this.limitClassTips.visible=false;this.priceGroup.visible=false;this.hasBuyTips.visible=false;this.hasBuyIcon.visible=false;}cc----------------------------------------------------------------------已购买privateShowHasBuyde{this.bg.source=`bg_shop_spdi02`;this.kaPaiNumProg.visible=false;this.kaCount.visible=false;this.priceGroup.visible=false;this.limitClassTips.visible=false;this.freeTips.visible=false;this.progLb.visible=false;}cc----------------------------------------------------------------------可购买privateShowCanBuyde{this.bg.source=`bg_shop_spdi01`;this.limitClassTips.visible=false;this.freeTips.visible=false;this.hasBuyTips.visible=false;this.hasBuyIcon.visible=false;}privateShowProgressViewdinfo:GoodsDataItem,heroInfo:CardDataIteme{letupCost=heroInfo.GetUpCostCardde;letexp=heroInfo.exp;ifdexpaupCoste{this.kaPaiNumProg.currentState="common";this.kaPaiNumProg.validateNowde;}else{this.kaPaiNumProg.currentState="canUpgrade";this.kaPaiNumProg.validateNowde;}this.kaPaiNumProg.minimum=0;this.kaPaiNumProg.maximum=upCost;this.kaPaiNumProg.value=exp;this.progLb.text=`${exp}!${upCost}`}privateUpdateAllUIde{letinfo=MainDataMgr.GetInstancede.shopDataMgr.GetItemdthis.info.itemIde;letheroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetHerodinfo.itemIde;this.bg.source=`bg_shop_spdi01`;this.itemName.text=info.name;this.itemName.textColor=Const.QualityColor[`Q${heroInfo.quality}`];this.kaCount.text=`X${info.itemCount}`this.kaCount.strokeColor=Const.QualityColor[`Q${heroInfo.quality}`];this.kapaiBg.source=`bg_shop_card_di_${heroInfo.quality}`;this.ka.currentState="shopItem";this.ka.validateNowde;this.ka.data=dnewHeroKa1Datae.PackCfgDatadinfo.itemId,0e;this.limitClassTips.text=`${info.limitGrade}阶竞技场可购买`;this.costIcon.source=`item_${info.costType}`;this.price.text=`${info.salePrice}`;this.ShowProgressViewdinfo,heroInfoe;this.yuanjia.lb.text=``;this.yuanjia.SetLinedfalsee;ifdinfo.price!=info.salePricee{this.yuanjia.lb.text=`${info.price}`;this.yuanjia.lb.fontFamily=`main_font`;this.yuanjia.lb.textColor=0x4f4f4f;this.yuanjia.lb.size=26;this.yuanjia.validateNowde;this.yuanjia.SetLinedtruee;}ifdinfo.salePercent!=null&&info.salePercentb0e{this.zhekou.textFlow=dnewegret.HtmlTextParserdee.parserd`afontsize="24"b${info.salePercentc10}acfontsize="20"b折acfontb`e;this.zhekou.visible=true;this.zhekouIcon.visible=true;}else{this.zhekou.visible=false;this.zhekouIcon.visible=false;}this.priceGroup.visible=true;this.limitClassTips.visible=true;this.freeTips.visible=true;this.hasBuyTips.visible=true;this.hasBuyIcon.visible=true;this.kaPaiNumProg.visible=true;this.progLb.visible=true;RenderUtils.SetGreydthis.greyBox,falsee;cc展示逻辑ifdinfo.IsUnlockedde==trueeifdinfo.IsHasCountde==falseethis.ShowHasBuyde;elseifdinfo.IsFreede==trueethis.ShowFreeViewde;elsethis.ShowCanBuyde;elsethis.ShowLockViewde;}}}﻿modulegame{exportclassShopKaPaiPanelextendsUIComponentBase{privatelist:eui.List;publicupdateList:eui.ArrayCollection;publicconstructorde{superd"ShopKaPaiPanelSkin"e;}publiccreateChildrende{super.createChildrende}publicDestroyde{letinfo:ShopKaPaiItemData;fordleti=0,len=this.updateList.length;ialen;i++e{dthis.updateList.getItemAtdieasShopKaPaiItemDatae.Destroyde;}this.updateList=null;this.list.removeEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;}publicInitDatade{this.updateList=neweui.ArrayCollectionde;this.list.itemRenderer=ShopKaPaiItem;this.list.dataProvider=this.updateList;letheroArray=MainDataMgr.GetInstancede.shopDataMgr.GetKaPaiArrayde;letinfo:ShopKaPaiItemData;fordleti=0,len=heroArray.length;ialen;i++e{info=dnewShopKaPaiItemDatae.InitByShopDataMgrdheroArray[i]e;this.updateList.addItemdinfoe;}this.list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.OnItemTap,thise;}privateOnCloseTapde:egret.TouchEvente{UIManager.HidePaneldPanelTypeConst.ShopKaPaiPanele;}privateOnItemTapde:eui.ItemTapEvente{letdata=e.itemasShopKaPaiItemDataletitemInfo=MainDataMgr.GetInstancede.shopDataMgr.GetItemddata.itemIde;ifditemInfo==nullereturn;ifditemInfo.IsUnlockedde==falseereturnTipsManager.ShowTipsd`未达到购买卡牌的等阶`e;ifditemInfo.IsHasCountde==falseereturnTipsManager.ShowTipsd`不能再次购买`e;ifditemInfo.IsEnoughCostde==falsee{letinfo=dnewShopQuickBuyWinDatae.PackDatadShopType.Diamonde;returnUIManager.ShowPaneldPanelTypeConst.ShopQuickBuyWin,infoe;}letinfo=dnewShopBuyKaPaiWinDatae.InitByShopDataMgrddata.itemId,data.typee;UIManager.ShowPaneldPanelTypeConst.ShopBuyKaPaiWin,infoe;SoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;}}}﻿modulegame{exportclassShopKaPaiPanelCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return["home_shop"];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnShopKaPaiPanel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,truee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}modulegame{exportclassShopQuickBuyItemData{publictype:number;publicitemId:number;publicDestroyde{}publicPackDatadtype:number,itemId:numbere{this.type=type;this.itemId=itemId;returnthis;}}exportclassShopQuickBuyItemextendsItemRenderBase{privateitemCount:eui.Label;privateiconImg:eui.Image;publicbuyBtn:SButton;publicinfo:ShopQuickBuyItemData;publicconstructorde{superd"ShopQuickBuyItemSkin"e;}publicDestroyde{this.info.Destroyde;}publicdataChangedde{ifdthis.data==nullereturn;this.info=this.dataasShopQuickBuyItemData;letitemInfo=MainDataMgr.GetInstancede.shopDataMgr.GetItemdthis.info.itemIde;ifditemInfo==nullereturn;this.itemCount.text=`x${itemInfo.itemCount}`;this.iconImg.source=`${itemInfo.showIcon}`;ifditemInfo.costType==ShopCostType.DIMANDe{this.buyBtn.currentState="buyGold";this.buyBtn.validateNowde;this.buyBtn.label=`${itemInfo.salePrice}`;this.itemCount.textColor=0xc17c1a;}elseifditemInfo.costType==ShopCostType.RMBe{this.buyBtn.currentState="buyDimand";this.buyBtn.validateNowde;this.buyBtn.label=`￥${itemInfo.salePrice}`;this.itemCount.textColor=0x4193d2;}}}}modulegame{exportclassShopQuickBuyWinData{type:numberpublicDestroyde{};publicPackDatadtype:numbere{this.type=type;returnthis;}publicGetTypeNamede{ifdthis.type==ShopType.Diamondereturn"钻石"elseifdthis.type==ShopType.Goldereturn"金币"return""}}exportclassShopQuickBuyWinextendsUIComponentBase{privateitem1:ShopQuickBuyItem;privateitem2:ShopQuickBuyItem;privateitem3:ShopQuickBuyItem;privatecomWin:CommonWin;privatetips:eui.Label;publicinfo:ShopQuickBuyWinData;publicconstructorde{superd"ShopQuickBuyWinSkin"e;}protectedchildrenCreatedde{super.childrenCreatedde;}publicInitDataddata:ShopQuickBuyWinDatae{this.info=data;lettypeName=data.GetTypeNamede;this.comWin.Initd`购买${typeName}`,this.OnCloseTap,thise;this.tips.text=`你没有足够的${typeName}，请先去购买`;ifddata.type==ShopType.Golde{this.item1.data=dnewShopQuickBuyItemDatadee.PackDatadShopType.Gold,23110e;this.item2.data=dnewShopQuickBuyItemDatadee.PackDatadShopType.Gold,23111e;this.item3.data=dnewShopQuickBuyItemDatadee.PackDatadShopType.Gold,23112e;}elseifddata.type==ShopType.Diamonde{this.item1.data=dnewShopQuickBuyItemDatadee.PackDatadShopType.Diamond,23010e;this.item2.data=dnewShopQuickBuyItemDatadee.PackDatadShopType.Diamond,23011e;this.item3.data=dnewShopQuickBuyItemDatadee.PackDatadShopType.Diamond,23012e;}this.AddTouchEventdthis.item1.buyBtn,this.OnBuyTap,thise;this.AddTouchEventdthis.item2.buyBtn,this.OnBuyTap,thise;this.AddTouchEventdthis.item3.buyBtn,this.OnBuyTap,thise;}protectedDestroyde{this.info&&this.info.Destroyde;}privateOnBuyTapde:egret.TouchEvente{letitemId=de.target.parentasShopQuickBuyIteme.info.itemId;letitemInfo=MainDataMgr.GetInstancede.shopDataMgr.GetItemditemIde;ifditemInfo.IsHasCountde==falseereturnTipsManager.ShowTipsd"无购买次数"e;ClientNet.NetShop.C2SBuyditemIde;UIManager.HidePaneldPanelTypeConst.ShopQuickBuyWine;}cc----------------------------------------------------------------------EventprivateOnCloseTapde:egret.TouchEvente{UIManager.HidePaneldPanelTypeConst.ShopQuickBuyWine;}}}modulegame{exportclassShopQuickBuyWinCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnShopQuickBuyWin;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,true,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿modulegame{exportclassAttrInfoItemextendsItemRenderBase{privatebg:eui.Image;privateicon:eui.Image;privateattrName:eui.Label;privateattrValue:eui.Label;privateaddAttrValue:eui.Label;privateinfoBtn:SButton;publicid:number;privateinfo:any[];privatecardCfg:any;publicconstructorde{superd"AttrInfoItemSkin"e;}publicDestroyde{this.id=null;this.info=null;this.cardCfg=null;ifdthis.infoBtn.hasEventListenerdegret.TouchEvent.TOUCH_TAPe==trueethis.infoBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnInfoTap,thise;}publicdataChangedde{this.info=this.data;ifdthis.info==nullereturn;cccccccccccccccccccccccccccccccccccccccccccccccccccletattrType=this.info[0];letvalue:string=`${this.info[1]}`;letbgType:number=this.info[3]||1;letshowAddValue:boolean=this.info[4]||true;ifdthis.info[2]!=nullevalue+=`-${this.info[2]}`;letpHeroLv:number=this.info[5];cccccccccccccccccccccccccccccccccccccccccccccccccccletcardCfg=JsonData.getGameDatad"cardattrdata_json"e[attrType];this.cardCfg=cardCfg;ifdcardCfg==nullereturn;this.icon.source=`home_ui_common_json.${cardCfg.icon}`;this.attrName.text=`${cardCfg.name}`;this.attrValue.text=`${cardCfg.prefix}${value}${cardCfg.postfix}`;ifdthis.id!=nulle{letheroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetHerodthis.ideasHeroDataItem;ifdheroInfo==nullereturn;ifdshowAddValue==truee{ccletupCost=heroInfo.GetUpCostCardde;ccletexp=heroInfo.exp;ccifdexpb=upCostecc{letnextLvValue;ifdpHeroLv==nullenextLvValue=heroInfo.GetNextLevelAttrdattrTypee;elsenextLvValue=heroInfo.GetNextLevelAttrdattrType,pHeroLve;letaddValue=nextLvValue-Numberdvaluee;ifdnextLvValuea=0||addValuea=0ethis.addAttrValue.text="";elsethis.addAttrValue.text=`+${addValue}`;cc}ccelsecc{ccthis.addAttrValue.text="";cc}}else{this.addAttrValue.text="";}}ifdcardCfg.hero!=null&&cardCfg.herob0e{this.infoBtn.visible=true;ifdthis.infoBtn.hasEventListenerdegret.TouchEvent.TOUCH_TAPe==falseethis.infoBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnInfoTap,thise;}else{this.infoBtn.visible=false;}ifdbgType==1e{this.bg.source="bg_kz_kpxx_szd01"}else{this.bg.source="bg_kz_kpxx_szd02"}}privateOnInfoTapde:egret.TouchEvente{ifdthis.cardCfg.hero==null||this.info[1]==nullereturn;letpoint=this.localToGlobaldthis.infoBtn.x,this.infoBtn.ye;GlobalEvent.FireEventdGlobalEventType.ShowAttrTips,this.cardCfg.hero,this.info[1],point.x,point.y-this.infoBtn.heightc2e}}}﻿modulegame{exportclassAttrTipsItemextendsItemRenderBase{privateheroName:eui.Label;privateattrGroup:eui.Group;privatebg:eui.Group;privatecontentGroup:eui.Group;privateinfo:number[]publicconstructorde{superd"AttrTipsItemSkin"e;}publicDestroyde{this.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseSelf,thise}publicdataChangedde{ifdthis.hasEventListenerdegret.TouchEvent.TOUCH_TAPe==falseethis.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseSelf,thisethis.info=this.data;cc[heroId,lv]ifdthis.info==nullereturn;cccccccccccccccccccccccccccccccccccccccccccccccccccletheroId=this.info[0];letlv=this.info[1];letpoint=this.globalToLocaldthis.info[2],this.info[3]e;letpHeroLv=this.info[4];ccccccccccccccccccccccccccc\cccccccccccccccccccccccclethMgr=MainDataMgr.GetInstancede.heroDataMgrletheroInfo=hMgr.GetHerodheroIde;this.heroName.text=heroInfo.name;this.contentGroup.left=point.x-this.contentGroup.widthc2;this.contentGroup.bottom=720-point.y;this.RemoveAllAttrde;letheroCfg=hMgr.GetCfgdheroIde[lv-1];ifdheroCfg==null||heroCfg.showattr==nullereturn;fordleti=0,len=heroCfg.showattr.length;ialen;i++e{letattrItem=newAttrInfoItemde;attrItem.id=heroId;letarr=[].concatdheroCfg.showattr[i]earr[3]=2;arr[5]=pHeroLv;attrItem.data=arrcc[type,value];this.attrGroup.addChilddattrIteme;}}privateRemoveAllAttrde{letattrItem:AttrInfoItem;whiledthis.attrGroup.numChildrenb0e{attrItem=this.attrGroup.removeChildAtd0easAttrInfoItem;attrItem.Destroyde;attrItem=null;}}privateOnCloseSelfde:egret.TouchEvente{GlobalEvent.FireEventdGlobalEventType.HideAttrTipse;}}}﻿modulegame{exportclassDrowMenuDataextendsDataBase{publicmenuLbArray:string[];publiccurrIndex:number;privatecallFn:Function;privatethisObj:any;publicshowMenu:booleanpublicDestroyde{}publicPackDatadmenuLbArray:string[],currIndex:number,callFn:Function,thisObj:anye{this.menuLbArray=[];fordleti=0,len=menuLbArray.length;ialen;i++e{this.menuLbArray.pushdmenuLbArray[i]e;this.currIndex=currIndex;}this.callFn=callFn;this.thisObj=thisObj;this.SetIndexdcurrIndexe;this.SetMenudfalsee;returnthis;}publicSetIndexdindex:numbere{this.SetAttrd"currIndex",indexe;}publicSetMenudshow:booleane{this.SetAttrd"showMenu",showe;}publicExecdindex:numbere{ifdthis.callFn!=null&&this.thisObj!=nullethis.callFn.calldthis.thisObj,indexe;}publicGetCurrLbde{returnthis.menuLbArray[this.currIndex];}}exportclassDrowMenuextendsUIComponentBase{privateshowBtn:eui.Button;privatemenuGroup:eui.Group;privateselectImg:eui.Image;privatebg:eui.Image;info:DrowMenuData;publicconstructorde{superd"DrowMenuSkin"e;}publicInitdinfo:DrowMenuDatae{ifdinfo==nullereturn;this.info=info;fordleti=0,len=info.menuLbArray.length;ialen;i++e{letlb=this.CreateLbdinfo.menuLbArray[i]e;this.menuGroup.addChilddlbe;}this.menuGroup.visible=false;this.showBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnShowBtnTap,thise;this.menuGroup.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnMenuTap,thise;this.AddPropCBdthis.info,"currIndex",this.OnRefreshIndex,thise;this.AddPropCBdthis.info,"showMenu",this.OnShowMenu,thise;}publicDestroyde{ifdthis.info!=nullethis.info.Destroyde;}privateOnRefreshIndexde{this.showBtn.label=this.info.GetCurrLbde;letlb=this.menuGroup.getChildAtdthis.info.currIndexe;this.selectImg.y=32+lb.y;}privateOnShowMenude{letflag=this.info.showMenu;this.menuGroup.visible=flag;this.selectImg.visible=flag;this.bg.visible=flag;}privateOnShowBtnTapde:egret.TouchEvente{this.info.SetMenud!this.menuGroup.visiblee;ccSoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;}privateOnMenuTapde:egret.TouchEvente{ifdegret.isde.target,"eui.Label"e==falseereturn;letlb:eui.Label=e.target;this.info.SetMenudfalsee;this.info.SetIndexdthis.menuGroup.getChildIndexdlbee;this.info.Execdthis.info.currIndexe;ccSoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;}privateCreateLbdstr:stringe{letlb=neweui.Label;lb.text=str;lb.textColor=0x69F6D0;lb.size=20;lb.fontFamily="desc_font";lb.left="5";lb.textAlign="center";lb.height=30;lb.verticalAlign="middle";returnlb;}}}﻿modulegame{exportclassDrowMenuItemextendseui.Component{privateshowlabel:eui.Label;privatebg:eui.Image;publictype:number;publicconstructorde{superde;this.skinName="DrowMenuItemSkin";}publicInitdtype:number,text:stringe{this.showlabel.text=text;this.type=type;}publicDestroyde{}publicSeldflag:booleane{ifdflag==truee{this.currentState="active";this.validateNowde;}else{this.currentState="common";this.validateNowde;}}}}modulegame{exportclassHeroInfoUpgradeBtnDataextendsDataBase{publicgoldCost:number;publiclvId:number;publicPackMyHeroDatadheroId:numbere{letheroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetHerodheroIde;this.lvId=heroInfo.AddAttrListenerd"lv",de=b{this.goldCost=heroInfo.GetUpCostGoldde;letmyGold=MainDataMgr.GetInstancede.gold;letupGradeCard=heroInfo.GetUpCostCardde;letmaxLv=heroInfo.GetHeroMaxLevelde;},thise;returnthis;}publicDestroyde{this.RemoveOnePropCBd"lv",this.lvIde;super.Destroyde;}}exportclassHeroInfoUpgradeBtnextendsSButton{privatecost:eui.BitmapLabel;privateaddExp:eui.Label;publicbtn:SButton;publicinfo:HeroInfoUpgradeBtnData;publicconstructorde{superde;this.skinName="HeroInfoUpgradeBtnSkin";}publicDestroyde{ifdthis.info!=nullethis.info.Destroyde;}publicInitDatadinfo:HeroInfoUpgradeBtnDatae{ifdinfo==nullereturn;this.info=info;this.AddPropCBdthis.info,"goldCost",this.UpdateCoste;}privateUpdateCostde{this.cost.text=`${this.info.goldCost}`;}}}﻿modulegame{exportclassHeroInfoWin1extendsUIComponentBase{privatecloBtn:eui.Rect;privateheroName:eui.Label;privateinfo:number;publicconstructorde{superd"HeroInfoWin1Skin"e;}publicInitDataddata:numbere{this.Opende;this.cloBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseTap,thise;}publicDestroyde{this.cloBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseTap,thise;}cc----------------------------------------------------------------------EditprivateOpende{this.heroName.text=this.info+"";}cc----------------------------------------------------------------------EventprivateOnCloseTapde:egret.TouchEvente{UIManager.HidePaneldPanelTypeConst.HeroInfoWin1e;}}}﻿modulegame{exportclassHeroInfoWin1CextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnHeroInfoWin1;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,falsee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿modulegame{exportclassHeroKa1Data{publicheroId:number;publictype:number;publicrank:number;publicrankType:number;publicglolocType:number;publiclv:number;publicshowUpTips:boolean;publicMINE:number=1;publicRANK:number=2;publicCFG:number=3;publicPackPlayerDatadheroId:number,showUpTips:boolean=truee{this.heroId=heroId;this.type=this.MINE;this.showUpTips=showUpTips;cc在军队列表里是不显示升级提示的，因为有进度条的升级提示了。returnthis;}publicPackRankDatadheroId:number,rankType:number,glolocType:number,rank:numbere{this.heroId=heroId;this.type=this.RANK;this.rank=rank;this.rankType=rankType;this.glolocType=glolocType;returnthis;}publicPackCfgDatadheroId:number,lv:numbere{this.heroId=heroId;this.type=this.CFG;this.lv=lv;returnthis;}publicDestroyde{}}exportclassHeroKa1extendsItemRenderBase{privatebg:eui.Image;privateheroIcon:eui.Image;privatetypeIcon:eui.Image;privatecampBg:eui.Image;protectedlevel:HeroLevel;privatecost:eui.BitmapLabel;privatetestId:eui.Label;protectedupTips:eui.Image;ccpublicheroId:number;publicinfo:HeroKa1Data;publicconstructorde{superd"HeroKa1Skin"e;this.Initde;}publiccreateChildrende{super.createChildrende;this.cacheAsBitmap=true;}publicInitde{}publicDestroyde{ccthis.heroId=null;ifdthis.level!=nullethis.level.Destroyde;ifdthis.info!=nulle{this.info.Destroyde;this.info=null;}egret.Tween.removeTweensdthis.upTipse;}publicdataChangedde{ifdthis.data==nullereturn;ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccthis.info=this.dataasHeroKa1Data;ifdthis.info.heroId==null||this.info.heroIda=0ereturn;ifdthis.info.type==this.info.MINEe{this.UpdateMyHerode;}elseifdthis.info.type==this.info.RANKe{this.UpdateRankHerode;}elseifdthis.info.type==this.info.CFGe{this.UpdateByCfgde;}}cc----------------------------------------------------------------------处理我的英雄的情况privateUpdateMyHerode{this.UpdateStaticViewde;letheroInfo=game.MainDataMgr.GetInstancede.heroDataMgr.GetHerodthis.info.heroIde;ifdheroInfo==nullereturn;this.AddPropCB_NotCalldheroInfo,"lv",this.Upgradee;this.AddPropCB_NotCalldheroInfo,"exp",this.Upgradee;this.Upgradede;}privateUpgradede{ifdthis.info==nullereturn;letheroInfo=game.MainDataMgr.GetInstancede.heroDataMgr.GetHerodthis.info.heroIde;ifdthis.info.showUpTips==truee{letupCost=heroInfo.GetUpCostCardde;letexp=heroInfo.exp;letshow=expb=upCost&&heroInfo.GetLvdeaheroInfo.GetHeroMaxLeveldethis.upTips.visible=show;this.ShowUpTipsTweendshowe;}else{this.upTips.visible=false;}this.level.SetLvdheroInfo.GetLvde,heroInfo.qualitye;}privateShowUpTipsTweendshow:booleane{egret.Tween.removeTweensdthis.upTipse;ifdshow==truee{this.upTips.bottom=16;this.upTips.alpha=1;egret.Tween.getdthis.upTips,{loop:true}e.tod{bottom:26,alpha:0},1000e;}}cc----------------------------------------------------------------------处理排行榜的英雄的情况privateUpdateRankHerode{this.UpdateStaticViewde;this.upTips.visible=false;letplayInfo=game.MainDataMgr.GetInstancede.rankDataMgr.GetOneRankInfodthis.info.rankType,this.info.glolocType,this.info.ranke;ifdplayInfo==nullereturn;fordletheroofplayInfo.teame{ifdhero.heroId==this.info.heroIde{letquality=MainDataMgr.GetInstancede.heroDataMgr.GetCfgdthis.info.heroIde.quality;this.level.SetLvdhero.level,qualitye;}}}cc----------------------------------------------------------------------根据配置表填充数据privateUpdateByCfgde{letheroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetCfgdthis.info.heroIde;;ifdheroInfo==nullereturn;letlv=this.info.lv;letquality=heroInfo.quality;this.upTips.visible=false;this.level.SetLvdlv,qualitye;this.UpdateStaticViewde;}cc----------------------------------------------------------------------privateprivateUpdateStaticViewde{letheroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetCfgdthis.info.heroIde;ifdheroInfo==nullereturn;this.bg.source=`common_ui_common_json.bg_card_di_${heroInfo.quality}`;this.cost.text=StringdheroInfo.coste;this.testId.text=Stringdthis.info.heroIde;this.testId.visible=GameData.DevelopMode==DevelopMode.Debug;ifdheroInfo.camp!=0e{this.typeIcon.visible=this.campBg.visible=true;this.typeIcon.source=`home_ui_kz_json.icon_sl_0${heroInfo.camp}_s`;}else{this.campBg.visible=false;this.typeIcon.visible=false;}ifdRES.hasResd`common_ui_heroicon_json.${this.info.heroId}`e==trueethis.heroIcon.source=`common_ui_heroicon_json.${this.info.heroId}`;elsethis.heroIcon.source="";}}}﻿modulegame{exportclassHeroKa2extendsItemRenderBase{privatechuzhan:SButton;privateczLb:eui.Label;privateczImg:eui.Image;privateleaderName:eui.Label;privateselImg:eui.Group;privatebg:eui.Rect;privateleaderImg:eui.Image;privatetypeIcon:eui.Image;privateinfoBtn:SButton;privatetestId:eui.Label;publicleaderId:number;privatesel:boolean;privateisChuZhan:boolean;publicconstructorde{superd"HeroKa2Skin"e;this.Initde;}publicInitde{this.sel=false;this.selected=this.sel;this.isChuZhan=false;this.chuzhaned=this.isChuZhan;this.infoBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnInfoTap,thise;this.bg.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnSelect,thise;this.chuzhan.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnChuZhan,thise;}publicDestroyde{this.infoBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnInfoTap,thise;this.bg.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnSelect,thise;this.chuzhan.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnChuZhan,thise;}publicdataChangedde{this.leaderId=this.dataifdthis.leaderId==nullereturn;letteamInfo=MainDataMgr.GetInstancede.teamDataMgr.GetLeaderInfoByIddthis.leaderIde;ifdteamInfo==nullereturn;letleader=MainDataMgr.GetInstancede.heroDataMgr.GetLeaderdthis.leaderIde;letisUnLock=MainDataMgr.GetInstancede.heroDataMgr.hasLeaders.indexOfdleader.ideb=0;ifdisUnLock==truee{RenderUtils.SetGreydthis,falsee;this.bg.enabled=this.chuzhan.enabled=true;}else{RenderUtils.SetGreydthis,truee;this.bg.enabled=this.chuzhan.enabled=false;}this.leaderName.text=teamInfo.namethis.leaderImg.source=`common_ui_kingtowerhalf_json.king_${teamInfo.id}`;this.testId.text=Stringdthis.leaderIde;this.typeIcon.source=leader.camp!=0?`home_ui_kz_json.icon_sl_0${leader.camp}_s`:""GlobalEvent.FireEventdGlobalEventType.InitLeaderView,thise;}cc----------------------------------------------------------------------EventprivateOnInfoTapde:egret.TouchEvente{UIManager.ShowPaneldPanelTypeConst.LeaderInfoPanel,this.leaderIde;}privateOnSelectde{GlobalEvent.FireEventdGlobalEventType.TeamChangeSelLeader,thise;}privateOnChuZhande{cc判断当前卡组是否适合该领主letnotSuitCount:number=0;letmMgr=game.MainDataMgr.GetInstancede;letteamInfo=mMgr.teamDataMgr.GetCurrTeamInfode;letleadInfo=mMgr.heroDataMgr.GetLeaderdthis.leaderIde;letid:number,heroInfo:HeroDataItem;fordleti=0,len=teamInfo.heroArray.length;ialen;i++e{id=teamInfo.heroArray[i];heroInfo=mMgr.heroDataMgr.GetHerodideasHeroDataItem;ifdheroInfo==nullecontinue;ifdheroInfo.camp!=leadInfo.camp&&heroInfo.camp!=0e{notSuitCount++;}}ifdnotSuitCountb0e{lettext=`afontsize="24"b\n\n更换领主后卡组中与新领主不同阵营的卡牌将会自动替换成同阵营卡牌！acfontb`;letdata:CommonDlgData=newCommonDlgData;data.leftText=LanUtil.GetTextd"取消"e;data.leftIcon="button_ty_blue";data.rightText=LanUtil.GetTextd"确定"e;data.rightIcon="button_ty_green";data.titleText=LanUtil.GetTextd"更换领主"e;data.content=text;data.thisObj=this;data.leftFunc=de=b{};data.rightFunc=de=b{GlobalEvent.FireEventdGlobalEventType.TeamChuZhan,thise;};data.closeFunc=de=b{};UIManager.ShowPaneldPanelTypeConst.CommonDlg,datae;}else{GlobalEvent.FireEventdGlobalEventType.TeamChuZhan,thise;}}cc----------------------------------------------------------------------apipublicgetchuzhanedde{returnthis.isChuZhan;}publicsetchuzhaneddflag:booleane{this.isChuZhan=flag;ifdflag==truee{this.czLb.visible=this.czImg.visible=true;this.chuzhan.visible=false;}else{this.czLb.visible=this.czImg.visible=false;this.chuzhan.visible=true;}}publicsetselecteddflag:booleane{this.sel=flag;this.selImg.visible=flag;}publicgetselectedde{returnthis.sel;}}}﻿modulegame{exportclassHeroKa3extendsItemRenderBase{privateheroKa:HeroKa1;privateczBtn:SButton;privateinfoBtn:SButton;privatecannotUseStip:eui.Group;publicheroId:number;privateisActive:booleanpublicconstructorde{superd"HeroKa3Skin"e;this.Initde;}publicInitde{this.isActive=false;this.heroId=-1;}publicDestroyde{this.isActive=false;this.heroId=-1;this.heroKa.Destroyde;}publicdataChangedde{this.heroId=this.dataifdthis.heroId==null||this.heroIda0ereturn;ifdthis.isActive==falsee{this.ShowCommonde;}else{this.ShowActivede;}}cc----------------------------------------------------------------------EditprivateShowCommonde{this.currentState="common";this.validateNowde;this.heroKa.touchChildren=false;this.heroKa.touchEnabled=true;this.heroKa.data=dnewHeroKa1Datae.PackPlayerDatadthis.heroIde;cc[this.heroId];letcanNotUse=true;lethMgr=MainDataMgr.GetInstancede.heroDataMgr;letheroInfo=hMgr.GetHerodthis.heroIde;ifdheroInfo.camp==0e{canNotUse=false;}else{letteamInfo=MainDataMgr.GetInstancede.teamDataMgr.GetCurrTeamInfode;letleaderInfo=hMgr.GetHerodteamInfo.leadere;ifdheroInfo.camp==leaderInfo.campecanNotUse=false;}RenderUtils.SetGreydthis.heroKa,canNotUsee;RenderUtils.SetGreydthis.czBtn,canNotUsee;this.czBtn.enabled=canNotUse==false;this.cannotUseStip.visible=canNotUse;}privateShowActivede{this.currentState="active";this.validateNowde;this.heroKa.touchChildren=false;this.heroKa.touchEnabled=false;this.heroKa.data=dnewHeroKa1Datae.PackPlayerDatadthis.heroIde;cc[this.heroId];letcanNotUse=MainDataMgr.GetInstancede.heroDataMgr.CheckHasLockdthis.heroIde==true;RenderUtils.SetGreydthis.czBtn,canNotUsee;this.czBtn.enabled=canNotUse==false;}cc----------------------------------------------------------------------EventpublicsetSelecteddflag:booleane{this.isActive=flag;this.dataChangedde;}}}modulegame{exportclassHeroKa4Data{heroId:number;publicPackDatadheroId:numbere{this.heroId=heroId;returnthis;}}exportclassHeroKa4extendsItemRenderBase{privateheroKa:HeroKa1;privateqqBtn:SButton;privateinfoBtn:SButton;publicinfo:HeroKa4Data;privateisActive:booleanpublicconstructorde{superd"HeroKa4Skin"e;this.Initde;}publicInitde{this.isActive=false;}publicDestroyde{this.isActive=false;this.heroKa.Destroyde;}publicdataChangedde{this.info=this.dataifdthis.data==nullereturn;ifdthis.isActive==falsee{this.ShowCommonde;}else{this.ShowActivede;}}cc----------------------------------------------------------------------EditprivateShowCommonde{this.currentState="common";this.validateNowde;this.heroKa.touchChildren=false;this.heroKa.touchEnabled=true;this.heroKa.data=dnewHeroKa1Datae.PackPlayerDatadthis.info.heroIde;cc[this.heroId];letcanNotUse=true;lethMgr=MainDataMgr.GetInstancede.heroDataMgr;letheroInfo=hMgr.GetHerodthis.info.heroIde;ifdheroInfo==nullereturn;ifdheroInfo.camp==0e{canNotUse=false;}else{letteamInfo=MainDataMgr.GetInstancede.teamDataMgr.GetCurrTeamInfode;letleaderInfo=hMgr.GetHerodteamInfo.leadere;ifdheroInfo.camp==leaderInfo.campecanNotUse=false;}RenderUtils.SetGreydthis.heroKa,canNotUsee;RenderUtils.SetGreydthis.qqBtn,canNotUsee;this.qqBtn.enabled=canNotUse==false;}privateShowActivede{this.currentState="active";this.validateNowde;this.heroKa.touchChildren=false;this.heroKa.touchEnabled=false;this.heroKa.data=dnewHeroKa1Datae.PackPlayerDatadthis.info.heroIde;cc[this.heroId];letcanNotUse=MainDataMgr.GetInstancede.heroDataMgr.CheckHasLockdthis.info.heroIde==true;RenderUtils.SetGreydthis.qqBtn,canNotUsee;this.qqBtn.enabled=canNotUse==false;}cc----------------------------------------------------------------------EventpublicsetSelecteddflag:booleane{this.isActive=flag;this.dataChangedde;}}}modulegame{exportclassHeroka5Data{publicheroId:number;publiccount:number;publiccurrState:string;publicDestroyde{}publicPackHeroDatadheroId:number,count:numbere{this.heroId=heroId;this.count=count;letheroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetHerodheroIde;ifdheroInfo!=nulle{ifdheroInfo.lvaheroInfo.GetHeroMaxLeveldeethis.currState="common";elsethis.currState="done";}returnthis;}}exportclassHeroka5extendsItemRenderBase{privatekapaiBg:eui.Image;privateheroKa:HeroKa1;privatekaCount:eui.Label;publicinfo:Heroka5Data;publicconstructorde{superd"HeroKa5Skin"e;}publicDestroyde{ifdthis.info!=nullethis.info.Destroyde;}publicdataChangedde{ifdthis.data==nullereturn;this.info=this.data;letheroCfg=JsonData.getGameDatad"herodata_json"e[this.info.heroId];ifdheroCfg==nullereturn;this.currentState=this.info.currState;this.validateNowde;this.kapaiBg.source=`bg_shop_card_di_${heroCfg.quality}`;this.kaCount.text=`X${this.info.count}`;letheroData=dnewHeroKa1Datae.PackCfgDatadthis.info.heroId,1e;this.heroKa.data=heroData;}}}﻿modulegame{exportclassLeaderInfoPanelextendsUIComponentBase{privatetitle:eui.Label;privatelevel:eui.Label;privateheroIcon:eui.Image;privatecamp:eui.Image;privateattr1:AttrInfoItem;privateattr2:AttrInfoItem;privateattr3:AttrInfoItem;privateattr4:AttrInfoItem;privatedesc:eui.Label;privatecampName:eui.Label;privateleaderId:number;publicconstructorde{superd"LeaderInfoPanelSkin",truee;}publicInitDataddata:numbere{ifddata==nullereturn;this.leaderId=data;this.InitViewde;}publicDestroyde{}cc----------------------------------------------------------------------EditprivateInitViewde{letleaderInfo=MainDataMgr.GetInstancede.heroDataMgr.GetLeaderdthis.leaderIdeasLeaderDataItem;ifdleaderInfo==nullereturn;this.title.text=`${leaderInfo.name}`;this.level.text=`${leaderInfo.lv}`;this.heroIcon.source=`common_ui_kingtowerhalf_json.king_${leaderInfo.id}`;this.camp.source=`home_ui_kz_json.icon_sl_0${leaderInfo.camp}_s`;this.desc.text=`${leaderInfo.desc}`;this.campName.text=Const.CampName[`CAMP_${leaderInfo.camp}`];lethMgr=MainDataMgr.GetInstancede.heroDataMgr;letleaderCfg=hMgr.GetCfgdthis.leaderIde[leaderInfo.GetLvde-1];ifdleaderCfg==null||leaderCfg.showattr==nullereturn;this.attr1.data=leaderCfg.showattr[0];this.attr2.data=leaderCfg.showattr[1];this.attr3.data=leaderCfg.showattr[2];this.attr4.data=leaderCfg.showattr[3];}cc----------------------------------------------------------------------EventprivateOnCloseTapde:egret.TouchEvente{UIManager.HidePaneldPanelTypeConst.LeaderInfoPanele;}}}﻿modulegame{exportclassLeaderInfoPanelCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnLeaderInfoPanel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,false,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}ccTypeScriptfile﻿modulegame{exportclassTeamPanelextendsUIComponentBase{privatetabGroup:eui.Group;privateheroGroup:eui.Group;privatemainBg:MainPanelBg;privateselLeaderWin:TeamSelLeaderWin;privateleaderBtn:SButton;privateteamBtn:SButton;privateselHeroWin:eui.Group;privateselHeroBg:eui.Rect;privateselHeroGroup:eui.Group;privateheroModel:eui.Image;privateaverageCost:eui.BitmapLabel;privatechangeHeroGroup:eui.Group;privatechangeHeroGroupBg:eui.Image;privatecKaHero:HeroKa1;privateselListBg:eui.Image;privatemenu:DrowMenu;privatehasNum:eui.BitmapLabel;privatetotalNum:eui.BitmapLabel;privatemaskBg:eui.Image;cc用于遮挡privatenoTips:eui.Label;privateleaderBg:eui.Image;publiccurrTab:TeamTab;privatecurrCZleader:HeroKa2;cc当前出战的领主privatecurrSelLeader:HeroKa2;cc显示当前选中的领主，而不是当前出战的领主privatecurrChangingHero:HeroKa3;cc当前将要切换的英雄privateswapOHero:HeroKa1;publicconstructorde{superd"TeamPanelSkin"e;}publicInitDatade{letteamId=game.MainDataMgr.GetInstancede.teamDataMgr.currentTeamIndex;cc默认打开作战卡组this.InitdteamIde;}publicInitdteamId:numbere{letinfo=dnewMainPanelBgDatae.PackData1d"button_return_kz",this.OnCloseTap,thise;this.mainBg.Initdinfoe;ifdteamIda=0||teamIdbthis.tabGroup.numChildrenereturn;this.RemoveAllTabde;this.InitTabde;lettab=this.tabGroup.getChildAtdteamId-1easTeamTab;tab&&this.InitViewdtabe;letteamInfo=MainDataMgr.GetInstancede.teamDataMgr.GetTeamInfodthis.GetCurrTeamIddee;ifdteamInfo==nullereturn;this.AddTouchEventdthis.leaderBtn,this.OnLeaderTap,thise;this.AddTouchEventdthis.teamBtn,this.OnTeamTap,thise;this.tabGroup.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnTabTap,thise;this.heroGroup.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnHeroGroupTap,thise;this.selHeroBg.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnSelHeroBgTap,thise;this.maskBg.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnSelHeroBgTap,thise;this.selHeroGroup.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnSelHeroListTap,thise;this.changeHeroGroupBg.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnChangeBgTap,thise;this.selListBg.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnSelListBgTap,thise;GlobalEvent.SubscribedGlobalEventType.TeamHideLeaderWin,this.HideLeaderWin,thise;GlobalEvent.SubscribedGlobalEventType.TeamChuZhan,this.ChangeChuZhan,thise;GlobalEvent.SubscribedGlobalEventType.TeamChangeSelLeader,this.ChangeLeaderSel,thise;GlobalEvent.SubscribedGlobalEventType.ChangeLeader,this.RefreshChangeLeader,thise;GlobalEvent.SubscribedGlobalEventType.SWapHero,this.SwapHero,thise;GlobalEvent.SubscribedGlobalEventType.ChangeTeamIndex,this.ChangeTab,thise;}publicDestroyde{this.currTab=null;this.currCZleader=null;this.currSelLeader=null;this.currChangingHero=null;this.swapOHero=null;this.menu.Destroyde;this.RemoveAllHerode;this.RemoveAllSelHerode;this.RemoveAllTabde;this.mainBg.Destroyde;this.currTab=null;this.tabGroup.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnTabTap,thise;this.heroGroup.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnHeroGroupTap,thise;this.selHeroBg.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnSelHeroBgTap,thise;this.maskBg.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnSelHeroBgTap,thise;this.selHeroGroup.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnSelHeroListTap,thise;this.changeHeroGroupBg.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnChangeBgTap,thise;this.selListBg.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnSelListBgTap,thise;GlobalEvent.UnSubscribedGlobalEventType.TeamHideLeaderWin,this.HideLeaderWin,thise;GlobalEvent.UnSubscribedGlobalEventType.TeamChuZhan,this.ChangeChuZhan,thise;GlobalEvent.UnSubscribedGlobalEventType.TeamChangeSelLeader,this.ChangeLeaderSel,thise;GlobalEvent.UnSubscribedGlobalEventType.ChangeLeader,this.RefreshChangeLeader,thise;GlobalEvent.UnSubscribedGlobalEventType.InitLeaderView,this.InitChuZhanView,thise;GlobalEvent.UnSubscribedGlobalEventType.SWapHero,this.SwapHero,thise;GlobalEvent.UnSubscribedGlobalEventType.ChangeTeamIndex,this.ChangeTab,thise;}cc----------------------------------------------------------------------Editcc----------------------------------------------------------------------Editcc----------------------------------------------------------------------EditprivateInitViewdtab:TeamTabe{ifdthis.currTab!=nullethis.currTab.Selected=false;this.RemoveAllHerode;this.currTab=tab;ifdthis.currTab!=nulle{this.currTab.Selected=true;this.InitHeroGroupde;}letarr=game.MainDataMgr.GetInstancede.teamDataMgr.teamHeroListSortData;letinfo=newDrowMenuDatade.PackDatadarr,0,this.OnSortCB,thise;this.menu.Initdinfoe;this.HideHeroWinde;this.HideLeaderWinde;letteamInfo=MainDataMgr.GetInstancede.teamDataMgr.GetLeaderInfoByTeamIddthis.GetCurrTeamIddee;ifdteamInfo==nullereturn;this.heroModel.source=`kingtower_${teamInfo.id}_png`;cc这个以后会改成使用clipName字段this.averageCost.text=`${this.CalcAvgCostde}`;this.maskBg.visible=false;}privateChangeTabde{ifdthis.currTab==nullereturn;this.currTab.Selected=true;letteamMgr=game.MainDataMgr.GetInstancede.teamDataMgr;letteamInfo:TeamInfo=teamMgr.teamMap.getdthis.GetCurrTeamIddee,item:HeroKa1;ifdteamInfo==nullereturn;fordleti=0;iateamMgr.MaxMemberNum;i++e{ifdibthis.heroGroup.numChildren-1ebreak;item=this.heroGroup.getChildAtdieasHeroKa1;ifditem==nullecontinue;item.data=dnewHeroKa1Datae.PackPlayerDatadteamInfo.heroArray[i]e;}letleaderInfo=MainDataMgr.GetInstancede.teamDataMgr.GetLeaderInfoByTeamIddthis.GetCurrTeamIddee;this.heroModel.source=`kingtower_${leaderInfo.id}_png`;cc这个以后会改成使用clipName字段this.averageCost.text=`${this.CalcAvgCostde}`;}privateShowLeaderWinde{GlobalEvent.SubscribedGlobalEventType.InitLeaderView,this.InitChuZhanView,thise;this.selLeaderWin.visible=true;this.leaderBg.visible=true;this.selLeaderWin.InitViewdcc已激活的领主列表ccgame.MainDataMgr.GetInstancede.heroDataMgr.leadersMap.keysde所有领主game.MainDataMgr.GetInstancede.heroDataMgr.hasLeaderse;}privateHideLeaderWinde{this.selLeaderWin.visible=false;this.leaderBg.visible=false;GlobalEvent.UnSubscribedGlobalEventType.InitLeaderView,this.InitChuZhanView,thise;}privateInitChuZhanViewdleader:HeroKa2e{letteamInfo=MainDataMgr.GetInstancede.teamDataMgr.GetTeamInfodthis.GetCurrTeamIddee;ifdteamInfo==nullereturn;ifdleader.leaderId!=teamInfo.leaderereturn;GlobalEvent.UnSubscribedGlobalEventType.InitLeaderView,this.InitChuZhanView,thise;ifdthis.currCZleader!=nullethis.currCZleader.chuzhaned=false;this.currCZleader=leader;ifdthis.currCZleader!=nullethis.currCZleader.chuzhaned=true;}cc在选择领主界面出战领主ccchuzhanprivateChangeChuZhandleader:HeroKa2e{ifdthis.currCZleader!=nullethis.currCZleader.chuzhaned=false;this.currCZleader=leader;ifdthis.currCZleader!=nullethis.currCZleader.chuzhaned=true;ifdthis.currCZleader!=null&&this.currTab!=nulleClientNet.NetTeam.C2SUpdateTeamd1,this.currTab.teamId,null,this.currCZleader.leaderIde;}cc切换当前选中的领主privateChangeLeaderSeldleader:HeroKa2e{ifdthis.currSelLeader!=nullethis.currSelLeader.selected=false;this.currSelLeader=leader;ifdthis.currSelLeader!=nullethis.currSelLeader.selected=true;}cc领主出战privateRefreshChangeLeaderdteamId:number,leaderId:numbere{ifdthis.currTab==null||this.currTab.teamId!=teamIdereturn;this.currTab.dataChangedde;letteamInfo=MainDataMgr.GetInstancede.teamDataMgr.GetLeaderInfoByTeamIddthis.GetCurrTeamIddee;ifdteamInfo==nullereturn;this.heroModel.source=`kingtower_${teamInfo.id}_png`;}cc打开切换英雄窗口privateShowHeroWinde{this.RemoveAllSelHerode;this.InitSelHeroGroupde;this.hasNum.text=StringdMainDataMgr.GetInstancede.heroDataMgr.hasHeros.lengthe;this.totalNum.text=`!${MainDataMgr.GetInstancede.heroDataMgr.heroKeysArray.length}`;this.selHeroWin.visible=true;this.maskBg.visible=true;}privateHideHeroWinde{this.selHeroWin.visible=false;this.maskBg.visible=false;this.menu.info.SetMenudfalsee;ifdthis.currChangingHero!=nulle{this.currChangingHero.Selected=false;this.currChangingHero=null;}}cc切换需要查看消息的英雄privateChangeChangingHerodhero:HeroKa3e{ifdthis.currChangingHero!=nullethis.currChangingHero.Selected=false;this.currChangingHero=hero;ifdthis.currChangingHero!=nulle{this.currChangingHero.Selected=true;this.selHeroGroup.setChildIndexdthis.currChangingHero,777e;}}cc显示准备切换的界面privateShowReadyChangedheroId:numbere{ifdheroId==null||heroIda=0ereturn;this.cKaHero.data=dnewHeroKa1Datae.PackPlayerDatadheroIde;cc[heroId,1,0];this.changeHeroGroup.visible=true;this.maskBg.visible=false;ifdthis.currChangingHero!=nullethis.currChangingHero.Selected=false;}privateHideReadyChangede{this.changeHeroGroup.visible=false;this.maskBg.visible=true;this.cKaHero.data=dnewHeroKa1Datae.PackPlayerDatad-1e;cc[-1];}cc切换英雄heroId在阵营中需要切换的英雄idprivateSwapHerodheroIds:number[]=[]e{ifdthis.swapOHero==null||this.currChangingHero==nullecc切换领主的情况。此时应该替换为领主初始配置的英雄组{letchild:HeroKa1;fordleti=0,len=heroIds.length;ialen;i++e{ifdi+1bthis.heroGroup.numChildrenebreak;child=this.heroGroup.getChildAtdieasHeroKa1;child.data=dnewHeroKa1Datae.PackPlayerDatadheroIds[i]e;cc[heroIds[i]];}}else{letoHeroId=this.swapOHero.info.heroId;letnewHeroId=this.currChangingHero.heroId;this.swapOHero.data=dnewHeroKa1Datae.PackPlayerDatadnewHeroIde;this.currChangingHero.data=oHeroId;this.swapOHero=null;this.currChangingHero=null;this.HideReadyChangede;}this.averageCost.text=`${this.CalcAvgCostde}`;}privateOnSortCBdtype:numbere{this.RemoveAllSelHerode;lettMgr=MainDataMgr.GetInstancede.teamDataMgr;lethasHeroIds=game.MainDataMgr.GetInstancede.heroDataMgr.hasHeros;ifdtype==0e{hasHeroIds=tMgr.SortQualitydhasHeroIds,tMgr.currentTeamIndexe;}elseifdtype==1e{hasHeroIds=tMgr.SortLeveldhasHeroIds,tMgr.currentTeamIndexe;}elseifdtype==2e{hasHeroIds=tMgr.SortCostdhasHeroIds,tMgr.currentTeamIndexe;}ifdhasHeroIds.lengthb0e{letheroArray=tMgr.GetTeamInfodtMgr.currentTeamIndexe.heroArray;ifdheroArray==nullereturn;letheroId:number,hero:HeroKa3,j:number=0;fordleti=0,len=hasHeroIds.length;ialen;i++e{heroId=hasHeroIds[i];hero=newHeroKa3de;hero.data=heroId;hero.x=36+228*dj%3e;hero.y=-2+140*Math.floordjc3e;this.selHeroGroup.addChilddheroe;j++;}this.selHeroGroup.visible=true;this.noTips.visible=false;}else{this.selHeroGroup.visible=false;this.noTips.visible=true;}}cc----------------------------------------------------------------------Eventcc----------------------------------------------------------------------Eventcc----------------------------------------------------------------------EventprivateOnCloseTapde:egret.TouchEvente{UIManager.HidePaneldPanelTypeConst.TeamPanele;}privateOnLeaderTapde:egret.TouchEvente{this.ShowLeaderWinde;}privateOnTeamTapde:egret.TouchEvente{this.ShowHeroWinde;}privateOnTabTapde:egret.TouchEvente{SoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;lettab=e.target;ifdegret.isdtab,"game.TeamTab"e==truee{ifdthis.currTab==tabereturn;letteamInfo=game.MainDataMgr.GetInstancede.teamDataMgr.teamMap.getddtabasTeamTabe.teamIde;ifdteamInfo!=null&&teamInfo.leaderb0e{ifdthis.currTab!=nullethis.currTab.Selected=false;this.currTab=tab;ifdthis.currTab!=nulle{ClientNet.NetTeam.C2SSetTeamIndexdthis.currTab.teamIde;}}else{TipsManager.ShowTipsdLanUtil.GetTextd"卡组未解锁"ee;}}}cc点击卡库背景privateOnSelHeroBgTapde:egret.TouchEvente{this.HideHeroWinde;}cc点击右侧英雄privateOnHeroGroupTapde:egret.TouchEvente{ifdegret.isde.target,"game.HeroKa1"ee{lettarget=e.targetasHeroKa1;ifdthis.cKaHero.info!=null&&this.cKaHero.info.heroIdb0ecc切换英雄{ifdthis.cKaHero.info.heroIda=0ereturn;letmMgr=MainDataMgr.GetInstancedelettMgr=mMgr.teamDataMgr;letheroIds:number[]=Utils.ArrayCopydtMgr.GetTeamInfodthis.currTab.teamIde.heroArraye;letoHeroInfo=mMgr.heroDataMgr.GetHerodtarget.info.heroIde;ifdoHeroInfo==nullereturn;letindex=heroIds.indexOfdoHeroInfo.ide;ifdindexa0ereturn;letnewHeroInfo=mMgr.heroDataMgr.GetHerodthis.cKaHero.info.heroIde;heroIds.splicedindex,1,newHeroInfo.ide;this.swapOHero=target;ClientNet.NetTeam.C2SUpdateTeamd2,this.currTab.teamId,target.info.heroId,this.cKaHero.info.heroIde;}else{letheroId=target.info.heroId;letinfo=dnewHeroInfoPanelDatae.PackPlayerDatadheroIde;UIManager.ShowPaneldPanelTypeConst.HeroInfoPanel,infoe;}SoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;}}cc点击列表英雄privateOnSelHeroListTapde:egret.TouchEvente{ifdegret.isde.target,"game.HeroKa1"eecc点击卡牌{letka3=e.target.parentasHeroKa3;letcanUse=false;lethMgr=MainDataMgr.GetInstancede.heroDataMgr;letheroInfo=hMgr.GetHerodka3.heroIde;ifdheroInfo.camp==0e{canUse=true;}else{letteamInfo=MainDataMgr.GetInstancede.teamDataMgr.GetCurrTeamInfode;letleaderInfo=hMgr.GetHerodteamInfo.leadere;ifdheroInfo.camp==leaderInfo.campecanUse=true;}ifdcanUse==falseereturnTipsManager.ShowTipsdLanUtil.GetTextd"该领主无法使用这张卡"ee;ifdegret.isdka3,"game.HeroKa3"e==falseereturn;SoundManager.Insde.PlayEffectd"10010_attack_07_mp3"e;this.ChangeChangingHerodka3e;}elseifdegret.isde.target,"game.HeroKa3"eecc点击展开后的卡牌{this.ChangeChangingHerodnulle;}elseifdegret.isde.target,"SButton"ee{letka3:HeroKa3=e.target.parent;ifdde.targetasSButtone.name=="infoBtn"e{letinfo=dnewHeroInfoPanelDatae.PackPlayerDatadka3.heroIde;UIManager.ShowPaneldPanelTypeConst.HeroInfoPanel,infoe;}elseifdde.targetasSButtone.name=="czBtn"e{this.ShowReadyChangedka3.heroIde;}}}privateOnChangeBgTapde:egret.TouchEvente{this.HideReadyChangede;}cc点击卡库背景privateOnSelListBgTapde:egret.TouchEvente{this.ChangeChangingHerodnulle;this.menu.info.SetMenudfalsee;ccthis.HideHeroWinde;}cc----------------------------------------------------------------------ToolprivateCalcAvgCostde:string{letheroArray=MainDataMgr.GetInstancede.teamDataMgr.GetTeamInfodthis.GetCurrTeamIddee.heroArray;letheroInfo:CardDataItem,heroId:number,totalCost:number=0,avgCost:string="",len:number=heroArray.length;ifdlena=0ereturn"0";fordleti=0;ialen;i++e{heroId=heroArray[i];heroInfo=MainDataMgr.GetInstancede.heroDataMgr.GetHerodheroIde;totalCost+=heroInfo.cost;}avgCost=dtotalCostclene.toFixedd1e;returnavgCost.replaced".","#"e;}privateGetCurrTeamIdde{ifdthis.currTab==nullereturn-1;returnthis.currTab.teamId;}privateInitTabde{letteamMgr=game.MainDataMgr.GetInstancede.teamDataMgrletteamInfo:TeamInfo;fordleti=0,len=this.tabGroup.numChildren;ialen;i++e{teamInfo=teamMgr.teamMap.getdi+1e;ifdteamInfo==nullebreak;dthis.tabGroup.getChildAtdieasTeamTabe.data=teamInfo.teamId;}}privateRemoveAllTabde{lettab:TeamTab;letteamMgr=game.MainDataMgr.GetInstancede.teamDataMgrfordleti=0,len=this.tabGroup.numChildren;ialen;i++e{dthis.tabGroup.getChildAtdieasTeamTabe.Destroyde;}}cc初始化右侧英雄列表privateInitHeroGroupde{letteamMgr=game.MainDataMgr.GetInstancede.teamDataMgrletteamInfo:TeamInfo=teamMgr.teamMap.getdthis.GetCurrTeamIddee;ifdteamInfo==nullereturn;letheroId:number;fordleti=0,len=this.heroGroup.numChildren;ialen;i++e{heroId=teamInfo.heroArray[i];ifdheroId==nullebreak;dthis.heroGroup.getChildAtdieasHeroKa1e.data=dnewHeroKa1Datae.PackPlayerDatadheroIde;cc[heroId];}}privateRemoveAllHerode{letka:HeroKa1;fordleti=0,len=this.heroGroup.numChildren;ialen;i++e{dthis.heroGroup.getChildAtdieasHeroKa1e.Destroyde;}}cc初始化卡库英雄列表privateInitSelHeroGroupde{this.OnSortCBdthis.menu.info.currIndexe;}privateRemoveAllSelHerode{lethero:HeroKa3;whiledthis.selHeroGroup.numChildrenb0e{hero=this.selHeroGroup.removeChildAtd0easHeroKa3;hero.Destroyde;hero=null;}}}}﻿modulegame{exportclassTeamPanelCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return["home_hero","home_kz"];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnTeamPanel;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,true,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿modulegame{exportclassTeamSelLeaderWinextendseui.Component{privateleaderGroup:eui.Group;privatebg:eui.Rect;privateleaderArray:number[];publicconstructorde{superde;this.skinName="TeamSelLeaderWinSkin";}publicInitde{this.bg.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseTap,thise;}publicDestroyde{this.RemoveAllLeaderde;this.bg.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseTap,thise;}cc----------------------------------------------------------------------EditpublicInitViewdleaderArray:number[]e{ifdleaderArray==nullereturn;this.leaderArray=leaderArray;this.RemoveAllLeaderde;this.InitGroupde;this.Initde;}publicHideViewde{this.Destroyde;}cc----------------------------------------------------------------------EventprivateOnCloseTapde:egret.TouchEvente{GlobalEvent.FireEventdGlobalEventType.TeamHideLeaderWine;}cc----------------------------------------------------------------------HeroGrouppublicInitGroupde{letleader:HeroKa2;fordleti=0,len=this.leaderArray.length;ialen;i++e{leader=newHeroKa2de;leader.data=this.leaderArray[i];this.leaderGroup.addChilddleadere;}}publicRemoveAllLeaderde{letleader:HeroKa2;whiledthis.leaderGroup.numChildrenb0e{leader=this.leaderGroup.removeChildAtd0easHeroKa2;leader.Destroyde;leader=null;}}}}﻿modulegame{ccexportclassTeamTabDatacc{ccpublictype:number;cc0有领主未选中1有领主选中2无领主未选中3无领主选中4未解锁ccpublicteamId:number;cc}exportclassTeamTabextendsItemRenderBase{privatedesc:eui.Label;privateleaderIcon:eui.Image;privateiconBg:eui.Image;privateisSel:boolean;publicteamId:number;publicconstructorde{superd"TeamTabSkin"e;this.Initde;}publicInitde{this.isSel=false;this.touchChildren=false;}publicDestroyde{this.teamId=null;}publicdataChangedde{this.teamId=this.data;ifdthis.teamId==nullereturn;letteamInfo=game.MainDataMgr.GetInstancede.teamDataMgr.teamMap.getdthis.teamIde;ifdteamInfo==nullereturn;ifdteamInfo.leaderb0e{ifdthis.isSel==truee{this.ShowSelectedde;}else{this.ShowCommonde}}else{this.ShowLockde;}}cc----------------------------------------------------------------------EditprivateShowCommonde{this.currentState="common";this.validateNowde;lethero=game.MainDataMgr.GetInstancede.teamDataMgr.GetLeaderInfoByTeamIddthis.teamIde;ifdhero==nullereturn;this.desc.text=`${hero.name}`;this.leaderIcon.source=`common_ui_kingtowericon_json.king_${hero.id}`;this.iconBg.source=`home_ui_kz_json.button_kz_02_txk02`;}privateShowSelectedde{this.currentState="selected";this.validateNowde;lethero=game.MainDataMgr.GetInstancede.teamDataMgr.GetLeaderInfoByTeamIddthis.teamIde;ifdhero==nullereturn;this.desc.text=`${hero.name}`;this.leaderIcon.source=`common_ui_kingtowericon_json.king_${hero.id}`;this.iconBg.source=`home_ui_kz_json.button_kz_01_txk02`;}privateShowLockde{this.currentState="lock";this.validateNowde;this.desc.text=LanUtil.GetTextd"未解锁"e;}cc----------------------------------------------------------------------ApipublicsetSelecteddflag:booleane{this.isSel=flag;this.dataChangedde;}}}﻿modulegame{exportabstractclassItemRenderBaseextendseui.ItemRenderer{publicselected:boolean;publicitemIndex:number;cc-------------接口必须实现数据----------------protectedisRemoveCBOnDataChanged:boolean=false;private_keyMapInfo:SMapaDataBase,SMapanumber,stringbb;publicconstructordskinName:stringe{superde;this.skinName=skinName;this._keyMapInfo=newSMapaDataBase,SMapanumber,stringbbde;ccthis.addEventListenerdegret.Event.REMOVED_FROM_STAGE,this.OnRemoveFromStage,thise;ccthis.addEventListenerdegret.Event.ADDED_TO_STAGE,this.OnAddToStage,thise;this.addEventListenerdeui.PropertyEvent.PROPERTY_CHANGE,this.OnDataChanged,thise;}privateOnAddToStagede{ccgame.logd"------OnAddToStage--------",this.hashCodee;}privateOnRemoveFromStagede{ccgame.logd"------OnRemoveFromStage--------",this.hashCodee;this.DestroyAllde;}privateOnDataChangedde{ccgame.logd"----------------数据发生改变了--------------"e;ifdthis.isRemoveCBOnDataChangedethis.RemoveAllCBde;}publicpartAddeddpartName:string,instance:anye:void{super.partAddeddpartName,instancee;}publicsetSkinPartdpartName:string,instance:anye:void{super.setSkinPartdpartName,instancee;ifdGameData.DevelopModeb=DevelopMode.Develop&&instance!=nulleinstance.name=partName;}privateGetKeyMapddataObj:DataBase,propName:stringe:SMapanumber,stringb{ifd!this._keyMapInfo.hasddataObjeethis._keyMapInfo.setddataObj,newSMapanumber,stringbdee;letmapInfo=this._keyMapInfo.getddataObje;ifdpropName==nullereturnmapInfo;letkeys=Utils.ArrayCopydmapInfo.keysdee;fordletkey_idofkeyse{letvalue=mapInfo.getdkey_ide;ifdvalue==propNamee{mapInfo.deletedkey_ide;dataObj.RemoveOnePropCBdpropName,key_ide;}}returnmapInfo;}publicAddPropCBddataObj:DataBase,proptName:string,func:Function,args?:anye{dataObj.AddPropCBdthis.GetKeyMapddataObj,proptNamee,proptName,func,this,argse;}publicAddPropCB_NotCallddataObj:DataBase,proptName:string,func:Function,args?:anye{dataObj.AddPropCB_NotCalldthis.GetKeyMapddataObj,proptNamee,proptName,func,this,argse;}publicRemovePropCBddataObj:DataBasee{ifddataObj==nullereturn;dataObj.RemovePropCBdthis.GetKeyMapddataObj,nullee;this.GetKeyMapddataObj,nulle.clearde;}publicRemoveAllCBde{letvalues=this._keyMapInfo.valuesde;letdataObjs=this._keyMapInfo.copykeysde;fordletdataObjofdataObjse{this.RemovePropCBddataObje;}this._keyMapInfo.clearde;}ccprotectedabstractInitDataddata:anye;protectedabstractdataChangedde;protectedabstractDestroyde;publicDestroyAlldremove:boolean=falsee{this.RemoveAllCBde;this.Destroyde;ifdremoveeRenderUtils.RemoveFromParentdthise;this.removeEventListenerdeui.PropertyEvent.PROPERTY_CHANGE,this.OnDataChanged,thise;ccthis.removeEventListenerdegret.Event.ADDED_TO_STAGE,this.OnAddToStage,thise;ccthis.removeEventListenerdegret.Event.REMOVED_FROM_STAGE,this.OnRemoveFromStage,thise;}}}﻿modulegame{exportclassBaseLoadingextendsUIComponentBase{publicloadingType:number;publicconstructordskinName:stringe{superdskinNamee;}protectedchildrenCreatedde{super.childrenCreatedde;}protectedDestroyde{}ccpublicSetPlayerInfodcount:numberecc{cc}ccpublicRefreshPlayerInfodindex:number,data:anyecc{cc}publicSetDesc1dtext:stringe{}publicSetDesc2dtext:stringe{}publicSetProgressdcurrent:number,total:number,text:string=""e{}publicSetLoadingStatedstate:number,args:anye{}publicSetVisiabledvisiable:boolean,delayTime:numbere{TweenLite.killTweensOfdthise;this.alpha=1;this.visible=visiable;this.parent.visible=visiable;}publicSetVisiableSelfdvisiable:booleane{TweenLite.killTweensOfdthise;this.alpha=1;this.visible=visiable;}publicSetArgsdargs:anye{}}}﻿modulegame{exportclassHomeLoadingextendsBaseLoading{publicroot:eui.Group;publiccancelBtn:SButton;publicpreloadLabel:eui.BitmapLabel;publicdescLabel:eui.Label;publicpercentLabel:eui.Label;publicbg:eui.Image;publicfg:eui.Image;publicblackBg:eui.Image;publicprogressBar:eui.ProgressBar;publiceffectObj:ECSC.EffectBase;publicconstructorde{superd"HomeLoadingSkin"e;this.loadingType=SceneTypeConst.Home;}protectedchildrenCreatedde{super.childrenCreatedde;this.progressBar.labelFunction=dvalue:number,maxValue:numbere=b{ccletpercent=Math.floordvaluecmaxValue*100e;ccreturn`${percent}%`return"";};ccthis.CreateEffectde;}privateDestroyEffectde{ifdthis.effectObj!=nulle{RenderUtils.DestroyEffectdSceneTypeConst.Home,this.effectObje;this.effectObj=null;}}privateCreateEffectde{this.DestroyEffectde;this.effectObj=RenderUtils.CreateEffect2dSceneTypeConst.Home,"loading_run","preload_effect_common",MathConst.IdelLabel,0.6,-1e;this.root.addChilddthis.effectObje;}publicSetProgressdcurrent:number,total:number,text:string=""e{ifd!this.isCreateOvere{this.SetCreateOverCBdde=b{this.SetProgressdcurrent,total,texte;},thise;return;}cctotal=100;cccurrent=40;ifdtotal==0etotal=100;this.progressBar.maximum=total;this.progressBar.minimum=0;this.progressBar.value=current;ccthis.effectObj.y=this.progressBar.y-68;ccthis.effectObj.x=this.progressBar.x-47+currentctotal*888;this.percentLabel.x=this.progressBar.x-47+currentctotal*1000;this.descLabel.visible=true;this.descLabel.text=text;ifdtotal==0e{this.percentLabel.text="0%";ccthis.fg.width=0;game.logdtexte;}else{varrate:number=Math.roundddcurrentctotale*100e;this.percentLabel.text=`${rate}%`;ccthis.fg.width=1228*dcurrentctotale;}}protectedDestroyde{this.DestroyEffectde;}privatedelayTimerKey:number;publicSetVisiabledvisiable:boolean,delayTime:numbere{ifdthis.delayTimerKey!=nulle{TimerMgr.GetInstancede.RemoveTimerdthis.delayTimerKeye;this.delayTimerKey=null;}ifdvisiable==truee{this.blackBg.alpha=1;TweenLite.killTweensOfdthis.blackBge;TweenLite.todthis.blackBg,1,{alpha:0}e;super.SetVisiabledvisiable,delayTimee;}else{this.delayTimerKey=TimerMgr.GetInstancede.AddTimerddelayTime,de=b{super.SetVisiabledvisiable,delayTimee;}e;}}publicSetArgsdargs:anye{ifdargs==1ecc重新加载字体文件{this.descLabel.fontFamily="main_font";letparent=this.descLabel.parent;ifdparent!=nulle{letdescLabel=this.descLabel;this.descLabel=neweui.Labelde;this.descLabel.text=egret.getTimerde.toStringde;this.descLabel.fontFamily="main_font";this.descLabel.x=descLabel.x;this.descLabel.y=descLabel.y;this.descLabel.textColor=descLabel.textColor;this.descLabel.size=descLabel.size;this.descLabel.visible=true;parent.removeChildddescLabele;parent.addChilddthis.descLabele;}}}}}﻿modulegame{exportclassLoadingManagerextendseui.UILayer{publicstaticinstance:LoadingManager;publicstaticGetInstancede:LoadingManager{ifdLoadingManager.instance==nulle{LoadingManager.instance=newLoadingManagerde;LoadingManager.instance.Initde;}returnLoadingManager.instance;}privatehomeLoadingView:BaseLoading;privatewarLoadingView:BaseLoading;privateloadingView:BaseLoading;publicconstructorde{superde;this.homeLoadingView=null;this.warLoadingView=null;this.loadingView=null;}publicInitde{cc这个一定要这么处理不然会遮挡住GameLayerManager的事件ccthis.touchEnabled=false;ccthis.touchThrough=false;ccthis.touchChildren=false;letgameLayer=GameLayerManager.gameLayerde;gameLayer.loadLayer.addChilddthise;}publicSetLoadingTypedtype:numbere{ifdtype==SceneTypeConst.Homee{ifdthis.warLoadingView!=nullethis.warLoadingView.SetVisiableSelfdfalsee;ifdthis.homeLoadingView==nulle{this.homeLoadingView=newHomeLoadingde;this.addChilddthis.homeLoadingViewe;}this.loadingView=this.homeLoadingView;}else{ifdthis.homeLoadingView!=nullethis.homeLoadingView.SetVisiableSelfdfalsee;ifdthis.warLoadingView==nulle{this.warLoadingView=newWarLoadingde;this.addChilddthis.warLoadingViewe;}this.loadingView=this.warLoadingView;}}privateCheckLoadingViewde:boolean{ifdthis.loadingView==nulle{game.errord"youmustcallSetLoadingTypebeforeShowLoading!!!!!"e;returnfalse;}returntrue;}c**加载进度条传递加载资源组名*cpublicShowLoadingddelayTime:number=0e{ccgame.logd"------ShowLoading---bbbbbbbbbbbbbbbbbbbbb"c*,newErrorde.stack*ce;ifd!this.CheckLoadingViewdeereturn;this.loadingView.SetVisiabledtrue,delayTimee;}publicHideLoadingddelayTime:number=100e{ccgame.logd"------HideLoading---bbbbbbbbbbbbbbbbbbbbb"c*,newErrorde.stack*ce;ifd!this.CheckLoadingViewdeereturn;this.loadingView.SetVisiabledfalse,delayTimee;}publicIsShowLoadingdLoadingType:numbere:boolean{returnthis.loadingView!=null&&this.loadingView.visible&&this.loadingView.loadingType==LoadingType;}publicSetLoadingProgressdcurrent:number,total:number,text:string=""e{ifd!this.CheckLoadingViewdeereturn;this.loadingView.SetProgressdcurrent,total,texte;}publicSetDesc1dtext:stringe{ifd!this.CheckLoadingViewdeereturn;this.loadingView.SetDesc1dtexte;}publicSetDesc2dtext:stringe{ifd!this.CheckLoadingViewdeereturn;this.loadingView.SetDesc2dtexte;}publicSetLoadingStatedstate:number,args:any=nulle{ifd!this.CheckLoadingViewdeereturn;this.loadingView.SetLoadingStatedstate,argse;}publicSetArgsdargs:anye{ifd!this.CheckLoadingViewdeereturn;this.loadingView.SetArgsdargse;}}}﻿c***Copyrightdce2014,Egret-Labs.org*Allrightsreserved.*Redistributionanduseinsourceandbinaryforms,withorwithout*modification,arepermittedprovidedthatthefollowingconditionsaremet:***Redistributionsofsourcecodemustretaintheabovecopyright*notice,thislistofconditionsandthefollowingdisclaimer.**Redistributionsinbinaryformmustreproducetheabovecopyright*notice,thislistofconditionsandthefollowingdisclaimerinthe*documentationandcorothermaterialsprovidedwiththedistribution.**NeitherthenameoftheEgret-Labs.orgnorthe*namesofitscontributorsmaybeusedtoendorseorpromoteproducts*derivedfromthissoftwarewithoutspecificpriorwrittenpermission.**THISSOFTWAREISPROVIDEDBYEGRET-LABS.ORGANDCONTRIBUTORS"ASIS"ANDANY*EXPRESSORIMPLIEDWARRANTIES,INCLUDING,BUTNOTLIMITEDTO,THEIMPLIED*WARRANTIESOFMERCHANTABILITYANDFITNESSFORAPARTICULARPURPOSEARE*DISCLAIMED.INNOEVENTSHALLEGRET-LABS.ORGANDCONTRIBUTORSBELIABLEFORANY*DIRECT,INDIRECT,INCIDENTAL,SPECIAL,EXEMPLARY,ORCONSEQUENTIALDAMAGES*dINCLUDING,BUTNOTLIMITEDTO,PROCUREMENTOFSUBSTITUTEGOODSORSERVICES;*LOSSOFUSE,DATA,ORPROFITS;ORBUSINESSINTERRUPTIONeHOWEVERCAUSEDAND*ONANYTHEORYOFLIABILITY,WHETHERINCONTRACT,STRICTLIABILITY,ORTORT*dINCLUDINGNEGLIGENCEOROTHERWISEeARISINGINANYWAYOUTOFTHEUSEOFTHIS*SOFTWARE,EVENIFADVISEDOFTHEPOSSIBILITYOFSUCHDAMAGE.*cclassLoadingUIextendseui.UILayer{privatepgBg:egret.Bitmap;privatepgBar:egret.Bitmap;privatetextField:egret.TextField;privatebg:egret.Bitmap;privatew:number=0;privateh:number=0;publicconstructorde{superde;ccthis.createGameScenede;}c***创建游戏场景*cprotectedcreateChildrende:void{this.w=egret.MainContext.instance.stage.stageWidth;this.h=egret.MainContext.instance.stage.stageHeight;this.bg=newegret.Bitmap;this.bg.texture=RES.getResd"PreLoadingBg_jpg"e;this.addChilddthis.bge;this.pgBg=newegret.Bitmap;this.pgBg.texture=RES.getResd"PreLoadingBarBg_png"e;this.pgBg.x=this.wc2-this.pgBg.widthc2;this.pgBg.y=this.h-this.pgBg.height-50;this.addChilddthis.pgBge;this.pgBar=newegret.Bitmap;this.pgBar.texture=RES.getResd"PreLoadingBar_png"e;this.pgBar.x=this.wc2-this.pgBar.widthc2;this.pgBar.y=this.pgBg.y+20;this.addChilddthis.pgBare;this.textField=newegret.TextFieldde;this.textField.size=24;this.textField.textColor=0xFFFFFF;this.textField.bold=true;this.textField.stroke=1;this.textField.strokeColor=0x000000;this.addChilddthis.textFielde;this.textField.width=500;this.textField.x=this.wc2-this.textField.widthc2;this.textField.y=this.pgBg.y+20;this.textField.textAlign="center";this.textField.text="0%";this.pgBar.width=0;}c***进度条*cccpublicprogressBar:egret.gui.ProgressBar;publicsetProgressdcurrent:number,total:number,text:string=""e:void{ifdtotal==0e{this.textField.text=text;this.pgBar.width=0;game.logdtexte;}else{varrate:number=Math.roundddcurrentctotale*100e;this.textField.text=text+""+rate+"%";this.pgBar.width=641*dcurrentctotale;}}}modulegame{exportclassUILoadingextendsUIComponentBase{privatelImg:eui.Image;privatedelayTimerKey:number;publicconstructorde{superd"UILoadingSkin"e;}publicInitDatade{this.SetVisiabledtrue,500e;}publicDestroyde{this.SetVisiabledfalse,0e;}publicSetVisiabledvisiable:boolean,delayTime:numbere{TimerMgr.GetInstancede.RemoveTimerdthis.delayTimerKeye;egret.Tween.removeTweensdthis.lImge;this.visible=false;this.delayTimerKey=TimerMgr.GetInstancede.AddTimerddelayTime,de=b{this.visible=true;this.lImg.rotation=0;egret.Tween.getdthis.lImg,{loop:true}e.tod{rotation:360},500e;}e;}}}modulegame{exportclassUILoadingCextendsUICtrlBase{publicconstructorde{superde;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.maskLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnUILoading;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this.ShowUIdfalse,0,0,0,false,false,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld4e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}protectedDestroyde{}}}﻿c****cmodulegame{exportclassWarLoadingextendsBaseLoading{publicroot:eui.Group;publiccancelBtn:SGroup;publicleftGroup:eui.Group;publicrightGroup:eui.Group;publictargetKingIcon:eui.Image;publicmyKingIcon:eui.Image;publicdescGroup:eui.Group;publicdescLabel:eui.Label;publiccancelLabel:eui.Label;publictimeLabel:eui.BitmapLabel;publicsucessImg:eui.Image;publictopGroup:eui.Group;publicbg:eui.Image;publicmyKingShadow:eui.Image;publictargetKingShadow:eui.Image;publicdescBg:eui.Image;publiceffectObj:ECSC.EffectBase;publicplayerArray:CommonPlayerInfo[];privatestate:number;privatetimerKey:number;privatecountDownTimerKey:number;privateready1:boolean;privateready2:boolean;privateready3:boolean;publicconstructorde{superd"WarLoadingSkin"e;this.playerArray=[];this.state=0;this.loadingType=SceneTypeConst.War;this.ready1=false;this.ready2=false;this.ready3=false;}protectedchildrenCreatedde{super.childrenCreatedde;this.cancelBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCancel,thise;this.cancelLabel.textFlow=newArrayaegret.ITextElementbd{text:LanUtil.GetTextd"取消匹配"e,style:{underline:true}cctext:"取消匹配",style:{line-through:true}}e;this.topGroup.touchEnabled=false;this.topGroup.touchChildren=true;this.topGroup.touchThrough=true;this.rightGroup.sortableChildren=true;this.SetDesc1dLanUtil.GetTextd"有效利用法力是制胜关键"ee;this.descGroup.visible=false;}privateDestroyEffectde{ifdthis.effectObj!=nulle{RenderUtils.DestroyEffectdSceneTypeConst.Home,this.effectObje;this.effectObj=null;}}privateCreateEffectdeffectID:numbere{this.DestroyEffectde;this.effectObj=RenderUtils.CreateEffectdSceneTypeConst.Home,effectID,1.2,-1e;this.effectObj.x=840;this.effectObj.y=280;this.topGroup.addChilddthis.effectObje;}privateOnCanceldevent:egret.TouchEvente:void{ccthis.ShowRotateAnid-15,-45e;ClientNet.NetMatch.C2SCancelMatchde;ccgame.LoadingManager.GetInstancede.HideLoadingd500e;}privateDestroyAllPlayerde{fordletplayerObjofthis.playerArraye{RenderUtils.RemoveFromParentdplayerObje;playerObj.DestroyAllde;}this.playerArray=[];}privateDestroyTimerKeyde{ifdthis.timerKey!=nulle{TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=null;}}privateDestroyCountDownTimerKeyde{ifdthis.countDownTimerKey!=nulle{TimerMgr.GetInstancede.RemoveTimerdthis.countDownTimerKeye;this.countDownTimerKey=null;}}privatecountDownTime:number=0;privateCheckCountDowndtotalTime:numbere{this.DestroyCountDownTimerKeyde;this.countDownTime=totalTime;this.countDownTimerKey=TimerMgr.GetInstancede.AddTimerd900,de=b{this.countDownTime-=1;ifdthis.countDownTimea0ethis.countDownTime=0;this.SetLeftTimedthis.countDownTimee;returnthis.countDownTimeb0;},thise;}privateCheckPlayerReadyde{this.DestroyTimerKeyde;this.timerKey=TimerMgr.GetInstancede.AddTimerd500,de=b{letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdwarComp==nullereturnfalse;letisAllready:boolean=true;;letallPlayerDataDict=warComp.GetAllPlayerDatade;letkeys=allPlayerDataDict.keysde;fordletpidofkeyse{ifd!warComp.IsPlayerReadydpidee{isAllready=false;continue;}letplayerData=allPlayerDataDict.getdpide;fordletplayerObjofthis.playerArraye{ifdplayerObj.fightRoleId!=pidecontinue;letatkType=Math.floordplayerData.posTypec10e;letcamp=atkType==warComp.myAtkType?0:1;playerObj.SetDatad[camp,4,playerData.name,playerData.familyName,100,playerData.iconName,playerData.edgeId]e;}}this.ready2=isAllready;this.CheckIsReadyde;returntrue;}e;}publicShowScaleAnide{this.sucessImg.alpha=0;this.descGroup.alpha=1;this.cancelBtn.alpha=1;this.cancelBtn.touchEnabled=false;TweenInfo.Createde.DoTweend0,this.descGroup,0.3,{alpha:0.3}ecc取消匹配逐渐半透明化.DoTweend0,this.cancelBtn,0.3,{alpha:0.3}ecc剩余时间逐渐半透明化.Adddthis.sucessImg,0.01,{scaleX:1.5,scaleY:1.5,alpha:0.5}ecc匹配成功出现动画.Adddthis.sucessImg,0.1,{scaleX:1,scaleY:1,alpha:1}e.Adddthis.sucessImg,0.2,{scaleX:2,scaleY:2,alpha:0.1}e.Adddthis.sucessImg,0.05,{scaleX:1,scaleY:1,alpha:0}e.Execde;}privateSetProgressBarShowdshow:booleane{fordletplayerObjofthis.playerArraye{playerObj.SetProgressBarShowdshowe;}}privateCheckIsReadyde{ifdthis.ready1&&this.ready2&&this.ready3e{this.topGroup.visible=false;lettweenObj=TweenInfo.Createde;tweenObj.DoTweend0,this.bg,1,{alpha:0}e;cc全部加载完毕后背景逐渐透明tweenObj.DoTweend0,this.leftGroup,0.5,{x:30,alpha:1,ease:Power1.easeIn}e;cc我方领主向右移动tweenObj.DoTweend0,this.rightGroup,0.5,{x:610,alpha:1,ease:Power1.easeIn}e;cc敌方领主向左移动tweenObj.DoTweend1,this.leftGroup,0.5,{x:30-236,alpha:0,ease:Power1.easeOut}e;cc我方领主向左移动同时半透明化tweenObj.DoTweend1,this.rightGroup,0.5,{x:610+236,alpha:0,ease:Power1.easeOut}e;cc敌方领主向右移动同时半透明化fordleti=0;iathis.playerArray.length;i++e{letobj=this.playerArray[i];letoffsetX=obj.enemyType==0?236:-236;tweenObj.DoTweend0,obj,0.5,{x:obj.originX+offsetX,alpha:1,ease:Power1.easeIn}e;tweenObj.DoTweend1,obj,0.5,{x:obj.originX,alpha:0,ease:Power1.easeOut}e;}tweenObj.Execde;this.ready1=false;this.ready2=false;this.ready3=false;}}publicShowSuccessAnide{lettweenObj=TweenInfo.Createde;tweenObj.DoActiond0,de=b{this.ShowScaleAnide;cc匹配成功四个字缩放动画this.rightGroup.alpha=0.5;this.SetProgressBarShowdfalsee;},thise;tweenObj.DoActiond0.5,de=b{this.descGroup.alpha=0;this.cancelBtn.alpha=0;this.sucessImg.alpha=0;this.SetProgressBarShowdtruee;this.ready1=true;this.CheckIsReadyde;},thise;tweenObj.DoTweend0.3,this.rightGroup,0.2,{x:640,alpha:1}e;cc领主图标从由往左移动tweenObj.Execde;}publicSetPlayerInfodcount:numbere{ifd!this.isCreateOvere{this.SetCreateOverCBdde=b{this.SetPlayerInfodcounte;},thise;return;}letpos1v1Info=[[-6,335],[841,335]];letpos2v2Info=[[-6,295],[-6,425],[841,295],[841,425]];this.DestroyAllPlayerde;fordleti=0;iacount;i++e{letplayerObj:CommonPlayerInfo;letenemyType:number;ifdcount==2e{enemyType=i;playerObj=newCommonPlayerInfodenemyTypee;letpos=pos1v1Info[i];playerObj.x=pos[0];playerObj.y=pos[1];}else{enemyType=Math.floordic2e;playerObj=newCommonPlayerInfodenemyTypee;letpos=pos2v2Info[i];playerObj.x=pos[0];playerObj.y=pos[1];}playerObj.originX=playerObj.x;playerObj.originY=playerObj.y;playerObj.alpha=1;playerObj.SetProgressBarShowdfalsee;ifdenemyType==0ethis.root.addChilddplayerObje;elsethis.root.addChilddplayerObje;this.playerArray.pushdplayerObje;}}publicRefreshPlayerInfodindex:number,fightRoleId:number,data:anye{ifd!this.isCreateOvere{this.SetCreateOverCBdde=b{this.RefreshPlayerInfodindex,fightRoleId,datae;},thise;return;}letplayerObj:CommonPlayerInfo=this.playerArray[index];ifdplayerObj!=nulle{playerObj.fightRoleId=fightRoleId;playerObj.SetDataddatae;}}privateSetLeftTimedtime:numbere{this.timeLabel.text=LanUtil.GetFormatd`预计{0}秒`,timee;}publicSetDesc1dtext:stringe{ifd!this.isCreateOvere{this.SetCreateOverCBdde=b{this.SetDesc1dtexte;},thise;return;}this.descLabel.text=text;}publicSetDesc2dtext:stringe{this.SetDesc1dtexte;}privateCheckPlayerInfodpvpType:numbere{letlastState=this.state;ifdpvpType==PVPType.VS_1_1e{ifdthis.playerArray.length!=2ethis.SetLoadingStated0,pvpTypee;}ifdpvpType==PVPType.VS_2_2e{ifdthis.playerArray.length!=4ethis.SetLoadingStated0,pvpTypee;}this.state=lastState;}publicInitMyKingIconde{letteamInfo=MainDataMgr.GetInstancede.teamDataMgr.GetCurrTeamInfode;ifdteamInfo!=nullethis.myKingIcon.source=RES.getResd`kingtower_${teamInfo.leader}_png`e;}publicInitTargetKingIconde{letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;letplayerDataArray=warComp.GetAllPlayerDatade.valuesde;fordletplayerDataofplayerDataArraye{ifdECSC.RenderWarUtil.IsLeaderdplayerData.posTypee&&playerData.fightRoleId!=warComp.myFightRoleIde{this.targetKingIcon.source=RES.getResd`kingtower_${playerData.kingTowerID}_png`e;break;}}}publicSetLoadingStatedstate:number,args:anye{ifd!this.isCreateOvere{this.SetCreateOverCBdde=b{this.SetLoadingStatedstate,argse;},thise;return;}this.state=state;ifdstate==0ecc开始{this.InitMyKingIconde;ifdargs==PVPType.VS_1_1e{this.SetPlayerInfod2e;}else{this.SetPlayerInfod4e;}this.leftGroup.x=0;this.leftGroup.alpha=1;this.rightGroup.x=800;this.rightGroup.alpha=0;this.topGroup.visible=true;this.sucessImg.alpha=0;this.cancelBtn.alpha=1;this.descGroup.alpha=1;this.cancelBtn.touchEnabled=true;this.bg.alpha=1;this.CheckCountDownd15e;}ifdstate==1ecc等待朋友加入{}elseifdstate==2ecc匹配中{this.CheckPlayerInfodargse;letmainData=game.MainDataMgr.GetInstancede;letselfData=[0,4,mainData.userName,mainData.familyName,0,mainData.iconName,mainData.edgeId];ifdargs==PVPType.VS_1_1e{this.RefreshPlayerInfod0,0,selfDatae;this.RefreshPlayerInfod1,0,[1,1,"","",0,"",1003]e;}else{this.RefreshPlayerInfod0,0,selfDatae;this.RefreshPlayerInfod1,0,[0,1,"","",0,"",1003]e;this.RefreshPlayerInfod2,0,[1,1,"","",0,"",1003]e;this.RefreshPlayerInfod3,0,[1,1,"","",0,"",1003]e;}this.CheckCountDownd15e;}elseifdstate==3ecc加载中{this.InitTargetKingIconde;this.CheckPlayerInfodargse;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;letplayerDataArray=warComp.GetAllPlayerDatade.valuesde;playerDataArray.sortdda,be=b{ifda.posTypebb.posTypeereturn1;elsereturn-1;}ecc先处理'我'的的数据letmainData=game.MainDataMgr.GetInstancede;this.RefreshPlayerInfod0,warComp.myFightRoleId,[0,4,mainData.userName,mainData.familyName,1,mainData.iconName,mainData.edgeId]e;letenemyIndex=args==PVPType.VS_1_1?0:1;fordletplayerDataofplayerDataArraye{ifdplayerData.fightRoleId!=warComp.myFightRoleIde{letatkType=Math.floordplayerData.posTypec10e;letindex,camp;ifdatkType==warComp.myAtkTypee{index=1;camp=0;}else{enemyIndex++;index=enemyIndex;camp=1;}this.RefreshPlayerInfodindex,playerData.fightRoleId,[camp,4,playerData.name,playerData.familyName,1,playerData.iconName,playerData.edgeId]e;}}this.CheckCountDownd15e;this.CheckPlayerReadyde;this.ShowSuccessAnide;}elseifdstate==10ecc加载完成{this.ready3=true;this.CheckIsReadyde;}}publicSetProgressdcurrent:number,total:number,text:string=""e{ifd!this.isCreateOvere{this.SetCreateOverCBdde=b{this.SetProgressdcurrent,total,texte;},thise;return;}ifdtotal==0e{game.logdtexte;}}privateReloadHomeResde{ccgame.logd"this.targetKingShadow:",this.targetKingShadowe;ccgame.logd"this.myKingShadow:",this.myKingShadowe;ccgame.logd"this.descBg:",this.descBg.sourcee;RenderUtils.ReloadImagedthis.targetKingIcone;RenderUtils.ReloadImagedthis.myKingShadowe;RenderUtils.ReloadImagedthis.descBge;}privatedelayTimerKey:number;publicSetVisiabledvisiable:boolean,delayTime:numbere{ifdvisiableethis.ReloadHomeResde;ccgame.logd"------SetVisiable---bbbbbbbbbbbbbbbbbbbbb",visiable,delayTime,newErrorde.stacke;ccTweenLite.killTweensOfdthise;ccifd!visiableecc{ccTweenLite.todthis,delayTimec1000,{ccalpha:0cc}e;cc}ifdthis.delayTimerKey!=nulle{TimerMgr.GetInstancede.RemoveTimerdthis.delayTimerKeye;this.delayTimerKey=null;}ccgame.logd"____Warloading.SetVisiable11111:",visiable,delayTime,"time:",egret.getTimerdee;this.delayTimerKey=TimerMgr.GetInstancede.AddTimerddelayTime,de=b{ccgame.logd"____Warloading.SetVisiable222222:",visiable,delayTime,"time:",egret.getTimerdee;ifd!visiablee{this.DestroyTimerKeyde;this.DestroyAllPlayerde;}super.SetVisiabledvisiable,delayTimee;}e;}protectedDestroyde{this.cancelBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCancel,thise;this.DestroyEffectde;this.DestroyTimerKeyde;this.DestroyCountDownTimerKeyde;this.DestroyAllPlayerde;}}}﻿c***面板弹出管理类*bydily*dcecopyright2014-2035*AllRightsReserved.*面板弹出的管理类*cmodulegame{exportclassPopUpManager{publicstaticdarkSprite:egret.Sprite;c***添加面板方法*panel面板*dark背景是否变黑*popUpWidth指定弹窗宽度，定位使用*popUpHeight指定弹窗高度，定位使用*effectType0：没有动画1:从中间轻微弹出2：从中间猛烈弹出3：从左向右4：从右向左5、从上到下6、从下到上*cpublicstaticaddPopUpdparent:any,panel:game.UIComponentBase,dark:boolean=false,popUpWidth:number=0,popUpHeight:number=0,effectType:number=0,isAlert:boolean=falsee:void{ifdparent.containsdpanelee{cc判断是否包含panelreturn;}panel.scaleX=panel.initScale;panel.scaleY=panel.initScale;panel.x=panel.initPosX;panel.y=panel.initPosY;panel.alpha=1;letthisObj=PopUpManager;ifddarke{thisObj.darkSprite=newegret.Spritede;thisObj.darkSprite.graphics.clearde;thisObj.darkSprite.graphics.beginFilld0x000000,0.3e;thisObj.darkSprite.graphics.drawRectd0,0,GameConfig.curWidthde,GameConfig.curHeightdee;thisObj.darkSprite.graphics.endFillde;thisObj.darkSprite.width=GameConfig.curWidthde;thisObj.darkSprite.height=GameConfig.curHeightde;ifd!parent.containsdthisObj.darkSpriteee{parent.addChilddthisObj.darkSpritee;}thisObj.darkSprite.touchEnabled=true;egret.Tween.getdthisObj.darkSpritee.tod{alpha:1},150e;thisObj.darkSprite.visible=true;}parent.addChilddpanele;GameConfig.curPanel=panel;ifdpopUpWidth!=0e{panel.x=GameConfig.curWidthdec2-popUpWidthc2;panel.y=GameConfig.curHeightdec2-popUpHeightc2;}else{popUpWidth=panel.width;popUpHeight=panel.height;}cc以下是弹窗动画varleftX:number=GameConfig.curWidthdec2-popUpWidthc2;varupY:number=GameConfig.curHeightdec2-popUpHeightc2;switchdeffectTypee{case0:break;case1:panel.alpha=0;panel.scaleX=0.5;panel.scaleY=0.5;panel.x=panel.initPosX+popUpWidthc4;panel.y=panel.initPosY+popUpHeightc4;egret.Tween.getdpanele.tod{alpha:1,scaleX:panel.initScale,scaleY:panel.initScale,x:panel.initPosX,y:panel.initPosY},300,egret.Ease.backOute;break;case2:panel.alpha=0;panel.scaleX=0.5;panel.scaleY=0.5;panel.x=panel.initPosX+popUpWidthc4;panel.y=panel.initPosY+popUpHeightc4;egret.Tween.getdpanele.tod{alpha:1,scaleX:panel.initScale,scaleY:panel.initScale,x:panel.initPosX,y:panel.initPosY},600,egret.Ease.elasticOute;break;case3:ifdisAlerte{panel.x=-popUpWidth;egret.Tween.getdpanele.tod{x:leftX},500,egret.Ease.cubicOute;}else{panel.x=-popUpWidth;egret.Tween.getdpanele.tod{x:panel.initPosX},500,egret.Ease.cubicOute;}break;case4:ifdisAlerte{panel.x=popUpWidth;egret.Tween.getdpanele.tod{x:leftX},500,egret.Ease.cubicOute;}else{panel.x=popUpWidth;egret.Tween.getdpanele.tod{x:panel.initPosX},500,egret.Ease.cubicOute;}break;case5:ifdisAlerte{panel.y=-popUpHeight;egret.Tween.getdpanele.tod{y:upY},500,egret.Ease.cubicOute;}else{panel.y=-popUpHeight;egret.Tween.getdpanele.tod{y:panel.initPosY},500,egret.Ease.cubicOute;}break;case6:ifdisAlerte{panel.y=GameConfig.curHeightde;egret.Tween.getdpanele.tod{y:upY},500,egret.Ease.cubicOute;}else{panel.y=popUpHeight;egret.Tween.getdpanele.tod{y:panel.initPosY},500,egret.Ease.cubicOute;}break;default:break;}}c***移除面板方法*panel面板*effectType0：没有动画1:从中间缩小消失2：3：从左向右4：从右向左5、从上到下6、从下到上*cpublicstaticremovePopUpdparent:any,panel:game.UIComponentBase,effectType:number=0e:void{letthisObj=PopUpManager;varonComplete:Function=functionde{RenderUtils.RemoveFromParentdthisObj.darkSpritee;};ifdthisObj.darkSpritee{egret.Tween.getdthisObj.darkSpritee.tod{alpha:0},100e.calldonComplete,thisObje;}cc以下是弹窗动画switchdeffectTypee{case0:break;case1:egret.Tween.getdpanele.tod{alpha:0,scaleX:0,scaleY:0,x:panel.x+panel.widthc2,y:panel.y+panel.heightc2},300e.call;break;case2:break;case3:egret.Tween.getdpanele.tod{x:panel.width},500,egret.Ease.cubicOute;break;case4:egret.Tween.getdpanele.tod{x:-panel.width},500,egret.Ease.cubicOute;break;case5:egret.Tween.getdpanele.tod{y:panel.height},500,egret.Ease.cubicOute;break;case6:egret.Tween.getdpanele.tod{y:-panel.height},500,egret.Ease.cubicOute;break;default:break;}varwaitTime=500;ifdeffectType==0e{waitTime=0;RenderUtils.RemoveFromParentdpanele;}else{TimerMgr.GetInstancede.AddTimerdwaitTime,de=b{RenderUtils.RemoveFromParentdpanele;},thisObje;}}}}﻿c***战场*cmodulegame{exportclassTopMaskPanelextendseui.Component{privatestatics_Instance:TopMaskPanel;publicstaticGetInstancede:TopMaskPanel{ifdTopMaskPanel.s_Instance==nulleTopMaskPanel.s_Instance=newTopMaskPanelde;returnTopMaskPanel.s_Instance;}publicmap_bg:eui.Image;publicconstructorde{superde;this.skinName="TopMaskSkin";}protectedchildrenCreatedde:void{super.childrenCreatedde;this.touchEnabled=false;this.touchChildren=false;ccMain.instance.addChilddthise;}}}﻿modulegame{exportabstractclassUIComponentBaseextendseui.Component{publicpanelType:number;publicinitPosX:number=0;publicinitPosY:number=0;publicinitScale:number=1;publicisChildUI:boolean=false;protectedisCreateOver:boolean=false;privateoverFunc:Function;privateoverTarget:any;privateisShowCloseBg:boolean;privatecloseBg:CloseBg;private_keyMapInfo:SMapaDataBase,SMapanumber,stringbb;publicconstructordskinName:string,showCloseBg:boolean=falsee{superde;cc以下两种情况都可以ccthis.skinName="HomeMapSkin";ccthis.skinName="resourcecuicscenecHomeCitySkin.exml";this.isCreateOver=false;ifdskinName!=""&&skinName!=nulle{this.skinName=skinName;this.isChildUI=false;ccthis.addEventListenerdeui.UIEvent.COMPLETE,this.createCompleteEvent,thise;}else{this.isChildUI=true;}this.isShowCloseBg=showCloseBg;this._keyMapInfo=newSMapaDataBase,SMapanumber,stringbbde;}ccpubliccreateCompleteEventdevent:eui.UIEvente:voidcc{ccthis.removeEventListenerdeui.UIEvent.COMPLETE,this.createCompleteEvent,thise;ccthis.initFixedSizede;ccthis.autoFixedSizede;cc}publicSetCreateOverCBdfunc:Function,thisObj:anye{ccgame.logdthis.hashCode,"----------创建-----------"e;ifdthis.isCreateOvere{func.calldthisObje;}else{this.overFunc=func;this.overTarget=thisObj;}}publicInitDataddata:anye{}cc用于二级界面publicShowddata?:anye{}publicHideddata?:anye{}publicsetSkinPartdpartName:string,instance:anye:void{super.setSkinPartdpartName,instancee;ifdGameData.DevelopModeb=DevelopMode.Develop&&instance!=nulleinstance.name=partName;}protectedchildrenCreatedde:void{super.childrenCreatedde;ccthis.initFixedSizede;ccifd!this.isChildUIeccthis.autoFixedSizede;this.isCreateOver=true;TimerMgr.GetInstancede.AddTimerd1,de=b{cc下一帧执行ifdthis.overFunc!=nulle{this.overFunc.calldthis.overTargete;this.overFunc=null;this.overTarget=null;}},thise;ifdthis.isShowCloseBg&&this["root"]!=nulle{game.logd"____________showcloseDlg_____________"e;this.closeBg=RenderUtils.CreateCloseBgdthis["root"],0,"bg_black"e;this.closeBg.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseDlg,thise;}}protectedOnCloseDlgde{game.logd"____________CloseDlg_____________"e;UIManager.HidePaneldthis.panelTypee;}protectedabstractDestroyde;privateBaseDestroyde{ifdthis.closeBg!=nulle{this.closeBg.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseDlg,thise;RenderUtils.DestroyCloseBgdthis.closeBge;this.closeBg=null;}this.overFunc=null;this.overTarget=null;this.RemoveAllCBde;}publicDestroyAlldremove:boolean=truee{this.Destroyde;this.BaseDestroyde;this.RemoveAllTouchEventde;ccgame.logdthis.hashCode,"----------销毁-----------"e;ifdremove==trueeRenderUtils.RemoveFromParentdthise;}publicRemoveFromParentde{ifdthis.parent!=nulle{this.parent.removeChilddthise;}}privateGetKeyMapddataObj:DataBase,propName:stringe:SMapanumber,stringb{ifd!this._keyMapInfo.hasddataObjeethis._keyMapInfo.setddataObj,newSMapanumber,stringbdee;letmapInfo=this._keyMapInfo.getddataObje;ifdpropName==nullereturnmapInfo;letkeys=Utils.ArrayCopydmapInfo.keysdee;fordletkey_idofkeyse{letvalue=mapInfo.getdkey_ide;ifdvalue==propNamee{mapInfo.deletedkey_ide;dataObj.RemoveOnePropCBdpropName,key_ide;}}returnmapInfo;}publicAddPropCBddataObj:DataBase,proptName:string,func:Function,args?:anye{dataObj.AddPropCBdthis.GetKeyMapddataObj,proptNamee,proptName,func,this,argse;}publicAddPropCB_NotCallddataObj:DataBase,proptName:string,func:Function,args?:anye{dataObj.AddPropCB_NotCalldthis.GetKeyMapddataObj,proptNamee,proptName,func,this,argse;}publicRemovePropCBddataObj:DataBasee{dataObj.RemovePropCBdthis.GetKeyMapddataObj,nullee;this.GetKeyMapddataObj,nulle.clearde;}publicRemoveAllCBde{letvalues=this._keyMapInfo.valuesde;letdataObjs=this._keyMapInfo.keysde;fordletdataObjofdataObjse{this.RemovePropCBddataObje;}this._keyMapInfo.clearde;}publicinitFixedSizede{letsizeInfo:[number,number,number]=GameConfig.getScaledSizedthise;this.initPosX=sizeInfo[0];this.initPosY=sizeInfo[1];this.initScale=sizeInfo[2];}publicautoFixedSizede{this.scaleX=this.initScale;this.scaleY=this.initScale;this.x=this.initPosX;this.y=this.initPosY;}publicautoTestde{ccgame.logd"_______autoTestaaaaaaa__________DDDDDDDDDDDDDDDDDDDDDDDDD____",this.x,this.y,this.scaleX,this.scaleYe;ccgame.logd"_______autoTestbbbbbbb__________DDDDDDDDDDDDDDDDDDDDDDDDD____",this.initPosX,this.initPosY,this.initScale,this.initScalee;ccthis.scaleX=this.initScale;ccthis.scaleY=this.initScale;ccthis.x=this.initPosX;ccthis.y=this.initPosY;}cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccprivatetouchList:TouchDataItem[];privatecurrTouchObj:egret.DisplayObjectContainer;cc只需要负责注册，当界面关闭时会自行销毁cc处理简单点击事件publicAddTouchEventdtarget:egret.DisplayObjectContainer,callback:Function,thisObj:any,param?:anye:boolean{cc数据有效性检测ifdtarget==null||callback==null||thisObj==nullereturnfalse;ifdthis.touchList==nullethis.touchList=[];lettouchList=this.touchList;fordleti=0,len=touchList.length;ialen;i++e{letitem=touchList[i];ifditem.target==target&&item.callback==callback&&item.thisObj==thisObje{returnfalse;}}cc初始化点击事件ifdthis.hasEventListenerdegret.TouchEvent.TOUCH_BEGINe==falseethis.addEventListenerdegret.TouchEvent.TOUCH_BEGIN,this.__OnTouchBegin,thise;ifdthis.hasEventListenerdegret.TouchEvent.TOUCH_ENDe==falseethis.addEventListenerdegret.TouchEvent.TOUCH_END,this.__OnTouchEnd,thise;letnewDataItem=newTouchDataItem;newDataItem.target=target;newDataItem.callback=callback;newDataItem.thisObj=thisObj;newDataItem.param=param;this.touchList.pushdnewDataIteme;returntrue;}publicRemoveAllTouchEventde{ifdthis.touchList!=null&&this.touchList.lengthb0e{lettouchList=this.touchList;whiledtouchList.lengthb0e{letitem=touchList.popde;item.Destroyde;item=null;}this.touchList=null;}ifdthis.hasEventListenerdegret.TouchEvent.TOUCH_BEGINe==trueethis.removeEventListenerdegret.TouchEvent.TOUCH_BEGIN,this.__OnTouchBegin,thise;ifdthis.hasEventListenerdegret.TouchEvent.TOUCH_ENDe==trueethis.removeEventListenerdegret.TouchEvent.TOUCH_END,this.__OnTouchEnd,thise;}private__OnTouchBeginde:egret.TouchEvente{this.currTouchObj=e.target;}private__OnTouchEndde:egret.TouchEvente{ifde.target==this.currTouchObje{lettouchList=this.touchList;fordleti=0,len=touchList.length;ialen;i++e{letitem=touchList[i];ifditem!=null&&item.target==e.targete{item.callback.callditem.thisObj,e,item.parame;}}this.currTouchObj=null;}}}classTouchDataItem{target:egret.DisplayObjectContainer;callback:Function;thisObj:any;param:any;publicconstructorde{}publicDestroyde{this.target=null;this.callback=null;this.thisObj=null;this.param=null;}}}﻿c***面板UI基类*bydily*dcecopyright2014-2035*AllRightsReserved.*todo:面板特效，全屏+非全屏蒙层*cmodulegame{exportabstractclassUICtrlBase{publicpanelType:number;privateisInitialized:Boolean=false;cc是否初始化privateisPopUp:Boolean=false;cc是否已经显示private_panel:UIComponentBase=null;ccUI容器publicw:number=0;publich:number=0;privateresKeyID:number=0;privateloadGroupKeyID:number=0;ccprivate_keylistInfo:SMapaDataBase,Arraya[string,number]bb=newSMapaDataBase,Arraya[string,number]bbde;publicconstructorde{this.w=GameConfig.curWidthde;this.h=GameConfig.curHeightde;this._panel=null;}protectedgetpanelde{ifdthis._panel==nulle{letpanelClass=this.GetPanelClassde;this._panel=newpanelClassde;}returnthis._panel;}protectedabstractGetResGroupde:string[];protectedabstractGetParentde:any;protectedabstractGetPanelClassde:any;publicRecordGroupsde{cc记录该界面所需要的资源组ResUtils.GetInstancede.RecordGroupsdthis.panelType,this.GetResGroupdee;}publicOnMessageditype:number,data:anye:void{}ccprivateGetKeyListddataObj:DataBasee:Arraya[string,number]bcc{ccifd!this._keylistInfo.hasddataObjeeccthis._keylistInfo.setddataObj,newArraya[string,number]bdee;ccreturnthis._keylistInfo.getddataObje;cc}ccpublicAddPropCBddataObj:DataBase,proptName:string,func:Function,args?:anyecc{ccdataObj.AddPropCBdthis.GetKeyListddataObje,proptName,func,this,argse;cc}ccpublicAddPropCB_NotCallddataObj:DataBase,proptName:string,func:Function,args?:anyecc{ccdataObj.AddPropCB_NotCalldthis.GetKeyListddataObje,proptName,func,this,argse;cc}ccpublicRemovePropCBddataObj:DataBaseecc{ccdataObj.RemovePropCBdthis.GetKeyListddataObjee;ccthis.GetKeyListddataObje.length=0;cc}ccpublicRemoveAllCBdecc{ccletvalues=this._keylistInfo.valuesde;ccletdataObjs=this._keylistInfo.keysde;ccfordletdataObjofdataObjsecc{ccthis.RemovePropCBddataObje;cc}ccthis._keylistInfo.clearde;cc}c***添加面板方法*panel面板*dark背景是否变黑*popUpWidth指定弹窗宽度，定位使用*popUpHeight指定弹窗高度，定位使用*effectType0：没有动画1:从中间轻微弹出2：从中间猛烈弹出3：从左向右4：从右向左5、从上到下6、从下到上*cpublicShowUIddark:boolean=false,popUpWidth:number=0,popUpHeight:number=0,effectType:number=0,isAlert:boolean=false,showWaitPanel:boolean=true,data:any=nulle:void{letpanel=this.panel;panel.panelType=this.panelType;ifdshowWaitPanele{UIManager.ShowPaneldPanelTypeConst.UILoadinge;}ccifdshowWaitPaneleccGlobal.ShowWaitPaneld500e;cc记录引用this.resKeyID=ResManager.GetInstancede.AddGroupRefdthis.GetResGroupdee;ResUtils.GetInstancede.RemoveGroupLoaddthis.loadGroupKeyIDe;this.loadGroupKeyID=ResUtils.GetInstancede.LoadGroupByKeydthis.panelType,de=b{ifdthis.panel==nullereturn;cc界面完全加载完之后才能初始化数据panel.SetCreateOverCBdde=b{ifdshowWaitPaneleUIManager.HidePaneldPanelTypeConst.UILoadinge;this.InitUIde;this.InitDatade;panel.InitDataddatae;},thise;cc显示界面this.BeforShowde;PopUpManager.addPopUpdthis.GetParentde,panel,dark,popUpWidth,popUpHeight,effectType,isAlerte;},null,thise;}c***面板弹出之前处理*cpublicBeforShowde:void{}c***初始化面板ui*cpublicInitUIde:void{}c***初始化面板数据*cpublicInitDatade:void{}c***移除面板方法*panel面板*effectType0：没有动画1:从中间缩小消失2：3：从左向右4：从右向左5、从上到下6、从下到上*cpublicClosePaneldeffectType:number=0e:void{ifdthis._panel==nullereturn;this.Destroyde;this.BaseDestroyde;ifdthis._panel!=nulle{PopUpManager.removePopUpdthis.GetParentde,this._panel,effectTypee;this._panel=null;}}cc彻底删除面板方法publicDestroyPanelde{this.Destroyde;this.BaseDestroyde;ifdthis._panel!=nulle{PopUpManager.removePopUpdthis.GetParentde,this._panel,0e;this._panel=null;}}c***面板关闭后需要销毁的对象*cprotectedabstractDestroyde:void;privateBaseDestroyde{ifdthis._panel!=nulle{this._panel.DestroyAllde;}cc删除资源引用ifdthis.resKeyID!=0e{ResManager.GetInstancede.RemoveGroupRefdthis.GetResGroupde,this.resKeyIDe;this.resKeyID=0;}ifdthis.loadGroupKeyID!=0e{ResUtils.GetInstancede.RemoveGroupLoaddthis.loadGroupKeyIDe;this.loadGroupKeyID=0;}ccthis.RemoveAllCBde;}c***面板是否弹出状态*cpublicGetIsPopUpde:Boolean{returnthis.isPopUp;}c***面板是否初始化完毕*cpublicGetIsInitde:Boolean{returnthis.isInitialized;}cc获取面板宽度publicGetWidthde:number{returnthis._panel.width;}cc获取面板高度publicGetHeightde:number{returnthis._panel.height;}}}﻿c***界面管理类*cmodulegame{exportclassUIManager{publicconstructorde{}publicstaticExistCtrls:SMapanumber,UICtrlBaseb;publicstaticOpens:Arrayanumberb;cc保存当前已经打开的panelpublicstaticInitde{UIManager.ExistCtrls=newSMapanumber,UICtrlBasebde;UIManager.Opens=[]}publicstaticgetPanelClassInsdpanelType:numbere:UICtrlBase{switchdpanelTypee{casePanelTypeConst.WarUI:returnnewgame.WarUICde;casePanelTypeConst.WarOver:returnnewgame.WarOverCde;casePanelTypeConst.Home:returnnewgame.HomeCde;casePanelTypeConst.War:returnnewgame.WarCde;casePanelTypeConst.TestWar:returnnewgame.TestWarCde;casePanelTypeConst.Login:returnnewgame.LoginCde;casePanelTypeConst.MainUINew:returnnewgame.MainUINewCde;casePanelTypeConst.RightDZ:returnnewgame.RightDZCde;casePanelTypeConst.CommonDlg:returnnewgame.CommonDlgCde;casePanelTypeConst.SelectServer:returnnewgame.SelectServerCde;casePanelTypeConst.RunScript:returnnewgame.RunScriptCde;casePanelTypeConst.RightSS:returnnewgame.RightSSCde;casePanelTypeConst.RightRW:returnnewgame.RightRWCde;casePanelTypeConst.RightTF:returnnewgame.RightTFCde;casePanelTypeConst.CMDDlg:returnnewgame.CMDDlgCde;casePanelTypeConst.Bag:returnnewgame.BagCde;casePanelTypeConst.FriendInfo:returnnewgame.FriendInfoCde;casePanelTypeConst.FriendInvited:returnnewgame.FriendInviteCde;casePanelTypeConst.PlayerInfoMainPanel:returnnewgame.PlayerInfoMainPanelCde;casePanelTypeConst.ShopInfo:returnnewgame.ShopInfoCde;casePanelTypeConst.FamilyMainPanel:returnnewgame.FamilyMainPanelCde;casePanelTypeConst.FamilyApplyPanel:returnnewgame.FamilyApplyPanelCde;casePanelTypeConst.EditorUI:returnnewgame.EditorUICde;casePanelTypeConst.FamilyChangeKaPanel:returnnewgame.FamilyChangeKaPanelCde;casePanelTypeConst.FamilyShopBuyPanel1:returnnewgame.FamilyShopBuyPanel1Cde;casePanelTypeConst.FamilyShopBuyPanel3:returnnewgame.FamilyShopBuyPanel3Cde;casePanelTypeConst.FamilyNoneMainPanel:returnnewgame.FamilyNoneMainPanelCde;casePanelTypeConst.TeamPanel:returnnewgame.TeamPanelCde;casePanelTypeConst.HeroInfoWin1:returnnewgame.HeroInfoWin1Cde;casePanelTypeConst.LeaderInfoPanel:returnnewgame.LeaderInfoPanelCde;casePanelTypeConst.HeroInfoPanel:returnnewgame.HeroInfoPanelCde;casePanelTypeConst.KakuMainPanel:returnnewgame.KakuMainPanelCde;casePanelTypeConst.RoleMainPanel:returnnewgame.RoleMainPanelCde;casePanelTypeConst.RankMainPanel:returnnewgame.RankMainPanelCde;casePanelTypeConst.ShopBuyWin:returnnewgame.ShopBuyWinCde;casePanelTypeConst.FamilyInfoPanel:returnnewgame.FamilyInfoPanelCde;casePanelTypeConst.ShopKaPaiPanel:returnnewgame.ShopKaPaiPanelCde;casePanelTypeConst.FamilySettingPanel:returnnewgame.FamilySettingPanelCde;casePanelTypeConst.ShopBuyKaPaiWin:returnnewgame.ShopBuyKaPaiWinCde;casePanelTypeConst.UILoading:returnnewgame.UILoadingCde;casePanelTypeConst.ReplayInfo:returnnewgame.ReplayInfoCde;casePanelTypeConst.SettingsInfo:returnnewgame.SettingsInfoCde;casePanelTypeConst.CommonTextInfo:returnnewgame.CommonTextInfoCde;casePanelTypeConst.SelectLan:returnnewgame.SelectLanCde;casePanelTypeConst.AchieveDescTips:returnnewgame.AchieveDescTipsCde;casePanelTypeConst.AchieveFullTips:returnnewgame.AchieveFullTipsCde;casePanelTypeConst.AchieveInfo:returnnewgame.AchieveInfoCde;casePanelTypeConst.AchieveTaskInfo:returnnewgame.AchieveTaskInfoCde;casePanelTypeConst.AchieveGradeInfo:returnnewgame.AchieveGradeInfoCde;casePanelTypeConst.MailInfo:returnnewgame.MailInfoCde;casePanelTypeConst.MailDetailInfo:returnnewgame.MailDetailInfoCde;casePanelTypeConst.RoleEditNameWin:returnnewgame.RoleEditNameWinCde;casePanelTypeConst.ShopQuickBuyWin:returnnewgame.ShopQuickBuyWinCde;casePanelTypeConst.PWSInfo:returnnewgame.PWSInfoCde;casePanelTypeConst.BoxTips:returnnewgame.BoxTipsCde;cc----这一行代码不要删除--------------------default:{game.warnd"getPanelClassInstypeerrorpanelType:",panelTypee;returnnull;}}}publicstaticGetPanelCtrldpanelType:numbere:UICtrlBase{letpanel:UICtrlBase;ifd!UIManager.ExistCtrls.hasdpanelTypeee{panel=UIManager.getPanelClassInsdpanelTypee;panel.panelType=panelType;panel.RecordGroupsde;UIManager.ExistCtrls.setdpanelType,panele;}else{panel=UIManager.ExistCtrls.getdpanelTypee;}returnpanel;}publicstaticDestroyAllPanelde{letvalues=UIManager.ExistCtrls.valuesde;fordletvalueofvaluese{value.DestroyPanelde;}UIManager.Opens.length=0;}publicstaticShowPaneldpanelType:number,data?:anye:void{letpanel:UICtrlBase=UIManager.GetPanelCtrldpanelTypee;panel.OnMessagedPanelMessageType.OnShow,datae;ifdUIManager.HasOpendpanelTypee==falsee{UIManager.AddOpendpanelTypee;}}publicstaticHidePaneldpanelType:number,data?:anye:void{letpanel:UICtrlBase=UIManager.GetPanelCtrldpanelTypee;panel.OnMessagedPanelMessageType.OnHide,datae;ifdUIManager.HasOpendpanelTypee==truee{UIManager.RemoveOpendpanelTypee;}}publicstaticDestroyPaneldpanelType:number,data?:anye:void{letpanel:UICtrlBase=UIManager.GetPanelCtrldpanelTypee;panel.OnMessagedPanelMessageType.OnDestroy,datae;ifdUIManager.HasOpendpanelTypee==truee{UIManager.RemoveOpendpanelTypee;}}publicstaticUpdateDatadpanelType:number,data:anye:void{letpanel:UICtrlBase=UIManager.GetPanelCtrldpanelTypee;panel.OnMessagedPanelMessageType.OnUpdateData,datae;}privatestaticAddOpendpanelType:numbere{UIManager.Opens.pushdpanelTypee;}privatestaticRemoveOpendpanelType:numbere{letindex=UIManager.Opens.indexOfdpanelTypee;ifdindexb=0eUIManager.Opens.splicedindex,1e;}publicstaticHasOpendpanelType:numbere:boolean{returnUIManager.Opens.indexOfdpanelTypeeb=0}}}﻿c****cmodulegame{exportclassDeployPanelextendsUIComponentBase{publicconstructorde{superd"DeploySkin"e;}publiccostInfo:eui.Group;publiccostCount:eui.BitmapLabel;publicheroName:eui.Label;publicheroLv:eui.Label;publicenergyInfo:eui.Group;publicnowEnergy:eui.BitmapLabel;publicroot:eui.Group;private_data:any;publicpartAddeddpartName:string,instance:anye:void{super.partAddeddpartName,instancee;}protectedchildrenCreatedde{super.childrenCreatedde;this.anchorOffsetX=this.widthc2;this.anchorOffsetY=this.heightc2;this.InitDatade;this.costInfo.visible=false;this.energyInfo.visible=false;}protectedDestroyde{this._data=null;ifdthis.parent!=nullethis.parent.removeChilddthise;}publicSetDatadhero:any,name:string,lv:number,costCount:number,nowCount:numbere{this._data=[hero,name,lv,costCount,nowCount];this.InitDatade;}publicShowCostAnimationde{ifdthis.costInfo==nullereturn;TweenUtil.Deploy_Anim1dthis.costInfoe;}publicInitDatade{ifdthis._data==null||!this.isCreateOverereturn;this.energyInfo.visible=dthis._data[3]bthis._data[4]e;this.heroName.text=this._data[1];this.heroLv.text=this._data[2].toStringde;this.costCount.text=this._data[3].toStringde;this.nowEnergy.text=`${this._data[4]}!${this._data[3]}`;this._data=null;}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassEditorUICextendsUICtrlBase{publicconstructorde{superde;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnECSC.EditorUIPanel;}cc做一下类型转换方便调用一定要有!!!protectedgetwarUIPanelde{returnaECSC.EditorUIPanelbthis.panel;}protectedGetResGroupde:string[]{return[];}protectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0e;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}elseifditype==PanelMessageType.OnUpdateDatae{}}c***初始化面板ui*cpublicInitUIde:void{}c***初始化面板数据*cpublicInitDatade:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}}}﻿c****cmoduleECSC{exportclassEditorUIPanelextendsgame.UIComponentBase{publicstaticinstance:EditorUIPanel;publicroot:eui.Group;publiccloseBtn:SButton;publicspeedBtn:SButton;publicslowBtn:SButton;publicplayBtn:SButton;publicpauseBtn:SButton;publicmagicID:SInputLabel;publicvitType:SInputLabel;publicplayAniBtn:SButton;publicaniName:SInputLabel;publicaddAttBtn:SButton;publicaddVitBtn:SButton;publicspeedLabel:SInputLabel;publicstopFrame:SInputLabel;privateheroID=19020;privateclipName:string="hero_19020";privatefightHeroGroups:string[]=[];privatefightHeroGroupKeyID:number=0;privatefightHeroKeyID:number=0;publicconstructorde{superd"EditorUISkin"e;EditorUIPanel.instance=this;}protectedchildrenCreatedde{super.childrenCreatedde;this.speedBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.speedBtnClick,thise;this.slowBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.slowBtnClick,thise;this.playBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.playBtnClick,thise;this.pauseBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.pauseBtnClick,thise;this.addAttBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.addAttBtnClick,thise;this.addVitBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.addVitBtnClick,thise;this.playAniBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.playAniBtnClick,thise;this.closeBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.closeBtnClick,thise;this.StartWarde;this.InitHeroInfode;this.InitLinkInfode;this.addVitBtn.visible=false;this.addAttBtn.visible=false;this.playBtn.visible=false;letresDataMap=newSMapastring,IAutoGroupResDatabde;letheroIDSet=newSetanumberbde;letfileDataMap:SMapastring,numberb=newSMapastring,numberbde;letresArray:string[]=["effect_war01_png","effect_war01_json"];letheroResData:IAutoGroupResData={groupName:"effect_war01",resArray:resArray};resDataMap.setd"effect_war01",heroResDatae;game.RenderUtils.GetHeroGroupsdresDataMap,fileDataMap,heroIDSet,this.heroIDe;letresDataArray=resDataMap.valuesde;resDataMap.clearde;letrets=ResUtils.GetInstancede.LoadResArrayWithProdresDataArray,de=b{this.addVitBtn.visible=true;this.addAttBtn.visible=true;this.playBtn.visible=true;game.TipsManager.ShowTipsdLanUtil.GetTextd"资源加载完成!!!"ee;},null,thise;this.fightHeroGroups=rets[0];this.fightHeroGroupKeyID=rets[1];this.fightHeroKeyID=game.ResManager.GetInstancede.AddGroupRefdthis.fightHeroGroupse;letwarGroups=ResUtils.GetInstancede.GetGroupsdGroupResType.Ware;game.ResManager.GetInstancede.RemoveGroupRefdwarGroups,Settings.WarResKeyIDe;Settings.WarResKeyID=game.ResManager.GetInstancede.AddGroupRefdwarGroupse;ResUtils.GetInstancede.RemoveGroupLoaddSettings.LoadWarGroupKeyIDe;Settings.LoadWarGroupKeyID=ResUtils.GetInstancede.LoadGroupByKeydGroupResType.War,de=b{},null,thise;}privateInitHeroInfode{letdataProxy=JsonData.getGameDatad"herodata_json"e;letheroArrayData=dataProxy[this.heroID];ifdheroArrayData==nullereturn;cc英雄资源letclipName=heroArrayData["clipname"];this.clipName=`hero_${clipName}`;}privateGetRenderHeroManager:any;privateGetWarMap:any;privateInitLinkInfode{letthisObj=this;this.GetRenderHeroManager=ECSC.RenderWarUtil.GetRenderHeroManager;ECSC.RenderWarUtil.GetRenderHeroManager=de:ECSC.RenderHeroManager=b{returnthisObj.heroMgr;};this.GetWarMap=ECSC.RenderWarUtil.GetWarMap;ECSC.RenderWarUtil.GetWarMap=de:any=b{returnthisObj;};}privateResetLinkInfode{ECSC.RenderWarUtil.GetRenderHeroManager=this.GetRenderHeroManager;ECSC.RenderWarUtil.GetWarMap=this.GetWarMap;this.GetRenderHeroManager=null;this.GetWarMap=null;}protectedDestroyde{this.speedBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.speedBtnClick,thise;this.slowBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.slowBtnClick,thise;this.playBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.playBtnClick,thise;this.pauseBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.pauseBtnClick,thise;this.addAttBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.addAttBtnClick,thise;this.addVitBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.addVitBtnClick,thise;ifdthis.attObj!=nulle{this.attObj.Disposede;this.attObj=null;}fordletvitObjofthis.vitObjse{vitObj.Disposede;}this.vitObjs.length=0;this.StopWarde;ResUtils.GetInstancede.RemoveGroupLoaddthis.fightHeroGroupKeyIDe;game.ResManager.GetInstancede.RemoveGroupRefdthis.fightHeroGroups,this.fightHeroKeyIDe;letwarGroups=ResUtils.GetInstancede.GetGroupsdGroupResType.Ware;game.ResManager.GetInstancede.RemoveGroupRefdwarGroups,Settings.WarResKeyIDe;ResUtils.GetInstancede.RemoveGroupLoaddSettings.LoadWarGroupKeyIDe;this.ResetLinkInfode;}privatelastTime:number=0;privateattObj:HeroBase;privatevitObjs:HeroBase[]=[];privateheroMgr:ECSC.RenderHeroManager;privateisPause:boolean=false;privateactId:number=0;privateUpdatedtotalTime:numbere:boolean{letdt=totalTime-this.lastTime;ifdthis.lastTime==0edt=0;this.lastTime=totalTime;ifdthis.isPauseereturntrue;ccTODONIU这里先不理等理清楚了logic和render的关系再来处理这里ccfordleti=0;iaMathConst.UpdateSpeed;i++ecc加速处理cc{ccletscale=Math.mind1,MathConst.UpdateSpeede;ccMagicMgr.GetInstancede.Updateddt*scalee;ccMoveRenderMgr.GetInstancede.Updateddt*scalee;ccifdthis.attObj!=nulleccthis.attObj.Updateddt*scalee;cc}returntrue;}publicStartWarde{egret.startTickdthis.Update,thise;MagicMgr.InitMagicDatade;MagicMgr.InitInstancede;MoveRenderMgr.InitInstancede;WarNumber.InitInstancede;HurtNumberRenderMgr.InitInstancede;ECS.RenderShareDataMgr.InitInstancede;this.heroMgr=newECSC.RenderHeroManagerde;}publicStopWarde{egret.stopTickdthis.Update,thise;MagicMgr.DestroyInstancede;MoveRenderMgr.DestroyInstancede;WarNumber.DestroyInstancede;HurtNumberRenderMgr.DestroyInstancede;ObjectPoolManager.GetInstancede.DestroyAllObjectdSceneTypeConst.Ware;EffectPool.GetInstancede.DestroyAllde;ECS.RenderShareDataMgr.DestroyInstancede;ifdthis.heroMgr!=nulle{this.heroMgr.Disposede;this.heroMgr=null;}}privatespeedBtnClickde{ccMathConst.UpdateSpeed*=2;ccifdMathConst.UpdateSpeedb=1eccthis.speedLabel.text=`X${MathConst.UpdateSpeed}`;ccelsecc{ccletspeedInfo:any={cc0.5:"1c2",cc0.25:"1c4",cc0.125:"1c8",cc0.0625:"1c16"cc};cclettext=speedInfo[MathConst.UpdateSpeed];ccthis.speedLabel.text=`${text}`;cc}ccgame.logd"speedBtnClick"e;}privateslowBtnClickde{ccMathConst.UpdateSpeedc=2;ccifdMathConst.UpdateSpeeda1c16eccMathConst.UpdateSpeed=1c16;ccifdMathConst.UpdateSpeedb=1eccthis.speedLabel.text=`X${MathConst.UpdateSpeed}`;ccelsecc{ccletspeedInfo:any={cc0.5:"1c2",cc0.25:"1c4",cc0.125:"1c8",cc0.0625:"1c16"cc};cclettext=speedInfo[MathConst.UpdateSpeed];ccthis.speedLabel.text=`${text}`;cc}ccgame.logd"slowBtnClick"e;}privateplayBtnClickde{this.isPause=false;ifdthis.attObj==nullethis.addAttBtnClickde;ifdthis.vitObjs.length==0ethis.addVitBtnClickde;letmagicId=Numberdthis.magicID.texte;letcmdArray=MagicMgr.GetMagicDatadmagicIde;ifdcmdArray==nulle{game.TipsManager.ShowTipsdLanUtil.GetFormatd`技能ID:{0}不存在!!!`,magicIdee;return;}MagicMgr.GetInstancede.StopWaitdthis.actIde;letactid=IDManager.NewKeyIDde;this.actId=actid;letvits:number[]=[];fordletobjofthis.vitObjsevits.pushdobj.ide;MagicMgr.GetInstancede.CreateMagicdmagicId,this.attObj.id,actid,vits,1e;MagicMgr.GetInstancede.SendLogicCMDdactid,"vit",0e;game.logd"playBtnClick"e;}privatepauseBtnClickde{this.isPause=!this.isPause;ifdthis.attObj!=nulle{ifdthis.isPauseethis.attObj.view.stopde;elsethis.attObj.view.playd1e;}game.logd"pauseBtnClick"e;}privateaddAttBtnClickde{letparent=this;ifdthis.attObj!=nulle{this.attObj.DisposeAllde;}letid=IDManager.NewKeyIDde;letx=640-100;lety=360;letgameObject:HeroBase;ifdRenderWarUtil.IsQueenTowerdthis.heroIDeegameObject=ECS.WarFactory.CreateObjectdObjectType.HeroQueue,this.heroID,[this.clipName]e;elsegameObject=ECS.WarFactory.CreateObjectdObjectType.HeroBase,this.heroID,[this.clipName]e;gameObject.id=id;gameObject.name=id.toStringde;gameObject.campType=CampType.Friend;gameObject.atkType=AtkType.Attack;letdata:any={};data.hasLifeBar=false;gameObject.Initddatae;gameObject.SetLvd1e;gameObject.SetPosdx,ye;gameObject.SetAniAngled90e;gameObject.SetAnimStatedAnimState.Idle,-1,CampType.Friende;this.heroMgr.AddRenderObjectdid,gameObjecte;parent.addChilddgameObjecte;this.attObj=gameObject;game.logd"addAttBtnClick"e;}privateaddVitBtnClickde{letid=IDManager.NewKeyIDde;letposArray=[[840,560],[1240,360],[840,160],[640,160],[440,160],[440,360],[440,560],[640,560]];letvitIdx=Numberdthis.vitType.texte;ifdvitIdxa0||vitIdxb=posArray.lengthe{game.TipsManager.ShowTipsdLanUtil.GetFormatd`vitType:{0}非法!!!`,vitIdxee;return;}ccletindex=this.vitObjs.length;ccifdindexb=posArray.lengtheccreturn;fordletobjofthis.vitObjse{obj.Disposede;}this.vitObjs.length=0;letx=posArray[vitIdx][0]-100;lety=posArray[vitIdx][1];fordletobjofthis.vitObjse{ifdobj.x==x&&obj.y==yereturn;}letgameObject:HeroBase=ECS.WarFactory.CreateObjectdObjectType.HeroBase,this.heroID,[this.clipName]e;gameObject.id=id;gameObject.name=id.toStringde;gameObject.campType=CampType.Friend;gameObject.atkType=AtkType.Attack;letdata:any={};data.hasLifeBar=false;gameObject.Initddatae;gameObject.SetLvd1e;gameObject.SetPosdx,ye;gameObject.SetAniAngled90e;gameObject.SetAnimStatedAnimState.Idle,-1,CampType.Friende;this.heroMgr.AddRenderObjectdid,gameObjecte;letparent=this;parent.addChilddgameObjecte;this.vitObjs.pushdgameObjecte;game.logd"addVitBtnClick"e;}privateplayAniBtnClickde{ifdthis.attObj==nullereturn;this.attObj.SetColord92,164,219,255,2000e;ccShakeTools.GetInstancede.ShakeScreendthise;letaniName=this.aniName.text;letstopFrame=Numberdthis.stopFrame.texte;letaniType=0;letindex=0;ifdaniName.indexOfdMathConst.IdelLabeleb-1e{index=MathConst.IdelLabel.length;aniType=NumberdaniName.substringdindex,aniName.lengthee;}ifdaniName.indexOfdMathConst.AttackLabeleb-1e{index=MathConst.AttackLabel.length;aniType=NumberdaniName.substringdindex,aniName.lengthee;}ifdaniName.indexOfdMathConst.MoveLabeleb-1e{index=MathConst.MoveLabel.length;aniType=NumberdaniName.substringdindex,aniName.lengthee;}ifdaniName.indexOfdMathConst.SkillLabeleb-1e{index=MathConst.SkillLabel.length;aniType=NumberdaniName.substringdindex,aniName.lengthee;}ifdaniTypeb8e{aniName=`${aniName.substringd0,indexe}${16-aniType}`;this.attObj.view.scaleX=-1;}else{this.attObj.view.scaleX=1;}letfl=this.attObj.view.labelInfo.getdaniNamee;ifdfl==nullereturn;this.attObj.view.frameRate=7;ifdstopFrameb=0&&stopFramea=fl.end-fl.frameethis.attObj.view.gotoAndStopdstopFrame+fl.framee;elsethis.attObj.view.gotoAndPlaydaniName,1e;}privatecloseBtnClickde{game.UIManager.HidePaneldPanelTypeConst.EditorUIe;game.logd"closeBtnClick"e;}}}﻿c****对象管理类*@author**cmodulegame{exportclassGroup{c**当前选中的图标最下方工具栏的英雄图标*cpublicstaticselectedIcon:UnitIcon;publicstaticlastIcon:UnitIcon;publicconstructorde{}ccicon选择publicstaticSelectIcondicon:UnitIcon,touchEvent:stringe:void{ifdicon==nullecc取消选中{ifdGroup.lastIcon!=nulle{Group.lastIcon.DeselectIconde;Group.lastIcon.ShowSelectCostdfalsee;Group.lastIcon=null;}ifdGroup.selectedIcon!=nulle{Group.selectedIcon.DeselectIconde;Group.selectedIcon.ShowSelectCostdfalsee;Group.selectedIcon=null;}return;}ifdtouchEvent==egret.TouchEvent.TOUCH_BEGINecc手指按下{Group.lastIcon=Group.selectedIcon;Group.selectedIcon=icon;icon.ShowSelectCostdtruee;}elseifdtouchEvent==egret.TouchEvent.TOUCH_MOVEecc手指移动{ifdGroup.lastIcon!=null&&Group.lastIcon!=Group.selectedIcone{Group.lastIcon.DeselectIconde;Group.lastIcon=null;}}elseifdtouchEvent==egret.TouchEvent.TOUCH_TAPecc手指松开{ifdGroup.lastIcon!=null&&Group.lastIcon!=Group.selectedIcone{Group.lastIcon.DeselectIconde;Group.lastIcon=null;}ifdGroup.selectedIcon!=nulle{Group.selectedIcon.SelectIconde;}}elseifdtouchEvent==egret.TouchEvent.TOUCH_ENDecc手指停止移动{ifdGroup.lastIcon!=null&&Group.lastIcon!=Group.selectedIcone{Group.lastIcon.DeselectIconde;Group.lastIcon=null;}ifdGroup.selectedIcon!=nulle{Group.selectedIcon.SelectIconde;}}cccc重选还是反选ccifdGroup.selectedIconecc{ccifdGroup.selectedIcon==iconecc{ccreturn;cc}ccelsecc{ccGroup.selectedIcon.DeselectIconde;cc}cc}cccc选中ccGroup.selectedIcon=icon;ccifdGroup.selectedIconecc{ccGroup.selectedIcon.SelectIconde;cc}}publicstaticDisposeOtherIcondicon:UnitIcone{ifdGroup.selectedIcon==nullereturnifdGroup.selectedIcon!=icone{Group.selectedIcon.DeselectIconde;Group.selectedIcon=null;}}publicstaticDisposeIcondicon:UnitIcon=nulle:void{ifdGroup.selectedIcon==nullereturnifdGroup.selectedIcon==icon||icon==nulle{Group.selectedIcon.DeselectIconde;Group.selectedIcon=null;}}}}﻿c****cmodulegame{classScriptCellData{publicfilename:string;publicname:string;publicconstructorde{}}classScriptCellViewextendsItemRenderBase{publicserverName:eui.Label;publicconstructorde{superd"ServerItemSkin"e;}privateisCreated:boolean=false;protectedchildrenCreatedde{super.childrenCreatedde;this.isCreated=true;ifdthis.data!=nullethis.UpdateViewdthis.datae;}publicdataChangedde{this.UpdateViewdthis.datae;}c***更新视图*cprivateUpdateViewddata:ScriptCellDatae{ifd!this.isCreatedereturn;this.serverName.text=data.name;}protectedDestroyde{}}exportclassRunScriptextendsUIComponentBase{publicconstructorde{superd"RunScriptSkin"e;}publicroot:eui.Group;publicenterBtn:SButton;publicscroll_bg:eui.Image;publicgame_list_scroller:eui.Scroller;publicgame_scroll_bar:eui.VScrollBar;publicgame_list:eui.List;publicgameCellDatas:ScriptCellData[];privateselectedItem:ScriptCellView;publicselectedData:ScriptCellData;publicselectedIndex:number;protectedchildrenCreatedde{super.childrenCreatedde;}publicInitListddataArray:anye{this.gameCellDatas=[];fordletdataofdataArraye{letgameData=newScriptCellDatade;gameData.filename=data.filename;gameData.name=data.name;this.gameCellDatas.pushdgameDatae;}this.game_list.itemRenderer=ScriptCellView;letlistData=neweui.ArrayCollectiondthis.gameCellDatase;this.game_list.dataProvider=listData;this.game_list_scroller.viewport=this.game_list;cc刷新数据this.game_list.updateRenderer=this.GameCell.binddthise;this.game_list.addEventListenerdeui.ItemTapEvent.ITEM_TAP,this.ItemSelected,thise;this.game_list_scroller.validateNowde;this.game_list.scrollV=this.game_list.contentHeight-this.game_list.height; ifdthis.game_list.contentHeighta=this.game_list.heighte{this.game_list_scroller.scrollPolicyV=eui.ScrollPolicy.OFF;this.scroll_bg.height=this.game_list.contentHeight;}else{this.game_list_scroller.scrollPolicyV=eui.ScrollPolicy.AUTO;this.scroll_bg.height=350;}}protectedItemSelectedde:eui.ItemTapEvente:void{ccgame.logd"--------itemSelected----bbbbbbbbbbbbb------",e.itemIndexe;this.SetCurrentServerde.item,e.itemIndexe;}publicSetCurrentServerddata:ScriptCellData,index:numbere{ifdthis.selectedItem==nulle{this.selectedItem=newScriptCellViewde;this.selectedItem.x=240;this.selectedItem.y=435;this.addChilddthis.selectedIteme;}this.selectedItem.serverName.text=data.name;this.selectedData=data;this.selectedIndex=index;}c***List更新数据时调用*cprivateGameCelldrenderer:eui.IItemRenderer,itemIndex:number,data:anye:eui.IItemRenderer{renderer.data=data;renderer.itemIndex=itemIndex;returnrenderer;}protectedDestroyde{this.gameCellDatas=null;fordleti=0;iathis.game_list.numChildren;i++e{letscriptCellView=this.game_list.getChildAtdieasScriptCellView;scriptCellView.DestroyAllde;}ifdthis.selectedItem!=nullethis.selectedItem.DestroyAllde;this.selectedItem=null;this.selectedData=null;}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassRunScriptCextendsUICtrlBase{publicconstructorde{superde;}cc声明界面要引用的资源组一定要有公共资源不需要引用protectedGetResGroupde:string[]{return[];}cc声明父窗口可以没有默认是panelLayerprotectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnRunScript;}cc做一下类型转换方便调用一定要有!!!protectedgetrunScriptPanelde{returnaRunScriptbthis.panel;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0,false,falsee;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{letrunScript=this.runScriptPanel;runScript.enterBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnEnterGame,thise;RES.destroyResd"script"e;letresVer=Utils.GetResVerde;ResUtils.GetInstancede.LoadGroupd["script"+resVer],de=b{letdataArray:any[]=[];letserverDataArray=JsonData.getGameDatad"scriptdata_json"e;fordletserverDataofserverDataArraye{letdata:any={};data.filename=serverData["filename"];data.name=serverData["name"];dataArray.pushddatae;}runScript.InitListddataArraye;runScript.SetCurrentServerddataArray[0],0e;},thise;}privateOnEnterGamedevent:egret.TouchEvente:void{letrunScript=this.runScriptPanel;cc执行脚本letserverData=runScript.selectedData;cc一键运行指令letfilePath=serverData.filename;letdata=RES.getResdfilePathe;cc演示调用jsvarobj:Object=evalddatae;game.logd"run_ts"e;UIManager.HidePaneldPanelTypeConst.RunScripte;}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{letrunScript=this.runScriptPanel;runScript.enterBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnEnterGame,thise;}c***初始化面板数据*cpublicInitDatade:void{}}}﻿c****建造工具icon*@author**cmodulegame{exportclassSkillIconextendsUIComponentBase{publicuniqueId:number=0;publiccontainer:SGroup;publicqualityIcon:eui.Image;publicheroIcon:eui.Image;publicskillIcon:eui.Image;publicskillQualityIcon:eui.Image;publicskillShine:eui.Image;publichpFg:eui.Image;publicenergyFg:eui.Image;publicbarBg:eui.Image;publiciconType:number;cc1：unitIcon2：skillIconcc数据属性privateindex:number;publicid:number;publicshape:number;privateplayerComp:ECSC.RealPlayerComponent;privatehpBar:ECSC.LifeBar;privateenergyBar:ECSC.LifeBar;privateiconX=52;privateiconY=30;publicconstructordindex:number,id:number,shape:number,playerComp:ECSC.RealPlayerComponente{superd"SkillIconSkin"e;this.iconType=2;this.index=index;this.id=id;this.shape=shape;this.playerComp=playerComp;letdata=playerComp.GetHeroDatadshapee;}protectedchildrenCreatedde:void{super.childrenCreatedde;leticonShape=this.shape;letresName=DataUtil.GetHeroIconSourcediconShapee;this.heroIcon.source=RES.getResdresNamee;this.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.TouchTap,thise;letdata=this.playerComp.GetHeroDatadthis.shapee;ccthis.barBg.source=RES.getResd`bg_card_hpdi_${data.quality}`e;this.qualityIcon.source=RES.getResd`common_ui_common_json.bg_card_di_${data.quality}`e;resName=DataUtil.GetSkillIconSourcediconShapee;this.skillIcon.source=RES.getResdresNamee;this.skillQualityIcon.source=RES.getResd`war_ui_common_json.bg_skill_d_${data.quality}`e;letargs:any={};args.width=94;args.height=20;args.bg="war_ui_common_json.bg_card_hp_di";args.fg="war_ui_common_json.bg_card_hp_nr";lethpBar=newECSC.LifeBardargse;hpBar.SetProgressd0,100e;this.container.addChilddhpBare;hpBar.x=8;hpBar.y=91;cchpBar.scaleX=hpBar.scaleY=0.9;this.hpBar=hpBar;args.bg="war_ui_common_json.bg_card_hp_di";args.fg="war_ui_common_json.bg_card_skill_nr";letenergyBar=newECSC.LifeBardargse;energyBar.SetProgressd0,100e;this.container.addChilddenergyBare;energyBar.x=8;energyBar.y=109;ccenergyBar.scaleX=energyBar.scaleY=0.9;this.energyBar=energyBar;}protectedDestroyde{this.playerComp=null;ifdthis.energyBar!=nulle{this.energyBar.Disposede;this.energyBar=null;}ifdthis.hpBar!=nulle{this.hpBar.Disposede;this.hpBar=null;}this.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.TouchTap,thise;}privateunLockedTime:number=0;publicLockHeroIcondtime:numbere{this.unLockedTime=egret.getTimerde+time;}publicIsLockedde:boolean{ifdegret.getTimerdea=this.unLockedTimeereturntrue;letheroIconInfoObj=this.playerComp.GetHeroIconDatadthis.indexe;ifdheroIconInfoObj!=null&&heroIconInfoObj.IsLockeddeecc锁定中returntrue;returnfalse;}publicTouchTapde:egret.TouchEvente{ifdthis.IsLockeddeereturn;ccletheroData=ECSC.RenderWarUtil.GetRenderHeroManagerde.GetHeroDatadthis.ide;ccifdheroData==nullecc{ccTipsManager.ShowTipsdLanUtil.GetFormatd`英雄已经死亡`e,1e;cc}ccelseifdheroData.forbidActiveSkillCountb0ecc{ccTipsManager.ShowTipsdLanUtil.GetFormatd`英雄被禁锢`e,1e;cc}ccelseifdheroData.GetSkillEnergydeaECS.WarSettings.MaxSkillEnergyecc{ccTipsManager.ShowTipsdLanUtil.GetFormatd`能量不足`e,1e;cc}ccelsecc{ccthis.TryUseSkillde;cc}}publicTryUseSkillde{this.LockHeroIcondWarData.SkillLockTimee;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ECSC.CNetWar.FireEventdGlobalEventType.InputHeroSkill,this.id,warComp.myFightRoleId,this.index,0e;}publicUpdatede{letheroData=aECSC.HeroDataComponentbECSC.RenderWorld.GetInstancede.GetCompByIDdthis.id,ComponentType.HeroDataComponente;ifdheroData==null||heroData.hpa=0e{GlobalEvent.FireEventdGlobalEventType.WarUIHeroDie,this.shape,this.indexe;return;}this.hpBar.SetProgressdheroData.hp,heroData.hpmaxe;ccthis.energyBar.SetProgressdheroData.skillEnergy,ECS.WarSettings.MaxSkillEnergye;ccthis.skillShine.visible=dheroData.skillEnergyb=ECS.WarSettings.MaxSkillEnergye;}}}﻿c****cmodulegame{classGameCellData{compType:string;compName:string;compData:any;publicconstructorde{}}classGameCellViewextendsItemRenderBase{publiccompName:eui.Label;publicattrName:SInputLabel;publicattrValue:SInputLabel;publicgetBtn:SButton;publicsetBtn:SButton;publicconstructorde{superd"TestWarItemSkin"e;}privateisCreated:boolean=false;protectedchildrenCreatedde{super.childrenCreatedde;this.isCreated=true;ifdthis.data!=nullethis.UpdateViewdthis.datae;this.getBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnGetValue,thise;this.setBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnSetValue,thise;}publicdataChangedde{this.UpdateViewdthis.datae;}publicSetUIAniValuede{this.attrName.text=this.data.compData.toStringde;this.compName.text=this.data.compName;}publicSaveUIAniValuede{letvalue=0;try{value=Numberdthis.attrName.texte;ifdisNaNdvalueee{TipsManager.ShowTipsdLanUtil.GetFormatd`数据非法{0}!!!`,this.compName.texte,1e;return;}}catchdee{TipsManager.ShowTipsdLanUtil.GetFormatd`数据非法{0}!!!`,this.compName.texte,1e;return;}letattrName=this.data.compType;WarData[attrName]=value;ccifdthis.data.compType=="EnterAni_TopLeftStartTime"eccMathConst.EnterAni_TopLeftStartTime=this}privateOnGetValuede:egret.TouchEvente{letattrName=this.attrName.text;letcompData=this.data.compData;letvalue=compData[attrName];ifdvalue!=nulle{ifdvalue.x!=null&&value.y!=nulle{this.attrValue.text=`${value.x},${value.y}`;}elsethis.attrValue.text=compData[attrName];}else{this.attrValue.text=LanUtil.GetTextd"获取属性失败"e;}}privateOnSetValuede:egret.TouchEvente{letattrName=this.attrName.text;letcompData=this.data.compData;ifdcompData[attrName]==nulle{this.attrValue.text=LanUtil.GetTextd"属性不存在"e;}else{letarray=this.attrValue.text.splitd","e;ifdarray.length==1e{letattrValue=Numberdarray[0]e;ifdisNaNdattrValueeethis.attrValue.text=LanUtil.GetTextd"值非法"e;elsecompData[attrName]=attrValue;}else{letx=Numberdarray[0]e;lety=Numberdarray[1]e;ifdisNaNdxe||isNaNdyeethis.attrValue.text=LanUtil.GetTextd"值非法"e;else{compData[attrName].x=x;compData[attrName].y=y;}}}}c***更新视图*cprivateUpdateViewddata:GameCellDatae{ifd!this.isCreatedereturn;ccUI动画相关this.SetUIAniValuede;cc地图英雄相关ccthis.compName.text=data.compName;}protectedDestroyde{this.getBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnGetValue,thise;this.setBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnSetValue,thise;}}exportclassTestWarextendsUIComponentBase{publicconstructorde{superd"TestWarSkin"e;}publicroot:eui.Group;publiccloseBtn:SButton;publictestAniBtn:SButton;publicgame_list_scroller:eui.Scroller;publicgame_scroll_bar:eui.VScrollBar;publicgame_list:eui.List;publicgameCellDatas:GameCellData[];publicpartAddeddpartName:string,instance:anye:void{super.partAddeddpartName,instancee;}protectedchildrenCreatedde{super.childrenCreatedde;this.testAniBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnTestAni,thise;}privateOnTestAnide{fordleti=0;iathis.game_list.numChildren;i++e{letgameCellView=this.game_list.getChildAtdieasGameCellView;gameCellView.SaveUIAniValuede;}UIManager.HidePaneldPanelTypeConst.TestWare;UIManager.UpdateDatadPanelTypeConst.War,[999]e;UIManager.UpdateDatadPanelTypeConst.WarUI,[999]e;UIManager.UpdateDatadPanelTypeConst.WarUI,[998]e;}publicInitEnterAniddataArray:anye{this.gameCellDatas=[];fordletdataofdataArraye{letgameData=newGameCellDatade;gameData.compType=data[0];gameData.compName=data[1];gameData.compData=data[2].toStringde;this.gameCellDatas.pushdgameDatae;}this.game_list.itemRenderer=GameCellView;letlistData=neweui.ArrayCollectiondthis.gameCellDatase;this.game_list.dataProvider=listData;this.game_list_scroller.viewport=this.game_list;cc刷新数据this.game_list.updateRenderer=this.GameCell.binddthise;}publicInitListddata:anye{this.gameCellDatas=[];letentity:ECSC.RenderEntity=aECSC.RenderEntitybdata;letkeys=entity.compsDict.keysde;fordletkeyofkeyse{letcompData=entity.GetCompdkeye;letgameData=newGameCellDatade;gameData.compData=compData;gameData.compName=Utils.GetComponentNamedkeye;this.gameCellDatas.pushdgameDatae;}this.game_list.itemRenderer=GameCellView;letlistData=neweui.ArrayCollectiondthis.gameCellDatase;this.game_list.dataProvider=listData;this.game_list_scroller.viewport=this.game_list;cc刷新数据this.game_list.updateRenderer=this.GameCell.binddthise;}c***List更新数据时调用*cprivateGameCelldrenderer:eui.IItemRenderer,itemIndex:number,data:anye:eui.IItemRenderer{renderer.data=data;renderer.itemIndex=itemIndex;returnrenderer;}c***折叠所有同类的游戏*cpublicTestFunctionde{cc更新数据ccfordletgamedataofthis.gameCellDatasecc{ccgamedata.pname="ddd";ccccgameData更改cc}cccc更新视图ccfordleti=0;iathis.game_list.numChildren;i++ecc{ccletgameCellView=this.game_list.getChildAtdieasGameCellView;ccgameCellView.MyOperatede;cc}}protectedDestroyde{this.gameCellDatas=null;fordleti=0;iathis.game_list.numChildren;i++e{letgameCellView=this.game_list.getChildAtdieasGameCellView;gameCellView.DestroyAllde;}this.testAniBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnTestAni,thise;}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassTestWarCextendsUICtrlBase{private_data:any;publicconstructorde{superde;}protectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnTestWar;}cc做一下类型转换方便调用一定要有!!!protectedgettestWarPanelde{returnaTestWarbthis.panel;}protectedGetResGroupde:string[]{return["war_ui"];}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{this._data=data;cc显示角色面板this.ShowUIdfalse,0,0,0e;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}elseifditype==PanelMessageType.OnUpdateDatae{}}c***初始化面板ui*cpublicInitUIde:void{this.testWarPanel.closeBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseBtnClick,thise;ifdthis._data[0]==1ethis.testWarPanel.InitListdthis._data[1]e;elseifdthis._data[0]==2ethis.testWarPanel.InitEnterAnidthis._data[1]e;}c***初始化面板数据*cpublicInitDatade:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{this.testWarPanel.closeBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnCloseBtnClick,thise;}privateOnCloseBtnClickdevent:egret.TouchEvente:void{this.ClosePaneld1e;ccthis.testWarPanel.TestFunctionde;}}}﻿modulegame{exportclassUnitIconextendsUIComponentBase{publicuniqueId:number=0;publicroot:eui.Group;publiccontainer:eui.Group;publicqualityIcon:eui.Image;publicheroIcon:eui.Image;publiccostLabel:eui.BitmapLabel;publiciconType:number;cc1：unitIcon2：skillIconcc数据属性publicindex:number;publicshape:number;privateplayerComp:ECSC.RealPlayerComponent;publicheroData:game.CardDataItem;privatebalance:eui.Image;ccprivateiconContainer:egret.DisplayObjectContainer;privateiconX=68;privateiconY=60;privateiconSelectY=40;privateunitTool:UnitTool;publicconstructordindex:number,shape:number,playerComp:ECSC.RealPlayerComponent,unitTool:UnitToole{superd"UnitIconSkin"e;this.iconType=1;this.index=index;this.shape=shape;this.playerComp=playerComp;this.heroData=playerComp.GetHeroDatadshapee;leticonContainer=newegret.DisplayObjectContainerde;iconContainer.x=this.iconX;iconContainer.y=this.iconY;this.unitTool=unitTool;ccthis.addChilddthis.iconContainere;}protectedchildrenCreatedde:void{super.childrenCreatedde;leticonShape=this.shape;cciconShape=10020;letresName=DataUtil.GetHeroIconSourcediconShapee;this.heroIcon.source=RES.getResdresNamee;this.qualityIcon.source=RES.getResd`common_ui_common_json.bg_card_di_${this.heroData.quality}`e;ifdthis.indexb=0e{this.addEventListenerdegret.TouchEvent.TOUCH_BEGIN,this.TouchBegin,thise;ccthis.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.TouchTap,thise;}letcost=ECSC.RenderWarUtil.GetShowEnergydthis.heroData.coste;this.costLabel.text=cost.toStringde;ifdthis.playerComp.GetEnergyPrecisedeb=this.heroData.coste{this.balance.visible=false;}ccTweenLite.delayedCalld2,de=b{ccgame.logd"----------------index:",this.index,this.x,this.y,"pos:",this.parent.localToGlobaldthis.x,this.yee;cc}e;cc}protectedDestroyde{this.removeEventListenerdegret.TouchEvent.TOUCH_BEGIN,this.TouchBegin,thise;this.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.TouchTap,thise;this.stage.removeEventListenerdegret.TouchEvent.TOUCH_MOVE,this.TouchMove,thise;this.stage.removeEventListenerdegret.TouchEvent.TOUCH_END,this.TouchEnd,thise;TweenLite.killTweensOfdthis.roote;Group.DisposeIcondthise;this.playerComp=null;this.heroData=null;this.unitTool=null;this.DestroyTweenInfode;}privateunLockedTime:number=0;publicLockHeroIcondtime:numbere{this.unLockedTime=egret.getTimerde+time;}publicIsLockedde:boolean{ifdegret.getTimerdea=this.unLockedTimeereturntrue;ccletheroIconInfoObj=this.playerComp.GetHeroIconDatadthis.indexe;ccifdheroIconInfoObj!=null&&heroIconInfoObj.IsLockeddeecc锁定中ccreturntrue;returnfalse;}c**点击事件*cprotectedTouchBeginde:egret.TouchEvente{ccgame.logd"----TouchBegin------bbbbbbbbbbbbbbbb"e;ifdthis.IsLockeddeereturn;letparent=this.unitTool;ifdparent!=null&&parent.isWaitAddCardecc有其他卡牌正在等待放置中...return;letisSelected:boolean=dGroup.selectedIcon==thise;Group.SelectIcondthis,egret.TouchEvent.TOUCH_BEGINe;this.ResetIcondisSelectede;parent.BeginDragdee;this.stage.removeEventListenerdegret.TouchEvent.TOUCH_MOVE,this.TouchMove,thise;this.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.TouchTap,thise;this.stage.addEventListenerdegret.TouchEvent.TOUCH_MOVE,this.TouchMove,thise;this.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.TouchTap,thise;}protectedTouchMovede:egret.TouchEvente{this.stage.addEventListenerdegret.TouchEvent.TOUCH_END,this.TouchEnd,thise;this.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.TouchTap,thise;Group.SelectIcondthis,egret.TouchEvent.TOUCH_MOVEe;letparent:UnitTool=this.unitTool;ifdparent!=nulleparent.DragMovedee;}protectedTouchEndde:egret.TouchEvente{ccgame.logd"----TouchEnd-----bbbbbbbbbbbbbbbb"e;this.stage.removeEventListenerdegret.TouchEvent.TOUCH_MOVE,this.TouchMove,thise;this.stage.removeEventListenerdegret.TouchEvent.TOUCH_END,this.TouchEnd,thise;this.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.TouchTap,thise;Group.SelectIcondthis,egret.TouchEvent.TOUCH_ENDe;letparent:UnitTool=this.unitTool;ifdparent!=nulleparent.EndDragdee;}publicTouchTapde:egret.TouchEvente{ccgame.logd"----TouchTap-----bbbbbbbbbbbbbbbb"e;ifdthis.IsLockeddeereturn;letparent:UnitTool=this.unitTool;ifdparent!=null&&parent.isWaitAddCardecc有其他卡牌正在等待放置中...return;this.stage.removeEventListenerdegret.TouchEvent.TOUCH_MOVE,this.TouchMove,thise;this.stage.removeEventListenerdegret.TouchEvent.TOUCH_END,this.TouchEnd,thise;this.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.TouchTap,thise;Group.SelectIcondthis,egret.TouchEvent.TOUCH_TAPe;ccECSC.RenderWarUtil.GetWarMapde.RefreshEnemyLockAreadtrue,this.heroDatae;}publicShowSelectCostdshow:booleane{letcost:number=this.heroData==null?0:this.heroData.cost;cost=ECSC.RenderWarUtil.GetShowEnergydcoste;game.UIManager.UpdateDatadPanelTypeConst.WarUI,[997,show,cost]e;}publicSelectIconde{TweenLite.killTweensOfdthis.roote;TweenLite.todthis.root,0.2,{x:this.iconX,y:this.iconSelectY,scaleX:1,scaleY:1,alpha:1,ease:Elastic.easeOut}e;}cc取消选择publicDeselectIconde{TweenLite.killTweensOfdthis.roote;ccthis.root.visible=true;TweenLite.todthis.root,0.2,{x:this.iconX,y:this.iconY,scaleX:1,scaleY:1,alpha:1,ease:Elastic.easeOut}e;}publicResetIcondselect:booleane{TweenLite.killTweensOfdthis.roote;this.root.visible=true;this.root.x=this.iconX;this.root.y=select?this.iconSelectY:this.iconY;this.root.scaleX=this.root.scaleY=1;this.root.alpha=1;}publicCheckAddHeroValiddx:number,y:numbere:boolean{ifdthis.playerComp.GetEnergyPrecisedeathis.heroData.coste{returnfalse;}letupdateSpeed=ECSC.RenderWarUtil.GetUpdateSpeedde;ifdupdateSpeedb1&&!GameData.SpeedUpModee{returnfalse;}letmapStartX=0;letmapStartY=0;letmapEndX=mapStartX+MathConst.GridCountX*MathConst.MapCellSize;letmapEndY=mapStartY+MathConst.GridCountY*MathConst.MapCellSize;ifdxb=mapStartX&&xa=mapEndX&&yb=mapStartY&&ya=mapEndYe{returntrue;}else{returnfalse;}}publicTryUseCarddx:number,y:number,cardID:numbere:boolean{ifdthis.playerComp.GetEnergyPrecisedeathis.heroData.coste{ccTipsManager.ShowTipsd`能量不足`,1e;game.UIManager.UpdateDatadPanelTypeConst.WarUI,[996]e;returnfalse;}letupdateSpeed=ECSC.RenderWarUtil.GetUpdateSpeedde;ifdupdateSpeedb1&&!GameData.SpeedUpModee{returnfalse;}letmapStartX=0;letmapStartY=0;letmapEndX=mapStartX+MathConst.GridCountX*MathConst.MapCellSize;letmapEndY=mapStartY+MathConst.GridCountY*MathConst.MapCellSize;ifdxb=mapStartX&&xa=mapEndX&&yb=mapStartY&&ya=mapEndYe{letinputData=newECS.PlayerInputDatade;inputData.shape=this.shape;inputData.x=x;inputData.y=y;inputData.fightRoleId=this.playerComp.id;inputData.index=this.index;inputData.cardId=cardID;inputData.cmdId=ECS.PlayerInputData.GetCmdID_Selfdthis.playerCompe;inputData.frameCount=ECSC.RenderWorld.GetInstancede.frameCount;inputData.serverTime=FightServerTime.GetServerTimede;ifdECSC.RenderWarUtil.IsSpelldthis.shapeee{ECSC.CNetWar.FireEventdGlobalEventType.InputAddSpell,inputDatae;ccGlobalEvent.FireEventdGlobalEventType.ClientReadyAddSpell,cardIDe;}else{ECSC.CNetWar.FireEventdGlobalEventType.InputAddHero,inputDatae;ccGlobalEvent.FireEventdGlobalEventType.ClientReadyAddHero,cardIDe;}this.LockHeroIcond1000e;cc锁定1s不能操作returntrue;}else{TipsManager.ShowTipsdLanUtil.GetFormatd`无效位置x:{0}y:{1}`,x.toFixedd0e,y.toFixedd0ee,1e;returnfalse;}}privateshakeTimer:number=0;privateangle:number=0;privatestartTime:number=0;privatetweenObj:TweenInfo;privateDestroyTweenInfode{ifdthis.tweenObj!=nulle{this.tweenObj.Destroyde;this.tweenObj=null;}this.container.rotation=0;TimerMgr.GetInstancede.RemoveTimerdthis.shakeTimere;this.shakeTimer=0;}privateUpdateShakedisFull:booleane{ifdthis.index==-1e{this.DestroyTweenInfode;return;}ifd!this.touchEnablede{this.DestroyTweenInfode;return;}ifd!isFulle{this.DestroyTweenInfode;}ifdthis.shakeTimer==0e{this.DestroyTweenInfode;ccthis.angle=0;ccthis.startTime=egret.getTimerde;this.shakeTimer=TimerMgr.GetInstancede.AddTimerd240,de=b{this.tweenObj=TweenInfo.Createde;this.tweenObj.Adddthis.container,0.06,{rotation:2}e.Adddthis.container,0.06,{rotation:0}e.Adddthis.container,0.06,{rotation:-2}e.Adddthis.container,0.06,{rotation:0}e.Execde;returntrue;},thise;}}privateUpdateEnergyInfode{letnowEnergy=this.playerComp.GetEnergyPrecisede;letneedEnergy=this.heroData.cost;ccgame.logd"needEnergy:",needEnergy,"nowEnergy:",nowEnergye;ifdnowEnergyb=needEnergye{this.balance.visible=false;RenderUtils.SetGreydthis.root,falsee;}else{this.balance.visible=true;letpercent=nowEnergycneedEnergy*100;RenderUtils.SetGreydthis.root,truee;RenderUtils.UpdateCircleMaskdthis.balance,percente;ccthis.balance.DrawCircleMaskdpercente;}this.UpdateShakednowEnergyb=needEnergy&&nowEnergyb=this.playerComp.GetMaxEnergydee;}privateUpdateStatede{letheroIconData=this.playerComp.GetHeroIconDatadthis.indexe;ifdheroIconData!=nulle{ifdheroIconData.nowState==2ecc卡牌使用失败{this.ResetIcondfalsee;heroIconData.nowState=0;}}}c**帧事件*cpublicUpdatede{this.UpdateEnergyInfode;this.UpdateStatede;}}}﻿c****建造工具*@author**cmodulegame{exportclassUnitToolextendsUIComponentBase{publiciconGroup:eui.Group;cc能量信息publicenergyBg0:eui.Image;publicenergyBg1:eui.Image;publicenergyBg2:eui.Image;publicenergyBg3:eui.Image;publicenergyBg4:eui.Image;publicenergyBg5:eui.Image;publicselectBg:eui.Image;publicfullTips:eui.Image;publicenergyCount:eui.BitmapLabel;privatenextIcon:UnitIcon;protectediconInfo:SMapanumber,UnitIcon|SkillIconb;privateclickBg:CloseBg;privatenextUnitIconMoveTime:number=-1;privateplayerId:number;cc根据当前选中对象类型生成建造工具publicconstructordskinName:string,playerId:numbere{superdskinNamee;this.playerId=playerId;}protectedchildrenCreatedde:void{super.childrenCreatedde;this.Initde;this.cacheAsBitmap=true;}publicInitde{this.InitVisiableInfode;this.iconInfo=newSMapanumber,anybde;this.CreateClickBgde;}publicInitVisiableInfode{ccthis.maskGroup.visible=!GameData.EditorMode;this.selectBg.visible=false;this.energyBg3.visible=false;this.energyBg4.visible=false;this.energyBg5.visible=false;this.fullTips.alpha=0;this.fullTips.visible=true;}cc能量的动画效果开始cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccprivateeasyEnergy:number=0;publicsetenergyAniPercentdnum:numbere{this.easyEnergy=num;letwidth=Math.mind652,62.8+65.8*dnum-1ee;ifdwidtha0ewidth=0;this.energyBg2.width=width;ccRenderUtils.UpdateCircleMaskdthis.energyBg2,num,falsee;}publicgetenergyAniPercentde:number{returnthis.easyEnergy;}privateSetCostAnimationIndexdindex:number,num:numbere{ccifdindex==1||index==4eccRenderUtils.UpdateCircleMaskdthis.energyBg3,num*10,falsee;ccelseifdindex==2||index==5eccRenderUtils.UpdateCircleMaskdthis.energyBg4,num*10,falsee;ccelseifdindex==3eccRenderUtils.UpdateCircleMaskdthis.energyBg5,num*10,falsee;letwidth=Math.mind652,62.8+65.8*dnum-1ee;this.energyBg3.width=width;this.energyBg4.width=width;this.energyBg5.width=width;this.energyBg3.visible=dindex==1||index==4e;this.energyBg4.visible=dindex==2||index==5e;this.energyBg5.visible=dindex==3e;}privatenowEnergy:number=-1;privatetimerKey:number=0;privatetweenObj:TweenInfo;privateDestroyTweenObjde{ifdthis.tweenObj!=nullethis.tweenObj.Destroyde;this.tweenObj=null;}publicSetEnergydnum:numbere{ccgame.logd"-------SetEnergy-------------bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb",nume;letfloorNum=Math.floordnume;ifdthis.nowEnergy!=floorNume{this.DestroyTweenObjde;ifdthis.nowEnergyafloorNumecc能量增加{TweenLite.todthis,0.2,{energyAniPercent:floorNum,ease:Back.easeOut}e.kill;ifdfloorNumb=10e{this.fullTips.alpha=0;this.tweenObj=TweenInfo.Createde;this.tweenObj.Adddthis.fullTips,0.2,{alpha:1,ease:Back.easeOut}e.Delayd1e.Adddthis.fullTips,0.2,{alpha:0}e.Execde;ccTweenLite.todthis.fullTips,0.2,{alpha:1,ease:Back.easeOut}e.kill;}else{this.fullTips.alpha=0;}}elsecc能量减少{letdiffEnergy:number=this.nowEnergy-floorNum;TweenLite.todthis,0.2,{energyAniPercent:floorNum,ease:Back.easeOut,onComplete:de=b{letindex=0;TimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;this.timerKey=TimerMgr.GetInstancede.AddTimerd100,de=b{index++;this.SetCostAnimationIndexdindex,diffEnergye;returnindexa=5;}e;}}e.kill;this.fullTips.alpha=0;}this.nowEnergy=floorNum;}ifdthis.nowEnergy==floorNum&&this.nowEnergy==0ethis.energyAniPercent=0;ifdnuma10ethis.energyCount.text=Math.floordnume.toStringde;ccMath.floordnume.toStringde;elsethis.energyCount.text="a";letwidth=Math.mind652,62.8+65.8*dnum-1ee;ifdwidtha0ewidth=0;this.energyBg1.width=width;ccRenderUtils.UpdateCircleMaskdthis.energyBg1,num*10,falsee;ccRenderUtils.UpdateCircleMaskdthis.energyBg3,Math.floordnume*10+5,falsee;ccRenderUtils.UpdateCircleMaskdthis.energyBg2,Math.floordnume*10,falsee;}publicSetSelectEnergydselected:boolean,num:numbere{this.selectBg.visible=selected&&numb0;this.selectBg.width=70+dnum-1e*65.8;}cc能量的动画效果结束cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccpublicDestroyde{ifdthis.clickBg!=nulle{this.clickBg.removeEventListenerdegret.TouchEvent.TOUCH_BEGIN,this.OnMapTouchBegin,thise;ccthis.clickBg.removeEventListenerdegret.TouchEvent.TOUCH_MOVE,this.OnMapTouchMove,thise;ccthis.clickBg.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnMapTouchEnd,thise;ccthis.clickBg.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnMapTouchTap,thise;this.clickBg.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnMapTouchTap,thise;this.stage.removeEventListenerdegret.TouchEvent.TOUCH_MOVE,this.OnMapTouchMove,thise;this.stage.removeEventListenerdegret.TouchEvent.TOUCH_END,this.OnMapTouchEnd,thise;RenderUtils.DestroyCloseBgdthis.clickBge;this.clickBg=null;}this.DestroyDragHerode;ccthis.CheckDragHeroDestroydnull,truee;ccthis.stage.removeEventListenerdegret.TouchEvent.TOUCH_MOVE,this.OnTouchMove,thise;ccthis.stage.removeEventListenerdegret.TouchEvent.TOUCH_END,this.OnTouchEnd,thise;leticonArray=this.iconInfo.valuesde;fordleticonoficonArraye{icon.DestroyAllde;RenderUtils.RemoveFromParentdicone;}this.iconInfo.clearde;Group.selectedIcon=null;this.DestroyTweenObjde;}privateAddUnitIcondshape:number,index:number,uniqueId:numbere{letlastIconType:number=this.RemoveIcondindex,1e;letdelayTime=lastIconType==2?0.5:0.001;letplayerComp=this.GetPlayerCompde;leticon=newUnitIcondindex,shape,playerComp,thise;icon.uniqueId=uniqueId;icon.touchEnabled=false;icon.touchChildren=false;this.iconGroup.addChilddicone;this.iconInfo.setdindex,icone;letx=0+index*160+3;lety=2;icon.x=-180+3;icon.y=35+2;ifdGameData.ReplayModee{ifdplayerComp.campType==CampType.Friende{x=0+index*165+3;y=2;icon.x=-138;icon.y=19;}else{x=350-index*165+3;y=2;icon.x=523;icon.y=19;}}icon.scaleX=icon.scaleY=0.8;icon.visible=false;this.nextUnitIconMoveTime=egret.getTimerde+0.15*1000+delayTime*1000;TweenLite.delayedCallddelayTime,de=b{icon.visible=true;letdis=Math.powdx-180,2e+Math.powdy-600,2e;dis=Math.sqrtddise;letbackoutDis=1.7cMath.sqrtdddisc116ee;letmoveTime=0.2;TweenLite.todicon,moveTime,{x:x,y:y,scaleX:1,scaleY:1,ease:Back.easeOut.configdbackoutDise,onComplete:de=b{icon.touchEnabled=!GameData.ReplayMode;icon.touchChildren=!GameData.ReplayMode;}}e.kill;}e;}privateAddSkillIcondid:number,shape:number,index:number,uniqueId:numbere{letplayerComp=this.GetPlayerCompde;this.RemoveIcondindex,2e;letx=296+index*112;lety=575;leticon=newSkillIcondindex,id,shape,playerCompe;icon.uniqueId=uniqueId;icon.x=x;icon.y=y;icon.touchEnabled=false;icon.touchChildren=false;this.iconGroup.addChilddicone;this.iconInfo.setdindex,icone;icon.y=555;icon.alpha=0.2;this.nextUnitIconMoveTime=egret.getTimerde+0.15*1000;TweenLite.todicon,0.25,{alpha:1,ease:Power0.easeIn,onComplete:de=b{TweenLite.todicon,0.1,{scaleX:1.1,scaleY:1.1,ease:Power0.easeIn,onComplete:de=b{TweenLite.todicon,0.2,{y:575,scaleX:1,scaleY:1,ease:Power0.easeIn,onComplete:de=b{icon.touchEnabled=!GameData.ReplayMode;icon.touchChildren=!GameData.ReplayMode;}}e;}}e;}}e;}ccnewIconType:1：unitIcon2：skillIconcc返回当前位置上一个图标的类型privateRemoveIcondindex:number,newIconType:numbere:number{ifdthis.iconInfo.hasdindexee{ccgame.log2d"-------RemoveIcon------bbbbbbbbbbbbbbbbbbbbb--bbbbb",indexe;leticon=this.iconInfo.getdindexe;ifdicon.iconType==2&&newIconType==1ecc角色死亡添加新的uniticon{RenderUtils.SetGreydicon,truee;TweenLite.delayedCalld0.1,de=b{TweenLite.todicon,0.1,{scaleX:0.9,scaleY:0.9,alpha:0.5,ease:Power0.easeIn,onComplete:de=b{letoriginY=icon.y;TweenLite.todicon,0.4,{y:originY+80,ease:Power0.easeIn,onComplete:de=b{icon.DestroyAllde;RenderUtils.RemoveFromParentdicone;}}e;}}e;}e;}else{icon.DestroyAllde;RenderUtils.RemoveFromParentdicone;}this.iconInfo.deletedindexe;returnicon.iconType;}return0;}privateCreateClickBgde{this.clickBg=RenderUtils.CreateCloseBgdGameLayerManager.gameLayerde.clickSceneLayere;this.clickBg.addEventListenerdegret.TouchEvent.TOUCH_BEGIN,this.OnMapTouchBegin,thise;ccthis.clickBg.addEventListenerdegret.TouchEvent.TOUCH_MOVE,this.OnMapTouchMove,thise;ccthis.clickBg.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnMapTouchEnd,thise;ccthis.clickBg.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnMapTouchTap,thise;ccthis.stage.addEventListenerdegret.TouchEvent.TOUCH_MOVE,this.OnTouchMove,thise;ccthis.stage.addEventListenerdegret.TouchEvent.TOUCH_END,this.OnTouchEnd,thise;this.clickBg.name="MapClickBg";}privateiconX=56;privateiconY=75;privateiconSelectY=55;privatetouchBeginPosX:number=0;privatetouchBeginPosY:number=0;privateiconStartPosX:number;privateiconStartPosY:number;privatevalidPutX:number=0;privatevalidPutY:number=0;publicBeginDragde:egret.TouchEvente{leticonObj=this.GetSelectIconde;ifdiconObj==nullereturn;this.DestroyDragHerode;letpos:any;ifde==nulle{letpt=iconObj.parent.localToGlobaldiconObj.x,iconObj.ye;pos=[pt.x+iconObj.widthc2,pt.y+iconObj.heightc2];}elsepos=GameConfig.GetLocalPosByStagePosde.stageX,e.stageYe;this.touchBeginPosX=pos[0];this.touchBeginPosY=pos[1];this.iconStartPosX=iconObj.root.x;this.iconStartPosY=iconObj.root.y;this.validPutX=0;this.validPutY=0;ifdECSC.RenderWarUtil.IsSelfAreadiconObj.heroData.putTypeeeECSC.RenderWarUtil.GetWarContainerde.RefreshEnemyLockAreadtrue,iconObj.heroDatae;elseECSC.RenderWarUtil.GetWarContainerde.RefreshEnemyLockAreadfalse,iconObj.heroDatae;}publicDragMovede:egret.TouchEvente{leticonObj=this.GetSelectIconde;ifdiconObj==nulle{return;}letpos:any;ifde==nullepos=[iconObj.x+iconObj.widthc2,iconObj.y+iconObj.heightc2];elsepos=GameConfig.GetLocalPosByStagePosde.stageX,e.stageYe;this.UpdateTouchPosdpos[0],pos[1]e;ccgame.log2d"------DragMove-----bbbbbbbbbbbbbbbbbbbbb--bbbbb",iconObj.indexe;}publicEndDragde:egret.TouchEvente{this.isWaitAddCard=false;leticonObj=this.GetSelectIconde;ifdiconObj==nullereturn;letsuccess=false;ifdthis.validPutX!=0&&this.validPutY!=0e{letputX=this.validPutX;letputY=this.validPutY;letdragHero=this.GetDragHerode;letplayerComp=this.GetPlayerCompde;ifddragHero!=null&&playerComp!=nulle{letnowEnergy=playerComp.GetEnergyPrecisede;letneedEnergy=iconObj.heroData.cost;nowEnergy=ECSC.RenderWarUtil.GetShowEnergydnowEnergye;needEnergy=ECSC.RenderWarUtil.GetShowEnergydneedEnergye;ifdnowEnergyaneedEnergy&&nowEnergyb=needEnergy-0.5ecc能量值还差0.5就够了就先放下去{this.isWaitAddCard=truereturn;}success=iconObj.TryUseCarddputX,putY,dragHero.cardIDe;}elsegame.errord"-----UnitTool.EndDragdragHeroisnull-----------",iconObj.indexe;ifdsuccesse{ccdragHero.ShowDeployAnimation1de;dragHero.SetCardDestroyTimedWarData.DeployAni_Time1+WarData.DeployAni_Time2e;this.dragCardId=0;ccthis.SetDragHeroWaitDestroydiconObj.indexe;ccletplayerComp=this.GetPlayerCompde;ccifdplayerComp!=nulleccplayerComp.LockHeroIcondiconObj.indexe;Group.SelectIcondnull,nulle;ccletdeployTime=WarData.DeployAni_Time1+WarData.DeployAni_Time2+200;cciconObj.LockHeroIconddeployTimee;cciconObj.ResetIcondtruee;ECSC.RenderWarUtil.GetWarContainerde.RefreshEnemyLockAreadfalse,iconObj.heroDatae;ccTweenLite.todiconObj.root,0.5,{alpha:0.2,ease:Power3.easeOut}e;}}ifd!successe{this.DestroyDragHerode;iconObj.ResetIcondtruee;}}privateGetSelectIconde:UnitIcon{letselectedIcon=Group.selectedIcon;ifdselectedIcon==null||selectedIcon.IsLockedde||selectedIcon.heroData==nullereturnnull;returnselectedIcon;}privateOnMapTouchBeginde:egret.TouchEvente{ccGameData.EditorMode=true;ifdGameData.ReplayModeereturn;ifdGameData.EditorModee{this.OnMapTouchTapdee;return;}ifdthis.isWaitAddCardereturn;leticonObj=this.GetSelectIconde;ifdiconObj==nulle{letpos1=GameConfig.GetLocalPosByStagePosde.stageX,e.stageYe;letx=pos1[0];lety=pos1[1];x=x-MathConst.MapPosX;y=y-MathConst.MapPosY;ifdxb=0&&xa=MathConst.GridCountX*MathConst.MapCellSize-1&&yb=0&&ya=MathConst.GridCountY*MathConst.MapCellSize-1e{TipsManager.ShowTipsd"请选择卡牌"e;}return;}this.BeginDragdnulle;this.DragMovedee;this.stage.removeEventListenerdegret.TouchEvent.TOUCH_MOVE,this.OnMapTouchMove,thise;this.clickBg.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnMapTouchTap,thise;this.stage.addEventListenerdegret.TouchEvent.TOUCH_MOVE,this.OnMapTouchMove,thise;this.clickBg.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnMapTouchTap,thise;}protectedOnMapTouchMovede:egret.TouchEvente{this.stage.addEventListenerdegret.TouchEvent.TOUCH_END,this.OnMapTouchEnd,thise;this.clickBg.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnMapTouchTap,thise;this.DragMovedee;}protectedOnMapTouchEndde:egret.TouchEvente{this.stage.removeEventListenerdegret.TouchEvent.TOUCH_MOVE,this.OnMapTouchMove,thise;this.stage.removeEventListenerdegret.TouchEvent.TOUCH_END,this.OnMapTouchEnd,thise;this.clickBg.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnMapTouchTap,thise;leticonObj=this.GetSelectIconde;ifdiconObj==nullereturn;this.EndDragdee;}privatefirstNode:ECS.NodePoint;privateline:egret.Shape;privateOnTestdnode:ECS.NodePointe{ifd!GameData.EditorModeereturn;letcellSize=MathConst.MapCellSize;ifdnode==nullereturn;ifdthis.firstNode==nulle{this.firstNode=node;fordletx=0;xaMathConst.GridCountX;x++e{fordlety=0;yaMathConst.GridCountY;y++e{lettempNode=ECSC.RenderWarUtil.GetWarContainerde.GetNodedx*cellSize,y*cellSize,LandType.Lande;ifdtempNode!=nulle{cctempNode.removeAllHerode;ECSC.RenderWarUtil.GetWarContainerde.RefreshGridColordtempNode.x,tempNode.ye;}}}return;}letsx=this.firstNode.x*cellSize+cellSizec2;letsy=this.firstNode.y*cellSize+cellSizec2;letex=node.x*cellSize+cellSizec2;letey=node.y*cellSize+cellSizec2;ifdthis.line==nulle{this.line=newegret.Shapede;ECSC.RenderWarUtil.GetWarMapde.addChilddthis.linee;}letgraphics=this.line.graphics;graphics.clearde;graphics.lineStyled1,0xff0000e;graphics.moveTodsx,sye;graphics.lineTodex,eye;graphics.endFillde;this.firstNode.removeAllHerode;node.removeAllHerode;ECSC.RenderWarUtil.GetWarContainerde.RefreshGridColordthis.firstNode.x,this.firstNode.ye;ECSC.RenderWarUtil.GetWarContainerde.RefreshGridColordnode.x,node.ye;this.firstNode=null;letcontainerObj=ECSC.RenderWarUtil.GetWarContainerde;containerObj.SetStartEndPosdsx,sy,ex,ey,LandType.Lande;fordleti=0;ia100;i++econtainerObj.FindPathdLandType.Land,[]e;lett11=newDatede.getTimede;fordleti=0;ia100;i++e{containerObj.SetStartEndPosdsx,sy,ex,ey,LandType.Lande;containerObj.FindPathdLandType.Land,[]e;}lett12=newDatede.getTimede;lett21=newDatede.getTimede;fordleti=0;ia100;i++e{containerObj.SetStartEndPosdsx,sy,ex,ey,LandType.Lande;containerObj.FindPathdLandType.Land,[]e;}lett22=newDatede.getTimede;lett31=newDatede.getTimede;fordleti=0;ia100;i++e{containerObj.SetStartEndPosdsx,sy,ex,ey,LandType.Lande;containerObj.FindPathdLandType.Land,[]e;}lett32=newDatede.getTimede;lett41=newDatede.getTimede;fordleti=0;ia1000;i++e{containerObj.SetStartEndPosdsx,sy,ex,ey,LandType.Lande;containerObj.FindPathdLandType.Land,[]e;}lett42=newDatede.getTimede;TipsManager.ShowTipsd`消耗t1：${t12-t11}消耗t2：${t22-t21}消耗t3：${t32-t31}消耗t4：${t42-t11}`,0,null,5000e;game.logd`消耗t1：${t12-t11}消耗t2：${t22-t21}消耗t3：${t32-t31}消耗t4：${t42-t11}`e;ccletnodeArray=ECSC.RenderWarUtil.GetWarContainerde.GetGriddLandType.Lande.GetCollideNodeArrayde;ccfordleti=0;ia100;i++ecc{ccfordlettempNodeofnodeArrayecc{ccletret=tempNode.isLineCrossdsx,sy,ex,eyeccccgame.logdrete;ccifdreteccECSC.RenderWarUtil.GetWarContainerde.RefreshGridColordtempNode.x,tempNode.y,0x00ff00e;cc}cc}ccfordletx=0;xaMathConst.GridCountX;x++ecc{ccfordlety=0;yaMathConst.GridCountY;y++ecc{cclettempNode=ECSC.RenderWarUtil.GetWarContainerde.GetNodedx*cellSize,y*cellSize,LandType.Lande;ccifdtempNode!=nullecc{ccletret=tempNode.isLineCrossdsx,sy,ex,eyeccccifdreteccccECSC.RenderWarUtil.GetWarContainerde.RefreshGridColordtempNode.x,tempNode.y,0x00ff00e;cc}cc}cc}}privateOnMapTouchTapde:egret.TouchEvente{this.stage.removeEventListenerdegret.TouchEvent.TOUCH_MOVE,this.OnMapTouchMove,thise;this.stage.removeEventListenerdegret.TouchEvent.TOUCH_END,this.OnMapTouchEnd,thise;letpos1=GameConfig.GetLocalPosByStagePosde.stageX,e.stageYe;letpos=ECSC.RenderWarUtil.ConvertToWarPosdpos1[0],pos1[1]e;letx=pos[0];lety=pos[1];ccECSC.RenderWarUtil.GetRenderHeroManagerde.TestFuncde;ccifdx!=0eccreturn;ccifdxb0||yb0ecc{ccletdataArray:any[]=[cc["EnterAni_TopLeftStartTime","左上延迟时间",WarData.EnterAni_TopLeftStartTime],cc["EnterAni_TopLeftMoveTime","左上持续时间",WarData.EnterAni_TopLeftMoveTime],cc["EnterAni_TopRightStartTime","右上延迟时间",WarData.EnterAni_TopRightStartTime],cc["EnterAni_TopRightMoveTime","右上持续时间",WarData.EnterAni_TopRightMoveTime],cc["EnterAni_TopCenterStartTime","中上延迟时间",WarData.EnterAni_TopCenterStartTime],cc["EnterAni_TopCenterMoveTime","中上持续时间",WarData.EnterAni_TopCenterMoveTime],cc["EnterAni_BottomStartTime","中下延迟时间",WarData.EnterAni_BottomStartTime],cc["EnterAni_BottomMoveTime","中上持续时间",WarData.EnterAni_BottomMoveTime],cc["EnterAni_MapStartTime","地图延迟时间",WarData.EnterAni_MapStartTime],cc["EnterAni_MapMoveTime","地图持续时间",WarData.EnterAni_MapMoveTime]cc];ccUIManager.HidePaneldPanelTypeConst.TestWare;ccUIManager.ShowPaneldPanelTypeConst.TestWar,[2,dataArray]e;ccreturn;cc}letendNp:ECS.NodePoint=ECSC.RenderWarUtil.GetWarContainerde.GetNodedx,y,1e;ifdendNp!=nulle{ifd!GameData.EditorModee{ifdendNp.heroInfo.sizeb0e{letkeys=endNp.heroInfo.keysde;fordletkeyofkeyse{ifdkeya0econtinue;ccletentity=ECSC.RenderWorld.GetInstancede.GetEntitydkeye;ccUIManager.ShowPaneldPanelTypeConst.TestWar,[1,entity]e;ccLogicWorld.GetInstancede.RemoveEntitydentitye;}}}else{letcellSize=MathConst.MapCellSize;ifdGameData.EditorCollideType==1ecc完成{letcollideInfo:any={};fordleti=0;iaMathConst.GridCountX;i++e{fordletj=0;jaMathConst.GridCountY;j++e{letnode:ECS.NodePoint=ECSC.RenderWarUtil.GetWarContainerde.GetNodedi*cellSize,j*cellSize,1e;ifd!node.walkablee{letindex=i*MathConst.GridCountY+j;letkeys=node.heroInfo.keysde;lettype=keys[0];ifdtypeb100e{lettowerComp=aECSC.TowerComponentbECSC.RenderWarUtil.GetCompByIDdtype,RenderComponentType.TowerComponente;type=towerComp.towerPos;}ifdcollideInfo[type]==nullecollideInfo[type]=[];collideInfo[type].pushd[i,j]e;}}}game.logdJsonData.getJsonStringdcollideInfoee;return;}else{ifdendNp.heroInfo.size==0e{ifdGameData.EditorCollideType==100ecc普通障碍物endNp.addHerodGameData.EditorCollideTypee;elsecc防御塔{endNp.addHerodGameData.EditorCollideTypee;endNp.addHerodGameData.EditorCollideType+1000e;}}elseendNp.heroInfo.clearde;endNp.walkable=dendNp.heroInfo.size==0e;x=Math.floordxccellSizee;y=Math.floordyccellSizee;ECSC.RenderWarUtil.GetWarContainerde.RefreshGridColordx,ye;}}this.OnTestdendNpe;}this.EndDragdnulle;}privatedragCardId:number=0;privatedragHeroData:CardDataItem;publicisWaitAddCard:boolean=false;cc是否在等待释放卡牌d卡牌还差0.5法力eccprivatecardID:number;publicDestroyDragHerode{ifdthis.dragCardId!=0e{ECSC.DeployCardMgr.GetInstancede.RemoveCarddthis.dragCardIde;this.dragCardId=0;}}ccprivateSetDragHeroWaitDestroydindex:numberecc{ccifdthis.dragHeroObj!=nullecc{ccletheroObj=this.dragHeroObj;ccheroObj["deploy_index"]=index;ccheroObj["deploy_id"]=this.dragHeroData.id;ccheroObj["deploy_destroyTime"]=egret.getTimerde+2000;ccthis.waitDestroyDragHeros.pushdheroObje;ccthis.dragHeroObj=null;ccthis.dragHeroData=null;cc}cc}ccprivateCheckDragHeroDestroydplayerComp:ECSC.RealPlayerComponent,forceDestroy:booleanecc{ccifdthis.waitDestroyDragHeros.length==0eccreturn;ccletdestroyHeros:ECSC.PreviewCard[]=[];ccletleftHeros:ECSC.PreviewCard[]=[];ccfordletheroObjofthis.waitDestroyDragHerosecc{ccifdforceDestroyecc{ccdestroyHeros.pushdheroObje;cccontinue;cc}ccletindex=heroObj["deploy_index"];ccifdindex==nullecc{ccdestroyHeros.pushdheroObje;cccontinue;cc}ccletdestroyTime=heroObj["deploy_destroyTime"];ccifddestroyTime==nulleccdestroyTime=0;ccifdegret.getTimerdeb=destroyTimeecc{ccdestroyHeros.pushdheroObje;cccontinue;cc}ccletheroIconData=playerComp.GetHeroIconDatadindexe;ccifdheroIconData==nullecc{ccdestroyHeros.pushdheroObje;cccontinue;cc}ccifdheroIconData.iconType==2ecc{ccdestroyHeros.pushdheroObje;cccontinue;cc}ccleftHeros.pushdheroObje;cc}ccfordletheroObjofdestroyHerosecc{ccECS.WarFactory.DestroyObjectdheroObj,ObjectType.PreviewCard,heroObj["deploy_id"]e;cc}ccthis.waitDestroyDragHeros=leftHeros;cc}privateGetDragHerode:ECSC.PreviewCard{leticonObj=this.GetSelectIconde;ifdiconObj==nullereturnnull;ifdthis.dragCardId==0e{letplayerComp=this.GetPlayerCompde;ifdplayerComp==nulle{game.errord"UnitTool.GetDragHeroplayerComp==null"e;returnnull;}this.dragHeroData=iconObj.heroData;letcardID=this.dragCardId=ECS.PlayerInputData.GetCmdID_SelfdplayerCompe;letcardObj:ECSC.PreviewCard=ECSC.DeployCardMgr.GetInstancede.GetCarddcardID,this.dragHeroData.id,playerCompe;cardObj.InitRenderdthis.dragHeroData,playerCompe;cardObj.ShowDeployAnimation0de;this.UpdateDragHeroInfode;returncardObj;}else{returnECSC.DeployCardMgr.GetInstancede.GetCarddthis.dragCardId,null,nulle;}}privateGetPlayerCompde:ECSC.RealPlayerComponent{letworldObj=ECSC.RenderWorld.GetInstancede;letplayerComp=aECSC.RealPlayerComponentbworldObj.GetCompByIDdthis.playerId,RenderComponentType.RealPlayerComponente;returnplayerComp;}privateUpdateDragHeroInfode{letplayerComp=this.GetPlayerCompde;ifdplayerComp==nulle{this.DestroyDragHerode;leticonObj=this.GetSelectIconde;ifdiconObj!=nulleiconObj.ResetIcondtruee;return;}ccleticonObj=this.GetSelectIconde;ccifdiconObj==null&&this.dragCardId!=0ecc{ccthis.DestroyDragHerode;ccthis.OnMapTouchEnddnulle;ccGroup.DisposeIconde;ccreturn;cc}ifdthis.dragCardId==0e{ifdthis.isWaitAddCarde{game.errord"UnitToolisWaitAddCardandthis.dragCardId==0"e;this.EndDragdnulle;}return;}letdragHero=this.GetDragHerode;ifddragHero!=nulle{letnowEnergy=playerComp.GetEnergyPrecisede;letneedEnergy=this.dragHeroData.cost;nowEnergy=Math.floordnowEnergye;nowEnergy=ECSC.RenderWarUtil.GetShowEnergydnowEnergye;needEnergy=ECSC.RenderWarUtil.GetShowEnergydneedEnergye;dragHero.UpdateDeployInfodthis.dragHeroData.name,this.dragHeroData.lv,needEnergy,nowEnergye;}ifdthis.isWaitAddCardecc正在等放置卡牌中每次都尝试放置一次{this.EndDragdnulle;}}privateUpdateTouchPosdx:number,y:numbere{leticonObj=this.GetSelectIconde;ifdiconObj==nulle{return;}letmapStartX=MathConst.MapPosX;letmapStartY=MathConst.MapPosY;letmapEndX=mapStartX+MathConst.GridCountX*MathConst.MapCellSize;letmapEndY=mapStartY+MathConst.GridCountY*MathConst.MapCellSize;ccconsole.logdx,y,"---------UpdateTouchPos---------bbbbbbbbbbbbbbbbbbbbbbb"e;ifdxamapStartX+1ex=mapStartX+1;ifdxbmapEndX-1ex=mapEndX-1;ifdyamapStartY+1ey=mapStartY+1;ifdxb=mapStartX&&xa=mapEndX&&yb=mapStartY&&ya=mapEndYe{letlocalX=x;letlocalY=y;iconObj.root.visible=false;letdragHero=this.GetDragHerode;dragHero.SetVisibledtruee;letoldTime:number=egret.getTimerde;letpos=ECSC.RenderWarUtil.ConvertToWarPosdx,ye;x=pos[0];y=pos[1];letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ifdwarComp.IsReversePosdeecc我如果是防守方需要反转坐标{x=MathConst.MapPosMaxX-x;y=MathConst.MapPosMaxY-y;}letmyAtkType=warComp.myAtkType;letputType=this.dragHeroData.putType;letcontainerObj=ECSC.RenderWarUtil.GetWarContainerde;ifdECSC.RenderWarUtil.IsSelfAreadputTypee&&containerObj.IsInEnemyLockAreadx,y,myAtkType,MathConst.MapCellSizeeb0e{letputPos=containerObj.GetValidPutPosdx,y,myAtkTypee;x=putPos[0];y=putPos[1];}pos=containerObj.GetWalkablePosdx,y,this.dragHeroData.landType,putType,CampType.Friend,myAtkTypee;letnewTime:number=egret.getTimerde;ifdnewTime-oldTimeb2egame.logd"_______GetWalkablePos_timeout______",newTime-oldTimee;ifdpos==nulle{TipsManager.ShowTipsdLanUtil.GetFormatd`找不到合适的位置摆放英雄x:{0}y:{1}`,x.toFixedd0e,y.toFixedd0ee,1e;return;}x=pos[0];y=pos[1];letcellSize=MathConst.MapCellSize;x=Math.floordMath.floordxccellSizee*cellSize+cellSizec2e;y=Math.floordMath.floordyccellSizee*cellSize+cellSizec2e;this.validPutX=x;this.validPutY=y;dragHero.SetPosdx+0,y+0e;dragHero.UpdateRangedthis.dragHeroDatae;}else{letdragHero=this.GetDragHerode;dragHero.SetVisibledfalsee;dragHero.DisposeRangeEffectde;iconObj.root.visible=true;iconObj.root.x=this.iconStartPosX+dx-this.touchBeginPosXe;iconObj.root.y=this.iconStartPosY+dy-this.touchBeginPosYe;letpercent=dthis.touchBeginPosY-yec120;ifdpercentb1epercent=1;ifdpercenta0epercent=0;iconObj.root.scaleX=1-percent;iconObj.root.scaleY=1-percent;iconObj.root.alpha=1-percent;this.validPutX=0;this.validPutY=0;}}privateCheckNextCardde{letplayerComp=this.GetPlayerCompde;letnextShape=playerComp.nextHeroShape;ifdthis.nextIcon==null||this.nextIcon.shape!=nextShapee{ifdthis.nextIcon!=nulle{this.nextIcon.DestroyAllde;RenderUtils.RemoveFromParentdthis.nextIcone;this.nextIcon=null;}ifdnextShape!=nulle{this.nextIcon=newUnitIcond-1,nextShape,playerComp,thise;this.nextIcon.x=-180+3;this.nextIcon.y=35+2;ifdGameData.ReplayModee{ifdplayerComp.campType==CampType.Friende{this.nextIcon.x=-138;this.nextIcon.y=19;}else{this.nextIcon.x=523;this.nextIcon.y=19;}}this.nextIcon.scaleX=0.8;this.nextIcon.scaleY=0.8;this.nextIcon.touchEnabled=false;this.nextIcon.touchChildren=false;this.iconGroup.addChilddthis.nextIcone;}}}publicUpdatede{ifd!this.isCreateOverereturn;letplayerComp=this.GetPlayerCompde;ifdplayerComp==nullereturn;this.SetEnergydplayerComp.GetShowEnergydee;letnowTime=egret.getTimerde;ifdWarData.cardAniationStartTime==-1||nowTimeaWarData.cardAniationStartTimeecc还不可以播放卡牌上阵动画return;ccUI动画是否已经结束ifdnowTimea=this.nextUnitIconMoveTimeecc卡牌上阵动画还未结束return;fordletindex=0;indexaMathConst.MaxIconCount;index++e{letheroIconData=playerComp.GetHeroIconDatadindexe;ifdheroIconData==nullecontinue;leticonObj=this.iconInfo.getdindexe;ifdiconObj==null||heroIconData.iconType!=iconObj.iconType||heroIconData.shape!=iconObj.shape||heroIconData.uniqueId!=iconObj.uniqueIde{ifdheroIconData.iconType==1e{this.AddUnitIcondheroIconData.shape,index,heroIconData.uniqueIde;break;}elsethis.AddSkillIcondheroIconData.id,heroIconData.shape,index,heroIconData.uniqueIde;}}this.CheckNextCardde;this.UpdateDragHeroInfode;leticonArray=this.iconInfo.valuesde;fordleticonoficonArraye{icon.Updatede;}ifdthis.nextIcon!=nullethis.nextIcon.Updatede;}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassWarOverCextendsUICtrlBase{publicconstructorde{superde;}protectedGetResGroupde:string[]{return[];}protectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnWarOverPanel;}cc做一下类型转换方便调用一定要有!!!protectedgetwarOverPanelde{returnaWarOverPanelbthis.panel;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0,false,false,datae;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}}c***初始化面板ui*cpublicInitUIde:void{}c***初始化面板数据*cpublicInitDatade:void{}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{}}}﻿c****cmodulegame{exportclassWarOverPanelextendsUIComponentBase{publicroot:eui.Group;publicwinImg:eui.Image;publicvsImg:eui.Image;publiccupCount:eui.Label;publicokBtn:SButton;publicmidGroup:eui.Group;publiccupInfo:eui.Group;publicplayerArray:CommonPlayerInfo[];publicitemArray:CommonItem[];publicleftBg:eui.Image;publicrightBg:eui.Image;publicmidBg:eui.Image;publictopGroup:eui.Group;publicitemGroup:eui.Group;publicconstructorde{superd"WarOverSkin"e;this.playerArray=[];this.itemArray=[];}protectedchildrenCreatedde{super.childrenCreatedde;this.okBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnOKClick,thise;this.visible=false;}publicInitDataddatae{super.InitDataddatae;letserverRetInfo:WarResultInfo=data;cc我方敌方玩家信息letplayerDataArray:any[]=[];cc我方敌方击杀塔信息letkillDataArray:any[]=[];cc奖励信息letitemDataArray:any[]=serverRetInfo.rewardInfo;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;letmyAtkType=warComp.myAtkType;letwinAtkType=serverRetInfo.winAtkType;letatkTypeArray=[myAtkType,3-myAtkType];fordletatkTypeofatkTypeArraye{letplayerArray=warComp.GetPlayerByAtkTypedatkTypee;fordletplayerObjofplayerArraye{letcampType=atkType==myAtkType?0:1;letdata=[campType,playerObj.name,playerObj.familyName,playerObj.iconName,playerObj.edgeId,playerObj.cupCount];playerDataArray.pushddatae;}letkillCount=serverRetInfo.dieTowerInfo.getd3-atkTypee;killDataArray.pushdkillCounte;}game.logdmyAtkType,winAtkType,killDataArray,playerDataArray,"----S2CBattleRet--战斗结束-"e;this.ShowWinInfodmyAtkType,winAtkType,killDataArray,playerDataArraye;this.ShowPlayerInfodplayerDataArraye;this.ShowItemInfoditemDataArraye;this.ShowAnide;}privateDestroyPlayerInfode{fordletplayerObjofthis.playerArraye{this.root.removeChilddplayerObje;playerObj.DestroyAllde;}this.playerArray=[];}privateShowWinInfodmyAtkType:number,winAtkType:number,killDataArray:any[],dataArray:any[]e{ifdwinAtkType==myAtkTypeecc我方胜利{this.leftBg.source=RES.getResd"war_ui_common_json.bg_zdjs_sl03"e;this.rightBg.source=RES.getResd"war_ui_common_json.bg_zdjs_sb03"e;this.midBg.source=RES.getResd"war_ui_common_json.bg_zdjs_sl"e;this.winImg.source=RES.getResd"war_ui_common_json.bg_zdjs_sl02"e;}elsecc失败{this.leftBg.source=RES.getResd"war_ui_common_json.bg_zdjs_sb03"e;this.rightBg.source=RES.getResd"war_ui_common_json.bg_zdjs_sl03"e;this.midBg.source=RES.getResd"war_ui_common_json.bg_zdjs_sb"e;this.winImg.source=RES.getResd"war_ui_common_json.bg_zdjs_sb02"e;}ifddataArray.length==2e{ccthis.leftBg.height=132;ccthis.rightBg.height=132;this.midBg.height=130;this.topGroup.y=0;this.vsImg.y=214;}else{ccthis.leftBg.height=258;ccthis.rightBg.height=258;this.midBg.height=256;this.topGroup.y=-60;this.vsImg.y=295;}}privateShowPlayerInfoddataArray:any[]e{ifd!this.isCreateOvere{this.SetCreateOverCBdde=b{this.ShowPlayerInfoddataArraye;},thise;return;}letpos1v1Info=[[207,176],[652,176]];letpos2v2Info=[[207,176],[207,304],[652,176],[652,304]];this.DestroyPlayerInfode;letindex=0;fordletdataofdataArraye{letplayerObj:CommonPlayerInfo;ifddataArray.length==2e{playerObj=newCommonPlayerInfoddata[0]e;letpos=pos1v1Info[index];playerObj.x=pos[0];playerObj.y=pos[1];}else{playerObj=newCommonPlayerInfoddata[0]e;letpos=pos2v2Info[index];playerObj.x=pos[0];playerObj.y=pos[1];}ccplayerObj.scaleX=playerObj.scaleY=1.1;playerObj.SetWarOverDataddatae;this.topGroup.addChilddplayerObje;this.playerArray.pushdplayerObje;index++;}this.topGroup.sortableChildren=true;this.vsImg.zIndex=1000;}privateShowItemInfoditemArray:any[]e{ccletdataArray=DataUtil.GetRewardd13010e;ccitemArray=[];ccfordletdataofdataArrayecc{ccitemArray.pushd[data.itemid,data.count]e;cc}letitemObj:CommonItem;lety=38;letxStart=0;ifditemArray.length-1b=3exStart=128;elseifditemArray.length-1==2exStart=187;elsexStart=246;letx=xStart;fordletdataofitemArraye{letitemId=data[0];letitemCount=data[1];ifditemId==Protocol.PropertyEnum.CUPSe{ifditemCounta0e{this.cupCount.text=`-${-itemCount}`;}else{this.cupCount.text=`+${itemCount}`;}continue;}itemObj=newCommonItemd"WarOverRewardItemSkin"e;this.itemArray.pushditemObje;itemObj.x=x;itemObj.y=y;x+=118;this.itemGroup.addChildditemObje;itemObj.SetCreateOverCBdde=b{letobj=itemObj;obj["icon"].source=RES.getResdDataUtil.GetItemSourceditemIdee;obj["count"].text=itemCount.toStringde;},itemObje;}}publicShowAnide{game.UIManager.UpdateDatadPanelTypeConst.War,[200]e;game.UIManager.UpdateDatadPanelTypeConst.WarUI,[200]e;this.topGroup.visible=false;this.itemGroup.visible=false;this.midGroup.visible=false;this.okBtn.visible=false;letsceneDelayTime=1;cc场景动画时间letdelayTime=sceneDelayTime;lettweenObj=TweenInfo.Createde;delayTime+=0.2;tweenObj.DoActionddelayTime,de=b{this.visible=true;this.topGroup.visible=true;},thise;this.itemGroup.visible=true;fordletitemObjofthis.itemArraye{delayTime+=0.2;itemObj.alpha=0;tweenObj.DoTweenddelayTime,itemObj,0.2,{alpha:1}e;}delayTime+=0.2;tweenObj.DoActionddelayTime,de=b{this.midGroup.visible=true;this.okBtn.visible=true;},thise;ccdelayTime+=0.2;cctweenObj.DoActionddelayTime,de=b{cc},thise;tweenObj.Execde;}protectedOnCloseDlgde{super.OnCloseDlgde;SceneManager.GetInstancede.EnterHomede;}privateOnOKClickdevent:egret.TouchEvente:void{SceneManager.GetInstancede.EnterHomede;}protectedDestroyde{this.okBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.OnOKClick,thise;fordletplayerObjofthis.playerArraye{playerObj.DestroyAllde;}this.playerArray=[];fordletitemObjofthis.itemArraye{itemObj.DestroyAllde;}this.itemArray=[];}}}﻿c***背包面板*bydily*dcecopyright2014-2035*AllRightsReserved.*cmodulegame{exportclassWarUICextendsUICtrlBase{publicconstructorde{superde;}cc声明要实例化的EXML类一定要有!!!protectedGetPanelClassde:any{returnWarUIPanel;}cc做一下类型转换方便调用一定要有!!!protectedgetwarUIPanelde{returnaWarUIPanelbthis.panel;}protectedGetResGroupde:string[]{return[];}protectedGetParentde:any{returnGameLayerManager.gameLayerde.panelLayer;}publicOnMessageditype:number,data:anye:void{super.OnMessageditype,datae;ifditype==PanelMessageType.OnShowe{cc显示角色面板this.ShowUIdfalse,0,0,0e;}elseifditype==PanelMessageType.OnHidee{this.ClosePaneld1e;}elseifditype==PanelMessageType.OnDestroye{this.DestroyPanelde;}elseifditype==PanelMessageType.OnUpdateDatae{ifddata[0]==100e{this.warUIPanel.ShowStartAnimationde;return;}ifddata[0]==200e{this.warUIPanel.ShowEndAnimationde;return;}ifddata[0]==997e{this.warUIPanel.SetSelectEnergyddata[1],data[2]e;return;}ifddata[0]==996e{this.warUIPanel.ShowCostTipsInfode;return;}ifddata[0]==995ecc双倍圣水{this.warUIPanel.ShowSpeedUpTimeEffectde;return;}ifddata[0]==994ecc决战时刻{this.warUIPanel.ShowBurnTimeEffectde;return;}ifddata[0]==993ecc帧数刷新{this.warUIPanel.RefreshFrameInfoddata[1]e;return;}letwarUIPanel=this.warUIPanel;ifdwarUIPanel==nullereturn;warUIPanel.RefreshDataddatae;}}c***初始化面板ui*cpublicInitUIde:void{this.warUIPanel.closeBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.CloseButtonClick,thise;ifdGameData.ReplayMode||GameData.SpeedUpModee{this.warUIPanel.stopBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.CloseButtonClick,thise;this.warUIPanel.speedBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.SpeedButtonClick,thise;this.warUIPanel.jumpBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.JumpButtonClick,thise;this.warUIPanel.pauseBtn.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.PauseButtonClick,thise;}}c***初始化面板数据*cpublicInitDatade:void{letworldObj=ECSC.RenderWarUtil.GetWorldObjde;ifdGameData.ReplayMode&&worldObj!=nulle{this.warUIPanel.totalFrame.text=LanUtil.GetFormatd`帧数:{0}`,worldObj.maxFrameCounte;this.warUIPanel.jumpFrame.text="0";}}cc释放函数一定要有!!!cc所有创建的东西一定要记得释放protectedDestroyde{this.warUIPanel.stopBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.CloseButtonClick,thise;this.warUIPanel.closeBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.CloseButtonClick,thise;this.warUIPanel.speedBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.SpeedButtonClick,thise;this.warUIPanel.pauseBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.PauseButtonClick,thise;this.warUIPanel.jumpBtn.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.JumpButtonClick,thise;}privateSpeedButtonClickdevent:egret.TouchEvente:void{letpreData=ECS.RenderShareDataMgr.GetInstancede.preData;preData.updateSpeed*=2;ifdpreData.updateSpeedb4epreData.updateSpeed=0.5;this.SetUpdateSpeeddpreData.updateSpeede;}privateSetUpdateSpeeddspeed:numbere{ECSC.CNetWar.RefreshPreShareDatad"updateSpeed",speede;ifdspeed==0.5ethis.warUIPanel.speedImg.source=RES.getResd"war_ui_tv_json.button_tv_bfsd01"e;elseifdspeed==1ethis.warUIPanel.speedImg.source=RES.getResd"war_ui_tv_json.button_tv_bfsd02"e;elseifdspeed==2ethis.warUIPanel.speedImg.source=RES.getResd"war_ui_tv_json.button_tv_bfsd03"e;elseifdspeed==4ethis.warUIPanel.speedImg.source=RES.getResd"war_ui_tv_json.button_tv_bfsd04"e;}privateJumpButtonClickdevent:egret.TouchEvente:void{letframe=Numberdthis.warUIPanel.jumpFrame.texte;letworldObj=ECSC.RenderWarUtil.GetWorldObjde;ifdframeaworldObj.frameCount||framebworldObj.maxFrameCounte{TipsManager.ShowTipsdLanUtil.GetTextd"跳转帧只能处在当前帧和最大帧之间"e,1e;return;}letframeDiff=frame-worldObj.frameCount;MathConst.JumpTargetFrame=frame;this.SetUpdateSpeedd1e;ifd!worldObj.isStarte{this.PauseButtonClickdnulle;}let_tthat=this;letstartTime=newDatede.getTimede;functionOnJumpFrameOverde{worldObj.Loopd1e;cc渲染层刷新一下worldObj.ForceSysncRenderPosde;GlobalEvent.UnSubscribedGlobalEventType.JumpFrameOver,OnJumpFrameOver,_tthate;_tthat.SetUpdateSpeedd1e;letendTime=newDatede.getTimede;letpassTime=endTime-startTime;game.logd"----------跳转完成消耗时间：",passTimee;}GlobalEvent.SubscribedGlobalEventType.JumpFrameOver,OnJumpFrameOver,thise;}private_pause:boolean=false;privatePauseButtonClickdevent:egret.TouchEvente:void{ccSceneManager.GetInstancede.EnterHomede;letpreData=ECS.RenderShareDataMgr.GetInstancede.preData;letisStart=!preData.isStart;ECSC.CNetWar.RefreshPreShareDatad"isStart",isStarte;ifdisStartethis.warUIPanel.pauseImg.source=RES.getResd"war_ui_tv_json.button_tv_zt"e;elsethis.warUIPanel.pauseImg.source=RES.getResd"war_ui_tv_json.button_tv_bf"e;ccShakeTools.GetInstancede.ShakeScreendGameLayerManager.gameLayerde.sceneLayere;}privateCloseButtonClickdevent:egret.TouchEvente:void{letretInfo=newWarResultInfode;retInfo.winAtkType=AtkType.Attack;ClientNet.NetWar.C2SBattleEnddretInfoe;}}}﻿c****cmodulegame{exportclassWarUIPanelextendsUIComponentBase{publicroot:eui.Group;publictime:eui.BitmapLabel;publicclientFrame:eui.Label;publicserverFrame:eui.Label;cccc能量信息开始ccpublicenergyBg0:eui.Image;ccpublicenergyBg1:eui.Image;ccpublicenergyBg2:eui.Image;ccpublicenergyBg3:eui.Image;ccpublicenergyBg4:eui.Image;ccpublicenergyBg5:eui.Image;ccpublicselectBg:eui.Image;ccpublicfullTips:eui.Image;ccpublicenergyCount:eui.BitmapLabel;cccc能量信息结束publiccostTipsInfo:eui.Group;ccpublicchatGroup:eui.Group;publicconstructorde{superd"WarUISkin"e;}publiccloseBtn:SButton;publicunitToolArray:UnitTool[]=[];ccroleInfopublicroleInfo:eui.Group;publicmyRoleInfo:eui.Group;publictargetRoleInfo:eui.Group;publictargetRoleInfo_nolimit:eui.Group;publictimeGroup:eui.Group;publicbottomGroup:eui.Group;publicmaskGroup:eui.Group;publicwarStartTips:eui.Image;cc编辑器publiceditor:eui.Group;publictower10:eui.Button;publictower11:eui.Button;publictower12:eui.Button;publictower20:eui.Button;publictower21:eui.Button;publictower22:eui.Button;publiccollide:eui.Button;publiccomplete:eui.Button;ccreplaypublicreplayGroup:eui.Group;publicreplayGroup2:eui.Group;publicreplayLeftGroup:eui.Group;publicstopBtn:SGroup;publicpauseBtn:SGroup;publicpauseImg:eui.Image;publicspeedBtn:SGroup;publicspeedImg:eui.Image;publicjumpBtn:SButton;publicjumpFrame:SInputLabel;publictotalFrame:eui.Label;privateplayerArray:WarPlayerInfo[];protectedchildrenCreatedde{super.childrenCreatedde;this.unitToolArray=[];letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;letmyFightRoleId=warComp.myFightRoleId;ifdGameData.ReplayModee{letentityArray=warComp.GetPlayerListde;letmyIdArray:number[]=[];lettargetIdArray:number[]=[];fordletentityofentityArraye{letplayerComp=aECSC.RealPlayerComponentbentity.GetCompdComponentType.RealPlayerComponente;ifdplayerComp!=null&&playerComp.campType==CampType.Friende{myIdArray.pushdentity.ide;}else{targetIdArray.pushdentity.ide;}}letindex=0;fordletroleIdofmyIdArraye{letunitTool=newUnitToold"WarBottomReplay01Skin",roleIde;unitTool.y=-index*100;this.bottomGroup.addChilddunitToole;this.unitToolArray.pushdunitToole;index++;}index=0;fordletroleIdoftargetIdArraye{letunitTool=newUnitToold"WarBottomReplay02Skin",roleIde;unitTool.y=-index*100;this.bottomGroup.addChilddunitToole;this.unitToolArray.pushdunitToole;index++;}}else{fordleti=0;ia1;i++e{letunitTool=newUnitToold"WarBottomNormalSkin",myFightRoleIde;this.bottomGroup.addChilddunitToole;this.unitToolArray.pushdunitToole;}}this.ShowReplayLeftGroupdtruee;this.replayGroup.touchEnabled=GameData.ReplayMode;this.AddTouchEventdthis.replayGroup,de=b{this.ShowReplayLeftGroupd!this.showReplayLefte;},thise;this.editor.visible=GameData.EditorMode;ifdGameData.EditorModee{this.tower10.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.Tower10Click,thise;this.tower11.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.Tower11Click,thise;this.tower12.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.Tower12Click,thise;this.tower20.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.Tower20Click,thise;this.tower21.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.Tower21Click,thise;this.tower22.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.Tower22Click,thise;this.collide.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.CollideClick,thise;this.complete.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.CompleteClick,thise;}this.replayGroup.visible=GameData.ReplayMode||GameData.SpeedUpMode;this.replayGroup2.visible=GameData.ReplayMode||GameData.SpeedUpMode;this.clientFrame.visible=dGameData.DevelopModeb=DevelopMode.Debuge;this.serverFrame.visible=dGameData.DevelopModeb=DevelopMode.Debuge;this.closeBtn.visible=dGameData.DevelopModeb=DevelopMode.Debuge;this.InitPosInfode;this.InitVisiableInfode;this.InitPlayerInfode;this.roleInfo.cacheAsBitmap=true;}privatedelayHideReplayTimer:number;privateshowReplayLeft:boolean;privateShowReplayLeftGroupdshow:booleane{this.showReplayLeft=show;lettargetX=show?-2:-100;TweenLite.killTweensOfdthis.replayLeftGroupe;TweenLite.todthis.replayLeftGroup,0.2,{x:targetX}e;TimerMgr.GetInstancede.RemoveTimerdthis.delayHideReplayTimere;ifd!showereturn;this.delayHideReplayTimer=TimerMgr.GetInstancede.AddTimerd3000,de=b{this.ShowReplayLeftGroupdfalsee;returnfalse;},thise;}privateDestroyAllPlayerde{ifdthis.playerArray==nulle{this.playerArray=[];return;}fordletplayerObjofthis.playerArraye{RenderUtils.RemoveFromParentdplayerObje;playerObj.DestroyAllde;}this.playerArray=[];}publicInitPlayerInfode{this.DestroyAllPlayerde;letwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;letis2v2:boolean=warComp.pvpType==PVPType.VS_2_2;letplayerDataArray=warComp.GetAllPlayerDatade.valuesde;playerDataArray.sortdda,be=b{ifda.posTypebb.posTypeereturn1;elsereturn-1;}eletpos1v1Info=[[-10,-5],[18,-5]];letpos2v2Info=[[-10,-5],[260,-5],[18,-5],[-245,-5]];letindex=0;fordletplayerDataofplayerDataArraye{letplayerObj:WarPlayerInfo;let_data:any=[0,playerData.name,playerData.familyName,playerData.iconName,playerData.edgeId,playerData.cupCount];letenemyType:number;ifd!is2v2e{enemyType=index;playerObj=newWarPlayerInfodenemyTypee;letpos=pos1v1Info[index];playerObj.x=pos[0];playerObj.y=pos[1];}else{enemyType=Math.floordindexc2e;playerObj=newWarPlayerInfodenemyTypee;letpos=pos2v2Info[index];playerObj.x=pos[0];playerObj.y=pos[1];}playerObj.SetWarUIDatad_datae;ifdenemyType==0ethis.myRoleInfo.addChilddplayerObje;elsethis.targetRoleInfo_nolimit.addChilddplayerObje;this.playerArray.pushdplayerObje;index++;}this.myRoleInfo.scaleX=this.myRoleInfo.scaleY=is2v2?0.8:0.9;this.targetRoleInfo.scaleX=this.targetRoleInfo.scaleY=is2v2?0.8:0.9;}cccc能量的动画效果ccprivateeasyEnergy:number=0;ccpublicsetenergyAniPercentdnum:numberecc{ccthis.easyEnergy=num;ccletwidth=Math.mind652,62.8+65.8*dnum-1ee;ccifdwidtha0eccwidth=0;ccthis.energyBg2.width=width;ccccRenderUtils.UpdateCircleMaskdthis.energyBg2,num,falsee;cc}ccpublicgetenergyAniPercentde:numbercc{ccreturnthis.easyEnergy;cc}ccprivateSetCostAnimationIndexdindex:number,num:numberecc{ccccifdindex==1||index==4eccccRenderUtils.UpdateCircleMaskdthis.energyBg3,num*10,falsee;ccccelseifdindex==2||index==5eccccRenderUtils.UpdateCircleMaskdthis.energyBg4,num*10,falsee;ccccelseifdindex==3eccccRenderUtils.UpdateCircleMaskdthis.energyBg5,num*10,falsee;ccletwidth=Math.mind652,62.8+65.8*dnum-1ee;ccthis.energyBg3.width=width;ccthis.energyBg4.width=width;ccthis.energyBg5.width=width;ccthis.energyBg3.visible=dindex==1||index==4e;ccthis.energyBg4.visible=dindex==2||index==5e;ccthis.energyBg5.visible=dindex==3e;cc}ccprivatenowEnergy:number=-1;ccprivatetimerKey:number=0;ccprivatetweenObj:TweenInfo;ccprivateDestroyTweenObjdecc{ccifdthis.tweenObj!=nulleccthis.tweenObj.Destroyde;ccthis.tweenObj=null;cc}ccpublicSetEnergydnum:numberecc{ccccgame.logd"-------SetEnergy-------------bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb",nume;ccletfloorNum=Math.floordnume;ccifdthis.nowEnergy!=floorNumecc{ccthis.DestroyTweenObjde;ccifdthis.nowEnergyafloorNumecc能量增加cc{ccTweenLite.todthis,0.2,{energyAniPercent:floorNum,ease:Back.easeOut}e.kill;ccifdfloorNumb=10ecc{ccthis.fullTips.alpha=0;ccthis.tweenObj=TweenInfo.Createde;ccthis.tweenObj.Adddthis.fullTips,0.2,{alpha:1,ease:Back.easeOut}ecc.Delayd1ecc.Adddthis.fullTips,0.2,{alpha:0}ecc.Execde;ccccTweenLite.todthis.fullTips,0.2,{alpha:1,ease:Back.easeOut}e.kill;cc}ccelsecc{ccthis.fullTips.alpha=0;cc}cc}ccelsecc能量减少cc{ccletdiffEnergy:number=this.nowEnergy-floorNum;ccTweenLite.todthis,0.2,{energyAniPercent:floorNum,ease:Back.easeOut,onComplete:de=b{ccletindex=0;ccTimerMgr.GetInstancede.RemoveTimerdthis.timerKeye;ccthis.timerKey=TimerMgr.GetInstancede.AddTimerd100,de=b{ccindex++;ccthis.SetCostAnimationIndexdindex,diffEnergye;ccreturnindexa=5;cc}e;cc}}e.kill;ccthis.fullTips.alpha=0;cc}ccthis.nowEnergy=floorNum;cc}ccifdthis.nowEnergy==floorNum&&this.nowEnergy==0eccthis.energyAniPercent=0;ccifdnuma10eccthis.energyCount.text=Math.floordnume.toStringde;ccMath.floordnume.toStringde;ccelseccthis.energyCount.text="a";ccletwidth=Math.mind652,62.8+65.8*dnum-1ee;ccifdwidtha0eccwidth=0;ccthis.energyBg1.width=width;ccccRenderUtils.UpdateCircleMaskdthis.energyBg1,num*10,falsee;ccccRenderUtils.UpdateCircleMaskdthis.energyBg3,Math.floordnume*10+5,falsee;ccccRenderUtils.UpdateCircleMaskdthis.energyBg2,Math.floordnume*10,falsee;cc}publicSetSelectEnergydselected:boolean,num:numbere{fordletunitToolofthis.unitToolArrayeunitTool.SetSelectEnergydselected,nume;ccthis.selectBg.visible=selected&&numb0;ccthis.selectBg.width=70+dnum-1e*65.8;}publicShowCostTipsInfode{this.costTipsInfo.alpha=0.5;this.costTipsInfo.x=0;this.costTipsInfo.y=300;TweenLite.killTweensOfdthis.costTipsInfoe;TweenLite.todthis.costTipsInfo,2,{y:290,ease:Back.easeOut}e;TweenLite.todthis.costTipsInfo,1,{alpha:1,ease:Back.easeOut}e;TweenLite.delayedCalld1,de=b{TweenLite.todthis.costTipsInfo,1,{alpha:0,ease:Back.easeOut}e;}e;}publicRefreshDataddatae{letstartLeftTime=Math.floorddata.startLeftTimec1000+0.4e;letendLeftTime:number=data.endLeftTime;lettimeStr:string;ifdstartLeftTimeb0||isNaNddata.startLeftTimeee{timeStr=`3：00`;this.time.tint=0xffffff;cctimeStr=`${startLeftTime}秒后开始游戏`;}else{endLeftTime=Math.floordendLeftTimee;ifdendLeftTimea=30e{timeStr=endLeftTime.toStringde;ifdendLeftTime%2==0ethis.time.tint=0xffffff;elsethis.time.tint=0xff0000;}else{timeStr=MathUtil.time_format_mindendLeftTimee;this.time.tint=0xffffff;}}this.time.text=timeStr;this.timeGroup.visible=endLeftTimeb0;this.clientFrame.text=LanUtil.GetFormatd'客户端帧：{0}服务器帧：{1}',data.cframe,data.sframeeletwarComp=aECSC.WarComponentbECSC.RenderWarUtil.GetSingletonCompdRenderComponentType.WarComponente;ccletworldObj=ECSC.RenderWorld.GetInstancede;this.serverFrame.text=LanUtil.GetFormatd'逻辑帧：{0}-{1}\n渲染帧：{2}-{3}',warComp.logicFrame,warComp.logicServerTime%10000,warComp.renderFrame,warComp.renderServerTime%10000e;ccthis.clientFrame.text=LanUtil.GetTextd"客户端帧:"e+data.cframe;ccthis.serverFrame.text=LanUtil.GetTextd"服务器帧:"e+data.sframe;ccthis.SetEnergyddata.energye;this.Updatede;}publicRefreshFrameInfoddata:anye{this.clientFrame.text=LanUtil.GetTextd"客户端帧:"e+data.cframe;this.serverFrame.text=LanUtil.GetTextd"服务器帧:"e+data.sframe;}publicInitPosInfode{this.myRoleInfo.x=-300;this.targetRoleInfo_nolimit.x=345;ccthis.timeGroup.y=-55;this.timeGroup.alpha=0;this.myRoleInfo.alpha=0;this.targetRoleInfo_nolimit.alpha=0;this.bottomGroup.y=720;this.warStartTips.alpha=1;this.warStartTips.scaleX=this.warStartTips.scaleY=0.6;}publicInitVisiableInfode{ccthis.maskGroup.visible=!GameData.EditorMode;ccthis.selectBg.visible=false;ccthis.energyBg3.visible=false;ccthis.energyBg4.visible=false;ccthis.energyBg5.visible=false;this.warStartTips.visible=true;this.warStartTips.alpha=0;this.costTipsInfo.alpha=0;ccthis.fullTips.alpha=0;ccthis.fullTips.visible=true;}publicShowStartAnimationde{ifd!this.isCreateOvere{this.SetCreateOverCBdde=b{this.ShowStartAnimationde;},thise;return;}this.myRoleInfo.x=-300;this.myRoleInfo.alpha=0;TweenLite.delayedCalldWarData.EnterAni_TopLeftStartTime,de=b{TweenLite.todthis.myRoleInfo,WarData.EnterAni_TopLeftMoveTime,{x:11,alpha:1,ease:Power2.easeIn}e.kill;}e;this.targetRoleInfo_nolimit.x=345;this.targetRoleInfo_nolimit.alpha=0;TweenLite.delayedCalldWarData.EnterAni_TopRightStartTime,de=b{ccthis.targetRoleInfo.includeInLayout=false;TweenLite.todthis.targetRoleInfo_nolimit,WarData.EnterAni_TopRightMoveTime,{x:0,alpha:1,ease:Power2.easeIn}e.kill;}e;this.timeGroup.alpha=0;TweenLite.delayedCalldWarData.EnterAni_TopCenterStartTime,de=b{TweenLite.todthis.timeGroup,WarData.EnterAni_TopCenterMoveTime,{alpha:1,ease:Power2.easeIn}e.kill;}e;this.bottomGroup.y=750;TweenLite.delayedCalldWarData.EnterAni_BottomStartTime,de=b{TweenLite.todthis.bottomGroup,WarData.EnterAni_BottomMoveTime,{y:575,ease:Power2.easeIn}e.kill;}e;this.warStartTips.alpha=1;this.warStartTips.scaleX=this.warStartTips.scaleY=0.6;TweenLite.delayedCalld2,de=b{TweenLite.todthis.warStartTips,1,{scaleX:0,scaleY:0,alpha:0,ease:Power0.easeIn}e.kill;}e;TweenLite.delayedCalld0.5,de=b{TweenLite.todthis.warStartTips,0.5,{scaleX:1,scaleY:1,alpha:1,ease:Power0.easeIn}e.kill;}e;TweenLite.delayedCalld0.5,de=b{TweenLite.todthis.warStartTips,0.5,{scaleX:1.2,scaleY:1.2,alpha:0,ease:Power0.easeIn}e.kill;}e;}publicShowEndAnimationde{ifd!this.isCreateOvere{this.SetCreateOverCBdde=b{this.ShowStartAnimationde;},thise;return;}this.myRoleInfo.x=11;this.myRoleInfo.alpha=1;TweenLite.delayedCalldWarData.EnterAni_TopLeftStartTime,de=b{TweenLite.todthis.myRoleInfo,WarData.EnterAni_TopLeftMoveTime,{x:-300,alpha:0,ease:Power2.easeIn}e.kill;}e;this.targetRoleInfo_nolimit.x=0;this.targetRoleInfo_nolimit.alpha=1;TweenLite.delayedCalldWarData.EnterAni_TopRightStartTime,de=b{ccthis.targetRoleInfo.includeInLayout=false;TweenLite.todthis.targetRoleInfo_nolimit,WarData.EnterAni_TopRightMoveTime,{x:345,alpha:0,ease:Power2.easeIn}e.kill;}e;ccthis.timeGroup.alpha=0;cc透明度有可能本来就是0TweenLite.delayedCalldWarData.EnterAni_TopCenterStartTime,de=b{TweenLite.todthis.timeGroup,WarData.EnterAni_TopCenterMoveTime,{alpha:0,ease:Power2.easeIn}e.kill;}e;this.bottomGroup.y=575;TweenLite.delayedCalldWarData.EnterAni_BottomStartTime,de=b{TweenLite.todthis.bottomGroup,WarData.EnterAni_BottomMoveTime,{y:750,ease:Power2.easeIn}e.kill;}e;fordletunitToolofthis.unitToolArraye{unitTool.fullTips.visible=false;}ccthis.fullTips.visible=false;this.warStartTips.visible=false;}privatesbflEffect:ECSC.EffectBase;privatejsskEffect:ECSC.EffectBase;cc双倍法力publicShowSpeedUpTimeEffectde{ifdthis.sbflEffect!=nulle{RenderUtils.DestroyEffectdSceneTypeConst.War,this.sbflEffecte;this.sbflEffect=null;}this.sbflEffect=RenderUtils.CreateEffectdSceneTypeConst.War,9501e;this.root.addChilddthis.sbflEffecte;this.sbflEffect.x=this.root.widthc2-this.sbflEffect.widthc2+100;this.sbflEffect.y=this.root.heightc2-this.sbflEffect.heightc2;}cc决胜时刻publicShowBurnTimeEffectde{ifdthis.jsskEffect!=nulle{RenderUtils.DestroyEffectdSceneTypeConst.War,this.jsskEffecte;this.jsskEffect=null;}this.jsskEffect=RenderUtils.CreateEffectdSceneTypeConst.War,9502e;this.root.addChilddthis.jsskEffecte;this.jsskEffect.x=this.root.widthc2-this.jsskEffect.widthc2+100;this.jsskEffect.y=this.root.heightc2-this.jsskEffect.heightc2;}publicUpdatede{fordletunitToolofthis.unitToolArrayeunitTool.Updatede;}protectedDestroyde{fordletunitToolofthis.unitToolArraye{unitTool.Destroyde;this.bottomGroup.removeChilddunitToole;}this.unitToolArray=[];ifdthis.sbflEffect!=nulle{RenderUtils.DestroyEffectdSceneTypeConst.War,this.sbflEffecte;this.sbflEffect=null;}ifdthis.jsskEffect!=nulle{RenderUtils.DestroyEffectdSceneTypeConst.War,this.jsskEffecte;this.jsskEffect=null;}this.tower10.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.Tower10Click,thise;this.tower11.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.Tower11Click,thise;this.tower12.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.Tower12Click,thise;this.tower20.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.Tower20Click,thise;this.tower21.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.Tower21Click,thise;this.tower22.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.Tower22Click,thise;this.collide.removeEventListenerdegret.TouchEvent.TOUCH_TAP,this.CollideClick,thise;this.DestroyAllPlayerde;ccthis.DestroyTweenObjde;}privateTower10Clickde{game.logd"Tower10Click"e;GameData.EditorCollideType=10;TipsManager.ShowTipsdLanUtil.GetTextd"防御塔10"e,1e;}privateTower11Clickde{game.logd"Tower11Click"e;GameData.EditorCollideType=11;TipsManager.ShowTipsdLanUtil.GetTextd"防御塔11"e,1e;}privateTower12Clickde{game.logd"Tower12Click"e;GameData.EditorCollideType=12;TipsManager.ShowTipsdLanUtil.GetTextd"防御塔12"e,1e;}privateTower20Clickde{game.logd"Tower20Click"e;GameData.EditorCollideType=20;TipsManager.ShowTipsdLanUtil.GetTextd"防御塔20"e,1e;}privateTower21Clickde{game.logd"Tower21Click"e;GameData.EditorCollideType=21;TipsManager.ShowTipsdLanUtil.GetTextd"防御塔21"e,1e;}privateTower22Clickde{game.logd"Tower22Click"e;GameData.EditorCollideType=22;TipsManager.ShowTipsdLanUtil.GetTextd"防御塔22"e,1e;}privateCollideClickde{game.logd"CollideClick"e;GameData.EditorCollideType=100;TipsManager.ShowTipsdLanUtil.GetTextd"障碍物"e,1e;}privateCompleteClickde{game.logd"CompleteClick"e;GameData.EditorCollideType=1;TipsManager.ShowTipsdLanUtil.GetTextd"完成"e,1e;}}}﻿modulegame{exportclassCdData{publicid:number;publicobj:any;publiccd:number;publicfunc:Function;publicthisObj:any;publicendTime:numberpublicDestroyde{this.obj=null;this.func=null;this.thisObj=null;}publicExecde{ifdthis.func==null||this.thisObj==nullereturn;this.func.calldthis.thisObj,Math.ceilddthis.endTime-HomeServerTime.GetServerTimedeec1000ee;}publicIsEndde:boolean{returnHomeServerTime.GetServerTimede-this.endTimeb=0;}}exportclassCdManager{publiccdMap:SMapanumber,CdDatab;privatetimeKey:number;publicconstructorde{this.Initde;}publicInitde{this.cdMap=newSMapanumber,CdDatabde;this.timeKey=TimerMgr.GetInstancede.AddTimerd100,this.OnUpdateCd,thise;}publicDestroyde{TimerMgr.GetInstancede.RemoveTimerdthis.timeKeye;fordletcdDataofthis.cdMap.valuesdee{cdData.Destroyde;cdData=null;}this.cdMap.clearde;this.cdMap=null;}cc----------------------------------------------------------------------apic***添加按钮cd*@parambtn按钮*@paramthisObj执行环境*@paramfunccd回调*@paramcdcd单位秒*cpublicAddCDdbtn:egret.DisplayObjectContainer,thisObj:any,func:Function=null,cd:numbere:number{ifdegret.isdbtn,"eui.Button"e==falseereturnnull;lethasCode=IDManager.NewKeyIDde;ifdthis.cdMap.hasdhasCodee==trueereturnnull;letnewCdData=PoolManager.Insde.PopdCdDataeasCdData;newCdData.id=hasCode;newCdData.obj=btn;newCdData.cd=cd;newCdData.func=func;newCdData.thisObj=thisObj;newCdData.endTime=HomeServerTime.GetServerTimede+cd*1000;this.cdMap.setdhasCode,newCdDatae;returnhasCode;}publicRemoveCDdid:numbere:boolean{lethasCode=id;ifdthis.cdMap.hasdhasCodee==falseereturntrue;letcdData=this.cdMap.getdhasCodee;cdData.thisObj=null;cdData.func=null;cdData.obj=null;returntrue;ccreturnthis.cdMap.deletedhasCodee;}c***更新按钮cdd一般在初始化界面时调用e*@paramid添加按钮cd时返回的id*@parambtn按钮*@paramthisObj执行环境*@paramfunccd回调*@paramcdcdd如果没有则用注册时的cde*cpublicUpdateCDdid:number,btn:eui.Button,thisObj:any,func:Function,cd:number=nulle:boolean{lethasCode=id;ifdthis.cdMap.hasdhasCodee==falseereturnfalse;letcdData=this.cdMap.getdhasCodee;cdData.id=hasCode;cdData.obj=btn;func&&dcdData.func=funce;thisObj&&dcdData.thisObj=thisObje;ifdcd!=nulle{cdData.cd=cd;cdData.endTime=HomeServerTime.GetServerTimede+cd*1000;}returntrue;}cc判断按钮是否结束publicIsCdEnddid:numbere:boolean{lethasCode=id;ifdthis.cdMap.hasdhasCodee==falseereturntrue;returnthis.cdMap.getdhasCodee.IsEndde;}cc----------------------------------------------------------------------privateprivateOnUpdateCdde{fordletcdDataofthis.cdMap.valuesdee{ifdcdData==nullecontinue;ifdcdData.IsEndde==falsee{cdData.Execde;}else{cdData.Execde;this.cdMap.deletedcdData.ide;}}returntrue;}cc----------------------------------------------------------------------单例privatestaticInstance:CdManager;publicstaticInsde{ifdthis.Instance==nulle{this.Instance=newCdManagerde;}returnthis.Instance;}}}﻿c***游戏特效汇总*byzhaoxin*dcecopyright2014-2035*AllRightsReserved.*使用方法如：EffectUtils.rotationEffectde*cmodulegame{exportclassEffectUtils{cc存储旋转对象publicstaticrotationArr:Arrayaanyb=[];cc对象旋转特效ccobj旋转对象cctime旋转一周用时，毫秒publicstaticrotationEffectdobj,time:number=1000e:void{letthisObj=EffectUtils;ifdthisObj.rotationArr==nulle{thisObj.rotationArr=[];}ifdthisObj.rotationArr[obj.hashCode]e{return;}ifddthisObj.rotationArr[obj.hashCode]==nulle||!thisObj.rotationArr[obj.hashCode]e{thisObj.rotationArr[obj.hashCode]=true;}varonComplete1:Function=functionde{ifdthisObj.rotationArr[obj.hashCode]&&dobj!=nullee{obj.rotation=0;egret.Tween.getdobje.tod{rotation:360},timee.calldonComplete1,thisObje;}};obj.rotation=0;egret.Tween.getdobje.tod{rotation:360},timee.calldonComplete1,thisObje;}cc取消对象旋转ccobj旋转对象publicstaticremoveRotationEffectdobje:void{letthisObj=EffectUtils;ifdthisObj.rotationArr==nulle{thisObj.rotationArr=[];}thisObj.rotationArr[obj.hashCode]=false;}cc对象闪烁特效ccobj闪烁对象ccinterval闪烁总工时间publicstaticblinkEffectdobj,interval:number=1000e:void{newBitmapBlinkdobj,intervale;}cc抖动对象特效cc类似ios密码输入错误的特效publicstaticshakeObjdobje:void{letthisObj=EffectUtils;varshakeNum=80;varoldX:number=obj.x;egret.Tween.getdobje.tod{x:obj.x-10},shakeNume;egret.setTimeoutdfunctionde{egret.Tween.getdobje.tod{x:obj.x+20},shakeNume;},thisObj,shakeNum*2e;egret.setTimeoutdfunctionde{egret.Tween.getdobje.tod{x:obj.x-20},shakeNume;},thisObj,shakeNum*3e;egret.setTimeoutdfunctionde{egret.Tween.getdobje.tod{x:obj.x+20},shakeNume;},thisObj,shakeNum*4e;egret.setTimeoutdfunctionde{egret.Tween.getdobje.tod{x:oldX},shakeNume;},thisObj,shakeNum*5e;}cc抖动对象特效cc1：抖动2：震动publicstaticshakeScreendeffectType:number=1e:void{letthisObj=EffectUtils;varpanel=GameConfig.curPanel;varshakeNum=40;varoldX:number=panel.x;varoldY:number=panel.y;ifdeffectType==1e{egret.Tween.getdpanele.tod{x:panel.x-10},shakeNume;egret.setTimeoutdfunctionde{egret.Tween.getdpanele.tod{x:panel.x+20},shakeNume;},thisObj,shakeNum*2e;egret.setTimeoutdfunctionde{egret.Tween.getdpanele.tod{x:panel.x-20},shakeNume;},thisObj,shakeNum*3e;egret.setTimeoutdfunctionde{egret.Tween.getdpanele.tod{x:panel.x+20},shakeNume;},thisObj,shakeNum*4e;egret.setTimeoutdfunctionde{egret.Tween.getdpanele.tod{x:oldX},shakeNume;},thisObj,shakeNum*5e;}else{egret.Tween.getdpanele.tod{x:panel.x-10,y:panel.y},shakeNume;egret.setTimeoutdfunctionde{egret.Tween.getdpanele.tod{x:panel.x+20,y:panel.y},shakeNume;},thisObj,shakeNum*2e;egret.setTimeoutdfunctionde{egret.Tween.getdpanele.tod{x:panel.x,y:panel.y+15},shakeNume;},thisObj,shakeNum*3e;egret.setTimeoutdfunctionde{egret.Tween.getdpanele.tod{x:panel.x,y:panel.y-20},shakeNume;},thisObj,shakeNum*4e;egret.setTimeoutdfunctionde{egret.Tween.getdpanele.tod{x:panel.x,y:panel.y+10},shakeNume;},thisObj,shakeNum*5e;egret.setTimeoutdfunctionde{egret.Tween.getdpanele.tod{x:oldX,y:oldY},shakeNume;},thisObj,shakeNum*6e;}}c***str提示内容*effectType动画类型1：从下到上弹出2：从左至右弹出3：从右至左弹出4：从中间弹出渐渐消失5：从大变小等等*isWarning是否是警告，警告是红色*cpublicstaticshowTipsdstr:string="",effectType:number=1,isWarning:boolean=falsee:void{switchdeffectTypee{case1:TipsUtils.showTipsDownToUpdstr,isWarninge;break;case2:TipsUtils.showTipsLeftOrRightdstr,isWarning,truee;break;case3:TipsUtils.showTipsLeftOrRightdstr,isWarning,falsee;break;case4:TipsUtils.showTipsFromCenterdstr,isWarninge;break;case5:TipsUtils.showTipsBigToSmalldstr,isWarninge;break;default:ccTODO:Implementedefaultcase}}cc==========================alotofeffectwillcoming!============================publicstaticisPlayEffectPlay:Boolean=false;c***给显示对象增加特效*obj对象*cartoonType动画类型1:【可爱】按下变小，放开弹大2:按下变小，放开轻微弹大3：按下变小，放开变大*cpublicstaticplayEffectdobj,cartoonType:number=1e:void{letthisObj=EffectUtils;ifdthisObj.isPlayEffectPlaye{return;}thisObj.isPlayEffectPlay=true;varonComplete2:Function=functionde{thisObj.isPlayEffectPlay=false;};varonComplete1:Function=functionde{ifdcartoonType==1e{egret.Tween.getdobje.tod{scaleX:1,scaleY:1,x:obj.x-obj.widthc4,y:obj.y-obj.heightc4},500,egret.Ease.elasticOute.calldonComplete2,thisObje;}elseifdcartoonType==2e{egret.Tween.getdobje.tod{scaleX:1,scaleY:1,x:obj.x-obj.widthc4,y:obj.y-obj.heightc4},500,egret.Ease.backOute.calldonComplete2,thisObje;}elseifdcartoonType==3e{egret.Tween.getdobje.tod{scaleX:1,scaleY:1,x:obj.x-obj.widthc4,y:obj.y-obj.heightc4},100e.calldonComplete2,thisObje;}};egret.Tween.getdobje.tod{scaleX:0.5,scaleY:0.5,x:obj.x+obj.widthc4,y:obj.y+obj.heightc4},100,egret.Ease.sineIne.calldonComplete1,thisObje;}c***给显示对象增加持续放大特效*obj对象*cpublicstaticplayScaleEffectdobje:void{varonComplete1:Function=functionde{ifdobj!=nulle{varonComplete2:Function=functionde{obj.scaleX=1;obj.scaleY=1;egret.Tween.getdobje.tod{alpha:1},1000e.calldonComplete1,selfe};obj.alpha=1;egret.Tween.getdobje.tod{scaleX:1.5,scaleY:1.5,alpha:0},1000e.calldonComplete2,selfe}};onComplete1de;}c***显示对象上线浮动特效*obj对象*time浮动时间毫秒*space浮动高度*todo多个对象跳动*cpublicstaticflyObjdobj,time,space:number=50e:void{letthisObj=EffectUtils;varonComplete1:Function=functionde{ifdobj!=nulle{varonComplete2:Function=functionde{egret.Tween.getdobje.tod{y:obj.y-space},timee.calldonComplete1,thisObje;};egret.Tween.getdobje.tod{y:obj.y+space},timee.calldonComplete2,thisObje;}};onComplete1de;}c***显示对象摇头特效*obj对象*time浮动时间毫秒*space摇头幅度*todo多个对象摇头*注意：需要将对象的注册点位置：0.5,1*cpublicstaticrockObjdobj,time,space:number=20e:void{letthisObj=EffectUtils;varonComplete1:Function=functionde{ifdobj!=nulle{varonComplete2:Function=functionde{egret.Tween.getdobje.tod{rotation:-space},timee.calldonComplete1,thisObje;};egret.Tween.getdobje.tod{rotation:space},timee.calldonComplete2,thisObje;}};onComplete1de;}c***文字打字机效果*obj文本对象*content文字*interval打字间隔毫秒*cpublicstatictyperEffectdobj,content:string="",interval:number=200e:void{letthisObj=EffectUtils;varstrArr:Arrayaanyb=content.splitd""e;varlen:number=strArr.length;fordvari=0;ialen;i++e{egret.setTimeoutdfunctionde{obj.appendTextdstrArr[NumberdthisObje]e;},i,interval*ie;}}}}﻿modulegame{exportclassErrorManager{publicstaticLogicUploadExceptiondmsg,stacke{ifd!CheckWorkThreaddeereturn;ECS.SNetWar.StaticFuncd"game","ErrorManager","UploadException",msg,stacke;}cc上报异常publicstaticUploadExceptiondmsg,stacke{ifd!CheckMainThreaddeereturn;game.exceptiondmsg,stacke;NetUtil.UploadLogOneByOnede;}publicstaticLogicCacheExceptiondmsg,stacke{ifd!CheckWorkThreaddeereturn;letworldObj=ECS.LogicWorld.GetInstancede;ifdworldObj!=nulleworldObj.isStart=false;ECS.SNetWar.StaticFuncd"game","ErrorManager","CacheException",msg,stacke;}cc捕捉到的异常游戏正常运行publicstaticCacheExceptiondmsg,stacke{ifd!CheckMainThreaddeereturn;game.exceptiondmsg,stacke;NetUtil.UploadLogOneByOnede;ifdSceneManager.GetInstancede.IsInWardee{letworldObj=ECSC.RenderWorld.GetInstancede;ifdworldObj!=nulleworldObj.isStart=false;TipsManager.ShowTipsdLanUtil.GetFormatd`游戏异常战斗终止`e,1,null,1000,2000e;ifdClientNet.SocketManager.GetInstancede.IsSocketValiddeeClientNet.NetWar.C2SQuitWard1e;cc游戏异常退出战斗setTimeoutdfunctionde{ifdSceneManager.GetInstancede.IsInHomedeecc已经回到主城了return;ECSC.CNetWar.StopWarde;SceneManager.GetInstancede.EnterHomede;},4000e;}else{SceneManager.GetInstancede.EnterHomede;}}cc未被捕捉的异常直接上报publicstaticUnCacheExceptiondmsg,stacke{ifd!CheckMainThreaddeereturn;game.exceptiondmsg,stacke;NetUtil.UploadLogOneByOnede;ifdSceneManager.GetInstancede.IsInWardee{letworldObj=ECSC.RenderWorld.GetInstancede;ifdworldObj!=nulleworldObj.isStart=false;ECSC.CNetWar.StopWarde;SceneManager.GetInstancede.EnterHomede;}else{SceneManager.GetInstancede.EnterHomede;}}}}﻿cc屏蔽字库classFilterUtils{privatestaticFilterData:SMapastring,string[]b;publicstaticFCharGap:number;cc允许屏蔽字的字符之间间隔多少个字符publicstaticMCharGap:number;cc截取字符串的n个字符进行比较publicstaticInitdfTxtStr,splitChar:string="、",filterGap:number=7,matchGap:number=20e{FilterUtils.FCharGap=filterGap;FilterUtils.MCharGap=matchGap;letstrArray=fTxtStr.splitdsplitChare;FilterUtils.FilterData=newSMapastring,string[]bde;letkey="",value="";fordleti=0,len=strArray.length;ialen;i++e{key=strArray[i][0];value=strArray[i];ifdkey==null||key==""econtinueifdFilterUtils.FilterData.hasdkeye==falseeFilterUtils.FilterData.setdkey,[]e;FilterUtils.FilterData.getdkeye.pushdvaluee;}}publicstaticDestroyde{fordletstrArrayofFilterUtils.FilterData.valuesdee{strArray.length=0;strArray=null;}FilterUtils.FilterData.clearde;}publicstaticCheckdstr:stringe{ifdFilterUtils.FilterData==nullereturngame.logdLanUtil.GetTextd"请先执行Init方法初始化数据"ee;letkey="",pbzArray=null,matchStr="",mLen=0,mRetArray=null;fordleti=0,len=str.length;ialen;i++e{key=str[i];ifdFilterUtils.FilterData.hasdkeye==falseecontinue;mLen=Math.mindstr.length,FilterUtils.MCharGape;matchStr=str.substringdi,mLene;pbzArray=FilterUtils.FilterData.getdkeye;fordletpbzofpbzArraye{letregExp=FilterUtils.GetRegExpdpbze;mRetArray=matchStr.matchdregExpe;ifdmRetArray!=nullereturn[true,mRetArray[0]];}}return[false,""];}privatestaticGetRegExpdpbz:stringe{ifdpbz.lengtha=1ereturnnewRegExpdpbz,'i'e;letregPbz="";fordleti=0;iapbz.length;i++e{ifdi==pbz.length-1eregPbz+=pbz[i];elseregPbz+=`${pbz[i]}.{0,${FilterUtils.FCharGap}}`;}returnnewRegExpdregPbz,'i'e;}}﻿classFixedPoint2{privatevalues=newInt32Arrayd2e;getXde:number{returnthis.values[0]}getYde:number{returnthis.values[1]}getXYde:[number,number]{return[this.values[0],this.values[1],]}setXdvalue:numbere{this.values[0]=value}setYdvalue:numbere{this.values[1]=value}setXYdvalues:[number,number]e{this.values[0]=values[0]this.values[1]=values[1]}constructordvalues?:[number,number]e{ifdvalues!==undefinede{this.XY=values}}staticreadonlyzero=newFixedPoint2d[0,0]estaticreadonlyone=newFixedPoint2d[1,1]eatdindex:numbere:number{returnthis.values[index]}resetde:void{this.X=0this.Y=0}copyddest?:FixedPoint2e:FixedPoint2{ifd!deste{dest=newFixedPoint2de}dest.X=this.Xdest.Y=this.Yreturndest}negateddest?:FixedPoint2e:FixedPoint2{ifd!deste{dest=this}dest.X=-this.Xdest.Y=-this.Yreturndest}equalsdvector:FixedPoint2,threshold=MathConst.epsilone:boolean{ifdMath.absdthis.X-vector.Xebthresholde{returnfalse}ifdMath.absdthis.Y-vector.Yebthresholde{returnfalse}returntrue}lengthde:number{returnMath.sqrtdthis.squaredLengthdee}squaredLengthde:number{constX=this.XconstY=this.YreturndX*X+Y*Ye}adddvector:FixedPoint2e:FixedPoint2{this.X+=vector.Xthis.Y+=vector.Yreturnthis}subtractdvector:FixedPoint2e:FixedPoint2{this.X-=vector.Xthis.Y-=vector.Yreturnthis}multiplydvector:FixedPoint2e:FixedPoint2{this.X*=vector.Xthis.Y*=vector.Yreturnthis}dividedvector:FixedPoint2e:FixedPoint2{this.Xc=vector.Xthis.Yc=vector.Yreturnthis}scaledvalue:number,dest?:FixedPoint2e:FixedPoint2{ifd!deste{dest=this}dest.X*=valuedest.Y*=valuereturndest}normalizeddest?:FixedPoint2e:FixedPoint2{ifd!deste{dest=this}letlength=this.lengthdeifdlength===1e{returnthis}ifdlength===0e{dest.X=0dest.Y=0returndest}length=1.0clengthdest.X*=lengthdest.Y*=lengthreturndest}anglede:number{letrad=Math.atan2dthis.Y,this.Xe;returndrad*180cMath.PI+360e%360;}tostringde:string{return`X:${this.X.toFixedd2e}Y:${this.Y.toFixedd2e}`;}staticdotdvector:FixedPoint2,vector2:FixedPoint2e:number{returndvector.X*vector2.X+vector.Y*vector2.Ye}staticdistancedvector:FixedPoint2,vector2:FixedPoint2e:number{returnMath.sqrtdthis.squaredDistancedvector,vector2ee}staticsquaredDistancedvector:FixedPoint2,vector2:FixedPoint2e:number{constX=vector2.X-vector.XconstY=vector2.Y-vector.YreturndX*X+Y*Ye}staticdirectiondvector:FixedPoint2,vector2:FixedPoint2,dest?:FixedPoint2e:FixedPoint2{ifd!deste{dest=newFixedPoint2de}constX=vector.X-vector2.XconstY=vector.Y-vector2.Yletlength=Math.sqrtdX*X+Y*Yeifdlength===0e{dest.X=0dest.Y=0returndest}length=1clengthdest.X=X*lengthdest.Y=Y*lengthreturndest}staticmixdvector:FixedPoint2,vector2:FixedPoint2,time:number,dest?:FixedPoint2e:FixedPoint2{ifd!deste{dest=newFixedPoint2de}constX=vector.XconstY=vector.Yconstx2=vector2.Xconsty2=vector2.Ydest.X=X+time*dx2-Xedest.Y=Y+time*dy2-Yereturndest}staticsumdvector:FixedPoint2,vector2:FixedPoint2,dest?:FixedPoint2e:FixedPoint2{ifd!deste{dest=newFixedPoint2de}dest.X=vector.X+vector2.Xdest.Y=vector.Y+vector2.Yreturndest}staticdifferencedvector:FixedPoint2,vector2:FixedPoint2,dest?:FixedPoint2e:FixedPoint2{ifd!deste{dest=newFixedPoint2de}dest.X=vector.X-vector2.Xdest.Y=vector.Y-vector2.Yreturndest}staticproductdvector:FixedPoint2,vector2:FixedPoint2,dest?:FixedPoint2e:FixedPoint2{ifd!deste{dest=newFixedPoint2de}dest.X=vector.X*vector2.Xdest.Y=vector.Y*vector2.Yreturndest}staticquotientdvector:FixedPoint2,vector2:FixedPoint2,dest?:FixedPoint2e:FixedPoint2{ifd!deste{dest=newFixedPoint2de}dest.X=vector.Xcvector2.Xdest.Y=vector.Ycvector2.Yreturndest}}﻿cccareferencepath="..cpubliccconstcCommonDefine.ts"cbclassGameData{staticFPS:number=60;cc游戏整体的缩放比例staticScale:number=1;staticXOffset:number=0;staticYOffset:number=0;staticWidth:number=1280;staticHeight:number=720;staticIsSelfAI:boolean=false;staticIsOtherAI:boolean=true;staticLocalTest:boolean=false;cc本地测试staticShowAttackRange:boolean=true;staticDevelopMode:number=DevelopMode.Publish;staticCacheException:boolean=true;staticTestFight:boolean=false;staticEditorMode:boolean=false;staticEditorCollideType:number=0;staticReplayMode:boolean=false;staticSpeedUpMode:boolean=false;staticDamageAdddition:number=1;staticKingHPAddtion:number=1;staticFSMFrameInterval:number=1;cc状态机执行间隔staticHeroCollide:boolean=false;cc英雄是否产生碰撞ccstaticPHPURL:string="http:cc192.168.21.17:6555cprocess";staticPHPURL:string="http:cc192.168.21.17:6555cprocess";staticLogSocketURL:string="192.168.19.27";cc"192.168.21.17";cc"127.0.0.1";cc"192.168.21.35";cc"127.0.0.1";cc"127.0.0.1";staticLogSocketPort:number=6556;ccstaticPHPURL:string="http:cc127.0.0.1:6555cprocess";staticUploadType:number=2;cc1：http2：websocketstaticWarVersion=100;cc战斗版本号d回放录像的版本号必须要和当前版本号相同才可以回放否则不给回放estaticThreadDelayTime=100;staticReplayFileName:string="replay_name0_2020-02-18-01-08-12_21";cc"replay_nxd1112_c675402d-fc2d-47f3-911b-33eab6b7d1c9_21";staticRecordFrameData:boolean=true;cc是否记录帧数据staticLogLevel:number=UploadLogLevel.Log;cc上传log等级staticMultiThread:boolean=true;staticUserName:string;staticLogName:string=null;staticDeviceType:number=DeviceType.Html5Client;cc0:真正的客户端1：纯粹的计算服2：模拟客户端staticTotalPauseTime:number=0;staticStartPauseTime:number=0;staticOnPausede{GameData.StartPauseTime=egret.getTimerde;}staticOnResumede{GameData.TotalPauseTime+=egret.getTimerde-GameData.StartPauseTime;GameData.StartPauseTime=0;}}﻿c***游戏公用方法汇总*bydily*dcecopyright2014-2035*AllRightsReserved.*使用方法如：Global.setCookiede*cmodulegame{exportclassGlobal{cc获取html文本publicstaticgetTextFlowdstr:stringe:egret.ITextElement[]{varstyleParser=newegret.HtmlTextParserde;returnstyleParser.parserdstre;}}}﻿modulegame{exportclassHttp{privateloader:egret.URLLoader=newegret.URLLoaderde;privatevariables:egret.URLVariables;staticCreatede:Http{returnnewHttpde;}Successdhandle:Function,thisObj:any=nulle:Http{this.loader.addEventListenerdegret.Event.COMPLETE,functionde:egret.Evente:void{letloader=aegret.URLLoaderbe.target;handle.calldthisObj,loader.datae;},thisObje;returnthis;}Faildhandle:Function,thisObj:any=nulle:Http{this.loader.addEventListenerdegret.IOErrorEvent.IO_ERROR,handle,thisObje;returnthis;}Adddsourcee:Http{ifd!this.variablese{this.variables=newegret.URLVariablesde;}this.variables.decodedsourcee;returnthis;}DataFormatddataFormat:stringe:Http{this.loader.dataFormat=dataFormat;returnthis;}Getdurl:stringe{letreq=newegret.URLRequestdurle;this.variables&&dreq.data=this.variablese;this.loader.loaddreqe;}Postdurl:stringe{letreq=newegret.URLRequestdurle;req.method=egret.URLRequestMethod.POST;this.variables&&dreq.data=this.variablese;this.loader.loaddreqe;}PostArrayBufferdurl:string,buffer:ArrayBuffere{letreq=newegret.URLRequestdurle;req.method=egret.URLRequestMethod.POST;req.data=buffer;this.loader.loaddreqe;}}}﻿modulegame{exportclassHttpRequest{privaterequest:egret.HttpRequest=newegret.HttpRequestde;privatedata:any;publicid:number;publicmethod:string;staticCreatede:HttpRequest{returnnewHttpRequestde;}publicconstructorde{this.id=IDManager.NewKeyIDde;}Successdhandle:Function,thisObj:any=nulle:HttpRequest{letthatObj=this;this.request.addEventListenerdegret.Event.COMPLETE,functionde:egret.Evente:void{varloader=aegret.HttpRequestbe.currentTarget;ifdthatObj.method=="HEAD"ehandle.calldthisObj,loader.getAllResponseHeadersdee;elsehandle.calldthisObj,loader.responsee;},thise;returnthis;}Faildhandle:Function,thisObj:any=nulle:HttpRequest{letthatObj=this;this.request.addEventListenerdegret.IOErrorEvent.IO_ERROR,functionddata:anye:void{handle.calldthisObj,datae;},thise;returnthis;}Adddsourcee:HttpRequest{this.data=source;returnthis;}DataFormatddataFormat:stringe:HttpRequest{this.request.responseType=dataFormat;ccegret.HttpResponseType.TEXTccegret.URLLoaderDataFormat.TEXTreturnthis;}Headdurl:stringe:HttpRequest{this.method="HEAD";this.request.responseType=egret.HttpResponseType.TEXT;this.request.opendurl,this.methode;ccthis.request.setRequestHeaderd"Content-type","applicationcx-www-form-urlencoded"e;this.request.senddthis.datae;returnthis;}Getdurl:stringe:HttpRequest{this.method=egret.HttpMethod.GET;this.request.opendurl,this.methode;ccthis.request.setRequestHeaderd"Content-type","applicationcx-www-form-urlencoded"e;this.request.senddthis.datae;returnthis;}Postdurl:stringe:HttpRequest{this.method=egret.HttpMethod.GET;this.request.opendurl,this.methode;this.request.setRequestHeaderd"Content-type","applicationcx-www-form-urlencoded"e;this.request.senddthis.datae;returnthis;}PostArrayBufferdurl:string,buffer:ArrayBuffere:HttpRequest{this.request.opendurl,egret.HttpMethod.POSTe;this.request.setRequestHeaderd"Content-type","applicationcx-www-form-urlencoded"e;this.request.senddbuffere;returnthis;}Abortde{this.request.abortde;}}}﻿console.logd"------------------IDManager-----------------------"e;classIDManager{publicstatictest_id:number=0;publicstaticNewTestIDde:number{IDManager.test_id++;returnIDManager.test_id;}publicstatickey_id:number=1;publicstaticNewKeyIDde:number{IDManager.key_id++;returnIDManager.key_id;}publicstaticmap_id:number=1;publicstaticNewMapIDde:number{IDManager.map_id++;returnIDManager.map_id;}}cccareferencepath="..cdatacdata_text.ts"cbcccareferencepath="..cdatacdata_AILogic.ts"cbclassLanguageType{publicstaticCN:string="cn";publicstaticEN:string="en";}classLanUtil{privatestatictextInfoMap:Mapastring,Mapastring,stringbb;privatestatictextInfo2Map:Mapanumber,Mapastring,stringbb;cc数字映射publicstaticlanType:string=LanguageType.CN;cc当前语言publicstaticlanInfoArray:any[]=[[LanguageType.CN,"简体中文"],[LanguageType.EN,"English"]];publicstaticSwitchLandlanType:stringe{this.lanType=lanType;}publicstaticGetLanNamede:string{letthisObj=LanUtil;fordletinfoofthisObj.lanInfoArraye{ifdinfo[0]==thisObj.lanTypeereturninfo[1];}game.errord`GetLanNameerror:${this.lanType}`e;return"简体中文";}publicstaticInitde{this.textInfoMap=newMapastring,Mapastring,stringbbde;this.textInfo2Map=newMapanumber,Mapastring,stringbbde;letdataProxy=Data.text;letinfo,value;fordletkey1indataProxye{info=dataProxy[key1];letuniqueKey:string=info["key"];lettextInfo:Mapastring,stringb;ifd!this.textInfoMap.hasduniqueKeyee{textInfo=newMapastring,stringbde;this.textInfoMap.setduniqueKey,textInfoe;}else{textInfo=this.textInfoMap.getduniqueKeye;}letintKey=Numberdkey1e;this.textInfo2Map.setdintKey,textInfoe;fordletkeyininfoe{value=info[key];textInfo.setdkey,valuee;}}}privatestaticGetValue2dkey:numbere:string{ifdthis.textInfo2Map==nulle{this.Initde;}ifd!this.textInfo2Map.hasdkeyee{ccgame.warnd"LanUtilGetValueerror111:",keye;returnkey.toStringde;}lettextInfo=this.textInfo2Map.getdkeye;ifd!textInfo.hasdthis.lanTypeee{ccgame.warnd"LanUtilGetValueerror222:",keye;returnkey.toStringde;}returntextInfo.getdthis.lanTypee;}privatestaticGetValuedkey:stringe:string{ifdthis.textInfoMap==nulle{this.Initde;}ifd!this.textInfoMap.hasdkeyee{ccgame.warnd"LanUtilGetValueerror111:",keye;returnkey.toStringde;}lettextInfo=this.textInfoMap.getdkeye;ifd!textInfo.hasdthis.lanTypeee{ccgame.warnd"LanUtilGetValueerror222:",keye;returnkey.toStringde;}returntextInfo.getdthis.lanTypee;}publicstaticGetText2dkey:numbere:string{letvalue=LanUtil.GetValue2dkeye;returnvalue;}publicstaticGetTextdkey:stringe:string{letvalue=LanUtil.GetValuedkeye;returnvalue;}publicstaticGetFormatdkey:string,...extraArgs:any[]e:string{letvalue=LanUtil.GetTextdkeye;letindex=0;fordletargsofextraArgse{value=value.replaced`{${index}}`,args.toStringdeeindex++;}returnvalue}}﻿modulegame{exportfunctionwarnd...optionalParams:any[]e:void{ifd!CheckMainThreaddee{thread.warn.applydthread,optionalParamse;return;}letinfo="warning:";ifdGameData.DeviceType==DeviceType.SimulateClienteinfo=`${Utils.GetNowDatede}warning:`;console.warn.applydconsole,optionalParamse;ifdegret.Capabilities.runtimeType==egret.RuntimeType.WXGAMEereturn;ifdGameData.LogLevelb=UploadLogLevel.Warne{letlength=optionalParams.length;fordleti=0;ialength;i++e{info+=optionalParams[i]+"";}NetUtil.UploadToPHP_Logdinfo+"\n",-1e;}}exportfunctionerrord...optionalParams:any[]e:void{ifd!CheckMainThreaddee{thread.error.applydthread,optionalParamse;return;}letinfo="error:";ifdGameData.DeviceType==DeviceType.SimulateClienteinfo=`${Utils.GetNowDatede}error:`;console.error.applydconsole,optionalParamse;ifdegret.Capabilities.runtimeType==egret.RuntimeType.WXGAMEereturn;ifdGameData.LogLevelb=UploadLogLevel.Errore{letlength=optionalParams.length;fordleti=0;ialength;i++e{info+=optionalParams[i]+"";}NetUtil.UploadToPHP_Logdinfo+"\n",-1e;}}exportfunctionexceptiond...optionalParams:any[]e:void{ifd!CheckMainThreaddee{thread.exception.applydthread,optionalParamse;return;}letinfo="error:exception:";ifdGameData.DeviceType==DeviceType.SimulateClienteinfo=`${Utils.GetNowDatede}error:exception:`;console.error.applydconsole,optionalParamse;ifdegret.Capabilities.runtimeType==egret.RuntimeType.WXGAMEereturn;ifdGameData.LogLevelb=UploadLogLevel.Errore{letlength=optionalParams.length;fordleti=0;ialength;i++e{info+=optionalParams[i]+"";}NetUtil.UploadToPHP_Logdinfo+"\n",0e;}}exportfunctionlogd...optionalParams:any[]e:void{ifd!CheckMainThreaddee{thread.log.applydthread,optionalParamse;return;}letinfo="log:";ifdGameData.DeviceType==DeviceType.SimulateClienteinfo=`${Utils.GetNowDatede}log:`;elseconsole.log.applydconsole,optionalParamse;ifdegret.Capabilities.runtimeType==egret.RuntimeType.WXGAMEereturn;ifdGameData.LogLevelb=UploadLogLevel.Loge{letlength=optionalParams.length;fordleti=0;ialength;i++e{info+=optionalParams[i]+"";}NetUtil.UploadToPHP_Logdinfo+"\n",-1e;}}}﻿classMathConst{publicstaticepsilon=0.001;publicstaticerrorDis=0.1;publicstaticattackErroDis=0.1;publicstaticKeyFrameTime=100;ccpublicstaticUpdateSpeed=1;publicstaticJumpTargetFrame=0;cc部署降落时间publicstaticdeloyFallTime=300;publicstaticInitMagicID=101;publicstaticPrepareMagicID=102;cc准备中publicstaticDeployMagicID=103;cc部署中publicstaticSoulMagicID=110;publicstaticDieMagicID=104;publicstaticMapPosX=100;publicstaticMapPosY=100;publicstaticGridCountX=36;publicstaticGridCountY=16;publicstaticMapCellSize=30;publicstaticRoad1StartY=4;publicstaticRoad1EndY=5;publicstaticRoad2StartY=9;publicstaticRoad2EndY=10;publicstaticFrameError=0.01;publicstaticMaxDistance=999999;publicstaticMaxNumber=99999999;publicstaticKillDamage=9999;cc秒杀伤害值publicstaticMapPosMaxX=MathConst.GridCountX*MathConst.MapCellSize;publicstaticMapPosMaxY=MathConst.GridCountY*MathConst.MapCellSize;publicstaticHeroSize=30;publicstaticMaxIconCount=4;publicstaticKingSearchRadius=200;cc国王塔索敌半径publicstaticKingTowerID=99010;publicstaticQueenTowerID=19020;publicstaticAttackTowerPos=[[MathConst.MapCellSize*7+15,MathConst.MapCellSize*3+15],cc公主塔[MathConst.MapCellSize*4,MathConst.MapCellSize*8],cc国王塔[MathConst.MapCellSize*7+15,MathConst.MapCellSize*12+15]cc公主塔];publicstaticDefendTowerPos=[[MathConst.GridCountX*MathConst.MapCellSize-dMathConst.MapCellSize*7+15e,MathConst.MapCellSize*3+15],cc公主塔[MathConst.GridCountX*MathConst.MapCellSize-dMathConst.MapCellSize*4e,MathConst.MapCellSize*8],cc国王塔[MathConst.GridCountX*MathConst.MapCellSize-dMathConst.MapCellSize*7+15e,MathConst.MapCellSize*12+15]cc公主塔];cc锁定不能放兵的区域d敌方锁定区域epublicstaticEnemyLockedAreaArray=[cc无论水晶塔在不在敌方锁定区域不变[16,0,36,16,4,[-1,-1]]cc[cc16,0,30,5,1,[20]cc],cc[cc16,5,30,11,2,[20,22]cc],cc[cc16,11,30,16,3,[22]cc],cc[cc30,0,36,16,4,[-1,-1]cc]];cc不同防御塔掉落后不能放兵的区域点的集合d用来绘制非法区域的矩形用的epublicstaticLockAreaPosArray:any={10:[[16,0],[36,0],[36,16],[16,16],[16,0]],cc1+2+3+49:[[16,0],[36,0],[36,16],[16,16],[16,0]],cc2+3+47:[[16,0],[36,0],[36,16],[16,16],[16,0]],cc1+2+44:[[16,0],[36,0],[36,16],[16,16],[16,0]],cc4cc9:[[16,5],[30,5],[30,0],[36,0],[36,16],[16,16],[16,5]],cc2+3+4cc7:[[16,0],[36,0],[36,16],[30,16],[30,11],[16,11],[16,0]],cc1+2+4cc4:[[30,0],[36,0],[36,16],[30,16],[30,0]],cc4};cc两个特殊的拐点publicstaticCornerPosArray:any={9:[28,4],cc2+3+47:[29,11],cc1+2+4};cc四个数组分别代表四个圈从里往外d3X3和5X57X79X911X11epublicstaticValidPosArrayArray=[[[0,0],[-1,0],[0,-1],[0,1],[1,0],[-1,-1],[-1,1],[1,-1],[1,1],[-2,0],[0,-2],[0,2],[2,0],[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1],[-2,-2],[-2,2],[2,-2],[2,2]],[[-3,0],[0,-3],[0,3],[3,0],[-3,-1],[-3,1],[-1,-3],[-1,3],[1,-3],[1,3],[3,-1],[3,1],[-3,-2],[-3,2],[-2,-3],[-2,3],[2,-3],[2,3],[3,-2],[3,2]],[[-4,0],[0,-4],[0,4],[4,0],[-4,-1],[-4,1],[-1,-4],[-1,4],[1,-4],[1,4],[4,-1],[4,1],[-3,-3],[-3,3],[3,-3],[3,3],[-4,-2],[-4,2],[-2,-4],[-2,4],[2,-4],[2,4],[4,-2],[4,2]],[[-5,0],[-4,-3],[-4,3],[-3,-4],[-3,4],[0,-5],[0,5],[3,-4],[3,4],[4,-3],[4,3],[5,0],[-5,-1],[-5,1],[-1,-5],[-1,5],[1,-5],[1,5],[5,-1],[5,1],[-5,-2],[-5,2],[-2,-5],[-2,5],[2,-5],[2,5],[5,-2],[5,2],[-4,-4],[-4,4],[4,-4],[4,4],[-5,-3],[-5,3],[-3,-5],[-3,5],[3,-5],[3,5],[5,-3],[5,3]]];publicstaticGetAttackPointArraydattackDise:number[][]{ifdattackDisa=50ereturnMathConst.AttackPoint8Array;elseifdattackDisa=100ereturnMathConst.AttackPoint12Array;elseifdattackDisa=200ereturnMathConst.AttackPoint16Array;elsereturnMathConst.AttackPoint24Array;}ccpublicstaticInitAttackPointArraydecc{ccfunction_getPointArraydangleDiff:numbere:[number,number]cc{ccfordletangle=0;anglea3610;angle+=angleDiffecc{cc}cc}cc}cc8方向站位publicstaticAttackPoint8Array=[[0.0,1.0],[0.707,0.707],[1.0,0.0],[0.707,-0.707],[0.0,-1.0],[-0.707,-0.707],[-1.0,0.0],[-0.707,0.707],[0.0,1.0]];cc12方向站位publicstaticAttackPoint12Array=[[0.0,1.0],[0.499,0.866],[0.866,0.5],[1.0,0.0],[0.866,-0.499],[0.499,-0.866],[0.0,-1.0],[-0.5,-0.866],[-0.866,-0.5],[-1.0,0.0],[-0.866,0.5],[-0.5,0.866],[0.0,1.0]];cc16方向站位publicstaticAttackPoint16Array=[[0.0,1.0],[0.382,0.923],[0.707,0.707],[0.923,0.382],[1.0,0.0],[0.923,-0.382],[0.707,-0.707],[0.382,-0.923],[0.0,-1.0],[-0.382,-0.923],[-0.707,-0.707],[-0.923,-0.382],[-1.0,0.0],[-0.923,0.382],[-0.707,0.707],[-0.382,0.923],[0.0,1.0]];cc24方向站位publicstaticAttackPoint24Array=[[0.0,1.0],[0.258,0.965],[0.499,0.866],[0.707,0.707],[0.866,0.5],[0.965,0.258],[1.0,0.0],[0.965,-0.258],[0.866,-0.499],[0.707,-0.707],[0.499,-0.866],[0.258,-0.965],[0.0,-1.0],[-0.258,-0.965],[-0.5,-0.866],[-0.707,-0.707],[-0.866,-0.5],[-0.965,-0.258],[-1.0,0.0],[-0.965,0.258],[-0.866,0.5],[-0.707,0.707],[-0.5,0.866],[-0.258,0.965],[0.0,1.0]];publicstaticIdelLabel="stand";publicstaticAttackLabel="attack";publicstaticMoveLabel="run";publicstaticSkillLabel="skill";publicstaticGetUpdateSpeeddframeDiff:numbere:number{letspeed=1;ccifdframeDiffa=50eccspeed=Math.maxd1,frameDiffe;ccelseifdframeDiffa=1000eccspeed=50;ccelseccspeed=100;speed=Math.mind100,frameDiffe;ifdspeeda=1e{ifdIsMainThreaddee{letpreData=ECS.RenderShareDataMgr.GetInstancede.preData;speed=preData.updateSpeed;}else{letpreData=ECS.LogicShareDataMgr.GetInstancede.preData;speed=preData.updateSpeed;}}returnspeed;}}﻿c****寻路算法中使用到的数学方法*@author**cclassMathUtil{c***根据两点确定这两点连线的二元一次方程y=ax+b或者x=ay+b*@paramponit1*@parampoint2*@paramtype指定返回函数的形式。为0则根据x值得到y，为1则根据y得到x**@return由参数中两点确定的直线的二元一次函数*cpublicstaticgetLineFuncdponit1:egret.Point,point2:egret.Point,type:number=0e:Function{varresultFuc:Function;cc先考虑两点在一条垂直于坐标轴直线的情况，此时直线方程为y=a或者x=a的形式ifdponit1.x==point2.xe{ifdtype==0e{thrownewErrordLanUtil.GetTextd"两点所确定直线垂直于y轴，不能根据x值得到y值"ee;}elseifdtype==1e{resultFuc=functiondy:numbere:number{returnponit1.x;}}returnresultFuc;}elseifdponit1.y==point2.ye{ifdtype==0e{resultFuc=functiondx:numbere:number{returnponit1.y;}}elseifdtype==1e{thrownewErrordLanUtil.GetTextd"两点所确定直线垂直于y轴，不能根据x值得到y值"ee;}returnresultFuc;}cc当两点确定直线不垂直于坐标轴时直线方程设为y=ax+bvara:number;cc根据ccy1=ax1+bccy2=ax2+bcc上下两式相减消去b,得到a=dy1-y2ecdx1-x2ea=dponit1.y-point2.yecdponit1.x-point2.xe;varb:number;cc将a的值代入任一方程式即可得到bb=ponit1.y-a*ponit1.x;cc把a,b值代入即可得到结果函数ifdtype==0e{resultFuc=functiondx:numbere:number{returna*x+b;}}elseifdtype==1e{resultFuc=functiondy:numbere:number{returndy-beca;}}returnresultFuc;}cc根据两点确定贝塞尔曲线的中间点publicstaticgetCurveFuncdp1:Vector2,p3:Vector2,baseDis:numbere:Vector2{letx1=p1.x;lety1=p1.y;letx3=p3.x;lety3=p3.y;letscale=Math.absdx3-x1ecMath.absdy3-y1e;letdx:number=x3-x1;letdy:number=y3-y1;letradian=Math.atan2ddy,dxe;scale=Math.cosdradiane;letangle=radian*180cMath.PI;ccgame.logdangle,"-------MathUtil--------bbbbbbbbbbbbbb",scalee;letdisScale=Vector2.distancedp1,p3ecbaseDis;letheight=30*scale*disScale;cc抛物线高度为30再根据实际距离除以基础距离得到高度倍数ccifdscalea1ecc竖直方向曲线弯曲成都小一点ccheight=height*scale*0.5;ccelseifdscalea2eccheight=heightcscale*0.5;letdir=newVector2d[x3-x1,y3-y1]e;dir.normalizede;letx2=dx3+x1ec2;lety2=dy3+y1ec2;cc垂直向量letcrossDir=newVector2d[dir.y,-dir.x]e;crossDir.scaledheighte;cc得到抛物线最高点位置letp2=newVector2d[x2,y2]e;p2.adddcrossDire;returnp2;cccc发射路径宽度ccletwidth=Math.absdx3-x1ecccc算出中间会经过的一点ccletx2=x1+widthc2;cclety2=y1-height;ccletb=ddy1-y3e*dx1*x1-x2*x2e-dy1-y2e*dx1*x1-x3*x3eecddx1-x3e*dx1*x1-x2*x2e-dx1-x2e*dx1*x1-x3*x3ee;ccleta=ddy1-y2e-b*dx1-x2eecdx1*x1-x2*x2e;ccletc=y1-a*x1*x1-b*x1;ccreturn[a,b,c];}publicstaticsquaredDistancedpos1:Vector2,pos2:Vector2e:number{returnVector2.squaredDistancedpos1,pos2e;}publicstaticsquaredDistance2dx1:number,y1:number,x2:number,y2:numbere:number{returndx1-x2e*dx1-x2e+dy1-y2e*dy1-y2e;}publicstaticdistancedpos1:Vector2,pos2:Vector2e:number{returnVector2.distancedpos1,pos2e;}publicstaticdistance2dx1:number,y1:number,x2:number,y2:numbere:number{returnMath.sqrtddx1-x2e*dx1-x2e+dy1-y2e*dy1-y2ee;}publicstaticequals_arraydarray1:any[],array2:any[]e:boolean{ifdarray1.length!=array2.lengthereturnfalse;letlen=array1.length;fordleti=0;ialen;i++e{ifdarray1[i]!=array2[i]ereturnfalse;}returntrue;}publicstaticequal_vectordx1:number,y1:number,x2:number,y2:numbere:boolean{ifdMath.absdx1-x2ebMathConst.epsilone{returnfalse}ifdMath.absdy1-y2ebMathConst.epsilone{returnfalse}returntrue;}cc时间格式转换秒转时：分：秒publicstatictime_format_hourdtime:numbere:string{letstr="";ifdtimea0etime=0;lethour=Math.floordtimec3600e;ifdhoura10estr+="0"+hour;elsestr+=hour;time=time-hour*3600;letmin=Math.floordtimec60e;ifdmina10estr+=":0"+min;elsestr+=":"+min;time=time-min*60;letsec=time;ifdseca10estr+=":0"+sec;elsestr+=":"+sec;returnstr;}cc时间格式转换秒转时：分：秒publicstatictime_format_mindtime:numbere:string{letstr="";time=Math.floordtimee;ifdtimea0etime=0;letmin=Math.floordtimec60e;str+=""+min;time=time-min*60;letsec=time;ifdseca10estr+="：0"+sec;elsestr+="："+sec;returnstr;}publicstatictime_format_secdtime:numbere:string{letstr="";time=Math.floordtimee;letsec=time;ifdseca10estr+="0"+sec;elsestr+=""+sec;returnstr;}cc计算点dx,ye到经过两点dx1,y1e和dx2,y2e的直线的距离d点到直线的垂直距离epublicstaticDistanceFromPointToLinedx:number,y:number,x1:number,y1:number,x2:number,y2:numbere:number{leta:number=y2-y1;letb:number=x1-x2;letc:number=x2*y1-x1*y2;ifdMath.absdaeb0||Math.absdbeb0ereturnMath.absda*x+b*y+cecMath.sqrtda*a+b*be;elsereturn0;}cc圆与矩形碰撞检测cc圆心dx,ye,半径r,cc矩形中心dx0,y0e,cc矩形上边中心dx1,y1e,cc矩形右边中心dx2,y2ecc矩形宽高dw,hecchttps:ccblog.csdn.netczaffixcarticlecdetailsc25077835publicstaticIsCircleIntersectRectangledx:number,y:number,r:number,x0:number,y0:number,x1:number,y1:number,x2:number,y2:number,w:number,h:numbere:boolean{letw1=wc2;leth1=hc2;letw2=MathUtil.DistanceFromPointToLinedx,y,x0,y0,x1,y1e;leth2=MathUtil.DistanceFromPointToLinedx,y,x0,y0,x2,y2e;ifdw2bw1+rereturnfalse;ifdh2bh1+rereturnfalse;ifdw2a=w1ereturntrue;ifdh2a=h1ereturntrue;returndw2-w1e*dw2-w1e+dh2-h1e*dh2-h1ea=r*r;}publicstaticRotatePointdx1:number,y1:number,x2:number,y2:number,angle:numbere:[number,number]cc点dx1,y1e绕点dx2,y2e旋转angle角度后得到的点{letrotation=angle*Math.PIc180;letdx=x1-x2;letdy=y1-y2;cc计算旋转后的点x1=dx*Math.cosdrotatione-dy*Math.sindrotatione;y1=dx*Math.sindrotatione+dy*Math.cosdrotatione;cc恢复位移x1+=x2;y1+=y2;return[x1,y1];}}﻿c***调用原生api方法汇总*bydily*dcecopyright2014-2035*AllRightsReserved.*使用方法如：Global.setCookiede*cdeclarevarwx:{getFileSystemManager,env}classNativeApi{cc储存数据需要key和value，都必须是字符串TODONIU检查效率publicstaticsetLocalDatadkey:string,value:stringe:void{egret.localStorage.setItemdkey,valuee;}cc读取数据publicstaticgetLocalDatadkey:stringe:string{returnegret.localStorage.getItemdkeye;}cc删除数据publicstaticdeleteLocalDatadkey:stringe:void{egret.localStorage.removeItemdkeye;}cc将所有数据清空publicstaticclearLocalDatade:void{egret.localStorage.clearde;}cc调用麦克风publicstaticgetMicde:void{ccgetUserMediaAPI大部分手机不支持，所以暂不考虑}cc调用canvas截屏publicstaticgetScreende:void{}cc调用打电话功能publicstaticcallPhonedtelNum:numbere:void{window.opend"tel:"+telNum,'_self'e}cc调用发短信功能publicstaticsendMessagedtelNum:numbere:void{window.opend"sms:"+telNum,'_self'e}cc获取当前地址publicstaticgetCurUrlde:string{returnwindow.location.href;}publicstaticgetDeviceOSde:number{ifdegret.Capabilities.os=="iOS"ereturnDeviceOS.IOS;elseifdegret.Capabilities.os=="Android"ereturnDeviceOS.Android;elseifdegret.Capabilities.os=="WindowsPC"ereturnDeviceOS.WindowsPC;elseifdegret.Capabilities.os=="MacOS"ereturnDeviceOS.MacOS;elsereturnDeviceOS.Unknow;}cc当前游戏角度publicstaticcurAngle:number=Numberdwindow["orientation"]e;cc微信遍历文件夹publicstaticwalkFile_wxddirnamee:string[]{constwxFs=wx.getFileSystemManagerde;letfiles:string[]=wxFs.readdirSyncddirnamee;ccgame.logd"______walkFile_wx______________",files.length,filese;letretFiles=[];fordletfoffilese{constfile=dirname+"c"+f;conststat=wxFs.statSyncdfilee;ifdstat.isDirectorydee{let_files:string[]=NativeApi.walkFile_wxdfilee;fordlet_fileof_fileseretFiles.pushd_filee;}else{retFiles.pushdfe;}}returnretFiles;}}﻿modulegame{exportclassNetUtil{publicstaticUploadToPHP_ReplaydfileName:string,fileStr:string,cb:Function,thisObj:anye{letthatObj=NetUtil;ifdGameData.UploadType==1e{leturl=GameData.PHPURL;game.Http.Createde.Successdddatae=b{ifdcb!=nullecb.calldthisObj,truee;},thatObje.Faildddatae=b{ifdcb!=nullecb.calldthisObj,falsee;},thatObje.DataFormatdegret.URLLoaderDataFormat.TEXTe.Addd`type=${HttpConst.WriteReplay}&index=0&file=${fileStr}&name=hszzcreplayc${fileName}.json`e.Postdurle;}else{ClientNet.LogNetManager.GetInstancede.SendLogMessagedHttpConst.WriteReplay,[`hszzcreplayc${fileName}.json`,fileStr],dret,argse=b{ifdcb!=nullecb.calldthisObj,ret==1e;},thatObje;}}publicstaticUploadToPHP_Record_SplitdfileName:string,roomId:string,index:number,fileStr:string,cb:Function,thisObj:anye:boolean{letthatObj=NetUtil;ifdGameData.UploadType==1e{leturl=GameData.PHPURL;game.Http.Createde.Successdddatae=b{ifdcb!=nullecb.calldthisObj,index,true,datae;ccgame.logd"------------UploadToPHP_SplitSuccess...............",datae;},thatObje.Faildddatae=b{ifdcb!=nullecb.calldthisObj,index,false,datae;ccgame.logd"---------UploadToPHP_Split---Fail...............",datae;},thatObje.DataFormatdegret.URLLoaderDataFormat.TEXTe.Addd`type=${HttpConst.WriteRecord}&index=${index}&file=${fileStr}&name=hszzcrecordc${fileName}.json`e.Postdurle;returntrue;}else{ccgame.logd"---------UploadToPHP_Record_Split-------bbbbbbbbbbbbbbbbindex:",indexe;returnClientNet.LogNetManager.GetInstancede.SendLogMessagedHttpConst.WriteRecord,[`hszzcrecordc${fileName}.json`,index.toStringde,fileStr],dret,argse=b{ifdcb!=nullecb.calldthisObj,index,ret==1e;},thatObje;}}publicstaticUploadToPHP_ByteArray_SplitdfileName:string,index:number,byteArray:egret.ByteArray,cb:Function,thisObj:anye{letthatObj=NetUtil;letbuffer=byteArray.buffer.sliced0,byteArray.positione;letbase64Str=egret.Base64Util.encodedbuffere;ccletbuffStr=String.fromCharCode.applydnull,newUint8Arraydbufferee;leturl=GameData.PHPURL;game.Http.Createde.Successdddatae=b{ifdcb!=nullecb.calldthisObj,index,truee;ccgame.logd"------------UploadToPHP_SplitSuccess...............",datae;},thatObje.Faildddatae=b{ifdcb!=nullecb.calldthisObj,index,falsee;ccgame.logd"---------UploadToPHP_Split---Fail...............",datae;},thatObje.DataFormatdegret.URLLoaderDataFormat.TEXTe.Addd`type=write&index=${index}&file=${base64Str}&name=${fileName}`e.Postdurle;}cc上传操作publicstaticUploadToPHP_Actionde{}publicstaticcacheLogArray:string[]=[];cc上传日志publicstaticUploadToPHP_LogdfileStr:string,index:numbere{ifdNetUtil.cacheLogArray==nulleNetUtil.cacheLogArray=[];ifdindex==-1ecc插到最后NetUtil.cacheLogArray.pushdfileStre;elsecc放到队列头NetUtil.cacheLogArray.spliced0,0,fileStre;}publicstaticUploadLogOneByOnedmaxCount:number=1e{ccifdIsMainThreaddeeccreturn;ccconsole.logd"UploadLogOneByOne:",GameData.LogName,NetUtil.cacheLogArray.length,ClientNet.LogNetManager.GetInstancede.isConnectede;ifdGameData.LogName==null||NetUtil.cacheLogArray.length==0||!ClientNet.LogNetManager.GetInstancede.isConnectede{return;}letthatObj=NetUtil;function_uploadd_fileStr:stringe:boolean{ifdGameData.UploadType==1e{leturl=GameData.PHPURL;game.Http.Createde.Successdddatae=b{},thatObje.Faildddatae=b{},thatObje.DataFormatdegret.URLLoaderDataFormat.TEXTe.Addd`type=${HttpConst.WriteLog}&index=0&file=${_fileStr}&folder=hszzclogc${GameData.UserName}&name=c${GameData.LogName}.log`e.Postdurle;returntrue;}else{returnClientNet.LogNetManager.GetInstancede.SendLogMessagedHttpConst.WriteLog,[`hszzclogc${GameData.UserName}`,`c${GameData.LogName}.log`,_fileStr],null,nulle;}}letlen=Math.mindmaxCount,NetUtil.cacheLogArray.lengthe;fordleti=0;ialen;i++e{letfileStr=NetUtil.cacheLogArray[0];letret=_uploaddfileStre;ccconsole.logd"--------------发送协议到服务器..............",ret,GameData.UserName,GameData.LogNamee;ifdrete{NetUtil.cacheLogArray.shiftde;}else{break;cc发送失败}}}publicstaticUploadToPHPdfileName:string,byteArray:egret.ByteArraye{letthatObj=NetUtil;ccletbyteArray=newegret.ByteArrayde;ccbyteArray.writeIntd23e;ccbyteArray.writeDoubled342.1231411e;letbase64Str=egret.Base64Util.encodedbyteArray.buffere;ccletfileName="record123.bin";leturl=GameData.PHPURL;game.Http.Createde.Successdddatae=b{game.logd"------------UploadToPHPSuccess...............",datae;},thatObje.Faildde=b{game.logd"---------UploadToPHP---Fail..............."e;},thatObje.DataFormatdegret.URLLoaderDataFormat.TEXTe.Addd`type=write&file=${base64Str}&name=${fileName}`e.Postdurle;}publicstaticDownloadFromPHPdfileName:string,cb:Function,thisObj:anye{ccletfileName="record123.bin";letthatObj=NetUtil;ifdGameData.UploadType==1e{leturl=GameData.PHPURL;game.Http.Createde.Successdddatae=b{cb.calldthisObj,datae;ccletintNum=byteArray.readIntde;ccletdoubleNum=byteArray.readDoublede;game.logd"------------DownloadFromPHPSuccess..............."e;},thatObje.Faildde=b{game.logd"----------DownloadFromPHP--Fail..............."e;},thatObje.DataFormatdegret.URLLoaderDataFormat.TEXTe.Addd`type=${HttpConst.ReadFile}&index=0&name=${fileName}.json`e.Postdurle;}else{ClientNet.LogNetManager.GetInstancede.SendLogMessagedHttpConst.ReadFile,[`${fileName}.json`],dret,argse=b{ifdcb!=nullecb.calldthisObj,ret==1,argse;},thatObje;}}}}﻿modulegame{exportclassHomeFactory{publicstaticCreateObjectdclassType:number,shape:number,args:any[]e:any{returnObjectPoolManager.GetInstancede.CreateObjectdSceneTypeConst.Home,classType,shape,argse;}publicstaticDestroyObjectdrenderObj:any,classType:number,shape:numbere{ObjectPoolManager.GetInstancede.DestroyObjectdSceneTypeConst.Home,renderObj,classType,shapee;}}}﻿classObjectPool{c**对象池*cprivate_pool:SMapanumber,Arrayaanybb=newSMapanumber,Arrayaanybbde;publicconstructorde{}private_CreateObjectdclassType:number,shape:number,args:any[]e:any{switchdclassTypee{caseObjectType.MoveInfo:returnnewECSC.MoveInfode;caseObjectType.SkillDataBase:returnnewECS.SkillDataBasede;caseObjectType.HeroSkillData:returnnewECS.HeroSkillDatade;caseObjectType.SpellSkillData:returnnewECS.SpellSkillDatade;caseObjectType.SkillFlowItem:returnnewECS.SkillFlowItemde;caseObjectType.MagicCMDInfo:returnnewECSC.MagicCMDInfode;caseObjectType.LogicCMDInfo:returnnewECSC.LogicCMDInfode;ccrendercaseObjectType.HeroBase:returnnewECSC.HeroBasedshape,args[0]e;caseObjectType.PreviewCard:returnnewECSC.PreviewCarddargs[0]e;caseObjectType.HeroQueue:returnnewECSC.HeroQueuedshape,args[0]e;caseObjectType.EffectBase:returnnewECSC.EffectBasedshape,args[0],args[1]e;caseObjectType.DragonBonesEffect:returnnewECSC.DragonBonesEffectdshapee;caseObjectType.AreaBase:returnnewECSC.AreaBasedshape,args[0]e;default:{game.warnd"CreateObjectExtypeerrorclassType:",classTypee;returnnull;}}}c**取出*cpublicCreateObjectdclassType:number,shape:number,args:any[]e:any{ifdGameData.DeviceType==DeviceType.LinuxServerereturnthis._CreateObjectdclassType,shape,argse;varresult;varkey=classType*1000000+shape;ccgame.logdkey,"______________CreateObject________",classType,shapee;vararr=this._pool.getdkeye;ifdarr!=null&&arr.lengthe{result=arr.shiftde;}else{result=this._CreateObjectdclassType,shape,argse;}returnresult;}c**放回*cpublicDestroyObjectdobj:any,classType:number,shape:numbere{ifdGameData.DeviceType==DeviceType.LinuxServere{obj.Disposede;ifdobj.DisposeAll!=nulleobj.DisposeAllde;return;}varkey=classType*1000000+shape;ccgame.logdkeye;ifd!this._pool.hasdkeyeethis._pool.setdkey,[]e;letarr=this._pool.getdkeye;ifdarr.indexOfdobje==-1e{arr.pushdobje;}obj.Disposede;cc销毁}publicDestroyAllObjectde{letvalues=this._pool.valuesde;fordletarrayofvaluese{fordletobjofarraye{ifdobj.DisposeAll!=nulleobj.DisposeAllde;}}this._pool.clearde;ccgame.logdthis._pool.size,"___________DestroyAllObject__________________"e;}}classObjectPoolManager{privatestaticinstance:ObjectPoolManager;publicstaticGetInstancede:ObjectPoolManager{ifdObjectPoolManager.instance==nulle{ObjectPoolManager.instance=newObjectPoolManagerde;}returnObjectPoolManager.instance;}privatewarPoolObj:ObjectPool;privatehomePoolObj:ObjectPool;publicconstructorde{this.warPoolObj=newObjectPoolde;this.homePoolObj=newObjectPoolde;}publicCreateObjectdsceneType:number,classType:number,shape:number,args:any[]e:any{ifdshape==nulleshape=1;ifdsceneType==SceneTypeConst.Homeereturnthis.homePoolObj.CreateObjectdclassType,shape,argse;elsereturnthis.warPoolObj.CreateObjectdclassType,shape,argse;}publicDestroyObjectdsceneType:number,obj:any,classType:number,shape:numbere{ifdshape==nulleshape=1;ifdsceneType==SceneTypeConst.Homeereturnthis.homePoolObj.DestroyObjectdobj,classType,shapee;elsereturnthis.warPoolObj.DestroyObjectdobj,classType,shapee;}publicDestroyAllObjectdsceneType:numbere{ifdsceneType==SceneTypeConst.Homeereturnthis.homePoolObj.DestroyAllObjectde;elsereturnthis.warPoolObj.DestroyAllObjectde;}}﻿c***对象池*理论上所有的对象都应该从这里创建，回收到这里。*创建时会执行该对象的init方法，回收则不会执行destry，考虑到外部会自行销毁一次。*定时清理暂时无用的对象池dremoveAll方法e*cclassPoolManager{privateCLEAR_DELAY:number=1000*60*30;cc清理时间d毫秒eprivatetimeKey:number;privatepoolMap:SMapastring,Object[]b;publicconstructorde{this.Initde;}publicInitde:void{this.poolMap=newSMapastring,Object[]bde;this.timeKey=game.TimerMgr.GetInstancede.AddTimerdthis.CLEAR_DELAY,this.RemoveAll,thise;}publicDsestroyde:void{game.TimerMgr.GetInstancede.RemoveTimerdthis.timeKeye;this.RemoveAllde;this.poolMap.clearde;this.poolMap=null;}cc----------------------------------------------------------------------apipublicPushdobj:Objecte:boolean{ifdobj!=nulle{letclsName=egret.getQualifiedClassNamedobje;ifdclsName==nullereturnfalse;ifdthis.poolMap.hasdclsNamee==falsee{letobjArray:Object[]=newArrayde;this.poolMap.setdclsName,objArraye;}ccthis.doObjDestroydobje;cc组件就不帮它destroy，考虑到会调用两次的问题d外部一次，这里一次e;letpool=this.poolMap.getdclsNamee;pool.pushdobje;returntrue;}returnfalse;}publicPopdcls:anye:any{ifdcls!=nulle{letclsName=cls.prototype.__class__;ifdthis.poolMap.hasdclsNamee==truee{letobjPool=this.poolMap.getdclsNamee;letobj=objPool.popde;ifdobj==nulle{obj=newclsde;}else{this.DoObjInitdobje;}returnobj;}else{letobj=newclsde;returnobj;}}returnnull;}privateDoObjDestroydobj:Objecte{letdestroyFn="Destroy";ifdobj[destroyFn]!=null&&obj[destroyFn]instanceofFunctioneobj[destroyFn]de;}cc----------------------------------------------------------------------privateprivateDoObjInitdobj:Objecte{letinitFn="Init";ifdobj[initFn]!=null&&obj[initFn]instanceofFunctioneobj[initFn]de;}privateRemoveAllde{fordletpoolofthis.poolMap.valuesdee{ifdpool==nullecontinue;fordletobjofpoole{ifdobj==nullecontinue;this.DoObjDestroydobje;obj=null;}pool=null;}this.poolMap.clearde;returnfalse;}cc----------------------------------------------------------------------单例privatestaticInstance:PoolManager;publicstaticInsde{ifdthis.Instance==nulle{this.Instance=newPoolManagerde;}returnthis.Instance;}}﻿moduleECS{exportclassWarFactory{publicstaticCreateSystemdsysType:numbere:SystemBase{switchdsysTypee{caseSystemType.InitSystem:returnnewInitSystemde;caseSystemType.InputSystem:returnnewInputSystemde;caseSystemType.SkillSystem:returnnewSkillSystemde;caseSystemType.CreateRenderSystem:returnnewECSC.CreateRenderSystemde;caseSystemType.MoveRenderSystem:returnnewECSC.MoveRenderSystemde;caseSystemType.SkillRenderSystem:returnnewECSC.SkillRenderSystemde;caseSystemType.OptimsticSyncSystem:returnnewOptimsticSyncSystemde;caseSystemType.StateMachineSystem:returnnewStateMachineSystemde;caseSystemType.WarSystem:returnnewWarSystemde;caseSystemType.StateSystem:returnnewStateSystemde;caseSystemType.FrameEndSystem:returnnewFrameEndSystemde;caseSystemType.MoveTransformSystem:returnnewMoveTransformSystemde;caseSystemType.SpellSystem:returnnewSpellSystemde;caseSystemType.WarUISystem:returnnewECSC.WarUISystemde;caseSystemType.AISystem:returnnewAISystemde;caseSystemType.ReconnectSystem:returnnewReconnectSystemde;default:{game.warnd"CreateSystemtypeerrorsysType:",sysTypee;returnnewSystemBasede;}}}publicstaticCreateRecordSystemdsysType:numbere:RecordSystemBase{ccswitchdsysTypeecc{cccaseSystemType.MoveSystem:returnnewMoveSystemde;ccdefault:cc{ccgame.warnd"CreateRecordSystemtypeerrorsysType:",sysTypee;ccreturnnewRecordSystemBasede;cc}cc}returnnewRecordSystemBasede;}publicstaticCreateComponentdcomType:number,worldObj:WorldBaseaEntityBasebe:ComponentBase{letobj:ComponentBase=null;ifdworldObj.IsLogicdee{switchdcomTypee{caseComponentType.RealPlayerComponent:{obj=newRealPlayerComponentde;break;}caseComponentType.CommandComponent:{obj=newCommandComponentde;break;}caseComponentType.TransformComponent:{obj=newTransformComponentde;break;}caseComponentType.PlayerCommandRecordComponent:{obj=newPlayerCommandRecordComponentde;break;}caseComponentType.HeroDataComponent:{obj=newHeroDataComponentde;break;}caseComponentType.SelfComponent:{obj=newSelfComponentde;break;}caseComponentType.TheirComponent:{obj=newTheirComponentde;break;}caseComponentType.SkillStatusComponent:{obj=newSkillStatusComponentde;break;}caseComponentType.ConnectStatusComponent:{obj=newConnectStatusComponentde;break;}caseComponentType.DrawComponent:{obj=newDrawComponentde;break;}caseComponentType.WarComponent:{obj=newWarComponentde;break;}caseComponentType.StateComponent:{obj=newStateComponentde;break;}caseComponentType.AreaComponent:{obj=newAreaComponentde;break;}caseComponentType.SpellComponent:{obj=newSpellComponentde;break;}caseComponentType.FrameDataCacheComponent:{obj=newFrameDataCacheComponentde;break;}caseComponentType.TowerComponent:{obj=newTowerComponentde;break;}caseComponentType.AIComponent:{obj=newAIComponentde;break;}default:{game.warnd"CreateLogicComponenttypeerrorcomType:",comTypee;obj=newComponentBasede;}}}else{switchdcomTypee{caseRenderComponentType.RealPlayerComponent:{obj=newECSC.RealPlayerComponentde;break;}caseRenderComponentType.TransformComponent:{obj=newECSC.TransformComponentde;break;}caseRenderComponentType.HeroDataComponent:{obj=newECSC.HeroDataComponentde;break;}caseRenderComponentType.SkillStatusComponent:{obj=newECSC.SkillStatusComponentde;break;}caseRenderComponentType.DrawComponent:{obj=newECSC.DrawComponentde;break;}caseRenderComponentType.WarComponent:{obj=newECSC.WarComponentde;break;}caseRenderComponentType.SpellComponent:{obj=newECSC.SpellComponentde;break;}caseRenderComponentType.TowerComponent:{obj=newECSC.TowerComponentde;break;}default:{game.warnd"CreateRenderComponenttypeerrorcomType:",comTypee;obj=newComponentBasede;}}}obj.world=worldObj;returnobj;}publicstaticCreateEntitydclassType:anye:any{returnnewclassTypede;ccswitchdentityTypeecc{cccaseEntityType.EntityBase:returnnewEntityBasede;ccdefault:cc{ccgame.warnd"CreateEntitytypeerrorentityType:",entityTypee;ccreturnnewEntityBasede;cc}cc}}publicstaticCreateWorlddworldType:numbere:any{switchdworldTypee{caseWorldType.LogicWorld:returnnewLogicWorldde;caseWorldType.RenderWorld:returnnewECSC.RenderWorldde;default:{game.warnd"CreateWorldtypeerrorworldType:",worldTypee;returnnewLogicWorldde;}}}publicstaticCreateObjectdclassType:number,shape:number,args:any[]e:any{returnObjectPoolManager.GetInstancede.CreateObjectdSceneTypeConst.War,classType,shape,argse;}publicstaticDestroyObjectdrenderObj:any,classType:number,shape:numbere{ObjectPoolManager.GetInstancede.DestroyObjectdSceneTypeConst.War,renderObj,classType,shapee;}publicstaticCreateSkillObjectdtemplate:SkillDataTemplate,objType:numbere:any{letclassStr=`SkillData${template.id}`;letclassType=ECS[classStr];ifdclassType!=nullereturnnewclassTypede;elsereturnWarFactory.CreateObjectdobjType,null,nulle;}publicstaticCreateCardDataItemdshape:numbere:game.CardDataItem{ifdLogicWarUtil.IsKingTowerdshapeeecc国王塔returnnewgame.LeaderDataItemdshapee;ifdLogicWarUtil.IsQueenTowerdshapeeecc公主塔returnnewgame.HeroDataItemdshapee;ifdLogicWarUtil.IsSpelldshapeeecc法术returnnewgame.SpellDataItemdshapee;ifdLogicWarUtil.IsCarddshapeeecc普通卡牌returnnewgame.HeroDataItemdshapee;cc召唤物之类的returnnewgame.HeroDataItemdshapee;}}}﻿c***正则公用方法汇总*bydily*dcecopyright2014-2035*AllRightsReserved.*RegUtils.checkEmailde*cclassRegUtils{c*用途：检查输入的Email信箱格式是否正确输入：strEmail：字符串返回：如果通过验证返回true,否则返回false*cpublicstaticcheckEmaildstrEmaile:boolean{ccvaremailReg=c^[_a-z0-9]+@d[_a-z0-9]+\.e+[a-z0-9]{2,3}$c;varemailReg=c^[\w-]+d\.[\w-]+e*@[\w-]+d\.[\w-]+e+$c;ifdemailReg.testdstrEmailee{returntrue;}else{alertdLanUtil.GetTextd"您输入的Email地址格式不正确！"ee;returnfalse;}};c*用途：校验ip地址的格式输入：strIP：ip地址返回：如果通过验证返回true,否则返回false；*cpublicstaticisIPdstrIPe:boolean{ifdRegUtils.isNulldstrIPee{returnfalse;}varre=c^d\d+e\.d\d+e\.d\d+e\.d\d+e$cgcc匹配IP地址的正则表达式ifdre.testdstrIPee{ifdNumberdRegExp.$1ea256&&NumberdRegExp.$2ea256&&NumberdRegExp.$3ea256&&NumberdRegExp.$4ea256e{returntrue;}}returnfalse;};c*用途：检查输入手机号码是否正确输入：strMobile：字符串返回：如果通过验证返回true,否则返回false*cpublicstaticcheckMobiledstrMobilee:boolean{varregu:string="c^1[3|4|5|7|8][0-9]\d{4,8}$c";varre=newRegExpdregue;ifdre.testdstrMobileee{returntrue;}else{returnfalse;}};c*用途：检查输入的电话号码格式是否正确输入：strPhone：字符串返回：如果通过验证返回true,否则返回false*cpublicstaticcheckPhonedstrPhonee:boolean{varphoneRegWithArea=c^[0][1-9]{2,3}-[0-9]{5,10}$c;varphoneRegNoArea=c^[1-9]{1}[0-9]{5,8}$c;varprompt=LanUtil.GetTextd"您输入的电话号码不正确!"e;ifdstrPhone.lengthb9e{ifdphoneRegWithArea.testdstrPhoneee{returntrue;}else{alertdprompte;returnfalse;}}else{ifdphoneRegNoArea.testdstrPhoneee{returntrue;}else{alertdprompte;returnfalse;}}};c*用途：检查输入字符串是否为空或者全部都是空格输入：str返回：如果全是空返回true,否则返回false*cpublicstaticisNulldstre:boolean{ifdstr==""e{returntrue;}varregu="^[]+$";varre=newRegExpdregue;returnre.testdstre;};c*用途：检查输入对象的值是否符合整数格式输入：str输入的字符串返回：如果通过验证返回true,否则返回false*cpublicstaticisIntegerdstre:boolean{varregu=c^[-]{0,1}[0-9]{1,}$c;returnregu.testdstre;};c*用途：检查输入字符串是否符合正整数格式输入：s：字符串返回：如果通过验证返回true,否则返回false*cpublicstaticisNumberdse:boolean{varregu="^[0-9]+$";varre=newRegExpdregue;ifds.searchdree!=-1e{returntrue;}else{returnfalse;}};c*用途：检查输入字符串是否符合金额格式,格式定义为带小数的正数，小数点后最多三位输入：s：字符串返回：如果通过验证返回true,否则返回false*cpublicstaticisMoneydse:boolean{varregu="^[0-9]+[\.][0-9]{0,3}$";varre=newRegExpdregue;ifdre.testdsee{returntrue;}else{returnfalse;}};c*function:cTrimdsInputString,iTypeedescription:字符串去空格的函数parameters:iType：1=去掉字符串左边的空格;2=去掉字符串左边的空格;0=去掉字符串左边和右边的空格returnvalue:去掉空格的字符串*cpublicstaticcTrimdsInputString,iTypee:boolean{varsTmpStr='';vari=-1;ifdiType==0||iType==1e{whiledsTmpStr==''e{++i;sTmpStr=sInputString.substrdi,1e;}sInputString=sInputString.substringdie;}ifdiType==0||iType==2e{sTmpStr='';i=sInputString.length;whiledsTmpStr==''e{--i;sTmpStr=sInputString.substrdi,1e;}sInputString=sInputString.substringd0,i+1e;}returnsInputString;}}﻿c****工具箱*@author**cmodulegame{exportclassCloseBgextendseui.Group{publicconstructordresName:stringe{superde;ifdresName!=nulle{letbg=RenderUtils.CreateScale9GridImgdresName,GameData.Width,GameData.Height,newegret.Rectangled4,6,15,12ee;bg.alpha=0.3;this.addChilddbge;}this.addEventListenerdegret.Event.ADDED_TO_STAGE,this.onAddToStage,thise;}privateonAddToStagedevent:egret.Evente{cccc绘制一个透明度为1的绿色矩形，宽高为100*80ccvarspr1:egret.Sprite=newegret.Spritede;ccspr1.graphics.beginFilld0x00ff00,0e;ccspr1.graphics.drawRectd0,0,GameData.Width,GameData.Heighte;ccspr1.graphics.endFillde;ccspr1.width=GameData.Width;ccspr1.height=GameData.Height;ccthis.addChilddspr1e;cccc设置显示对象可以相应触摸事件ccspr1.touchEnabled=false;ccspr1.$hitTest=dstageX,stageYe:egret.DisplayObject=b{ccgame.logd"-------spr1.hitTest--------"e;ccreturnegret.Sprite.prototype.$hitTest.calldspr1,stageX,stageYe;ccccreturnspr1;cc};this.width=GameData.Width;this.height=GameData.Height;this.$hitTest=dstageX,stageYe:egret.DisplayObject=b{returnthis;};cc注册事件ccspr1.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.onTouch,thise;ccthis.addEventListenerdegret.TouchEvent.TOUCH_TAP,this.onTouchTaps,this,truee;}ccprivateonTouchdevt:egret.TouchEventecc{ccthis.txt.text+="\n点击了spr1";cc}ccprivateonTouchTapdevt:egret.TouchEventecc{ccthis.txt.text+="\n容器冒泡侦听\n---------";cc}ccprivateonTouchTapsdevt:egret.TouchEventecc{ccthis.txt.text+="\n容器捕获侦听";cc}cccc绘制文本ccprivatetxt:egret.TextField;ccprivatedrawTextde:voidcc{ccthis.txt=newegret.TextFieldde;ccthis.txt.size=12;ccthis.txt.x=750;ccthis.txt.width=200;ccthis.txt.height=200;ccthis.txt.text="事件文字";ccthis.addChilddthis.txte;cc}publicDestroyde{this.removeEventListenerdegret.Event.ADDED_TO_STAGE,this.onAddToStage,thise;}}exportclassRenderUtils{c***根据name关键字创建一个Bitmap对象。name属性请参考resourcescresource.json配置文件的内容。*cpublicstaticCreateBitmapByNamedname:stringe:egret.Bitmap{letresult:egret.Bitmap=newegret.Bitmapde;lettexture:egret.Texture=RES.getResdnamee;result.texture=texture;returnresult;}publicstaticCreateImageByNamedname:stringe:eui.Image{letimg=neweui.Image;img.source=RES.getResdnamee;returnimg;}publicstaticCreateSBitmapByNamednamee:SBitmap{letresult:SBitmap=newSBitmapde;lettexture:egret.Texture=RES.getResdnamee;result.texture=texture;returnresult;}publicstaticCreateCloseBgdparent:any,layer:number=0,resName:string=nulle:CloseBg{letbg:CloseBg=newCloseBgdresNamee;parent.addChildAtdbg,layere;returnbg;}publicstaticDestroyCloseBgddlg:CloseBge{ifddlg!=nulle{dlg.Destroyde;RenderUtils.RemoveFromParentddlge;}}publicstaticCreateScale9GridBitmapdresName:string,width:number,height:number,rect:egret.Rectanglee:egret.Bitmap{letimg:egret.Bitmap=newegret.Bitmapde;lettexture=RES.getResdresNamee;img.texture=texture;img.width=width;img.height=height;ccletrect:egret.Rectangle=newegret.Rectangled30,31,40,41e;img.scale9Grid=rect;returnimg;}publicstaticCreateScale9GridImgdresName:string,width:number,height:number,rect:egret.Rectanglee:eui.Image{letimg:eui.Image=neweui.Imagede;lettexture=RES.getResdresNamee;img.source=texture;img.width=width;img.height=height;ccletrect:egret.Rectangle=newegret.Rectangled30,31,40,41e;img.scale9Grid=rect;returnimg;}publicstaticUpdateCircleMask2dobj:egret.DisplayObject,startPercent:number,endPercent:number,anticlockwise:boolean=truee:any{ifdstartPercenta0estartPercent=0;ifdstartPercentb100estartPercent=100;ifdendPercenta0eendPercent=0;ifdendPercentb100eendPercent=100;ifdobj.mask==nulle{obj.mask=newegret.Shapede;}letshape=aegret.Shapebobj.mask;ccletshape=testObj==null?newegret.Shapede:testObj;ccpercent=30;letradius=Math.sqrtdobj.height*obj.height+obj.width*obj.widthe+2;radius=radiusc2;shape.graphics.clearde;shape.graphics.beginFilld0xff0000,1e;shape.graphics.moveTod0,0e;shape.graphics.lineTodradius,0e;letstartAngle=d270+startPercentc100*360e*Math.PIc180;letendAngle=d270+endPercentc100*360e*Math.PIc180;shape.graphics.drawArcd0,0,radius,startAngle,endAngle,anticlockwisee;shape.graphics.lineTod0,0e;shape.graphics.endFillde;ifd!obj.parent.containsdshapeeeobj.parent.addChilddshapee;shape.x=obj.x+obj.widthc2;shape.y=obj.y+obj.heightc2;obj.mask=shape;returnshape;}publicstaticUpdateCircleMaskdobj:egret.DisplayObject,percent:number,anticlockwise:boolean=true,testObj:any=nulle:any{ifdpercenta0epercent=0;ifdpercentb100epercent=100;ifdobj.mask==nulle{obj.mask=newegret.Shapede;}letshape=aegret.Shapebobj.mask;ccletshape=testObj==null?newegret.Shapede:testObj;ccpercent=30;letradius=Math.sqrtdobj.height*obj.height+obj.width*obj.widthe+2;radius=radiusc2;shape.graphics.clearde;shape.graphics.beginFilld0xff0000,1e;shape.graphics.moveTod0,0e;shape.graphics.lineTodradius,0e;letstartAngle=270*Math.PIc180;letendAngle=d270+percentc100*360e*Math.PIc180;shape.graphics.drawArcd0,0,radius,startAngle,endAngle,anticlockwisee;shape.graphics.lineTod0,0e;shape.graphics.endFillde;ifd!obj.parent.containsdshapeeeobj.parent.addChilddshapee;shape.x=obj.x+obj.widthc2;shape.y=obj.y+obj.heightc2;obj.mask=shape;returnshape;}publicstaticSetGreydobj:egret.DisplayObject,isGrey:booleane{ifdisGreye{letcolorMatrix=ColorMatrixType.Grey;letfilters=newegret.ColorMatrixFilterdcolorMatrixe;obj.filters=[filters];}else{ifdobj&&obj.filters!=nulleobj.filters=null;}}publicstaticSetColordobj:egret.DisplayObject,r:number,g:number,b:number,strength:number=1e{ifdr==256&&g==256&&b==256e{obj.filters=null;}else{letcolorMatrix=[1,0,0,0,100,0,1,0,0,100,0,0,1,0,100,0,0,0,1,0];colorMatrix[0]=rc255;colorMatrix[6]=gc255;colorMatrix[12]=bc255;colorMatrix[4]=strength;colorMatrix[9]=strength;colorMatrix[14]=strength;letcolorFilter=newegret.ColorMatrixFilterdcolorMatrixe;obj.filters=[colorFilter];}}publicstaticRemoveFromParentdobj:egret.DisplayObjecte{ifdobj!=null&&obj.parent!=nulleobj.parent.removeChilddobje;}publicstaticRemoveArrayFromParentdobjArray:egret.DisplayObject[]e{ifdobjArray==nullereturn;fordletobjofobjArraye{ifdobj.parent!=nulleobj.parent.removeChilddobje;}}publicstaticCreateEffectdsceneType:number,effectID:number,time:number=-999,count:number=1e:ECSC.EffectBase{letdataProxy=JsonData.getGameDatad"effectdata_json"e;leteffectData=dataProxy[effectID];ifdeffectData==nulle{game.errord"RenderUtils.CreateEffectError:",effectIDe;returnnull;}leteType=effectData["type"];letaniName=effectData["aniname"];leteffectObj:ECSC.EffectBase;ifdeType==EffectType.DragonBonesEffectecc龙骨特效{effectObj=ObjectPoolManager.GetInstancede.CreateObjectdSceneTypeConst.War,ObjectType.DragonBonesEffect,effectID,[]e;}elsecc序列帧特效{effectObj=ObjectPoolManager.GetInstancede.CreateObjectdsceneType,ObjectType.EffectBase,effectID,[]e;}effectObj.id=IDManager.NewKeyIDde;effectObj.Initde;ifdtime==-999ecc使用默认次数时间和次数播放effectObj.PlayEffectdaniNamee;elseeffectObj.PlayEffectByTimedaniName,time,counte;returneffectObj;}publicstaticCreateEffect2dsceneType:number,clipName:string,fileName:string,aniLabel:string,time:number=0,count:number=1e:ECSC.EffectBase{leteffectObj:ECSC.EffectBase=ObjectPoolManager.GetInstancede.CreateObjectdsceneType,ObjectType.EffectBase,0,[clipName,fileName]e;effectObj.id=IDManager.NewKeyIDde;effectObj.Initde;effectObj.PlayEffectByTimedaniLabel,time,counte;returneffectObj;}publicstaticDestroyEffectdsceneType:number,effectObj:ECSC.EffectBasee{ObjectPoolManager.GetInstancede.DestroyObjectdsceneType,effectObj,effectObj.classType,effectObj.shapee;}ccc**cc*检测是否进入椭圆范围cc*@parampx被检测点x坐标cc*@parampy被检测点y坐标cc*@paramcx椭圆圆心x坐标cc*@paramcy椭圆圆心y坐标cc*@paramr椭圆最大半径cc*@paramsy将圆沿y轴压扁变为椭圆时候的比例cc*@return是否包含在椭圆中cc*cccpublicstaticcontainsXYdpx:number,py:number,cx:number,cy:number,r:number,sy:number=0.5e:boolean{ccvardx:number=px-cx;ccvardy:number=py-cy;ccdyc=sy;ccifdMath.sqrtddx*dx+dy*dyeare{ccreturntrue;cc}ccreturnfalse;cc}ccpublicstaticcontainsXY2dpx:number,py:numbere:boolean{ccifdpxb40&&pxaGameSetting.swid-80&&pyb40&&pyaGameSetting.shei-80e{ccreturntrue;cc}else{ccreturnfalse;cc}cc}c***画椭圆*cpublicstaticdrawEllipsedwid:number,hei:number,color:number,fill:boolean=falsee:egret.Shape{varsp:egret.Shape=newegret.Shapede;sp.graphics.lineStyled1,colore;c*ifdfille{ccsp.graphics.beginFilldcolor,0.05e;cc绘制放射状渐变填充varfillType:string=egret.GradientType.RADIAL;varcolors:number[]=[color,color];varalphas:number[]=[0,0.5];varratios:number[]=[200,255];varmatr:egret.Matrix=newegret.Matrixde;matr.createGradientBoxdwid,hei,0,0,0e;sp.graphics.beginGradientFilldfillType,colors,alphas,ratios,matre;}*csp.graphics.drawEllipsed0,0,wid,heie;sp.graphics.endFillde;returnsp;}publicstaticDrawMaskde{letcontainer:egret.DisplayObjectContainer=newegret.DisplayObjectContainerde;letbg:egret.Shape=newegret.Shapede;bg.graphics.beginFilld0x000000,0.8e;bg.graphics.drawRectd0,0,GameData.Width,GameData.Heighte;bg.graphics.endFillde;container.addChilddbge;letsp:egret.Sprite=newegret.Spritede;sp.graphics.beginFilld0xff0000e;sp.graphics.drawRectd500,500,200,200e;sp.graphics.endFillde;container.addChilddspe;sp.blendMode=egret.BlendMode.ERASE;letrenderTexture:egret.RenderTexture=newegret.RenderTexturede;renderTexture.drawToTexturedcontainere;letbitmap:egret.Bitmap=newegret.BitmapdrenderTexturee;Main.instance.addChilddbitmape;bitmap.touchEnabled=true;bitmap.pixelHitTest=true;}cc获取html文本publicstaticgetTextFlowdstr:stringe:egret.ITextElement[]{varstyleParser=newegret.HtmlTextParserde;returnstyleParser.parserdstre;}cc获取特效的资源publicstaticGetEffectResArraydeffectID:numbere:string[]{letdataProxy=JsonData.getGameDatad"effectdata_json"e;leteffectData=dataProxy[effectID];ifdeffectData==nulle{game.errord"RenderUtils.GetEffectResArrayError:",effectIDe;return[];}leteType=effectData["type"];leteffectObj:ECSC.EffectBase;ifdeType==EffectType.DragonBonesEffectecc龙骨特效{letfileName=effectData["filename"];letdragonbonesData=`${fileName}_ske_json`;lettextureData=`${fileName}_tex_json`;lettexturePNG=`${fileName}_tex_png`;return[dragonbonesData,textureData,texturePNG];}elsecc序列帧特效{letfileName=effectData["filename"];leteffectPNG=`${fileName}_png`;leteffectJSON=`${fileName}_json`;return[effectPNG,effectJSON];}}publicstaticAddToFileDataMapdresArray:string[],fileDataMap:SMapastring,numberbe:string[]{letnewResArray:string[]=[];fordletfileNameofresArraye{ifd!RES.hasResdfileNameee{ifdfileName.indexOfd"_red"ea=-1egame.warnd"RenderUtils.GetHeroGroupshasnores:",fileNamee;continue;}ifdfileDataMap.hasdfileNameee{letcount=fileDataMap.getdfileNamee;fileDataMap.setdfileName,count+1e;continue;}fileDataMap.setdfileName,1e;newResArray.pushdfileNamee;}returnnewResArray;}publicstaticGetSpellGroupsdresDataMap:SMapastring,IAutoGroupResDatab,fileDataMap:SMapastring,numberb,heroIDSet:Setanumberb,shape:numbere{ifdheroIDSet.hasdshapeeereturn;ifd!ECSC.RenderWarUtil.IsSpelldshapeee{RenderUtils.GetHeroGroupsdresDataMap,fileDataMap,heroIDSet,shapee;return;}letheroData=agame.SpellDataItembgame.MainDataMgr.GetInstancede.heroDataMgr.GetHerodshapee;ifdheroData==nulle{game.errord"GetHeroGroupserror:",shapee;return;}letresArray:string[]=[];leteffectRely=heroData.effectRely;cc特效资源fordleteffectIDofeffectRelye{letfileNameArray=RenderUtils.GetEffectResArraydeffectIDe;fordletfileNameoffileNameArraye{resArray.pushdfileNamee;}}resArray=RenderUtils.AddToFileDataMapdresArray,fileDataMape;ifdresArray.lengthb0e{letheroKey="hero_"+shape;letheroResData:IAutoGroupResData={groupName:heroKey,resArray:resArray};resDataMap.setdheroKey,heroResDatae;}letthisObj=RenderUtils;cc英雄依赖资源fordletrelayShapeofheroData.resRely.keysdee{thisObj.GetSpellGroupsdresDataMap,fileDataMap,heroIDSet,relayShapee;}}publicstaticGetHeroGroupsdresDataMap:SMapastring,IAutoGroupResDatab,fileDataMap:SMapastring,numberb,heroIDSet:Setanumberb,shape:numbere{ifdheroIDSet.hasdshapeeereturn;ifdECSC.RenderWarUtil.IsSpelldshapeee{RenderUtils.GetSpellGroupsdresDataMap,fileDataMap,heroIDSet,shapee;return;}letheroData=agame.HeroDataItembgame.MainDataMgr.GetInstancede.heroDataMgr.GetHerodshapee;ifdheroData==nulle{game.errord"RenderUtils.GetHeroGroups.heroDataerror:",shapee;return;}letshapes=heroData.GetSubHeroShapesde;ifdshapes.lengthb0e{fordletkeyofshapese{RenderUtils.GetHeroGroupsdresDataMap,fileDataMap,heroIDSet,keye;}return;}heroIDSet.adddshapee;letresArray:string[]=[];cc英雄资源letclipShape=heroData.clipName;letclipName="hero_"+clipShape;cc我方资源resArray.pushd`${clipName}_json`e;resArray.pushd`${clipName}_png`e;cc特效依赖leteffectRely=heroData.effectRely;fordleteffectIDofeffectRelye{letfileNameArray=RenderUtils.GetEffectResArraydeffectIDe;fordletfileNameoffileNameArraye{resArray.pushdfileNamee;}}cc敌方资源ifdECSC.RenderWarUtil.IsQueenTowerdshapeeecc皇后塔{clipShape=clipShape+1;clipName="hero_"+clipShape;resArray.pushd`${clipName}_json`e;resArray.pushd`${clipName}_png`e;}elsecc普通英雄{resArray.pushd`${clipName}_red_json`e;resArray.pushd`${clipName}_red_png`e;}resArray=RenderUtils.AddToFileDataMapdresArray,fileDataMape;ifdresArray.lengthb0e{letheroKey="hero_"+shape;letheroResData:IAutoGroupResData={groupName:heroKey,resArray:resArray};resDataMap.setdheroKey,heroResDatae;}letthisObj=RenderUtils;cc英雄依赖资源ccfordletidofheroArrayData["resrely"]efordletrelayShapeofheroData.resRely.keysdee{thisObj.GetHeroGroupsdresDataMap,fileDataMap,heroIDSet,relayShapee;}}publicstaticReloadImagedimg:eui.Imagee{letsource=img.source;img.source=null;img.source=source;}cc调整父子的相对位置ccchild是目标元素。publicstaticABRelativePositiondchild:egret.DisplayObject,child2:egret.DisplayObject,dir:number,offsetX:number=0,offsetY:number=0e{letp=child.parent,pX=0,pY=0,pW=p.width,pH=p.height,cX=child.x,cY=child.y,cW=child.width,cH=child.height,tmpX=0,tmpY=0;ifdchild.parent==child2.parente{pX=child2.x,pY=child2.y,pW=child2.width,pH=child2.height;}switchddire{caseConst.Direction.LEFT_TOP:tmpX=pX+0;tmpY=pY+0;break;caseConst.Direction.LEFT_CENTER:tmpX=pX+0;tmpY=pY+dpH-cHec2;break;caseConst.Direction.LEFT_BOTTOM:tmpX=pX+0;tmpY=pY+pH-cH;break;caseConst.Direction.CENTER_TOP:tmpX=pX+dpW-cWec2;tmpY=pY+0;break;caseConst.Direction.CENTER_CENTER:tmpX=pX+dpW-cWec2;tmpY=pY+dpH-cHec2;break;caseConst.Direction.CENTER_BOTTOM:tmpX=pX+dpW-cWec2;tmpY=pY+pH-cH;break;caseConst.Direction.RIGHT_TOP:tmpX=pX+pW-cW;tmpY=pY+0;break;caseConst.Direction.RIGHT_CENTER:tmpX=pX+pW-cW;tmpY=pY+dpH-cHec2;break;caseConst.Direction.RIGHT_BOTTOM:tmpX=pX+pW-cW;tmpY=pY+pH-cH;break;}tmpX+=offsetX;tmpY+=offsetY;child.x=tmpX;child.y=tmpY;}c***销毁eui.ArrayCollection相关的子项，减少重复代码*需要求子项数据部分实现Destroy方法*并非销毁list的item，而是销毁其数据部分*cpublicstaticRemoveUpdateListdlist:eui.ArrayCollectione{ifdlist==null||list.lengtha=0ereturn;letitem:any;whiledlist.lengthb0e{item=list.removeItemAtd0e;ifditem==nullecontinue;ifditem["Destroy"]!=null&&typeofditem["Destroy"]e=="function"e{item["Destroy"]de;item=null;}}}c***销毁eui.List相关的子项，减少重复代码*需要子项实现Destroy方法*cpublicstaticRemoveListdlist:eui.Liste{letitem:any;whiledlist.numChildrenb0e{item=list.removeChildAtd0e;ifditem==nullecontinue;ifditem["Destroy"]!=null&&typeofditem["Destroy"]e=="function"e{item["Destroy"]de;item=null;}}}}}﻿classSettings{cc游戏设置publicstaticrenderQuality:number=1;cc其他设置publicstaticlog:boolean=false;publicstaticresLog:boolean=false;publicstaticthreadLog:boolean=false;publicstaticMainRightSelectIndex=1;publicstaticHomeResKeyID:number=0;publicstaticWarResKeyID:number=0;publicstaticFightHeroGroups:string[]=[];publicstaticFightHeroKeyID:number=0;publicstaticLoadHomeGroupKeyID:number=0;publicstaticLoadWarGroupKeyID:number=0;publicstaticLoadFightHeroGroupKeyID:number=0;publicstaticChangeScenedsceneType:numbere{cc销毁所有界面game.UIManager.DestroyAllPanelde;ifdsceneType==SceneTypeConst.Homee{Main.instance.stage.frameRate=30;game.UIManager.DestroyPaneldPanelTypeConst.Ware;game.UIManager.DestroyPaneldPanelTypeConst.WarUIe;letwarGroups=ResUtils.GetInstancede.GetGroupsdGroupResType.Ware;game.ResManager.GetInstancede.RemoveGroupRefdwarGroups,Settings.WarResKeyIDe;game.ResManager.GetInstancede.RemoveGroupRefdSettings.FightHeroGroups,Settings.FightHeroKeyIDe;cc销毁战斗模块ccLinkUtil.GetWarManagerde.StopWarde;ECSC.CNetWar.StopWarde;SoundManager.Insde.PlayBgSoundd"backgroud_mp3"e;}else{ifdegret.Capabilities.isMobileeMain.instance.stage.frameRate=60;elseMain.instance.stage.frameRate=60;game.UIManager.DestroyPaneldPanelTypeConst.Homee;game.UIManager.DestroyPaneldPanelTypeConst.MainUINewe;lethomeGroups=ResUtils.GetInstancede.GetGroupsdGroupResType.Homee;game.ResManager.GetInstancede.RemoveGroupRefdhomeGroups,Settings.HomeResKeyIDe;SoundManager.Insde.PlayBgSoundd"gamebgsound_mp3"e;}}}﻿classShakeTools{privatestaticinstance:ShakeTools;cc单例publicstaticGetInstancede:ShakeTools{ifdthis.instance==nulle{this.instance=newShakeToolsde;}returnthis.instance;}privatecheckForMinimumValues:boolean=true;privateminShakeValue:number=0.001;privateminRotationValue:number=0.001;publicTestShakede{}c**屏幕震动*cpublicShakeScreendobj:egret.DisplayObjecte{ccletobj=Main.Instance.getSceneRootde;ccobj.x=0ccobj.y=0this.DoShakedobj,50,cc震动次数newegret.Pointd0.5,0.5e,ccx,y轴的震动系数[-1,1]newegret.Pointd1,1e,ccx,y轴的震动量级0,cc旋转量级8,cc震动x.y轴的最大偏移量50,cc如果速度越快，则振幅越剧烈0.1cc振幅的递减系数e}c***屏幕震动*@paramcamera震动对象*@paramnumberOfShakes震动次数*@paramseedx,y轴的震动系数[-1,1]*@paramshakeAmountx,y轴的震动量级*@paramrotationAmount旋转量级如果小于0表示:不旋转*@paramdistance震动x.y轴的最大偏移量这个和shakeAmount重复要干掉*@paramspeed如果速度越快，则振幅越剧烈*@paramdecay振幅的递减系数*@paramendCallBack结束回调**cpublicDoShakedcam:egret.DisplayObject,numberOfShakes:number,seed:egret.Point,shakeAmount:egret.Point,rotationAmount:number,distance:number,speed:number,decay:number,endCallBack:Function=nulle{ifdcam==nullereturnvardefaultPointY=cam.xvardefaultPointX=cam.yvardefaultRotation=cam.rotationccSetrandomvaluesvarmod1=seed.xb0.5?1:-1;varmod2=seed.yb0.5?1:-1;varcurrentShakes=numberOfShakesvarshakeDistance=distance;letshakePosition:egret.PointletshakeRotation:egret.PointletguiShakePosition:egret.PointletrotationStrength=1;letstart1:egret.Point=newegret.Pointd0,0eletstartR:egret.Point=newegret.Pointd0,0eletstartTime=0lettimeOnEnterFrame=-1letcurTime:number=0letresetEvent=de=b{cam.x=defaultPointX;cam.y=defaultPointY;cam.rotation=defaultRotation;cam.removeEventListenerdegret.Event.ENTER_FRAME,updateEvent,thiseifdendCallBack!=nulle{endCallBackde}}letupdateEvent=de=b{varnow=egret.getTimerde;vartime=timeOnEnterFrame;varpass=dnow-timeec1000;ifdtimeOnEnterFrame==-1e{timeOnEnterFrame=now;return}else{timeOnEnterFrame=now;}curTime+=pass*speed;curTime=curTime;ifdthis.checkForMinimumValuese{ifdrotationAmount!=0&&rotationStrengtha=this.minRotationValuee{resetEventdereturn}ifddistance!=0&&shakeDistancea=this.minShakeValuee{resetEventdereturn;}ifdcurrentShakesa=0e{resetEventdereturn;}}ifdcam==nulle{return}cam.x=defaultPointY+mod1*Math.sindcurTimee*dshakeAmount.x*shakeDistanceecam.y=defaultPointX+mod2*Math.cosdcurTimee*dshakeAmount.y*shakeDistanceeifdrotationAmountb0e{cam.rotation=defaultRotation+Math.cosdcurTimee*drotationAmount*rotationStrengthe}ifdcurTimebMath.PI*2e{curTime=0;shakeDistance*=d1-game.Utils.Clamp01ddecayee;rotationStrength*=d1-game.Utils.Clamp01ddecayee;currentShakes--;ccgame.logd`shakeDistance:${shakeDistance}rotationStrength:${rotationStrength}currentShakes:${currentShakes}`e}}resetEventde;cam.addEventListenerdegret.Event.ENTER_FRAME,updateEvent,thise;}}﻿cccareferencepath="IDManager.ts"cbconsole.logd"------------------SMap-----------------------"e;classSMapaK,Vb{publicstaticrecord:boolean;publicstaticmapInfo:Mapanumber,SMapaany,anybb=newMapanumber,SMapaany,anybbde;publicstaticBeginRecordde{ccSMap.record=true;SMap.record=false;}publicstaticEndRecordde{SMap.record=false;ccletcount=SMap.GetUnClearCountde;ccgame.logd"-------------EndRecord----------------------------",counte;}publicstaticGetUnClearCountde:number{letcount=0;letvalues=Array.fromdSMap.mapInfo.valuesdee;fordletmapObjofvaluese{ifdmapObj.sizeb0e{ccgame.logdmapObj.stacke;count++;}}returncount;}private_mapObj:MapaK,Vb;private_sortKeys:ArrayaKb;privateid:number;publicstack:string;publicconstructorde{this._mapObj=newMapaK,Vbde;this._sortKeys=[];ccvarerr=newErrorde;ccgame.logd"-------1111bbbbbbbbbbbbbbb",err.stacke;ccgame.logd"-------2222bbbbbbbbbbbbbbb",IDManagere;ccgame.logd"-------3333bbbbbbbbbbbbbbb"e;this.id=IDManager.NewMapIDde;ccthis.id=0;ifdSMap.recorde{SMap.mapInfo.setdthis.id,thise;varerr=newErrorde;this.stack=err.stack;}}publiccopyde:SMapaK,Vb{letobj=newSMapaK,Vbde;fordletkeyofthis._sortKeyse{letvalue=this._mapObj.getdkeye;obj.setdkey,valuee;}returnobj;}publicdisposede{this.clearde;ifdthis._mapObj!=nullethis._mapObj.clearde;this._mapObj=null;ifdthis._sortKeys!=nullethis._sortKeys.length=0;this._sortKeys=null;ifdSMap.recorde{SMap.mapInfo.deletedthis.ide;}}publicclearde{this._mapObj.clearde;this._sortKeys.length=0;ifdSMap.recorde{SMap.mapInfo.deletedthis.ide;}}publiccheckrecordde{ifdSMap.recorde{ifdthis._mapObj.sizeb0e{SMap.mapInfo.setdthis.id,thise;ifdthis.stack==nulle{varerr=newErrorde;this.stack=err.stack;}}else{SMap.mapInfo.deletedthis.ide;}}}publicdeletedkey:Ke:boolean{letindex=this._sortKeys.indexOfdkeye;ifdindexb-1ethis._sortKeys.splicedindex,1e;letret=this._mapObj.deletedkeye;this.checkrecordde;returnret;}publicgetdkey:Ke:V{returnthis._mapObj.getdkeye;}publichasdkey:Ke:boolean{returnthis._mapObj.hasdkeye;}publicsetdkey:K,value?:Ve:this{ifdthis._mapObj.hasdkeyee{this.deletedkeye;}this._sortKeys.pushdkeye;this._mapObj.setdkey,valuee;this.checkrecordde;returnthis;}publicgetsizede:number{returnthis._mapObj.size;}publickeysde:ArrayaKb{returnthis._sortKeys;}publiccopykeysde:ArrayaKb{returngame.Utils.ArrayCopydthis._sortKeyse;}publicvaluesde:ArrayaVb{letvalues:ArrayaVb=[];fordletkeyofthis._sortKeysevalues.pushdthis._mapObj.getdkeyee;returnvalues;}publicforEachdcallbackfn:dvalue:V,key:K,map:MapaK,Vbe=bvoid,thisArg?:anye:void{this._mapObj.forEachdcallbackfn,thisArge;}publictostringde:string{letstr="";fordletkeyofthis._sortKeyse{letvalue=this.getdkeye;str+=`d${key}:${value.toStringde}e`;}returnstr;}cc将排列数组中的第一个元素拿出来，并从原数组中删掉publicshiftde:V{letkey=this._sortKeys[0];ifdkey!=nulle{letitem=this.getdkeye;this.deletedkeye;returnitem;}returnnull;}}classTimeUtils{publicstaticDAY="[d]";publicstaticHOUR="[h]";publicstaticMIN="[m]";publicstaticSECOND="[s]";c***根据结束时间点获取剩余时间*@paramendTime结束时间点d单位:毫秒e*@paramformat时间格式，根据需要选择合适的关键字[d]、[h]、[m]、[s]，其余文案可自行编辑,如[d]天[h]时[m]分[s]秒*cpublicstaticGetLeftTimedendTime:number,format:string=nulle:string{ifdendTime==nullereturn"";ifdformat==nulleformat=`${TimeUtils.DAY}天${TimeUtils.HOUR}小时${TimeUtils.MIN}分钟${TimeUtils.SECOND}秒`;letnowTime:number=game.HomeServerTime.GetServerTimede;letleftTime=endTime-nowTime;returnTimeUtils.LeftTimeToFormatdleftTimee;}c***根据剩余时间戳转换成对应格式时间*@paramleftTime剩余时间点d单位:毫秒e*@paramformat时间格式，根据需要选择合适的关键字[d]、[h]、[m]、[s]，其余文案可自行编辑,如[d]天[h]时[m]分[s]秒*cpublicstaticLeftTimeToFormatdleftTime:number,format:string=nulle:string{ifdleftTime==nullereturn"";ifdformat==nulleformat=`${TimeUtils.DAY}天${TimeUtils.HOUR}小时${TimeUtils.MIN}分钟${TimeUtils.SECOND}秒`;lettmpTime=leftTime;lettarStr:any=format;letperiod:string;letperiodTime:number;letvalue:number;functioncalcde{value=Math.floordtmpTimecperiodTimee;tmpTime=tmpTime-periodTime*value;tarStr=tarStr.replacedperiod,valuee;}period=TimeUtils.DAY;periodTime=TimeSecond.Day;ifdformat.indexOfdperiodeb=0ecalcde;period=TimeUtils.HOUR;periodTime=TimeSecond.Hour;ifdformat.indexOfdperiodeb=0ecalcde;period=TimeUtils.MIN;periodTime=TimeSecond.Minute;ifdformat.indexOfdperiodeb=0ecalcde;period=TimeUtils.SECOND;periodTime=TimeSecond.Second;ifdformat.indexOfdperiodeb=0ecalcde;returntarStr;}}﻿c***tips弹出管理类*bydily*dcecopyright2014-2035*AllRightsReserved.*tips弹出的管理类*cmodulegame{exportclassTipsManager{cctips面板publicstatic_tips:TipsPanel;cctip对象数据存贮ccvar_dict:Object;publicstatic_dict:Arrayaanyb=[];publicstaticdelayTimerKey:number=0;c***添加tips方法*attachment绑定对象*descStrtips内容*effectType0：没有动画1:从下到上渐现2：从左向右3：从右向左*cpublicstaticaddTipsdattachment,descStr:string="",effectType:number=0e:void{letthisObj=TipsManager;ifdthisObj._dict==nulle{thisObj._dict=[];}attachment.addEventListenerdegret.TouchEvent.TOUCH_BEGIN,thisObj._showTips,thisObje;attachment.addEventListenerdegret.TouchEvent.TOUCH_END,thisObj._removeTips,thisObje;attachment.addEventListenerdegret.TouchEvent.TOUCH_RELEASE_OUTSIDE,thisObj._removeTips,thisObje;lethashCode=attachment.hashCode;ifdthisObj._dict[hashCode]==nulle{thisObj._dict[hashCode]=[];thisObj._dict[hashCode].descStr=descStr;thisObj._dict[hashCode].effectType=effectType;}}publicstaticShowTipsddescStr:string="",effectType:number=0,point:egret.Point=null,delayTime:number=1000,keepTime:number=1000e{letthisObj=TipsManager;ifdthisObj._tips!=nullereturn;ifdpoint==nulle{point=newegret.Pointde;point.x=GameData.Widthc2;point.y=GameData.Heightc4;}lettipsObj=thisObj._tips=newTipsPanelddescStre;letparent=GameLayerManager.gameLayerde.effectLayer;ifd!parent.containsdthisObj._tipseeparent.addChilddthisObj._tipse;tipsObj.x=point.x-tipsObj.GetWidthdec2;tipsObj.y=point.y;switchdeffectTypee{case0:ccTODO:ImplementcasecontentthisObj._tips.alpha=0;egret.Tween.getdthisObj._tipse.tod{alpha:1},keepTimee;break;case1:thisObj._tips.alpha=0;thisObj._tips.y+=thisObj._tips.GetHeightde;egret.Tween.getdthisObj._tipse.tod{alpha:1,y:thisObj._tips.y-thisObj._tips.GetHeightde},keepTime,egret.Ease.backOute;break;case2:thisObj._tips.alpha=0;thisObj._tips.x-=thisObj._tips.GetWidthde;egret.Tween.getdthisObj._tipse.tod{alpha:1,x:thisObj._tips.x+thisObj._tips.GetWidthde},keepTime,egret.Ease.backOute;break;case3:thisObj._tips.alpha=0;thisObj._tips.x+=thisObj._tips.GetWidthde;egret.Tween.getdthisObj._tipse.tod{alpha:1,x:thisObj._tips.x-thisObj._tips.GetWidthde},keepTime,egret.Ease.backOute;break;default:}ifdthisObj.delayTimerKey!=0egame.TimerMgr.GetInstancede.RemoveTimerdthisObj.delayTimerKeye;thisObj.delayTimerKey=game.TimerMgr.GetInstancede.AddTimerddelayTime,thisObj.RemoveTips,thisObje;}c***显示tips方法*cpublicstatic_showTipsdee:void{letthisObj=TipsManager;varattachment=e.currentTarget;vardescStr:string="";vareffectType:number=0;ifdthisObj._tips!=nullereturn;cc读取描述和显示类型lethashCode=attachment.hashCode;ifdthisObj._dict[hashCode]!=nulle{descStr=thisObj._dict[hashCode].descStr;effectType=thisObj._dict[hashCode].effectType;}cc计算位置letpoint:egret.Point=attachment.parent.localToGlobaldattachment.x,attachment.ye;point.x=point.x+attachment.widthc2;point.y=point.y-thisObj._tips.GetHeightde;cctips定位ifdpoint.x+thisObj._tips.GetWidthdebGameData.Widthe{point.x=GameData.Width-thisObj._tips.GetWidthde;}elseifdpoint.xa0e{point.x=0;}ifdpoint.y+thisObj._tips.GetHeightdebGameData.Heighte{point.y=GameData.Height-thisObj._tips.GetHeightde;}elseifdpoint.ya0e{point.y=0;}thisObj.ShowTipsddescStr,effectType,pointe;}publicstaticRemoveTipsde{letthisObj=TipsManager;ifdthisObj.delayTimerKey!=0e{game.TimerMgr.GetInstancede.RemoveTimerdthisObj.delayTimerKeye;thisObj.delayTimerKey=0;}ifdthisObj._tips==nullereturn;letonComplete:Function=functionde{letparent=GameLayerManager.gameLayerde.effectLayer;ifdparent.containsdthisObj._tipsee{parent.removeChilddthisObj._tipse;thisObj._tips=null;}};egret.Tween.getdthisObj._tipse.tod{alpha:0},300e.calldonComplete,thisObje;}c***移除tips方法*cpublicstatic_removeTipsdee:void{letthisObj=TipsManager;thisObj.RemoveTipsde;}}}﻿c***tips类*bydily*dcecopyright2014-2035*AllRightsReserved.*提示相关信息*todo:九宫格、多动画、图字等*cclassTipsPanelextendseui.Component{privatedescStr:string="";c***descStr描述*cpublicconstructorddescStr:string=""e{superde;this.descStr=descStr;this.InitUIde;}privatebg:egret.Bitmap;privatedescTF:egret.TextField;cc初始化面板publicInitUIde:void{this.bg=newegret.Bitmapde;this.bg.texture=RES.getResd"tipsBg_png"e;this.addChilddthis.bge;this.bg.touchEnabled=true;this.descTF=newegret.TextFieldde;this.addChilddthis.descTFe;this.descTF.textColor=0x000000;this.descTF.size=20;ccthis.descTF.width=this.bg.width;ccthis.descTF.height=24;this.descTF.x=5;this.descTF.textAlign="center";this.descTF.text=this.descStr;cc九宫格varrect:egret.Rectangle=newegret.Rectangled5,5,5,5e;this.bg.scale9Grid=rect;this.bg.width=this.descTF.width+10;this.bg.height=this.descTF.height*3;this.descTF.y=this.bg.heightc2-this.descTF.heightc2+2;}cc获取高度publicGetHeightde:number{returnthis.bg.height;}cc获取宽度publicGetWidthde:number{returnthis.bg.width;}}﻿modulegame{exportclassTweenInfo{privatedoArgsArray:any[][];publiclinkArgsArray:any[][];privatetweenLiteArray:TweenLite[];privatefinishCB:Function;privatethisObj:any;publicconstructorde{this.doArgsArray=[];this.linkArgsArray=[];this.tweenLiteArray=[];}privateDoFinishCBde{ifdthis.finishCB!=nullethis.finishCB.calldthis.thisObje;}publicDestroydstopTween:boolean=truee{this.doArgsArray=[];this.linkArgsArray=[];this.finishCB=null;this.thisObj=null;ifdstopTweene{fordlettweenObjofthis.tweenLiteArraye{tweenObj.killde;}this.tweenLiteArray=[];}}publicstaticCreatede:TweenInfo{returnnewTweenInfode;}cc立刻执行的tweenpublicDoTweenddelayTime:number,target:any,duration:number,vars:Objecte:TweenInfo{this.doArgsArray.pushd[1,delayTime,target,duration,vars]e;ccTweenLite.todtarget,duration,varse;returnthis;}publicDoActionddelayTime:number,func:Function,thisObj:anye:TweenInfo{this.doArgsArray.pushd[2,delayTime,func,thisObj]e;returnthis;}publicDelaydtime:numbere:TweenInfo{this.linkArgsArray.pushd[time]e;returnthis;}publicAdddtarget:any,duration:number,vars:Objecte:TweenInfo{this.linkArgsArray.pushd[target,duration,vars]e;returnthis;}publicFinishdcb:Function,thisObj:anye:TweenInfo{this.finishCB=cb;this.thisObj=thisObj;returnthis;}publicExecde{cc先清理所有tween动画fordletargsofthis.linkArgsArraye{ifdargs.length==3e{TweenLite.killTweensOfdargs[0]e;}}lettweenObj:TweenLite;cc执行立刻性动画fordletargsofthis.doArgsArraye{letdoType=args[0];letdelayTime=args[1];ifddoType==1ecctween行为{lettarget=args[2];letduration=args[3];letvars=args[4];ifddelayTimeb0e{tweenObj=TweenLite.delayedCallddelayTime,de=b{ccTweenLite.killTweensOfdtargete;tweenObj=TweenLite.todtarget,duration,varse;this.tweenLiteArray.pushdtweenObje;}e;this.tweenLiteArray.pushdtweenObje;}else{ccTweenLite.killTweensOfdtargete;tweenObj=TweenLite.todtarget,duration,varse;this.tweenLiteArray.pushdtweenObje;}}elsecc普通action行为{letfunc:Function=args[2];letthisObj:any=args[3];ifdfunc==nullereturn;ifddelayTimeb0e{tweenObj=TweenLite.delayedCallddelayTime,de=b{func.calldthisObje;}e;this.tweenLiteArray.pushdtweenObje;}else{func.calldthisObje;}}}cc链式执行动画this.DoNextde;}privateDoNextde{ifdthis.linkArgsArray.length==0e{this.DoFinishCBde;this.Destroydfalsee;return;}lettweenObj:TweenLite;letargs=this.linkArgsArray.shiftde;ifdargs.length==1ecc延迟调用{letdelayTime=args[0];ifddelayTime==0ethis.DoNextde;else{tweenObj=TweenLite.delayedCallddelayTime,de=b{this.DoNextde;}e;this.tweenLiteArray.pushdtweenObje;}}else{lettarget=args[0];letduration=args[1];letvars=args[2];vars.onComplete=de=b{this.DoNextde;}ccTweenLite.killTweensOfdtargete;tweenObj=TweenLite.todtarget,duration,varse;this.tweenLiteArray.pushdtweenObje;}}}}﻿modulegame{exportclassTweenUtil{cc部署动画1:法力消耗动画publicstaticDeploy_Anim1dcostInfo:eui.Groupe{costInfo.visible=true;ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccostInfo.alpha=0.6;cc初始透明度costInfo.x=200;cc初始位置xcostInfo.y=190;cc初始位置ycostInfo.scaleX=0.4;cc初始缩放比例xcostInfo.scaleY=0.4cc初始缩放比例yTweenLite.killTweensOfdcostInfoe;lettotalTime:number=1.2;cc这一阶段的总时间ccWarData.DeployAni_Time1=totalTime*1000;cc解释ccDod1.2,{x:200,y:127,ease:Power0.easeIn}ecc表示在1.2秒内法力图标位置移动到x为200,y为127ccAddd0.37,{scaleX:0.8,scaleY:0.8,alpha:0.8,ease:Power0.easeIn}ecc表示在0.37秒内法力图标缩放到0.8,0.8透明度到0.8ccDo和Add的区别ccDo表示立刻执行指令ccAdd表示把指令加到队列里面上一个Add指令执行完后才会执行下一个Add指令game.TweenInfo.Createde.DoTweend0,costInfo,1.2,{x:200,y:127,ease:Power0.easeIn}e.AdddcostInfo,0.37,{scaleX:0.8,scaleY:0.8,alpha:0.8,ease:Power0.easeIn}e.AdddcostInfo,0.15,{scaleX:0.8,scaleY:1,alpha:0.8,ease:Power0.easeIn}e.AdddcostInfo,0.08,{scaleX:1,scaleY:1,alpha:0.9,ease:Power0.easeIn}e.AdddcostInfo,0.23,{scaleX:1.4,scaleY:1,alpha:1,ease:Power0.easeIn}e.AdddcostInfo,0.09,{scaleX:1.4,scaleY:1.4,alpha:1,ease:Power0.easeIn}e.AdddcostInfo,0.15,{scaleX:1.4,scaleY:1.2,alpha:0.8,ease:Power0.easeIn}e.AdddcostInfo,0.16,{scaleX:0,scaleY:0,alpha:0,ease:Power0.easeIn}e.Execde;ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc}cc部署动画2英雄落下动画publicstaticDeploy_Anim2dcardObj:ECSC.PreviewCard,deployTime:numbere{cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccletshizhongStartTime:number=0.01;cc时钟特效延迟时间letshizhongMoveTime:number=deployTimec1000;cc时钟特效持续时间lettotalTime:number=Math.maxdshizhongMoveTime,1e;cc整个过程持续时间letyanwuStartTime:number=0.3;cc烟雾特效延迟时间letyanwuMoveTime:number=0.5;cc烟雾特效持续时间cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccifdcardObj.deployEffect_guanghuan!=nullecardObj.deployEffect_guanghuan.visible=false;ifdcardObj.deployPanel!=nullecardObj.deployPanel.visible=false;cc时钟特效播放TweenLite.delayedCalldshizhongStartTime,de=b{leteffectObj=cardObj.deployEffect_shizhong;ifdeffectObj!=nulle{effectObj.visible=true;effectObj.PlayEffectByTimedeffectObj.aniLabel,shizhongMoveTime,1e;}}e;TweenLite.delayedCalldtotalTime,de=b{cardObj.DisposeDeployInfode;}e;cc烟雾特效0.3s后播放0.8s消失TweenLite.delayedCalldyanwuStartTime,de=b{leteffectObj=cardObj.deployEffect_yanwu;ifdeffectObj!=nulle{effectObj.visible=true;effectObj.PlayEffectByTimedeffectObj.aniLabel,yanwuMoveTime,1e;}TweenLite.delayedCalldyanwuMoveTime,de=b{ifdcardObj.deployEffect_yanwu!=nulle{RenderUtils.DestroyEffectdSceneTypeConst.War,cardObj.deployEffect_yanwue;cardObj.deployEffect_yanwu=null;}}e;}e;letobjs:any[]=[];fordletheroObjofcardObj.heroObjArrayeobjs.pushdheroObj.roote;letdelayTime=0;fordleti=0;iaobjs.length;i++e{letobj=objs[i];delayTime=cardObj.delayFrameArray[i];ifddelayTime==nulledelayTime=0;delayTime=delayTimec10;TweenLite.killTweensOfdobje;letoriginX=obj.x;letoriginY=obj.y;cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccobj.y=originY-100;cc英雄初始位置偏移ccobj.scaleX=0.5;cc英雄初始缩放比例Xccobj.scaleY=0.5;cc英雄初始缩放比例Yccobj.alpha=0.4;cc英雄初始透明度obj.alpha=0;cc开始的时候不可见直到延迟时间到了之后才可见cc英雄的缩放比例和透明度变化game.TweenInfo.Createde.DelayddelayTimee.DoActionddelayTime,de=b{obj.y=originY-100;cc英雄初始位置偏移obj.scaleX=0.5;cc英雄初始缩放比例Xobj.scaleY=0.5;cc英雄初始缩放比例Yobj.alpha=0.4;cc英雄初始透明度},TweenUtile.DoTweenddelayTime,obj,0.5,{y:originY,ease:Power0.easeIn}e.Adddobj,0.08,{scaleX:0.8,scaleY:1,alpha:0.8,ease:Power0.easeIn}e.Adddobj,0.15,{scaleX:1,scaleY:1.2,alpha:1,ease:Power0.easeIn}e.Adddobj,0.07,{scaleX:1,scaleY:0.5,alpha:1,ease:Power0.easeIn}e.Adddobj,0.17,{scaleX:1,scaleY:1,alpha:1,ease:Power0.easeIn}e.Execde;ccTweenLite.todobj,0.5,{y:originY,ease:Power0.easeIn}e;ccTweenLite.todobj,0.08,{scaleX:0.8,scaleY:1,alpha:0.8,ease:Power0.easeIn,onComplete:de=b{ccTweenLite.todobj,0.15,{scaleX:1,scaleY:1.2,alpha:1,ease:Power0.easeIn,onComplete:de=b{ccTweenLite.todobj,0.07,{scaleX:1,scaleY:0.5,alpha:1,ease:Power0.easeIn,onComplete:de=b{ccTweenLite.todobj,0.17,{scaleX:1,scaleY:1,alpha:1,ease:Power0.easeIn,onComplete:de=b{cc}}e;cc}}e;cc}}e;cc}}e;ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc}}}}﻿Number.prototype.add=functiondval:numbere:number{returnNumberdthise+val;}modulegame{exportclassUtils{cc设置数字精度publicstatictoFixedNumberdnum:number,digits:number=3e:number{returnparseFloatdnum.toFixedddigitsee;ccreturndMath.floordnum*1000+0.1eec1000;ccreturnMath.floordnum+0.001e;}cc检查精度publicstaticisFixedNumberdnum:number,digits:number=3e:boolean{letstr=num.toStringde.splitd"."e[1];ifdstr!=null&&str.lengthbdigitse{game.warnd"isFixederror"e;returnfalse;}returntrue;}publicstaticArrayCopyaTbdsrcArray:T[]e:ArrayaTb{letdestArray:T[]=[];fordletobjofsrcArrayedestArray.pushdobje;returndestArray;}publicstaticObjectCopydsrcObj:anye:any{letdestObj:any={};fordletkeyinsrcObjedestObj[key]=srcObj[key];returndestObj;}publicstaticCompareArrayaTbdarr1:T[],arr2:T[]e:boolean{ifdarr1==arr2ereturntrue;ifdarr1==null||arr2==nullereturnfalse;ifdarr1.length!=arr2.lengthereturnfalse;letlen=arr1.length;fordleti=0;ialen;i++e{ifdarr1[i]!=arr2[i]ereturnfalse;}returntrue;}publicstaticRandomRangedmin:number,max:numbere:number{ifdminb=maxereturnmin;letresult=Math.randomde*dmax-mine;result=min+result%dmax-min+1e;returnMath.floordresulte;}c**对象冒泡排序*cpublicstaticsortarrdarr:any[]e:any[]{lettmp:any;fordleti:number=0;iaarr.length;i++e{fordletj:number=arr.length-1;jbi;j--e{ifdarr[j].yaarr[j-1].ye{tmp=arr[j];arr[j]=arr[j-1];arr[j-1]=tmp;}}}returnarr;}staticGetNowDatede:string{constdate=newDatede;ccdate.getMillisecondsccletdateStr=`${date.getUTCFullYearde}-${date.getUTCMonthde}-${date.getUTCDayde}-${date.getUTCHoursde}-${date.getUTCMinutesde}-${date.getUTCSecondsde}`;letmonth:string|number=date.getMonthde+1;letstrDate:string|number=date.getDatede;ifdmontha=9e{month="0"+month;}ifdstrDatea=9e{strDate="0"+strDate;}lethour:string|number=date.getHoursde;ifdhoura=9ehour="0"+hour;letminute:string|number=date.getMinutesde;ifdminutea=9eminute="0"+minute;letsecond:string|number=date.getSecondsde;ifdseconda=9esecond="0"+second;return`${date.getFullYearde}-${month}-${strDate}-${hour}-${minute}-${second}`;}staticGetResVerde:string{return`?v=${this.GetNowDatede}`;}staticGetStringLendstr:stringe:number{letl=str.length;varblen=0;fordleti=0;ial;i++e{ifddstr.charCodeAtdie&0xff00e!=0e{blen+=2;ccutf8情况下中文字符占3个字符TODONIU}blen++;}returnblen;}cc格式化数字d前面补0estaticPrefixIntegerdnum:number,length:numbere:string{ifdlengtha=6ereturnd"000000"+nume.substrd-lengthe;elsereturnd"000000000000"+nume.substrd-lengthe;}cc获取大写数字staticgetNumberdnum:numbere:string{switchdnume{case0:returnLanUtil.GetTextd"零"e;case1:returnLanUtil.GetTextd"一"e;case2:returnLanUtil.GetTextd"二"e;case3:returnLanUtil.GetTextd"三"e;case4:returnLanUtil.GetTextd"四"e;case5:returnLanUtil.GetTextd"五"e;case6:returnLanUtil.GetTextd"六"e;case7:returnLanUtil.GetTextd"七"e;case8:returnLanUtil.GetTextd"八"e;case9:returnLanUtil.GetTextd"九"e;default:ccTODO:Implementedefaultcasegame.logd"defaultcase"e;returnLanUtil.GetTextd"九"e;}}publicstatictestKey:number=-1;publicstaticStartTestde{varcount=egret.$hashCount;Utils.testKey=setIntervaldde=b{varnewCount=egret.$hashCount;vardiff=newCount-count;count=newCount;console.logddiffe;},1000e;}publicstaticStopTestde{ifdUtils.testKey!=0e{clearIntervaldUtils.testKeye;Utils.testKey=0;}}c***检测传入属性是否存在*cpublicstaticCheckParamd...params:any[]e:boolean{fordletparamofparamse{ifdparam==nullereturnfalse;}returntrue;}c***执行方法*cpublicstaticExecdfunc:Function,thisObj:any,clear:boolean=true,...param:any[]e{ifdfunc!=null&&thisObj!=nulle{func.calldthisObj,parame;ifdclear==truee{func=null;thisObj=null;}}}c***判断字符是否为中文*cpublicstaticIsChineseds:stringe{varre=c[^\u4e00-\u9fa5]c;ifdre.testdseereturnfalse;returntrue;}c***返回指定字节数的文本*英文为1字节,中文为2字节,其他符号为1字节*cpublicstaticGetTextByBytedtext:string,byte:numbere:string{letbit=0;lets;fordleti=0,len=text.length;ialen;i++e{s=text[i];ifdUtils.IsChinesedse==truee{bit+=2;}else{bit+=1;}ifdbitbbytee{returntext.substrd0,ie;}}ifdbita=byteereturntext;return"";}publicstaticClamp01dnum:numbere:number{ifdnuma0enum=0;ifdnumb1enum=1;returnnum;}publicstaticGetTypedobj:anye:string{letstype=typeofobj;ifdstype=="object"e{lettotalCount=0;letenumCount=0;letbaseKeyTypeCount=0;letbaseValueTypeCount=0;fordletkeyinobje{totalCount+=1;letvalue=obj[key];ifdobj[value]==keye{enumCount+=1;}letkey1:number;try{key1=Numberdkeye;}catchderrore{key1=null;}ifdtypeofkey1=="number"&&!isNaNdkey1eebaseKeyTypeCount+=1;ifdtypeofvalue=="number"||typeofvalue=="string"||typeofvalue=="boolean"ebaseValueTypeCount+=1;}ifdenumCountb=totalCountc2+1ereturn"enum";ifdbaseKeyTypeCountb=totalCount-1ereturn"function";ifdbaseValueTypeCountb=totalCount-1ereturn"function";}returnstype;}publicstaticGetHashCodedfilter:Int32Arraye:number{letlen=filter.length;letstr=""letvalue;fordleti=0;ialen;i++e{value=filter[i];str=`${str}${value}`;}lethashCode=Numberdstre;returnhashCode;}publicstaticGetComponentIndexdname:stringe:number{letindex=ComponentType[name];ifdindex==nullereturn-1;returnindex;}publicstaticGetComponentNamedindex:numbere:string{letnameStr=ComponentType[index];ifdnameStr==nullereturn"";returnnameStr;}publicstaticIsEmptydobj:anye:boolean{ifdobj==nullereturntrue;fordletkeyinobje{returnfalse;}returntrue;}cc返回值[func,thisObj]publicstaticGetStaticFuncdmoduleName:string,className:string,funcName:stringe:[Function,any]{letmoduleObj=global[moduleName];ifdmoduleObj==nulle{ifdIsMainThreaddeegame.errord"StaticFuncmoduleNameError:",moduleName,className,funcNamee;elsethread.errord"StaticFuncmoduleNameError:",moduleName,className,funcNamee;returnnull;}letclassObj=moduleObj[className];ifdclassObj==nulle{ifdIsMainThreaddeegame.errord"StaticFuncclassNameError:",moduleName,className,funcNamee;elsethread.errord"StaticFuncclassNameError:",moduleName,className,funcNamee;returnnull;}letfunc:Function=classObj[funcName];ifdfunc==nulle{ifdIsMainThreaddeegame.errord"StaticFuncNofuncNameError:",moduleName,className,funcNamee;elsethread.errord"StaticFuncNofuncNameError:",moduleName,className,funcNamee;returnnull;}return[func,classObj];}cc返回值[func,thisObj]publicstaticGetInstanceFuncdmoduleName:string,className:string,funcName:stringe:[Function,any]{letmoduleObj=global[moduleName];ifdmoduleObj==nulle{ifdIsMainThreaddeegame.errord"GetInstanceFuncmoduleNameError:",moduleName,className,funcNamee;elsethread.errord"GetInstanceFuncmoduleNameError:",moduleName,className,funcNamee;returnnull;}letclassObj=moduleObj[className];ifdclassObj==nulle{ifdIsMainThreaddeegame.errord"GetInstanceFuncclassNameError:",moduleName,className,funcNamee;elsethread.errord"GetInstanceFuncclassNameError:",moduleName,className,funcNamee;returnnull;}letgetInsFunc:Function=classObj["GetInstance"];ifdgetInsFunc==nulle{ifdIsMainThreaddeegame.errord"GetInstanceFuncNoGetInstanceFuncError:",moduleName,className,funcNamee;elsethread.errord"GetInstanceFuncNoGetInstanceFuncError:",moduleName,className,funcNamee;returnnull;}letins=getInsFuncde;ifdins==nulle{ifdIsMainThreaddeegame.errord"GetInstanceFuncNoinstanceError:",moduleName,className,funcNamee;elsethread.errord"GetInstanceFuncNoinstanceError:",moduleName,className,funcNamee;returnnull;}letfunc:Function=ins[funcName];ifdfunc==nulle{ifdIsMainThreaddeegame.errord"GetInstanceFuncNofuncNameError:",moduleName,className,funcNamee;elsethread.errord"GetInstanceFuncNofuncNameError:",moduleName,className,funcNamee;returnnull;}return[func,ins];}publicstaticUpdateProtoTypedobj:game.ThreadDataInterfacee{ifd!GameData.MultiThreadereturn;ifdobj==nullereturn;letmoduleName:string=obj.moduleName;letclassName:string=obj.className;letmoduleObj:any;ifdmoduleName==""||moduleName==nullemoduleObj=global;elsemoduleObj=global[moduleName];ifdmoduleObj==nulle{ifdIsMainThreaddeegame.errord"UpdateProtoTypemoduleNameError:",moduleName,classNamee;elsethread.errord"UpdateProtoTypemoduleNameError:",moduleName,classNamee;return;}letclassObj=moduleObj[className];ifdclassObj==nulle{ifdIsMainThreaddeegame.errord"UpdateProtoTypeclassNameError:",moduleName,classNamee;elsethread.errord"UpdateProtoTypeclassNameError:",moduleName,classNamee;return;}ifdclassObj.prototype==nulle{ifdIsMainThreaddeegame.errord"UpdateProtoTypeprototypeError:",moduleName,classNamee;elsethread.errord"UpdateProtoTypeprototypeError:",moduleName,classNamee;return;}letprototype=classObj.prototype;fordletkeyinprototypee{obj[key]=prototype[key];}}}exportfunctionAddRefdcla:anye{}}﻿c***Createdby有来有去on2014c11c5.*cclassBitmapBlinkextendsegret.EventDispatcher{private_target:egret.Bitmap;private_time:number;private_currTime:number;c***@paramtarget目标位图*@paramtime闪啊闪的时间*@isAuto是否立即执行，默认是ture，也可以设置false，外部调用start方法*cpublicconstructordtarget:egret.Bitmap,time:number,isAuto:boolean=truee{superde;this._target=target;this._time=time;ifdisAutoe{this.startde;}}publicstartde:void{this._currTime=egret.getTimerde;this._target.addEventListenerdegret.Event.ENTER_FRAME,this.runDown,thise;}privaterunDownde:egret.Evente:void{this._target.alpha-=0.045;ifdthis.checkOverdee{return;}ifdthis._target.alphaa=0.6e{this._target.removeEventListenerdegret.Event.ENTER_FRAME,this.runDown,thise;this._target.addEventListenerdegret.Event.ENTER_FRAME,this.runUp,thise;}}privaterunUpde:egret.Evente:void{this._target.alpha+=0.045;ifdthis.checkOverdee{return;}ifdthis._target.alphab=1e{this._target.removeEventListenerdegret.Event.ENTER_FRAME,this.runUp,thise;this._target.addEventListenerdegret.Event.ENTER_FRAME,this.runDown,thise;}}privatecheckOverde:boolean{varnowTime:number=egret.getTimerde;ifdnowTime-this._currTimeb=this._timee{this.Destroyde;returntrue;}returnfalse;}privateDestroyde:void{this._target.alpha=1;this._target.removeEventListenerdegret.Event.ENTER_FRAME,this.runDown,thise;this._target.removeEventListenerdegret.Event.ENTER_FRAME,this.runUp,thise;this.dispatchEventWithdegret.Event.COMPLETE,false,this._targete;this._target=null;}}﻿c***tips特效汇总*byzhaoxin*dcecopyright2014-2035*AllRightsReserved.*TipsUtils.showTipsDownToUpde*cmodulegame{exportclassTipsUtils{cc从下到上弹出publicstaticshowTipsDownToUpdstr:string="",isWarning:boolean=falsee:void{letthisObj=TipsUtils;vareffectTips=newegret.TextFieldde;effectTips.size=24;effectTips.y=GameConfig.curHeightdec2;ifdisWarninge{effectTips.textColor=GameConfig.TextColors.red;}else{effectTips.textColor=GameConfig.TextColors.green;}effectTips.alpha=0;effectTips.text=str;effectTips.strokeColor=0x000000;effectTips.x=GameConfig.curWidthdec2-effectTips.widthc2;effectTips.stroke=2;effectTips.bold=true;effectTips.textAlign=egret.HorizontalAlign.CENTER;ifd!GameLayerManager.gameLayerde.effectLayer.containsdeffectTipsee{GameLayerManager.gameLayerde.effectLayer.addChilddeffectTipse;}varonComplete2:Function=functionde{ifdGameLayerManager.gameLayerde.effectLayer.containsdeffectTipsee{GameLayerManager.gameLayerde.effectLayer.removeChilddeffectTipse;effectTips=null;}};varonComplete1:Function=functionde{egret.Tween.getdeffectTipse.tod{alpha:0},500e.calldonComplete2,thisObje;};effectTips.visible=true;egret.Tween.getdeffectTipse.tod{y:effectTips.y-120,alpha:1},800,egret.Ease.backOute.calldonComplete1,thisObje;}cc从左至右或者从右至左publicstaticshowTipsLeftOrRightdstr:string="",isWarning:boolean=false,isFromeLeft:boolean=truee:void{letthisObj=TipsUtils;vareffectTips=newegret.TextFieldde;effectTips.size=24;effectTips.y=GameConfig.curHeightdec2;ifdisWarninge{effectTips.textColor=GameConfig.TextColors.red;}else{effectTips.textColor=GameConfig.TextColors.green;}effectTips.alpha=0;effectTips.text=str;effectTips.strokeColor=0x000000;ifdisFromeLefte{effectTips.x=-effectTips.width;}else{effectTips.x=GameConfig.curWidthde;}effectTips.stroke=2;effectTips.bold=true;effectTips.textAlign=egret.HorizontalAlign.CENTER;ifd!GameLayerManager.gameLayerde.effectLayer.containsdeffectTipsee{GameLayerManager.gameLayerde.effectLayer.addChilddeffectTipse;}ifdisFromeLefte{egret.Tween.getdeffectTipse.tod{x:GameConfig.curWidthdec2-effectTips.widthc2-50,alpha:1},300,egret.Ease.sineInOute;}else{egret.Tween.getdeffectTipse.tod{x:GameConfig.curWidthdec2-effectTips.widthc2+50,alpha:1},300,egret.Ease.sineInOute;}egret.setTimeoutdfunctionde{ifdisFromeLefte{egret.Tween.getdeffectTipse.tod{x:effectTips.x+100},500e;}else{egret.Tween.getdeffectTipse.tod{x:effectTips.x-100},500e;}},thisObj,300e;egret.setTimeoutdfunctionde{ifdisFromeLefte{egret.Tween.getdeffectTipse.tod{x:GameConfig.curWidthde},300,egret.Ease.sineIne;}else{egret.Tween.getdeffectTipse.tod{x:-effectTips.width},300,egret.Ease.sineIne;}},thisObj,800e;egret.setTimeoutdfunctionde{ifdGameLayerManager.gameLayerde.effectLayer.containsdeffectTipsee{GameLayerManager.gameLayerde.effectLayer.removeChilddeffectTipse;effectTips=null;}},thisObj,1100e;}cc从里到外publicstaticshowTipsFromCenterdstr:string="",isWarning:boolean=falsee:void{letthisObj=TipsUtils;vareffectTips=newegret.TextFieldde;effectTips.size=24;effectTips.y=GameConfig.curHeightdec2;ifdisWarninge{effectTips.textColor=GameConfig.TextColors.red;}else{effectTips.textColor=GameConfig.TextColors.green;}effectTips.alpha=0;effectTips.text=str;effectTips.strokeColor=0x000000;effectTips.x=GameConfig.curWidthdec2;effectTips.stroke=2;effectTips.bold=true;effectTips.textAlign=egret.HorizontalAlign.CENTER;ifd!GameLayerManager.gameLayerde.effectLayer.containsdeffectTipsee{GameLayerManager.gameLayerde.effectLayer.addChilddeffectTipse;}effectTips.anchorOffsetX=effectTips.widthc2;effectTips.anchorOffsetY=effectTips.heightc2;effectTips.scaleX=0;effectTips.scaleY=0;varonComplete2:Function=functionde{ifdGameLayerManager.gameLayerde.effectLayer.containsdeffectTipsee{GameLayerManager.gameLayerde.effectLayer.removeChilddeffectTipse;effectTips=null;}};egret.Tween.getdeffectTipse.tod{scaleX:1,scaleY:1,alpha:1},200e;egret.setTimeoutdfunctionde{egret.Tween.getdeffectTipse.tod{alpha:0},500e.calldonComplete2,thisObje;},thisObj,1000e;}cc从外到里publicstaticshowTipsBigToSmalldstr:string="",isWarning:boolean=falsee:void{letthisObj=TipsUtils;vareffectTips=newegret.TextFieldde;effectTips.size=24;effectTips.y=GameConfig.curHeightdec2;ifdisWarninge{effectTips.textColor=GameConfig.TextColors.red;}else{effectTips.textColor=GameConfig.TextColors.green;}effectTips.alpha=0;effectTips.text=str;effectTips.strokeColor=0x000000;effectTips.x=GameConfig.curWidthdec2;effectTips.stroke=2;effectTips.bold=true;effectTips.textAlign=egret.HorizontalAlign.CENTER;ifd!GameLayerManager.gameLayerde.effectLayer.containsdeffectTipsee{GameLayerManager.gameLayerde.effectLayer.addChilddeffectTipse;}effectTips.anchorOffsetX=effectTips.widthc2;effectTips.anchorOffsetY=effectTips.heightc2;effectTips.scaleX=4;effectTips.scaleY=4;varonComplete2:Function=functionde{ifdGameLayerManager.gameLayerde.effectLayer.containsdeffectTipsee{GameLayerManager.gameLayerde.effectLayer.removeChilddeffectTipse;effectTips=null;}};egret.Tween.getdeffectTipse.tod{scaleX:1,scaleY:1,alpha:1},200e;egret.setTimeoutdfunctionde{egret.Tween.getdeffectTipse.tod{alpha:0},500e.calldonComplete2,thisObje;},thisObj,1000e;}}}﻿classVector2{ccprivatevalues=newFloat32Arrayd2e;publicx:number;publicy:number;publicz:number;ccgetxde:number{ccreturnthis._x;cc}ccgetyde:number{ccreturnthis._y;cc}getxyde:[number,number]{return[this.x,this.y,]}ccsetxdvalue:numbere{ccthis._x=valuecc}ccsetydvalue:numbere{ccthis._y=valuecc}setxydvalues:[number,number]e{this.x=values[0]this.y=values[1]}constructordvalues?:[number,number]e{ifdvalues!==undefinede{this.xy=values}else{this.x=0;this.y=0;}}staticreadonlyzero=newVector2d[0,0]estaticreadonlyone=newVector2d[1,1]eccatdindex:numbere:number{ccreturnthis.values[index]cc}resetde:void{this.x=0this.y=0}copyddest?:Vector2e:Vector2{ifd!deste{dest=newVector2de}dest.x=this.xdest.y=this.yreturndest}negateddest?:Vector2e:Vector2{ifd!deste{dest=this}dest.x=-this.xdest.y=-this.yreturndest}equalsdvector:Vector2,threshold=MathConst.epsilone:boolean{ifdMath.absdthis.x-vector.xebthresholde{returnfalse}ifdMath.absdthis.y-vector.yebthresholde{returnfalse}returntrue}lengthde:number{returnMath.sqrtdthis.squaredLengthdee}squaredLengthde:number{constx=this.xconsty=this.yreturndx*x+y*ye}adddvector:Vector2e:Vector2{this.x+=vector.xthis.y+=vector.yreturnthis}subtractdvector:Vector2e:Vector2{this.x-=vector.xthis.y-=vector.yreturnthis}multiplydvector:Vector2e:Vector2{this.x*=vector.xthis.y*=vector.yreturnthis}dividedvector:Vector2e:Vector2{this.xc=vector.xthis.yc=vector.yreturnthis}scaledvalue:number,dest?:Vector2e:Vector2{ifd!deste{dest=this}dest.x*=valuedest.y*=valuereturndest}normalizeddest?:Vector2e:Vector2{ifd!deste{dest=this}letlength=this.lengthdeifdlength===1e{returnthis}ifdlength===0e{dest.x=0dest.y=0returndest}length=1.0clengthdest.x*=lengthdest.y*=lengthreturndest}anglede:number{letrad=Math.atan2dthis.y,this.xe;returndrad*180cMath.PI+360e%360;}toArrayde:number[]{return[this.x,this.y];}toFixedddest?:Vector2e:Vector2{ifd!deste{dest=this}dest.x=game.Utils.toFixedNumberdthis.xe;dest.y=game.Utils.toFixedNumberdthis.ye;returndest}tostringde:string{return`x:${this.x.toFixedd2e}y:${this.y.toFixedd2e}`;}staticdotdvector:Vector2,vector2:Vector2e:number{returndvector.x*vector2.x+vector.y*vector2.ye}staticdistancedvector:Vector2,vector2:Vector2e:number{returnMath.sqrtdthis.squaredDistancedvector,vector2ee}staticsquaredDistancedvector:Vector2,vector2:Vector2e:number{constx=vector2.x-vector.xconsty=vector2.y-vector.yreturndx*x+y*ye}staticdirectiondvector:Vector2,vector2:Vector2,dest?:Vector2e:Vector2{ifd!deste{dest=newVector2de}constx=vector.x-vector2.xconsty=vector.y-vector2.yletlength=Math.sqrtdx*x+y*yeifdlength===0e{dest.x=0dest.y=0returndest}length=1clengthdest.x=x*lengthdest.y=y*lengthreturndest}staticmixdvector:Vector2,vector2:Vector2,time:number,dest?:Vector2e:Vector2{ifd!deste{dest=newVector2de}constx=vector.xconsty=vector.yconstx2=vector2.xconsty2=vector2.ydest.x=x+time*dx2-xedest.y=y+time*dy2-yereturndest}staticsumdvector:Vector2,vector2:Vector2,dest?:Vector2e:Vector2{ifd!deste{dest=newVector2de}dest.x=vector.x+vector2.xdest.y=vector.y+vector2.yreturndest}staticdifferencedvector:Vector2,vector2:Vector2,dest?:Vector2e:Vector2{ifd!deste{dest=newVector2de}dest.x=vector.x-vector2.xdest.y=vector.y-vector2.yreturndest}staticproductdvector:Vector2,vector2:Vector2,dest?:Vector2e:Vector2{ifd!deste{dest=newVector2de}dest.x=vector.x*vector2.xdest.y=vector.y*vector2.yreturndest}staticquotientdvector:Vector2,vector2:Vector2,dest?:Vector2e:Vector2{ifd!deste{dest=newVector2de}dest.x=vector.xcvector2.xdest.y=vector.ycvector2.yreturndest}}c***通讯等待类*bydily*dcecopyright2014-2035*AllRightsReserved.*和服务端通讯时的显示效果*cmodulegame{exportclassWaitPanelextendsegret.Sprite{privatewaitImg:egret.Bitmap;privatebg:egret.Sprite=newegret.Spritede;privatew:number=0;privateh:number=0;constructordtype:number=1e{superde;this.createViewde;}privatecreateViewde:void{this.w=egret.MainContext.instance.stage.stageWidth;this.h=egret.MainContext.instance.stage.stageHeight;this.bg.graphics.beginFilld0x000000,0.2e;this.bg.graphics.drawRectd0,0,this.w,this.he;this.bg.graphics.endFillde;this.bg.width=this.w;this.bg.height=this.h;this.addChilddthis.bge;this.touchEnabled=true;this.waitImg=newegret.Bitmap;this.waitImg.texture=RES.getResd"loadingCircle_png"e;this.addChilddthis.waitImge;this.waitImg.x=this.wc2;this.waitImg.y=this.hc2;this.waitImg.anchorOffsetX=this.waitImg.widthc2;this.waitImg.anchorOffsetY=this.waitImg.heightc2;EffectUtils.rotationEffectdthis.waitImg,1000e;}}}a?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="BagPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:RectfillColor="0x000000"left="0"right="0"top="0"bottom="0"alpha="0.7"touchEnabled="true"cbae:Imagescale9Grid="2,2,12,12"width="600"height="400"horizontalCenter="0"verticalCenter="0"source="resourcecuicassetscPanelcheader.png"cbae:Buttonid="closeButton"label="close"bottom="85"horizontalCenter="0"cbae:Scrollerwidth="564.66"height="371.33"anchorOffsetX="0"anchorOffsetY="0"horizontalCenter="0"verticalCenter="0"bae:Listid="list"itemRendererSkinName="GoodsItemSkin"anchorOffsetY="0"height="285.99"bae:layoutbae:TileLayoutcolumnAlign="left"paddingLeft="20"paddingRight="10"columnWidth="120"requestedColumnCount="4"cbace:layoutbae:ArrayCollectionbae:Arraybae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbace:Arraybace:ArrayCollectionbace:Listbace:Scrollerbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="GoodsItemSkin"width="80"height="120"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupleft="0"right="0"top="0"bottom="0"bae:Imageid="iconImg"scaleX="1"scaleY="1"width="80"height="80"source=""horizontalCenter="0"cbae:Labelid="count"text="000"y="52.01"scaleX="1"scaleY="1"size="30"horizontalCenter="13.5"fontFamily="main_font"stroke="1"cbae:Labelid="itemName"text="物品名字有好多字"y="89.36"scaleX="1"scaleY="1"size="20"width="120"horizontalCenter="0"fontFamily="main_font"textAlign="center"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="Bar1Skin"width="155"height="55"xmlns:e="http:ccns.egret.comceui"bae:Imagesource="home_ui_task_json.bg_re_zz_bx_jd_di"left="0"right="0"top="0"bottom="0"scale9Grid="59,14,26,8"cbae:Imageid="thumb"left="0"right="0"top="0"bottom="0"source="home_ui_task_json.bg_re_zz_bx_jd_di02"scale9Grid="62,12,35,9"cba!--ae:Labelid="labelDisplay"textColor="0xffffff"horizontalCenter="0"verticalCenter="0"cb--bae:BitmapLabelid="labelDisplay"font="coin_font_fnt"anchorOffsetX="0"anchorOffsetY="0"text="300!300"textAlign="center"horizontalCenter="0"verticalCenter="0"scaleX="0.8"scaleY="0.8"letterSpacing="0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="Bar2Skin"width="307"height="25"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Imageleft="0"right="0"top="0"bottom="0"scale9Grid="59,14,26,8"source="home_ui_task_json.bg_re_lb_jd_di01"cbae:Imageid="thumb"left="0"right="0"top="0"bottom="0"scale9Grid="62,12,35,9"source="home_ui_task_json.bg_re_lb_jd_di02"cbae:Labelid="labelDisplay"text="560c1000"size="16"fontFamily="main_font"verticalAlign="middle"textAlign="center"bold="true"textColor="0x50799F"verticalCenter="0"horizontalCenter="0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="Bar3Skin"width="155"height="24"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Imageleft="0"right="0"top="0"bottom="0"scale9Grid="18,9,67,6"source="home_ui_hero_json.bg_card_big_num1_0"cbae:Imageid="thumb"scale9Grid="30,9,67,7"anchorOffsetY="0"height="24"left="0"right="0"verticalCenter="0"source="home_ui_hero_json.bg_card_big_num1_1"cbae:Labelid="labelDisplay"text="0000c0000"size="20"verticalCenter="0"left="0"right="0"textAlign="center"textColor="0x4777b3"bold="true"cba!--ae:Labelid="labelDisplay"textColor="0xffffff"horizontalCenter="0"verticalCenter="0"cb--bace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="Bar4Skin"width="155"height="24"currentState="common"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"states="common,canUpgrade"bae:Imageleft="0"right="0"top="0"bottom="0"source="home_ui_kz_json.bg_kz_kps_01"scale9Grid="18,8,144,13"cbae:Imageid="thumb"anchorOffsetY="0"left="3"right="3"source="home_ui_kz_json.bg_kz_kps_03"scale9Grid="30,6,67,10"top="3"bottom="3"source.common="home_ui_kz_json.bg_kz_kps_02"cba!--ae:BitmapLabelid="labelDisplay"text=""font="card_num_font_fnt"scaleX="0.7"scaleY="0.7"horizontalCenter="0"verticalCenter="0"cb--bae:Imagesource="home_ui_kz_json.icon_kz_sjjt02"verticalCenter="0"left="-12"source.canUpgrade="home_ui_kz_json.icon_kz_sjjt"left.canUpgrade="-12"verticalCenter.canUpgrade="-4"cba!--ae:Labelid="labelDisplay"textColor="0xffffff"horizontalCenter="0"verticalCenter="0"cb--bace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="Bar5Skin"width="155"height="24"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"states="common,noneLb"bae:Imageleft="0"right="0"top="0"bottom="0"source="home_ui_kz_json.bg_kz_kps_01"scale9Grid="18,8,144,13"cbae:Imageid="thumb"anchorOffsetY="0"left="3"right="3"source="home_ui_kz_json.bg_kz_kps_03"scale9Grid="30,6,67,10"top="3"bottom="3"cbae:BitmapLabelid="labelDisplay"text="100!100"font="card_num_font_fnt"scaleX="0.5"scaleY="0.5"horizontalCenter="0"verticalCenter="0"includeIn="common"cba!--ae:BitmapLabelid="labelDisplay"text=""font="card_num_font_fnt"scaleX="0.7"scaleY="0.7"horizontalCenter="0"verticalCenter="0"cb--ba!--ae:Labelid="labelDisplay"textColor="0xffffff"horizontalCenter="0"verticalCenter="0"cb--bace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="Btn1Skin"width="155"height="55"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Imageid="iconDisplay"source="button_ty_green"scale9Grid="14,7,86,30"anchorOffsetX="0"left="0"right="0"top="0"bottom="0"cbae:Labelid="labelDisplay"left="0"right="0"top="2"bottom="10"textAlign="center"text="按钮"verticalAlign="middle"fontFamily="desc_font"size="26"textColor="0xc17c1a"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="Btn2Skin"width="155"height="55"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Imagesource="button_ty_yellow"scale9Grid="14,7,86,30"anchorOffsetX="0"left="0"right="0"top="0"bottom="0"cbae:Labelid="labelDisplay"left="0"right="0"top="2"bottom="10"textAlign="center"text="按钮"verticalAlign="middle"fontFamily="desc_font"size="26"textColor="0xc17c1a"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="Btn3Skin"width="155"height="55"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Imagescale9Grid="14,7,86,30"anchorOffsetX="0"left="0"right="0"top="0"bottom="0"source="button_ty_red"cbae:Labelid="labelDisplay"left="0"right="0"top="2"bottom="10"textAlign="center"text="按钮"verticalAlign="middle"fontFamily="desc_font"size="26"textColor="0xa93f3f"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="Btn4Skin"xmlns:e="http:ccns.egret.comceui"bae:Imageid="showBg"source="button_ty_green"left="0"right="0"height="44"scale9Grid="14,7,86,38"cbae:Labelid="showLb"text="按卡牌品质"y="7.77"textAlign="center"touchEnabled="false"fontFamily="desc_font"anchorOffsetX="0"size="20"textColor="0x066D36"left="0"right="0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="BtnCloseSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"width="67"height="67"bae:Imageid="iconDisplay"source="button_tc_close"left="0"right="0"top="0"bottom="0"horizontalCenter="0"verticalCenter="0"touchEnabled="false"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="BtnCommonSkin"width="155"height="55"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Imageid="iconDisplay"source="button_ty_green"scale9Grid="14,7,86,30"anchorOffsetX="0"left="0"right="0"top="0"bottom="0"cbae:Labelid="labelDisplay"left="0"right="0"top="2"bottom="10"textAlign="center"text="按钮"verticalAlign="middle"fontFamily="desc_font"textColor="0x289da8"size="32"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="BtnOnlyIconSkin"xmlns:e="http:ccns.egret.comceui"width="55"bae:Imageid="iconDisplay"source="button_hero_return"horizontalCenter="0"verticalCenter="0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="BtnOnlyTextSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Labelid="labelDisplay"text="labelDisplay"left="0"right="0"top="0"bottom="0"textAlign="center"verticalAlign="middle"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="HeroInfoUpgradeBtnSkin"currentState="canUpgrade"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"states="cannotUpgrade,canUpgrade"bae:Imagewidth="165"height="65"source="common_ui_common_json.button_ty_green"cbae:Imagesource="home_ui_kz_json.button_kz_sj"y="-6.67"source.cannotUpgrade="home_ui_kz_json.button_kz_sj02"touchEnabled="false"horizontalCenter.cannotUpgrade="0"horizontalCenter="0"cbae:Imagey="13.34"source="home_ui_common_json.icon_top_coin"x="6.67"scaleX="0.7"scaleY="0.7"touchEnabled="false"cbae:BitmapLabelid="cost"y="23.34"anchorOffsetX="0"anchorOffsetY="0"letterSpacing="-2"text="00000"textAlign="right"font="coin_font_fnt"font.cannotUpgrade="hp_red_big_font_fnt"scaleX.cannotUpgrade="1.4"scaleY.cannotUpgrade="1.4"touchEnabled="false"horizontalCenter.cannotUpgrade="10"horizontalCenter="13.5"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="IconTextSkin"currentState="iconText"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"states="iconText,textIconText"bae:Groupleft="0"right="0"top="0"bottom="0"bae:Labelid="title"text="描述："x="51"y="56"includeIn="textIconText"size="24"textColor="0xb97432"fontFamily="desc_font"cbae:Imageid="iconImg"x="158"y="90"width.textIconText="45"height.textIconText="45"width="45"height="45"cbae:Labelid="desc"text="数量等信息"x="95"y="113"size="24"textColor="0x569abb"fontFamily="desc_font"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"cbace:layoutbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ProgressExpSkin"currentState="common"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"width="194"height="32"states="none,maxLv,common,canUpgrade,lock"bae:ProgressBarid="kaPaiNumProg"skinName="Bar4Skin"height="28"slideDuration="0"left="4"right="-4"verticalCenter="0"includeIn="common,canUpgrade"currentState.canUpgrade="canUpgrade"cbae:BitmapLabelid="progLb"text="100!100"font="card_num_font_fnt"scaleX="0.7"scaleY="0.7"horizontalCenter="0"verticalCenter="0"includeIn="common,canUpgrade"cbae:Labelid="nonTips"text="未获得卡牌"fontFamily="main_font"anchorOffsetX="0"textAlign="left"bold="true"size="26"scaleX="1"scaleY="1"touchEnabled="false"anchorOffsetY="0"horizontalCenter="0.5"verticalCenter="0"includeIn="none,lock"fontFamily.none="main_font"textColor.none="0xadadad"textColor="0xadadad"stroke="1"strokeColor="0x565656"cbae:Imageid="maxLevelImg"touchEnabled="false"scaleX="0.88"scaleY="0.88"source="home_ui_kz_json.icon_kz_kpymj"horizontalCenter="-0.5"verticalCenter="0"includeIn="maxLv"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="STD.SBtnSkin"states="up,down,disabled"minHeight="50"minWidth="100"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"width.up="112"width.down="112"height.down="112"width.disabled="112"height.disabled="112"height.up="112"bae:Imageid="iconDisplay"height="100%"width.down="90%"height.down="90%"width.disabled="90%"height.disabled="90%"width.up="100%"x.disabled="6"y.disabled="6"width="100%"x.down="6"y.down="6"source="mainBtn_png"source.down="mainBtn_png"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="TabItem1Skin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"width="246"height="105"bae:Imageid="bg"alpha="1"right="0"touchEnabled="false"scale9Grid="30,12,186,76"source="button_kz_02"cbae:Imageid="icon"alpha="1"touchEnabled="false"verticalCenter="0"source=""horizontalCenter="0"cbae:Imageid="redDotImg"source="common_ui_common_json.icon_hotpoint"right="43"top="7"visible="false"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="TabItem2Skin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"width="190"height="105"bae:Imageid="bg"alpha="1"right="0"touchEnabled="false"width="190"source="button_shop_02"verticalCenter="0"cbae:Labelid="labelDisplay"text="Label"right="20"verticalCenter="0"fontFamily="main_font"anchorOffsetX="0"width="145"textAlign="center"size="36"cbae:Imageid="redDotImg"source="common_ui_common_json.icon_hotpoint"right="30"top="10"visible="false"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="skins.ButtonSkin"states="up,down,disabled"minHeight="50"minWidth="100"xmlns:e="http:ccns.egret.comceui"bae:Imagewidth="100%"height="100%"scale9Grid="1,3,8,8"alpha.disabled="0.5"source="resourcecuicassetscButtoncbutton_up.png"source.down="resourcecuicassetscButtoncbutton_down.png"cbae:Labelid="labelDisplay"size="30"text="Button"horizontalCenter="0"verticalCenter="0"cbace:Skinb﻿a?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="skins.CheckBoxSkin"states="up,down,disabled,upAndSelected,downAndSelected,disabledAndSelected"xmlns:e="http:ccns.egret.comceui"bae:Groupwidth="100%"height="100%"bae:layoutbae:HorizontalLayoutverticalAlign="middle"cbace:layoutbae:ImagefillMode="scale"alpha="1"alpha.disabled="0.5"alpha.down="0.7"source="resourcecuicassetscCheckBoxccheckbox_unselect.png"source.upAndSelected="resourcecuicassetscCheckBoxccheckbox_select_up.png"source.downAndSelected="resourcecuicassetscCheckBoxccheckbox_select_down.png"source.disabledAndSelected="resourcecuicassetscCheckBoxccheckbox_select_disabled.png"cbae:Labelid="labelDisplay"size="20"textAlign="center"verticalAlign="middle"fontFamily="Tahoma"textColor="0x000000"text="1111111"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="skins.HScrollBarSkin"minWidth="20"minHeight="8"xmlns:e="http:ccns.egret.comceui"bae:Imageid="thumb"source="resourcecuicassetscScrollBarcroundthumb.png"scale9Grid="3,3,2,2"height="8"width="30"verticalCenter="0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="skins.HSliderSkin"minWidth="20"minHeight="8"xmlns:e="http:ccns.egret.comceui"bae:Imageid="track"source="resourcecuicassetscSliderctrack.png"scale9Grid="1,1,4,4"width="100%"height="6"verticalCenter="0"cbae:Imageid="thumb"source="resourcecuicassetscSlidercthumb.png"verticalCenter="0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="skins.PanelSkin"minHeight="230"minWidth="450"xmlns:e="http:ccns.egret.comceui"bae:Imageleft="0"right="0"bottom="0"top="0"source="resourcecuicassetscPanelcborder.png"scale9Grid="2,2,12,12"cbae:Groupid="moveArea"left="0"right="0"top="0"height="45"bae:Imageleft="0"right="0"bottom="0"top="0"source="resourcecuicassetscPanelcheader.png"cbae:Labelid="titleDisplay"size="20"fontFamily="Tahoma"textColor="0xFFFFFF"wordWrap="false"left="15"right="5"verticalCenter="0"cbace:Groupbae:Groupid="contentGroup"width="100%"top="50"bottom="30"cbae:Buttonid="closeButton"label="close"bottom="5"horizontalCenter="0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="skins.ProgressBarSkin"minWidth="30"minHeight="18"xmlns:e="http:ccns.egret.comceui"bae:Imagesource="resourcecuicassetscProgressBarctrack.png"scale9Grid="1,1,4,4"width="100%"height="100%"verticalCenter="0"cbae:Imageid="thumb"height="100%"width="100%"source="resourcecuicassetscProgressBarcthumb.png"cbae:Labelid="labelDisplay"textAlign="center"verticalAlign="middle"size="15"fontFamily="Tahoma"textColor="0x707070"horizontalCenter="0"verticalCenter="0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="skins.RadioButtonSkin"states="up,down,disabled,upAndSelected,downAndSelected,disabledAndSelected"xmlns:e="http:ccns.egret.comceui"bae:Groupwidth="100%"height="100%"bae:layoutbae:HorizontalLayoutverticalAlign="middle"cbace:layoutbae:ImagefillMode="scale"alpha="1"alpha.disabled="0.5"alpha.down="0.7"source="resourcecuicassetscRadioButtoncradiobutton_unselect.png"source.upAndSelected="resourcecuicassetscRadioButtoncradiobutton_select_up.png"source.downAndSelected="resourcecuicassetscRadioButtoncradiobutton_select_down.png"source.disabledAndSelected="resourcecuicassetscRadioButtoncradiobutton_select_disabled.png"cbae:Labelid="labelDisplay"size="20"textColor="0x707070"textAlign="center"verticalAlign="middle"fontFamily="Tahoma"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="skins.ScrollerSkin"minWidth="20"minHeight="20"xmlns:e="http:ccns.egret.comceui"bae:HScrollBarid="horizontalScrollBar"width="100%"bottom="0"cbae:VScrollBarid="verticalScrollBar"height="100%"right="0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="skins.ToggleSwitchSkin"states="up,down,disabled,upAndSelected,downAndSelected,disabledAndSelected"xmlns:e="http:ccns.egret.comceui"bae:Imagesource="resourcecuicassetscToggleSwitchcon.png"source.up="resourcecuicassetscToggleSwitchcoff.png"source.down="resourcecuicassetscToggleSwitchcoff.png"source.disabled="resourcecuicassetscToggleSwitchcoff.png"cbae:Imagesource="resourcecuicassetscToggleSwitchchandle.png"horizontalCenter="-18"horizontalCenter.upAndSelected="18"horizontalCenter.downAndSelected="18"horizontalCenter.disabledAndSelected="18"verticalCenter="0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="skins.VScrollBarSkin"minWidth="8"minHeight="20"xmlns:e="http:ccns.egret.comceui"bae:Imageid="thumb"scale9Grid="3,3,2,2"height="30"width="8"horizontalCenter="0"source=""cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="skins.VSliderSkin"minWidth="25"minHeight="30"xmlns:e="http:ccns.egret.comceui"bae:Imageid="track"source="resourcecuicassetscSliderctrack.png"scale9Grid="1,1,4,4"width="7"height="100%"horizontalCenter="0"cbae:Imageid="thumb"source="resourcecuicassetscSlidercthumb.png"horizontalCenter="0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="AchieveDescTipsSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"xmlns:ns1="*"bae:Groupid="root"width="1280"height="720"x="0"y="0"bae:Grouptop="54"bottom="45"anchorOffsetX="0"width="700"anchorOffsetY="0"height="707"horizontalCenter="0"verticalCenter="0"bae:Imagesource="bg_lz_tc"left="0"top="0"right="0"bottom="0"scale9Grid="46,31,23,34"cbae:Imagesource="bg_tc_xdi"anchorOffsetY="0"left="0"right="0"cbae:Grouptop="0"left="0"bae:Imagesource="bg_tc_xtdi"top="0"left="0"scaleX="1"scaleY="1"right="0"bottom="0"scale9Grid="23,7,142,42"cbae:Labelid="title"text="星级说明"size="32"fontFamily="main_font"textColor="0x97EFF4"left="15"top="0"scaleX="1"scaleY="1"right="30"bottom="0"textAlign="left"verticalAlign="middle"cbace:Groupbae:Groupright="15"top="9"width="38"height="41"bans1:SButtonid="closeBtn"xmlns:ns1="*"label=""scaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="button_tc_close"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Groupbans1:SButtonid="bottomBtn"label="关闭"anchorOffsetX="80"scaleX="1"scaleY="1"width="160"height="68"anchorOffsetY="34"skinName="BtnCommonSkin"icon="button_ty_green"horizontalCenter="0"verticalCenter="258.5"cbae:Groupid="leftGroup"width="600"height="450"y="70.96"anchorOffsetY="0"horizontalCenter="0"bae:Imagesource="bg_kz_kpxx_szd01"scale9Grid="7,18,8,32"anchorOffsetY="0"anchorOffsetX="0"width="600"height="450"x="0"y="0"scaleX="1"scaleY="1"cbae:Groupid="group1"x="12"y="15"anchorOffsetY="0"anchorOffsetX="0"bae:Labelid="gradeLabel1"text="大师五星"y="7"fontFamily="desc_font"textColor="0xCB00FF"horizontalCenter="0"x="228.18"scaleX="1"scaleY="1"size="24"cbae:Imagesource="home_ui_task_json.bg_re_zz_bx"y="34.01"horizontalCenter="0.3649999999999949"x="191.18"scaleX="1"scaleY="1"width="100"height="90"cbae:Imagesource="home_ui_common_json.icon_kpsx_08"rotation="130"horizontalCenter="2.5"verticalCenter="61"cbace:Groupbae:Groupid="group2"x="12"y="212"anchorOffsetY="0"anchorOffsetX="0"bae:Imagesource="home_ui_task_json.bg_re_zz_bx"y="34.01"horizontalCenter="-43.5"x="191.18"scaleX="1"scaleY="1"width="100"height="90"cbae:Labelid="gradeLabel2"text="大师五星"y="132.42"fontFamily="desc_font"textColor="0xCB00FF"x="7.88"scaleX="1"scaleY="1"size="24"cbae:Imagesource="home_ui_common_json.icon_kpsx_08"rotation="40"x="135.07"y="47.34"cbace:Groupbae:Groupid="group3"x="223.52"y="214.42"anchorOffsetY="0"anchorOffsetX="0"bae:Imagesource="home_ui_task_json.bg_re_zz_bx"y="34.01"horizontalCenter="14.5"x="191.18"scaleX="1"scaleY="1"width="100"height="90"cbae:Imagesource="home_ui_common_json.icon_kpsx_08"rotation="-40"x="22.86"y="-19.37"cbae:Labelid="gradeLabel3"text="大师五星"y="133.94"fontFamily="desc_font"textColor="0xCB00FF"x="24.43"scaleX="1"scaleY="1"size="24"cbace:Groupbae:Groupid="group4"x="173.51"y="12.92"anchorOffsetY="0"anchorOffsetX="0"bae:Labelid="gradeLabel4"text="大师五星"y="7"fontFamily="desc_font"textColor="0xCB00FF"horizontalCenter="0"x="228.18"scaleX="1"scaleY="1"size="24"cbae:Imagesource="home_ui_task_json.bg_re_zz_bx"y="34.01"horizontalCenter="0.3649999999999949"x="191.18"scaleX="1"scaleY="1"width="100"height="90"cbae:Imagesource="home_ui_common_json.icon_kpsx_08"rotation="40"horizontalCenter="76"verticalCenter="8.5"cbace:Groupbae:Groupid="group5"x="385.03"y="12.31"anchorOffsetY="0"anchorOffsetX="0"bae:Labelid="gradeLabel5"text="大师五星"y="7"fontFamily="desc_font"textColor="0xCB00FF"x="51.18"scaleX="1"scaleY="1"size="24"cbae:Imagesource="home_ui_task_json.bg_re_zz_bx"y="34.01"scaleX="1"scaleY="1"width="100"height="90"horizontalCenter="22"cbae:Imagesource="home_ui_common_json.icon_kpsx_08"rotation="130"x="132.94"y="144.73"cbace:Groupbae:Groupid="group6"x="416.85"y="232"anchorOffsetY="0"anchorOffsetX="0"bae:Imagesource="home_ui_task_json.bg_re_zz_bx"y="6.65"horizontalCenter="-27.5"x="191.18"scaleX="1"scaleY="1"width="100"height="90"cbae:Labelid="gradeLabel6"text="大师五星"y="111.43"fontFamily="desc_font"textColor="0xCB00FF"x="12"scaleX="1"scaleY="1"size="24"cbace:Groupbae:Labeltext="完成五星晋级挑战开启下一成就"y="400.91"fontFamily="desc_font"textColor="0xCB00FF"horizontalCenter="0"cbace:Groupbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="AchieveFullTipsSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="1280"height="720"x="0"y="0"bae:Groupid="leftGroup"width="360"height="500"y="100"horizontalCenter="0"bae:Imagesource="bg_kz_kpxx_szd01"scale9Grid="7,18,8,32"anchorOffsetY="0"anchorOffsetX="0"width="360"height="500"x="0"y="0"scaleX="1"scaleY="1"cbae:Labelid="lvLabel"text="大师五星"y="22"fontFamily="desc_font"textColor="0xCB00FF"horizontalCenter="0"cbae:Labelid="lvLabel0"text="已经获得全部成就"y="410"fontFamily="desc_font"textColor="0xCB00FF"horizontalCenter="0"cbae:Imagesource="home_ui_task_json.bg_re_zz_bx"y="93"horizontalCenter="0"cbae:Imageid="star1Img0"x="68"y="320"source="home_ui_hero_json.icon_hero_star_1"cbae:Imageid="star2Img0"x="118"y="320"source="home_ui_hero_json.icon_hero_star_1"cbae:Imageid="star3mg0"y="320"source="home_ui_hero_json.icon_hero_star_1"x="168"cbae:Imageid="star4Img0"x="218"y="320"source="home_ui_hero_json.icon_hero_star_1"cbae:Imageid="star5Img0"x="268"y="320"source="home_ui_hero_json.icon_hero_star_1"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="AchieveGradeInfoSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"xmlns:ns1="*"bae:Groupid="root"width="1280"height="720"x="0"y="0"bae:Grouptop="54"bottom="45"anchorOffsetX="0"width="700"anchorOffsetY="0"height="707"horizontalCenter="0"verticalCenter="0"bae:Imagesource="bg_lz_tc"left="0"top="0"right="0"bottom="0"scale9Grid="46,31,23,34"cbae:Imagesource="bg_tc_xdi"anchorOffsetY="0"left="0"right="0"cbae:Grouptop="0"left="0"bae:Imagesource="bg_tc_xtdi"top="0"left="0"scaleX="1"scaleY="1"right="0"bottom="0"scale9Grid="23,7,142,42"cbae:Labelid="title"text="大师五星"size="32"fontFamily="main_font"textColor="0x97EFF4"left="15"top="0"scaleX="1"scaleY="1"right="30"bottom="0"textAlign="left"verticalAlign="middle"cbace:Groupbae:Groupright="15"top="9"width="38"height="41"bans1:SButtonid="closeBtn"xmlns:ns1="*"label=""scaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="button_tc_close"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Groupbans1:SButtonid="bottomBtn"label="关闭"anchorOffsetX="80"scaleX="1"scaleY="1"y="568.86"width="160"height="68"anchorOffsetY="34"skinName="BtnCommonSkin"icon="button_ty_green"horizontalCenter="0"cbae:Groupid="leftGroup"width="600"height="450"y="70.96"anchorOffsetY="0"horizontalCenter="0"bae:Imagesource="bg_kz_kpxx_szd01"scale9Grid="7,18,8,32"anchorOffsetY="0"anchorOffsetX="0"width="600"height="450"x="0"y="0"scaleX="1"scaleY="1"cbae:Imagesource="home_ui_task_json.bg_re_zz_bx"y="8.15"horizontalCenter="0.5"cbae:Imageid="star1Img1"x="186.18"y="203.33"source="home_ui_hero_json.icon_hero_star_1"cbae:Imageid="star2Img1"x="236.18"y="203.33"source="home_ui_hero_json.icon_hero_star_1"cbae:Imageid="star3mg1"y="203.33"source="home_ui_hero_json.icon_hero_star_1"x="286.18"cbae:Imageid="star4Img1"x="336.18"y="203.33"source="home_ui_hero_json.icon_hero_star_1"cbae:Imageid="star5Img1"x="386.18"y="203.33"source="home_ui_hero_json.icon_hero_star_1"cbae:Labelid="descLabel"text="-----------五星挑战奖励-----------"y="267.55"fontFamily="desc_font"textColor="0xCB00FF"horizontalCenter="0.5"cbae:Groupid="rewardGroup"width="350"height="120"y="328.6"anchorOffsetY="0"anchorOffsetX="0"horizontalCenter="0"bae:layoutbae:HorizontalLayouthorizontalAlign="center"verticalAlign="middle"gap="0"cbace:layoutbace:Groupbace:Groupbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="AchieveInfoSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"xmlns:ns1="*"bae:Groupid="root"width="1280"height="720"x="0"y="0"bae:Groupheight="600"anchorOffsetY="0"width="1200"y="60"x="40"bae:Imagesource="bg_lz_tc"scale9Grid="46,31,23,34"width="1200"x="0"height="600"y="0"cbae:Imagesource="bg_tc_xdi"anchorOffsetY="0"left="0"right="0"cbae:Groupid="topLeftGroup"top="0"left="0"bae:Imagesource="bg_tc_xtdi"top="0"left="0"scaleX="1"scaleY="1"right="0"bottom="0"scale9Grid="23,7,142,42"cbae:Labelid="title"text="成就"size="32"fontFamily="main_font"textColor="0x97EFF4"left="15"top="0"scaleX="1"scaleY="1"right="30"bottom="0"textAlign="left"verticalAlign="middle"cbace:Groupbae:Groupid="topRightGroup"right="15"top="9"width="38"height="41"bans1:SButtonid="closeBtn"label=""scaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="button_tc_close"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Groupbae:Groupid="leftGroup"width="360"height="500"x="25"y="70"bae:Imagesource="bg_kz_kpxx_szd01"scale9Grid="7,18,8,32"anchorOffsetY="0"anchorOffsetX="0"width="360"height="500"x="0"y="0"scaleX="1"scaleY="1"cbae:Labelid="lvLabel"text="大师三星"x="96"y="22"fontFamily="desc_font"textColor="0xcb00ff"cbans1:SButtonid="iconBtn"label=""horizontalCenter="-22.5"verticalCenter="-64.5"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="home_ui_task_json.bg_re_zz_bx"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Imageid="star1Img"source="home_ui_hero_json.icon_hero_star_0"x="40"y="320"cbae:Imageid="star2Img"x="90"y="320"source="home_ui_hero_json.icon_hero_star_0"cbae:Imageid="star3Img"source="home_ui_hero_json.icon_hero_star_0"x="140"y="320"cbae:Imageid="star4Img"source="home_ui_hero_json.icon_hero_star_0"x="190"y="320"cbae:Imageid="star5Img"source="home_ui_hero_json.icon_hero_star_0"x="240"y="320"cbans1:SButtonid="leftBtn"label="星级奖励"anchorOffsetX="80"scaleX="1"scaleY="1"width="160"height="68"anchorOffsetY="34"skinName="BtnCommonSkin"icon="button_ty_green"horizontalCenter="0"verticalCenter="177"cbae:Labelid="fullTipsLabel"text="已经获得全部成就"y="408"fontFamily="desc_font"textColor="0xCB00FF"horizontalCenter="0"x="455"scaleX="1"scaleY="1"cbace:Groupbae:Groupid="rightGroup"anchorOffsetX="0"anchorOffsetY="0"height="480"width="720"y="72.67"x="428.33"bae:Groupid="taskList"width="720"height="480"x="0"y="0"scaleX="1"scaleY="1"anchorOffsetX="0"anchorOffsetY="0"bae:Scrollerid="game_list_scroller"width="720"height="480"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"x="0"y="0"cbae:Listid="game_list"width="720"height="480"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"x="0"alpha="1"y="0"bae:layoutbae:TileLayoutorientation="rows"horizontalGap="0"verticalGap="0"requestedColumnCount="3"cbace:layoutbace:Listbace:Groupbace:Groupbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="AchieveItemSkin"width="240"height="240"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bans1:SGroupid="root"width="240"height="240"verticalCenter="0"horizontalCenter="0"touchEnabled="false"bae:Imageid="bg"horizontalCenter="0"verticalCenter="0"width="220"height="220"source="home_ui_login_json.bg_dl_xzfwq"scale9Grid="9,12,12,31"cbae:Labelid="nameLabel"text="服务器名称"anchorOffsetX="0"stroke="2"textAlign="center"fontFamily="desc_font"scaleX="1"scaleY="1"size="26"textColor="0x93c6de"y="194"horizontalCenter="0"cbae:Labelid="tipsLabel"text="可领奖"anchorOffsetX="0"width="30"stroke="0"textAlign="center"fontFamily="desc_font"scaleX="1"scaleY="1"size="20"x="16"y="20"textColor="0xdd9494"cbae:ProgressBarid="progressBar"y="136"skinName="Bar1Skin"horizontalCenter="0.5"cbae:Imagesource="common_ui_itemicon_json.item_99"x="69"y="28"cbacns1:SGroupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="AchieveTaskInfoSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"xmlns:ns1="*"bae:Groupid="root"width="1280"height="720"x="0"y="0"bae:Grouptop="54"bottom="45"anchorOffsetX="0"width="700"anchorOffsetY="0"height="707"horizontalCenter="0"verticalCenter="0"bae:Imagesource="bg_lz_tc"left="0"top="0"right="0"bottom="0"scale9Grid="46,31,23,34"cbae:Imagesource="bg_tc_xdi"anchorOffsetY="0"left="0"right="0"cbae:Grouptop="0"left="0"bae:Imagesource="bg_tc_xtdi"top="0"left="0"scaleX="1"scaleY="1"right="0"bottom="0"scale9Grid="23,7,142,42"cbae:Labelid="title"text="详情"size="32"fontFamily="main_font"textColor="0x97EFF4"left="15"top="0"scaleX="1"scaleY="1"right="30"bottom="0"textAlign="left"verticalAlign="middle"cbace:Groupbae:Groupright="15"top="9"width="38"height="41"bans1:SButtonid="closeBtn"xmlns:ns1="*"label=""scaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="button_tc_close"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Groupbans1:SButtonid="bottomBtn"label="关闭"anchorOffsetX="80"scaleX="1"scaleY="1"y="568.86"width="160"height="68"anchorOffsetY="34"skinName="BtnCommonSkin"icon="button_ty_green"horizontalCenter="0"cbae:Groupid="leftGroup"width="600"height="450"y="70.96"anchorOffsetY="0"horizontalCenter="0"bae:Imagesource="bg_kz_kpxx_szd01"scale9Grid="7,18,8,32"anchorOffsetY="0"anchorOffsetX="0"width="600"height="450"x="0"y="0"scaleX="1"scaleY="1"cbae:Labeltext="-----------奖励-----------"y="296.36"fontFamily="desc_font"textColor="0xCB00FF"horizontalCenter="0.5"cbae:Labelid="descLabel"text="在与玩家的战斗中获得三星完胜"y="258.43"fontFamily="desc_font"horizontalCenter="0"textColor="0x000000"size="26"cbagame:AchieveItemid="item"y="18.52"skinName="AchieveItemSkin"horizontalCenter="0"cbae:Groupid="rewardGroup"width="350"height="120"y="328.6"anchorOffsetY="0"anchorOffsetX="0"horizontalCenter="0"bae:layoutbae:HorizontalLayouthorizontalAlign="center"verticalAlign="middle"gap="0"cbace:layoutbace:Groupbace:Groupbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="PWSBoxItemSkin"width="300"height="200"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Groupleft="0"top="0"right="0"bottom="0"bae:Imageid="bg"source="common_ui_common_json.bg_bag_gz"horizontalCenter="0"verticalCenter="0"width="300"height="160"scale9Grid="23,18,54,57"cbans1:SGroupid="btn"width="120"height="120"verticalCenter="0"horizontalCenter="0"bae:Imageid="icon"scaleX="1"scaleY="1"horizontalCenter="0"source="common_ui_itemicon_json.item_2"verticalCenter="0"x="11"y="11"cbae:Labelid="nameLabel"text="战斗宝箱"scaleX="1"scaleY="1"size="20"horizontalCenter="0"fontFamily="desc_font"stroke="0"bold="false"textAlign="right"textColor="0x6d6456"verticalCenter="31"x="20"y="81"cbae:Imagesource="common_ui_common_json.bg_xz_fkj"x="66"y="84"rotation="210"id="checkImg"scaleX="1"scaleY="1"cbacns1:SGroupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="PWSCupItemSkin"width="200"height="50"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="200"height="50"x="0"y="0"bae:Labelid="label"text="Label"horizontalCenter="0"verticalCenter="0"fontFamily="desc_font"textColor="0xffffff"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="PWSInfoSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"bae:Groupid="root"width="1280"height="720"x="0"y="0"bae:Grouptop="0"bottom="0"anchorOffsetX="0"width="1276.39"bae:Imagesource="bg_lz_tc"left="0"top="0"right="0"bottom="0"scale9Grid="46,31,23,34"cbae:Imagesource="bg_tc_xdi"anchorOffsetY="0"left="0"right="0"cbae:Groupy="15"horizontalCenter="-0.19500000000005002"bae:Labelid="title"text="排位赛"size="32"fontFamily="main_font"left="15"top="0"scaleX="1"scaleY="1"right="30"bottom="0"textAlign="left"verticalAlign="middle"textColor="0x227a82"cbace:Groupbae:Groupheight="720"y="0"width="1280"x="0"bae:Imagex="19.55"y="70"scale9Grid="6,6,42,38"anchorOffsetX="0"width="1236.12"anchorOffsetY="0"height="632"source="bg_com_fgd"scaleX="1"scaleY="1"cbae:Imagex="10.65"y="76.68"source="bg_kplb_bt03"scaleX="1"scaleY="1"anchorOffsetX="0"width="1236.42"cbae:Imagex="448.05"y="79.18"source="bg_phb_topt_02"scaleX="1"scaleY="1"cbae:Groupx="11.11"y="55.66"scaleX="1"scaleY="1"bagame:RankPlayerBtnid="btn1"label="本赛季"x="-55.5"y="24.5"skinName="RankPlayerBtnSkin"width="146"scaleX="1"scaleY="1"cbagame:RankPlayerBtnid="btn2"label="上赛季"x="82.68999999999994"y="24.5"skinName="RankPlayerBtnSkin"width="146"scaleX="1"scaleY="1"cbagame:RankPlayerBtnid="btn5"label="奖励"x="112.68999999999994"y="54.5"skinName="RankPlayerBtnSkin"width="146"scaleX="1"scaleY="1"cbagame:RankPlayerBtnid="btn6"label="说明"x="122.68999999999994"y="64.5"skinName="RankPlayerBtnSkin"width="146"scaleX="1"scaleY="1"cbae:layoutbae:HorizontalLayoutgap="-6"cbace:layoutbace:Groupbae:Groupid="rankGroup"width="1220"height="560"y="132"anchorOffsetX="0"anchorOffsetY="0"x="30"visible="false"bae:Scrollerid="scro"height="555"x="-4"y="0"anchorOffsetX="0"anchorOffsetY="0"scrollPolicyH="off"scaleX="1"scaleY="1"bae:Listid="list"bae:ArrayCollectionbae:Arraybae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbace:Arraybace:ArrayCollectionbace:Listbace:Scrollerbae:Labeltext="当前排行榜无数据"x="-9"y="245.00000000000006"fontFamily="desc_font"size="26"textColor="0x217D64"width="970"textAlign="center"id="noneTips"scaleX="1"scaleY="1"cbace:Groupbae:Groupid="rewardGroup"width="1220"height="560"y="132"anchorOffsetX="0"anchorOffsetY="0"horizontalCenter="0"bae:Groupid="subGroup1"x="0"y="0"width="1100"bae:Labeltext="-----贵族专享-----"fontFamily="desc_font"scaleX="1"scaleY="1"textColor="0x3dff00"y="0"left="46"cbae:Labeltext="-----免费奖励-----"fontFamily="desc_font"scaleX="1"scaleY="1"y="0"right="46"width="217"textColor="0xffffff"cbae:Labelid="cupCount"text="3356"y="0"fontFamily="main_font"size="26"stroke="0"anchorOffsetX="0"textColor="0xF2D45E"width="72"textAlign="right"horizontalCenter="56"cbae:Imagey="0"source="common_ui_common_json.icon_top_cup"horizontalCenter="0"cbae:layoutbae:BasicLayoutcbace:layoutbace:Groupbae:Scrollerheight="500"anchorOffsetX="0"anchorOffsetY="0"scrollPolicyH="off"scaleX="1"scaleY="1"width="1100"horizontalCenter="0"verticalCenter="20"bae:Groupbae:Groupid="subGroup2"y="20"width="400"anchorOffsetX="0"left="0"anchorOffsetY="0"bae:layoutbae:VerticalLayoutverticalAlign="top"horizontalAlign="center"cbace:layoutbace:Groupbae:Groupid="subGroup3"width="400"y="20"right="0"bae:layoutbae:VerticalLayoutcbace:layoutbace:Groupbae:Groupid="subGroup4"width="200"y="20"horizontalCenter="0"anchorOffsetY="0"bae:layoutbae:BasicLayoutcbace:layoutbae:ProgressBarid="bar"anchorOffsetX="0"anchorOffsetY="0"width="1000"height="40"rotation="-90"scaleX="1"scaleY="1"y="1020"horizontalCenter="0"bae:skinNamebae:SkinminWidth="30"minHeight="18"bae:Imagewidth="100%"height="100%"verticalCenter="0"source="preload_ui_json.bg_login_d"scale9Grid="14,14,13,13"cbae:Imageid="thumb"height="70%"width="99%"source="preload_ui_json.bg_login_nr"scale9Grid="10,9,9,10"x="6"y="5"cbae:Labelid="labelDisplay"textAlign="center"verticalAlign="middle"size="28"fontFamily="main_font"x="895"textColor="0xf9f586"text=""verticalCenter="0"visible="false"cbace:Skinbace:skinNamebace:ProgressBarbagame:CommonItemx="0"y="1000"skinName="PWSCupItemSkin"visible="false"cbace:Groupbae:layoutbae:BasicLayoutcbace:layoutbace:Groupbace:Scrollerbace:Groupbae:Groupid="descGroup"width="1220"height="560"y="132"anchorOffsetX="0"anchorOffsetY="0"horizontalCenter="0"visible="false"bae:Scrollerheight="500"anchorOffsetX="0"anchorOffsetY="0"scrollPolicyH="off"scaleX="1"scaleY="1"width="1000"horizontalCenter="0"verticalCenter="0"bae:Labelid="descLabel"text="这是一个测试描述"fontFamily="desc_font"cbace:Scrollerbace:Groupbace:Groupbae:Groupright="15"top="9"width="38"height="41"bans1:SButtonid="closeBtn"xmlns:ns1="*"label=""scaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="button_tc_close"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Groupbace:Groupbace:Groupba!--ae:Imagesource="排行榜01_jpg"cb--bace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="PWSRewardItemSkin"width="300"height="300"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupleft="0"top="0"right="0"bottom="0"bae:Imageid="bg"source="common_ui_common_json.bg_bag_gz"horizontalCenter="0"anchorOffsetX="0"width="280"verticalCenter="0"scale9Grid="26,25,50,49"height="280"cbae:Imageid="icon"scaleX="1"scaleY="1"horizontalCenter="0"y="50"source="common_ui_itemicon_json.item_99"cbae:Labelid="nameLabel"text="战斗宝箱"y="23.21"scaleX="1"scaleY="1"size="24"horizontalCenter="0"fontFamily="desc_font"stroke="0"bold="false"textAlign="right"textColor="0xff0000"cbae:Imageid="itemIcon1"x="20"scaleX="0.7"scaleY="0.7"source="common_ui_itemicon_json.item_2"verticalCenter="24"cbae:Imageid="itemIcon2"x="149"scaleX="0.7"scaleY="0.7"source="common_ui_itemicon_json.item_3"verticalCenter="24"cbae:Labelid="itemCount1"width="81.6"x="80"fontFamily="desc_font"text="4292"anchorOffsetX="0"scaleX="0.8"scaleY="0.8"verticalCenter="24"textColor="0x000000"cbae:Labelid="itemCount2"width="81.6"x="213.99"text="1245"anchorOffsetX="0"scaleX="0.8"scaleY="0.8"fontFamily="desc_font"verticalCenter="24"textColor="0x000000"cbae:Imageid="itemIcon3"x="22"scaleX="0.7"scaleY="0.7"source="common_ui_itemicon_json.item_3"verticalCenter="91.5"cbae:Labelid="itemCount3"x="86.99"text="1245"anchorOffsetX="0"scaleX="0.8"scaleY="0.8"fontFamily="desc_font"verticalCenter="91"textColor="0x000000"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="BagPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:RectfillColor="0x000000"left="0"right="0"top="0"bottom="0"alpha="0.7"touchEnabled="true"cbae:Imagescale9Grid="2,2,12,12"width="600"height="400"horizontalCenter="0"verticalCenter="0"source="resourcecuicassetscPanelcheader.png"cbae:Buttonid="closeButton"label="close"bottom="85"horizontalCenter="0"cbae:Scrollerwidth="564.66"height="371.33"anchorOffsetX="0"anchorOffsetY="0"horizontalCenter="0"verticalCenter="0"bae:Listid="list"itemRendererSkinName="GoodsItemSkin"anchorOffsetY="0"height="285.99"bae:layoutbae:TileLayoutcolumnAlign="left"paddingLeft="20"paddingRight="10"columnWidth="120"requestedColumnCount="4"cbace:layoutbae:ArrayCollectionbae:Arraybae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbace:Arraybace:ArrayCollectionbace:Listbace:Scrollerbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="GoodsItemSkin"width="80"height="120"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupleft="0"right="0"top="0"bottom="0"bae:Imageid="iconImg"scaleX="1"scaleY="1"width="80"height="80"source=""horizontalCenter="0"cbae:Labelid="count"text="000"y="52.01"scaleX="1"scaleY="1"size="30"horizontalCenter="13.5"fontFamily="main_font"stroke="1"cbae:Labelid="itemName"text="物品名字有好多字"y="89.36"scaleX="1"scaleY="1"size="20"width="120"horizontalCenter="0"fontFamily="main_font"textAlign="center"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="BoxTipsSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"height="720"states="common"width="1280"height.common="500"bae:Groupwidth="1280"height="720"x="0"y="0"cbae:Groupid="root"width.common="400"height.common="366"width="400"height="500"horizontalCenter="0"verticalCenter="69"bae:Imagesource="button_tc_di"scale9Grid="23,63,16,15"anchorOffsetX="0"width="400"height="500"y="0"x="0"cbans1:SButtonid="closeBtn"label=""scaleX="1"scaleY="1"right="20"top="8"bans1:skinNamebae:Skinstates="up,down,disabled"xmlns:game="game.*"bae:Imagewidth="100%"height="100%"source="button_tc_close"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Imagesource="bg_kz_kpxx_szd01"scale9Grid="7,18,8,32"anchorOffsetY="0"anchorOffsetX="0"includeIn="common"width="340"height="400"x="30"y="70"cbae:Groupwidth="340"includeIn="common"x="30"y="70"anchorOffsetY="0"height="400"bae:layoutbae:BasicLayoutcbace:layoutbae:Imageid="icon"scaleX="1"scaleY="1"horizontalCenter="-120"y="0"source="common_ui_itemicon_json.item_99"includeIn="common"x="1"cbae:Labelid="nameLabel"text="战斗宝箱"y="41.33"scaleX="1"scaleY="1"size="24"horizontalCenter="-14"fontFamily="desc_font"stroke="0"bold="false"textAlign="right"textColor="0xFF0000"includeIn="common"x="106"cbae:Groupid="subGroup"width="340"x="0"y="93"bae:Labelid="descLabel"text="完成每日任务可以获得任务积分，当积分累计到一定值如500时即可领取一个宝箱奖励"y="14"scaleX="1"scaleY="1"size="24"fontFamily="desc_font"stroke="0"bold="false"textAlign="left"includeIn="common"width="320"textColor="0x000000"horizontalCenter="0"x="-5"cbae:layoutbae:VerticalLayoutgap="10"cbace:layoutbace:Groupbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="CommonWinSkin"currentState="noSubBg"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"height="366"states="common,noSubBg"width="400"bae:Grouptop="0"bottom="0"left="0"right="0"bae:Imageleft="0"top="0"right="0"bottom="0"source="button_tc_di"scale9Grid="23,63,16,15"anchorOffsetX="0"cbae:Imagesource="bg_kz_kpxx_szd01"scale9Grid="7,18,8,32"anchorOffsetY="0"anchorOffsetX="0"horizontalCenter="0"top="74"bottom="109"left="29"right="29"includeIn="common"cbae:Labelid="title"text="我是标题标题"size="32"fontFamily="main_font"scaleX="1"scaleY="1"textAlign="left"verticalAlign="middle"horizontalCenter="0"top="13"horizontalCenter.common="0"top.common="12"textColor.common="0x227a82"textColor="0x227a82"cbae:Groupright="20"top="8"width="40"height="40"bans1:SButtonid="closeBtn"label=""scaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"bans1:skinNamebae:Skinstates="up,down,disabled"xmlns:game="game.*"bae:Imagewidth="100%"height="100%"source="button_tc_close"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ItemBaseInfoSkin"width="200"height="70"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Imageid="icon"x="0"scaleX="0.6999999999999998"scaleY="0.6999999999999998"source="common_ui_itemicon_json.item_3"verticalCenter="0"cbae:Labelid="count"x="64.99"text="X500"anchorOffsetX="0"scaleX="0.8000000000000002"scaleY="0.8000000000000002"fontFamily="desc_font"textColor="0x000000"y="23"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="MainBgBtnSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Imageid="iconDisplay"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="MainPanelBgSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"states="common,common2,commonNoBg"ba!--ae:Imagesource="排行榜01_jpg"cb--bae:Imagesource="bg_com_jpg"cbae:Imagex="271.2"y="65"source="bg_phb_btdi"scale9Grid="25,73,14,14"width="988"anchorOffsetY="0"height="645"includeIn="common"cbae:Imagex="0.8"y="70"source="bg_jd_btd"scale9Grid="31,1,190,12"height="632"x.common2="-47.2"y.common2="71"height.common2="622"x.common="0.8"y.common="71"height.common="622"cbae:Imagex="244.98"y="66"source="home_ui_kz_json.bg_com_fgl"scale9Grid="0,10,7,62"anchorOffsetY="0"height="640"y.common="67.03"height.common="629"x.common2="193.98"y.common2="67"height.common2="629"cbae:Groupid="viewGroup"bae:layoutbae:BasicLayoutcbace:layoutbace:Groupbae:Groupid="tabGroup"y="73"left="-41"width="300"left.common2="-92"bae:layoutbae:VerticalLayouthorizontalAlign="right"gap="-4"cbace:layoutba!--agame:TabItem1x="168"y="225"scaleX="1"scaleY="1"skinName="TabItem2Skin"cbagame:TabItem1x="178"y="235"scaleX="1"scaleY="1"skinName="TabItem2Skin"cbagame:TabItem1x="188"y="245"scaleX="1"scaleY="1"skinName="TabItem2Skin"cbagame:TabItem1x="198"y="255"scaleX="1"scaleY="1"skinName="TabItem2Skin"cb--bace:Groupbagame:CostInfoid="costInfo"x="228.73"y="-4"skinName="CostInfoSkin"scaleX="1"scaleY="1"touchEnabled="false"anchorOffsetX="0"width="1282"cbans1:SButtonid="closeBtn"label=""skinName="MainBgBtnSkin"verticalCenter="-314.5"horizontalCenter="-528.5"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyApplyBtn2Skin"xmlns:e="http:ccns.egret.comceui"states="refuse,accept"width="80"height="80"bae:Imagescale9Grid="14,7,86,30"anchorOffsetX="0"left="0"right="0"top="0"bottom="0"source="button_ty_red"source.accept="button_ty_green"cbae:ImageanchorOffsetX="0"horizontalCenter="0"verticalCenter="-3.5"source="button_jz_zy_jj"source.accept="button_jz_zy_js"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyApplyBtnSkin"xmlns:e="http:ccns.egret.comceui"bae:Imagesource="button_jz_zy_sqcy"horizontalCenter="0"verticalCenter="0"cbae:Imageid="redDotImg"source="common_ui_common_json.icon_hotpoint"right="-8"top="-12"visible="false"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyApplyItemSkin"width="610"height="118"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"xmlns:ns1="*"ba!--ae:Imagesource="家族12-主页08_jpg"x="-335.45"y="-147.51"cb--bae:ImageanchorOffsetX="0"left="0"right="0"top="0"bottom="0"touchEnabled="false"source="bg_grzl_di_gz02"scale9Grid="20,20,8,21"cbagame:HeadIconid="headIcon"x="5.7"skinName="HeadIconSkin"verticalCenter="0"touchChildren="false"touchEnabled="false"cbae:Labelid="playerName"text="玩家的名字"x="109.32"y="20.69"size="32"fontFamily="main_font"touchEnabled="false"textColor="0xbd7b49"cbans1:SButtonid="refuse"label="拒绝"name="refuseBtn"horizontalCenter="157"skinName="FamilyApplyBtn2Skin"currentState="refuse"width="74"height="74"verticalCenter="2"cbans1:SButtonid="accept"label="接受"name="acceptBtn"horizontalCenter="246"skinName="FamilyApplyBtn2Skin"currentState="accept"width="74"height="74"verticalCenter="2"cbae:Buttonid="cups"label="0000"y="60"skinName="FamilyCupsSkin"horizontalCenter="-63"touchEnabled="false"touchChildren="false"cbae:Buttonid="level"label="00"x="112"skinName="PlayerLevelSkin"y="50"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyApplyPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"xmlns:game="game.*"ba!--ae:Imagesource="家族12-主页08_jpg"cb--bae:Groupwidth="686"height="642"anchorOffsetY="0"anchorOffsetX="0"horizontalCenter="0"verticalCenter="30"bagame:CommonWinid="comWin"skinName="CommonWinSkin"scaleX="1"scaleY="1"left="0"right="0"top="0"bottom="0"x="-191"y="-100"cbae:Imagex="29.62"y="69.65"anchorOffsetY="0"source="bg_kz_kpxx_szd01"width="627"scale9Grid="8,7,5,45"height="541"scaleX="1"scaleY="1"anchorOffsetX="0"cbae:Scrollerwidth="610"height="528"y="74.33000000000001"anchorOffsetX="0"anchorOffsetY="0"horizontalCenter="2"scrollPolicyH="off"x="39.33000000000004"scaleX="1"scaleY="1"bae:Listid="list"itemRendererSkinName="FamilyApplyItemSkin"anchorOffsetX="0"width="1024"touchEnabled="true"bae:ArrayCollectionbae:Arraycbace:ArrayCollectionbae:layoutbae:VerticalLayoutgap="10"cbace:layoutbace:Listbace:Scrollerbae:Buttonid="noTips"label="当前没有玩家申请加入家族！"skinName="FamilyNonTipsBtn"x="43"scaleX="1"scaleY="1"width="560"horizontalCenter="0"verticalCenter="0"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyAskPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"xmlns:ns1="*"ba!--ae:Imagesource="家族07-聊天-捐卡弹窗01_jpg"cb--bae:Groupid="root"touchEnabled="false"bae:Imagewidth="820"x="226.29999999999998"y="260.69999999999993"source="bg_jz_lt_jk_di_x02"scaleX="1"scaleY="1"cbae:Groupx="222"y="212.67"height="30"bae:Labeltext="每日可请求："size="22"fontFamily="desc_font"textColor="0xa7845e"y="45.5"x="-63.5"scaleX="1"scaleY="1"cbae:Labelid="tip1"text="50张普通卡"size="26"fontFamily="main_font"textColor="0xd1d9dd"y="45.5"x="-63.5"stroke="2"strokeColor="0x626a7d"scaleX="1"scaleY="1"cbae:Labeltext="或"size="22"fontFamily="desc_font"textColor="0xA7845E"y="65.5"x="-43.5"scaleX="1"scaleY="1"cbae:Labelid="tip2"text="5张稀有卡"size="26"fontFamily="main_font"textColor="0xfade74"y="45.5"x="-63.5"stroke="2"strokeColor="0x976d43"scaleX="1"scaleY="1"cbae:Labeltext="或"size="22"fontFamily="desc_font"textColor="0xA7845E"y="55.5"x="-53.5"scaleX="1"scaleY="1"cbae:Labelid="tip3"text="2张史诗卡"size="26"fontFamily="main_font"y="45.5"x="-63.5"textColor="0xdb7bfb"stroke="2"strokeColor="0x76448f"scaleX="1"scaleY="1"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"cbace:layoutbace:Groupbae:Groupx="881.85"y="211.17999999999998"scaleX="1"scaleY="1"bae:Imagex="9"y="22"source="icon_jz_lt_jkdjs"cbae:Labeltext="5小时56分钟"x="75"y="44"size="22"fontFamily="desc_font"textColor="0xc34848"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"cbace:layoutbace:Groupbae:Scrollerid="hasTips"height="404"x="184"y="276"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"bae:Groupid="list"bace:Groupbace:Scrollerbae:Buttonid="noTips"label="温馨提示\n已拥有且等级未满15级的英雄，当天还有请求数量才符合条件。您当前没有符合条件的英雄可选择"x="298"y="365"skinName="FamilyNonTipsBtn"width="650"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyBtn1Skin"width="155"height="55"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"states="huanka,yuyin,biaoqing,fasong"bae:Imagesource="button_ty_yellow"scale9Grid="14,7,86,39"left="0"right="0"top="0"bottom="0"touchEnabled="false"source.yuyin="button_ty_blue"source.fasong="button_ty_green"cbae:Groupleft="4"right="4"top="2"bottom="8"bae:Imagesource="bg_jz_lt_hktz"touchEnabled="false"x="0"y="0"scaleX="0.8"scaleY="0.8"source.yuyin="button_jz_lt_yy"y.yuyin="3.5"source.biaoqing="button_jz_lt_bq"includeIn="huanka,yuyin,biaoqing"cbae:Labeltext="请求换卡"touchEnabled="false"fontFamily="desc_font"scaleX="1"scaleY="1"y="0"x="0"size="24"includeIn="huanka,fasong"text.fasong="发送"textColor.huanka="0xc17c1a"textColor.fasong="0x289da8"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"horizontalAlign="center"cbace:layoutbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyChangeKaPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"bae:Rectleft="0"right="0"top="0"bottom="0"alpha="0.3"cba!--ae:Imagesource="家族07-聊天-捐卡弹窗01_jpg"cb--bagame:CommonWinid="comWin"skinName="CommonWinSkin"scaleX="1"scaleY="1"anchorOffsetX="0"width="930"anchorOffsetY="0"height="642"horizontalCenter="0"verticalCenter="27"cbae:Imagewidth="868"x="202"y="191.4"source="bg_jz_lt_jk_di"scale9Grid="6,6,38,38"anchorOffsetY="0"height="490"cbae:Imagewidth="868"x="202"y="194.4"source="bg_jz_lt_jk_di_x01"cbagame:FamilyAskPanelid="askPanel"skinName="FamilyAskPanelSkin"cbae:ToggleButtonid="ask"label="捐卡"x="216.5"y="136"width="136"height="70"currentState="down"skinName="FamilySwapPanelBtn2Skin"selected="true"enabled="true"cbae:ToggleButtonid="swap"label="换卡"x="356"y="136"skinName="FamilySwapPanelBtnSkin"width="136"height="70"currentState="up"enabled="true"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyChatAskItemSkin"currentState="me"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"states="me,other"width="940"ba!--ae:Imagesource="家族02-聊天_jpg"x="-300"y="-92"cb--bagame:FamilyChatItemTitleid="playerInfo"touchChildren="false"touchEnabled="false"skinName="FamilyChatItemTitleSkin"currentState.me="me"cbae:GroupscaleX="1"scaleY="1"y.other="44"width="544"height="158"y="44"x="101.8"x.other="102"x.me="281.8"bae:ImageanchorOffsetY="0"anchorOffsetX="0"scaleX="1"scaleY="1"left="0"right="0"top="0"bottom="0"source="bg_jz_lt_tmdi"scale9Grid="17,18,23,17"cbae:ImageanchorOffsetY="0"scale9Grid="17,18,23,17"anchorOffsetX="0"scaleX="1"scaleY="1"left="3"right="3"source="bg_jz_lt_tmdi_bt"y="0"cbae:Imagewidth="366"height="42"x="157.41"y="68.98"source="bg_jz_lt_jksdi"scale9Grid="11,10,18,23"anchorOffsetX="0"anchorOffsetY="0"cbans1:SButtonid="presentBtn"label="捐赠"includeIn="other"skinName="BtnCommonSkin"icon="button_ty_green"width="114"height="64"horizontalCenter="199"verticalCenter="11"cbae:Labeltext="正在请求捐赠！"maxWidth="500"scaleX="1"scaleY="1"size="26"horizontalCenter="-172"y="7.65"fontFamily="desc_font"textColor="0x9f7b54"cbae:Labelid="count"text="您拥有:"maxWidth="500"scaleX="1"scaleY="1"size="20"y="46.66"x="159"fontFamily="desc_font"textColor="0xa67c50"cbae:ProgressBarid="prog"width="370"height="26"x="156.4"y="119"slideDuration="0"skinName="Bar5Skin"value="0"cbagame:HeroKa1id="heroka"x="11"y="52.27"skinName="HeroKa1Skin"scaleX="0.65"scaleY="0.65"y.other="52"y.me="52"currentState="simple"cbae:Groupx="169"y="78.8"scaleX="0.7"scaleY="0.7"bae:BitmapLabelid="hasCount"x="72"y="52"text="0"font="card_num_font_fnt"cbae:BitmapLabelid="upgradeCount"x="133"y="50"font="exp_num_font_fnt"text="!0"scaleX="1.3"scaleY="1.3"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"cbace:layoutbace:Groupbae:Groupy="73.2"includeIn="me"right="34"bae:Imagex="37"y="41"source="icon_jz_lt_jkdjs"cbae:Labelid="leftTime"text="5小时56分"maxWidth="500"scaleX="1"scaleY="1"size="22"horizontalCenter="72"y="43.650000000000006"fontFamily="desc_font"x="-62"textColor="0xb0865a"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"cbace:layoutbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyChatEmjItemSkin"currentState="me"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"states="me,other"height.other="140"height.me="110"width="925"bagame:FamilyChatItemTitleid="playerInfo"touchChildren="false"touchEnabled="false"skinName="FamilyChatItemTitleSkin"currentState.me="me"cbae:GroupscaleX="1"scaleY="1"y.other="54"x.other="116"y="50"x="116"x.me="750"y.me="20"bae:Imageid="bg"anchorOffsetY="0"anchorOffsetX="0"scaleX="1"scaleY="1"left="-10"right="-10"top="-10"bottom="-10"source="bg_jz_lt_tmdi"scale9Grid="17,18,28,20"cbae:Imageid="content"horizontalCenter="0"verticalCenter="0"source="emoji_01"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyChatEmjListSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"width="220"bae:Groupid="emjGroup"left="0"right="0"top="0"bottom="0"width="400"minHeight="1"touchEnabled="false"bae:layoutbae:TileLayoutrequestedColumnCount="6"horizontalGap="20"cbace:layoutbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyChatEmjWinSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="bgGroup"left="0"right="0"top="0"bottom="0"cba!--ae:Imagesource="家族06-聊天_jpg"cb--bae:Groupwidth="604"height="208"x="464.5"y="404.5"bae:Imagesource="bg_jz_lt_hktzdi"scaleX="1"scaleY="1"scale9Grid="12,13,31,34"left="0"right="0"top="0"bottom="0"cbae:ImagescaleX="1"scaleY="1"source="bg_jz_lt_hktzdi_jt"right="18"bottom="-10"cbae:Scrollerleft="20"right="20"top="10"bottom="13"bae:Groupid="emjGroup"anchorOffsetX="0"width="220"touchEnabled="false"bae:layoutbae:VerticalLayoutcbace:layoutbace:Groupbace:Scrollerbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyChatItemTitleSkin"width="925"currentState="other"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"states="me,other"width.me="925"bagame:HeadIconid="headIcon"skinName="HeadIconSkin"x.me="825"cbae:Groupx="109.04"y="12.37"includeIn="other"bae:Buttonid="job"label="首领"scaleX="1"scaleY="1"skinName="FamilyJobLabelSkin"height="24"width="50"cbae:Labelid="playerMsg"text="玩家的名字00分钟前"size="26"fontFamily="main_font"scaleX="1"scaleY="1"x="-46"y="-10"textColor="0xbd7b49"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"cbace:layoutbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyChatKaTipsSkin"width="56"height="58"currentState="type1"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"states="type1,type2"bae:Imagesource="bg_jz_lt_hktzdi"scale9Grid="11,15,39,31"left="0"right="0"top="0"bottom="0"cbae:Imagesource="bg_jz_lt_hktzdi_jt"horizontalCenter.type1="0"y="40.4"scaleY.type2="-1"y.type2="14.8"horizontalCenter.type2="0"cbae:Imagesource="bg_jz_lt_hktz"horizontalCenter="0.5"verticalCenter="-1"cbae:BitmapLabelid="count"font="sh_font_fnt"text="7"horizontalCenter="0.5"verticalCenter="0.5"letterSpacing="-10"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyChatNoticeItemSkin"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"width="870"bae:Imageid="bg"anchorOffsetY="0"anchorOffsetX="0"scaleX="1"scaleY="1"left="0"right="0"top="0"bottom="0"source="bg_jz_lt_tzdi"scale9Grid="17,18,19,8"cbae:Labelid="content"text="样本文字"left="0"right="0"top="0"bottom="0"verticalAlign="middle"textAlign="center"fontFamily="desc_font"size="22"textColor="0xa24848"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyChatPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"bae:Imagesource="家族06-聊天_jpg"visible="false"cbae:Groupid="root"width="1280"x="0"height="720"y="0"bae:Imagex="271.64"y="65.36"source="bg_lz_tc"scale9Grid="29,25,62,52"anchorOffsetY="0"height="642"width="988"scaleX="1"scaleY="1"cbae:Imagex="516.69"y="627.5"anchorOffsetY="0"width="470"scaleX="1"scaleY="1"source="bg_jz_lt_di"scale9Grid="8,7,34,35"anchorOffsetX="0"height="54"cbae:Imagex="295.49"y="88.7"anchorOffsetY="0"width="939.6"source="bg_jz_lt_di"scale9Grid="8,7,34,35"scaleX="1"scaleY="1"anchorOffsetX="0"height="524"cbae:Scrollerid="scro"width="940"height="522"x="295.69"y="89.04"anchorOffsetX="0"anchorOffsetY="0"scrollPolicyH="off"scaleX="1"scaleY="1"bae:Listid="list"width="883.4"itemRendererSkinName="FamilyChatTextItemSkin"useVirtualLayout="true"anchorOffsetX="0"bae:ArrayCollectionbae:Arrayba!--ae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cb--bace:Arraybace:ArrayCollectionbae:layoutbae:VerticalLayoutgap="0"paddingBottom="10"paddingRight="10"cbace:layoutbace:Listbace:Scrollerbans1:SButtonid="voice"label="语音"scaleX="1"scaleY="1"width="64"height="64"skinName="FamilyBtn1Skin"currentState="yuyin"horizontalCenter="-138"verticalCenter="296"cbans1:SButtonid="send"label="发送"scaleX="1"scaleY="1"skinName="FamilyBtn1Skin"currentState="fasong"width="162"height="64"horizontalCenter="515"verticalCenter="296"cbans1:SButtonid="kapaiBtn"label="Button"skinName="FamilyBtn1Skin"width="164"height="64"currentState="huanka"horizontalCenter="-263"verticalCenter="296"cbae:TextInputid="textContent"x="544"y="629"prompt="最长五十字"skinName="FamilyTextInput3Skin"width="430"height="50"cbagame:FamilyChatKaTipsx="308"y="541"skinName="FamilyChatKaTipsSkin"visible="false"cbagame:FamilyChatKaTipsx="308"y="100"skinName="FamilyChatKaTipsSkin"currentState="type2"visible="false"cbagame:FamilyChatEmjWinid="emjWin"skinName="FamilyChatEmjWinSkin"visible="false"cbans1:SButtonid="emj"label="表情"scaleX="1"scaleY="1"currentState="biaoqing"skinName="FamilyBtn1Skin"width="64"height="64"horizontalCenter="392"verticalCenter="296"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyChatSwapItemSkin"currentState="me"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"states="me,other"bagame:FamilyChatItemTitleid="playerInfo"touchChildren="false"touchEnabled="false"skinName="FamilyChatItemTitleSkin"currentState.me="me"cbae:Groupx.other="90"top="0"top.other="16"top.me="6"right.me="90"bae:GroupscaleX="1"scaleY="1"y.other="20"width="500"height="250"bae:Imageid="bg"source="common_ui_playericon_json.bg_phb_heroicon"anchorOffsetY="0"scale9Grid="17,18,66,63"anchorOffsetX="0"scaleX="1"scaleY="1"left="0"right="0"top="0"bottom="0"cbans1:SButtonlabel="1"x="46"y="96"height="80"width="60"cbans1:SButtonlabel="2"x="166"y="96"height="80"width="60"cbans1:SButtonlabel="3"x="246"y="96"height="80"width="60"cbans1:SButtonlabel="4"x="326"y="96"height="80"width="60"cbans1:SButtonlabel="5"x="406"y="96"height="80"width="60"cbans1:SButtonid="presentBtn"label="捐赠"x="364"y="192"height="30"label.me="取消"label.other="交换"cbae:Labeltext="交换英雄"maxWidth="500"scaleX="1"scaleY="1"size="20"horizontalCenter="0"y="26"cbae:Labeltext="您将换出"maxWidth="500"scaleX="1"scaleY="1"size="20"y="56"x="37"text.me="您将得到"cbae:Labeltext="您将患处其中一种英雄"maxWidth="500"scaleX="1"scaleY="1"size="20"y="56"x="213"text.other="请选择你需要换入的英雄"text.me="您将换出其中一种英雄"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyChatTextItemSkin"currentState="me"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"states="me,other"width="925"bagame:FamilyChatItemTitleid="playerInfo"touchChildren="false"touchEnabled="false"skinName="FamilyChatItemTitleSkin"currentState.me="me"cba!--ae:Imagesource="家族01-聊天_jpg"x="-301"y="-90.17"y.me="-544.04"x.me="-286.93"cb--bae:GroupscaleX="1"scaleY="1"x.other="115.71"top="47"top.me="18"right.me="110"maxWidth.other="562"maxWidth="562"top.other="52"bae:Imageid="bg"anchorOffsetY="0"anchorOffsetX="0"scaleX="1"scaleY="1"left="-10"right="-10"top="-10"bottom="-10"x="0"y="0"scale9Grid.other="17,18,25,22"scale9Grid="17,18,26,20"source="bg_jz_lt_tmdi"source.me="bg_jz_lt_tmdi"source.other="bg_jz_lt_tmdi"cbae:Labelid="content"text="1234567890123456789012345678901234567890"maxWidth="500"scaleX="1"scaleY="1"left.other="0"right.other="0"top.other="0"bottom.other="0"text.other="12345678901"text.me="1234567890123"bottom.me="0"right.me="0"left="0"right="0"top="0"bottom="0"fontFamily="desc_font"size="22"textColor="0xa67f64"left.me="0"top.me="0"lineSpacing.other="10"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyChatVoiceItemSkin"currentState="me"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"states="me,other"width.me="870"width="870"bagame:HeadIconid="headIcon"skinName="HeadIconSkin"top="6"x.me="770"cbae:Groupx.other="90"top="0"top.other="16"top.me="6"right.me="90"bae:GroupscaleX="1"scaleY="1"y.other="20"bae:Imageid="bg"source="common_ui_playericon_json.bg_phb_heroicon"anchorOffsetY="0"scale9Grid="17,18,66,63"anchorOffsetX="0"scaleX="1"scaleY="1"left="0"right="0"top="0"bottom="0"x="0"y="0"width.me="200"width.other="200"width="200"cbans1:SButtonid="content"label="一段录音"horizontalCenter="0"verticalCenter="0"cbace:Groupbae:Labelid="playerMsg"text="玩家的名字d族长、长老e00分钟前"size="20"fontFamily="desc_font"x="14"includeIn="other"scaleX="1"scaleY="1"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyJobLabelSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"states="1,2"bae:Labelid="labelDisplay"text="族长"left="0"right="0"top="0"bottom="0"verticalAlign="middle"textAlign="center"size="20"fontFamily="desc_font"textColor="0xe5dac0"textColor.1="0xff9696"stroke.1="2"strokeColor.1="0xa54642"textColor.2="0xffb672"stroke.2="2"strokeColor.2="0xab622d"text.2="副族长"stroke="2"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilySwapPanelBtn2Skin"currentState="up"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"width="155"height="55"states="up,down,downAndSelected,upAndSelected"bae:Imagesource="bg_jz_lt_jk_bt01"left="0"right="0"top="0"bottom="0"scale9Grid="16,20,22,32"source.up="bg_jz_lt_jk_bt02"source.upAndSelected="bg_jz_lt_jk_bt02"cbae:ImagehorizontalCenter="0"verticalCenter="-2.5"source="bg_jz_lt_jk_hk0"source.down="bg_jz_lt_jk_jk"source.up="bg_jz_lt_jk_jk0"source.downAndSelected="bg_jz_lt_jk_jk"source.upAndSelected="bg_jz_lt_jk_jk0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilySwapPanelBtnSkin"currentState="up"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"width="155"height="55"states="up,down,upAndSelected,downAndSelected"bae:Imagesource="bg_jz_lt_jk_bt01"left="0"right="0"top="0"bottom="0"scale9Grid="16,20,22,32"source.up="bg_jz_lt_jk_bt02"source.upAndSelected="bg_jz_lt_jk_bt02"cbae:ImagehorizontalCenter="0"verticalCenter="-2.5"source.up="bg_jz_lt_jk_hk0"source="bg_jz_lt_jk_hk0"source.down="bg_jz_lt_jk_hk"source.upAndSelected="bg_jz_lt_jk_hk0"source.downAndSelected="bg_jz_lt_jk_hk"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilySwapPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"xmlns:ns1="*"ba!--ae:Imagesource="家族07-聊天-捐卡弹窗01_jpg"cb--bae:Groupid="root"touchEnabled="false"bae:Labeltext="每日可请求：50张普通卡或5张稀有卡或2张史诗卡"size="22"fontFamily="desc_font"textColor="0xa7845e"y="215.5"x="222.5"scaleX="1"scaleY="1"cbae:Labeltext="每日可请求：50张普通卡或5张稀有卡或2张史诗卡"size="22"fontFamily="main_font"y="215.5"x="222.5"textColor="0xdb7bfb"stroke="1"strokeColor="0x76448f"scaleX="1"scaleY="1"cbae:Labeltext="每日可请求：50张普通卡或5张稀有卡或2张史诗卡"size="22"fontFamily="main_font"textColor="0xfade74"y="215.5"x="222.5"stroke="1"strokeColor="0x976d43"scaleX="1"scaleY="1"cbae:Labeltext="每日可请求：50张普通卡或5张稀有卡或2张史诗卡"size="22"fontFamily="main_font"textColor="0xd1d9dd"y="215.5"x="222.5"stroke="1"strokeColor="0x626a7d"scaleX="1"scaleY="1"cbae:Groupx="881.85"y="211.17999999999998"scaleX="1"scaleY="1"bae:Imagex="9"y="22"source="icon_jz_lt_jkdjs"cbae:Labeltext="5小时56分钟"x="75"y="44"size="22"fontFamily="desc_font"textColor="0xc34848"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"cbace:layoutbace:Groupbae:Scrollerheight="404"x="184"y="276"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"bae:ListitemRendererSkinName="HeroKa4Skin"bae:ArrayCollectionbae:Arraybae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbace:Arraybace:ArrayCollectionbae:layoutbae:TileLayoutrequestedColumnCount="4"horizontalGap="-40"verticalGap="-96"cbace:layoutbace:Listbace:Scrollerbae:Imagewidth="820"x="226.29999999999998"y="260.69999999999993"source="bg_jz_lt_jk_di_x02"scaleX="1"scaleY="1"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyTextInput3Skin"width="355"height="55"xmlns:e="http:ccns.egret.comceui"states="normal,disabled,normalWithPrompt,disabledWithPrompt"width.disabled="355"height.disabled="55"bae:EditableTextid="textDisplay"left="0"right="0"textColor.disabled="0xff0000"size="30"top="0"bottom="0"verticalAlign="middle"fontFamily="desc_font"textColor="0x9a8981"italic="true"cbae:Labelid="promptDisplay"left="0"right="0"size="30"touchEnabled="false"includeIn="normalWithPrompt,disabledWithPrompt"top="0"bottom="0"verticalAlign="middle"fontFamily="desc_font"textColor="0x9a8981"italic="true"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="HeroAskItemSkin"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:ns1="*"xmlns:w="http:ccns.egret.comcwing"width="140"height="270"bae:Groupid="showGroup"left="0"right="0"top="0"bottom="0"touchEnabled="false"bae:Rectid="bg"left="0"right="0"top="0"bottom="0"x="0"y="0"scaleX="1"scaleY="1"fillColor="0x3f3f3f"cbans1:SButtonid="infoBtn"label="info"width="110"height="40"horizontalCenter="1"y="178"x="16"scaleX="1"scaleY="1"cbans1:SButtonid="askBtn"label="ask"width="110"height="40"horizontalCenter="1"y="226"x="16"scaleX="1"scaleY="1"cbace:Groupbagame:HeroKaItemid="ka"skinName="HeroKaItemSkin"scaleX="1"scaleY="1"horizontalCenter="0"y="6"touchChildren="false"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="HeroKa4Skin"currentState="common"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"xmlns:ns1="*"states="common,active"width="258"height="270"ba!--ae:Imagey="-260.5"x="-833.39"source="家族07-聊天-捐卡弹窗01_jpg"x.common="-621.21"y.common="-279.7"cb--bae:Imagesource="home_ui_kz_json.bg_lz_tc02"anchorOffsetX="0"height="270"includeIn="active"touchEnabled="false"width="258"scale9Grid="24,23,25,25"horizontalCenter="0"cbagame:HeroKa1id="heroKa"y.active="23.92"skinName="HeroKa1Skin"scaleX.common="0.9"scaleY.common="0.9"y.common="8"y="23.99"touchEnabled.common="true"touchChildren.common="false"touchChildren.active="false"touchEnabled.active="false"scaleY.active="0.95"scaleY="0.95"horizontalCenter.common="0"scaleX.active="0.95"horizontalCenter.active="0"horizontalCenter="0"cbans1:SButtonid="infoBtn"label="信息"anchorOffsetX="0"width="108"height="68"includeIn="active"touchChildren="false"touchEnabled="true"name="infoBtn"verticalCenter="84"horizontalCenter="-55"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_blue"source.down="common_ui_common_json.button_ty_blue"cbae:Imagesource="button_jz_lt_xx"horizontalCenter="-1"verticalCenter="-5"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="qqBtn"label="信息"anchorOffsetX="0"width="108"height="68"includeIn="active"touchChildren="false"name="czBtn"verticalCenter="84"horizontalCenter="55"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_yellow"source.down="common_ui_common_json.button_ty_yellow"cbae:Imagesource="button_jz_lt_qq"horizontalCenter="0"verticalCenter="-5"cbace:Skinbacns1:skinNamebacns1:SButtonbagame:ProgressExpy="149"skinName="ProgressExpSkin"horizontalCenter="0"width="180"horizontalCenter.common="0"y.common="127.4"width.common="174"width.active="184"horizontalCenter.active="0"y.active="149.4"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="HeroKaItemSkin"xmlns:e="http:ccns.egret.comceui"width="120"height="160"bae:RectfillColor="0x056977"left="0"right="0"top="0"bottom="0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyCupsSkin"currentState="cups"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"states="cups,zhanli,cups2,contribute"bae:Imagesource="bg_jz_jbsdi"scale9Grid="15,5,8,30"left="0"right="0"source.cups2="bg_phb_tmdi2_1"scale9Grid.cups2="15,5,8,30"includeIn="cups,zhanli,cups2"cbae:Groupleft="10"right="10"verticalCenter="0"bae:Labelid="labelDisplay"text="0000000"fontFamily="main_font"size="28"textAlign="left"scaleX="1"scaleY="1"textColor="0xFFDE24"x="-8"textColor.zhanli="0xffc424"textColor.contribute="0xd17e18"size.contribute="30"cbae:ImageanchorOffsetX="0"scaleX="1"scaleY="1"source="bg_phb_jb"source.zhanli="bg_jz_jbc"source.contribute="icon_jz_gx"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"horizontalAlign="center"cbace:layoutbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyFightPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"bae:Labeltext="我是家族战界面"x="618"y="304"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyIconSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"width="100"height="100"states="common"bae:Imageid="bg"scale9Grid="36,38,15,47"left="0"right="0"top="0"bottom="0"includeIn="common"source="bg_bag_gz"touchEnabled="false"cbae:Imageid="familyIconBg"left="10"right="10"top="10"bottom="10"source=""touchEnabled.common="false"touchEnabled="false"cbae:Imageid="familyIcon"left="27"right="25"top="28"bottom="28"source=""touchEnabled.common="false"touchEnabled="false"cbae:Groupid="selImg"left="-7"right="-7"top="-7"bottom="-7"touchChildren="false"touchEnabled="false"bae:ImagescaleX="1"scaleY="1"source="bg_xz_fkj"left="0"top="0"cbae:ImagescaleX="1"scaleY="-1"source="bg_xz_fkj"bottom="0"left="0"cbae:ImagescaleX="-1"scaleY="1"source="bg_xz_fkj"right="0"top="0"cbae:ImagescaleX="-1"scaleY="-1"source="bg_xz_fkj"right="0"bottom="0"cbace:Groupbae:Groupid="lockGroup"left="0"right="0"top="0"bottom="0"touchChildren="false"touchEnabled="false"bae:Imagesource="bg_bag_gz_yh"left="0"right="0"top="0"bottom="0"scale9Grid="19,17,22,17"alpha="0.2"cbae:Imagey="-92"x="74"scale9Grid="10,10,16,13"scaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"visible.common="false"source="bg_bag_suo"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyMainPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"bae:Groupid="root"width="1280"height="720"touchEnabled="false"bagame:MainPanelBgid="mainBg"skinName="MainPanelBgSkin"currentState="commonNoBg"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyNoneMainPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bagame:MainPanelBgid="mainBg"skinName="MainPanelBgSkin"currentState="commonNoBg"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyNonTipsBtn"width="600"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:GroupverticalCenter="0"minHeight="180"left="130"right="0"bae:Imagesource="bg_jz_lt_jk_wxts"left="0"right="0"scale9Grid="21,21,28,23"scaleX="1"scaleY="1"top="0"bottom="0"cbae:Labelid="labelDisplay"text="我是列表文字"size="24"fontFamily="desc_font"textColor="0xA7845E"anchorOffsetX="0"left="80"right="20"lineSpacing="6"textAlign="center"top="0"bottom="0"verticalAlign="middle"scaleX="1"scaleY="1"cbace:Groupbae:Imagesource="bg_jz_lt_jk_wxtsrw"verticalCenter="0"left="0"x="-201"y="-14"scaleX="1"scaleY="1"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyOptionBtnSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Imageid="iconDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyPanelItemSkin"width="944"currentState="common"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"xmlns:ns1="*"height="120"states="common,active"width.active="980"ba!--ae:Imagesource="家族12-主页01_jpg"x="-296"y="-396"visible="true"y.common="-392.5"x.common="-277"source.common="家族12-主页02_jpg"y.active="-393.04"source.active="家族12-主页02_jpg"x.active="-278"cb--bae:Groupwidth="944"height="120"horizontalCenter="0"verticalCenter="0"horizontalCenter.active="0"verticalCenter.active="0"width.active="980"height.active="122"touchEnabled="false"bae:Imageid="bg"source="bg_phb_tmdi0_1"left="0"right="0"scale9Grid="24,33,25,49"x="0"y="0"scaleX="1"scaleY="1"top.active="0"bottom.active="0"name="bg"touchEnabled="true"cbae:ImageanchorOffsetX="0"source="bg_phb_tmdi1_1"x="88.28"scale9Grid="31,35,24,46"verticalCenter="-4.5"height="112"width="366"y="0"scaleX="1"scaleY="1"height.active="116"verticalCenter.active="-3"touchEnabled="false"cbagame:HeadIconid="headIcon"x="121"skinName="HeadIconSkin"scaleX="1.1"scaleY="1.1"verticalCenter="-4"y="1"verticalCenter.active="-4"x.active="114.33"touchChildren="false"touchEnabled="false"cbagame:RankNumid="rank"skinName="RankNumSkin"verticalCenter="-3.5"x="35.5"scaleX="0.8"scaleY="0.8"y="34"verticalCenter.active="0.5"x.active="23.5"touchChildren="false"touchEnabled="false"cbae:Buttonid="cups"label="0000000"y="33.35"skinName="FamilyCupsSkin"currentState="cups2"anchorOffsetX="0"minWidth="173"right="5"x="745"scaleX="1"scaleY="1"includeIn="common"touchChildren="false"touchEnabled="false"cbae:Buttonid="contribute"label="0000"skinName="FamilyCupsSkin"currentState="contribute"scaleX="1"scaleY="1"y.active="52"sortableChildren="true"touchChildren="false"touchEnabled="false"icon="bg_jz_gx"verticalCenter="0"right="288"cbae:Groupx="235"y="15"bae:Labelid="playerName"text="玩家的名字"x="65.35000000000002"y="85.63"size="32"fontFamily="main_font"scaleX="1"scaleY="1"touchEnabled="false"textColor="0xbd7b49"cbae:Buttonid="job"label="族长111"skinName="FamilyJobLabelSkin"x="8.280000000000001"y="88.74"scaleX="1"scaleY="1"x.active="227.6"touchChildren="false"touchEnabled="false"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"cbace:layoutbace:Groupbae:Labelid="online"text="在线"x="235.33"size="24"verticalCenter="17"fontFamily="desc_font"y="65"scaleX="1"scaleY="1"touchEnabled="false"textColor="0x888888"cbans1:SButtonid="changeJob"label=""includeIn="active"verticalCenter="0"skinName="FamilyOptionBtnSkin"icon="button_jz_zy_jz"horizontalCenter="238"bacns1:SButtonbans1:SButtonid="rmMemberBtn"label=""includeIn="active"verticalCenter="0"name="rmMemberBtn"skinName="FamilyOptionBtnSkin"icon="button_jz_zy_tr"horizontalCenter="328"bacns1:SButtonbans1:SButtonid="showInfoBtn"label=""includeIn="active"verticalCenter="0"name="showInfoBtn"skinName="FamilyOptionBtnSkin"icon="button_jz_zy_ck"horizontalCenter="418"bacns1:SButtonbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"ba!--ae:Imagesource="家族12-主页01_jpg"cb--bae:Groupid="root"width="1280"x="0"height="720"bae:Imagex="269.64"y="64.37"source="bg_lz_tc"scale9Grid="29,25,62,52"anchorOffsetY="0"height="296"width="988"cbae:Imagex="294.4"y="84.31"source="bg_jz_hzqdi"scale9Grid="21,12,19,31"anchorOffsetX="0"width="164"height="156"cbae:Imagex="300"y="67.81"source="bg_jz_hzqdi_x"scale9Grid="5,3,37,12"width="152"height="36"cbae:Imagex="465.62"y="134.04"anchorOffsetY="0"width="761.4"source="bg_kz_kpxx_szd01"scale9Grid="8,7,5,45"height="100.6"anchorOffsetX="0"cbae:Imagex="271.52"y="364.22"anchorOffsetX="0"width="986"anchorOffsetY="0"source="bg_com_fgd"scaleX="1"scaleY="1"scale9Grid="15,15,25,21"height="330"cbagame:FamilyIconid="familyIcon"x="323"y="105.01"skinName="FamilyIconSkin"hasBg="false"cbae:Groupx="473"y="91.51"bae:Labelid="familyName"text="家族名称"y="65.51"scaleX="1"scaleY="1"fontFamily="main_font"textColor="0xac580a"size="32"cbae:Labelid="needCups"text="d需要奖杯：0000e"x="-30.600000000000023"y="75.51"scaleX="1"scaleY="1"fontFamily="desc_font"size="26"textColor="0xa67d63"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"cbace:layoutbace:Groupbae:Scrollerwidth="742"height="78"x="476"y="146.01"bae:Groupbae:Labelid="desc"text="家族简介"scaleX="1"scaleY="1"fontFamily="desc_font"size="28"textColor="0xa67d63"anchorOffsetX="0"anchorOffsetY="0"left="0"right="0"top="0"bottom="0"cbace:Groupbace:Scrollerbae:Labeltext="实力:战绩:\n成员:地区:"x="299.89"y="257.02"scaleX="1"scaleY="1"fontFamily="desc_font"textColor="0xa67d63"lineSpacing="15"cbae:Labelid="member"text="00:c00"x="384.56"y="303.12"scaleX="1"scaleY="1"fontFamily="desc_font"bold="true"textColor="0xac580a"cbae:Labelid="local"text="中国"x="649.56"y="303.12"scaleX="1"scaleY="1"fontFamily="desc_font"bold="true"textColor="0xAC580A"cbans1:SButtonid="applyBtn"label="申请列表"skinName="FamilyApplyBtnSkin"horizontalCenter="282"verticalCenter="-62"bacns1:SButtonbans1:SButtonid="setting"label=""horizontalCenter="383"verticalCenter="-62"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="button_jz_zy_sz"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="quitBtn"label="退出"skinName="Btn3Skin"height="68"verticalCenter="-63"horizontalCenter="517.5"bacns1:SButtonbae:Scrollerwidth="1000"height="310.36"y="375.22"anchorOffsetX="0"anchorOffsetY="0"x="267"scrollPolicyH="off"bae:Listid="list"itemRendererSkinName="FamilyPanelItemSkin"bae:ArrayCollectionbae:Arrayba!--ae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cb--bace:Arraybace:ArrayCollectionbae:layoutbae:VerticalLayouthorizontalAlign="center"cbace:layoutbace:Listbace:Scrollerbae:Buttonid="cups"label="000000"x="635.5"y="253.01"skinName="FamilyCupsSkin"icon="bg_phb_jb"currentState="zhanli"minWidth="174"cbae:Buttonid="zhanli"label="000000"x="375.5"y="254.01"skinName="FamilyCupsSkin"icon="bg_phb_jb"minWidth="174"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamiltApplyBtnSkin"width="114"height="64"xmlns:e="http:ccns.egret.comceui"states="canJoin,hasJoin,full"bae:Imageid="iconDisplay"source="button_ty_green"anchorOffsetX="0"left="0"right="0"top="0"bottom="0"source.hasJoin="bg_jz_ysqdi"source.full="button_ty_yellow_h"scale9Grid="14,18,86,23"scale9Grid.hasJoin="8,18,12,23"cbae:Labeltext="Label"left="0"right="0"top="0"bottom="8"verticalAlign="middle"textAlign="center"size.canJoin="28"size="28"fontFamily="desc_font"textColor.canJoin="0x2f856e"textColor.hasJoin="0x357d93"top.hasJoin="0"bottom.hasJoin="0"textColor.full="0x656565"text.canJoin="加入"text.hasJoin="已申请"text.full="已满人"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyCheckSkin"states="up,down,disabled,upAndSelected,downAndSelected,disabledAndSelected"xmlns:e="http:ccns.egret.comceui"bae:ImagefillMode="scale"alpha="1"alpha.disabled="0.5"alpha.down="0.7"source="bg_jz_dxdi"verticalCenter="0"left="0"source.upAndSelected="bg_jz_dxdi"source.downAndSelected="bg_jz_dxdi"source.disabledAndSelected="bg_jz_dxdi"cbae:ImagefillMode="scale"alpha="1"source="icon_jz_dg"left="6"verticalCenter="0.5"includeIn="upAndSelected,downAndSelected"cbae:Labelid="labelDisplay"size="22"textAlign="center"verticalAlign="middle"fontFamily="desc_font"text="123"verticalCenter="0"left="65"textColor="0xb27711"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyCreatePanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"ba!--ae:Imagesource="家族08_jpg"cb--bae:Groupid="root"width="1280"height="720"touchEnabled="false"bae:Imagex="271.64"y="65.36"source="bg_lz_tc"scale9Grid="29,25,62,52"anchorOffsetY="0"height="642"width="988"cbae:Imagex="284.31"y="76.35"anchorOffsetY="0"source="bg_jz_xzhzdi"scale9Grid="15,11,32,32"height="618"width="492"cbae:Imagex="769.89"y="165.6"anchorOffsetY="0"source="bg_jz_xzhzdi_jt"cbae:Imagex="298.89"y="131.1"anchorOffsetY="0"source="bg_jz_xx01"width="456"cbae:Imagex="298.89"y="433.1"anchorOffsetY="0"source="bg_jz_xx01"width="456"cbae:Imagex="793.89"y="293.1"anchorOffsetY="0"width="435"source="bg_kz_kpxx_szd01"scale9Grid="8,7,5,45"cbae:Imagex="793"y="362.46"anchorOffsetY="0"source="bg_kz_kpxx_szd01"width="435"scale9Grid="8,7,5,45"height="172"cbae:Imagex="922.4"y="93.8"source="bg_jz_hzqdi"scale9Grid="21,12,19,31"anchorOffsetX="0"width="180"height="174"cbae:Imagex="928"y="75.4"source="bg_jz_hzqdi_x"scale9Grid="5,3,37,12"width="168"height="36"cbae:TextInputid="familyInput"x="806.97"y="293.73"width="413.5"height="56"enabled="true"skinName="FamilyTextInputSkin"prompt="家族名称"cbae:TextInputid="descInput"x="812.16"y="385.65"width="390"height="130"prompt="欢迎兄弟姐妹们，一起打造强大的家族！"skinName="FamilyTextInput2Skin"enabled="true"cbans1:SButtonid="createBtn"label="500"verticalCenter="278"y="608"scaleX="1"scaleY="1"width="170"height="70"skinName="ShopBuyKaPaiBtnSkin"icon="icon_top_diamond"horizontalCenter="501"cbae:CheckBoxid="autoJoin"label="满足奖杯数自动通过申请"x="796.51"y="542.19"skinName="FamilyCheckSkin"cbagame:FamilyDrowMenuid="menuBtn"x="796.44"verticalCenter="253"y="618"scaleX="1"scaleY="1"skinName="FamilyDrowMenuSkin"width="210"cbae:Scrollerid="scro1"width="460"x="303.63"y="141.36"anchorOffsetX="0"anchorOffsetY="0"height="240"bae:Listid="list"itemRendererSkinName="FamilyIconSkin"x="13.33"bae:ArrayCollectionbae:Arrayba!--ae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cb--bace:Arraybace:ArrayCollectionbae:layoutbae:TileLayoutrequestedColumnCount="4"horizontalGap="16"verticalGap="8"paddingTop="6"cbace:layoutbace:Listbace:Scrollerbae:Scrollerwidth="460"x="303.63"y="440.36"anchorOffsetX="0"anchorOffsetY="0"height="240"bae:Listid="list2"itemRendererSkinName="FamilyIconSkin"x="13.33"bae:ArrayCollectionbae:Arrayba!--ae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cb--bace:Arraybace:ArrayCollectionbae:layoutbae:TileLayoutrequestedColumnCount="4"horizontalGap="20"verticalGap="10"cbace:layoutbace:Listbace:Scrollerbagame:FamilyIconid="familyIcon"x="947.97"y="112.66"skinName="FamilyIconSkin"scaleX="1.3"scaleY="1.3"hasBg="false"cbae:Labeltext="选择徽标"x="470"y="92"fontFamily="main_font"size="30"textColor="0x967447"cbae:Labeltext="选择徽底"x="470"y="393"fontFamily="main_font"textColor="0x967447"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyDropMenuSkin"width="200"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"height="300"bans1:SButtonlabel="Button"width="200"height="50"cbae:Scrollerwidth="200"x="0"height="250"y="50"bae:Groupcbace:Scrollerbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyDrowMenuItemSkin"currentState="common"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"width="210"minHeight="46"states="common,active"width.active="210"height="54"bae:Imageid="bg"left="0"right="0"top="0"bottom="0"scale9Grid="12,9,23,25"source="bg_jz_xzbs_02"source.active="bg_jz_xzbs_01"cbae:Imagesource="bg_jz_xzbs_03"scale9Grid="6,0,42,3"left="0"right="0"bottom="0"cbae:GrouphorizontalCenter="0"verticalCenter="0"bae:Labelid="showlabel"text="0000"scaleX="1"scaleY="1"anchorOffsetX="0"left="0"right="0"textAlign="left"size="30"verticalAlign="middle"top="0"bottom="0"fontFamily="main_font"alpha="0.9"x="-60"y="10"width="150"textColor="0xffde24"textColor.common="0xffde24"textColor.active="0xffaa24"cbae:Imageid="dirImg"source="bg_phb_jb"touchEnabled="false"y="71.32"right="10"x="124"scaleX="1"scaleY="1"source.common="bg_phb_jb"source.active="bg_jz_jbc"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"cbace:layoutbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyDrowMenuSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"width="200"height="100"bae:Groupid="showGroup"left="0"right="0"bottom="51"bae:layoutbae:VerticalLayoutgap="0"cbace:layoutbace:Groupbae:Imageid="showBg"source="bg_jz_xzbs_01"scale9Grid="5,3,37,14"left="0"right="0"height="50"bottom="0"cbae:Labelid="showLb"text="3000"right="42"textAlign="center"touchEnabled="false"fontFamily="desc_font"anchorOffsetX="0"size="30"width="100"verticalCenter="25"textColor="0xffde24"cbae:ImagetouchEnabled="false"y="49"x="12"source="button_jz_bszk"cbae:Imageid="dirImg"source="bg_phb_jb"anchorOffsetX="20"anchorOffsetY="15"touchEnabled="false"y="76.32"right="10"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyInfoItemSkin"width="552"height="100"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"ba!--ae:Imagescale9Grid="15,5,8,30"verticalCenter="-72"source="家族02_jpg"x="-388.04"visible="false"cb--bae:Groupid="root"touchChildren="false"touchEnabled="false"left="0"right="0"top="0"bottom="0"bae:Imagesource="bg_grzl_di_gz02"scale9Grid="19,20,12,22"left="0"right="0"top="0"bottom="0"cbagame:HeadIconid="headIcon"x="63.5"skinName="HeadIconSkin"verticalCenter="1"scaleX="0.9"scaleY="0.9"cbae:Labelid="fName"text="玩家的名字"x="155"y="20.5"size="28"fontFamily="main_font"scaleX="1"scaleY="1"textColor="0xbd7b49"cbae:Labelid="job"text="左右护法"x="155"y="56.5"size="22"fontFamily="desc_font"scaleX="1"scaleY="1"textColor="0xa7845e"cbae:Labeltext="贡献："x="315.5"verticalCenter="-10"y="55"scaleX="1"scaleY="1"size="22"fontFamily="desc_font"textColor="0xd48a39"cbae:Labelid="onlineState"text="15小时前"x="424"verticalCenter="18"y="35"scaleX="1"scaleY="1"size="22"textColor="0x888888"fontFamily="desc_font"width="120"textAlign="center"cbagame:RankNumid="rank"x="11.65"skinName="RankNumSkin"scaleX="0.8"scaleY="0.8"verticalCenter="0.5"cbae:Groupx="316"y="52"height="30"bae:Labelid="contribute"text="00000"x="22"y="13"scaleX="1"scaleY="1"fontFamily="main_font"size="24"textColor="0xd17e18"height="30"verticalAlign="middle"cbae:Imagex="55"y="30"source="bg_jz_gx"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"gap="0"cbace:layoutbace:Groupbae:Imagey="16"source="bg_jz_jbsdi_x02"scale9Grid="11,4,7,24"right="4"width="124"cbae:Groupy="18.5"right="7"height="30"bae:Labelid="cups"text="00000"x="22"y="13"scaleX="1"scaleY="1"fontFamily="main_font"size="24"textColor="0xffde24"height="30"verticalAlign="middle"cbae:Imagex="55"y="30"source="bg_phb_jb"scaleX="0.9"scaleY="0.9"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"cbace:layoutbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyInfoPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"ba!--ae:Imagesource="家族02_jpg"cb--bae:Rectid="bg"left="0"right="0"top="0"bottom="0"alpha="0.7"cbagame:CommonWinid="comWin"skinName="CommonWinSkin"height="644"width="592"horizontalCenter="23"verticalCenter="30"cbae:Imagex="388"y="140.46"source="bg_jz_hzqdi"scale9Grid="21,12,19,31"anchorOffsetX="0"width="132"height="132"cbae:Imagex="393.5"y="121"source="bg_jz_hzqdi_x"scale9Grid="5,3,37,12"width="120"height="36"cbagame:FamilyIconid="familyIcon"x="403.29"y="148.81"skinName="FamilyIconSkin"hasBg="false"cbae:Imagex="527"y="132.96"anchorOffsetY="0"source="bg_kz_kpxx_szd01"width="408"scale9Grid="8,7,5,45"height="130"cbae:Imagewidth="130"height="32"x="456.68"source="bg_jz_jbsdi"scale9Grid="15,5,8,30"y="286.01"cbae:Imagewidth="130"height="32"x="662.36"source="bg_jz_jbsdi"scale9Grid="15,5,8,30"y="286"cbans1:SButtonid="joinBtn"label=""skinName="FamiltApplyBtnSkin"icon="button_ty_green"width="114"height="64"horizontalCenter="234"verticalCenter="-41"currentState="canJoin"cbae:Scrollerid="hasList"width="550"height="310"y="381.3"anchorOffsetY="0"horizontalCenter="23"touchEnabled="false"scrollPolicyH="off"bae:Listid="list"itemRendererSkinName="FamilyInfoItemSkin"bae:ArrayCollectionbae:Arrayba!--ae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cb--bace:Arraybace:ArrayCollectionbae:layoutbae:VerticalLayoutgap="4"cbace:layoutbace:Listbace:Scrollerbae:Groupx="542"y="139"bae:Labelid="fName"text="家族的名称"x="-31.659999999999968"y="24.340000000000003"fontFamily="main_font"size="28"scaleX="1"scaleY="1"textColor="0xad5907"cbae:Labelid="needCups"text="d需要奖杯：0000e"x="-21.659999999999968"y="34.34"fontFamily="desc_font"size="22"scaleX="1"scaleY="1"textColor="0xb27711"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"cbace:layoutbace:Groupbae:Scrollerwidth="400"height="80"x="539"y="169"scrollPolicyH="off"bae:Groupbae:Labelid="desc"text="家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，家族简介，"size="24"fontFamily="desc_font"textColor="0xa67f64"left="0"right="0"top="5"bottom="0"cbace:Groupbace:Scrollerbae:Groupx="458.38"y="287.09"width="130"height="30"bae:Labelid="zhanli"text="0000"fontFamily="main_font"size="28"textAlign="left"scaleX="1"scaleY="1"textColor="0xFFDE24"x="-8"height="30"verticalAlign="middle"cbae:Imagescale9Grid="22,20,13,5"anchorOffsetX="0"scaleX="1"scaleY="1"source="bg_phb_jb"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"horizontalAlign="center"cbace:layoutbace:Groupbae:Groupx="666.85"y="285.27"width="130"height="30"bae:Labelid="cups"text="0000"fontFamily="main_font"size="28"textAlign="center"scaleX="1"scaleY="1"textColor="0xFFDE24"x="-8"height="30"verticalAlign="middle"cbae:Imagescale9Grid="22,20,13,5"anchorOffsetX="0"scaleX="1"scaleY="1"source="bg_phb_jb"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"horizontalAlign="center"cbace:layoutbace:Groupbae:Labeltext="实力:"x="394.5"y="290"fontFamily="desc_font"size="24"textColor="0xa46e44"cbae:Labelid="memberNum"text="成员:"x="394"y="330"fontFamily="desc_font"size="24"textColor="0xA46E44"cbae:Labeltext="战绩:"x="604.5"y="290"fontFamily="desc_font"size="24"textColor="0xA46E44"cbae:Labelid="local"text="地区:"x="604.5"y="330"fontFamily="desc_font"size="24"textColor="0xA46E44"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyMemberPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"bae:Groupid="root"width="1280"x="0"height="720"y="0"bae:Rectleft="0"right="0"top="0"bottom="0"alpha="0.7"scaleX="1"scaleY="1"cbae:RectscaleX="1"scaleY="1"width="600"height="300"y="363.18"horizontalCenter="0"fillColor="0xff992d"cbae:Labelid="title"text="成员信息"horizontalCenter="0"top="60"x="580"y="60"scaleX="1"scaleY="1"cbans1:SButtonid="closeButton"label=""skinName="BtnOnlyIconSkin"scaleX="1"scaleY="1"x="0"y="0"icon="button_hero_return"cbae:Labelid="rank"text="100"y="137.73"x="839"scaleX="1"scaleY="1"cbae:Labelid="fName"text="家族的名字很长长长长长长长"x="481.64"y="141.21"size="20"fontFamily="desc_font"bold="true"scaleX="1"scaleY="1"cbae:Labelid="mName"text="玩家的名字很长长长长长长长"x="481.64"y="181.22"size="20"fontFamily="desc_font"bold="true"scaleX="1"scaleY="1"cbae:Labelid="cups"text="cups:000000000"x="839"y="171"scaleX="1"scaleY="1"cbae:Labeltext="常用英雄"x="376.18"y="290"scaleX="1"scaleY="1"cbae:Labeltext="d平均花费法力:00.0e"x="658.91"y="290"scaleX="1"scaleY="1"cbae:Labeltext="这里是队伍阵容"y="451.52"scaleX="1"scaleY="1"horizontalCenter="0"cbagame:HeadIconid="headIcon"x="342"y="116"skinName="HeadIconSkin"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyRecommendItemSkin"width="954"height="117"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"ba!--ae:Imagesource="家族01_jpg"y="-86"x="-290"cb--bae:Imageid="bg"anchorOffsetX="0"right="0"source="bg_phb_tmdi0_1"scale9Grid="31,35,17,46"bottom="0"scaleX="1"scaleY="1"top="0"left="0"cbae:ImageanchorOffsetX="0"x="-0.52"scale9Grid="31,35,24,46"height="112"width="388"verticalCenter="-2.5"source="bg_jz_mzdi"cbae:Imagewidth="164"height="40"x="569.01"source="bg_jz_jbsdi"scale9Grid="15,5,8,30"verticalCenter="-3.5"cbae:Imagewidth="164"height="40"x="755.68"source="bg_jz_jbsdi"scale9Grid="15,5,8,30"verticalCenter="-3.5"cbagame:FamilyIconid="familyIcon"skinName="FamilyIconSkin"left="27"verticalCenter="0.5"hasBg="false"cbae:Labelid="fName"text="家族的名字很长长长长长长长"x="138"y="25.2"size="32"fontFamily="main_font"scaleX="1"scaleY="1"textColor="0xbd7b49"cbae:Labelid="local"text="需要奖杯：0000"x="138"y="66.4"size="26"fontFamily="desc_font"scaleX="1"scaleY="1"textColor="0xa7845e"cbae:Labelid="memberNum"text="000c000人"x="415"verticalCenter="-0.5"y="35"scaleX="1"scaleY="1"fontFamily="desc_font"size="28"textColor="0xa46e44"cbae:Groupx="575.6"y="41.33"width="150"height="30"bae:Labelid="cups"text="123655"fontFamily="main_font"size="28"textAlign="left"scaleX="1"scaleY="1"textColor="0xffde24"x="-8"cbae:Imagescale9Grid="22,20,13,5"anchorOffsetX="0"scaleX="1"scaleY="1"source="bg_phb_jb"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"horizontalAlign="center"cbace:layoutbace:Groupbae:Groupx="762"y="41.33"width="150"height="30"bae:Labelid="zhanli"text="00000"fontFamily="main_font"size="28"textAlign="left"scaleX="1"scaleY="1"textColor="0xffc424"cbae:Imagescale9Grid="22,20,13,5"anchorOffsetX="0"scaleX="1"scaleY="1"source="bg_jz_jbc"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"horizontalAlign="center"cbace:layoutbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyRecommendPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"ba!--ae:Imagesource="家族01_jpg"visible="true"cb--bae:Scrollerid="hasList"width="974.67"height="609.34"y="75.72"anchorOffsetY="0"horizontalCenter="137.5"touchEnabled="true"anchorOffsetX="0"bae:Listid="list"itemRendererSkinName="FamilyRecommendItemSkin"bae:ArrayCollectionbae:Arrayba!--ae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cb--bace:Arraybace:ArrayCollectionbae:layoutbae:VerticalLayoutpaddingTop="10"cbace:layoutbace:Listbace:Scrollerbae:Labelid="noListTips"text="很抱歉，当前没有符合的家族\n你可以创建属于自己的家族"y="335.66"horizontalCenter="140"width="400"fontFamily="desc_font"bold="true"textColor="0x888888"size="24"textAlign="center"lineSpacing="6"cbae:Imagex="16"y="562.5"source="bg_jz_sousdi"scale9Grid="12,15,9,27"anchorOffsetX="0"width="214"cbans1:SInputLabelid="sechInput"text="家族名称"x="24.51"y="559.35"width="160"height="60"verticalAlign="middle"textAlign="left"type="input"background="false"backgroundColor="0x130A33"fontFamily="desc_font"size="26"italic="true"textColor="0x54b3a9"cbans1:SButtonid="sarchBtn"label="搜索"anchorOffsetX="0"width="214"horizontalCenter="-517"verticalCenter="304"icon="button_ty_green"height="64"skinName="FamilySearchBtnSkin"cbans1:SButtonid="clearBtn"label=""scaleX="1"scaleY="1"horizontalCenter="-433"verticalCenter="230.5"visible="false"bans1:skinNamebae:Skinstates="up,down,disabled"xmlns:game="game.*"bae:Imagewidth="100%"height="100%"source="button_tc_close"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilySearchBtnSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"width="214"height="64"bae:Imagesource="button_ty_green"left="0"right="0"scale9Grid="14,7,86,35"top="0"bottom="0"cbae:Imagesource="icon_jz_fdj"left="6"verticalCenter="-4.5"cbae:Labelid="labelDisplay"text="搜索"left="70"right="0"top="0"bottom="8"verticalAlign="middle"textAlign="center"fontFamily="desc_font"textColor="0x2f856e"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyTextInput2Skin"width="355"height="55"xmlns:e="http:ccns.egret.comceui"states="normal,disabled,normalWithPrompt,disabledWithPrompt"bae:EditableTextid="textDisplay"left="0"right="0"textColor.disabled="0xff0000"size="26"top="0"bottom="0"verticalAlign="top"fontFamily="desc_font"textColor="0xa49484"textAlign="left"multiline="true"cbae:Labelid="promptDisplay"left="0"right="0"size="26"touchEnabled="false"includeIn="normalWithPrompt,disabledWithPrompt"top="0"bottom="0"verticalAlign="top"fontFamily="desc_font"textColor="0xa49484"textAlign="left"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyTextInputSkin"width="355"height="55"xmlns:e="http:ccns.egret.comceui"states="normal,disabled,normalWithPrompt,disabledWithPrompt"width.disabled="355"height.disabled="55"bae:EditableTextid="textDisplay"left="0"right="0"textColor.disabled="0xff0000"size="30"top="0"bottom="0"verticalAlign="middle"fontFamily="main_font"textColor="0x9a8981"cbae:Labelid="promptDisplay"left="0"right="0"size="30"touchEnabled="false"includeIn="normalWithPrompt,disabledWithPrompt"top="0"bottom="0"verticalAlign="middle"fontFamily="main_font"textColor="0x9a8981"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilySettingPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:ns1="*"xmlns:w="http:ccns.egret.comcwing"bae:Rectleft="0"right="0"top="0"bottom="0"alpha="0.3"cba!--ae:Imagesource="家族12-主页07_jpg"cb--bae:Groupwidth="990"height="644"anchorOffsetX="0"horizontalCenter="0"verticalCenter="30"bagame:CommonWinid="comWin"skinName="CommonWinSkin"scaleX="1"scaleY="1"left="0"right="0"top="0"bottom="0"cbae:ImageanchorOffsetY="0"source="bg_jz_xzhzdi"scale9Grid="15,11,32,32"width="492"scaleX="1"scaleY="1"x="17"height="573"y="54"cbae:Imagex="501.92"y="141.42"anchorOffsetY="0"source="bg_jz_xzhzdi_jt"scaleX="1"scaleY="1"cbae:Imagex="30.92"y="98"anchorOffsetY="0"source="bg_jz_xx01"width="456"scaleX="1"scaleY="1"cbae:Imagex="30.92"y="382"anchorOffsetY="0"source="bg_jz_xx01"width="456"scaleX="1"scaleY="1"cbae:Imagex="650.43"y="69.62"source="bg_jz_hzqdi"scale9Grid="21,12,19,31"anchorOffsetX="0"width="180"height="174"scaleX="1"scaleY="1"cbae:Imagex="656"y="51.22"source="bg_jz_hzqdi_x"scale9Grid="5,3,37,12"width="168"height="36"scaleX="1"scaleY="1"cbae:Scrollerid="scro1"width="460"x="35.66"y="117.18"anchorOffsetX="0"anchorOffsetY="0"height="220"scaleX="1"scaleY="1"bae:Listid="list"itemRendererSkinName="FamilyIconSkin"x="13.33"bae:ArrayCollectionbae:Arraycbace:ArrayCollectionbae:layoutbae:TileLayoutrequestedColumnCount="4"horizontalGap="16"verticalGap="8"paddingTop="6"cbace:layoutbace:Listbace:Scrollerbae:Scrollerwidth="460"x="35.66"y="394.18"anchorOffsetX="0"anchorOffsetY="0"height="220"scaleX="1"scaleY="1"bae:Listid="list1"itemRendererSkinName="FamilyIconSkin"x="13.33"bae:ArrayCollectionbae:Arraycbace:ArrayCollectionbae:layoutbae:TileLayoutrequestedColumnCount="4"horizontalGap="20"verticalGap="10"cbace:layoutbace:Listbace:Scrollerbagame:FamilyIconid="familyIcon"x="680"y="88.48"skinName="FamilyIconSkin"scaleX="1.3"scaleY="1.3"hasBg="false"cbae:Labeltext="选择徽标"x="202.03"y="58.82"fontFamily="main_font"size="30"textColor="0x967447"scaleX="1"scaleY="1"cbae:Labeltext="选择徽底"x="202.03"y="346.82"fontFamily="main_font"textColor="0x967447"scaleX="1"scaleY="1"cbace:Groupbae:Groupid="group1"x="672.84"y="342"width="438"bae:ImageanchorOffsetY="0"source="bg_kz_kpxx_szd01"scale9Grid="8,7,5,45"height="200"scaleX="1"scaleY="1"left="0"right="0"cbae:TextInputid="descInput"width="404"height="166"prompt="欢迎兄弟姐妹们，一起打造强大的家族！"skinName="FamilyTextInput2Skin"enabled="true"scaleX="1"scaleY="1"anchorOffsetY="0"anchorOffsetX="0"horizontalCenter="0.5"y="17.33"cbae:CheckBoxid="autoJoin"label="满足奖杯数自动通过申请"skinName="FamilyCheckSkin"scaleX="1"scaleY="1"y="206"x="2.68"cbagame:FamilyDrowMenuid="menuBtn"scaleX="1"scaleY="1"skinName="FamilyDrowMenuSkin"width="210"y="227.33"x="2.68"cbans1:SButtonid="saveBtn"label="保存更改"skinName="BtnCommonSkin"icon="button_ty_green"width="170"height="75"scaleX="1"scaleY="1"y="265.36"x="262.7"cbace:Groupbae:Groupid="group2"x="672.05"y="342"width="438"visible="false"bae:ImageanchorOffsetY="0"source="bg_kz_kpxx_szd01"scale9Grid="8,7,5,45"height="70"scaleX="1"scaleY="1"left="0"right="0"cbae:ImageanchorOffsetY="0"source="bg_kz_kpxx_szd01"scale9Grid="8,7,5,45"height="162"scaleX="1"scaleY="1"left="0"right="0"y="87.5"cbae:Labeltext="家族战获得奖杯数累计达到目标值即解锁该徽章"y="123"width="400"horizontalCenter="0"textAlign="center"size="26"lineSpacing="10"fontFamily="desc_font"cbans1:SButtonid="okBtn"label="知道了"y="268"scaleX="1"scaleY="1"horizontalCenter="-1"skinName="Btn2Skin"width="160"height="64"cbae:ProgressBarid="kaPaiNumProg"height="32"slideDuration="0"verticalCenter="-133"y="4"scaleX="1"scaleY="1"skinName="Bar5Skin"width="400"horizontalCenter="0"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyShopBuyPanel1Skin"width="1280"height="720"currentState="common"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"states="common,lock"bae:RectincludeIn="common"left="0"right="0"top="0"bottom="0"alpha="0.3"cba!--ae:Imagesource="家族13-商店04_jpg"cb--bae:Groupid="root"width="572"height="400"horizontalCenter="0"y="120"height.lock="542"bagame:CommonWinid="commWin"skinName="CommonWinSkin"scaleX="1"scaleY="1"left="0"right="0"top="0"bottom="0"cbae:Imagewidth="520"height="234"y="64.43"source="bg_kz_kpxx_szd01"scale9Grid="7,20,7,24"anchorOffsetX="0"horizontalCenter="0"cbae:Imagewidth="520"height="130"y="312.43"source="bg_kz_kpxx_szd01"scale9Grid="7,20,7,24"anchorOffsetX="0"horizontalCenter="0"includeIn="lock"cbae:Imagesource="bg_grzl_di_gz02"scale9Grid="18,20,15,24"width="212"height="242"y="60.03"x="24"cbae:Imagewidth="192"height="32"x="28"y="255.01"source="bg_shop_mrxg_btdi"scale9Grid="5,4,29,24"anchorOffsetX="0"cbae:Buttonid="buyBtn"label="购买"y="310.63"skinName="Btn1Skin"icon="button_ty_yellow"width="140"horizontalCenter="0"height="62"horizontalCenter.lock="0"y.lock="454.63"label.lock="知道了"skinName.lock="BtnCommonSkin"icon.lock="button_ty_green"cbagame:FamilyShopItemIconskinName="FamilyShopItemIconSkin"y="75"x="30"width="200"height="200"cbae:Groupid="rightTips"x="28.4"y="259.4"scaleX="1"scaleY="1"width="190"bae:Labeltext="每日限购"y="5"size="24"fontFamily="desc_font"textColor="0xFAE192"stroke="2"strokeColor="0xAC6F26"right="8"cbae:Groupright="8"y="34"bae:Labelid="hasBuy"text="0"fontFamily="main_font"size="24"textColor="0xFAE192"stroke="2"strokeColor="0xAC6F26"cbae:Labeltext="c"fontFamily="desc_font"size="24"textColor="0xFAE192"stroke="2"strokeColor="0xAC6F26"x="10"y="10"cbae:Labelid="limitBuy"text="0"fontFamily="main_font"size="24"textColor="0xFAE192"stroke="2"strokeColor="0xAC6F26"x="20"y="20"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"horizontalAlign="right"gap="1"cbace:layoutbace:Groupbae:layoutbae:HorizontalLayouthorizontalAlign="center"gap="16"cbace:layoutbace:Groupbae:Labelid="desc"text="礼包描述说明"x="241.5"y="75.5"fontFamily="desc_font"size="24"textColor="0xa67f64"width="290"anchorOffsetY="0"height="213"cbae:Labelid="tips"text="家族势力达到0000奖杯解锁"includeIn="lock"y="336"fontFamily="main_font"size="26"textColor="0x966c50"horizontalCenter="0.5"cbae:ProgressBarid="prog"skinName="Bar5Skin"height="28"slideDuration="0"left.common="4"right.common="-4"verticalCenter.common="0"x.common="-350"y="226"scaleX="1"scaleY="1"width.lock="400"height.lock="36"y.lock="375.5"horizontalCenter.lock="0"currentState.lock="noneLb"includeIn="lock"cbae:BitmapLabelid="progLb"font="card_num_font_fnt"horizontalCenter="1"text="0000!0000"horizontalCenter.lock="1"y.lock="378.79"includeIn="lock"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyShopBuyPanel3Skin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"ba!--ae:Imagesource="家族13-商店05_jpg"cb--bae:Groupwidth="630"height="534"y="127.04"anchorOffsetY="0"horizontalCenter="0"bagame:CommonWinid="commWin"skinName="CommonWinSkin"left="0"right="0"top="0"bottom="0"cbae:Imagey="-82"source="icon_jz_sd_bx"horizontalCenter="0"cbae:Imagewidth="580"height="384"y="55.39"source="bg_kz_kpxx_szd01"scale9Grid="7,20,7,24"anchorOffsetX="0"horizontalCenter="0"x="41"scaleX="1"scaleY="1"anchorOffsetY="0"cbae:Imagey="397.65"source="bg_jz_xx01"horizontalCenter="0"cbae:Labeltext="已升满级的英雄卡片自动炼化获得神魂"y="407.99"fontFamily="desc_font"size="22"horizontalCenter="0"textColor="0xa67f64"cbans1:SButtonlabel="确定"y="449.5"skinName="Btn1Skin"horizontalCenter="0"icon="button_ty_yellow"width="142"height="62"cbae:Scrollerwidth="580.67"height="330"y="63.84"anchorOffsetX="0"anchorOffsetY="0"horizontalCenter="11.5"scrollPolicyH="off"bae:ListitemRendererSkinName="Heroka5Skin"bae:ArrayCollectionbae:Arrayba!--ae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cb--bace:Arraybace:ArrayCollectionbae:layoutbae:TileLayouthorizontalGap="12"cbace:layoutbace:Listbace:Scrollerbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyShopItemIconSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"states="gold,dimand,box"width="200"height="200"bae:Imagesource="bg_shop_spdi_jb"horizontalCenter="0"verticalCenter="0"source.dimand="bg_shop_spdi_zs"source.box="bg_jz_dxdi"cbae:Imageid="showIcon"verticalCenter="0"source="icon_jb_01"horizontalCenter="0"source.dimand="icon_zs_06"source.box="button_sd"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyShopItemSkin"width="310"height="280"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"bae:Imagesource="家族13-商店01_jpg"x="-286"y="-101"visible="false"cbae:Imagealpha="1"anchorOffsetX="0"left="0"right="0"top="0"bottom="0"source="bg_shop_spdi"scale9Grid="34,65,17,124"cbae:Labelid="title"text="000000"fontFamily="main_font"top="11"horizontalCenter="0.5"textColor="0xcb8b1b"cbagame:PriceLabelid="priceLb"y="211"skinName="PriceLabelSkin"horizontalCenter="0"cbagame:FamilyShopItemIconid="iconImg"skinName="FamilyShopItemIconSkin"horizontalCenter="0"verticalCenter="0"touchEnabled="false"touchChildren="false"cbae:Labelid="testId"text="Label"textColor="0x000000"horizontalCenter="0"verticalCenter="0"cbagame:ZheKouid="zhekou"x="240"y="6"skinName="ZheKouSkin"cbae:Groupid="rightTips"x="194"y="48"bae:Imagesource="bg_shop_mrxg_di"left="0"right="0"scale9Grid="12,8,84,49"cbae:Labeltext="每日限购"y="5"size="24"fontFamily="desc_font"textColor="0xfae192"stroke="2"strokeColor="0xac6f26"right="8"cbae:Groupright="8"y="34"bae:Labeltext="0"fontFamily="main_font"size="24"textColor="0xfae192"stroke="2"strokeColor="0xac6f26"cbae:Labeltext="c"fontFamily="desc_font"size="24"textColor="0xFAE192"stroke="2"strokeColor="0xAC6F26"x="10"y="10"cbae:Labeltext="0"fontFamily="main_font"size="24"textColor="0xFAE192"stroke="2"strokeColor="0xAC6F26"x="20"y="20"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"horizontalAlign="right"gap="1"cbace:layoutbace:Groupbace:Groupbae:Groupwidth="150"height="36"x="6.83"y="48"bae:Imagesource="icon_shop_xs_di"left="0"right="0"top="0"bottom="0"scale9Grid="4,4,15,12"cbae:Imagesource="icon_shop_xs_bp"y="1"x="2.5"cbae:Labeltext="00小时00分"x="39"fontFamily="desc_font"textColor="0x9c2cce"size="20"verticalCenter="0"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FamilyShopPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagesource="家族13-商店01_jpg"cb--bae:Scrollerwidth="989.4"height="589.39"x="286.79"y="101.32"anchorOffsetX="0"anchorOffsetY="0"touchChildren="true"touchEnabled="false"ba!--ae:Listid="list"itemRendererSkinName="FamilyShopItemSkin"b--bae:Listid="list"touchEnabled="false"itemRendererSkinName=""anchorOffsetX="0"width="793.94"bae:layoutbae:TileLayoutverticalGap="22"requestedColumnCount="3"horizontalGap="18"cbace:layoutbae:ArrayCollectionbae:Arrayba!--ae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cb--bace:Arraybace:ArrayCollectionbace:Listbace:Scrollerbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="PriceLabelSkin"currentState="type1"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"states="type1"bae:GroupincludeIn="type1"bae:Imageid="icon"source="icon_top_diamond"scaleX="0.9"scaleY="0.9"verticalCenter.type1="0"x.type1="0"y.type1="0"scaleX.type1="0.9"scaleY.type1="0.9"cbae:Labelid="p1"text="0000"fontFamily="main_font"scaleX="1"scaleY="1"size="34"verticalCenter.type1="0"x.type1="0"y.type1="10"scaleX.type1="1"scaleY.type1="1"textColor="0x999999"cbae:Labelid="p2"text="0000"fontFamily="main_font"scaleX="1"scaleY="1"size="34"textColor="0x4193D2"verticalCenter.type1="0"x.type1="0"y.type1="10"scaleX.type1="1"scaleY.type1="1"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"cbace:layoutbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ZheKouSkin"currentState="type1"xmlns:e="http:ccns.egret.comceui"states="type1,type2,type3,type4"bae:Imagesource="icon_shop_dz"scale9Grid="8,9,45,22"cbae:Labelid="zhekou"text="0.0折"textColor="0xE44343"fontFamily="main_font"size="20"scaleX="1"scaleY="1"verticalAlign="middle"textAlign="center"width="69"height="39"horizontalCenter="0"verticalCenter="0"text.type2="热门"text.type3="超值"text.type4="限时"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="PlayerInfoMainPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagesource="排行榜01_jpg"cb--bagame:MainPanelBgid="mainBg"skinName="MainPanelBgSkin"currentState="commonNoBg"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="PlayerInfoPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:ns1="*"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagescale9Grid="0,10,7,62"anchorOffsetY="0"visible="true"source="个人资料01_jpg"cb--bae:Imagex="271.6"y="65.27"source="bg_lz_tc"scale9Grid="30,21,63,57"anchorOffsetX="0"width="507"anchorOffsetY="0"height="642"cbae:Imagex="792.82"y="70.94"source="home_ui_kz_json.bg_com_fgd"scale9Grid="6,6,42,38"anchorOffsetX="0"width="466"anchorOffsetY="0"height="629.6"cbae:Imagex="786.99"y="80"anchorOffsetX="0"source="home_ui_kz_json.bg_kplb_bt"scale9Grid="38,11,388,24"cbae:Imagesource="home_ui_jd_json.bg_jd_topt"anchorOffsetX="0"scaleX="1"scaleY="1"x="787.56"y="77.8"scale9Grid="10,10,22,32"width="160"cbae:Imagex="297.13"y="238"anchorOffsetX="0"width="222"anchorOffsetY="0"height="195"source="bg_grzl_di_gz01"scale9Grid="27,63,12,96"cbae:Imagex="527.8"y="238"anchorOffsetX="0"width="222"anchorOffsetY="0"height="195"scale9Grid="27,63,12,96"source="bg_grzl_di_gz01"cbae:Imagex="298"y="440"anchorOffsetX="0"width="452"height="63"source="bg_grzl_di_gz02"scale9Grid="15,21,16,22"cbae:Imagex="301.99"y="444.02"anchorOffsetX="0"source="bg_grzl_di_gz03"width="142"scale9Grid="17,20,2,12"cbae:Imagex="298"y="508.32"scale9Grid="15,21,16,22"anchorOffsetX="0"width="452"height="63"source="bg_grzl_di_gz02"cbae:Imagex="301.99"y="511.39"scale9Grid="17,20,2,12"anchorOffsetX="0"source="bg_grzl_di_gz03"width="142"cbae:Imagex="298"y="577"scale9Grid="15,21,16,22"anchorOffsetX="0"width="452"height="63"source="bg_grzl_di_gz02"cbae:Imagex="301"y="580.75"scale9Grid="17,20,2,12"anchorOffsetX="0"source="bg_grzl_di_gz03"width="142"cbae:Imagex="571.75"y="245"source="icon_grzl_02"cbae:Imagex="344.09"y="245"source="icon_grzl_01"cbae:Imagex="313"y="455.01"source="icon_grzl_03"cbae:Imagex="313"y="520.33"source="icon_grzl_04"cbae:Imagex="313"y="589.85"source="icon_grzl_05"cbae:Imagex="335.06"y="309.16"scale9Grid="40,4,32,25"source="icon_grzl_jb"cbae:Imagex="570.07"y="302.78"scale9Grid="40,4,32,25"source="icon_grzl_jjc"cbae:Imagex="336.04"y="349.49"source="icon_grzl_jb_smd"width="136"scale9Grid="40,4,66,25"cbae:Imagex="571.37"y="349"scale9Grid="40,4,32,25"width="136"source="icon_grzl_jjc_smd"cbae:Imagex="412.2"y="97.1"source="bg_grzl_namedi"anchorOffsetX="0"width="360"scale9Grid="31,26,28,10"cbae:Imagex="420.64"y="103.98"source="bg_grzl_namedi_xbdi"cbae:Imageid="sex"x="427.47"y="107.15"source="icon_xb_n"cbae:Imagex="1186.38"y="82.35"source="common_ui_common_json.icon_sh_d"cbae:Groupid="heroGroup"anchorOffsetX="0"anchorOffsetY="0"x="804.68"y="126.34"touchEnabled="false"bagame:HeroKaid="ka1"x="0"skinName="HeroKa1Skin"touchChildren="false"cbagame:HeroKaid="ka2"x="0"skinName="HeroKa1Skin"touchChildren="false"cbagame:HeroKaid="ka3"x="10"skinName="HeroKa1Skin"y="10"touchChildren="false"cbagame:HeroKaid="ka4"x="20"skinName="HeroKa1Skin"y="20"touchChildren="false"cbagame:HeroKaid="ka5"x="30"skinName="HeroKa1Skin"y="30"touchChildren="false"cbagame:HeroKaid="ka6"x="40"skinName="HeroKa1Skin"y="40"touchChildren="false"cbagame:HeroKaid="ka7"x="50"skinName="HeroKa1Skin"y="50"touchChildren="false"cbagame:HeroKaid="ka8"x="60"skinName="HeroKa1Skin"y="60"cbae:layoutbae:TileLayoutrowAlign="justifyUsingHeight"columnAlign="left"requestedColumnCount="2"paddingTop="8"horizontalGap="12"verticalGap="0"cbace:layoutbace:Groupbagame:HeadIcony="94.35"skinName="HeadIconSkin"x="288.18"scaleX="1.2"scaleY="1.2"cbae:Labeltext="奖杯"x="391.08"y="251.85"fontFamily="main_font"textColor="0xAD5907"size="26"cbae:Labeltext="竞技场"x="613.58"y="251"fontFamily="main_font"textColor="0xAD5907"size="26"cbae:Labeltext="等级"x="359.99"y="461.36"fontFamily="main_font"textColor="0xAD5907"size="26"cbae:Labeltext="家族"x="359"y="528.71"fontFamily="main_font"textColor="0xAD5907"size="26"cbae:Labeltext="地区"x="359"y="595.7"fontFamily="main_font"textColor="0xAD5907"size="26"cbae:Labeltext="常用卡组"fontFamily="main_font"size="30"y="89.31"x="806.67"textColor="0x97eff4"cbae:Labeltext="平均花费圣水："fontFamily="desc_font"size="26"x="964.01"y="91.33"textColor="0xffffff"cbae:BitmapLabelid="averageCost"x="1135.4"y="92"font="sh_font_fnt"text="0#0"scaleX="0.85"scaleY="0.85"letterSpacing="-6"cbae:Labelid="userName"text="玩家的昵称"x="472.58"y="112.02"fontFamily="desc_font"textColor="0xad5907"width="220"textAlign="center"cbae:Labelid="cupsLb"text="00000"x="330.58"y="352.36"fontFamily="desc_font"textColor="0xf2d45e"stroke="2"strokeColor="0xa04909"size="28"width="150"textAlign="center"cbae:Labelid="codeNum"text="编号：fesf12345662"x="426.63"y="160.79"fontFamily="desc_font"textColor="0xb0865a"size="26"visible="false"cbae:Labelid="levelLb"text="5级"x="458"y="458.76"size="26"fontFamily="desc_font"textColor="0x966c50"cbae:Labelid="familyName"text="家族名称"x="458"y="527.78"size="26"textColor="0x966c50"fontFamily="desc_font"cbae:Labelid="localName"text="中国"x="458"y="595.99"size="26"textColor="0x966c50"fontFamily="desc_font"cbae:Groupx="601"y="352"scaleX="0.8"scaleY="0.8"width="100"bae:BitmapLabelid="stepLb"font="jjc_lv_fnt"text="00"scaleX="1"scaleY="1"cbae:Imagex="106"y="81"source="icon_grzl_jjc_j"cbae:layoutbae:HorizontalLayouthorizontalAlign="center"cbace:layoutbace:Groupbans1:SButtonid="editNameBtn"label=""x="723"y="127"anchorOffsetX="20"anchorOffsetY="24"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="home_ui_grzl_json.button_rename"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FriendChatImgItemSkin"width="880"height="150"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="880"height="150"x="0"y="0"bae:Groupid="iconInfo"width="100"height="100"x="0"verticalCenter="0"bae:Imagey="-0.47"scale9Grid="12,12,76,78"source="common_ui_playericon_json.bg_phb_heroicon"x="0"scaleX="1"scaleY="1"cbae:Imageid="playerIcon"source="common_ui_playericon_json.1001"x="15"y="16.03"scaleX="1"scaleY="1"cbae:Imagex="-0.8"y="-1.17"scaleX="1"scaleY="1"source="common_ui_playericon_json.bg_phb_heroicon_up02"cbace:Groupbae:Imageid="bg"source="common_ui_playericon_json.bg_phb_heroicon"x="110"anchorOffsetY="0"height="170"scale9Grid="17,18,66,63"anchorOffsetX="0"width="177"scaleX="1"scaleY="1"verticalCenter="0"cbae:Imageid="ani"source="common_ui_heroicon_json.10030"x="145"verticalCenter="4"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FriendChatTextItemSkin"width="880"height="100"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="880"height="100"x="0"y="0"bae:Groupid="iconInfo"width="100"height="100"x="780"y="0"bae:Imagey="-0.47"scale9Grid="12,12,76,78"source="common_ui_playericon_json.bg_phb_heroicon"x="0"scaleX="1"scaleY="1"cbae:Imageid="playerIcon"source="common_ui_playericon_json.1001"x="15"y="16.03"scaleX="1"scaleY="1"cbae:Imageid="playerEdge"x="-0.8"y="-1.17"scaleX="1"scaleY="1"source="common_ui_playericon_json.bg_phb_heroicon_up02"cbace:Groupbae:Imageid="bg"source="common_ui_playericon_json.bg_phb_heroicon"x="370"anchorOffsetY="0"height="120"scale9Grid="17,18,66,63"anchorOffsetX="0"scaleX="1"scaleY="1"verticalCenter="0"width="400"cbae:Labelid="text"text="Labelsdfsdfsdfsdsdfsdffsdff"x="130"verticalCenter="0"fontFamily="desc_font"size="26"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FriendChatTimeItemSkin"width="880"height="100"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="880"height="100"x="0"y="0"bae:Labelid="text"text="Labelsdfsdfsdfsdsdfsdffsdff"verticalCenter="0"fontFamily="desc_font"size="26"horizontalCenter="0"textAlign="center"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FriendInfoSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Groupid="root"width="1280"height="720"x="0"y="0"bae:Imagesource="button_png"x="0"y="0"scale9Grid="19,6,115,36"width="1280"height="720"alpha="1"cbae:Imagesource="common_ui_common_json.bg_blue_00"x="365"y="95"scale9Grid="1,1,2,2"width="880"height="490"cbae:Imagesource="common_ui_common_json.bg_blue_00"x="16"y="95"scale9Grid="1,1,2,2"width="320"height="600"cbae:Labeltext="好友"x="30"y="18"anchorOffsetX="0"width="95.45"anchorOffsetY="0"height="40.91"cbae:ProgressBarid="countBar"width="185.15"height="48.79"x="161.84"y="11.88"anchorOffsetX="0"anchorOffsetY="0"bae:skinNamebae:Skinwidth="307"height="40"bae:Imageleft="0"right="0"top="0"bottom="0"scale9Grid="59,14,26,8"source="home_ui_task_json.bg_re_lb_jd_di01"height="40"cbae:Imageid="thumb"left="0"right="0"top="0"bottom="0"scale9Grid="62,12,35,9"source="home_ui_task_json.bg_re_lb_jd_di02"cbae:Labelid="labelDisplay"text="560c1000"size="25"fontFamily="main_font"verticalAlign="middle"textAlign="center"bold="true"textColor="0x50799F"verticalCenter="0"horizontalCenter="0"cbace:Skinbace:skinNamebace:ProgressBarbae:Scrollerid="game_list_scroller_left"width="320"height="600"x="16"y="95"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"bae:Listid="game_list_left"itemRendererSkinName="FriendLeftItemSkin"x="39.39"y="-278.79"bace:Listbace:Scrollerbae:Scrollerid="game_list_scroller_right"width="880"height="490"x="365"y="95"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"bans1:SEuiListid="game_list_right"x="39.39"y="-278.79"anchorOffsetY="0"height="507.57"bacns1:SEuiListbace:Scrollerbans1:SGroupid="inviteBtn"width="120"height="80"horizontalCenter="-206"verticalCenter="303"bans1:SButtonlabel="邀请"anchorOffsetY="0"height="80"anchorOffsetX="0"width="120"x="0"y="0"scaleX="1"scaleY="1"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_playericon_json.bg_phb_heroicon"scale9Grid="19,21,61,60"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Imageid="bottomRedDot"source="common_ui_common_json.icon_hotpoint"x="82.66"y="13.94"cbacns1:SGroupbae:Imagesource="common_ui_common_json.bg_blue_00"x="510"y="626.27"scale9Grid="1,1,2,2"anchorOffsetX="0"width="440"anchorOffsetY="0"height="60"cbans1:SInputLabelid="input"text="输入信息最长50个字"x="520"anchorOffsetX="0"width="414"anchorOffsetY="0"height="50"fontFamily="desc_font"y="632"inputType="input"verticalAlign="middle"type="input"cbans1:SButtonid="sendBtn"label="发送"anchorOffsetY="0"height="80"anchorOffsetX="0"width="156"horizontalCenter="506"verticalCenter="305"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_playericon_json.bg_phb_heroicon"scale9Grid="18,19,65,63"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="deleteBtn"label="删除"anchorOffsetY="0"height="80"anchorOffsetX="0"width="156"horizontalCenter="536"verticalCenter="-237"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_playericon_json.bg_phb_heroicon"scale9Grid="18,19,65,63"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="closeBtn"label=""scaleX="2"scaleY="2"rotation="45"horizontalCenter="572.5"verticalCenter="-311.5"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="home_ui_common_json.button_top_add"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FriendInviteItemSkin"width="1200"height="120"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Groupid="root"width="1200"height="120"x="0"y="0"bae:Imagesource="common_ui_playericon_json.bg_phb_heroicon"x="0"y="0"height="120"width="1200"scale9Grid="19,24,60,58"cbae:Groupid="iconInfo"width="100"height="100"x="0"scaleX="1"scaleY="1"verticalCenter="0"bae:Imagey="-0.47"scale9Grid="12,12,76,78"source="common_ui_playericon_json.bg_phb_heroicon"x="0"scaleX="1"scaleY="1"cbae:Imageid="playerIcon"source="common_ui_playericon_json.1001"x="15"y="16.03"scaleX="1"scaleY="1"cbae:Imagex="-0.8"y="-1.17"scaleX="1"scaleY="1"source="common_ui_playericon_json.bg_phb_heroicon_up02"cbace:Groupbae:BitmapLabelid="cupCount"width="83.82"height="25.33"x="698.09"y="58.83"font="cup_font_fnt"text="3308"anchorOffsetX="0"anchorOffsetY="0"textAlign="right"letterSpacing="0"cbae:Imagex="787.19"y="56.03"source="common_ui_common_json.icon_top_cup"cbae:Labelid="playerName"text="角色名称六字"x="147"y="54.4"fontFamily="main_font"size="27"stroke="0"anchorOffsetX="0"width="172.5"anchorOffsetY="0"height="24"border="false"textColor="0x66C9DB"bold="true"cbae:Labelid="lvLabel"text="15"x="491.7"y="54.4"fontFamily="desc_font"size="27"stroke="0"anchorOffsetX="0"width="37.3"anchorOffsetY="0"height="24"border="false"bold="true"textColor="0xFFFFFF"cbans1:SButtonid="okBtn"label="接受"anchorOffsetX="0"width="120"anchorOffsetY="0"height="78"scaleX="1"scaleY="1"verticalCenter="0"horizontalCenter="352"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.bg_blue_00"scale9Grid="1,1,2,2"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="cancelBtn"label="拒绝"anchorOffsetX="0"width="120"anchorOffsetY="0"height="78"scaleX="1"scaleY="1"verticalCenter="0"horizontalCenter="486"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.bg_blue_00"scale9Grid="1,1,2,2"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FriendInviteSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="1280"height="720"x="0"y="0"bae:Imagesource="button_png"x="0"y="0"width="1280"height="720"scale9Grid="19,6,115,36"cbae:Imagesource="common_ui_common_json.bg_blue_00"x="42"y="225"scale9Grid="1,1,2,2"width="1200"height="480"cbans1:SGroupid="inviteBtn"width="210"height="78"horizontalCenter="-479"verticalCenter="-213"bae:Buttonlabel="邀请"anchorOffsetX="0"width="210"anchorOffsetY="0"height="78"scaleX="1"scaleY="1"x="0"y="0"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.bg_blue_00"scale9Grid="1,1,2,2"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebace:Buttonbae:Imageid="inviteRedDot"source="common_ui_common_json.icon_hotpoint"x="190"y="0"scaleX="1"scaleY="1"cbacns1:SGroupbans1:SButtonid="recommendBtn"label="推荐"anchorOffsetX="0"width="210"anchorOffsetY="0"height="78"scaleX="1"scaleY="1"horizontalCenter="-249"verticalCenter="-213"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.bg_blue_00"scale9Grid="1,1,2,2"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Labelid="friendCount"text="您的好友：20c100人"x="714"y="128"fontFamily="desc_font"textColor="0x00e9ff"bold="true"cbans1:SButtonid="refreshBtn"label="换一批"anchorOffsetX="0"width="210"anchorOffsetY="0"height="78"horizontalCenter="503"verticalCenter="-223"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.bg_blue_00"scale9Grid="1,1,2,2"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Scrollerid="game_list_scroller"width="1200"height="480"x="42"y="225"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"bae:Listid="game_list"x="0"y="66"anchorOffsetY="0"height="480"itemRendererSkinName="FriendInviteItemSkin"bace:Listbace:Scrollerbae:Labelid="title"text="好友邀请"y="26"horizontalCenter="0"size="40"fontFamily="main_font"cbans1:SButtonid="closeBtn"label=""scaleX="2"scaleY="2"rotation="45"horizontalCenter="572.5"verticalCenter="-311.5"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="home_ui_common_json.button_top_add"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Groupid="emptyTips"width="200"height="200"x="563"y="223"bae:Labelid="emptyLabel"text="当前没有合适的玩家推荐!"y="198"scaleX="1"scaleY="1"fontFamily="desc_font"textAlign="center"horizontalCenter="0"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FriendLeftItemSkin"width="320"height="100"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Groupid="root"width="320"height="100"x="0"y="0"bans1:SGroupid="scaleRoot"width="320"height="100"horizontalCenter="0"verticalCenter="0"bae:Imageid="clickBg"source="common_ui_playericon_json.bg_phb_heroicon"scale9Grid="18,22,61,56"width="320"height="100"verticalCenter="0"horizontalCenter="0"cbae:Imagey="-0.5"scale9Grid="12,12,76,78"source="common_ui_playericon_json.bg_phb_heroicon"x="-3"scaleX="1"scaleY="1"cbae:Imageid="playerIcon"source="common_ui_playericon_json.1001"x="12"y="16"scaleX="1"scaleY="1"cbae:Imagex="-3.8"y="-1.2"scaleX="1"scaleY="1"source="common_ui_playericon_json.bg_phb_heroicon_up02"cbae:BitmapLabelid="cupCount"width="83.82"height="25.33"x="132.09"y="55.2"font="cup_font_fnt"text="3308"anchorOffsetX="0"anchorOffsetY="0"textAlign="right"letterSpacing="0"scaleX="1"scaleY="1"cbae:Imagex="221.19"y="52.4"source="common_ui_common_json.icon_top_cup"scaleX="1"scaleY="1"cbae:Labelid="playerName"text="角色名称六字"x="95"y="13.52"fontFamily="main_font"size="27"stroke="0"anchorOffsetX="0"width="172.5"anchorOffsetY="0"height="24"border="false"textColor="0x66C9DB"bold="true"scaleX="1"scaleY="1"cbae:Labelid="offLine"text="离线"x="24"y="57"fontFamily="desc_font"size="22"stroke="2"anchorOffsetX="0"anchorOffsetY="0"border="false"bold="true"scaleX="1"scaleY="1"textColor="0xd3d3d3"cbae:Labelid="lvLabel"text="15"x="93.2"y="53.33"fontFamily="desc_font"size="26"stroke="0"anchorOffsetX="0"anchorOffsetY="0"border="false"bold="true"textColor="0xffffff"scaleX="1"scaleY="1"cbae:Imageid="reddot"source="common_ui_common_json.icon_hotpoint"x="298.6"y="2.62"scaleX="1"scaleY="1"cbans1:SGroupid="clickBtn"width="320"height="100"x="0"y="0"bacns1:SGroupbacns1:SGroupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="FriendRecommendItemSkin"width="1200"height="120"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Groupid="root"width="1200"height="120"x="0"y="0"bae:Imagesource="common_ui_playericon_json.bg_phb_heroicon"x="0"y="0"height="120"width="1200"scale9Grid="19,24,60,58"cbae:Groupid="iconInfo"width="100"height="100"x="0"scaleX="1"scaleY="1"verticalCenter="0"bae:Imagey="-0.47"scale9Grid="12,12,76,78"source="common_ui_playericon_json.bg_phb_heroicon"x="0"scaleX="1"scaleY="1"cbae:Imageid="playerIcon"source="common_ui_playericon_json.1001"x="15"y="16.03"scaleX="1"scaleY="1"cbae:Imagex="-0.8"y="-1.17"scaleX="1"scaleY="1"source="common_ui_playericon_json.bg_phb_heroicon_up02"cbace:Groupbae:BitmapLabelid="cupCount"width="83.82"height="25.33"x="698.09"y="58.83"font="cup_font_fnt"text="3308"anchorOffsetX="0"anchorOffsetY="0"textAlign="right"letterSpacing="0"cbae:Imagex="787.19"y="56.03"source="common_ui_common_json.icon_top_cup"cbae:Labelid="playerName"text="角色名称六字"x="147"y="54.4"fontFamily="main_font"size="27"stroke="0"anchorOffsetX="0"width="172.5"anchorOffsetY="0"height="24"border="false"textColor="0x66C9DB"bold="true"cbae:Labelid="lvLabel"text="15"x="491.7"y="54.4"fontFamily="desc_font"size="27"stroke="0"anchorOffsetX="0"width="37.3"anchorOffsetY="0"height="24"border="false"bold="true"textColor="0xFFFFFF"cbans1:SButtonid="addBtn"label="加好友"anchorOffsetX="0"width="210"anchorOffsetY="0"height="78"scaleX="1"scaleY="1"verticalCenter="0"horizontalCenter="445"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.bg_blue_00"scale9Grid="1,1,2,2"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Labelid="stateLabel"text="Label"x="1008"verticalCenter="-1"size="40"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="HeroLevelSkin"currentState="ui1"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"height="26"width="70"states="ui1,ui2"bae:Groupid="common"verticalCenter="0"visible.ui2="false"left="0"bae:Labelid="lvLb"text="15"x="33"y="12"size="28"fontFamily="pang_font"textColor="0x368dbe"stroke.ui1="2"strokeColor.ui1="0xefeadd"fontFamily.ui1="main_font"size.ui1="26"text.ui1="1"cbae:Labelid="lvLb2"text="级"x="34"y="7"size="26"fontFamily="wen_font"textColor="0x368dbe"stroke.ui1="2"strokeColor.ui1="0xefeadd"fontFamily.ui1="desc_font"size.ui1="22"cbae:layoutbae:HorizontalLayoutgap.ui2="-4"verticalAlign="bottom"horizontalAlign.ui1="center"verticalAlign.ui1="middle"gap.ui1="2"cbace:layoutbace:Groupbae:Groupid="superLv"scaleX="0.8"scaleY="0.8"verticalCenter="0"left.ui1="7"verticalCenter.ui1="0"visible.ui1="false"right.ui2="0"left="0"bae:Imagesource="icon_hero_star_0"x.ui1="6.25"cbae:Imagesource="icon_hero_star_0"x="10"y="10"cbae:Imagesource="icon_hero_star_0"x="20"y="20"cbae:layoutbae:HorizontalLayoutgap="0"cbace:layoutbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="JunDuiItemSkin"width="216"height="165"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagesource="军队01-军队_jpg"x="-303.07"y="-134.55"visible="false"cb--bae:ImageanchorOffsetX="0"anchorOffsetY="0"left="0"right="0"top="0"bottom="0"scale9Grid="20,15,14,19"source="bg_kp_dcs"cbagame:HeroKa1id="heroKa"skinName="HeroKa1Skin"x="1"cbae:Labelid="testId"text="Label"y="43"horizontalCenter="0"textColor="0xd30606"visible="false"cbae:Imageid="newTips"x="142"y="-3"source="home_ui_kz_json.icon_newk"visible="false"cbagame:ProgressExpid="progExp"skinName="ProgressExpSkin"horizontalCenter="0"bottom="0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="KaKuBtnItemSkin"width="240"height="93"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"states="common_jd,selected_jd,common_lz,selected_lz"bae:Imagealpha="1"touchEnabled="false"source="军队01-军队_jpg"y="-83"x="-17"visible.selected_jd="false"y.common_jd="-180.33"visible="false"cbae:Imagealpha="1"right="0"touchEnabled="false"source.common_jd="home_ui_kz_json.button_kz_02"right.common_jd="0"source.selected_jd="home_ui_kz_json.button_kz_01"right.selected_jd="0"source="home_ui_kz_json.button_kz_01"source.common_lz="home_ui_kz_json.button_kz_02"cbae:Imagealpha="1"right="58"touchEnabled="false"x="10"y="20.66"source="home_ui_jd_json.button_jd_jd"right.common_jd="62"y.common_jd="23.31"source.common_lz="home_ui_jd_json.button_jd_lz_0"source.selected_lz="home_ui_jd_json.button_jd_lz"source.common_jd="home_ui_jd_json.button_jd_jd_0"cbae:Imageid="redDotImg"x="168"y="7"source="common_ui_common_json.icon_hotpoint"visible.common_jd="false"visible.selected_jd="false"visible.common_lz="false"visible.selected_lz="false"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="KakuJunDuiPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagesource="军队02_jpg"cb--bae:Groupx="276.6"y="85.2"bae:Labelid="hasLb"text="我的军队："x="20"fontFamily="desc_font"size="24"scaleX="1"scaleY="1"verticalCenter="0"textColor="0x28718c"cbae:Groupx="141.62"scaleX="1"scaleY="1"verticalCenter="-1.5"height="30"bae:BitmapLabelid="hasNum"x="8"y="2"font="card_num_font_fnt"text="00"scaleX="1"scaleY="1"cbae:BitmapLabelid="totalNum"x="58"text="!00"font="card_num_dark_fnt"scaleX="1"scaleY="1"letterSpacing="-2"bottom="-2"cbae:layoutbae:HorizontalLayoutgap="-2"verticalAlign="bottom"cbace:layoutbace:Groupbace:Groupbae:Scrollerheight="552"x="301.9"y="133.17"anchorOffsetX="0"anchorOffsetY="0"scrollPolicyH="off"width="953.33"bae:Listid="list"useVirtualLayout="true"x="-12"y="3"bae:layoutbae:TileLayoutrequestedColumnCount="4"horizontalGap="20"verticalGap="15"cbace:layoutbae:ArrayCollectionbae:Arrayba!--ae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cb--bace:Arraybace:ArrayCollectionbace:Listbace:Scrollerbagame:DrowMenuid="menu"x="1058.1"y="73.58"skinName="DrowMenuSkin"scaleX="1.22"scaleY="1.22"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="KakuLingZhuPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagesource="军队04_jpg"cb--bae:Scrollerx="297.36"y="80.9"anchorOffsetX="0"anchorOffsetY="0"scrollPolicyH="auto"height="642.42"width="940"scrollPolicyV="off"bae:Listid="list"anchorOffsetX="0"anchorOffsetY="0"x="6.06"height="48.18"y="-3.03"itemRendererSkinName="LingZhuItemSkin"bae:ArrayCollectionbae:Arrayba!--ae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cb--bace:Arraybace:ArrayCollectionbae:layoutbae:HorizontalLayoutgap="12"paddingTop="62"paddingLeft="0"cbace:layoutbace:Listbace:Scrollerbae:Groupx="276.6"y="85.2"bae:Labelid="hasLb"text="我的军队："x="20"fontFamily="desc_font"size="24"scaleX="1"scaleY="1"verticalCenter="0"textColor="0x28718C"cbae:Groupx="141.62"scaleX="1"scaleY="1"verticalCenter="-1.5"height="30"bae:BitmapLabelid="hasNum"x="8"y="2"font="card_num_font_fnt"text="00"scaleX="1"scaleY="1"cbae:BitmapLabelid="totalNum"x="58"text="!00"font="card_num_dark_fnt"scaleX="1"scaleY="1"letterSpacing="-2"bottom="-2"cbae:layoutbae:HorizontalLayoutgap="-2"verticalAlign="bottom"cbace:layoutbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="KakuMainPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"ba!--ae:Imagesource="军队01-军队_jpg"cb--bagame:MainPanelBgid="mainBg"skinName="MainPanelBgSkin"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="LingZhuItemSkin"width="310"height="543"currentState="common"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"states="common,lock"bae:Imagesource="军队04_jpg"x="-296.5"y="-142"visible="false"cbae:Imagesource="home_ui_jd_json.bg_jd_lz_d"cbae:Imageid="maskk"source="bg_jd_lz_dh"x="8"y="3.6"scale9Grid="16,17,9,8"width="298"height="530"visible="false"cbae:GrouphorizontalCenter="4"touchThrough="true"touchChildren="false"touchEnabled="false"y="17"bae:Imageid="leaderImg"y="-56.67"horizontalCenter="-4"scaleX="0.9"scaleY="0.9"touchEnabled="false"x="-274"source="hero_99010"cbace:Groupbae:Imageid="newTips"x="-1.2"y="-3.2"source="home_ui_jd_json.icon_newlz"visible.lock="false"visible="false"cbae:Imagex="97.29"y="433.41"source="bg_sl_di"scale9Grid="5,7,9,22"width="120"height="36"cbae:Imageid="campIcon"y="427.11"x="69.71"source="home_ui_kz_json.icon_sl_01_s"cbans1:SButtonid="infoBtn"label=""verticalCenter="-233.5"scaleX="1"scaleY="1"right="12"bans1:skinNamebae:Skinstates="up,down,disabled"xmlns:game="game.*"bae:Imagewidth="100%"height="100%"source="button_kp_xx"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Labelid="leaderName"text="7秒"y="438.37"fontFamily="desc_font"size="28"bold="true"width="150"textAlign="center"touchEnabled="false"horizontalCenter="0"textColor="0xffdca8"cbae:Labelid="campName"text="领主名称"y="482.89"fontFamily="main_font"size="32"bold="true"width="150"textAlign="center"touchEnabled="false"horizontalCenter="0"strokeColor="0x966c50"textColor="0xbf6902"cbae:Imagesource="bg_jd_lz_dh"x="8"y="3.6"scale9Grid="16,17,9,8"width="298"height="530"alpha="0.3"includeIn="lock"cbae:Imagey="298"source="home_ui_jd_json.icon_jd_lz_wjs"horizontalCenter="0"includeIn="lock"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="PlayerLevelSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Imagesource="home_ui_common_json.icon_top_exp"horizontalCenter="0"verticalCenter="0"cbae:BitmapLabelid="labelDisplay"text="00"font="exp_lv_font_fnt"letterSpacing="-10"textAlign="center"horizontalCenter="0"verticalCenter="-2"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="HomeLoadingSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Imagex="0"y="0"source="00_02loading画面_jpg"visible="false"cbae:Groupid="root"width="1280"height="720"x="0"y="0"bae:Imagex="0"y="0"source="bg_com_jpg"cbae:Imagesource="preload_ui_json.logo"x="55.08"y="38.18"cbae:Imagex="271.11"y="61.82"source="bg_loading_zhm_png"cbae:Labelid="descLabel"text="预览资源加载中"y="500"fontFamily="main_font"textAlign="left"size="24"stroke="0"horizontalCenter="-5.5"anchorOffsetX="0"width="327.04"anchorOffsetY="0"height="68.42"lineSpacing="6"textColor="0xa16e4f"cbae:BitmapLabelid="preloadLabel"y="496.01"font="preload_font_fnt"text="字体文件"horizontalCenter="-76.5"visible="false"cbae:ProgressBarid="progressBar"y="620.44"anchorOffsetX="0"anchorOffsetY="0"width="1000"x="140.91"height="41"bae:skinNamebae:SkinminWidth="30"minHeight="18"bae:Imagewidth="100%"height="100%"verticalCenter="0"source="preload_ui_json.bg_login_d"scale9Grid="14,14,13,13"cbae:Imageid="thumb"height="70%"width="99%"source="preload_ui_json.bg_login_nr"scale9Grid="10,9,9,10"x="6"y="5"cbae:Labelid="labelDisplay"textAlign="center"verticalAlign="middle"size="28"fontFamily="main_font"x="895"textColor="0xf9f586"text=""verticalCenter="0"cbace:Skinbace:skinNamebace:ProgressBarbae:Imageid="blackBg"horizontalCenter="0"verticalCenter="0"width="1280"height="720"source="preload_ui_json.Black"scale9Grid="1,1,2,2"visible="false"cbae:BitmapLabelid="percentLabel"x="934.56"y="589.67"text="90%"font="card_num_font_fnt"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="MyPlayerInfoSkin"width="312"height="140"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="312"height="140"x="0"y="0"scaleX="1"scaleY="1"anchorOffsetY="0"bae:Groupid="roleInfo"width="312"height="140"x="0"y="0"anchorOffsetY="0"anchorOffsetX="0"scaleX="1"scaleY="1"bae:Groupid="nameInfo"width="216.5"height="74"x="94"y="22.5"anchorOffsetX="0"anchorOffsetY="0"bae:Imagex="1"y="2.120000000000001"anchorOffsetX="0"anchorOffsetY="0"source="common_ui_common_json.bg_tx_name_di_blue"scaleX="1"scaleY="1"scale9Grid="22,5,127,33"height="40"cbae:Labelid="playerName"text="角色名称六字"x="14"y="10"fontFamily="main_font"size="26"stroke="0"anchorOffsetX="0"width="172.5"anchorOffsetY="0"height="24"scaleX="1"scaleY="1"textColor="0x3c79ad"cbae:Labelid="familyName"text="Lengdo"x="14"y="49.5"fontFamily="desc_font"size="22"stroke="2"anchorOffsetX="0"width="209.5"strokeColor="0x3B546E"scaleX="1"scaleY="1"textColor="0x91b1c3"cbace:Groupbae:Imagex="6"y="9"scale9Grid="12,12,76,78"source="common_ui_playericon_json.bg_phb_heroicon"cbae:Imageid="playerIcon"source="common_ui_playericon_json.1001"x="22"y="27"scaleX="1"scaleY="1"cbae:Imageid="edgeIcon"x="6"y="9"scaleX="1"scaleY="1"anchorOffsetX="0"anchorOffsetY="0"source="common_ui_playericon_json.bg_phb_heroicon_up02"cbae:BitmapLabelid="cupCount"width="97.15"height="25.33"x="7.91"y="101"font="cup_font_fnt"text="9999!"anchorOffsetX="0"anchorOffsetY="0"textAlign="right"letterSpacing="0"scaleX="0.9"scaleY="0.9"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="MyPlayerInfoSkin2"width="423"height="148"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"bae:Imagesource="04战斗准备1v1_匹配成功_jpg"x="0"y="0"visible="false"cbae:Groupid="root"height="140"y="0"scaleX="1"scaleY="1"anchorOffsetY="0"anchorOffsetX="0"x="0"bae:Groupid="roleInfo"x="0"y="0"anchorOffsetY="0"anchorOffsetX="0"bae:Imagex="2.32"y="9.84"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"height="130"width="420"source="common_ui_pp_json.bg_pp_blue"scale9Grid="15,16,17,100"cbae:Groupid="nameInfo"x="44.32"y="14.84"anchorOffsetX="0"anchorOffsetY="0"width="182"height="72"bae:Labelid="playerName"text="12"y="9.5"fontFamily="main_font"size="32"stroke="0"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"textColor="0x3e99cd"textAlign="center"horizontalCenter="0"cbae:Labelid="familyName"text="2345"y="46"fontFamily="desc_font"size="26"stroke="0"anchorOffsetX="0"strokeColor="0x3B546E"scaleX="1"scaleY="1"textColor="0x4580b3"textAlign="center"horizontalCenter="0"cbace:Groupbae:Groupid="iconInfo"height="120"x="264.04"y="3.32"scaleX="1.2"scaleY="1.2"bae:Imagesource="common_ui_playericon_json.bg_phb_heroicon"scaleX="1"scaleY="1"scale9Grid="26,23,48,49"horizontalCenter="0"verticalCenter="0"cbae:Imageid="playerIcon"source="common_ui_playericon_json.1001"scaleX="-1"scaleY="1"horizontalCenter="0"verticalCenter="0"cbae:Imageid="edgeIcon"scaleX="1"scaleY="1"anchorOffsetX="0"anchorOffsetY="0"horizontalCenter="0"verticalCenter="0"source="common_ui_playericon_json.bg_phb_heroicon_up02"cbace:Groupbae:Groupid="noIcon"height="120"x="251.97"y="2"scaleX="1.2"scaleY="1.2"width="120"bae:ImagescaleX="1"scaleY="1"scale9Grid="10,10,10,9"width="90"height="90"horizontalCenter="0"verticalCenter="0"source="common_ui_pp_json.bg_pp_blue_wztx"cbae:ImagescaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"source="common_ui_pp_json.bg_pp_blue_wh"cbace:Groupbae:ProgressBarid="progressBar"x="44.34"y="98.34"height="30"width="181"bae:skinNamebae:Skinwidth="155"height="24"currentState="common"states="common,canUpgrade"bae:Imageleft="0"right="0"top="0"bottom="0"source="home_ui_kz_json.bg_kz_kps_01"scale9Grid="18,8,144,13"cbae:Imageid="thumb"anchorOffsetY="0"left="3"right="3"source="home_ui_kz_json.bg_kz_kps_03"scale9Grid="30,6,67,10"top="3"bottom="3"source.common="home_ui_kz_json.bg_kz_kps_03"cbae:BitmapLabelid="labelDisplay"text="100%"font="card_num_font_fnt"scaleX="0.7"scaleY="0.7"horizontalCenter="0"verticalCenter="0"cbace:Skinbace:skinNamebace:ProgressBarbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="TargetPlayerInfoSkin"width="312"height="140"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="312"height="140"x="0"y="0"scaleX="1"scaleY="1"anchorOffsetY="0"bae:Groupid="targetRoleInfo2"width="99"height="140"x="212"y="0"anchorOffsetY="0"anchorOffsetX="0"scaleX="1"scaleY="1"bae:Groupid="nameInfo"width="216"height="94"x="-201"y="22.5"anchorOffsetY="0"bae:Imagex="39"y="2.12"anchorOffsetX="0"anchorOffsetY="0"source="common_ui_common_json.bg_tx_name_di_red"scaleX="1"scaleY="1"scale9Grid="30,11,134,26"height="40"cbae:Labelid="playerName"text="角色名称六字"x="31"y="10"fontFamily="main_font"size="26"stroke="0"anchorOffsetX="0"width="172.5"anchorOffsetY="0"height="24"textAlign="right"scaleX="1"scaleY="1"textColor="0x914235"cbae:Labelid="familyName"text="Lengdo"x="-7"y="49.5"fontFamily="desc_font"size="22"stroke="2"anchorOffsetX="0"width="209.5"textAlign="right"strokeColor="0x6D3838"scaleX="1"scaleY="1"textColor="0xf7aa9e"cbace:Groupbae:Imagex="6"y="9"scale9Grid="12,12,76,78"source="common_ui_playericon_json.bg_phb_heroicon"cbae:Imageid="playerIcon"source="common_ui_playericon_json.1001"x="22.49"y="27"scaleX="1"scaleY="1"cbae:Imageid="edgeIcon"x="6"y="9"scaleX="1"scaleY="1"anchorOffsetX="0"anchorOffsetY="0"scale9Grid="12,12,76,78"source="common_ui_playericon_json.bg_phb_heroicon_up02"cbae:BitmapLabelid="percentLabel"x="-104.99"y="107"text="100%"font="pp_time_red_font_fnt"visible="false"cbae:BitmapLabelid="cupCount"width="97.15"height="25.33"x="8"y="101"font="cup_font_fnt"text="9999!"anchorOffsetX="0"anchorOffsetY="0"textAlign="right"letterSpacing="0"scaleX="0.9"scaleY="0.9"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="TargetPlayerInfoSkin2"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"width="445"height="148"bae:Imagesource="04战斗准备1v1_匹配成功_jpg"x="0"y="0"visible="false"cbae:Groupid="root"x="0"y="0"scaleX="1"scaleY="1"anchorOffsetY="0"bae:Groupid="roleInfo"x="0"y="0"anchorOffsetY="0"anchorOffsetX="0"bae:Imagex="5"y="10.5"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"source="common_ui_pp_json.bg_pp_red"height="130"width="440"scale9Grid="191,16,23,100"cbae:Groupid="nameInfo"x="200.66"y="15.5"anchorOffsetX="0"anchorOffsetY="0"width="182"height="72"bae:Labelid="playerName"text="123"y="9.5"fontFamily="main_font"size="32"stroke="0"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"textColor="0xd15059"horizontalCenter="0"cbae:Labelid="familyName"text="456"y="46"fontFamily="desc_font"size="26"stroke="0"anchorOffsetX="0"strokeColor="0x3B546E"scaleX="1"scaleY="1"textColor="0xaf5757"horizontalCenter="0"cbace:Groupbae:Groupid="iconInfo"height="120"x="40.72"y="3.98"scaleX="1.2"scaleY="1.2"bae:Imagesource="common_ui_playericon_json.bg_phb_heroicon"scaleX="1"scaleY="1"scale9Grid="26,23,48,49"horizontalCenter="0"verticalCenter="0"cbae:Imageid="playerIcon"source="common_ui_playericon_json.1001"scaleX="-1"scaleY="1"horizontalCenter="0"verticalCenter="0"cbae:Imageid="edgeIcon"scaleX="1"scaleY="1"anchorOffsetX="0"anchorOffsetY="0"source="common_ui_playericon_json.bg_phb_heroicon_up02"horizontalCenter="0"verticalCenter="0"cbace:Groupbae:Groupid="noIcon"height="120"x="26.65"y="2.66"scaleX="1.2"scaleY="1.2"width="120"bae:ImagescaleX="1"scaleY="1"source="common_ui_pp_json.bg_pp_red_wztx"scale9Grid="10,10,10,9"width="90"height="90"horizontalCenter="0"verticalCenter="0"cbae:ImagescaleX="1"scaleY="1"source="common_ui_pp_json.bg_pp_red_wh"horizontalCenter="0"verticalCenter="0"cbace:Groupbae:ProgressBarid="progressBar"x="203.1"y="99"height="30"width="181"bae:skinNamebae:Skinwidth="155"height="24"currentState="common"states="common,canUpgrade"bae:Imageleft="0"right="0"top="0"bottom="0"source="home_ui_kz_json.bg_kz_kps_01"scale9Grid="18,8,144,13"cbae:Imageid="thumb"anchorOffsetY="0"left="3"right="3"source="home_ui_kz_json.bg_kz_kps_03"scale9Grid="30,6,67,10"top="3"bottom="3"source.common="home_ui_kz_json.bg_kz_kps_03"cbae:BitmapLabelid="labelDisplay"text="100%"font="card_num_font_fnt"scaleX="0.7"scaleY="0.7"horizontalCenter="0"verticalCenter="0"cbace:Skinbace:skinNamebace:ProgressBarbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="UILoadingSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Rectleft="0"right="0"top="0"bottom="0"alpha="0.3"cbae:Imageid="lImg"source="loadingCircle_png"horizontalCenter="0"verticalCenter="0"rotation="0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="WarLoadingSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"ba!--ae:Imagex="0"y="0"source="08战斗准备2v2_匹配成功_jpg"visible="false"cb--bae:Groupid="root"width="1280"height="720"horizontalCenter="0"verticalCenter="0"touchThrough="true"bae:Imageid="bg"width="1280"scaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"source="bg_com_jpg"cbae:Groupid="leftGroup"width="640"height="120"x="0"y="450"anchorOffsetY="0"anchorOffsetX="0"bae:Imageid="myKingShadow"source="home_ui_common_json.role_yz"y="38"alpha="0.8"horizontalCenter="123"cbae:Imageid="myKingIcon"horizontalCenter="120"verticalCenter="-172"scaleX="0.9"scaleY="0.9"source="kingtower_99010_png"cbace:Groupbae:Groupid="rightGroup"width="640"height="120"x="640"y="450"anchorOffsetY="0"anchorOffsetX="0"bae:Imageid="targetKingShadow"source="home_ui_common_json.role_yz"y="38"alpha="0.8"horizontalCenter="-123"cbae:Imageid="targetKingIcon"scaleX="-0.9"horizontalCenter="-120"verticalCenter="-172"scaleY="0.9"source="kingtower_99010_png"cbace:Groupbagame:CommonPlayerInfox="-6"y="335"skinName="MyPlayerInfoSkin2"scaleX="1"scaleY="1"visible="false"cbagame:CommonPlayerInfox="841"y="335"skinName="TargetPlayerInfoSkin2"scaleX="1"scaleY="1"visible="false"cbae:Groupid="topGroup"width="1280"height="720"x="0"y="0"bans1:SGroupid="descGroup"scaleX="1"anchorOffsetY="0"x="577.7"y="588.65"bae:ImagehorizontalCenter="0"verticalCenter="0"width="124"height="51"source="common_ui_pp_json.bg_pp_qx_di"scale9Grid="8,8,8,8"cbae:Labelid="timeLabel"text="预计15秒"scaleX="1"scaleY="1"size="26"fontFamily="desc_font"border="false"horizontalCenter="0.5"verticalCenter="0.5"textColor="0xa6e7ff"cbacns1:SGroupbans1:SGroupid="cancelBtn"scaleX="1"anchorOffsetY="0"horizontalCenter="-0.5"verticalCenter="304.5"bae:Imagesource="common_ui_common_json.button_ty_red"scale9Grid="14,13,86,28"horizontalCenter="0"verticalCenter="0"width="137"height="61"cbae:Labelid="cancelLabel"text="取消匹配"scaleX="1"scaleY="1"size="26"fontFamily="desc_font"border="false"horizontalCenter="0"verticalCenter="-3"textColor="0x9b453e"cbacns1:SGroupbae:Imagesource="common_ui_pp_json.bg_pp_vs"y="346"horizontalCenter="0"cbae:Imageid="sucessImg"source="common_ui_pp_json.text_pp_ppcg"horizontalCenter="-2"verticalCenter="275"visible="false"cbae:Groupwidth="609.09"height="100"x="1.52"anchorOffsetX="0"anchorOffsetY="0"bae:Imagesource="preload_ui_json.logo"x="16.34"y="12.61"scaleX="0.7"scaleY="0.7"cbae:Imageid="descBg"source="home_ui_common_json.bg_notice"y="36"scale9Grid="84,4,47,30"anchorOffsetX="0"width="466"scaleX="1"scaleY="1"horizontalCenter="70"cbae:Labelid="descLabel"text="有效利用法力是制胜关键"y="41"size="28"fontFamily="desc_font"textColor="0xc4d0d0"scaleX="1"scaleY="1"horizontalCenter="70"cbace:Groupbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="LoginSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"ba!--ae:Imagesource="00_01登录画面_jpg"x="0"y="0"visible="false"cb--bae:Groupid="root"width="1280"height="720"x="0"y="0"bae:Imagex="0"y="0"source="bg_pp_jpg"cbae:Imagesource="preload_ui_json.logo"x="17"y="22.72"cbae:Imagex="439"y="198.72"source="home_ui_login_json.bg_dl_k"cbae:Groupwidth="200"height="200"x="540"y="260"scaleX="1"scaleY="1"horizontalCenter="-176"verticalCenter="-205"bae:Imagex="105"y="212"anchorOffsetX="0"width="344"anchorOffsetY="0"scaleX="1"scaleY="1"alpha="0.5"source="home_ui_login_json.bg_dl_ne"scale9Grid="7,16,9,36"cbae:Imagex="102.34"y="337.37"anchorOffsetX="0"width="344"anchorOffsetY="0"scaleX="1"scaleY="1"alpha="0.5"source="home_ui_login_json.bg_dl_ne"scale9Grid="7,16,9,36"cbans1:SInputLabelid="test1Label"text="用户名："x="102"y="164"size="36"scaleX="1"scaleY="1"fontFamily="main_font"textColor="0x9c540a"cbae:Labeltext="密码："x="103.33"y="294.66"size="36"scaleX="1"scaleY="1"fontFamily="main_font"textColor="0x9c540a"cbans1:SInputLabelid="account"text="请输入用户名"x="117"y="191"height="100"size="30"width="328"textAlign="left"verticalAlign="middle"scaleX="1"scaleY="1"type="input"fontFamily="desc_font"alpha="1"textColor="0x966c50"anchorOffsetX="0"cbans1:SInputLabelid="password"text="请输入密码"x="118"y="317"height="100"size="30"width="290"textAlign="left"verticalAlign="middle"scaleX="1"scaleY="1"type="input"inputType="password"displayAsPassword="true"fontFamily="desc_font"textColor="0x966c50"cbace:Groupbans1:SGroupid="enterBtn"width="200"height="80"horizontalCenter="-5"verticalCenter="155"bae:Imagesource="common_ui_common_json.button_ty_yellow"width="187.33"height="78"scaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"anchorOffsetX="0"anchorOffsetY="0"cbae:Imagesource="preload_ui_json.button_ksyx"scaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"cbacns1:SGroupbans1:SButtonid="backBtn"label="选服"x="834.33"y="574.66"width="187"height="78"anchorOffsetY="0"anchorOffsetX="0"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_blue"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"size="40"fontFamily="desc_font"bold="true"textColor="0x4489c4"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="backBtn1"label="选服"anchorOffsetX="0"width="200"anchorOffsetY="0"height="80"scaleX="1"scaleY="1"horizontalCenter="296"verticalCenter="254"visible="false"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imageid="imgDisplay"width="100%"height="100%"source="button_png"scale9Grid="15,18,15,36"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Groupwidth="296.97"height="181.88"x="958.37"y="17.12"anchorOffsetX="0"anchorOffsetY="0"visible="false"bae:Imagesource="tipsBg_png"x="4.47999999999999"y="0"anchorOffsetX="0"width="260"anchorOffsetY="0"height="60"scale9Grid="10,4,60,28"scaleX="1"scaleY="1"cbae:Imagesource="tipsBg_png"x="4.47999999999999"y="70"anchorOffsetX="0"width="260"anchorOffsetY="0"height="60"scale9Grid="10,4,60,28"scaleX="1"scaleY="1"cbans1:SInputLabelid="ipLabel"text="192.168.21.63"x="24.47999999999999"y="0"height="60"size="30"width="240"textAlign="left"verticalAlign="middle"scaleX="1"scaleY="1"type="input"anchorOffsetY="0"anchorOffsetX="0"cbans1:SInputLabelid="portLabel"text="6556"x="24.47999999999999"y="70"height="60"size="30"width="240"textAlign="left"verticalAlign="middle"scaleX="1"scaleY="1"type="input"anchorOffsetY="0"anchorOffsetX="0"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="SelectServerSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"xmlns:ns1="*"bae:Imagex="0"y="0"source="00_01登录画面_jpg"visible="false"cbae:Groupid="root"width="1280"height="720"x="0"y="0"bae:Imagex="0"y="0"source="bg_pp_jpg"cbae:Imagesource="preload_ui_json.logo"x="17"y="22.72"cbae:Groupwidth="333.33"height="250"x="475.59"y="243.71"anchorOffsetX="0"anchorOffsetY="0"bae:Imagewidth="322"height="180"scaleX="1"scaleY="1"x="4.2999999999999545"y="0.9999999999999432"alpha="1"scale9Grid="5,17,16,33"anchorOffsetY="0"anchorOffsetX="0"source="home_ui_login_json.bg_dl_qbfwq"visible="false"cbae:Imagewidth="194"height="56.67"scaleX="1"scaleY="1"x="2.9599999999999227"y="189.6699999999999"alpha="1"scale9Grid="5,17,16,33"anchorOffsetY="0"anchorOffsetX="0"source="home_ui_login_json.bg_dl_dqfwq"cbae:Groupid="serverList"width="328"height="180"x="2.2999999999999545"y="0.9999999999999432"scaleX="1"scaleY="1"anchorOffsetX="0"anchorOffsetY="0"bae:ImageanchorOffsetX="0"width="600"anchorOffsetY="0"height="60"alpha="1"horizontalCenter="0"verticalCenter="154"source="button_png"scale9Grid="20,6,103,31"visible="false"cbae:Imageid="scroll_bg"anchorOffsetX="0"width="322"anchorOffsetY="0"height="180"alpha="0.5"x="2"bottom="0"source="home_ui_login_json.bg_dl_qbfwq"scale9Grid="6,20,13,28"cbae:Scrollerid="game_list_scroller"width="328"height="180"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"horizontalCenter="0"bottom="0"cbae:Listid="game_list"width="328"height="180"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"x="0"alpha="1"bottom="0"cbace:Groupbans1:SGroupid="enterBtn"width="138"height="68"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"horizontalCenter="97.33500000000001"verticalCenter="93"bae:Imagewidth="140"height="68"scaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"source="common_ui_common_json.button_ty_blue"anchorOffsetY="0"anchorOffsetX="0"scale9Grid="14,15,86,28"cbae:Labeltext="选服"fontFamily="desc_font"size="32"textColor="0x4489c4"horizontalCenter="-3.5"verticalCenter="-1"cbacns1:SGroupbae:Labelid="selectLabel"text="当前服务器"y="202.04"fontFamily="desc_font"textColor="0x93c6de"horizontalCenter="-64.66499999999999"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ServerItemSkin"width="322"height="60"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bans1:SGroupid="root"width="322"height="60"verticalCenter="0"horizontalCenter="0"bae:Imageid="bg"horizontalCenter="0"verticalCenter="0"width="322"height="60"source="home_ui_login_json.bg_dl_xzfwq"scale9Grid="9,12,12,31"cbae:Labelid="serverName"text="服务器名称"anchorOffsetX="0"width="300"stroke="2"textAlign="center"fontFamily="desc_font"scaleX="1"scaleY="1"size="34"horizontalCenter="0"verticalCenter="0"textColor="0x93c6de"cbacns1:SGroupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="MailDetailInfoSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"xmlns:ns1="*"states="hasItem,noItem"bae:Imagex="0"y="0"source="邮件04_jpg"visible="false"cbae:Groupid="root"width="1280"height="720"x="0"y="0"bae:GroupanchorOffsetX="0"width="634"anchorOffsetY="0"height="621"x="321"y="50"bae:Groupwidth="200"height="200"x="0"y="0"bae:ImageanchorOffsetY="0"source="home_ui_mail_json.bg_mail_tc_di"width="638"scale9Grid="20,19,35,31"height="630"anchorOffsetX="0"rotation="3"x="19"y="7"scaleX="1"scaleY="1"cbae:Imagewidth="638"height="630"source="home_ui_mail_json.bg_mail_tc_di0"scale9Grid="21,20,27,29"x="2"y="21"scaleX="1"scaleY="1"cbae:Imagewidth="575"source="home_ui_family_lt_json.bg_jz_lt_jk_di_x01"scale9Grid="10,1,38,2"y="78"x="34"scaleX="1"scaleY="1"cbae:Imagewidth="575"y="78"source="home_ui_family_lt_json.bg_jz_lt_jk_di"scale9Grid="13,14,25,25"anchorOffsetY="0"height="469"x="34"scaleX="1"scaleY="1"cbae:Imagescale9Grid="13,14,25,25"y="413"anchorOffsetY="0"source="home_ui_mail_json.bg_mail_tc_xxc"x="58"scaleX="1"scaleY="1"cbae:Imagescale9Grid="13,14,25,25"y="289"anchorOffsetY="0"source="home_ui_mail_json.bg_mail_ycdi"x="336"scaleX="1"scaleY="1"cbace:Groupbae:Groupy="0"horizontalCenter="0"bae:Labelid="nameLabel"text="联盟杯赛的奖励"size="32"fontFamily="main_font"scaleX="1"scaleY="1"textAlign="left"verticalAlign="middle"textColor="0xbd7b49"width="209"height="32"y="39"horizontalCenter="0"cbans1:SButtonid="closeBtn"label=""scaleX="1"scaleY="1"horizontalCenter="279.5"verticalCenter="14.5"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="button_tc_close_red"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Groupbans1:SButtonid="getBtn"label="关闭"anchorOffsetX="80"scaleX="1"scaleY="1"y="604.86"width="150"height="60"anchorOffsetY="34"skinName="BtnCommonSkin"icon="button_ty_green"horizontalCenter="0"cbae:Scrollerwidth="567"height="327"y="85"anchorOffsetY.noItem="0"horizontalCenter.noItem="0"height.noItem="429"anchorOffsetY="0"horizontalCenter="0"scrollPolicyH="off"bae:Groupid="contentGroup"bae:Labelid="descLabel"text="444444444444444444444444444444444444444444444444441111111111111111111111111111111111111122222222222222222222222222222222222222333333333333333333333333333333333333333444444444444444444444444444444444441111111111111111111111111111111111111122222222222222222222222222222222222222333333333333333333333333333333333333333444444444444444444441111111111111111111111111111111111111122222222222222222222222222222222222222333333333334444444444444444444444444444444444411111111111111111111111111111111111111222222222222222222222222222222222222223333333333333333333333333333333333333334444444444444444444444444444444444411111111111111111111111111111111111111222222222222222222222222222222222222223333333333333333333333333333333333333333333333333333333333333333333"y="11.72"fontFamily="desc_font"size="26"anchorOffsetY="0"anchorOffsetX="0"width="558"scaleX="1"scaleY="1"text.noItem="在与玩家的战斗中获得三星完在与玩家的战斗中获得三星完胜在与在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜胜在与在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜在与玩家的战斗中获得三星完胜"horizontalCenter.noItem="-3"textColor="0xa67f64"horizontalCenter="7"cbae:layout.noItembae:BasicLayoutcbace:layout.noItembace:Groupbace:Scrollerbae:Groupid="rewardGroup"width="540"height="120"y="426.2"anchorOffsetY="0"anchorOffsetX="0"horizontalCenter="4"visible.noItem="false"bae:layoutbae:HorizontalLayouthorizontalAlign="center"verticalAlign="middle"gap="10"cbace:layoutbace:Groupbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="MailInfoSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"xmlns:ns1="*"bae:Imagex="0"y="0"source="邮件02_jpg"visible="false"cbae:Groupid="root"width="1280"height="720"x="0"y="0"bagame:CommonWinid="comWin"skinName="CommonWinSkin"x="297.37"y="65.35"anchorOffsetX="0"width="684"anchorOffsetY="0"height="640.67"cbae:Imagesource="home_ui_family_lt_json.bg_jz_lt_jk_di"y="133.69"scale9Grid="6,6,38,38"anchorOffsetX="0"width="630"anchorOffsetY="0"height="468"horizontalCenter="0"cbae:GroupanchorOffsetY="0"height="629.38"anchorOffsetX="0"width="669.33"x="303.33"y="70.67"touchEnabled="false"bae:Groupid="mailInfo"anchorOffsetX="0"anchorOffsetY="0"height="486.67"width="654"horizontalCenter="0"y="50"bae:Scrollerid="game_list_scroller"width="620"height="460"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"y="14.66"horizontalCenter="0.5"bae:Listid="game_list"cbace:Scrollerbace:Groupbae:Groupid="noMailInfo"width="200"height="200"y="92.22"horizontalCenter="79.33499999999998"bae:Imagesource="home_ui_family_lt_json.bg_jz_lt_jk_wxts"x="-103.96"y="138.68"scale9Grid="22,22,25,19"anchorOffsetX="0"width="398.39"anchorOffsetY="0"height="140"cbae:Labelid="emptyLabel"text="当前没有收到邮件哦"y="198"scaleX="1"scaleY="1"fontFamily="desc_font"textAlign="center"horizontalCenter="0"size="24"textColor="0x966C50"cbae:Imagesource="home_ui_family_lt_json.bg_jz_lt_jk_wxtsrw"x="-266.66"y="101.32"scaleX="1"scaleY="1"cbace:Groupbans1:SButtonid="delBtn"label="全部删除"anchorOffsetX="71.33"scaleX="1"scaleY="1"width="140"height="60"anchorOffsetY="29.33"icon="button_ty_green"horizontalCenter="68.33499999999998"verticalCenter="266"bans1:skinNamebae:Skinwidth="155"height="55"bae:Imagescale9Grid="14,7,86,30"anchorOffsetX="0"left="0"right="0"top="0"bottom="0"source="button_ty_red"cbae:Labelid="labelDisplay"left="0"right="0"top="2"bottom="10"textAlign="center"text="按钮"verticalAlign="middle"fontFamily="desc_font"size="26"textColor="0xa93f3f"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="getBtn"label="全部领取"anchorOffsetX="80"scaleX="1"scaleY="1"width="140"height="60"anchorOffsetY="34"icon="button_ty_green"horizontalCenter="225.33499999999998"verticalCenter="266"bans1:skinNamebae:Skinwidth="155"height="55"bae:Imageid="iconDisplay"source="button_ty_green"scale9Grid="14,7,86,30"anchorOffsetX="0"left="0"right="0"top="0"bottom="0"cbae:Labelid="labelDisplay"left="0"right="0"top="2"bottom="10"textAlign="center"text="按钮"verticalAlign="middle"fontFamily="desc_font"textColor="0x289da8"size="26"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Imagesource="home_ui_mail_json.icon_mail_xtb"x="26.67"y="570"cbae:Labeltext="邮件数目："x="59.65"y="568.99"fontFamily="desc_font"size="24"textColor="0xa67f64"cbae:Labelid="mailCount"text="5c50"x="178.4"y="568.44"fontFamily="main_font"size="24"textColor="0xa67f64"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="MailItemSkin"width="620"height="120"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Groupid="root"width="620"height="120"x="0"y="0"bae:Imageid="bg"width="606"height="114"scaleX="1"scaleY="1"source="home_ui_phb_json.bg_phb_tmdi0_1"scale9Grid="27,34,12,30"anchorOffsetX="0"anchorOffsetY="0"y="3"x="7"cbae:Labelid="mailName"text="邮件名称邮件名称"anchorOffsetX="0"textAlign="left"fontFamily="main_font"scaleX="1"scaleY="1"size="30"x="133"y="26"textColor="0xbd7b49"cbae:Labelid="leftTime"text="剩余27天12时58分"anchorOffsetX="0"textAlign="left"fontFamily="desc_font"scaleX="1"scaleY="1"size="24"x="161"y="71"textColor="0xa46e44"cbae:Groupwidth="100"height="100"verticalCenter="1"horizontalCenter="-246"bae:Imageid="itemBg"source="common_ui_common_json.bg_bag_gz"horizontalCenter="0"verticalCenter="0"cbae:Imageid="itemIcon"scaleX="1"scaleY="1"horizontalCenter="0"source="common_ui_itemicon_json.item_2"verticalCenter="0"cbae:Labelid="itemCount"text="1125"y="71.21"scaleX="1"scaleY="1"size="24"horizontalCenter="16"fontFamily="main_font"stroke="0"right="10"bold="false"textAlign="right"textColor="0x6D6456"visible="false"cbace:Groupbae:Imagesource="home_ui_common_json.icon_ss_pws_sz"x="130"y="67"cbae:Groupid="clickBg"width="620"height="120"x="0"y="1"cbans1:SButtonid="getBtn"label="领取"anchorOffsetX="57.5"scaleX="1"scaleY="1"width="115"height="60"anchorOffsetY="30"skinName="BtnCommonSkin"icon="button_ty_green"horizontalCenter="226.5"verticalCenter="1"cbae:Imageid="getImg"x="494"source="home_ui_mail_json.icon_mail_ylq"verticalCenter="0"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="MailRewardItemSkin"width="100"height="100"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupwidth="100"x="0"height="100"y="0"bae:Imageid="bg"source="common_ui_common_json.bg_bag_gz"horizontalCenter="0"verticalCenter="0"cbae:Imageid="icon"scaleX="1"scaleY="1"horizontalCenter="0"source="common_ui_itemicon_json.item_2"verticalCenter="0"cbae:Labelid="count"text="1125"y="71.21"scaleX="1"scaleY="1"size="24"fontFamily="main_font"stroke="0"bold="false"textAlign="right"textColor="0x6d6456"x="44"cbae:Groupid="checkImg"width="100"height="100"x="0"y="0"bae:Imagesource="common_ui_common_json.bg_bag_gz_yh"scale9Grid="20,19,17,14"horizontalCenter="0"verticalCenter="0"width="100"height="100"alpha="0.5"x="0"y="0"scaleX="1"scaleY="1"cbae:Imagesource="home_ui_mail_json.icon_mail_ylq"horizontalCenter="0"verticalCenter="0"x="7"y="8"scaleX="1"scaleY="1"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="BottomItemSkin"width="170"height="80"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Groupid="root"width="170"height="80"anchorOffsetX="0"anchorOffsetY="0"verticalCenter="0"horizontalCenter="0"scaleX="1"scaleY="1"bans1:SGroupwidth="68"height="68"verticalCenter="0"horizontalCenter="-39"bae:Imageid="iconDisplay"x="0"y="0"source="home_ui_common_json.button_down_01"scaleX="1"scaleY="1"cbae:Imageid="redDot"source="common_ui_common_json.icon_hotpoint"x="98"y="-9"scaleX="1"scaleY="1"visible="false"cbacns1:SGroupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="CMDDItem1Skin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"width="200"bae:CheckBoxid="ch"label="CheckBox"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="CMDDlgSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Groupid="root"width="1280"height="720"x="0"y="0"bae:GroupscaleX="1"scaleY="1"left="60"right="60"top="60"bottom="60"bae:Imagesource="common_ui_playericon_json.bg_phb_heroicon"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"scale9Grid="23,21,53,58"left="0"right="0"top="0"bottom="0"cbae:ImageanchorOffsetX="0"width="677.27"anchorOffsetY="0"height="197.51"horizontalCenter="194.5"verticalCenter="-58"source="common_ui_playericon_json.bg_phb_heroicon"scale9Grid="24,24,56,55"cbae:ImageanchorOffsetX="0"width="677.27"anchorOffsetY="0"height="230"horizontalCenter="194.5"verticalCenter="155"source="common_ui_playericon_json.bg_phb_heroicon"scale9Grid="24,24,56,55"cbans1:SInputLabelid="desc"text="请输入指令..."anchorOffsetX="0"width="613.7"anchorOffsetY="0"height="44.18"fontFamily="desc_font"size="24"textColor="0xfffcfc"stroke="0"scaleX="1"scaleY="1"lineSpacing="5"horizontalCenter="195"verticalCenter="-95"type="input"cbae:Labelid="title"text="命令行"anchorOffsetX="0"width="294"anchorOffsetY="0"height="39.7"fontFamily="main_font"size="30"textColor="0xFFFCFC"stroke="2"scaleX="1"scaleY="1"lineSpacing="5"horizontalCenter="0"verticalCenter="-202"textAlign="center"visible="false"cbans1:SButtonid="okBtn"label="确定"anchorOffsetX="0"width="200"horizontalCenter="35"verticalCenter="-20"x="73"y="200"scaleX="1"scaleY="1"height="70"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="button_png"scale9Grid="11,20,18,31"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"fontFamily="main_font"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="cancelBtn"label="取消"anchorOffsetX="0"width="200"horizontalCenter="355"verticalCenter="-20"x="227"y="200"scaleX="1"scaleY="1"height="70"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="button_png"scale9Grid="11,19,17,35"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"fontFamily="main_font"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="closeBtn"label=""width="68"height="70"horizontalCenter="476"verticalCenter="-231"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="close_png"source.down="close_png"source.disabled="close_png"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Groupx="30.35"y="106.66"width="400"bae:Buttonid="fightBtn"label="单机对战"x="52"y="76"cbae:Buttonid="replayBtn"label="回放"x="52"y="76"cbae:Buttonlabel="经验+1000"x="52"y="76"id="btn1"cbae:Buttonlabel="金币+1000"x="52"y="76"id="btn2"cbae:Buttonlabel="钻石+1000"x="52"y="76"id="btn3"cbae:Buttonlabel="杯数+100"x="52"y="76"id="btn4"cbae:Buttonlabel="等级+1"x="52"y="76"id="btn5"cbae:Buttonid="btn6"label="全满"x="52"y="76"cbae:layoutbae:TileLayoutrequestedColumnCount="2"cbace:layoutbace:Groupbae:Scrollerheight="190"x="477"y="361"anchorOffsetX="0"bae:Listid="list"anchorOffsetX="0"width="465.33"itemRendererSkinName="CMDDItem1Skin"useVirtualLayout="false"bae:ArrayCollectionbae:Arraybae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbace:Arraybace:ArrayCollectionbae:layoutbae:TileLayoutrequestedColumnCount="2"cbace:layoutbace:Listbace:Scrollerbace:Groupbace:Groupbace:Skinbae:Skinclass="CommonDlgSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"ba!--ae:Imagesource="2v2战斗_弹窗_01_jpg"visible="false"cb--bae:Imagesource="bg_black"left="0"right="0"top="0"bottom="0"alpha="0.7"cbae:GrouphorizontalCenter="0"verticalCenter="0"bagame:CommonWinid="comWin"skinName="CommonWinSkin"scaleX="1"scaleY="1"left="0"right="0"top="0"bottom="0"cbae:GroupscaleX="1"scaleY="1"horizontalCenter="0"bottom="20"height="76"bans1:SButtonid="leftBtn"label="左文案"anchorOffsetX="80"scaleX="1"scaleY="1"y="42"width="160"height="68"horizontalCenter="-120"anchorOffsetY="34"skinName="BtnCommonSkin"icon="button_ty_green"cbans1:SButtonid="rightBtn"label="右文案"width="160"height="68"y="42"horizontalCenter="120"anchorOffsetX="80"anchorOffsetY="34"skinName="BtnCommonSkin"icon="button_ty_blue"cbace:Groupbae:Labelid="content"text=""anchorOffsetY="0"anchorOffsetX="0"horizontalCenter="0"bottom="115"top="81"left="42"right="41"width="454"size="24"textColor="0x9b6a43"fontFamily="desc_font"lineSpacing="10"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="CostInfoExpProgSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Imageid="thumb"anchorOffsetX="0"source="home_ui_common_json.bg_exp_nr"fillMode="clip"verticalCenter="0"scale9Grid="25,4,152,31"left="0"right="0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="CostInfoSkin"width="1280"height="120"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="1280"height="120"x="0"y="0"anchorOffsetY="0"anchorOffsetX="0"touchEnabled="false"bae:Groupid="exp0"width="200"height="40"x="432.68"y="18"anchorOffsetY="0"bae:Imagey="-5"anchorOffsetX="0"width="200"source="home_ui_common_json.bg_exp"scale9Grid="29,4,13,27"scaleX="1"scaleY="1"cbae:ProgressBarid="expProg"x="1.14"y="-2"skinName="CostInfoExpProgSkin"slideDuration="0"width="190"cbae:Imagesource="home_ui_common_json.icon_top_exp"x="-24"verticalCenter="0"cbae:BitmapLabelid="exp_lv"width="60"height="20"text="f"y="3.5"x="-16.5"anchorOffsetX="9"font="exp_lv_font_fnt"anchorOffsetY="0"letterSpacing="-2"textAlign="center"cbae:BitmapLabelid="exp_num"height="20"y="6.5"anchorOffsetX="0"anchorOffsetY="0"text="0000c0000"scaleX="1"scaleY="1"font="exp_num_font_fnt"letterSpacing="-2"textAlign="center"horizontalCenter="14"cbace:Groupbae:Groupid="gold1"width="185.5"height="40"x="626"y="18"anchorOffsetY="0"anchorOffsetX="0"bae:Imagex="0"y="-5"anchorOffsetX="0"width="200"source="home_ui_common_json.bg_exp"scale9Grid="29,4,13,27"cbae:Imagex="0"y="-9"source="home_ui_common_json.icon_top_coin"scaleX="1"scaleY="1"cbae:BitmapLabelid="gold_num"width="146"x="0"y="9"anchorOffsetX="0"anchorOffsetY="0"letterSpacing="-2"text="0"textAlign="right"font="coin_font_fnt"cbans1:SButtonid="addGoldBtn"xmlns:ns1="*"label=""scaleX="1"scaleY="1"horizontalCenter="71.25"verticalCenter="-1"bans1:skinNamexmlns:ns1="*"bae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="home_ui_common_json.button_top_add02"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"xmlns:game="game.*"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Groupbae:Groupid="diamand1"width="172"height="40"x="817.95"y="18"anchorOffsetY="0"anchorOffsetX="0"bae:Imagex="0"y="-5"anchorOffsetX="0"width="200"source="home_ui_common_json.bg_exp"scale9Grid="28,4,14,27"cbae:Imagex="0"y="-9"source="home_ui_common_json.icon_top_diamond"scaleX="1"scaleY="1"cbae:BitmapLabelid="diamand_num"x="0"y="9"anchorOffsetX="0"anchorOffsetY="0"letterSpacing="-2"text="0"textAlign="right"width="146"font="diamond_font_fnt"cbans1:SButtonid="addDiamandBtn"xmlns:ns1="*"label=""scaleX="1"scaleY="1"verticalCenter="-1"horizontalCenter="80"bans1:skinNamexmlns:ns1="*"bae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="home_ui_common_json.button_top_add"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"xmlns:game="game.*"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="DialogOnlyLabelSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"width="530"bae:Labelid="content"text="纯文字显示弹窗内容\n纯文字显示弹窗内容"left="10"right="10"textAlign="center"top="10"textColor="0xb97432"fontFamily="desc_font"lineSpacing="10"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="DialogRefreshRWSkin"width="530"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"bae:GrouphorizontalCenter="0"top="10"bae:Labeltext="您确定要刷新该任务吗？\n"top="10"textColor="0xac815a"fontFamily="desc_font"size="24"y="-2"scaleX="1"scaleY="1"left="0"right="0"cbagame:IconTextid="iconText"y="41"skinName="IconTextSkin"horizontalCenter="0"currentState="textIconText"x="10"cbae:Labelid="tips"text="d每日赠送三次免费刷新机会e"top="10"fontFamily="desc_font"size="20"y="8"scaleX="1"scaleY="1"left="0"right="0"textColor="0x548a5a"cbae:layoutbae:VerticalLayoutgap="10"horizontalAlign="center"cbace:layoutbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="HeadIconSkin"width="100"height="100"xmlns:e="http:ccns.egret.comceui"bae:Imagescale9Grid="12,12,76,78"left="0"right="0"top="0"bottom="0"touchEnabled="false"source="common_ui_playericon_json.bg_phb_heroicon"cbae:Imageid="playerIcon"scaleX="1"scaleY="1"left="16"right="16"top="16"bottom="16"horizontalCenter="0"verticalCenter="0"touchEnabled="false"source="common_ui_playericon_json.1001"cbae:Imageid="edgeIcon"scaleX="1"scaleY="1"horizontalCenter="0"left="0"top="0"verticalCenter="0"bottom="0"right="0"touchEnabled="false"source="bg_phb_heroicon_up03"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="KingSkillIconSkin"width="100"height="100"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Groupid="root"width="100"height="100"x="0"y="0"bans1:SGroupid="container"width="100"height="100"horizontalCenter="0"verticalCenter="0"bae:Imageid="bg"source="common_ui_common_json.bg_skill_k"horizontalCenter="0"verticalCenter="0"cbae:Imageid="icon"source="common_ui_skillicon_json.10010"horizontalCenter="0"verticalCenter="0"cbae:Imageid="bg2"source="common_ui_common_json.bg_skill_k_up"horizontalCenter="0"verticalCenter="0"cbacns1:SGroupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="LeftItemSkin"width="150"height="160"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="150"height="160"x="0"y="0"anchorOffsetY="0"bae:Imageid="playerIcon"x="26"y="26"scaleX="1"scaleY="1"source=""cbae:Imageid="iconBg"x="10"y="10"scaleX="1"scaleY="1"source="common_ui_playericon_json.bg_phb_heroicon_up02"cbae:Imageid="lvIcon"source="home_ui_common_json.icon_phb_num01"y="4.3"scaleX="0.5"scaleY="0.5"x="46.6"cbae:BitmapLabelid="cupCount"width="92.75"height="20"x="18.5"y="103.08"font="cup_font_fnt"anchorOffsetX="0"text="0000!"letterSpacing="0"textAlign="center"scaleX="0.9"scaleY="0.9"cbae:Imageid="nameBg"x="17.3"y="125.67"scale9Grid="2,2,7,19"anchorOffsetX="0"width="142"source="home_ui_common_json.bg_phb_namedi01"anchorOffsetY="0"height="26.6"cbae:Labelid="playerName"text=""x="19.79"y="128.12"size="22"fontFamily="desc_font"anchorOffsetX="0"stroke="0"strokeColor="0x5b402a"bold="false"textColor="0xaf7019"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="MainBottomSkin"width="1280"height="120"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"bae:Groupid="root"width="1280"height="120"x="0"y="0"bae:Labelid="tipsLabel"text="抵制不良游戏，拒绝盗版游戏。注意自我保护，谨防受骗上当。适度游戏益脑，沉迷游戏伤身。合理安排时间，享受健康生活。"y="80"fontFamily="desc_font"size="22"horizontalCenter="0"textColor="0x4c4741"visible="false"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="MainButtonSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Groupid="root"verticalCenter="0"horizontalCenter="0"bans1:SGroupverticalCenter="0"horizontalCenter="0"bae:Imageid="iconDisplay"anchorOffsetX="0"anchorOffsetY="0"source="home_ui_common_json.button_top_player"scaleX="1"scaleY="1"cbae:Imageid="redDot"source="common_ui_common_json.icon_hotpoint"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"right="-10"top="-8"visible="false"cbacns1:SGroupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="MainCenterSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="1280"height="720"x="0"y="0"bace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="MainLeftSkin"width="150"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"bae:Groupid="root"width="150"height="720"y="0"bace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="MainRightSkin"width="250"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"bae:Groupid="root"width="250"height="720"x="0"y="0"bae:Groupid="itemList"scaleX="1"scaleY="1"x="20"y="105"bae:layoutbae:VerticalLayoutgap="4"cbace:layoutbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="MainTipsSkin"width="1280"height="60"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="1280"height="60"bae:Groupwidth="640"height="60"y="0"horizontalCenter="27"bae:Imagesource="home_ui_common_json.bg_notice"anchorOffsetX="0"width="540"scaleX="1"scaleY="1"verticalCenter="0"scale9Grid="84,4,47,30"y="11"horizontalCenter="-9"cbae:Labelid="tipsLabel"text="公告内容公告内容"x="257"fontFamily="desc_font"size="26"textColor="0xc4d0d0"verticalCenter="0"y="17"scaleX="1"scaleY="1"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="MainTopSkin"width="1280"height="100"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"bae:Imagesource="00主界面01_对战_jpg"x="0"y="0"visible="false"cbae:Groupid="root"width="1280"height="120"x="0"y="0"anchorOffsetY="0"anchorOffsetX="0"bagame:RoleInfox="10.68"y="0"skinName="RoleInfoSkin"visible="false"cbagame:CostInfox="228.73"y="-4"skinName="CostInfoSkin"visible="false"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="MainUINewSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"baw:Configid="16b038ba12d"cba!--ae:Imageid="bg"x="0"y="0"source="00主界面01_对战_jpg"cb--bae:Groupid="root"width="1280"height="720"x="0"y="0"bagame:MainCenterid="mainCenter"skinName="MainCenterSkin"cbae:Groupid="bottomGroup"scaleX="1"scaleY="1"bottom="0"left="0"right="0"height="80"touchEnabled="false"bagame:BottomItemid="btn1"skinName="BottomItemSkin"icon="button_down_phb"width="170"horizontalCenter="-553"verticalCenter="-10"cbagame:BottomItemid="btn2"skinName="BottomItemSkin"icon="button_down_01"width="170"horizontalCenter="-374"verticalCenter="5"cbagame:BottomItemid="btn3"skinName="BottomItemSkin"icon="button_down_02"width="170"horizontalCenter="-196"verticalCenter="3"cbagame:BottomItemid="btn4"skinName="BottomItemSkin"icon="button_down_03"width="170"horizontalCenter="-6"verticalCenter="2"cbagame:BottomItemid="btn5"skinName="BottomItemSkin"icon="button_down_04"width="170"horizontalCenter="189"verticalCenter="4"cbagame:BottomItemid="btn6"skinName="BottomItemSkin"icon="button_down_05"width="170"horizontalCenter="381"verticalCenter="4"cbagame:BottomItemid="btn7"skinName="BottomItemSkin"icon="button_down_shop"width="170"horizontalCenter="586"verticalCenter="-10"cbae:layoutbae:BasicLayoutcbace:layoutbace:Groupbae:Groupid="rightGroup"touchEnabled="false"right="21"y="110"bagame:RightItemid="dzBtn"skinName="RightItemSkin"scaleX="1"scaleY="1"horizontalCenter="0"cbagame:RightItemid="ssBtn"skinName="RightItemSkin"scaleX="1"scaleY="1"y="122"horizontalCenter="0"cbagame:RightItemid="rwBtn"skinName="RightItemSkin"scaleX="1"scaleY="1"y="244"horizontalCenter="0"cbagame:RightItemid="tfBtn"skinName="RightItemSkin"scaleX="1"scaleY="1"y="367"horizontalCenter="0"cbae:layoutbae:BasicLayoutcbace:layoutbace:Groupbae:Groupid="leftGroup"y="133.26"touchEnabled="false"left="4"bagame:LeftItemid="rank1"skinName="LeftItemSkin"visible="false"cbagame:LeftItemid="rank2"skinName="LeftItemSkin"x="10"y="10"visible="false"cbagame:LeftItemid="rank3"skinName="LeftItemSkin"x="20"y="20"visible="false"cbae:layoutbae:VerticalLayoutgap="4"cbace:layoutbace:Groupbae:Groupid="topgroup"touchEnabled="false"bagame:CostInfoid="costInfo"skinName="CostInfoSkin"x="0"y="0"scaleX="1"scaleY="1"cbagame:RoleInfoid="roleInfo"skinName="RoleInfoSkin"x="10.64"y="-2.66"scaleX="1"scaleY="1"touchChildren="false"touchEnabled="true"cbae:Groupy="4.04"right="0"width="130"bagame:MainButtonid="mailBtn"skinName="MainButtonSkin"icon="button_top_mail"horizontalCenter="-168"verticalCenter="0"cbagame:MainButtonid="cjBtn"skinName="MainButtonSkin"icon="button_top_cj"horizontalCenter="-108"verticalCenter="1"cbagame:MainButtonid="replayBtn"skinName="MainButtonSkin"icon="button_top_player"horizontalCenter="-48"verticalCenter="0"cbagame:MainButtonid="szBtn"skinName="MainButtonSkin"icon="button_top_set"horizontalCenter="14"verticalCenter="-1"cbae:layoutbae:BasicLayoutcbace:layoutbace:Groupbae:ImageanchorOffsetY="0"height="40"anchorOffsetX="0"width="583.5"top="67"horizontalCenter="67"source="home_ui_common_json.bg_notice"scale9Grid="7,7,199,22"x="415"y="67"scaleX="1"scaleY="1"visible="false"cbae:Labeltext="暂无公告内容"fontFamily="desc_font"size="26"top="74"horizontalCenter="69"textColor="0xC4D0D0"x="457"y="76"scaleX="1"scaleY="1"width="580"textAlign="center"visible="false"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RightItemSkin"width="230"height="120"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Groupid="root"width="230"height="120"anchorOffsetX="0"anchorOffsetY="0"verticalCenter="0"horizontalCenter="0"bans1:SGroupwidth="230"height="120"horizontalCenter="0"verticalCenter="0"bae:Imageid="selectBg"y="0"right="0"x="-6"scaleX="1"scaleY="1"visible="false"cbae:Imageid="defaultBg"y="0"right="0"x="-6"scaleX="1"scaleY="1"source="button_r_dz_0"cba!--home_ui_common_json.button_r_dz_0--bacns1:SGroupbae:Imageid="redDotImg"x="188"y="2"source="common_ui_common_json.icon_hotpoint"scaleX="1"scaleY="1"visible="false"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RoleInfoSkin"width="440"height="120"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"bae:Groupid="root"width="440"height="120"x="0"y="0"bae:Imagex="91"y="19"anchorOffsetX="0"width="289"height="82"source="home_ui_common_json.bg_phb_heroicon_back"scale9Grid="7,11,16,34"cbae:Labelid="playerName"text=""x="95"y="29.52"fontFamily="desc_font"size="28"stroke="0"anchorOffsetX="0"anchorOffsetY="0"height="24"border="false"bold="true"textColor="0x66c9db"cbae:Labelid="familyName"text=""x="95"y="65"fontFamily="desc_font"size="24"stroke="0"anchorOffsetX="0"width="285.5"textColor="0x8eabb3"cbae:Labelid="cupCount"text="3356"y="31"fontFamily="main_font"size="26"stroke="0"anchorOffsetX="0"textColor="0xf2d45e"width="100"textAlign="right"right="98"cbae:BitmapLabelid="cupCount1"x="279.38"y="35.12"font="cup_font_fnt"text="3308"anchorOffsetX="0"anchorOffsetY="0"textAlign="right"letterSpacing="0"visible="false"cbae:Imagex="340.99"y="29.96"source="common_ui_common_json.icon_top_cup"cbagame:HeadIconid="headIcon"skinName="HeadIconSkin"y="7.37"x="-0.67"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RightDZItemSkin"width="410"height="240"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Groupid="root"width="410"height="240"verticalCenter="0"horizontalCenter="0"bans1:SGroupwidth="410"height="240"verticalCenter="0"horizontalCenter="0"bae:Imageid="iconImg"x="0"y="0"source="home_ui_common_json.button_ld_2v2_0"scaleX="1"scaleY="1"cbae:Imageid="lockImg"x="172"y="92.5"scaleX="1"scaleY="1"source=""cbacns1:SGroupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RightDZRecomItemSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"width="876"height="126"bae:Imagesource="2v2战斗_弹窗_02_jpg"x="-203.01"y="-183.96"visible="false"cbae:Groupid="root"width="876"height="126"anchorOffsetX="0"anchorOffsetY="0"bae:Imagesource="bg_2v2_nrt"scale9Grid="16,13,6,12"left="0"right="0"top="0"bottom="0"cbae:Groupx="124"y="26.5"bae:Labelid="memberName"text="角色名称六个字"fontFamily="main_font"textColor="0xb97432"scaleX="1"scaleY="1"cbae:Labelid="cups"text="00000"fontFamily="main_font"scaleX="1"scaleY="1"textColor="0xffd700"strokeColor="0xff9900"cbae:Imagesource="common_ui_common_json.icon_top_cup"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"cbace:layoutbace:Groupbae:Labelid="familyName"text="Lengdoname"x="124"y="72"fontFamily="desc_font"textColor="0xc3a182"cbans1:SButtonid="joinBtn"label="邀请"scaleX="1"scaleY="1"x="781"y="63"width="136"height="74"skinName="BtnCommonSkin"icon="button_ty_green"anchorOffsetX="68"anchorOffsetY="37"bacns1:SButtonbagame:HeadIconid="headIcon"skinName="HeadIconSkin"x="9.95"scaleX="1.1"scaleY="1.1"verticalCenter="-3"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RightDZRecomPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Imagesource="2v2战斗_弹窗_02_jpg"visible="false"cbae:Groupid="root"width="1280"height="720"bae:Imagealpha="1"scaleX="1"scaleY="1"left="0"right="0"top="0"bottom="0"source="bg_zdjs_di"scale9Grid="4,3,4,4"cbae:Groupid="bgGroup"scaleX="1"scaleY="1"horizontalCenter="0.5"y="57.15"bae:ImagescaleX="1"scaleY="1"source="bg_tc_di"cbae:Imagesource="bg_tc_gb_di"x="912"y="16"cbae:Imagex="63.47"y="116.78"source="bg_2v2_nrd"anchorOffsetX="0"width="896"scale9Grid="5,5,30,30"anchorOffsetY="0"height="350"cbans1:SButtonid="closeBtn"label=""y="34.85"x="997.3"icon="button_tc_close"skinName="BtnOnlyIconSkin"anchorOffsetX="28"anchorOffsetY="20"bacns1:SButtonbace:Groupbae:Groupid="onLineInfoGroup"x="399.27"y="553.92"scaleX="1"scaleY="1"bae:Imagesource="bg_2v2_fxjz"height="58"cbae:Labelid="onLineLb"text="当前在线族员：5人"x="21"y="14"fontFamily="desc_font"textColor="0x678baa"width="290"cbans1:SButtonid="shareBtn"label="分享至家族"scaleX="1"scaleY="1"x="407"y="28"width="198"height="70"skinName="BtnCommonSkin"anchorOffsetX="99"anchorOffsetY="35"icon="button_ty_blue"bacns1:SButtonbace:Groupbae:Groupid="noneTips"y="228.82"horizontalCenter="0.5"visible="false"bae:ImagescaleX="1"scaleY="1"source="bg_2v2_smdi"y="30.3"x="196.96"cbae:ImagescaleX="1"scaleY="1"source="bg_2v2_smxr"cbae:ImagescaleX="1"scaleY="1"source="bg_2v2_jd"width="115"height="41"anchorOffsetX="57"anchorOffsetY="20"x="121.26"y="19.66"rotation="-30"cbae:ImagescaleX="1"scaleY="1"source="bg_2v2_jd"width="115"height="41"anchorOffsetX="57"anchorOffsetY="20"x="585.75"y="191.8"rotation="-30"cbae:Labeltext="当前没有好友在线哦！\n您可以分享到家族，\n邀请家族成员一起战斗"scaleX="1"scaleY="1"fontFamily="desc_font"textColor="0xac815a"x="263.65"y="57.57"lineSpacing="20"size="28"cbace:Groupbae:Scrollerwidth="885"height="334"x="203.31"scaleX="1"scaleY="1"y="175"anchorOffsetY="0"scrollPolicyH="off"anchorOffsetX="0"bae:Listid="recomList"itemRendererSkinName="RightDZRecomItemSkin"height="206"anchorOffsetX="0"width="817"bae:ArrayCollectionbae:Arraybace:Arraybace:ArrayCollectionbae:layoutbae:VerticalLayoutpaddingTop="10"gap="-1"cbace:layoutbace:Listbace:Scrollerbae:Imagesource="bg_hero_yy01"left="0"bottom="0"touchEnabled="false"x="0"y="340"scaleX="1"scaleY="1"cbae:ImagetouchEnabled="false"source="bg_hero_yy03"right="0"bottom="0"x="1072"y="520"scaleX="1"scaleY="1"cbae:ImagetouchEnabled="false"source="bg_hero_yy02"right="0"top="0"x="668"y="0"scaleX="1"scaleY="1"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RightDZSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"bae:Groupid="root"width="1280"height="720"x="0"y="0"bae:Imagesource="home_ui_common_json.role_yz"x="235.28"y="539.78"alpha="0.8"cbae:Imageid="kingIcon"x="-28.21"y="99.68"source=""cbae:Groupid="kingIconBtn"width="301.52"height="451.52"x="215"y="162"anchorOffsetX="0"anchorOffsetY="0"bace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RightRWItemSkin"width="480"height="150"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Groupid="root"width="480"height="150"x="0"y="0"bae:Groupid="taskInfo"width="478.5"height="148"x="0"y="0"anchorOffsetX="0"anchorOffsetY="0"bae:Groupid="rewardInfo"width="129"height="98"x="335"y="42"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"bae:Imagesource="home_ui_task_json.bg_re_lb_di_02"x="-0.05000000000006821"y="0.9099999999999966"scaleX="1"scaleY="1"cbae:Imagesource="home_ui_task_json.bg_re_lb_di_jl"x="35.67000000000007"y="-11.309999999999995"scaleX="1"scaleY="1"cbae:Labeltext="奖励"x="14.450000000000045"y="-6.909999999999997"size="18"fontFamily="main_font"verticalAlign="middle"textAlign="center"anchorOffsetX="0"width="100"bold="true"textColor="0x93acc1"scaleX="1"scaleY="1"cbae:Imageid="itemIcon1"source="home_ui_common_json.icon_top_coin"x="7.400000000000034"y="14.600000000000001"scaleX="0.7"scaleY="0.7"cbae:Imageid="itemIcon2"x="7"y="52.60000000000001"scaleX="0.7"scaleY="0.7"source="home_ui_common_json.icon_top_diamond"cbae:BitmapLabelid="itemCount1"width="81.6"height="20"x="51.31999999999999"y="26.33"font="coin_font_fnt"text="4292"anchorOffsetX="0"scaleX="0.8"scaleY="0.8"cbae:BitmapLabelid="itemCount2"width="81.6"height="20"x="48.99000000000001"y="64.33"text="1245"anchorOffsetX="0"scaleX="0.8"scaleY="0.8"font="diamond_font_fnt"cbans1:SButtonid="refreshBtn"label=""x="89"y="-38"scaleX="1"scaleY="1"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="home_ui_task_json.button_ty_sx"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Groupbae:Imagesource="home_ui_task_json.bg_re_lb_di"x="17.199999999999996"y="37.6"scaleX="1"scaleY="1"cbae:Labelid="titleLabel"text="每日任务"x="27"y="7"size="26"fontFamily="main_font"textColor="0x9c540a"scaleX="1"scaleY="1"cbae:Labelid="descLabel"text="累计获得1000金币任务描述"x="28.6"y="60.6"size="22"fontFamily="desc_font"textColor="0x966c50"verticalAlign="middle"textAlign="center"anchorOffsetX="0"width="285"scaleX="1"scaleY="1"bold="true"cbae:Imageid="bg"source="home_ui_task_json.bg_re_lb_jd_di01"x="15.599999999999998"y="107.16"fillMode="scale"scaleX="1"scaleY="1"visible="false"cbae:Imageid="fg"source="home_ui_task_json.bg_re_lb_jd_di02"x="15.61"y="106.98999999999998"fillMode="clip"scaleX="1"scaleY="1"visible="false"cbae:Labelid="progressLabel"text="560c1000"x="34.6"y="112.66"size="16"fontFamily="main_font"verticalAlign="middle"textAlign="center"anchorOffsetX="0"width="267"bold="true"textColor="0x50799f"scaleX="1"scaleY="1"visible="false"cbae:Imagesource="home_ui_task_json.bg_re_lb_xx"x="19.4"y="144"scaleX="1"scaleY="1"cbans1:SButtonid="getBtn"label="领取"scaleX="1"scaleY="1"horizontalCenter="160.75"verticalCenter="7.5"anchorOffsetY="0"height="61"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_blue"scale9Grid="14,15,86,23"cbae:Labelid="labelDisplay"size="26"fontFamily="desc_font"horizontalCenter="0"verticalCenter="-3.5"textColor="0x4489c4"cbace:Skinbacns1:skinNamebacns1:SButtonbae:ProgressBarid="progBar"x="16"y="107.53"width="307"height="25"slideDuration="0"bae:skinNamebae:Skinwidth="307"height="25"bae:Imageleft="0"right="0"top="0"bottom="0"scale9Grid="59,14,26,8"source="home_ui_task_json.bg_re_lb_jd_di01"cbae:Imageid="thumb"left="0"right="0"top="0"bottom="0"scale9Grid="62,12,35,9"source="home_ui_task_json.bg_re_lb_jd_di02"cbae:Labelid="labelDisplay"text="560c1000"size="22"fontFamily="main_font"verticalAlign="middle"textAlign="center"bold="true"textColor="0x50799F"verticalCenter="0"horizontalCenter="0"cbace:Skinbace:skinNamebace:ProgressBarbace:Groupbae:Groupid="nextInfo"width="478.5"height="148"x="0"y="0"visible="false"bae:Imageid="pwsTimeBg"x="102.13"y="123.35"source="home_ui_common_json.icon_ss_pws_sjx"scale9Grid="7,0,9,7"width="327"cbae:Imageid="pwsTimeImg"x="112.06"y="89.32"scaleX="1"scaleY="1"source="home_ui_common_json.icon_ss_pws_sz"cbae:Labelid="nextTimeLabel"text="下个任务：5小时14分钟"x="148.07"y="94.67"fontFamily="desc_font"size="24"bold="true"textColor="0xb57962"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RightRWNextItemSkin"width="480"height="60"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Groupid="root"width="480"height="60"x="0"y="0"bae:Groupid="nextInfo"width="480"height="60"x="0"y="0"anchorOffsetY="0"bae:Imageid="pwsTimeBg"x="102.13"y="41.35"source="home_ui_common_json.icon_ss_pws_sjx"scale9Grid="7,0,9,7"width="295"scaleX="1"scaleY="1"cbae:Imageid="pwsTimeImg"x="112.06"y="7.32"scaleX="1"scaleY="1"source="home_ui_common_json.icon_ss_pws_sz"cbae:Labelid="nextTimeLabel"text="下个任务：5小时14分钟"x="148.07"y="12.67"fontFamily="desc_font"size="20"bold="true"textColor="0xa36844"scaleX="1"scaleY="1"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RightRWSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"xmlns:w="http:ccns.egret.comcwing"bae:Imagex="0"y="0"source="00主界面03_任务_jpg"visible="false"cbae:Groupid="root"width="1280"height="720"x="0"y="0"bae:Imagesource="home_ui_task_json.bg_re_lb"x="508"y="108.24"scaleX="1"scaleY="1"cbae:Scrollerid="game_list_scroller"width="480"height="450"x="511"y="120.24"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"bans1:SEuiListid="game_list1"itemRendererSkinName="RightRWItemSkin"bae:ArrayCollectionbae:Arraybae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbace:Arraybace:ArrayCollectionbacns1:SEuiListbace:Scrollerbae:Groupid="leftInfo"width="308"height="460"x="164"y="138.24"anchorOffsetX="0"anchorOffsetY="0"bae:Imagesource="home_ui_task_json.bg_re_zz"x="24"y="173"cbae:Imagesource="home_ui_task_json.bg_re_zz_bl"x="59.35"y="167"cbae:ProgressBarid="score_bar"x="104.8"y="244.2"skinName="Bar1Skin"maximum="500"value="300"width="142"height="36"slideDuration="0"cbae:Imagesource="home_ui_task_json.bg_re_zz_bx"x="76"y="25"cbae:Imagesource="home_ui_task_json.bg_re_zz_bx_jd"x="77.02"y="236"cbae:Imagesource="home_ui_task_json.bg_re_zz_cqbx"x="93.3"y="178.98"cbae:Imagesource="home_ui_task_json.bg_re_zz_cqbx_jl"x="224.32"y="189.67"cbans1:SButtonid="getBtn"label="领取"horizontalCenter="11"verticalCenter="111.5"anchorOffsetY="0"height="63"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_yellow"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"size="26"fontFamily="desc_font"textColor="0xc17c1a"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Groupbae:TabBarwidth="200"height="200"x="141"y="71.24"bae:Imagecbace:TabBarbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RightSSSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"xmlns:w="http:ccns.egret.comcwing"bae:Imagesource="00主界面02_赛事_jpg"x="0"y="0"visible="false"cbae:Groupid="root"width="1280"height="720"x="0"y="0"bae:Imagesource="home_ui_ss_json.button_ss_pws_cd_02"x="162.02"y="493.32"cbans1:SGroupid="pws"width="390.91"height="486.36"anchorOffsetX="0"anchorOffsetY="0"horizontalCenter="-251.5"verticalCenter="12"scaleX="1"bae:Buttonid="pwsBtn"label=""x="-1.08"y="1.77"scaleX="1"scaleY="1"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="home_ui_ss_json.button_ss_pws"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebace:Buttonbae:Imageid="pwsTimeImg"x="11.99"y="395.69"scaleX="1"scaleY="1"source="home_ui_common_json.icon_ss_pws_sz"cbae:Labelid="pwsTimeLabel"text="距离结束:23小时14分钟"x="46"y="400.69"size="20"textColor="0x8B6348"scaleX="1"scaleY="1"fontFamily="desc_font"bold="true"cbae:Imageid="pwsLock"source="home_ui_ss_json.icon_ss_pws_js"x="-10.75"y="291.05"scaleX="1"scaleY="1"cbae:Imagesource="home_ui_ss_json.button_ss_pws_cd"x="-31.2"y="-18.7"cbae:Imageid="pwsTimeBg"x="4"y="434"source="home_ui_common_json.icon_ss_pws_sjx"scale9Grid="7,0,9,7"width="295"cbacns1:SGroupbans1:SGroupid="zbs"width="407.58"height="240.91"anchorOffsetY="0"anchorOffsetX="0"horizontalCenter="172"verticalCenter="-119.5"bae:Buttonid="zbsBtn"label=""x="-1"y="11"scaleX="1"scaleY="1"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="home_ui_ss_json.button_ss_zbs"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebace:Buttonbae:Imageid="zbsLock"source="home_ui_ss_json.button_ss_zbs_js"x="2.36"y="136"scaleX="1"scaleY="1"cbae:Labelid="zbsTimeLabel"text="距离结束:23小时14分钟"x="167.84"y="23.13"size="20"textColor="0x8b6348"scaleX="1"scaleY="1"fontFamily="desc_font"bold="true"cbae:Imageid="zbsTimeImg"x="137.84"y="19.63"scaleX="0.9"scaleY="0.9"source="home_ui_common_json.icon_ss_pws_sz"cbacns1:SGroupbae:Imagesource="home_ui_ss_json.icon_ss_jqqd"x="650.08"y="439.21"anchorOffsetY="0"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RightTFSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"xmlns:w="http:ccns.egret.comcwing"bae:Imagesource="00主界面02_赛事_jpg"x="0"y="0"visible="false"cbae:Groupid="root"width="1280"height="720"x="0"y="0"bae:Imagesource="home_ui_ss_json.button_ss_pws_cd_02"x="151.38"y="493.32"cbans1:SGroupid="pws"width="390.91"height="486.36"anchorOffsetX="0"anchorOffsetY="0"horizontalCenter="-265.5"verticalCenter="12"scaleX="1"bae:Buttonid="pwsBtn"label=""x="-1.08"y="1.77"scaleX="1"scaleY="1"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="home_ui_ss_json.button_ss_pws"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebace:Buttonbae:Imageid="pwsTimeImg"x="9.990000000000038"y="408.69000000000005"scaleX="1"scaleY="1"source="home_ui_common_json.icon_ss_pws_sz"cbae:Labelid="pwsTimeLabel"text="距离结束:23小时14分钟"x="49.00000000000003"y="416.69000000000005"size="18"textColor="0x8B6348"scaleX="1"scaleY="1"fontFamily="desc_font"cbae:Imageid="pwsLock"source="home_ui_ss_json.icon_ss_pws_js"x="-10.75"y="291.05"scaleX="1"scaleY="1"cbae:Imagesource="home_ui_ss_json.button_ss_pws_cd"x="-31.2"y="-18.7"cbae:Imageid="pwsTimeBg"x="0"y="444"source="home_ui_common_json.icon_ss_pws_sjx"scale9Grid="7,0,9,7"width="295"cbacns1:SGroupbans1:SGroupid="zbs"width="407.58"height="240.91"anchorOffsetY="0"anchorOffsetX="0"horizontalCenter="158"verticalCenter="-119.5"bae:Buttonid="zbsBtn"label=""x="-1"y="11"scaleX="1"scaleY="1"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="home_ui_ss_json.button_ss_zbs"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebace:Buttonbae:Imageid="zbsLock"source="home_ui_ss_json.button_ss_zbs_js"x="0.36000000000001364"y="152.31"scaleX="1"scaleY="1"cbae:Labelid="zbsTimeLabel"text="距离结束:23小时14分钟"x="166.84000000000015"y="30.129999999999995"size="18"textColor="0x8b6348"scaleX="1"scaleY="1"fontFamily="desc_font"cbae:Imageid="zbsTimeImg"x="131.84000000000003"y="24.629999999999995"scaleX="1"scaleY="1"source="home_ui_common_json.icon_ss_pws_sz"cbacns1:SGroupbae:Imagesource="home_ui_ss_json.icon_ss_jqqd"x="610.44"y="432.21"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RankJiaZuPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagesource="排行榜01_jpg"cb--bae:Imagex="277.55"y="70"scale9Grid="6,6,42,38"anchorOffsetX="0"width="974"anchorOffsetY="0"height="632"source="bg_com_fgd"cbae:Imagex="268.65"y="76.68"source="bg_kplb_bt03"cbae:Imagex="706.05"y="79.18"source="bg_phb_topt_02"visible="false"cbae:Groupx="269.11"y="55.66"bae:ToggleButtonid="btn1"label="全球"x="-55.5"y="24.5"skinName="RankPlayerBtnSkin"width="146"scaleX="1"scaleY="1"cbae:ToggleButtonid="btn2"label="本地"x="82.68999999999994"y="24.5"skinName="RankPlayerBtnSkin"width="146"scaleX="1"scaleY="1"cbae:layoutbae:HorizontalLayoutgap="-8"cbace:layoutbace:Groupbae:Labelid="noneTips"text="当前排行榜无数据"x="279"y="377"fontFamily="desc_font"size="26"textColor="0x217d64"width="970"textAlign="center"cbae:Scrollerid="scro"height="555"x="283.64"y="131.34"anchorOffsetX="0"anchorOffsetY="0"scrollPolicyH="off"ba!--ae:ListitemRendererSkinName="RankPlayerItemSkin"b--bae:Listid="list"bae:ArrayCollectionbae:Arraybae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbace:Arraybace:ArrayCollectionbace:Listbace:Scrollerbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RankJiaZuZhanPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagesource="排行榜01_jpg"cb--bae:Imagex="277.55"y="70"scale9Grid="6,6,42,38"anchorOffsetX="0"width="974"anchorOffsetY="0"height="632"source="bg_com_fgd"cbae:Imagex="268.65"y="76.68"source="bg_kplb_bt03"cbae:Imagex="706.05"y="79.18"source="bg_phb_topt_02"visible="false"cbae:Groupx="269.11"y="55.66"bae:ToggleButtonid="btn1"label="全球"x="-55.5"y="24.5"skinName="RankPlayerBtnSkin"width="146"scaleX="1"scaleY="1"cbae:ToggleButtonid="btn2"label="本地"x="82.68999999999994"y="24.5"skinName="RankPlayerBtnSkin"width="146"scaleX="1"scaleY="1"cbae:layoutbae:HorizontalLayoutgap="-8"cbace:layoutbace:Groupbae:Scrollerid="scro"height="555"x="283.64"y="131.34"anchorOffsetX="0"anchorOffsetY="0"scrollPolicyH="off"ba!--ae:ListitemRendererSkinName="RankPlayerItemSkin"b--bae:Listid="list"bae:ArrayCollectionbae:Arraybae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbace:Arraybace:ArrayCollectionbace:Listbace:Scrollerbae:Labeltext="当前排行榜无数据"x="279"y="377"fontFamily="desc_font"size="26"textColor="0x217D64"width="970"textAlign="center"id="noneTips"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RankMainPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagesource="排行榜01_jpg"cb--bagame:MainPanelBgid="mainBg"skinName="MainPanelBgSkin"currentState="common"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RankNumSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"width="64"height="56"states="rank1,rank2,rank3,common"bae:Imageid="rankBg"source="icon_phb_num01"source.rank2="icon_phb_num02"source.rank3="icon_phb_num03"includeIn="rank1,rank2,rank3"cbae:Labelid="rankLb"text="4"verticalAlign="middle"textAlign="center"left="0"right="0"top="0"bottom="0"includeIn="common"fontFamily="main_font"size="32"textColor="0xbd7b49"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RankPlayerBtnSkin"currentState="up"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"states="up,down"bae:Imagesource="button_phb_qh_0"scale9Grid="10,9,18,54"left="0"right="0"top="0"bottom="0"source.down="button_phb_qh_1"source.up="button_phb_qh_0"scale9Grid.up="10,9,15,34"scale9Grid.down="5,9,12,26"cbae:Labelid="labelDisplay"text="Label"left="0"right="0"top="0"bottom="0"textAlign="center"verticalAlign="middle"textColor.down="0x217d64"size.down="36"fontFamily.down="main_font"fontFamily="main_font"size="36"textColor.up="0x2a4c5a"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RankPlayerItem2Skin"width="902"height="98"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagesource="排行榜01_jpg"x="-284"y="-491.26"visible="true"cb--bae:Imageid="bg"anchorOffsetX="0"left="0"right="0"scale9Grid="31,35,17,46"top="0"bottom="0"source="bg_phb_tmdi0_1"cbae:Imageid="mySel"anchorOffsetX="0"source="bg_phb_xz"scale9Grid="27,35,18,46"left="4"right="4"top="1"bottom="6"visible="false"cbagame:RankNumid="rank"skinName="RankNumSkin"x="16"verticalCenter="0"cbae:Labelid="pName"text="玩家名称六字"x="232.44"fontFamily="main_font"size="34"textColor="0xc18658"verticalCenter="0"cbae:Labelid="familyName"text="家族名称六字"x="522.28"fontFamily="desc_font"size="26"textColor="0xab7854"verticalCenter="0"cbae:Buttonid="cups"label="00000"skinName="FamilyCupsSkin"currentState="cups2"right="3"verticalCenter="0.5"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RankPlayerItem3Skin"width="902"height="98"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagesource="排行榜01_jpg"x="-284"y="-491.26"visible="true"cb--bae:Imageid="bg"anchorOffsetX="0"left="0"right="0"scale9Grid="31,35,17,46"top="0"bottom="0"source="bg_phb_tmdi0_1"cbae:Imageid="mySel"anchorOffsetX="0"source="bg_phb_xz"scale9Grid="27,35,18,46"left="4"right="4"top="1"bottom="6"visible="false"cbagame:RankNumid="rank"skinName="RankNumSkin"x="16"verticalCenter="0"cbae:Labelid="pName"text="玩家名称六字"x="232.44"fontFamily="main_font"size="34"textColor="0xc18658"verticalCenter="0"cbae:Labelid="familyName"text="家族名称六字"x="522.28"fontFamily="desc_font"size="26"textColor="0xab7854"verticalCenter="0"cbae:Buttonid="cups"label="00000"skinName="FamilyCupsSkin"currentState="cups2"right="3"verticalCenter="0.5"cbagame:FamilyIconid="familyIcon"x="130"skinName="FamilyIconSkin"verticalCenter="0"scaleX="0.8"scaleY="0.8"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RankPlayerItemSkin"width="902"height="98"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagex="-313.34"y="-470.93"source="排行榜01_jpg"cb--bae:Imageid="bg"anchorOffsetX="0"left="0"right="0"scale9Grid="31,35,17,46"top="0"bottom="0"source="bg_phb_tmdi0_1"cbae:Imageid="mySel"anchorOffsetX="0"source="bg_phb_xz"scale9Grid="27,35,18,46"left="0"right="0"top="0"bottom="0"visible="false"cbagame:RankNumid="rank"skinName="RankNumSkin"verticalCenter="0"x="16"cbagame:HeadIconid="headIcon"skinName="HeadIconSkin"left="115"verticalCenter="0"cbae:Labelid="pName"text="玩家名称六字"x="232.44"fontFamily="main_font"size="34"textColor="0xc18658"verticalCenter="0"cbae:Labelid="familyName"text="家族名称六字"x="522.28"fontFamily="desc_font"size="26"textColor="0xab7854"verticalCenter="0"cbae:Buttonid="cups"label="00000"skinName="FamilyCupsSkin"currentState="cups2"right="3"verticalCenter="0.5"minWidth="154"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RankPlayerPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"ba!--ae:Imagesource="排行榜01_jpg"cb--bae:Imagewidth="932"height="536"x="297.34"y="143.34"source="bg_jz_lt_jk_di"scale9Grid="6,6,38,38"anchorOffsetY="0"cbae:Groupx="288.82"y="72.33"visible="false"bagame:RankPlayerBtnid="btn1"label="全球"x="-55.5"y="24.5"skinName="RankPlayerBtnSkin"width="146"scaleX="1"scaleY="1"cbagame:RankPlayerBtnid="btn2"label="本地"x="82.68999999999994"y="24.5"skinName="RankPlayerBtnSkin"width="146"scaleX="1"scaleY="1"cbae:layoutbae:HorizontalLayoutgap="-8"cbace:layoutbace:Groupbae:Scrollerid="scro"height="510"x="314.64"y="157.34"anchorOffsetX="0"anchorOffsetY="0"scrollPolicyH="off"bae:Listid="list"bae:ArrayCollectionbae:Arrayba!--ae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cb--bace:Arraybace:ArrayCollectionbae:layoutbae:VerticalLayoutcbace:layoutba!--ae:Listid="list"b--bace:Listbace:Scrollerbae:Labeltext="联盟杯赛事当前剩余时间：00天00小时00分"y="87.5"fontFamily="desc_font"size="24"textColor="0x28718c"right="46"visible="false"cbae:Buttonid="noneTips"label="暂无上榜信息"skinName="FamilyNonTipsBtn"x="43"scaleX="1"scaleY="1"width="560"horizontalCenter="117"verticalCenter="39"touchChildren="false"touchEnabled="false"visible="false"cbagame:RankSwitchBtnGroupid="switchBtn"x="283.39"y="74.03"skinName="SwitchButtonGroupSkin"height="50"width="336"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="SwitchButtonGroupSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Imagesource="button_phb_qh_0"scale9Grid="10,11,13,29"left="0"right="0"top="0"bottom="0"cbae:Groupleft="4"right="4"top="4"bottom="4"bae:Buttonid="btn1"label="全球"x="18"y="96"scaleX="1"scaleY="1"skinName="SwitchButtonSkin"width="50%"currentState="down1"height="100%"cbae:Buttonid="btn2"label="本地"x="28"y="106"scaleX="1"scaleY="1"skinName="SwitchButtonSkin"width="50%"height="100%"cbae:layoutbae:HorizontalLayoutcbace:layoutbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="SwitchButtonSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"width="200"states="up1,down1,down2"height="52"bae:Imagesource="button_phb_qh_0"scale9Grid="10,12,15,28"left="0"right="0"top="0"bottom="0"source.down1="button_phb_qh_1"scale9Grid.down1="10,12,6,28"source.down2="button_phb_qh_1"scale9Grid.down2="10,12,5,28"scaleX.down1="-1"includeIn="down1,down2"cbae:Labelid="labelDisplay"text="Label"left="0"right="0"top="0"bottom="0"verticalAlign="middle"textAlign="center"fontFamily="desc_font"size="32"textColor="0x54c2cf"textColor.down1="0xc68822"textColor.down2="0xc68822"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="Replay1V1InfoItemSkin"width="940"height="300"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"bae:Imagesource="录像03_jpg"x="-206.1"y="-192.91"visible="false"cbae:Groupid="root"width="940"height="270"y="0"horizontalCenter="0"bae:Imagey="84"width="466"anchorOffsetX="0"anchorOffsetY="0"source="home_ui_family_lt_json.bg_jz_lt_zdjl01di2"scale9Grid="7,19,14,86"left="7"cbae:Imagey="10"height="74"width="466"source="home_ui_family_lt_json.bg_jz_lt_zdjl01di"scale9Grid="7,10,8,65"anchorOffsetX="0"anchorOffsetY="0"left="7"cbae:Imagey="84"width="466"scale9Grid="7,19,14,86"anchorOffsetX="0"anchorOffsetY="0"source="home_ui_family_lt_json.bg_jz_lt_zdjl02di2"right="7"cbae:Imagey="10"height="74"width="466"scale9Grid="7,10,8,65"anchorOffsetX="0"anchorOffsetY="0"source="home_ui_family_lt_json.bg_jz_lt_zdjl02di"right="7"cbae:Groupid="attackInfo"width="234.67"height="96"y="20"anchorOffsetY="0"anchorOffsetX="0"scaleX="1"scaleY="1"left="20"bagame:HeadIconid="headInfo01"y="-9"skinName="HeadIconSkin"scaleX="0.75"scaleY="0.75"left="-12"cbae:Labelid="playerName01"text="玩家名称六字"x="60.31"y="2.2"fontFamily="main_font"size="28"stroke="0"anchorOffsetX="0"anchorOffsetY="0"height="24"border="false"bold="true"scaleX="1"scaleY="1"textColor="0xbefdff"textAlign="left"touchEnabled="false"cbae:Labelid="familyName01"text="我的家族"x="59.67"y="30.31"fontFamily="desc_font"size="22"stroke="0"anchorOffsetX="0"scaleX="1"scaleY="1"textColor="0x3e6a7f"cbae:Imageid="attackWinTips01"source="home_ui_family_lt_json.icon_jz_lt_dzjl_win"x="341.34"y="17.67"scaleX="1"scaleY="1"cbace:Groupbae:Groupid="defendInfo"width="234.67"height="96"y="20"anchorOffsetY="0"anchorOffsetX="0"right="20"scaleX="1"scaleY="1"bagame:HeadIconid="headInfo02"y="-7"skinName="HeadIconSkin"scaleX="0.75"scaleY="0.75"right="-6"cbae:Labelid="playerName02"text="我的名字"y="4.15"fontFamily="main_font"size="28"stroke="0"anchorOffsetX="0"anchorOffsetY="0"height="24"border="false"bold="true"scaleX="1"scaleY="1"right="74.66999999999999"textAlign="right"textColor="0xffdada"cbae:Labelid="familyName02"text="我的家族"y="30.97"fontFamily="desc_font"size="22"stroke="0"anchorOffsetX="0"scaleX="1"scaleY="1"right="70.66999999999999"textAlign="right"textColor="0x8e372f"cbae:Imageid="defendWinTips02"source="home_ui_family_lt_json.icon_jz_lt_dzjl_lose"x="-164.98"y="16.91"scaleX="1"scaleY="1"cbace:Groupbans1:SButtonid="shareBtn"label="分享"anchorOffsetX="0"width="140"anchorOffsetY="0"height="54"scaleX="1"scaleY="1"verticalCenter="128"horizontalCenter="230"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_green"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"size="24"fontFamily="desc_font"textColor="0x358c37"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="watchBtn"label="观看"anchorOffsetX="0"width="140"anchorOffsetY="0"height="54"scaleX="1"scaleY="1"verticalCenter="128"horizontalCenter="380"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_blue"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"size="24"fontFamily="desc_font"textColor="0x4489c4"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Groupid="leftCard"width="420"height="124"anchorOffsetX="0"y="94"x="16"anchorOffsetY="0"bae:layoutbae:TileLayoutorientation="rows"horizontalGap="0"verticalGap="0"requestedColumnCount="4"cbace:layoutbace:Groupbae:Groupid="rightCard"width="420"height="124"y="94"anchorOffsetX="0"right="26"bae:layoutbae:TileLayoutorientation="rows"horizontalGap="0"verticalGap="0"requestedColumnCount="4"cbace:layoutbace:Groupbae:Imagey="139.01"scaleX="0.9"scaleY="0.9"source="home_ui_family_lt_json.icon_jz_lt_dzjl_vs"horizontalCenter="0"cbae:Groupid="infoGroup"width="421.21"height="74.24"x="35"y="316"anchorOffsetY="0"anchorOffsetX="0"bae:Imagesource="home_ui_common_json.button_top_player"x="-16.82"y="-66.33"scaleX="0.65"scaleY="0.65"cbae:Labelid="timeLabel1"text="9999次观看"x="20"fontFamily="main_font"scaleX="1"scaleY="1"size="24"textColor="0x906937"verticalCenter="-84"cbae:Labelid="timeLabel2"text="d5小时以前e"x="155"fontFamily="desc_font"scaleX="1"scaleY="1"size="20"textColor="0x897045"verticalCenter="-84"cbace:Groupbae:Imagesource="home_ui_grzl_json.icon_grzl_lx_01"y="13"scaleX="0.75"scaleY="0.75"horizontalCenter="0"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ReplayInfoSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"bae:Imagex="0"y="0"source="录像03_jpg"visible="false"cbae:Groupid="root"width="1280"height="720"x="0"y="0"bagame:CommonWinid="comWin"skinName="CommonWinSkin"anchorOffsetX="0"width="1020"anchorOffsetY="0"height="640"y="70"scaleX="1"scaleY="1"horizontalCenter="0"cbae:Imagesource="home_ui_family_lt_json.bg_jz_lt_jk_di"y="196.36"scale9Grid="6,6,38,38"anchorOffsetX="0"width="952.39"anchorOffsetY="0"height="480"horizontalCenter="0"cbae:Imagesource="home_ui_family_lt_json.bg_jz_lt_jk_di_x01"y="195.66"scale9Grid="6,0,38,4"width="924"horizontalCenter="0"cbans1:SGroupid="worldBtn"width="127"height="53"anchorOffsetX="0"anchorOffsetY="0"horizontalCenter="-383.5"verticalCenter="-188.5"bae:Imageid="worldBg1"x="-5.07"y="-5"anchorOffsetX="0"width="139.33"scale9Grid="19,33,12,18"anchorOffsetY="0"height="67"source="home_ui_family_lt_json.bg_jz_lt_jk_bt02"cbae:Imageid="worldBg2"x="26.71"y="10"source="home_ui_tv_json.bg_tv_sj"cbacns1:SGroupbans1:SGroupid="myBtn"width="127"height="53"anchorOffsetX="0"anchorOffsetY="0"horizontalCenter="-245.5"verticalCenter="-188.5"bae:Imageid="myBg1"x="-5.07"y="-5"anchorOffsetX="0"width="139.33"anchorOffsetY="0"height="67"scale9Grid="19,33,12,18"source="home_ui_family_lt_json.bg_jz_lt_jk_bt01"cbae:Imageid="myBg2"x="26.71"y="10"source="home_ui_tv_json.bg_tv_gr"cbacns1:SGroupbae:Groupid="worldInfo"width="277"height="76"x="795"y="118"anchorOffsetY="0"anchorOffsetX="0"bae:Imagesource="home_ui_tv_json.bg_tv_pddi"y="24"scale9Grid="13,11,23,23"anchorOffsetX="0"width="195"horizontalCenter="0"cbans1:SGroupid="leftBtn"width="60"height="50"scaleX="1"horizontalCenter="-115.5"verticalCenter="10"bae:Imagesource="common_ui_common_json.button_ty_yellow"width="55"scale9Grid="11,11,92,33"height="50"scaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"cbae:Imagesource="home_ui_tv_json.button_tv_qhjjc"scaleX="-1"scaleY="1"horizontalCenter="1.5"verticalCenter="-4.5"cbacns1:SGroupbans1:SGroupid="rightBtn"width="60"height="50"scaleX="1"horizontalCenter="113.5"verticalCenter="10"bae:Imagesource="common_ui_common_json.button_ty_yellow"scale9Grid="11,11,92,33"width="55"height="50"scaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"cbae:Imagesource="home_ui_tv_json.button_tv_qhjjc"scaleX="1"scaleY="1"horizontalCenter="1.5"verticalCenter="-4.5"cbacns1:SGroupbae:Labelid="worldTipLabel"text="10阶竞技场"y="33.33"fontFamily="main_font"bold="true"scaleX="1"scaleY="1"size="28"textColor="0xfff4c1"stroke="2"strokeColor="0xaf4d36"horizontalCenter="0"cbace:Groupbae:Groupid="myInfo"width="374"height="76"x="731.69"y="132.67"anchorOffsetY="0"anchorOffsetX="0"bae:Labelid="myTipLabel"text="显示最新的10场单人战斗录像"y="20.659999999999997"fontFamily="desc_font"bold="true"scaleX="1"scaleY="1"horizontalCenter="11"x="97"size="24"textColor="0x966c50"cbace:Groupbae:Scrollerid="game_list_scroller"width="940"height="480"y="197"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"horizontalCenter="0"bae:Listid="game_list"itemRendererSkinName="Replay1V1InfoItemSkin"cbace:Scrollerbae:Groupid="emptyTips"width="200"height="200"y="227"horizontalCenter="0"bae:Imagesource="home_ui_family_lt_json.bg_jz_lt_jk_wxts"x="-107"y="125"scale9Grid="22,22,25,19"anchorOffsetX="0"width="459"anchorOffsetY="0"height="166"cbae:Labelid="emptyLabel"text="当前没有最新的录像！"y="198"scaleX="1"scaleY="1"fontFamily="desc_font"textAlign="center"horizontalCenter="23.5"size="24"textColor="0x966c50"cbae:Imagesource="home_ui_family_lt_json.bg_jz_lt_jk_wxtsrw"x="-266.66"y="101.32"scaleX="1"scaleY="1"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RoleBtnItemSkin"width="240"height="93"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"states="common_info,selected_info"bae:Imagealpha="1"touchEnabled="false"source="军队01-军队_jpg"y="-83"x="-17"visible.selected_info="false"y.common_info="-180.33"visible="false"cbae:Imagealpha="1"right="0"touchEnabled="false"source.common_info="home_ui_kz_json.button_kz_02"right.common_info="0"source.selected_info="home_ui_kz_json.button_kz_01"right.selected_info="0"source="home_ui_kz_json.button_kz_01"cbae:Imagealpha="1"right="58"touchEnabled="false"x="10"y="20.66"source="home_ui_jd_json.button_jd_jd"right.common_info="62"y.common_info="23.31"source.common_info="home_ui_jd_json.button_jd_lz_0"source.selected_info="home_ui_jd_json.button_jd_lz"cbae:Imageid="redDotImg"x="168"y="7"source="common_ui_common_json.icon_hotpoint"visible.common_info="false"visible.selected_info="false"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RoleEditNameWinSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagesource="个人资料02_jpg"visible="true"cb--bae:Imagesource="button_png"left="0"right="0"top="0"bottom="0"scale9Grid="19,6,115,36"cbae:Groupheight="362"width="536"horizontalCenter="0"verticalCenter="0"bagame:CommonWinid="comWin"skinName="CommonWinSkin"left="0"right="0"top="0"bottom="0"cbae:Imagesource="bg_kz_kpxx_szd01"scale9Grid="7,18,8,32"anchorOffsetY="0"anchorOffsetX="0"top="67"horizontalCenter="0"bottom="105"left="28"right="29"cbae:Imagesource="bg_grzl_srd"scale9Grid="18,20,5,6"width="278"horizontalCenter="0"top="129"cbagame:IconTextid="iconText"skinName="IconTextSkin"horizontalCenter="0.5"top="178"currentState="textIconText"cbae:Labeltext="请输入昵称："fontFamily="desc_font"size="26"textColor="0xba8048"horizontalCenter="0"textAlign="center"top="87"cbae:Labeltext="（首次免费）"size="20"fontFamily="desc_font"textColor="0x579f63"horizontalCenter="0"top="225"cbans1:SInputLabelid="editName"text=""y="138.33"size="26"width="260"textAlign="left"verticalAlign="middle"scaleX="1"scaleY="1"type="input"fontFamily="desc_font"alpha="1"anchorOffsetX="0"horizontalCenter="0"textColor="0xaf8f6e"cbae:GroupscaleX="1"scaleY="1"horizontalCenter="0"bottom="24"height="76"x="68"y="256"bans1:SButtonid="leftBtn"label="取消"anchorOffsetX="80"scaleX="1"scaleY="1"y="42"width="160"height="68"horizontalCenter="-120"anchorOffsetY="34"skinName="BtnCommonSkin"icon="button_ty_red"cbans1:SButtonid="rightBtn"label="确定"width="160"height="68"y="42"horizontalCenter="120"anchorOffsetX="80"anchorOffsetY="34"skinName="BtnCommonSkin"icon="button_ty_yellow"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RoleInfoPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:ns1="*"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagescale9Grid="0,10,7,62"anchorOffsetY="0"visible="true"source="个人资料01_jpg"cb--bae:Imagex="271.6"y="65.27"source="bg_lz_tc"scale9Grid="30,21,63,57"anchorOffsetX="0"width="507"anchorOffsetY="0"height="642"cbae:Imagex="792.82"y="70.94"source="home_ui_kz_json.bg_com_fgd"scale9Grid="6,6,42,38"anchorOffsetX="0"width="466"anchorOffsetY="0"height="629.6"cbae:Imagex="786.99"y="80"anchorOffsetX="0"source="home_ui_kz_json.bg_kplb_bt"scale9Grid="38,11,388,24"cbae:Imagesource="home_ui_jd_json.bg_jd_topt"anchorOffsetX="0"scaleX="1"scaleY="1"x="787.56"y="77.8"scale9Grid="10,10,22,32"width="160"cbae:Imagex="297.13"y="238"anchorOffsetX="0"width="222"anchorOffsetY="0"height="195"source="bg_grzl_di_gz01"scale9Grid="27,63,12,96"cbae:Imagex="527.8"y="238"anchorOffsetX="0"width="222"anchorOffsetY="0"height="195"scale9Grid="27,63,12,96"source="bg_grzl_di_gz01"cbae:Imagex="298"y="440"anchorOffsetX="0"width="452"height="63"source="bg_grzl_di_gz02"scale9Grid="15,21,16,22"cbae:Imagex="301.99"y="444.02"anchorOffsetX="0"source="bg_grzl_di_gz03"width="142"scale9Grid="17,20,2,12"cbae:Imagex="298"y="508.32"scale9Grid="15,21,16,22"anchorOffsetX="0"width="452"height="63"source="bg_grzl_di_gz02"cbae:Imagex="301.99"y="511.39"scale9Grid="17,20,2,12"anchorOffsetX="0"source="bg_grzl_di_gz03"width="142"cbae:Imagex="298"y="577"scale9Grid="15,21,16,22"anchorOffsetX="0"width="452"height="63"source="bg_grzl_di_gz02"cbae:Imagex="301"y="580.75"scale9Grid="17,20,2,12"anchorOffsetX="0"source="bg_grzl_di_gz03"width="142"cbae:Imagex="571.75"y="245"source="icon_grzl_02"cbae:Imagex="344.09"y="245"source="icon_grzl_01"cbae:Imagex="313"y="455.01"source="icon_grzl_03"cbae:Imagex="313"y="520.33"source="icon_grzl_04"cbae:Imagex="313"y="589.85"source="icon_grzl_05"cbae:Imagex="335.06"y="309.16"scale9Grid="40,4,32,25"source="icon_grzl_jb"cbae:Imagex="570.07"y="302.78"scale9Grid="40,4,32,25"source="icon_grzl_jjc"cbae:Imagex="336.04"y="349.49"source="icon_grzl_jb_smd"width="136"scale9Grid="40,4,66,25"cbae:Imagex="571.37"y="349"scale9Grid="40,4,32,25"width="136"source="icon_grzl_jjc_smd"cbae:Imagex="412.2"y="97.1"source="bg_grzl_namedi"anchorOffsetX="0"width="360"scale9Grid="31,26,28,10"cbae:Imagex="420.64"y="103.98"source="bg_grzl_namedi_xbdi"cbae:Imageid="sex"x="427.47"y="107.15"source="icon_xb_n"cbae:Imagex="1186.38"y="82.35"source="common_ui_common_json.icon_sh_d"cbans1:SButtonid="editNameBtn"label=""x="723"y="127"anchorOffsetX="20"anchorOffsetY="24"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="home_ui_grzl_json.button_rename"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Groupid="heroGroup"anchorOffsetX="0"anchorOffsetY="0"x="804.68"y="126.34"touchEnabled="false"bagame:HeroKa1x="0"skinName="HeroKa1Skin"touchChildren="false"cbagame:HeroKa1x="0"skinName="HeroKa1Skin"touchChildren="false"cbagame:HeroKa1x="10"skinName="HeroKa1Skin"y="10"touchChildren="false"cbagame:HeroKa1x="20"skinName="HeroKa1Skin"y="20"touchChildren="false"cbagame:HeroKa1x="30"skinName="HeroKa1Skin"y="30"touchChildren="false"cbagame:HeroKa1x="40"skinName="HeroKa1Skin"y="40"touchChildren="false"cbagame:HeroKa1x="50"skinName="HeroKa1Skin"y="50"touchChildren="false"cbagame:HeroKa1x="60"skinName="HeroKa1Skin"y="60"cbae:layoutbae:TileLayoutrowAlign="justifyUsingHeight"columnAlign="left"requestedColumnCount="2"paddingTop="8"horizontalGap="12"verticalGap="0"cbace:layoutbace:Groupbagame:HeadIcony="94.35"skinName="HeadIconSkin"x="288.18"scaleX="1.2"scaleY="1.2"cbae:Labeltext="奖杯"x="391.08"y="251.85"fontFamily="main_font"textColor="0xAD5907"size="26"cbae:Labeltext="竞技场"x="613.58"y="251"fontFamily="main_font"textColor="0xAD5907"size="26"cbae:Labeltext="等级"x="359.99"y="461.36"fontFamily="main_font"textColor="0xAD5907"size="26"cbae:Labeltext="家族"x="359"y="528.71"fontFamily="main_font"textColor="0xAD5907"size="26"cbae:Labeltext="地区"x="359"y="595.7"fontFamily="main_font"textColor="0xAD5907"size="26"cbae:Labeltext="常用卡组"fontFamily="main_font"size="30"y="89.31"x="806.67"textColor="0x97eff4"cbae:Labeltext="平均花费圣水："fontFamily="desc_font"size="26"x="964.01"y="91.33"textColor="0xffffff"cbae:BitmapLabelid="averageCost"x="1135.4"y="92"font="sh_font_fnt"text="4#6"scaleX="0.85"scaleY="0.85"letterSpacing="-6"cbae:Labelid="userName"text="玩家的昵称"x="472.58"y="112.02"fontFamily="desc_font"textColor="0xad5907"width="220"textAlign="center"cbae:Labelid="cupsLb"text="00000"x="330.58"y="352.36"fontFamily="desc_font"textColor="0xf2d45e"stroke="2"strokeColor="0xa04909"size="28"width="150"textAlign="center"cbae:Labelid="codeNum"text="编号：fesf12345662"x="426.63"y="160.79"fontFamily="desc_font"textColor="0xb0865a"size="26"visible="false"cbae:Labelid="levelLb"text="5级"x="458"y="458.76"size="26"fontFamily="desc_font"textColor="0x966c50"cbae:Labelid="familyName"text="家族名称"x="458"y="527.78"size="26"textColor="0x966c50"fontFamily="desc_font"cbae:Labelid="localName"text="中国"x="458"y="595.99"size="26"textColor="0x966c50"fontFamily="desc_font"cbae:Groupx="601"y="352"scaleX="0.8"scaleY="0.8"width="100"bae:BitmapLabelid="stepLb"font="jjc_lv_fnt"text="00"scaleX="1"scaleY="1"cbae:Imagex="106"y="81"source="icon_grzl_jjc_j"cbae:layoutbae:HorizontalLayouthorizontalAlign="center"cbace:layoutbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RoleMainPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bagame:MainPanelBgid="mainBg"y="0"skinName="MainPanelBgSkin"currentState="commonNoBg"cba!--ae:Imagescale9Grid="0,10,7,62"anchorOffsetY="0"source="02个人资料01_jpg"visible="false"cb--ba!--ae:Groupid="viewGroup"touchEnabled="false"cbae:Groupid="tabGroup"x="13.15"y="82.97"height="590"bagame:TabItem1id="infoBtn"skinName="TabItem1Skin"cbagame:TabItem1id="recordBtn"skinName="TabItem1Skin"x="10"y="10"cbae:layoutbae:VerticalLayoutgap="12"cbace:layoutbace:Groupb--bace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RoleRecordPanelItemSkin"width="922"height="190"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagesource="个人资料04_jpg"x="-302"y="-91"visible="true"cb--bae:Imagesource="bg_grzl_di_gz04"scale9Grid="11,23,28,144"anchorOffsetX="0"left="0"right="0"top="0"bottom="0"cbae:ImageanchorOffsetX="0"source="bg_grzl_di_gz05"scale9Grid="25,58,14,85"x="14.65"y="-2.93"width="142"cbae:Imagex="34"y="44"source="icon_grzl_lx_01"cbae:Imagex="172"y="32.66"source="bg_grzl_xx"width="662"cbae:Imagex="422.5"y="12.5"source="bg_grzl_di_gz06"scale9Grid="22,20,13,5"anchorOffsetX="0"width="170"cbae:Labelid="title"text="战绩标题"x="422.5"y="19.5"width="170"textAlign="center"fontFamily="main_font"textColor="0x9e8259"cbae:Imagewidth="165"height="40"scaleX="1"scaleY="1"source="bg_grzl_di_gz07"scale9Grid="23,18,5,4"x="170"y="68"cbae:Imagewidth="165"height="40"scaleX="1"scaleY="1"source="bg_grzl_di_gz07"scale9Grid="23,18,5,4"x="170"y="124"cbae:Imagewidth="165"height="40"scaleX="1"scaleY="1"source="bg_grzl_di_gz07"scale9Grid="23,18,5,4"x="560"y="68"cbae:Imagewidth="165"height="40"scaleX="1"scaleY="1"source="bg_grzl_di_gz07"scale9Grid="23,18,5,4"x="560"y="124"cbae:ImagescaleX="1"scaleY="1"source="icon_grzl_01"x="170"y="70"cbae:ImagescaleX="1"scaleY="1"source="icon_grzl_01"x="170"y="127"cbae:ImagescaleX="1"scaleY="1"source="icon_grzl_01"x="560"y="70"cbae:ImagescaleX="1"scaleY="1"source="icon_grzl_01"x="560"y="127"cbae:Labeltext="最高排位"y="75"fontFamily="main_font"size="26"textColor="0xb2741e"x="206"width="120"textAlign="center"cbae:Labeltext="战斗总数"y="132"fontFamily="main_font"size="26"textColor="0xB2741E"x="206"width="120"textAlign="center"cbae:Labeltext="最高奖杯"y="75"fontFamily="main_font"size="26"textColor="0xB2741E"x="595"width="120"textAlign="center"cbae:Labeltext="获胜场数"y="132"fontFamily="main_font"size="26"textColor="0xB2741E"x="595"width="120"textAlign="center"cbae:Labelid="maxRank"text="未上榜"y="75"fontFamily="desc_font"size="26"x="379"textAlign="left"textColor="0xab7952"cbae:Labelid="fightCount"text="0次"y="132"fontFamily="desc_font"size="26"textColor="0xAB7952"x="379"textAlign="left"cbae:Labelid="winCount"text="0场"y="132"fontFamily="desc_font"size="26"textColor="0xAB7952"x="764"textAlign="left"cbae:Groupx="764"y="75"bae:Labelid="maxCups"text="0"fontFamily="desc_font"size="26"textColor="0xAB7952"textAlign="left"scaleX="1"scaleY="1"cbae:Imagescale9Grid="22,20,13,5"anchorOffsetX="0"scaleX="1"scaleY="1"source="bg_phb_jb"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"cbace:layoutbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RoleRecordPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagesource="个人资料04_jpg"cb--bae:Imagesource="bg_lz_tc"scale9Grid="26,20,58,54"anchorOffsetX="0"anchorOffsetY="0"left="271"top="65"bottom="13"right="21"cbae:Listid="list"itemRendererSkinName="RoleRecordPanelItemSkin"x="302.41"y="90.9"touchEnabled="false"bae:ArrayCollectionbae:Arraybace:Arraybace:ArrayCollectionbae:layoutbae:VerticalLayoutgap="10"cbace:layoutbace:Listbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="CommonTextInfoSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"xmlns:ns1="*"bae:Imagesource="bg_black"left="0"right="0"top="0"bottom="0"alpha="0.7"cbae:Groupid="root"width="538"height="366"verticalCenter="0"horizontalCenter="0"bagame:CommonWinid="comWin"x="0"y="0"skinName="CommonWinSkin"cbae:Scrollerwidth="500"height="280"anchorOffsetX="0"anchorOffsetY="0"x="19"verticalCenter="18"bae:Groupbae:Labelid="content"text="sef"x="0"y="0"fontFamily="desc_font"size="24"textColor="0x9b6a43"width="500"cbae:layoutbae:BasicLayoutcbace:layoutbace:Groupbace:Scrollerbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="LanItemSkin"width="480"height="60"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bans1:SGroupid="root"width="322"height="60"verticalCenter="0"horizontalCenter="0"bae:Imageid="bg"horizontalCenter="0"verticalCenter="0"width="460"height="50"source="home_ui_login_json.bg_dl_xzfwq"scale9Grid="9,12,12,31"cbae:Labelid="lanName"text="服务器名称"anchorOffsetX="0"width="300"stroke="2"textAlign="center"fontFamily="desc_font"scaleX="1"scaleY="1"size="34"horizontalCenter="0"verticalCenter="0"textColor="0x93c6de"cbacns1:SGroupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="SelectLanSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"xmlns:ns1="*"bae:Groupid="root"width="1280"height="720"x="0"y="0"bagame:CommonWinid="comWin"skinName="CommonWinSkin"horizontalCenter="0"verticalCenter="0"cbae:GroupanchorOffsetX="0"anchorOffsetY="0"height="260"width="480"horizontalCenter="0"y="248.52"bae:Groupid="serverList"width="480"height="260"x="2.2999999999999545"y="0.9999999999999432"scaleX="1"scaleY="1"anchorOffsetX="0"anchorOffsetY="0"bae:Scrollerid="game_list_scroller"width="480"height="260"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"horizontalCenter="0"bottom="0"cbae:Listid="game_list"width="480"height="260"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"x="0"alpha="1"y="0"cbace:Groupbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="SettingsInfoSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="1280"height="720"x="0"y="0"bae:Imagesource="button_png"x="0"y="0"width="1280"height="720"scale9Grid="19,6,115,36"cbae:Imagesource="common_ui_common_json.bg_blue_00"x="42"y="179"scale9Grid="1,1,2,2"width="1200"height="526"anchorOffsetY="0"cbae:Groupid="topInfo"width="1280"height="76"y="76"anchorOffsetY="0"anchorOffsetX="0"horizontalCenter="0"bae:Labelid="myTipLabel"text="玩家ID：100444"y="20.659999999999997"fontFamily="desc_font"textColor="0x00E9FF"bold="true"scaleX="1"scaleY="1"horizontalCenter="-1.5"x="97"cbace:Groupbae:Labelid="title"text="设置"y="26"horizontalCenter="0"size="40"fontFamily="desc_font"cbans1:SButtonid="closeBtn"label=""scaleX="2"scaleY="2"rotation="45"horizontalCenter="580.5"verticalCenter="-327.5"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="home_ui_common_json.button_top_add"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Groupid="group01"width="200"height="42.67"x="59"y="185"anchorOffsetY="0"bae:CheckBoxid="check01"label=""x="140.65"y="11"scaleX="1"scaleY="1"cbae:Labeltext="音乐"x="9"y="6"fontFamily="desc_font"cbace:Groupbae:Groupid="group02"width="200"height="42.67"x="339.67"y="185"anchorOffsetY="0"bae:CheckBoxid="check02"label=""x="140.65"y="11"scaleX="1"scaleY="1"cbae:Labeltext="音效"x="9"y="6"fontFamily="desc_font"cbace:Groupbae:Groupid="group03"width="586.67"height="42.67"x="66.34"y="259.67"anchorOffsetY="0"anchorOffsetX="0"bae:Labeltext="画质"x="9"y="6"fontFamily="desc_font"cbae:Labeltext="高"x="160"y="6"fontFamily="desc_font"cbae:CheckBoxid="check031"label=""x="200"y="11"scaleX="1"scaleY="1"cbae:Labeltext="中"x="260"y="6"fontFamily="desc_font"cbae:CheckBoxid="check032"label=""x="300"y="11"scaleX="1"scaleY="1"cbae:Labeltext="低"x="360"y="6"fontFamily="desc_font"cbae:CheckBoxid="check033"label=""x="400"y="11"scaleX="1"scaleY="1"cbace:Groupbae:Groupid="group04"width="298.67"height="42.67"anchorOffsetY="0"anchorOffsetX="0"horizontalCenter="-421.5"verticalCenter="-1.5"bae:Labeltext="语言"x="9"y="6"fontFamily="desc_font"cbans1:SGroupid="group041"width="200"height="41"anchorOffsetY="0"horizontalCenter="49"verticalCenter="0.16499999999999915"bae:Labelid="label04"text="简体中文"y="5"fontFamily="desc_font"scaleX="1"scaleY="1"horizontalCenter="0"touchEnabled="false"cbacns1:SGroupbace:Groupbans1:SGroupid="group05"width="298.67"height="42.67"anchorOffsetY="0"anchorOffsetX="0"horizontalCenter="-423.5"verticalCenter="63.5"bae:Labelid="label05"text="服务协议"y="6"fontFamily="desc_font"horizontalCenter="0"touchEnabled="false"cbacns1:SGroupbans1:SGroupid="group06"width="298.67"height="42.67"anchorOffsetY="0"anchorOffsetX="0"horizontalCenter="-85.5"verticalCenter="63.5"bae:Labelid="label06"text="隐私政策"y="6"fontFamily="desc_font"horizontalCenter="0"touchEnabled="false"cbacns1:SGroupbans1:SButtonid="backToLoginBtn"label="退出登录"width="187"height="78"anchorOffsetY="0"anchorOffsetX="0"horizontalCenter="-378.5"verticalCenter="238"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_blue"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"size="40"fontFamily="desc_font"bold="true"textColor="0x4489c4"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="linkToServerBtn"label="联系客服"width="187"height="78"anchorOffsetY="0"anchorOffsetX="0"horizontalCenter="-24.5"verticalCenter="240"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_blue"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"size="40"fontFamily="desc_font"bold="true"textColor="0x4489c4"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="GXZBInfoSkin"width="870"height="600"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"baw:Configid="16d4d79f45f"cbae:Groupid="root"width="870"height="600"x="0"y="0"bae:Groupid="saleTips"width="300"height="66.67"y="0"anchorOffsetY="0"anchorOffsetX="0"x="569"bae:Labelid="saleLabel"text="特惠周剩余6天"size="24"scaleX="1"scaleY="1"fontFamily="desc_font"textColor="0xFF0000"textAlign="left"y="21"x="50"cbae:Imageid="saleImg"scaleX="1"scaleY="1"source="home_ui_common_json.icon_ss_pws_sz"width="30"height="30"y="18"x="0"cbace:Groupbae:Scrollerid="game_list_scroller"width="870"height="520"x="0"y="80"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"bae:Listid="game_list"xmlns:ns1="*"x="39.39"y="-278.79"anchorOffsetY="0"bae:layoutbae:TileLayouthorizontalGap="0"verticalGap="0"requestedColumnCount="3"cbace:layoutbace:Listbace:Scrollerbae:Groupwidth="520"height="80"x="0"y="0"bae:ToggleButtonlabel="神主"x="0"y="15"width="130"bae:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_green"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbace:skinNamebace:ToggleButtonbae:ToggleButtonlabel="表情"x="140"y="15"width="130"bae:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_green"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbace:skinNamebace:ToggleButtonbae:ToggleButtonlabel="头像框"x="280"y="15"width="130"bae:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_green"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbace:skinNamebace:ToggleButtonbae:ToggleButtonlabel="聊天框"x="420"y="15"width="130"bae:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_green"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbace:skinNamebace:ToggleButtonbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="GXZBItemSkin"width="290"height="400"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"bae:Groupid="root"width="290"height="400"bae:Imagesource="common_ui_common_json.bg_skill_k"x="0"y="0"scale9Grid="34,35,17,7"width="290"height="400"cbae:Imagesource="common_ui_common_json.icon_hotpoint_s"x="0"y="0"scale9Grid="10,8,13,15"width="290"height="400"alpha="0.5"cbae:Labelid="nameLabel"text="雅典娜"y="35"horizontalCenter="0"fontFamily="main_font"textColor="0xff0000"stroke="1"size="24"cbae:Imageid="itemIcon"source="kingtower_99010_png"y="87"width="200"height="200"horizontalCenter="0"cbae:Labelid="countLabel"text="x2"y="230"fontFamily="main_font"horizontalCenter="0.5"stroke="1"cbae:Groupid="buy1Group"width="290"height="100"y="290"horizontalCenter="0"bagame:CommonItemid="buyInfo"horizontalCenter="0"y="49"scaleX="0.8"scaleY="0.8"x="5"bagame:skinNamebae:Skinwidth="350"height="60"currentState="normal"states="normal,sales,free"bans1:SGroupid="root"width="350"height="60"anchorOffsetY="0"horizontalCenter="0"verticalCenter="0"bae:Imagesource="common_ui_common_json.icon_hotpoint"width="350"height="60"scale9Grid="8,8,2,2"alpha="0.5"y="0"x="0"cbae:Groupid="priceInfo"width="350"height="60"x="0"y="0"visible.free="false"bae:Imagesource="home_ui_common_json.bg_exp"x="7.5"y="5.5"scale9Grid="26,5,22,35"scaleX="0.5"anchorOffsetX="0"width="128"scaleY="1"cbae:Imageid="costIcon"source="home_ui_common_json.icon_top_diamond"x="10"y="0"scaleX="1"scaleY="1"cbans1:SInputLabelid="oldPrice"text="750"x="94"y="15"fontFamily="desc_font"size="26"textColor="0x000000"visible.normal="false"verticalCenter.sales="0"scaleX="1"scaleY="1"cbans1:SInputLabelid="newPrice"text="600"x="210"y="15"fontFamily="desc_font"size="26"textColor="0x000000"x.normal="162"verticalCenter.normal="0"verticalCenter.sales="0"scaleX="1"scaleY="1"cbace:Groupbans1:SInputLabelid="warnLabel"text="解锁3阶竞技场可购买"fontFamily="desc_font"size="26"textColor="0xff0000"horizontalCenter="0"verticalCenter="0"visible.free="false"cbae:Labelid="freeLabel"text="免费"includeIn="free"y="16"horizontalCenter="0"fontFamily="desc_font"textColor="0x17ff00"cbacns1:SGroupbace:Skinbacgame:skinNamebacgame:CommonItembae:ProgressBarid="countBar"y="8"horizontalCenter="0"x="68"scaleX="1"scaleY="1"bae:skinNamebae:Skinwidth="155"height="24"bae:Imageleft="0"right="0"top="0"bottom="0"source="bg_card_big_num1_0"scale9Grid="18,9,67,6"cbae:Imageid="thumb"source="bg_card_big_num1_1"scale9Grid="30,9,67,7"anchorOffsetY="0"height="24"left="0"right="0"verticalCenter="0"cbae:Labelid="labelDisplay"text="0000c0000"size="20"verticalCenter="0"left="0"right="0"textAlign="center"textColor="0x4777b3"bold="true"cbace:Skinbace:skinNamebace:ProgressBarbae:Imageid="upTips"source="home_ui_hero_json.icon_hero_jt"x="78"y="1"scaleX="1"scaleY="1"cbace:Groupbae:Groupid="buy2Group"width="290"height="100"x="0"y="290"visible="false"bae:Imagesource="home_ui_common_json.icon_top_exp"y="0"x="116"cbae:Labeltext="已购买"y="63"fontFamily="desc_font"textColor="0x07ff00"x="100"cbace:Groupbae:Groupid="saleGroup"width="89"height="50"y="0"anchorOffsetX="0"anchorOffsetY="0"bae:Imagesource="home_ui_common_json.bg_exp_nr"y="4"anchorOffsetX="0"width="82"scaleX="1"scaleY="1"horizontalCenter="0"cbae:Labelid="saleDesc"text="8.5折"y="12"scaleX="1"scaleY="1"fontFamily="desc_font"size="24"horizontalCenter="0"textColor="0x000000"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="JXKPInfoSkin"width="870"height="600"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="870"height="600"x="0"y="0"bae:Groupid="saleTips"width="650.97"height="66.67"y="0"anchorOffsetY="0"anchorOffsetX="0"x="115"bae:Labelid="saleLabel"text="特惠周剩余6天"y="30.099999999999994"size="24"scaleX="1"scaleY="1"fontFamily="desc_font"textColor="0xFF0000"textAlign="center"horizontalCenter="0"cbae:Imageid="saleImg"y="24.60000000000001"scaleX="1"scaleY="1"source="home_ui_common_json.icon_ss_pws_sz"x="211"width="30"height="30"cbace:Groupbae:Scrollerid="game_list_scroller"width="870"height="520"x="0"y="80"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"bae:Listid="game_list"xmlns:ns1="*"x="39.39"y="-278.79"anchorOffsetY="0"height="600"bae:layoutbae:TileLayouthorizontalGap="0"verticalGap="0"requestedColumnCount="3"cbace:layoutbace:Listbace:Scrollerbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="JXKPItemSkin"width="290"height="400"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"bae:Groupid="root"width="290"height="400"bae:Imagesource="common_ui_common_json.bg_skill_k"x="0"y="0"scale9Grid="34,35,17,7"width="290"height="400"cbae:Imagesource="common_ui_common_json.icon_hotpoint_s"x="0"y="0"scale9Grid="10,8,13,15"width="290"height="400"alpha="0.5"cbae:Labelid="nameLabel"text="雅典娜"y="35"horizontalCenter="0"fontFamily="main_font"textColor="0xff0000"stroke="1"size="24"cbae:Imageid="itemIcon"source="kingtower_99010_png"y="87"width="200"height="200"horizontalCenter="0"cbae:Labelid="countLabel"text="x2"y="230"fontFamily="main_font"horizontalCenter="0.5"stroke="1"cbae:Groupid="buy1Group"width="290"height="100"y="290"horizontalCenter="0"bagame:CommonItemid="buyInfo"horizontalCenter="0"y="49"scaleX="0.8"scaleY="0.8"x="5"bagame:skinNamebae:Skinwidth="350"height="60"currentState="normal"states="normal,sales,free"bans1:SGroupid="root"width="350"height="60"anchorOffsetY="0"horizontalCenter="0"verticalCenter="0"bae:Imagesource="common_ui_common_json.icon_hotpoint"width="350"height="60"scale9Grid="8,8,2,2"alpha="0.5"y="0"x="0"cbae:Groupid="priceInfo"width="350"height="60"x="0"y="0"visible.free="false"bae:Imagesource="home_ui_common_json.bg_exp"x="7.5"y="5.5"scale9Grid="26,5,22,35"scaleX="0.5"anchorOffsetX="0"width="128"scaleY="1"cbae:Imageid="costIcon"source="home_ui_common_json.icon_top_diamond"x="10"y="0"scaleX="1"scaleY="1"cbans1:SInputLabelid="oldPrice"text="750"x="94"y="15"fontFamily="desc_font"size="26"textColor="0x000000"visible.normal="false"verticalCenter.sales="0"scaleX="1"scaleY="1"cbans1:SInputLabelid="newPrice"text="600"x="210"y="15"fontFamily="desc_font"size="26"textColor="0x000000"x.normal="162"verticalCenter.normal="0"verticalCenter.sales="0"scaleX="1"scaleY="1"cbace:Groupbans1:SInputLabelid="warnLabel"text="解锁3阶竞技场可购买"fontFamily="desc_font"size="26"textColor="0xff0000"horizontalCenter="0"verticalCenter="0"visible.free="false"cbae:Labelid="freeLabel"text="免费"includeIn="free"y="16"horizontalCenter="0"fontFamily="desc_font"textColor="0x17ff00"cbacns1:SGroupbace:Skinbacgame:skinNamebacgame:CommonItembae:ProgressBarid="countBar"y="8"horizontalCenter="0"x="68"scaleX="1"scaleY="1"bae:skinNamebae:Skinwidth="155"height="24"bae:Imageleft="0"right="0"top="0"bottom="0"source="bg_card_big_num1_0"scale9Grid="18,9,67,6"cbae:Imageid="thumb"source="bg_card_big_num1_1"scale9Grid="30,9,67,7"anchorOffsetY="0"height="24"left="0"right="0"verticalCenter="0"cbae:Labelid="labelDisplay"text="0000c0000"size="20"verticalCenter="0"left="0"right="0"textAlign="center"textColor="0x4777b3"bold="true"cbace:Skinbace:skinNamebace:ProgressBarbae:Imageid="upTips"source="home_ui_hero_json.icon_hero_jt"x="78"y="1"scaleX="1"scaleY="1"cbace:Groupbae:Groupid="buy2Group"width="290"height="100"x="0"y="290"visible="false"bae:Imagesource="home_ui_common_json.icon_top_exp"y="0"x="116"cbae:Labeltext="已购买"y="63"fontFamily="desc_font"textColor="0x07ff00"x="100"cbace:Groupbae:Groupid="saleGroup"width="89"height="50"y="0"anchorOffsetX="0"anchorOffsetY="0"bae:Imagesource="home_ui_common_json.bg_exp_nr"y="4"anchorOffsetX="0"width="82"scaleX="1"scaleY="1"horizontalCenter="0"cbae:Labelid="saleDesc"text="8.5折"y="12"scaleX="1"scaleY="1"fontFamily="desc_font"size="24"horizontalCenter="0"textColor="0x000000"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopBtnSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Imagesource="button_ty_yellow"scale9Grid="14,10,86,35"left="0"right="0"top="0"bottom="0"cbae:GroupverticalCenter="0"left="0"right="0"bae:Imageid="iconDisplay"x="113"y="116"source="item_3"width="78"height="78"cbae:Labelid="labelDisplay"text="60"x="84"y="20.67"textColor="0x3d91cb"fontFamily="main_font"size="30"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"horizontalAlign="center"paddingRight="20"gap="-15"cbace:layoutbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopBuyKaPaiBtnSkin"currentState="common"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"height="64"states="common,notEnough"bae:Imagesource="button_ty_yellow"scale9Grid="14,10,86,35"left="0"right="0"top="0"bottom="0"cbae:Imageid="iconDisplay"width="78"height="78"scaleX="0.7"scaleY="0.7"source="icon_top_diamond"verticalCenter="-1.5"left="4"cbae:Labelid="labelDisplay"text="200"textColor="0x3d91cb"fontFamily="main_font"size="30"verticalCenter="-3"right="15"left="54"textAlign="center"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopBuyKaPaiWinSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Imagesource="商店05_卡牌_jpg"visible="false"cbae:Imageid="bg"source="bg_black"left="0"right="0"top="0"bottom="0"alpha="0.7"cbagame:CommonWinid="comWin"skinName="CommonWinSkin"horizontalCenter="0"verticalCenter="0"height="390"cbae:Imagesource="bg_kz_kpxx_szd01"scale9Grid="7,18,8,32"anchorOffsetY="0"anchorOffsetX="0"height="216.33"verticalCenter="-10"horizontalCenter="0"width="350"cbae:Labelid="itemName"text="卡牌名称名称"fontFamily="main_font"textColor="0x327FB0"touchEnabled="false"horizontalCenter="0.5"verticalCenter="-92"cbae:Imageid="kaBg"source="bg_shop_card_di_0"touchEnabled="false"scaleX="0.9"scaleY="0.9"horizontalCenter="3.5"verticalCenter="-7.5"cbagame:HeroKa1id="ka"skinName="HeroKa1Skin"touchChildren="false"touchEnabled="false"horizontalCenter="0"scaleX="0.9"scaleY="0.9"verticalCenter="-6.5"cbae:Labelid="kaCount"text="X2"fontFamily="main_font"horizontalCenter="63"size="32"textColor="0xFFFFFF"strokeColor="0x327FB0"stroke="2"touchEnabled="false"verticalCenter="34"cbans1:SButtonid="buyBtn"label="00000"skinName="ShopBuyKaPaiBtnSkin"icon="icon_top_diamond"height="64"anchorOffsetY="32"horizontalCenter="0"verticalCenter="142"cbagame:ProgressExpid="expProg"y="419.04"skinName="ProgressExpSkin"horizontalCenter="0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopBuyWinSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagesource="商店02_金币02_jpg"visible="false"cb--bae:Imagesource="button_png"left="0"right="0"top="0"bottom="0"scale9Grid="19,6,115,36"cbae:Groupy="169.69"x="372.36"height="366"bagame:CommonWinid="comWin"skinName="CommonWinSkin"verticalCenter="0"height="378"left="0"right="0"cbae:Imagesource="bg_kz_kpxx_szd01"scale9Grid="7,18,8,32"anchorOffsetY="0"height="182.6"anchorOffsetX="0"top="74"left="30"right="30"cbans1:SButtonid="buyBtn"label="6"y="307.47"skinName="ShopBtnSkin"width="149"height="64"icon="item_3"anchorOffsetX="75"anchorOffsetY="32"horizontalCenter="0"cbagame:ShopGoodsItemid="item"y="95.37"skinName="ShopGoodsItemSkin"horizontalCenter="0.5"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopDimandItemSkin"width="310"height="280"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagex="-250.5"y="-99.5"scale9Grid="19,6,115,36"width="1280"height="720"alpha="1"source="商店02_金币_jpg"visible="true"cb--bae:Imagealpha="1"anchorOffsetX="0"left="0"right="0"top="0"bottom="0"source="bg_shop_spdi"scale9Grid="34,65,17,124"cbae:Imagesource="bg_shop_spdi_zs"horizontalCenter="0"verticalCenter="0"cbae:Imageid="iconImg"width="180"height="175"source=""verticalCenter="0"horizontalCenter="0"cbae:Groupbottom="22"horizontalCenter="0.5"bae:Labeltext="￥"x="30"y="13"textColor="0xcb8b1b"cbae:Labelid="priceLb"text="0000"fontFamily="main_font"scaleX="1"scaleY="1"x="10"y="-92"size="34"textColor="0xcb8b1b"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"gap="2"cbace:layoutbace:Groupbae:Labelid="title"text="000000"fontFamily="main_font"top="14"horizontalCenter="0.5"textColor="0x4193d2"cbae:Labelid="testId"text="Label"textColor="0x000000"horizontalCenter="0"verticalCenter="0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopDimandPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagex="0"y="0"scale9Grid="19,6,115,36"width="1280"height="720"alpha="1"source="商店02_金币_jpg"visible="true"cb--bae:Scrollerwidth="980"height="590"x="249"y="100"anchorOffsetY="0"scrollPolicyH="off"bae:Listid="list"itemRendererSkinName="ShopDimandItemSkin"bae:ArrayCollectionbae:Arraybae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbace:Arraybace:ArrayCollectionbae:layoutbae:TileLayoutrequestedColumnCount="3"horizontalGap="30"verticalGap="28"cbace:layoutbace:Listbace:Scrollerbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopGoldItemSkin"width="310"height="280"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagex="-251"y="-99.5"scale9Grid="19,6,115,36"width="1280"height="720"alpha="1"source="商店02_金币_jpg"visible="true"cb--bae:Imagealpha="1"anchorOffsetX="0"left="0"right="0"top="0"bottom="0"source="bg_shop_spdi"scale9Grid="34,65,17,124"cbae:ImagehorizontalCenter="0"verticalCenter="0"source="bg_shop_spdi_jb"cbae:Imageid="iconImg"width="180"height="175"source=""verticalCenter="0"horizontalCenter="0"cbae:Groupbottom="22"horizontalCenter="0"bae:Imageid="costIcon"source="icon_top_diamond"scaleX="0.9"scaleY="0.9"cbae:Labelid="priceLb"text="0000"fontFamily="main_font"scaleX="1"scaleY="1"x="10"y="-92"size="34"textColor="0x4193d2"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"gap="2"cbace:layoutbace:Groupbae:Labelid="title"text="000000"fontFamily="main_font"top="14"horizontalCenter="0.5"textColor="0xcb8b1b"cbae:Labelid="testId"text="Label"textColor="0x000000"horizontalCenter="0"verticalCenter="0"visible="false"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopGoldPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Imagex="0"y="0"scale9Grid="19,6,115,36"width="1280"height="720"alpha="1"source="商店02_金币_jpg"visible="false"cbae:Scrollerwidth="980"height="590"x="249"y="100"anchorOffsetY="0"scrollPolicyH="off"scrollPolicyV="off"bae:Listid="list"itemRendererSkinName="ShopGoldItemSkin"bae:ArrayCollectionbae:Arraybae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbace:Arraybace:ArrayCollectionbae:layoutbae:TileLayoutrequestedColumnCount="3"horizontalGap="30"verticalGap="28"cbace:layoutbace:Listbace:Scrollerbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopGoodsItemSkin"currentState="type_1"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"states="type_1"width.type_1="98"height.type_1="134"ba!--ae:Imagesource="商店02_金币02_jpg"y="-100"x="-325"x.type_1="-591.99"y.type_1="-265.2"cb--bae:Imagesource="bg_bag_gz"horizontalCenter.type_1="0"bottom.type_1="0"cbae:Imageid="icon"horizontalCenter.type_1="0.5"bottom.type_1="-2"source.type_1=""source=""cbae:Labelid="itemName"text="一些金币"size.type_1="24"textColor.type_1="0x966c50"fontFamily.type_1="desc_font"horizontalCenter.type_1="0"text.type_1="itemname"cbae:Labelid="countLb"text="一些金币"text.type_1="count"textColor.type_1="0x6d6456"fontFamily.type_1="main_font"size.type_1="24"right.type_1="4"bottom.type_1="7"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopInfoSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"ba!--ae:Imagescale9Grid="19,6,115,36"width="1280"height="720"alpha="1"source="商店01_钻石_jpg"cb--bae:Groupid="root"width="1280"height="720"x="0"y="0"bagame:MainPanelBgid="mainBg"skinName="MainPanelBgSkin"currentState="common2"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopInfoTabSkin"currentState="common_zs"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"states="common_zs,selected_zs,common_jb,selected_jb"width="190"height="90"ba!--ae:Imagey="-90.82"x="-10"y.common="-188.42"y.selected="-90.92"y.lock="-478.1"touchEnabled="false"source.selected="卡组01_主_jpg"source="卡组01_主_jpg"visible.lock="false"visible="false"cb--bae:Imagealpha="1"right="0"touchEnabled="false"right.common_zs="0"width="190"source.selected_zs="button_shop_01"source="button_shop_01"source.common_zs="button_shop_02"source.common_jb="button_shop_02"cbae:Imageid="iconImg"alpha="1"touchEnabled="false"x="50"verticalCenter="0"verticalCenter.selected_zs="0"x.selected_zs="35"source=""source.common_zs="button_shop_zs0"source.selected_zs="button_shop_zs"source.common_jb="button_shop_jb0"source.selected_jb="button_shop_jb"cba!--1001--ba!--button_shop_zs--bace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopItemRewardSkin"width="350"height="60"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"bans1:SGroupwidth="350"height="60"y="0"anchorOffsetY="0"horizontalCenter="0"bae:Imagesource="home_ui_common_json.icon_top_coin"x="20"id="itemIcon0"verticalCenter="0"cbae:Labeltext="x250"x="90"fontFamily="desc_font"size="26"textColor="0x000000"id="itemCount0"verticalCenter="0"cbae:Imagesource="home_ui_common_json.icon_top_coin"x="200"id="itemIcon1"verticalCenter="0"cbae:Labeltext="x2500"x="270"fontFamily="desc_font"size="26"textColor="0x000000"id="itemCount1"verticalCenter="0"cbacns1:SGroupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopKaPaiItemSkin"width="310"height="310"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Imageid="bg"anchorOffsetX="0"touchEnabled="false"source="bg_shop_spdi"left="0"right="0"scale9Grid="34,91,16,102"top="0"bottom="0"x="0"y="0"scaleX="1"scaleY="1"cba!--ae:Imagesource="商店03_卡牌_jpg"x="-250.53"y="-118.99"cb--bae:Groupid="greyBox"left="0"right="0"top="0"bottom="0"bae:Imageid="kapaiBg"horizontalCenter="3.5"touchEnabled="false"source="bg_shop_card_di_0"scaleX="0.9"scaleY="0.9"verticalCenter="-18.5"x="61"y="70"cbae:Groupid="priceGroup"touchChildren="false"touchEnabled="false"bottom="14"horizontalCenter="0"height="53"x="63"y="243"scaleX="1"scaleY="1"bae:Imageid="costIcon"width="58"height="58"source="item_3"cbans1:SLabelByLineid="yuanjia"x="57"y="22"cbae:Labelid="price"text="000"x="136"y="10"fontFamily="main_font"size="34"textColor="0x327fb0"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"cbace:layoutbace:Groupbae:Labelid="itemName"text="卡牌名称名称"fontFamily="main_font"textColor="0x327fb0"touchEnabled="false"top="14"horizontalCenter="0.5"x="70"y="14"scaleX="1"scaleY="1"cbagame:HeroKa1id="ka"skinName="HeroKa1Skin"touchChildren="false"touchEnabled="false"horizontalCenter="-5"verticalCenter="-19.5"scaleX="0.9"scaleY="0.9"x="53"y="72"cbae:Labelid="kaCount"text="X2"fontFamily="main_font"horizontalCenter="64"size="32"textColor="0xffffff"strokeColor="0x327fb0"stroke="2"touchEnabled="false"verticalCenter="23"x="198"y="162"scaleX="1"scaleY="1"cbae:ProgressBarid="kaPaiNumProg"skinName="Bar4Skin"width="194"height="28"slideDuration="0"horizontalCenter="0"verticalCenter="59"x="58"y="200"scaleX="1"scaleY="1"cbae:BitmapLabelid="progLb"text="100!100"font="card_num_font_fnt"scaleX="0.7"scaleY="0.7"horizontalCenter="0"verticalCenter="57"x="105"y="202"cbae:Imageid="zhekouIcon"source="icon_shop_dz"right="0"top="8"x="241"y="8"scaleX="1"scaleY="1"cbae:Labelid="zhekou"text="0.0折"textColor="0xe44343"fontFamily="main_font"size="20"right="-15"top="15"height="24"x="251"y="15"scaleX="1"scaleY="1"verticalAlign="middle"width="100"textAlign="center"cbae:Labelid="freeTips"text="免费"horizontalCenter="0"bottom="25"fontFamily="desc_font"textColor="0x2a7f3e"size="32"x="123"y="253"scaleX="1"scaleY="1"cbae:Labelid="hasBuyTips"text="已购买"horizontalCenter="0"bottom="25"fontFamily="desc_font"size="32"textColor="0xb4925c"x="123"y="253"scaleX="1"scaleY="1"cbae:Imageid="hasBuyIcon"source="bg_shop_dg"left="80"bottom="45"cbace:Groupbae:Labelid="limitClassTips"text="0阶竞技场可购买"horizontalCenter="0"bottom="25"fontFamily="main_font"textColor="0x7a7a7a"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopKaPaiPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagesource="商店03_卡牌_jpg"cb--bae:ImageanchorOffsetY="0"height="40"anchorOffsetX="0"width="583.5"top="67"horizontalCenter="67"source="home_ui_common_json.bg_notice"scale9Grid="7,7,199,22"cbae:Scrollerwidth="1000"height="571"x="250"anchorOffsetX="0"anchorOffsetY="0"y="117"bae:Listid="list"itemRendererSkinName="ShopKaPaiItemSkin"bae:ArrayCollectionbae:Arrayba!--ae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cbae:Objectnull=""cb--bace:Arraybace:ArrayCollectionbae:layoutbae:TileLayoutverticalGap="28"horizontalGap="30"paddingTop="0"requestedColumnCount="3"cbace:layoutbace:Listbace:Scrollerbae:Labeltext="卡牌在每天6:00、12:00、18:00、24:00刷新"fontFamily="desc_font"size="26"top="76"horizontalCenter="68.5"textColor="0xc4d0d0"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopLeftItemSkin"width="320"height="100"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Groupid="root"width="320"height="100"x="0"y="0"bans1:SGroupid="scaleRoot"width="320"height="100"horizontalCenter="0"verticalCenter="0"bae:Imageid="clickBg"source="common_ui_playericon_json.bg_phb_heroicon"scale9Grid="18,22,61,56"width="320"height="100"verticalCenter="0"horizontalCenter="0"cbae:Labelid="shopName"text="尊享宝箱"fontFamily="main_font"size="30"stroke="1"anchorOffsetX="0"width="231.5"anchorOffsetY="0"height="30"border="false"bold="false"scaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"textColor="0x000000"strokeColor="0xffffff"textAlign="center"cbae:Labelid="saleLabel"text="特惠周"x="17"y="15"textColor="0xff0000"strokeColor="0x000000"stroke="0"fontFamily="desc_font"size="26"cbans1:SGroupid="clickBtn"width="320"height="100"x="0"y="0"bacns1:SGroupbacns1:SGroupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopPriceBtnSkin"width="350"height="60"currentState="normal"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"xmlns:w="http:ccns.egret.comcwing"states="normal,sales,free"bans1:SGroupid="root"width="350"height="60"anchorOffsetY="0"horizontalCenter="0"verticalCenter="0"bae:Imagesource="common_ui_common_json.icon_hotpoint"width="350"height="60"scale9Grid="8,8,2,2"alpha="0.5"y="0"x="0"cbae:Groupid="priceInfo"width="350"height="60"x="0"y="0"visible.free="false"bae:Imagesource="home_ui_common_json.bg_exp"x="7.5"y="5.5"scale9Grid="26,5,22,35"scaleX="0.5"anchorOffsetX="0"width="128"scaleY="1"cbae:Imageid="costIcon"source="home_ui_common_json.icon_top_diamond"x="10"y="0"scaleX="1"scaleY="1"cbans1:SInputLabelid="oldPrice"text="750"x="94"y="15"fontFamily="desc_font"size="26"textColor="0x000000"visible.normal="false"verticalCenter.sales="0"scaleX="1"scaleY="1"cbans1:SInputLabelid="newPrice"text="600"x="210"y="15"fontFamily="desc_font"size="26"textColor="0x000000"x.normal="162"verticalCenter.normal="0"verticalCenter.sales="0"scaleX="1"scaleY="1"cbace:Groupbans1:SInputLabelid="warnLabel"text="解锁3阶竞技场可购买"fontFamily="desc_font"size="26"textColor="0xff0000"horizontalCenter="0"verticalCenter="0"visible.free="false"cbae:Labelid="freeLabel"text="免费"includeIn="free"y="16"horizontalCenter="0"fontFamily="desc_font"textColor="0x17ff00"cbacns1:SGroupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopQuickBuyItemBtnSkin"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"xmlns:w="http:ccns.egret.comcwing"states="buyGold,buyDimand"bans1:SButtonlabel=""skinName="Btn1Skin"icon="button_ty_yellow"height="62"width="142"cbae:Groupheight="45"touchEnabled="false"touchChildren="false"verticalCenter="0"horizontalCenter="0"bae:Imageid="costIcon"x="37"y="29"width="45"height="45"source="item_3"includeIn="buyGold"cbae:Labelid="labelDisplay"text="000"x="126"y="43"size="24"textColor="0x4193D2"fontFamily="main_font"textColor.buyDimand="0xc17c1a"textColor.buyGold="0x4193d2"cbae:layoutbae:HorizontalLayoutverticalAlign="middle"gap="-6"cbace:layoutbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopQuickBuyItemSkin"width="142"height="206"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagesource="商店08-弹窗购买钻石_jpg"x="-415"y="-286.5"visible="false"cb--bae:Imagesource="bg_grzl_di_gz02"scale9Grid="21,21,8,18"left="0"right="0"top="0"bottom="0"cbans1:SButtonid="buyBtn"label=""icon="button_ty_yellow"height="62"horizontalCenter="0"width="142"verticalCenter="75"skinName="ShopQuickBuyItemBtnSkin"cbae:Imagesource="bg_bag_gz"scale9Grid="20,15,55,60"horizontalCenter="0"verticalCenter="-36"cbae:Imageid="iconImg"horizontalCenter="0"verticalCenter="-38"scaleX="0.5"scaleY="0.5"source=""cbae:Labelid="itemCount"text=""y="116"size="24"textColor="0x4193D2"fontFamily="main_font"horizontalCenter="0.5"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ShopQuickBuyWinSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"ba!--ae:Imagesource="商店08-弹窗购买钻石_jpg"cb--bae:Imageid="bg"source="bg_black"left="0"right="0"top="0"bottom="0"alpha="0.7"x="-372"y="-78"scaleX="1"scaleY="1"cbae:Groupwidth="535"height="362"horizontalCenter="0"verticalCenter="0"bagame:CommonWinid="comWin"skinName="CommonWinSkin"scaleX="1"scaleY="1"left="0"right="0"top="0"bottom="0"cbae:Labelid="tips"text="你没有足够的金币，请先去购买"fontFamily="desc_font"touchEnabled="false"horizontalCenter="0.5"x="183"y="72.65"scaleX="1"scaleY="1"size="26"textColor="0xba8048"cbae:Groupy="116"scaleX="1"scaleY="1"horizontalCenter="0.5"touchEnabled="false"bagame:ShopQuickBuyItemid="item1"x="86"y="71"skinName="ShopQuickBuyItemSkin"cbagame:ShopQuickBuyItemid="item2"x="96"y="81"skinName="ShopQuickBuyItemSkin"cbagame:ShopQuickBuyItemid="item3"x="106"y="91"skinName="ShopQuickBuyItemSkin"cbae:layoutbae:HorizontalLayoutcbace:layoutbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ZXBXDetailSkin"width="880"height="520"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"xmlns:ns1="*"ba!--ae:Groupid="root"width="880"height="520"x="0"y="0"bae:Groupwidth="880"height="520"x="0"y="0"bagame:ZXBXItemid="itemInfo"x="0"y="0"skinName="ZXBXItemSkin"scaleX="1"scaleY="1"cbagame:CommonItemid="itemDetail"x="440.00000000000006"y="0"skinName="ZXBXItemDetailSkin"scaleX="1"scaleY="1"cbans1:SButtonid="closeBtn"label=""scaleX="2"scaleY="2"rotation="45"x="838"y="0"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="home_ui_common_json.button_top_add"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Groupbace:Groupb--bace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ZXBXInfoSkin"width="880"height="600"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="880"height="600"x="0"y="0"bae:Groupid="saleTips"width="650.97"height="66.67"y="0"anchorOffsetY="0"anchorOffsetX="0"x="115"bae:Labelid="saleLabel"text="特惠周剩余6天"y="30.099999999999994"size="24"scaleX="1"scaleY="1"fontFamily="desc_font"textColor="0xFF0000"textAlign="center"horizontalCenter="0"cbae:Imageid="saleImg"y="24.60000000000001"scaleX="1"scaleY="1"source="home_ui_common_json.icon_ss_pws_sz"x="211"width="30"height="30"cbace:Groupbae:Scrollerid="game_list_scroller"width="880"height="520"x="0"y="80"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"bae:Listid="game_list"xmlns:ns1="*"x="39.39"y="-278.79"anchorOffsetY="0"cbace:Scrollerbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ZXBXItemDetailSkin"width="440"height="520"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"ba!--ae:Groupid="root"width="440"height="520"bae:Imagesource="common_ui_common_json.icon_hotpoint_s"x="0"y="0"scale9Grid="10,8,13,15"width="440"height="520"alpha="0.5"cbae:Labeltext="至少包含"y="67"horizontalCenter="0"fontFamily="main_font"stroke="0"textColor="0x000000"cbae:Groupid="card1Info"width="300"height="50"y="140"anchorOffsetY="0"horizontalCenter="0"bae:Imagesource="home_ui_common_json.bg_exp_nr"x="0"scale9Grid="25,4,152,31"width="49"scaleX="1"scaleY="1"verticalCenter="0"cbae:Labelid="count1Label"text="稀有卡牌x10"x="78"verticalCenter="0"size="26"fontFamily="desc_font"textColor="0xd600ff"cbace:Groupbae:Groupid="card2Info"width="300"height="50"y="200"anchorOffsetY="0"horizontalCenter="0"bae:Imagesource="home_ui_common_json.bg_exp_nr"x="0"scale9Grid="25,4,152,31"width="49"scaleX="1"scaleY="1"verticalCenter="0"cbae:Labelid="count2Label"text="史诗卡牌x10"x="78"verticalCenter="0"size="26"fontFamily="desc_font"textColor="0xff5100"cbace:Groupbae:Groupid="card3Info"width="300"height="50"y="260"anchorOffsetY="0"horizontalCenter="0"bae:Imagesource="home_ui_common_json.bg_exp_nr"x="0"scale9Grid="25,4,152,31"width="49"scaleX="1"scaleY="1"verticalCenter="0"cbae:Labelid="count3Label"text="传奇卡牌x10"x="78"verticalCenter="0"size="26"fontFamily="desc_font"textColor="0xc1ff00"cbace:Groupbans1:SGroupid="buy1Btn"width="300"height="60"anchorOffsetY="0"horizontalCenter="0"verticalCenter="93"bae:Imagesource="common_ui_common_json.bg_blue_00"x="0"y="0"width="300"height="60"scale9Grid="1,1,2,2"alpha="0.6"cbae:Imageid="itemIcon0"source="home_ui_common_json.icon_top_coin"x="20"verticalCenter="0"y="-92"scaleX="1"scaleY="1"cbae:Labelid="itemCount0"text="500单次"x="150"fontFamily="desc_font"size="26"textColor="0x000000"verticalCenter="0"y="-76"scaleX="1"scaleY="1"cbacns1:SGroupbans1:SGroupid="buy10Btn"width="300"height="60"anchorOffsetY="0"horizontalCenter="0"verticalCenter="170"bae:Imagesource="common_ui_common_json.bg_blue_00"x="0"y="0"width="300"height="60"scale9Grid="1,1,2,2"alpha="0.6"cbae:Imagesource="home_ui_common_json.icon_top_coin"x="20"id="itemIcon1"verticalCenter="0"y="-92"scaleX="1"scaleY="1"cbae:Labeltext="4500十次"x="150"fontFamily="desc_font"size="26"textColor="0x000000"id="itemCount1"verticalCenter="0"y="-76"scaleX="1"scaleY="1"cbacns1:SGroupbace:Groupb--bace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="ZXBXItemSkin"width="440"height="520"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"xmlns:game="game.*"bae:Groupid="root"width="440"height="520"bae:Imagesource="common_ui_common_json.icon_hotpoint_s"x="0"y="0"scale9Grid="10,8,13,15"width="440"height="520"alpha="0.5"cbae:Imagesource="common_ui_common_json.bg_card_di_0"y="0"anchorOffsetX="0"width="385.81"scale9Grid="13,15,78,96"horizontalCenter="0"anchorOffsetY="0"height="104.79"cbae:Labelid="nameLabel"text="8阶王者宝箱"y="35"horizontalCenter="0"fontFamily="main_font"textColor="0xff0000"stroke="1"cbae:Imagesource="common_ui_common_json.bg_skill_k"x="20"y="105"scale9Grid="34,35,17,7"width="400"height="400"cbae:Imagesource="kingtower_99010_png"y="105"width="300"height="300"horizontalCenter="0"cbagame:CommonItemid="rewardInfo"y="373"horizontalCenter="0"width="350"height="60"bagame:skinNamebae:Skinwidth="350"height="60"currentState="item1"states="item1,item2"bans1:SGroupwidth="350"height="60"y="0"anchorOffsetY="0"horizontalCenter="0"bae:Imagesource="home_ui_common_json.icon_top_coin"x="20"id="itemIcon0"verticalCenter="0"verticalCenter.item1="0"x.item1="108"cbae:Labeltext="x250"x="90"fontFamily="desc_font"size="26"textColor="0x000000"id="itemCount0"verticalCenter="0"verticalCenter.item1="0"x.item1="178"cbae:Imagesource="home_ui_common_json.icon_top_coin"x="200"id="itemIcon1"verticalCenter="0"visible.item1="false"cbae:Labeltext="x2500"x="270"fontFamily="desc_font"size="26"textColor="0x000000"id="itemCount1"verticalCenter="0"visible.item1="false"cbacns1:SGroupbace:Skinbacgame:skinNamebacgame:CommonItembagame:CommonItemid="buyInfo"horizontalCenter="0"y="433"bagame:skinNamebae:Skinwidth="350"height="60"currentState="normal"states="normal,sales"bans1:SGroupid="root"width="350"height="60"anchorOffsetY="0"horizontalCenter="0"verticalCenter="0"bae:Imagesource="common_ui_common_json.icon_hotpoint"width="350"height="60"scale9Grid="8,8,2,2"alpha="0.5"y="0"x="0"cbae:Groupid="priceInfo"width="350"height="60"x="0"y="0"bae:Imagesource="home_ui_common_json.bg_exp"x="7.5"y="5.5"scale9Grid="26,5,22,35"scaleX="0.5"anchorOffsetX="0"width="128"scaleY="1"cbae:Imageid="costIcon"source="home_ui_common_json.icon_top_diamond"x="10"y="0"scaleX="1"scaleY="1"cbans1:SInputLabelid="oldPrice"text="750"x="94"y="15"fontFamily="desc_font"size="26"textColor="0x000000"visible.normal="false"verticalCenter.sales="0"scaleX="1"scaleY="1"cbans1:SInputLabelid="newPrice"text="600"x="210"y="15"fontFamily="desc_font"size="26"textColor="0x000000"x.normal="162"verticalCenter.normal="0"verticalCenter.sales="0"scaleX="1"scaleY="1"cbace:Groupbans1:SInputLabelid="warnLabel"text="解锁3阶竞技场可购买"fontFamily="desc_font"size="26"textColor="0xff0000"horizontalCenter="0"verticalCenter="0"cbacns1:SGroupbace:Skinbacgame:skinNamebacgame:CommonItembace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="AttrInfoItemSkin"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"width="235"height="60"ba!--ae:Imagey="-325.25"x="-394.75"source="卡组04-01军队可升级_jpg"visible="false"cb--bae:Imageid="bg"scale9Grid="6,7,9,45"anchorOffsetX="0"touchEnabled="false"scaleX="1"scaleY="1"left="0"right="0"top="0"bottom="0"source="bg_kz_kpxx_szd01"cbae:Imageid="icon"touchEnabled="false"source="home_ui_common_json.icon_kpsx_09"left="10"verticalCenter="0"cbae:Labelid="attrName"text="属性"fontFamily="desc_font"size="22"textColor="0x966C50"touchEnabled="false"scaleX="1"scaleY="1"left="72"top="6"cbae:Grouptop="32"left="72"bae:Labelid="attrValue"text="000"fontFamily="main_font"size="26"touchEnabled="false"scaleX="1"scaleY="1"textColor="0xad5907"left="0"cbae:Labelid="addAttrValue"text=""fontFamily="main_font"size="26"touchEnabled="false"scaleX="1"scaleY="1"left="0"x="10"y="10"textColor="0x3da154"cbae:layoutbae:HorizontalLayoutcbace:layoutbace:Groupbans1:SButtonid="infoBtn"label=""scaleX="0.8"scaleY="0.8"x="210"anchorOffsetX="26"anchorOffsetY="27"verticalCenter="0"visible="false"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="button_kp_xx"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="AttrTipsItemSkin"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"minHeight="148"width="1280"height="720"bae:Groupid="bg"left="0"right="0"top="0"bottom="0"cbae:Groupid="contentGroup"width="536"bottom="0"left="0"bae:Imagesource="home_ui_kz_json.bg_lz_tc02"anchorOffsetX="0"scale9Grid="24,26,22,23"left="0"right="0"top="0"bottom="0"scaleX="1"scaleY="1"cbae:Imagesource="home_ui_kz_json.bg_lz_tc02_jt"bottom="-19"y="264"scaleX="1"scaleY="1"horizontalCenter="0"cbae:Labelid="heroName"text="弓箭手"x="28.04"y="27"fontFamily="desc_font"textColor="0xbc5612"size="24"cbae:Groupid="attrGroup"top="68"bottom="30"left="30"right="30"maxWidth="476"bae:layoutbae:TileLayoutrequestedColumnCount="2"horizontalAlign="left"cbace:layoutbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="CampViewSkin"currentState="hasCamp"xmlns:e="http:ccns.egret.comceui"states="hasCamp,noCamp"width="122"height="44"bae:Imageid="campBg"touchEnabled="false"scaleX="0.88"scaleY="0.88"source="home_ui_kz_json.bg_cz_sid"scale9Grid="6,4,7,29"height="40"anchorOffsetX="0"width="111.18"verticalCenter="-0.5"x="23.31"includeIn="hasCamp"cbae:Imageid="camp"touchEnabled="false"source="home_ui_kz_json.icon_sl_01_s"scaleX="0.88"scaleY="0.88"verticalCenter="0"includeIn="hasCamp"cbae:Labelid="campName"text="中立"fontFamily="desc_font"anchorOffsetX="0"bold="true"size="24"scaleX="1"scaleY="1"touchEnabled="false"anchorOffsetY="0"textColor="0xC08829"y="9.99"textAlign.hasCamp="center"width.hasCamp="100"x.hasCamp="27.36"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="DrowMenuItemSkin"currentState="active"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"minHeight="46"states="common,active"bae:Imageid="bg"source="home_ui_jd_json.bg_jd_topt_04"left="-4"right="-4"top="-4"bottom="-4"includeIn="active"scale9Grid="12,9,23,25"cbae:Labelid="showlabel"text="Label"scaleX="1"scaleY="1"anchorOffsetX="0"left="0"right="0"textAlign="center"size="20"verticalAlign="middle"top="0"bottom="0"fontFamily="desc_font"textColor.common="0x48bd9d"textColor.active="0x69f6d0"alpha="0.9"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="DrowMenuSkin"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"width="154"bae:Imageid="bg"source="home_ui_jd_json.bg_jd_topt_03"scale9Grid="12,9,23,25"left="0"right="0"top="0"bottom="-5"alpha="0.9"cbae:Buttonid="showBtn"label="Button"skinName="Btn4Skin"left="0"right="0"top="0"cbae:Imageid="selectImg"source="home_ui_jd_json.bg_jd_topt_04"left="0"scale9Grid="12,9,23,25"height="40"y="32"right="0"cbae:Groupid="menuGroup"y="37"left="0"right="0"touchEnabled="false"ba!--ae:Labeltext="选项1"textColor="0x69F6D0"size="20"fontFamily="desc_font"left="5"textAlign="center"height="30"verticalAlign="middle"cbae:Labeltext="选项1"textColor="0x69F6D0"size="20"fontFamily="desc_font"left="5"textAlign="center"height="30"verticalAlign="middle"cbae:Labeltext="选项1"textColor="0x69F6D0"size="20"fontFamily="desc_font"left="5"textAlign="center"height="30"verticalAlign="middle"cb--bae:layoutbae:VerticalLayouthorizontalAlign="center"cbace:layoutbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="HeroInfoPanel2Skin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"xmlns:ns1="*"bae:Groupid="root"left="0"right="0"top="0"bottom="0"cba!--ae:Imagesource="卡组04-05军队未获得_jpg"visible="false"cb--bae:GrouptouchEnabled="false"width="535"height="638"horizontalCenter="0.5"verticalCenter="25"bae:Imagesource="home_ui_kz_json.bg_lz_tc"anchorOffsetX="0"anchorOffsetY="0"height="638"touchEnabled="true"scale9Grid="39,37,34,26"left="0"right="0"cbae:Imagex="246"y="70"source="home_ui_kz_json.bg_kz_kpxx_szd01"scale9Grid="6,7,9,45"anchorOffsetX="0"anchorOffsetY="0"touchEnabled="false"height="82"width="260"cbae:Imagex="25"y="54"source="home_ui_task_json.bg_re_lb_xx"width="485"touchEnabled="false"cbae:Imagey="535.32"source="home_ui_task_json.bg_re_lb_xx"width="485"touchEnabled="false"horizontalCenter="0"cbae:Scrollerwidth="280"height="81.33"x="243.5"y="165.31"anchorOffsetX="0"anchorOffsetY="0"scrollPolicyH="off"bae:GroupanchorOffsetX="0"x="-10"bae:Labelid="desc"text=""fontFamily="desc_font"textColor="0x9B6A43"anchorOffsetX="0"textAlign="left"touchEnabled="false"scaleX="1"scaleY="1"size="22"left="0"right="0"top="0"bottom="0"lineSpacing="8"cbace:Groupbace:Scrollerbae:Groupid="tipGroup"x="324"y="561"bae:Imagesource="home_ui_kz_json.bg_kz_kpxx_szd01"scale9Grid="6,7,9,45"anchorOffsetX="0"anchorOffsetY="0"touchEnabled="false"height="50"width="150"scaleX="1"scaleY="1"x="0"cbae:Imagesource="home_ui_common_json.icon_top_exp"scaleX="0.5"scaleY="0.5"touchEnabled="false"x="29"y="20"cbae:BitmapLabelid="addExp"height="20"anchorOffsetX="0"anchorOffsetY="0"text="+000"scaleX="0.7"scaleY="0.7"font="exp_num_font_fnt"letterSpacing="-2"textAlign="center"touchEnabled="false"x="66"y="26"cbae:Labeltext="升级可获得"fontFamily="desc_font"textColor="0x9B6A43"anchorOffsetX="0"textAlign="left"size="18"scaleX="1"scaleY="1"touchEnabled="false"anchorOffsetY="0"x="33"y="3"cbace:Groupba!--ae:Groupid="lbGroup"touchEnabled="false"touchChildren="false"b--bae:Labelid="title"text="我是标题11"y="18.63"fontFamily="main_font"anchorOffsetX="0"width="506"textAlign="center"touchEnabled="false"textColor="0x327fb0"size="28"scaleX="1"scaleY="1"horizontalCenter="0.5"cbae:Labeltext="阵营"fontFamily="desc_font"textColor="0x9B6A43"anchorOffsetX="0"textAlign="left"size="24"scaleX="1"scaleY="1"y="76"touchEnabled="false"x="263.12"anchorOffsetY="0"cbae:Labeltext="品质"fontFamily="desc_font"textColor="0x9B6A43"anchorOffsetX="0"textAlign="left"size="24"scaleX="1"scaleY="1"y="76"touchEnabled="false"x="395.47"anchorOffsetY="0"cbae:Labelid="quality"text=""fontFamily="desc_font"anchorOffsetX="0"textAlign="left"bold="true"size="24"scaleX="1"scaleY="1"touchEnabled="false"anchorOffsetY="0"textColor="0x327fb0"y="115.99"x="397.99"cba!--ace:Groupb--bagame:HeroKaid="heroInfo"x="24.66"y="64.99"skinName="HeroKa1Skin"cbagame:HeroInfoUpgradeBtnid="upgradeBtn"height="66"skinName="HeroInfoUpgradeBtnSkin"y="589"anchorOffsetX="75"anchorOffsetY="33"touchEnabled="true"touchChildren="false"horizontalCenter="0"cbae:Groupid="attrGroup"height="260"y="257"anchorOffsetX="0"anchorOffsetY="0"horizontalCenter="0.5"bae:layoutbae:TileLayoutrequestedColumnCount="2"cbace:layoutba!--agame:AttrInfoItemx="-6"y="68"skinName="AttrInfoItemSkin"cbagame:AttrInfoItemx="4"y="78"skinName="AttrInfoItemSkin"cbagame:AttrInfoItemx="14"y="88"skinName="AttrInfoItemSkin"cbagame:AttrInfoItemx="24"y="98"skinName="AttrInfoItemSkin"cbagame:AttrInfoItemx="34"y="108"skinName="AttrInfoItemSkin"cbagame:AttrInfoItemx="44"y="118"skinName="AttrInfoItemSkin"cbagame:AttrInfoItemx="54"y="128"skinName="AttrInfoItemSkin"cbagame:AttrInfoItemx="64"y="138"skinName="AttrInfoItemSkin"cb--bace:Groupbagame:AttrTipsItemid="attrTips"skinName="AttrTipsItemSkin"visible="false"cbagame:ProgressExpid="progExp"x="36.5"y="205"skinName="ProgressExpSkin"cbae:Buttonid="camp"label="Button"x="264"y="106"skinName="CampViewSkin"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="HeroInfoWin1Skin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Groupid="root"left="0"right="0"top="0"bottom="0"bae:Rectleft="0"right="0"top="0"bottom="0"alpha="0.3"cbae:Labelid="heroName"text="heroName"horizontalCenter="0"verticalCenter="0"cbans1:SButtonid="cloBtn"label="close"x="874"y="142"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="HeroKa1Skin"currentState="common"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"width="216"height="141"states="common,shopItem,simple,replay"ba!--ae:Imagex="-800.98"y="-134.15"source="卡组01_主_jpg"visible="false"cb--bae:Imageid="bg"horizontalCenter="0"verticalCenter="0"source="bg_card_di_0"touchEnabled="false"touchEnabled.replay="true"cbae:Imageid="heroIcon"horizontalCenter="0"verticalCenter="-3"source=""width="188"height="110"touchEnabled="false"cbae:Imageid="campBg"source="icon_kz_sl_d"left="2"touchEnabled="false"includeIn="common,shopItem,replay"scale9Grid="5,6,32,27"height="84"y="8.43"visible.replay="false"cbae:Imagey="2.61"source="icon_sh_d"left="4"touchEnabled="false"includeIn="common,shopItem,replay"visible.replay="false"cbae:Imageid="upTips"source="icon_kz_sjjt"right="7"touchEnabled="false"bottom="16"visible="false"cbae:Imageid="typeIcon"y="51.82"scaleX="0.7"scaleY="0.7"source="icon_sl_01_s"left="6"touchEnabled="false"includeIn="common,shopItem,replay"visible.replay="false"cbae:BitmapLabelid="cost"y="14.36"font="sh_font_fnt"text="3"left="8"touchEnabled="false"includeIn="common,shopItem,replay"visible.replay="false"cbagame:HeroLevelid="level"y="99.92"skinName="HeroLevelSkin"left="10"touchChildren="false"includeIn="common,replay"scaleX.replay="2"scaleY.replay="2"left.replay="17"y.replay="74.92"cbae:Labelid="testId"text="Label"y="57"horizontalCenter="0"stroke="2"touchEnabled="false"visible.replay="false"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="HeroKa2Skin"width="235"height="310"xmlns:e="http:ccns.egret.comceui"xmlns:ns1="*"xmlns:w="http:ccns.egret.comcwing"ba!--ae:Imagesource="卡组02_jpg"x="-997.37"y="-76.72"visible="false"cb--bae:Imageid="bg"source="home_ui_kz_json.bg_lz_tc_lzd"left="10"top="5"bottom="27"right="10"cbae:Imageid="leaderImg"touchEnabled="false"left="15"top="8"bottom="75"right="14"source=""cbae:Imagesource="home_ui_kz_json.bg_sl_01"height="90"anchorOffsetX="0"touchEnabled="false"scaleX="0.85"scaleY="0.85"scale9Grid="13,19,15,39"left="15"right="15"bottom="33"cbae:Imagesource="bg_lz_tc_lzd_k"scale9Grid="18,12,43,48"left="10"right="10"top="2"bottom="30"cbae:Imageid="typeIcon"touchEnabled="false"source="home_ui_kz_json.icon_sl_01_s"scaleX="0.85"scaleY="0.85"left="20"bottom="62"cbae:Imageid="czImg"height="53"source="home_ui_kz_json.icon_czz_wz_lz"scale9Grid="6,6,38,38"anchorOffsetX="0"anchorOffsetY="0"touchEnabled="false"width="132"bottom="9"horizontalCenter="0"cbae:Groupid="selImg"touchChildren="false"touchEnabled="false"left="2"right="2"top="-2"bottom="20"bae:Imagesource="common_ui_common_json.bg_xz_fkj"left="0"top="0"cbae:Imagesource="common_ui_common_json.bg_xz_fkj"scaleX="-1"right="0"top="0"cbae:Imagesource="common_ui_common_json.bg_xz_fkj"scaleY="-1"left="0"bottom="0"cbae:Imagesource="common_ui_common_json.bg_xz_fkj"scaleY="-1"scaleX="-1"right="0"bottom="0"cbace:Groupbans1:SButtonid="chuzhan"label="出战"horizontalCenter="0.5"icon="button_ty_yellow"skinName="Btn1Skin"bottom="9"cbans1:SButtonid="infoBtn"label=""horizontalCenter="74.5"verticalCenter="-115"bans1:skinNamebae:Skinstates="up,down,disabled"xmlns:game="game.*"bae:Imagewidth="100%"height="100%"source="home_ui_common_json.button_kp_xx"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Labelid="czLb"text="出战中"touchEnabled="false"fontFamily="main_font"italic="true"size="22"textColor="0xffffff"horizontalCenter="-0.5"bottom="24"cbae:Labelid="leaderName"text="神主99020"touchEnabled="false"fontFamily="main_font"size="24"strokeColor="0x835a2d"width="159.6"textAlign="center"anchorOffsetX="0"verticalAlign="middle"bottom="71"textColor="0xbf6902"horizontalCenter="15.5"cbae:Labelid="testId"text="Label"horizontalCenter="0"stroke="2"top="80"visible="false"cbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="HeroKa3Skin"width="268"height="237"currentState="common"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"xmlns:ns1="*"states="common,active"bae:Imagewidth="210"height="132"y="10"source="bg_kp_dcs"includeIn="common"scale9Grid="11,10,28,29"horizontalCenter="-1"cba!--ae:Imagey="-233.85"x="-242.75"source="卡组03-02更换卡组_jpg"source.common="卡组03-更换军队_主_jpg"visible.common="false"visible.active="false"visible="false"cb--bae:Imagesource="home_ui_kz_json.bg_lz_tc02"scale9Grid="24,23,25,25"anchorOffsetX="0"height="237"includeIn="active"touchEnabled="false"width="268"horizontalCenter="0"cbagame:HeroKa1id="heroKa"x.active="20.5"y.active="14.32"skinName="HeroKa1Skin"scaleX.common="1"scaleY.common="1"y.common="8"y="8.01"touchEnabled.common="true"touchChildren.common="false"touchChildren.active="false"touchEnabled.active="false"x.common="26"horizontalCenter="0"scaleX.active="1.1"scaleY.active="1.1"horizontalCenter.active="0"cbans1:SButtonid="infoBtn"label="信息"y="162.69"anchorOffsetX="0"width="118"height="60"includeIn="active"touchChildren="false"touchEnabled="true"horizontalCenter="-60"name="infoBtn"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_blue"source.down="common_ui_common_json.button_ty_blue"cbae:Imagesource="home_ui_kz_json.button_kz_xx"horizontalCenter="-1"verticalCenter="-5"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="czBtn"label="出战"y="162.69"anchorOffsetX="0"width="118"height="60"includeIn="active"touchChildren="false"horizontalCenter="60"name="czBtn"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_yellow"source.down="common_ui_common_json.button_ty_yellow"cbae:Imagesource="home_ui_kz_json.button_kz_cz"horizontalCenter="0"verticalCenter="-5"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Groupid="cannotUseStip"y="64.99"horizontalCenter="0.5"includeIn="common"touchChildren="false"touchEnabled="false"visible="false"bae:Imagesource="bg_kz_bky"cbae:Labeltext="不可用"horizontalCenter="0"size="24"verticalCenter="0"fontFamily="desc_font"textColor="0xef5050"stroke="1"strokeColor="0x702e2e"cbace:Groupbace:Skinba!--信息&&出战按钮的文字配置ae:Imagesource="home_ui_kz_json.button_kz_xx"horizontalCenter="-1"verticalCenter="-5"cbae:Imagesource="home_ui_kz_json.button_kz_cz"horizontalCenter="0"verticalCenter="-5"cb--ba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="Heroka5Skin"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"height="114"width="180"states="common,done"ba!--ae:Imagesource="家族13-商店05_jpg"x="-370"y="-190"visible="false"cb--bae:Imageid="kapaiBg"touchEnabled="false"source="bg_shop_card_di_0"scaleX="0.8"scaleY="0.8"x="5.75"y="-0.5"cbagame:HeroKa1id="heroKa"skinName="HeroKa1Skin"touchChildren="false"touchEnabled="false"scaleX="0.8"scaleY="0.8"y="1.32"currentState="shopItem"cbae:Labelid="kaCount"text="X2"fontFamily="main_font"size="32"textColor="0xFFFFFF"strokeColor="0x327FB0"stroke="2"touchEnabled="false"scaleX="1"scaleY="1"y="79.34"x="121.33"cbae:Imagesource="bg_jz_shop_ylh_yh"x="1"alpha="0.4"includeIn="done"cbae:GrouphorizontalCenter="0"verticalCenter="0"includeIn="done"bae:Imagesource="bg_jz_shop_ylh_di"scale9Grid="20,4,120,26"left="0"right="0"top="0"bottom="0"cbae:Labeltext="已炼化"stroke="2"strokeColor="0x336393"textColor="0x46dcf5"fontFamily="desc_font"horizontalCenter="0"verticalCenter="0"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="LeaderInfoPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"ba!--ae:Imagesource="军队05_jpg"x="2.5"cb--bae:Groupid="root"width="1280"x="0"height="720"y="0"bae:Imagey="64"source="home_ui_kz_json.bg_lz_tc"anchorOffsetX="0"width="535"anchorOffsetY="0"height="644"touchEnabled="false"scale9Grid="33,33,49,27"horizontalCenter="0"cbae:Imagey="130"source="home_ui_task_json.bg_re_lb_xx"width="470"touchEnabled="false"horizontalCenter="0"cbae:Imagey="430.82"source="home_ui_task_json.bg_re_lb_xx"width="470"touchEnabled="false"horizontalCenter="0"cbae:Imagey="476.82"source="home_ui_kz_json.bg_kz_kpxx_szd01"scale9Grid="6,7,9,45"anchorOffsetX="0"width="482"anchorOffsetY="0"height="204"touchEnabled="false"horizontalCenter="0"cbae:Imagex="402.01"y="141.94"source="home_ui_kz_json.bg_lz_tc_lzd"scale9Grid="26,34,163,210"touchEnabled="false"scaleX="0.97"scaleY="0.97"cbae:Imageid="heroIcon"x="407.6"y="147.87"source="common_ui_kingtowerhalf_json.king_99010"width="206"height="227"touchEnabled="false"cbae:Imagex="409.6"y="148"source="home_ui_common_json.icon_top_exp"touchEnabled="false"cbae:Imagex="408"y="349.73"source="home_ui_kz_json.bg_sl_01"scaleX="0.75"scaleY="0.75"width="274"touchEnabled="false"scale9Grid="21,14,13,42"height="88"cbae:Imageid="camp"x="439.18"y="360.98"source="home_ui_kz_json.icon_sl_01_s"width="42"height="42"touchEnabled="false"cbagame:AttrInfoItemid="attr1"skinName="AttrInfoItemSkin"y="147.34"x="636.65"width="238"height="59"cbagame:AttrInfoItemid="attr2"skinName="AttrInfoItemSkin"y="217.34"x="636.65"width="238"height="59"cbagame:AttrInfoItemid="attr3"skinName="AttrInfoItemSkin"y="287.34"x="636.65"width="238"height="59"cbagame:AttrInfoItemid="attr4"skinName="AttrInfoItemSkin"y="356.34"x="636.65"width="238"height="59"cbae:Labelid="title"text="6级亚瑟亚瑟"y="88"fontFamily="main_font"anchorOffsetX="0"width="510"textAlign="center"touchEnabled="false"size="32"horizontalCenter="0"textColor="0xbf6902"cbae:Labeltext="介绍"y="444.49"fontFamily="main_font"textColor="0x9B6A43"anchorOffsetX="0"textAlign="center"x="404.01"bold="true"touchEnabled="false"cbae:Labelid="campName"text="巨龙城"x="459.85"y="367.51"fontFamily="desc_font"size="28"bold="true"width="150"textAlign="center"touchEnabled="false"textColor="0xc29a43"cbae:Labelid="desc"text="所有法力消耗所有法力消耗所有法力消耗所有法力消耗所有法力消耗所有法力消耗所有法力消耗"fontFamily="desc_font"anchorOffsetX="0"textAlign="left"size="26"width="470"scaleX="1"scaleY="1"y="490.37"touchEnabled="false"anchorOffsetY="0"height="188"lineSpacing="8"textColor="0x966c50"horizontalCenter="0"cbae:Groupwidth="50"x="413.5"y="160.5"bae:BitmapLabelid="level"font="exp_lv_font_fnt"text="00"letterSpacing="-12"touchEnabled="false"scaleX="1.1"scaleY="1.1"horizontalCenter="0"verticalCenter="0"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="TeamPanelSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"ba!--ae:Imagesource="卡组04_jpg"cb--bae:Groupid="root"width="1280"x="0"height="720"y="0"bagame:MainPanelBgid="mainBg"skinName="MainPanelBgSkin"currentState="commonNoBg"cba!--ae:RectfillColor="0xffffff"left="0"right="0"top="0"bottom="0"cb这个作为调整kaBgGroup的工具--bae:Imagex="788.8"y="70"source="home_ui_kz_json.bg_com_fgd"anchorOffsetX="0"width="466"anchorOffsetY="0"height="628"scale9Grid="11,12,29,24"cbae:Groupx="802.53"y="135.49"id="kaBgGroup"bae:Imagesource="home_ui_kz_json.bg_kp_d"scale9Grid="16,17,25,18"anchorOffsetX="0"width="212"anchorOffsetY="0"height="132.8"scaleX="1"scaleY="1"cbae:Imagesource="home_ui_kz_json.bg_kp_d"scale9Grid="16,17,25,18"anchorOffsetX="0"width="212"anchorOffsetY="0"height="132.8"scaleX="1"scaleY="1"x="227.33"y="10"cbae:Imagesource="home_ui_kz_json.bg_kp_d"scale9Grid="16,17,25,18"anchorOffsetX="0"width="212"anchorOffsetY="0"height="132.8"scaleX="1"scaleY="1"x="20"y="140.4"cbae:Imagesource="home_ui_kz_json.bg_kp_d"scale9Grid="16,17,25,18"anchorOffsetX="0"width="212"anchorOffsetY="0"height="132.8"scaleX="1"scaleY="1"x="30"y="140.4"cbae:Imagesource="home_ui_kz_json.bg_kp_d"scale9Grid="16,17,25,18"anchorOffsetX="0"width="212"anchorOffsetY="0"height="132.8"scaleX="1"scaleY="1"x="40"y="278.8"cbae:Imagesource="home_ui_kz_json.bg_kp_d"scale9Grid="16,17,25,18"anchorOffsetX="0"width="212"anchorOffsetY="0"height="132.8"scaleX="1"scaleY="1"x="50"y="50"cbae:Imagesource="home_ui_kz_json.bg_kp_d"scale9Grid="16,17,25,18"anchorOffsetX="0"width="212"anchorOffsetY="0"height="132.8"scaleX="1"scaleY="1"x="60"y="416.66"cbae:Imagesource="home_ui_kz_json.bg_kp_d"scale9Grid="16,17,25,18"anchorOffsetX="0"width="212"anchorOffsetY="0"height="132.8"scaleX="1"scaleY="1"x="227.66"y="416.99"cbae:layoutbae:BasicLayoutcbace:layoutbace:Groupbae:Imagey="537.63"x="412.32"scaleX="1"scaleY="1"touchEnabled="false"source="role_yz"cbae:Imageid="leaderBg"source="bg_black"left="0"right="0"top="0"bottom="0"scale9Grid="2,2,16,16"alpha="0.3"visible="false"cba!--kingtower_99010_png--bae:Imageid="heroModel"y="98.77"x="167.05"scaleX="1"scaleY="1"touchEnabled="false"source=""cbae:Scrollerheight="575"x="13"anchorOffsetY="0"scrollPolicyH="off"anchorOffsetX="0"scaleX="1"scaleY="1"y="94"bae:Groupid="tabGroup"anchorOffsetY="0"touchEnabled="false"anchorOffsetX="0"ba!--agame:TeamTabskinName="TeamTabSkin"currentState="selected"cbagame:TeamTabskinName="TeamTabSkin"x="10"y="10"currentState="emptySel"cbagame:TeamTabskinName="TeamTabSkin"x="20"y="20"cbagame:TeamTabskinName="TeamTabSkin"x="30"y="30"currentState="empty"cbagame:TeamTabskinName="TeamTabSkin"x="40"y="40"currentState="lock"cbagame:TeamTabskinName="TeamTabSkin"x="50"y="50"currentState="lock"cb--bae:layoutbae:VerticalLayoutverticalAlign="justify"gap="6"cbace:layoutbagame:TeamTabx="8"y="156"skinName="TeamTabSkin"cbagame:TeamTabx="18"y="166"skinName="TeamTabSkin"cbagame:TeamTabx="28"y="176"skinName="TeamTabSkin"cbagame:TeamTabx="38"y="186"skinName="TeamTabSkin"cbagame:TeamTabx="48"y="196"skinName="TeamTabSkin"cbagame:TeamTabx="58"y="206"skinName="TeamTabSkin"cbace:Groupbace:Scrollerbans1:SButtonid="leaderBtn"label=""x="344.51"y="645.33"anchorOffsetX="68"anchorOffsetY="38"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="home_ui_kz_json.button_lz"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="teamBtn"label=""x="696.77"y="649.66"anchorOffsetX="68"anchorOffsetY="38"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="home_ui_kz_json.button_jd"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Groupid="selHeroWin"width="1280"x="0"height="720"y="0"bae:Rectid="selHeroBg"left="0"right="0"top="0"bottom="0"alpha="0"cbae:Imageid="selListBg"y="67.34"x="20"width="750"height="632"source="bg_phb_btdi_duan"scale9Grid="19,65,19,22"cbae:Imagey="347"x="791.98"source="home_ui_kz_json.bg_lz_tc_jt"scaleX="-1"scaleY="1"touchEnabled="false"cbae:Imagex="45"y="678.88"source="home_ui_task_json.bg_re_lb_xx"width="700"cbae:Labeltext="我的军队："x="33.5"fontFamily="desc_font"size="24"bold="true"scaleX="1"scaleY="1"verticalCenter="-266"textColor="0x25717c"cbae:Groupx="148.64"scaleX="1"scaleY="1"verticalCenter="-266"height="30"bae:BitmapLabelid="hasNum"x="8"y="2"font="card_num_font_fnt"text="00"scaleX="1"scaleY="1"cbae:BitmapLabelid="totalNum"x="58"text="!00"font="card_num_dark_fnt"scaleX="1"scaleY="1"letterSpacing="-2"bottom="-2"cbae:layoutbae:HorizontalLayoutgap="-2"verticalAlign="bottom"cbace:layoutbace:Groupbae:Scrollerwidth="790"height="551.67"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"y="126.11"bae:Groupid="selHeroGroup"anchorOffsetX="0"width="206"y="20"anchorOffsetY="0"height="533.67"touchEnabled="true"bae:layoutbae:BasicLayoutcbace:layoutba!--agame:HeroKa1skinName="HeroKa1Skin"cbagame:HeroKa1skinName="HeroKa1Skin"x="10"y="10"cbagame:HeroKa1skinName="HeroKa1Skin"x="20"y="20"cb--bace:Groupbace:Scrollerbagame:DrowMenuid="menu"y="74.49"skinName="DrowMenuSkin"left="591"cbae:Groupid="changeHeroGroup"left="0"right="0"top="0"bottom="0"touchEnabled="false"x="0"y="0"scaleX="1"scaleY="1"visible="false"bae:Imageid="changeHeroGroupBg"source="button_png"scale9Grid="19,6,115,36"alpha="1"scaleX="1"scaleY="1"left="0"right="0"top="0"bottom="0"cbagame:HeroKa1id="cKaHero"x="249.8"y="283.45"skinName="HeroKa1Skin"scaleX="1.48"scaleY="1.48"cbace:Groupbae:Labelid="noTips"text="您当前没有收集到更多的卡牌可使用"x="206"y="372"textColor="0x325b77"fontFamily="desc_font"size="24"visible="false"cbace:Groupbae:Groupid="heroGroup"anchorOffsetX="0"anchorOffsetY="0"x="801.33"y="124.01"bagame:HeroKa1x="0"skinName="HeroKa1Skin"cbagame:HeroKa1x="0"skinName="HeroKa1Skin"cbagame:HeroKa1x="10"skinName="HeroKa1Skin"y="10"cbagame:HeroKa1x="20"skinName="HeroKa1Skin"y="20"cbagame:HeroKa1x="30"skinName="HeroKa1Skin"y="30"cbagame:HeroKa1x="40"skinName="HeroKa1Skin"y="40"cbagame:HeroKa1x="50"skinName="HeroKa1Skin"y="50"cbagame:HeroKa1x="60"skinName="HeroKa1Skin"y="60"cbae:layoutbae:TileLayoutrowAlign="justifyUsingHeight"columnAlign="left"requestedColumnCount="2"paddingTop="10"horizontalGap="12"verticalGap="-2"cbace:layoutbace:Groupbae:Imageid="maskBg"x="788.8"y="69.6"source="home_ui_kz_json.bg_com_fgd"scale9Grid="6,6,42,38"anchorOffsetX="0"width="466"anchorOffsetY="0"height="629.6"touchEnabled="true"alpha="0"visible="false"cbae:Imagex="783.21"y="79.81"scale9Grid="10,14,28,29"anchorOffsetX="0"source="bg_kplb_bt"touchEnabled="false"cbae:Imagex="1129"y="79.96"source="common_ui_common_json.icon_sh_d"touchEnabled="false"cbae:BitmapLabelid="averageCost"x="1069.4"y="90.96"font="sh_font_fnt"text="4#6"scaleX="0.85"scaleY="0.85"letterSpacing="-6"touchEnabled="false"cbae:Labeltext="平均花费法力:"x="887.14"y="89.58"scaleX="1"scaleY="1"fontFamily="desc_font"size="28"touchEnabled="false"stroke="1"strokeColor="0x328190"textColor="0xffffff"cbagame:TeamSelLeaderWinid="selLeaderWin"skinName="TeamSelLeaderWinSkin"x="-1.52"visible="false"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="TeamSelLeaderWinSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"ba!--ae:Imagesource="卡组03-待添加选中03_jpg"visible="false"cb--bae:Groupid="root"width="1280"x="0"height="720"y="0"bae:Rectid="bg"alpha="0"left="0"right="0"top="0"bottom="0"cbae:Imagex="765"y="64"scaleX="1"scaleY="1"source="home_ui_kz_json.bg_lz_tc"anchorOffsetX="0"width="498"anchorOffsetY="0"height="645"scale9Grid="45,39,27,20"cbae:Imagex="743"y="355"source="home_ui_kz_json.bg_lz_tc_jt"cbae:Scrollerwidth="484.85"height="615.28"x="780"anchorOffsetX="0"anchorOffsetY="0"y="76.66"bae:Groupid="leaderGroup"anchorOffsetY="0"height="613.28"bagame:HeroKa2skinName="HeroKa2Skin"cbagame:HeroKa2skinName="HeroKa2Skin"x="10"y="10"cbagame:HeroKa2skinName="HeroKa2Skin"x="20"y="20"cbagame:HeroKa2skinName="HeroKa2Skin"x="30"y="30"cbagame:HeroKa2skinName="HeroKa2Skin"x="40"y="40"cbagame:HeroKa2skinName="HeroKa2Skin"x="50"y="50"cbae:layoutbae:TileLayouthorizontalGap="-4"verticalGap="-5"cbace:layoutbace:Groupbace:Scrollerbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="TeamTabSkin"width="246"height="91"currentState="common"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"states="common,selected,lock"ba!--ae:Imagey="-90.82"x="-12.97"y.common="-186.77"y.selected="-90.92"y.lock="-478.1"touchEnabled="false"source.selected="卡组01_jpg"source="卡组01_jpg"visible.common="false"visible.selected="false"cb--bae:Imagesource="button_kz_01"alpha="1"touchEnabled="false"source.common="home_ui_kz_json.button_kz_02"source.lock="home_ui_kz_json.button_kz_03"right.common="0"y.common="10.34"right="0"height="100"verticalCenter="0"cbae:Groupwidth="82"height="84"left="15"verticalCenter.common="-1"verticalCenter.selected="-1"left.lock="18"verticalCenter.lock="0"left.common="18"verticalCenter="0"scaleX.selected="0.95"scaleY.selected="0.95"bae:Imageid="leaderIcon"width="75"height="75"x.common="26.88"y.common="24.67"width.common="72"height.common="72"touchEnabled="false"includeIn="common,selected"source=""y.selected="15.77"x.selected="12.96"source.common=""source.selected=""left.common="25"verticalCenter.common="0"scaleX.lock="1"scaleX.selected="1"scaleY.lock="1"scaleY.selected="1"horizontalCenter="0"verticalCenter="0"scaleX="0.95"scaleY="0.95"cbae:Imageid="iconBg"x.selected="9.39"y.selected="11.38"y.common="18.96"x.common="22.33"y.lock="38.84"x.lock="42.52"source="button_kz_01_txk02"height.selected="84"height.common="84"scale9Grid="10,10,62,62"width.selected="83"width.common="83"source.common="button_kz_02_txk02"scaleX.common="0.9"scaleY.common="0.9"source.lock="button_sd"scale9Grid.lock="10,10,16,13"left.common="22"scaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"cbace:Groupba!--1001--bae:Labelid="desc"text="领主名称"textAlign.lock="center"textAlign.common="center"verticalAlign="middle"text.common="领主名称"text.selected="亚瑟亚瑟亚瑟"text.lock="未解锁"fontFamily="desc_font"y.selected="16.47"x.selected="98.66"width.selected="140"textAlign.selected="center"textAlign="center"size.lock="22"textColor.common="0x3471a5"textColor.selected="0xca7c28"textColor.lock="0x284451"touchEnabled="false"anchorOffsetX.lock="0"width.lock="130"x.lock="105.03"anchorOffsetY.lock="0"height.lock="76"y.lock="18.34"anchorOffsetY.selected="0"height.selected="80"anchorOffsetX.common="0"width.common="140"x.common="97.03"height.common="80"y.common="17.32"size.common="24"size.selected="24"bold.lock="true"bold.selected="true"bold.common="true"fontFamily.lock="main_font"verticalCenter="0"right="8"left="98"cbace:Skinba?xmlversion='1.0'encoding='utf-8'?bae:Skinclass="HomeMapSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="1280"height="720"x="0"y="0"bae:Imagewidth="1280"height="720"horizontalCenter="0"verticalCenter="0"x="0"y="0"scaleX="1"scaleY="1"source="bg_main_jpg"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="TopMaskSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="1280"height="720"horizontalCenter="0"verticalCenter="0"bae:ImageanchorOffsetX="0"width="1920"anchorOffsetY="0"height="180"source="common_ui_common_json.bg_blue_00"scale9Grid="1,1,2,2"y="-180.00000000000003"x="-320"scaleX="1"scaleY="1"cbae:Imagey="720.0000000000001"scale9Grid="1,1,2,2"anchorOffsetX="0"width="1920"anchorOffsetY="0"height="180"source="common_ui_common_json.bg_blue_00"x="-320"scaleX="1"scaleY="1"cbae:Imagex="1280"scale9Grid="1,1,2,2"anchorOffsetX="0"width="320"anchorOffsetY="0"height="800"source="common_ui_common_json.bg_blue_00"y="-40"scaleX="1"scaleY="1"cbae:Imagex="-320"scale9Grid="1,1,2,2"anchorOffsetX="0"width="320"anchorOffsetY="0"height="800"source="common_ui_common_json.bg_blue_00"y="-40"scaleX="1"scaleY="1"cbace:Groupbace:Skinba?xmlversion='1.0'encoding='utf-8'?bae:Skinclass="WarMapSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="1280"height="720"scaleX="1"horizontalCenter="0"verticalCenter="0"scaleY="1"bae:Imageid="map_bg"scaleX="1"scaleY="1"source="map_1001_jpg"horizontalCenter="0"verticalCenter="0"cbae:Imageid="bg1"source="war_ui_common_json.bg_dark"scaleX="1"scaleY="1"anchorOffsetX="640"anchorOffsetY="360"x="640"y="360"cbae:Imageid="bg2"source="war_ui_common_json.bg_dark"scaleX="-1"scaleY="1"anchorOffsetX="640"anchorOffsetY="360"x="640"y="360"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="DeploySkin"width="400"height="400"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="400"height="400"anchorOffsetX="200"anchorOffsetY="200"horizontalCenter="0"verticalCenter="0"rotation="360"bae:ImageanchorOffsetX="24"anchorOffsetY="15"source="war_ui_common_json.bg_downplace"x="200"y="200"visible="false"cbae:ImageanchorOffsetX="34"anchorOffsetY="18"source="war_ui_common_json.bg_zdyz"x="200"y="200"visible="false"cbae:Imagesource="2_stand_0_png"x="-56"y="-56"visible="false"cbae:Groupid="costInfo"width="100"height="100"scaleX="0.8"scaleY="0.8"x="200"y="190"anchorOffsetX="50"anchorOffsetY="50"visible="false"bae:Imageid="costBg"source="common_ui_common_json.icon_sh_d"horizontalCenter="0"verticalCenter="0"scaleX="1"scaleY="1"cbae:BitmapLabelid="costCount"font="sh_font_fnt"text="4"horizontalCenter="0"verticalCenter="0"width="60"textAlign="center"cbace:Groupbae:Groupid="energyInfo"width="100"height="100"scaleX="1"x="198"y="58"anchorOffsetX="50"anchorOffsetY="50"bae:Imageid="energyBg"source="common_ui_common_json.icon_sh_d"horizontalCenter="24"verticalCenter="-3.5"scaleX="0.7"scaleY="0.7"cbae:BitmapLabelid="nowEnergy"text="2!4"horizontalCenter="-23"verticalCenter="-1"width="60"textAlign="right"font="cost_warn_font_fnt"letterSpacing="-6"cbace:Groupbae:Labelid="heroName"text="步兵"size="18"textAlign="center"horizontalCenter="0"verticalCenter="-113"fontFamily="desc_font"stroke="2"cbae:Labelid="heroLv"text="1"size="22"textAlign="right"fontFamily="main_font"stroke="2"y="110"right="202"anchorOffsetY="11"cbae:Labeltext="级"size="18"textAlign="right"fontFamily="main_font"stroke="2"right="182"y="110"anchorOffsetY="9"cbace:Groupbace:Skinba?xmlversion='1.0'encoding='utf-8'?bae:Skinclass="EditorUISkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"baw:Configid="169c4227a0d"cbae:Imagex="0"y="1"source="map_1001_jpg"width="1280"height="720"cbae:Groupid="root"width="1280"height="720"x="0"y="0"bans1:SButtonid="closeBtn"label=""scaleX="2"scaleY="2"x="1201"y="24"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="close_png"source.down="close_png"source.disabled="close_png"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Groupid="replay"width="1280"height="141.21"x="0"y="465.79"anchorOffsetY="0"scaleX="1"scaleY="1"touchEnabled="false"bans1:SButtonid="speedBtn"label="加速"anchorOffsetX="0"scaleX="1"scaleY="1"width="60"height="60"anchorOffsetY="0"horizontalCenter="595"verticalCenter="120"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="button_png"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="slowBtn"label="减速"anchorOffsetX="0"scaleX="1"scaleY="1"width="60"height="60"anchorOffsetY="0"horizontalCenter="511"verticalCenter="120"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="button_png"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="playBtn"label="播放"anchorOffsetX="0"scaleX="1"scaleY="1"width="100"height="50"anchorOffsetY="0"horizontalCenter="241"verticalCenter="114.395"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_green"scale9Grid="14,12,86,31"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="pauseBtn"label="暂停"anchorOffsetX="0"scaleX="1"scaleY="1"anchorOffsetY="0"width="100"height="50"horizontalCenter="375"verticalCenter="114.395"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_green"scale9Grid="14,10,86,31"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Labelid="totalFrame"text="技能ID"x="856.36"y="103.21"scaleX="1"scaleY="1"cbae:Labelid="speedLabel"text="X1"x="1142.36"y="110.55"scaleX="1"scaleY="1"fontFamily="main_font"textColor="0x000000"cbae:Groupid="magicIDGroup"width="133.33"height="51.52"x="961.85"y="94.45"anchorOffsetY="0"anchorOffsetX="0"bae:Imagesource="lifeBar_png"x="9.149999999999977"y="3.759999999999991"height="40"width="120"scale9Grid="2,0,14,1"scaleX="1"scaleY="1"anchorOffsetX="0"alpha="0.5"cbans1:SInputLabelid="magicID"text="10020"x="14.150000000000091"y="3.759999999999991"anchorOffsetX="0"width="120"anchorOffsetY="0"height="40"textColor="0x000000"verticalAlign="middle"textAlign="left"scaleX="1"scaleY="1"size="20"type="input"fontFamily="main_font"cbace:Groupbace:Groupbae:Groupid="editor"width="226"height="712"x="0"y="0"touchEnabled="true"touchChildren="true"scaleX="1"scaleY="1"anchorOffsetX="0"anchorOffsetY="0"bans1:SButtonid="addAttBtn"label="添加攻击者"anchorOffsetX="0"width="200"scaleX="1"scaleY="1"verticalCenter="-304.5"horizontalCenter="47"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_green"scale9Grid="14,7,86,36"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="addVitBtn"label="添加受击者"anchorOffsetX="0"width="200"scaleX="1"scaleY="1"verticalCenter="-204.5"horizontalCenter="47"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_green"scale9Grid="14,7,86,36"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="playAniBtn"label="播放动画"anchorOffsetX="0"width="200"scaleX="1"scaleY="1"verticalCenter="-61.5"horizontalCenter="47"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_green"scale9Grid="14,7,86,36"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonlabel="Button"anchorOffsetX="50"width="100"x="0"y="0"height="100"anchorOffsetY="50"visible="false"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_green"scale9Grid="14,12,86,28"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Groupid="vitTypeGroup"width="133.33"height="51.52"x="81"y="196"anchorOffsetY="0"anchorOffsetX="0"bae:Imagesource="lifeBar_png"x="9.149999999999977"y="3.759999999999991"height="40"width="120"scale9Grid="2,0,14,1"scaleX="1"scaleY="1"anchorOffsetX="0"alpha="0.5"cbans1:SInputLabelid="vitType"text="1"x="14.150000000000091"y="3.759999999999991"anchorOffsetX="0"width="120"anchorOffsetY="0"height="40"textColor="0x000000"verticalAlign="middle"textAlign="left"scaleX="1"scaleY="1"size="20"type="input"fontFamily="main_font"cbace:Groupbae:Groupid="aniNameGroup"width="133.33"height="51.52"x="81"y="338"anchorOffsetY="0"anchorOffsetX="0"bae:Imagesource="lifeBar_png"x="9.149999999999977"y="3.759999999999991"height="40"width="120"scale9Grid="2,0,14,1"scaleX="1"scaleY="1"anchorOffsetX="0"alpha="0.5"cbans1:SInputLabelid="aniName"text="attack0"x="14.150000000000091"y="3.759999999999991"anchorOffsetX="0"width="120"anchorOffsetY="0"height="40"textColor="0x000000"verticalAlign="middle"textAlign="left"scaleX="1"scaleY="1"size="20"type="input"fontFamily="main_font"cbace:Groupbae:Groupid="aniFrameGroup"width="133.33"height="51.52"x="81"y="404"anchorOffsetY="0"anchorOffsetX="0"bae:Imagesource="lifeBar_png"x="9.149999999999977"y="3.759999999999991"height="40"width="120"scale9Grid="2,0,14,1"scaleX="1"scaleY="1"anchorOffsetX="0"alpha="0.5"cbans1:SInputLabelid="stopFrame"text="-1"x="14.150000000000091"y="3.759999999999991"anchorOffsetX="0"width="120"anchorOffsetY="0"height="40"textColor="0x000000"verticalAlign="middle"textAlign="left"scaleX="1"scaleY="1"size="20"type="input"fontFamily="main_font"cbace:Groupbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="LifeBarSkin"width="180"height="60"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="180"height="60"x="0"y="0"anchorOffsetX="0"bae:Groupid="hero_self"width="70"height="20"scaleX="1"verticalCenter="0"horizontalCenter="0"visible="false"bae:Imageid="bg"source="war_ui_common_json.bg_hp_s_di"scale9Grid="5,3,30,5"y="5"scaleX="1"scaleY="1"x="15"cbae:Imageid="fg"source="war_ui_common_json.bg_hp_s_blue"scale9Grid="4,3,32,5"width="30"y="5"scaleX="1"scaleY="1"x="15"cbae:Imageid="shine"source="war_ui_common_json.bg_hp_s_blue_shine"x="15"y="5"scale9Grid="3,2,34,7"width="35"cbae:BitmapLabelid="lvLabel"text="b"x="2"y="2.5"scaleX="1"scaleY="1"anchorOffsetX="0"font="hp_blue_little_font_fnt"cbace:Groupbae:Groupid="hero_target"width="70"height="20"scaleX="1"verticalCenter="0"horizontalCenter="0"visible="false"bae:Imageid="bg0"source="war_ui_common_json.bg_hp_s_di"scale9Grid="5,3,30,5"y="5"horizontalCenter="0"cbae:Imagey="5"id="shine0"scale9Grid="3,2,34,7"width="40"source="war_ui_common_json.bg_hp_s_red_shine"right="15"cbae:Imageid="fg0"source="war_ui_common_json.bg_hp_s_blue"scale9Grid="4,3,32,5"right="15"y="5"width="40"cbae:BitmapLabelid="lvLabel0"font="hp_blue_little_font_fnt"text="5"x="53"y="2.5"anchorOffsetX="0"cbace:Groupbae:Groupid="queue_self"width="90"height="20"scaleX="1"verticalCenter="0"horizontalCenter="0"visible="false"bae:Imageid="bg1"scale9Grid="5,3,30,5"y="5"scaleX="1"scaleY="1"source="war_ui_common_json.bg_hp_m_di"horizontalCenter="0"cbae:Imageid="shine1"source="war_ui_common_json.bg_hp_s_blue_shine"x="12"y="5"width="66"height="12"scale9Grid="3,2,34,7"cbae:Imageid="fg1"scale9Grid="4,3,32,5"scaleX="1"scaleY="1"source="war_ui_common_json.bg_hp_m_blue"x="12"y="5"cbae:Imagesource="war_ui_common_json.bg_hp_m_blue_icon"x="-3.2"y="0.8"cbae:BitmapLabelid="lvLabel1"text="1038"x="16.2"y="10"scaleX="0.85"scaleY="0.85"anchorOffsetX="0"font="hp_blue_big_font_fnt"letterSpacing="-3"width="68.63"cbace:Groupbae:Groupid="queue_target"width="90"height="20"scaleX="1"verticalCenter="0"horizontalCenter="0"visible="false"bae:Imageid="bg2"scale9Grid="5,3,30,5"y="5"scaleX="1"scaleY="1"source="war_ui_common_json.bg_hp_m_di"horizontalCenter="0"cbae:Imageid="shine2"y="5"width="66"height="12"scale9Grid="3,2,34,7"source="war_ui_common_json.bg_hp_s_red_shine"right="12"cbae:Imageid="fg2"scale9Grid="4,3,32,5"scaleX="1"scaleY="1"y="5"source="war_ui_common_json.bg_hp_m_red"right="12"cbae:Imagex="93.05"y="0.8"source="war_ui_common_json.bg_hp_m_red_icon"scaleX="-1"cbae:BitmapLabelid="lvLabel2"text="1038"x="11.45"y="10"scaleX="0.85"scaleY="0.85"anchorOffsetX="0"letterSpacing="-3"font="hp_red_big_font_fnt"textAlign="right"width="60"cbace:Groupbae:Groupid="King_self"width="180"height="60"scaleX="1"verticalCenter="0"horizontalCenter="0"visible="false"bae:Imageid="bg3"scale9Grid="5,3,30,5"scaleX="1"scaleY="1"horizontalCenter="1"source="war_ui_common_json.bg_hp_l_di"verticalCenter="2"cbae:Imageid="shine3"source="war_ui_common_json.bg_hp_s_blue_shine"width="112"height="18"scale9Grid="3,2,34,7"anchorOffsetY="0"anchorOffsetX="0"x="34"top="22"cbae:Imageid="fg3"scale9Grid="4,3,32,5"scaleX="1"scaleY="1"y="21"source="war_ui_common_json.bg_hp_l_blue"x="33"cbae:Imagey="4"source="war_ui_common_json.bg_hp_l_blue_icon"scaleX="1"scaleY="1"horizontalCenter="-66.5"cbae:BitmapLabelid="hpLabel3"text="1038"y="28.75"scaleX="1"scaleY="1"anchorOffsetX="0"font="hp_blue_big_font_fnt"letterSpacing="-3"width="97.25"x="39.25"cbae:BitmapLabelid="lvLbel3"width="39"height="20"x="4.01"y="14"font="tower_lv_font_fnt"text="5"anchorOffsetX="0"letterSpacing="-4"textAlign="center"scaleX="1"scaleY="1"cbace:Groupbae:Groupid="King_target"width="180"height="60"scaleX="1"verticalCenter="0"horizontalCenter="0"x="10"y="10"bae:Imageid="bg4"scale9Grid="5,3,30,5"scaleX="1"scaleY="1"horizontalCenter="1"source="war_ui_common_json.bg_hp_l_di"verticalCenter="2"cbae:Imageid="fg4"scale9Grid="4,3,32,5"scaleX="1"scaleY="1"y="21"source="war_ui_common_json.bg_hp_l_red"right="30"width="117"cbae:Imageid="shine4"width="112"height="18"scale9Grid="3,2,34,7"anchorOffsetY="0"anchorOffsetX="0"source="war_ui_common_json.bg_hp_s_red_shine"right="34"y="22"cbae:Imagey="4"source="war_ui_common_json.bg_hp_l_blue_icon"horizontalCenter="65.5"scaleX="1"scaleY="1"cbae:BitmapLabelid="hpLabel0"text="1038"y="28.75"scaleX="1"scaleY="1"anchorOffsetX="0"letterSpacing="-3"width="97.25"x="39.25"font="hp_red_big_font_fnt"textAlign="right"cbae:BitmapLabelwidth="39"height="20"x="136.65"y="14"font="tower_lv_font_fnt"text="13"anchorOffsetX="0"letterSpacing="-4"textAlign="center"id="lvLbel0"scaleX="1"scaleY="1"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="RunScriptSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="1280"height="720"x="0"y="0"bae:Imagesource="mb_png"width="800"height="600"scale9Grid="5,5,36,36"scaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"x="240"y="60"alpha="1"cbae:Groupid="serverList"width="800"height="400"x="240"y="60"scaleX="1"scaleY="1"anchorOffsetX="0"anchorOffsetY="0"bae:Imagesource="button_png"scale9Grid="10,10,31,30"anchorOffsetX="0"width="600"anchorOffsetY="0"height="60"alpha="1"horizontalCenter="0"verticalCenter="205"cbae:Imageid="scroll_bg"source="button_png"scale9Grid="10,10,31,30"anchorOffsetX="0"width="600"anchorOffsetY="0"height="350"alpha="0.5"x="100"bottom="50"cbae:Scrollerid="game_list_scroller"width="800"height="350"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"bottom="50"horizontalCenter="0"cbae:Listid="game_list"width="800"height="350"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"x="0"alpha="1"bottom="50"cbace:Groupbans1:SButtonid="enterBtn"xmlns:ns1="*"label="确定"anchorOffsetX="0"width="255"anchorOffsetY="0"height="92"scaleX="1"scaleY="1"horizontalCenter="0.5"verticalCenter="217"bans1:skinNamebae:Skinstates="up,down,disabled"xmlns:w="http:ccns.egret.comcwing"xmlns:game="game.*"bae:Imageid="imgDisplay"width="100%"height="100%"source="yellowBtn_png"scale9Grid="25,8,150,48"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"fontFamily="main_font"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="SkillIconSkin"width="112"height="150"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Groupid="root"width="112"height="150"scaleX="1"scaleY="1"anchorOffsetX="56"anchorOffsetY="75"x="56"y="75"bae:Groupid="container"width="112"height="150"horizontalCenter="0"verticalCenter="0"bae:Imageid="qualityIcon"scaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"source="common_ui_common_json.bg_card_di_0"x="4"y="12"cbae:Imageid="heroIcon"scaleX="1"scaleY="1"horizontalCenter="0"verticalCenter="0"source="common_ui_heroicon_json.10060"x="4"y="12"cbae:Groupid="skill"width="60"height="60"x="-1.25"y="4.25"scaleX="1"scaleY="1"bae:Imageid="skillQualityIcon"x="-1.07"y="-0.87"scaleX="1"scaleY="1"source="war_ui_common_json.bg_skill_d_0"cbans1:SGroupid="skillGroup"width="100"height="100"scaleX="1"scaleY="1"horizontalCenter="-3"verticalCenter="-3"bae:ImagescaleX="0.75"scaleY="0.75"source="common_ui_common_json.bg_skill_k_up"horizontalCenter="0"verticalCenter="0"cbae:Imageid="skillIcon"scaleX="0.75"scaleY="0.75"source="common_ui_skillicon_json.10020"horizontalCenter="0"verticalCenter="0"cbae:Imageid="skillShine"source="war_ui_common_json.bg_skill_shine"scaleX="1"scaleY="1"verticalCenter="-2.5"horizontalCenter="-0.5"cbacns1:SGroupbace:Groupbae:Imageid="hpBg"scaleX="1"scaleY="1"y="91"x="8"source="war_ui_common_json.bg_card_hp_di"scale9Grid="7,7,79,5"cbae:Imageid="hpFg"source="war_ui_common_json.bg_card_hp_nr"x="8"y="91"scaleX="1"scaleY="1"scale9Grid="7,7,79,5"cbae:Imageid="energyBg"y="109"scaleX="1"scaleY="1"x="8"source="war_ui_common_json.bg_card_hp_di"visible="false"cbae:Imageid="energyFg"source="war_ui_common_json.bg_card_skill_nr"x="8"y="109"scaleX="1"scaleY="1"visible="false"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="TestWarItemSkin"width="1000"height="150"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Imagesource="button_png"width="1000"height="140"anchorOffsetY="0"x="0"scale9Grid="19,6,115,36"verticalCenter="0"cbae:Groupid="attr"width="200"height="40"x="325.33"y="65"anchorOffsetY="0"bae:Imagesource="lifeBar_png"x="0"y="0"height="40"width="150"scale9Grid="2,0,14,1"scaleX="1"scaleY="1"cbans1:SInputLabelid="attrName"text="HP"x="0"y="0"anchorOffsetX="0"width="148"anchorOffsetY="0"height="38"type="input"textColor="0x000000"verticalAlign="middle"textAlign="left"scaleX="1"scaleY="1"cbace:Groupbae:Groupid="value"width="200"height="40"x="747.48"y="64.23"rotation="0.44"bae:Imageid="input_bg0"source="lifeBar_png"x="0"y="0"height="40"width="200"scale9Grid="2,0,14,1"scaleX="1"scaleY="1"cbae:Labelid="attrValue"text="获取属性失败"x="0"y="0"anchorOffsetX="0"width="200"anchorOffsetY="0"height="40"verticalAlign="middle"scaleX="1"scaleY="1"type="input"textColor="0x000000"cbace:Groupbae:Groupid="attr0"width="250"height="80"x="24.67"y="44"anchorOffsetY="0"bae:Imagesource="lifeBar_png"x="0"y="0"height="80"width="250"scale9Grid="2,0,14,1"scaleX="1"scaleY="1"cbans1:SInputLabelid="compName"text="HeroDataComponents"x="0"y="0"anchorOffsetX="0"width="250"anchorOffsetY="0"height="80"textColor="0x000000"verticalAlign="middle"textAlign="left"scaleX="1"scaleY="1"size="20"cbace:Groupbans1:SButtonid="getBtn"label="读取"height="40"anchorOffsetX="0"width="104"horizontalCenter="121"verticalCenter="-30"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="lifeBar_png"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="setBtn"label="写入"height="40"anchorOffsetX="0"width="104"horizontalCenter="121"verticalCenter="48"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="lifeBar_png"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="TestWarSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"bae:Groupid="root"width="1280"height="720"x="0"y="0"bans1:SButtonid="closeBtn"label=""width="68"height="70"scaleX="1"horizontalCenter="585"verticalCenter="285"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="close_png"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbans1:SButtonid="testAniBtn"label="测试效果"width="150.22"height="70"scaleX="1"anchorOffsetX="0"horizontalCenter="564"verticalCenter="163"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="button_png"scale9Grid="11,10,29,30"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Groupid="top"width="1000"height="600"x="120"anchorOffsetY="0"anchorOffsetX="0"y="80"bae:Imagesource="mb_png"x="0"y="0"anchorOffsetX="0"width="1000"anchorOffsetY="0"height="600"scale9Grid="5,5,36,36"cbace:Groupbae:Scrollerid="game_list_scroller"width="1000"height="600"x="120"y="80"anchorOffsetX="0"anchorOffsetY="0"bace:Scrollerbae:Listid="game_list"width="1000"height="600"x="120"y="80"anchorOffsetX="0"anchorOffsetY="0"cbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="UnitIconSkin"width="150"height="100"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="150"height="100"scaleX="1"scaleY="1"anchorOffsetX="68"anchorOffsetY="60"x="68"y="60"bae:Groupid="container"width="150"height="100"scaleX="1"scaleY="1"verticalCenter="0"horizontalCenter="0"bae:Imageid="qualityIcon"source="common_ui_common_json.bg_card_di_1"horizontalCenter="0"verticalCenter="0"scaleX="0.7"scaleY="0.7"cbae:Imageid="heroIcon"scaleX="0.7"scaleY="0.7"source="common_ui_heroicon_json.10020"horizontalCenter="1"verticalCenter="-1"cbae:Imagex="1.02"y="1.82"scaleX="0.8"scaleY="0.8"source="common_ui_common_json.icon_sh_d"cbae:BitmapLabelid="costLabel"x="5.07"y="11.26"text="7"scaleX="0.8"scaleY="0.8"anchorOffsetX="0"font="sh_font_fnt"letterSpacing="-6"cbae:Imageid="balance"source="war_ui_common_json.bg_card_shine"horizontalCenter="0"verticalCenter="0"width="150"height="100"scale9Grid="13,13,23,21"alpha="0.3"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="WarBottomNormalSkin"width="1280"height="150"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="1280"height="150"x="0"y="0"scaleX="1"scaleY="1"bae:Groupid="iconGroup"width="640"height="100"x="315"y="10"bae:Imageid="cardBg0"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"scaleX="0.8"scaleY="0.8"y="35"x="-180"cbae:Imageid="cardBg1"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"scaleX="1"scaleY="1"y="0"x="0"cbae:Imageid="cardBg2"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"x="160"y="0"scaleX="1"scaleY="1"cbae:Imageid="cardBg3"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"x="320"y="0"scaleX="1"scaleY="1"cbae:Imageid="cardBg4"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"x="480"y="0"scaleX="1"scaleY="1"cbace:Groupbae:Groupid="energyInfo"width="100"height="100"x="239.68"y="79.2"scaleX="1"scaleY="1"bae:Imageid="energyBg0"source="war_ui_common_json.icon_sh_dbg_sh_d0"x="47"y="29"scaleX="1"scaleY="1"cbae:Imageid="energyBg1"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_d11"scale9Grid="5,2,531,15"cbae:Imageid="energyBg2"source="war_ui_common_json.icon_sh_dbg_sh_d1"x="75"y="38"scaleX="1"scaleY="1"scale9Grid="6,2,530,15"width="128.6"cbae:Imageid="energyBg3"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_shine_01"scale9Grid="9,2,526,15"cbae:Imageid="energyBg4"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_shine_02"scale9Grid="9,2,525,15"cbae:Imageid="energyBg5"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_shine_03"scale9Grid="10,2,520,15"cbae:Groupid="energyBg6"x="75"y="36"width="652"bae:Imageid="split1"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="59.8"y="0"scaleX="1"scaleY="1"cbae:Imageid="split2"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="125.6"y="0"scaleX="1"scaleY="1"cbae:Imageid="split3"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="191.39999999999998"y="0"scaleX="1"scaleY="1"cbae:Imageid="split4"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="257.2"scaleX="1"scaleY="1"cbae:Imageid="split5"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="323"scaleX="1"scaleY="1"cbae:Imageid="split6"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="388.8"scaleX="1"scaleY="1"cbae:Imageid="split7"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="454.59999999999997"scaleX="1"scaleY="1"cbae:Imageid="split8"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="520.4"scaleX="1"scaleY="1"cbae:Imageid="split9"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="586.1999999999999"scaleX="1"scaleY="1"cbace:Groupbae:Imageid="selectBg"scaleX="1"scaleY="1"x="70"y="34"source="war_ui_common_json.icon_sh_dbg_sh_d12"scale9Grid="8,8,9,12"width="135.8"cbae:Imageid="fullTips"x="339.17"y="-106.33"scaleX="1"scaleY="1"source="war_ui_common_json.text_shym"cbae:Imagex="38"y="24"source="common_ui_common_json.icon_sh_d"cbae:BitmapLabelid="energyCount"width="60"height="20"font="sh_font_fnt"text="a"textAlign="center"anchorOffsetX="0"verticalCenter="-5"horizontalCenter="9.5"letterSpacing="-5"cbace:Groupbans1:SGroupid="chatGroup"xmlns:ns1="*"width="80"height="80"scaleX="1"scaleY="1"horizontalCenter="-566"verticalCenter="30"visible="false"bae:Imagesource="war_ui_common_json.button_d_lt1"x="4"y="7.5"scaleX="1"scaleY="1"cbacns1:SGroupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="WarBottomReplay01Skin"width="1280"height="150"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="854"height="150"x="0"y="0"scaleX="0.75"scaleY="0.75"bae:Groupid="iconGroup"width="640"height="100"x="155"y="40"scaleX="1"scaleY="1"bae:Imageid="cardBg0"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"scaleX="0.8"scaleY="0.8"y="18"x="-140"cbae:Imageid="cardBg1"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"scaleX="1"scaleY="1"y="0"x="0"cbae:Imageid="cardBg2"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"x="165"y="0"scaleX="1"scaleY="1"cbae:Imageid="cardBg3"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"x="330"y="0"scaleX="1"scaleY="1"cbae:Imageid="cardBg4"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"x="495"y="0"scaleX="1"scaleY="1"cbace:Groupbae:Groupid="energyInfo"width="100"height="100"x="85"y="110"scaleX="1"scaleY="1"bae:Imageid="energyBg0"source="war_ui_common_json.icon_sh_dbg_sh_d0"x="47"y="29"scaleX="1"scaleY="1"cbae:Imageid="energyBg1"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_d11"scale9Grid="5,2,531,15"cbae:Imageid="energyBg2"source="war_ui_common_json.icon_sh_dbg_sh_d1"x="75"y="38"scaleX="1"scaleY="1"scale9Grid="6,2,530,15"width="128.6"cbae:Imageid="energyBg3"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_shine_01"scale9Grid="9,2,526,15"cbae:Imageid="energyBg4"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_shine_02"scale9Grid="9,2,525,15"cbae:Imageid="energyBg5"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_shine_03"scale9Grid="10,2,520,15"cbae:Groupid="energyBg6"x="75"y="36"width="652"bae:Imageid="split1"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="59.8"y="0"scaleX="1"scaleY="1"cbae:Imageid="split2"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="125.6"y="0"scaleX="1"scaleY="1"cbae:Imageid="split3"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="191.39999999999998"y="0"scaleX="1"scaleY="1"cbae:Imageid="split4"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="257.2"scaleX="1"scaleY="1"cbae:Imageid="split5"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="323"scaleX="1"scaleY="1"cbae:Imageid="split6"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="388.8"scaleX="1"scaleY="1"cbae:Imageid="split7"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="454.59999999999997"scaleX="1"scaleY="1"cbae:Imageid="split8"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="520.4"scaleX="1"scaleY="1"cbae:Imageid="split9"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="586.1999999999999"scaleX="1"scaleY="1"cbace:Groupbae:Imageid="selectBg"scaleX="1"scaleY="1"x="70"y="34"source="war_ui_common_json.icon_sh_dbg_sh_d12"scale9Grid="8,8,9,12"width="135.8"visible="false"cbae:Imageid="fullTips"x="339.17"y="-106.33"scaleX="1"scaleY="1"source="war_ui_common_json.text_shym"cbae:Imagex="38"y="24"source="common_ui_common_json.icon_sh_d"cbae:BitmapLabelid="energyCount"width="60"height="20"font="sh_font_fnt"text="a"textAlign="center"anchorOffsetX="0"verticalCenter="-5"horizontalCenter="9.5"letterSpacing="-5"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="WarBottomReplay02Skin"width="1280"height="150"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupid="root"width="854"height="150"x="640"y="0"scaleX="0.75"scaleY="0.75"bae:Groupid="iconGroup"width="660"height="100"y="40"scaleX="1"scaleY="1"x="191"bae:Imageid="cardBg0"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"scaleX="0.8"scaleY="0.8"y="18"right="18"cbae:Imageid="cardBg1"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"scaleX="1"scaleY="1"y="0"right="155"cbae:Imageid="cardBg2"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"y="0"scaleX="1"scaleY="1"right="320"cbae:Imageid="cardBg3"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"y="0"scaleX="1"scaleY="1"right="485"cbae:Imageid="cardBg4"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"y="0"scaleX="1"scaleY="1"right="650"cbace:Groupbae:Groupid="energyInfo"width="854"height="150"y="0"scaleX="1"scaleY="1"x="0"touchEnabled="false"bae:Imageid="energyBg0"source="war_ui_common_json.icon_sh_dbg_sh_d0"y="139"scaleX="-1"scaleY="1"right="132"x="722"cbae:Imageid="energyBg1"y="148"scaleX="-1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_d11"scale9Grid="5,2,531,15"right="160"x="694"cbae:Imageid="energyBg2"source="war_ui_common_json.icon_sh_dbg_sh_d1"y="148"scaleX="-1"scaleY="1"scale9Grid="6,2,530,15"width="219.6"right="160"x="694"cbae:Imageid="energyBg3"y="148"scaleX="-1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_shine_01"scale9Grid="9,2,526,15"right="160"x="694"cbae:Imageid="energyBg4"y="148"scaleX="-1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_shine_02"scale9Grid="9,2,525,15"right="160"x="694"cbae:Imageid="energyBg5"y="148"scaleX="-1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_shine_03"scale9Grid="10,2,520,15"right="160"x="694"cbae:Groupid="energyBg6"y="146"width="652"right="160"x="42"scaleX="1"scaleY="1"bae:Imageid="split1"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="59.8"y="0"scaleX="1"scaleY="1"cbae:Imageid="split2"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="125.6"y="0"scaleX="1"scaleY="1"cbae:Imageid="split3"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="191.39999999999998"y="0"scaleX="1"scaleY="1"cbae:Imageid="split4"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="257.2"scaleX="1"scaleY="1"cbae:Imageid="split5"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="323"scaleX="1"scaleY="1"cbae:Imageid="split6"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="388.8"scaleX="1"scaleY="1"cbae:Imageid="split7"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="454.59999999999997"scaleX="1"scaleY="1"cbae:Imageid="split8"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="520.4"scaleX="1"scaleY="1"cbae:Imageid="split9"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="586.1999999999999"scaleX="1"scaleY="1"cbace:Groupbae:Imageid="selectBg"scaleX="-1"scaleY="1"y="144"source="war_ui_common_json.icon_sh_dbg_sh_d12"scale9Grid="8,8,9,12"width="194.8"right="155"x="699"visible="false"cbae:Imageid="fullTips"y="3.6700000000000017"scaleX="1"scaleY="1"source="war_ui_common_json.text_shym"right="424"x="305"cbae:Imagey="134"source="common_ui_common_json.icon_sh_d"right="123"x="693"scaleX="1"scaleY="1"cbae:BitmapLabelid="energyCount"width="60"height="20"font="sh_font_fnt"text="a"textAlign="center"anchorOffsetX="0"letterSpacing="-5"y="145"right="111"x="683"scaleX="1"scaleY="1"cbace:Groupbace:Groupbace:Skinba?xmlversion="1.0"encoding="utf-8"?bae:Skinclass="WarOverRewardItemSkin"width="106"height="106"xmlns:e="http:ccns.egret.comceui"xmlns:w="http:ccns.egret.comcwing"bae:Groupleft="0"top="0"right="0"bottom="0"bae:Imageid="bg"source="common_ui_common_json.bg_bag_gz"horizontalCenter="0"verticalCenter="0"cbae:Imageid="icon"scaleX="1"scaleY="1"horizontalCenter="0"source="common_ui_itemicon_json.item_2"verticalCenter="0"cbae:Labelid="count"text="1125"y="71.21"scaleX="1"scaleY="1"size="24"horizontalCenter="16"fontFamily="main_font"stroke="0"right="10"bold="false"textAlign="right"textColor="0x6d6456"cbae:Labelid="itemName"text="物品名字有好多字"y="89.36"scaleX="1"scaleY="1"size="20"width="120"horizontalCenter="0"fontFamily="main_font"textAlign="center"visible="false"cbace:Groupbace:Skinba?xmlversion='1.0'encoding='utf-8'?bae:Skinclass="WarOverSkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"baw:Configid="169c4227a0d"cbae:Imagex="0"y="0"source="12战斗结算-2v2胜利_jpg"visible="false"cbae:Groupid="root"width="1280"height="720"horizontalCenter="0"verticalCenter="0"anchorOffsetX="640"anchorOffsetY="360"bae:Groupwidth="1280"height="720"x="0"anchorOffsetY="0"verticalCenter="0"bae:Imagesource="war_ui_common_json.bg_zdjs_di"x="0"y="0"scale9Grid="1,1,8,8"width="1280"height="720"scaleX="1"scaleY="1"cbae:Groupid="topGroup"width="1280"height="400"x="0"y="-60"anchorOffsetX="0"scaleX="1"scaleY="1"bae:Imageid="midBg"x="569.71"y="180"width="144.67"height="130"source="war_ui_common_json.bg_zdjs_sl"scale9Grid="4,5,12,11"anchorOffsetX="0"anchorOffsetY="0"scaleX="1"scaleY="1"cbae:Imageid="winImg"x="568.5699999999999"y="110.69"scale9Grid="6,5,5,3"anchorOffsetY="0"anchorOffsetX="0"source="war_ui_common_json.bg_zdjs_sl02"scaleX="1"scaleY="1"cbae:Imageid="leftBg"x="212"y="180"source="war_ui_common_json.bg_zdjs_sl03"scale9Grid="6,5,5,3"width="412.33"height="20"anchorOffsetY="0"anchorOffsetX="0"scaleX="1"scaleY="1"cbae:Imageid="rightBg"x="694.68"y="180"scale9Grid="6,5,5,3"width="398.33"height="20"anchorOffsetY="0"anchorOffsetX="0"source="war_ui_common_json.bg_zdjs_sb03"scaleX="1"scaleY="1"cbagame:CommonPlayerInfox="207"y="176"skinName="MyPlayerInfoSkin2"scaleX="1"scaleY="1"visible="false"cbagame:CommonPlayerInfox="207"y="304"skinName="MyPlayerInfoSkin2"scaleX="1"scaleY="1"visible="false"cbagame:CommonPlayerInfox="652"y="176"skinName="TargetPlayerInfoSkin2"scaleX="1"scaleY="1"visible="false"cbagame:CommonPlayerInfox="652"y="304"skinName="TargetPlayerInfoSkin2"scaleX="1"scaleY="1"visible="false"cbae:Imageid="vsImg"source="common_ui_pp_json.bg_pp_vs"y="295"horizontalCenter="3.5"scaleX="0.55"scaleY="0.55"cbace:Groupbae:Groupid="midGroup"x="567"y="520"anchorOffsetY="0"height="129"bae:Imagex="27.5"y="8"anchorOffsetY="0"anchorOffsetX="0"source="war_ui_common_json.bg_zdjs_jbdi"scale9Grid="6,5,5,23"width="94.5"cbae:Imagex="15.5"y="11.36"anchorOffsetY="0"anchorOffsetX="0"source="common_ui_common_json.icon_top_cup"cbae:Labelid="cupCount"text="+30"x="55.39"y="11.33"fontFamily="main_font"textColor="0x549d48"size="26"cbace:Groupbae:Groupid="itemGroup"width="600"height="118"y="372"anchorOffsetY="0"anchorOffsetX="0"horizontalCenter="0"bagame:CommonItemx="128"y="38"skinName="WarOverRewardItemSkin"visible="false"cbagame:CommonItemx="246"y="38"skinName="WarOverRewardItemSkin"visible="false"cbagame:CommonItemx="364"y="38"skinName="WarOverRewardItemSkin"visible="false"cbace:Groupbans1:SButtonid="okBtn"label="确定"scaleX="1"scaleY="1"anchorOffsetX="0"anchorOffsetY="0"width="149"horizontalCenter="0"verticalCenter="254"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="common_ui_common_json.button_ty_yellow"scale9Grid="14,12,86,32"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"fontFamily="desc_font"size="28"textColor="0xc17c1a"bold="true"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Groupbace:Groupbace:Skinba?xmlversion='1.0'encoding='utf-8'?bae:Skinclass="WarUISkin"width="1280"height="720"xmlns:e="http:ccns.egret.comceui"xmlns:game="game.*"xmlns:w="http:ccns.egret.comcwing"xmlns:ns1="*"baw:Configid="169c4227a0d"cbae:Imagex="0"y="0"source="录像01_jpg"visible="false"cbae:Groupid="root"width="1280"height="720"x="0"y="0"touchEnabled="false"bae:Groupid="roleInfo"width="1276"height="100"x="0"y="0"anchorOffsetX="0"anchorOffsetY="0"touchChildren="false"touchEnabled="false"touchThrough="false"bae:Groupid="myRoleInfo"width="312"height="104"x="11"y="0"anchorOffsetX="0"bagame:WarPlayerInfox="-10"y="-5"skinName="MyPlayerInfoSkin"visible="false"cbace:Groupbae:Groupid="targetRoleInfo"height="104"anchorOffsetX="0"scaleX="1"scaleY="1"width="312"y="0"right="28"bagame:WarPlayerInfox="18"y="-5"scaleX="1"scaleY="1"skinName="TargetPlayerInfoSkin"visible="false"cbae:Groupid="targetRoleInfo_nolimit"width="312"height="104"y="0"scaleX="1"scaleY="1"x="343"bace:Groupbace:Groupbace:Groupbae:Groupid="timeGroup"width="200"height="60"x="538"y="5"anchorOffsetY="0"bae:Imagesource="war_ui_common_json.icon_djsbg_djs"x="39.36000000000013"y="2.8"scaleX="1"scaleY="1"scale9Grid="14,5,87,35"width="134"cbae:Imagesource="war_ui_common_json.icon_djs"x="20.360000000000014"y="-2.77"scaleX="1"scaleY="1"cbae:BitmapLabelid="time"height="30.67"y="10.14"text="2：59"anchorOffsetX="0"anchorOffsetY="0"letterSpacing="-2"scaleX="1"scaleY="1"font="war_time_font_fnt"horizontalCenter="20"cbace:Groupbae:Groupid="editor"width="1280"height="100"x="0"y="0"touchEnabled="true"touchChildren="true"scaleX="1"scaleY="1"visible="false"bae:Buttonid="tower10"label="塔10"x="38"y="24"cbae:Buttonid="tower11"label="塔11"x="165"y="24"cbae:Buttonid="tower12"label="塔12"x="289"y="24"cbae:Buttonid="collide"label="障碍物"x="640"y="27"cbae:Buttonid="complete"label="完成"x="446"y="31"cbae:Buttonid="tower22"label="塔22"x="1053"y="24"cbae:Buttonid="tower21"label="塔21"x="921"y="24"cbae:Buttonid="tower20"label="塔20"x="793"y="24"cbace:Groupbae:Groupid="replayGroup2"width="1280"height="720"x="0"y="0"touchEnabled="false"bae:Imagesource="war_ui_tv_json.bg_tv_blue"x="-2"y="655"scaleX="1"scaleY="1"scale9Grid="25,28,14,24"anchorOffsetX="0"width="646"cbae:Imagey="655"scaleX="1"scaleY="1"anchorOffsetX="0"width="646"source="war_ui_tv_json.bg_tv_red"scale9Grid="25,28,14,24"right="-2"x="636.0000000000001"cbace:Groupbae:Groupid="bottomGroup"width="1280"height="150"x="0"y="575"bae:Groupid="iconGroup"width="640"height="100"x="315"y="10"visible="false"bae:Imageid="cardBg0"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"scaleX="0.8"scaleY="0.8"y="35"x="-180"cbae:Imageid="cardBg1"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"scaleX="1"scaleY="1"y="0"x="0"cbae:Imageid="cardBg2"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"x="160"y="0"scaleX="1"scaleY="1"cbae:Imageid="cardBg3"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"x="320"y="0"scaleX="1"scaleY="1"cbae:Imageid="cardBg4"source="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"x="480"y="0"scaleX="1"scaleY="1"cbace:Groupbae:Groupid="energyInfo"width="100"height="100"x="239.68"y="79.2"scaleX="1"scaleY="1"visible="false"bae:Imageid="energyBg0"source="war_ui_common_json.icon_sh_dbg_sh_d0"x="47"y="29"scaleX="1"scaleY="1"cbae:Imageid="energyBg1"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_d11"scale9Grid="5,2,531,15"cbae:Imageid="energyBg2"source="war_ui_common_json.icon_sh_dbg_sh_d1"x="75"y="38"scaleX="1"scaleY="1"scale9Grid="6,2,530,15"width="128.6"cbae:Imageid="energyBg3"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_shine_01"scale9Grid="9,2,526,15"cbae:Imageid="energyBg4"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_shine_02"scale9Grid="9,2,525,15"cbae:Imageid="energyBg5"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_shine_03"scale9Grid="10,2,520,15"cbae:Groupid="energyBg6"x="75"y="36"width="652"bae:Imageid="split1"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="59.8"y="0"scaleX="1"scaleY="1"cbae:Imageid="split2"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="125.6"y="0"scaleX="1"scaleY="1"cbae:Imageid="split3"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="191.39999999999998"y="0"scaleX="1"scaleY="1"cbae:Imageid="split4"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="257.2"scaleX="1"scaleY="1"cbae:Imageid="split5"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="323"scaleX="1"scaleY="1"cbae:Imageid="split6"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="388.8"scaleX="1"scaleY="1"cbae:Imageid="split7"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="454.59999999999997"scaleX="1"scaleY="1"cbae:Imageid="split8"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="520.4"scaleX="1"scaleY="1"cbae:Imageid="split9"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="586.1999999999999"scaleX="1"scaleY="1"cbace:Groupbae:Imageid="selectBg"scaleX="1"scaleY="1"x="70"y="34"source="war_ui_common_json.icon_sh_dbg_sh_d12"scale9Grid="8,8,9,12"width="135.8"visible="false"cbae:Imageid="fullTips"x="339.17"y="-106.33"scaleX="1"scaleY="1"source="war_ui_common_json.text_shym"cbae:Imagex="38"y="24"source="common_ui_common_json.icon_sh_d"cbae:BitmapLabelid="energyCount"width="60"height="20"font="sh_font_fnt"text="a"textAlign="center"anchorOffsetX="0"verticalCenter="-5"horizontalCenter="9.5"letterSpacing="-5"cbace:Groupbans1:SGroupid="chatGroup"width="80"height="80"scaleX="1"scaleY="1"horizontalCenter="-566"verticalCenter="30"visible="false"bae:Imagesource="war_ui_common_json.button_d_lt1"x="4"y="7.5"scaleX="1"scaleY="1"cbacns1:SGroupbace:Groupbae:Groupid="replayGroup"width="1280"height="720"x="0"anchorOffsetY="0"scaleX="1"scaleY="1"touchEnabled="true"y="0"bans1:SGroupid="replayLeftGroup"width="85"height="240"x="-2"y="210"touchEnabled="false"anchorOffsetX="0"bans1:SGroupid="stopBtn"width="80"height="80"scaleX="1"scaleY="1"horizontalCenter="-8.5"verticalCenter="-77"bae:Imagescale9Grid="2,0,14,1"scaleX="1"scaleY="1"anchorOffsetX="0"source="war_ui_tv_json.button_tv_di_gb"horizontalCenter="0"verticalCenter="0"cbae:Imagescale9Grid="2,0,14,1"scaleX="1"scaleY="1"anchorOffsetX="0"horizontalCenter="-8.5"verticalCenter="-3"source="war_ui_tv_json.button_tv_gb"cbacns1:SGroupbans1:SGroupid="pauseBtn"width="80"height="80"scaleX="1"scaleY="1"horizontalCenter="-8.5"verticalCenter="4"bae:Imagescale9Grid="2,0,14,1"scaleX="1"scaleY="1"anchorOffsetX="0"horizontalCenter="0"verticalCenter="0"source="war_ui_tv_json.button_tv_di_zt"cbae:Imageid="pauseImg"scale9Grid="2,0,14,1"scaleX="1"scaleY="1"anchorOffsetX="0"horizontalCenter="-8.5"verticalCenter="-3"source="war_ui_tv_json.button_tv_zt"cbacns1:SGroupbans1:SGroupid="speedBtn"width="80"height="80"scaleX="1"scaleY="1"horizontalCenter="-8.5"verticalCenter="84"bae:Imagesource="war_ui_tv_json.button_tv_di_zt"scale9Grid="2,0,14,1"scaleX="1"scaleY="1"anchorOffsetX="0"horizontalCenter="0"verticalCenter="0"cbae:Imageid="speedImg"scale9Grid="2,0,14,1"scaleX="1"scaleY="1"anchorOffsetX="0"horizontalCenter="-4.5"verticalCenter="3"source="war_ui_tv_json.button_tv_bfsd02"cbacns1:SGroupbacns1:SGroupbans1:SGroupid="replayEditor"width="97"height="164"x="1169"y="264.82"anchorOffsetX="0"anchorOffsetY="0"bans1:SButtonid="jumpBtn"label="跳转"anchorOffsetX="0"scaleX="1"scaleY="1"x="35.82"y="109.51"width="60"height="60"anchorOffsetY="0"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imageid="imgDisplay"width="100%"height="100%"source="button_png"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbae:Imagesource="lifeBar_png"x="-78.18"y="119.51"height="40"width="82"scale9Grid="2,0,14,1"scaleX="1"scaleY="1"anchorOffsetX="0"cbans1:SInputLabelid="jumpFrame"text="2999"x="-70.18"y="119.51"anchorOffsetX="0"width="85"anchorOffsetY="0"height="40"textColor="0x000000"verticalAlign="middle"textAlign="left"scaleX="1"scaleY="1"size="20"type="input"cbae:Labelid="totalFrame"text="帧数:3000"x="-39.82"y="68.51"scaleX="1"scaleY="1"cbacns1:SGroupbae:Groupid="replayBottomLeftGroup"width="854"height="150"x="0"y="575"scaleX="0.75"scaleY="0.75"visible="false"bae:Groupid="iconGroup0"width="640"height="100"x="155"y="40"scaleX="1"scaleY="1"bae:Imagesource="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"scaleX="0.75"scaleY="0.75"y="19"x="-138"cbae:Imagesource="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"scaleX="1"scaleY="1"y="0"x="0"cbae:Imagesource="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"x="165"y="0"scaleX="1"scaleY="1"cbae:Imagesource="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"x="330"y="0"scaleX="1"scaleY="1"cbae:Imagesource="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"x="498"y="0"scaleX="1"scaleY="1"cbace:Groupbae:Groupid="energyInfo0"width="100"height="100"x="85"y="110"scaleX="1"scaleY="1"bae:Imageid="energyBg7"source="war_ui_common_json.icon_sh_dbg_sh_d0"x="47"y="29"scaleX="1"scaleY="1"cbae:Imageid="energyBg8"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_d11"scale9Grid="5,2,531,15"cbae:Imageid="energyBg9"source="war_ui_common_json.icon_sh_dbg_sh_d1"x="75"y="38"scaleX="1"scaleY="1"scale9Grid="6,2,530,15"width="128.6"cbae:Imageid="energyBg10"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_shine_01"scale9Grid="9,2,526,15"cbae:Imageid="energyBg11"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_shine_02"scale9Grid="9,2,525,15"cbae:Imageid="energyBg12"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_shine_03"scale9Grid="10,2,520,15"cbae:Groupid="energyBg13"x="75"y="36"width="652"bae:Imageid="split0"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="59.8"y="0"scaleX="1"scaleY="1"cbae:Imageid="split10"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="125.6"y="0"scaleX="1"scaleY="1"cbae:Imageid="split11"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="191.39999999999998"y="0"scaleX="1"scaleY="1"cbae:Imageid="split12"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="257.2"scaleX="1"scaleY="1"cbae:Imageid="split13"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="323"scaleX="1"scaleY="1"cbae:Imageid="split14"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="388.8"scaleX="1"scaleY="1"cbae:Imageid="split15"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="454.59999999999997"scaleX="1"scaleY="1"cbae:Imageid="split16"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="520.4"scaleX="1"scaleY="1"cbae:Imageid="split17"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="586.1999999999999"scaleX="1"scaleY="1"cbace:Groupbae:Imageid="selectBg0"scaleX="1"scaleY="1"x="70"y="34"source="war_ui_common_json.icon_sh_dbg_sh_d12"scale9Grid="8,8,9,12"width="135.8"visible="false"cbae:Imageid="fullTips0"x="339.17"y="-106.33"scaleX="1"scaleY="1"source="war_ui_common_json.text_shym"cbae:Imagex="38"y="24"source="common_ui_common_json.icon_sh_d"cbae:BitmapLabelid="energyCount0"width="60"height="20"font="sh_font_fnt"text="a"textAlign="center"anchorOffsetX="0"verticalCenter="-5"horizontalCenter="9.5"letterSpacing="-5"cbace:Groupbace:Groupbae:Groupid="replayBottomRightGroup"width="854"height="150"y="575"scaleX="-0.75"scaleY="0.75"horizontalCenter="320.5"visible="false"bae:Groupid="iconGroup1"width="640"height="100"x="155"y="40"scaleX="1"scaleY="1"bae:Imagesource="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"scaleX="0.75"scaleY="0.75"y="19"x="-138"cbae:Imagesource="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"scaleX="1"scaleY="1"y="0"x="0"cbae:Imagesource="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"x="165"y="0"scaleX="1"scaleY="1"cbae:Imagesource="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"x="330"y="0"scaleX="1"scaleY="1"cbae:Imagesource="war_ui_common_json.bg_zd_tx_di"scale9Grid="15,10,23,29"width="155"anchorOffsetY="0"height="100"x="498"y="0"scaleX="1"scaleY="1"cbace:Groupbae:Groupid="energyInfo1"width="100"height="100"x="85"y="110"scaleX="1"scaleY="1"bae:Imageid="energyBg14"source="war_ui_common_json.icon_sh_dbg_sh_d0"x="47"y="29"scaleX="1"scaleY="1"cbae:Imageid="energyBg15"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_d11"scale9Grid="5,2,531,15"cbae:Imageid="energyBg16"source="war_ui_common_json.icon_sh_dbg_sh_d1"x="75"y="38"scaleX="1"scaleY="1"scale9Grid="6,2,530,15"width="128.6"cbae:Imageid="energyBg17"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_shine_01"scale9Grid="9,2,526,15"cbae:Imageid="energyBg18"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_shine_02"scale9Grid="9,2,525,15"cbae:Imageid="energyBg19"x="75"y="38"scaleX="1"scaleY="1"source="war_ui_common_json.icon_sh_dbg_sh_shine_03"scale9Grid="10,2,520,15"cbae:Groupid="energyBg20"x="75"y="36"width="652"bae:Imageid="split18"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="59.8"y="0"scaleX="1"scaleY="1"cbae:Imageid="split19"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="125.6"y="0"scaleX="1"scaleY="1"cbae:Imageid="split20"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="191.39999999999998"y="0"scaleX="1"scaleY="1"cbae:Imageid="split21"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="257.2"scaleX="1"scaleY="1"cbae:Imageid="split22"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="323"scaleX="1"scaleY="1"cbae:Imageid="split23"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="388.8"scaleX="1"scaleY="1"cbae:Imageid="split24"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="454.59999999999997"scaleX="1"scaleY="1"cbae:Imageid="split25"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="520.4"scaleX="1"scaleY="1"cbae:Imageid="split26"source="war_ui_common_json.icon_sh_dbg_sh_d2"x="586.1999999999999"scaleX="1"scaleY="1"cbace:Groupbae:Imageid="selectBg1"scaleX="1"scaleY="1"x="70"y="34"source="war_ui_common_json.icon_sh_dbg_sh_d12"scale9Grid="8,8,9,12"width="135.8"visible="false"cbae:Imageid="fullTips1"x="339.17"y="-106.33"scaleX="1"scaleY="1"source="war_ui_common_json.text_shym"cbae:Imagex="38"y="24"source="common_ui_common_json.icon_sh_d"cbae:BitmapLabelid="energyCount1"width="60"height="20"font="sh_font_fnt"text="a"textAlign="center"anchorOffsetX="0"verticalCenter="-5"horizontalCenter="9.5"letterSpacing="-5"cbace:Groupbace:Groupbae:Groupid="frameInfo"width="200"height="152.24"x="1078"y="174.82"anchorOffsetY="0"bae:Labelid="clientFrame"text="99:99"y="23.99"scaleX="1"scaleY="1"textAlign="right"fontFamily="desc_font"right="10"cbae:Labelid="serverFrame"text="99:99"y="61.02"scaleX="1"scaleY="1"textAlign="right"fontFamily="desc_font"right="11"cbans1:SButtonid="closeBtn"label=""scaleX="2"scaleY="2"x="130.54"y="-44.97"bans1:skinNamebae:Skinstates="up,down,disabled"bae:Imagewidth="100%"height="100%"source="close_png"source.down="close_png"source.disabled="close_png"cbae:Labelid="labelDisplay"horizontalCenter="0"verticalCenter="0"cbace:Skinbacns1:skinNamebacns1:SButtonbace:Groupbace:Groupbae:Groupid="costTipsInfo"width="1280"height="100"x="0"y="300"anchorOffsetY="0"touchEnabled="false"touchChildren="false"bae:Labeltext="法力不足!"fontFamily="main_font"textColor="0xf36e68"textAlign="center"size="18"stroke="2"horizontalCenter="0"verticalCenter="0"visible="false"cbae:Imagesource="war_ui_common_json.text_shbz"horizontalCenter="0"verticalCenter="0"cbace:Groupbae:Groupid="maskGroup"width="1280"height="720"x="0"y="0"visible="false"bace:Groupbae:Imageid="warStartTips"source="war_ui_common_json.icon_war_start"horizontalCenter="0"verticalCenter="0"x="531"y="316"scaleX="1"scaleY="1"visible="false"cbace:Groupbace:Skinb{"1":{"desc":"新手1星","grade":1,"name":"新手1星","star":1,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"2":{"desc":"新手2星","grade":1,"name":"新手2星","star":2,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"3":{"desc":"新手3星","grade":1,"name":"新手3星","star":3,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"4":{"desc":"新手4星","grade":1,"name":"新手4星","star":4,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"5":{"desc":"新手5星","grade":1,"name":"新手5星","star":5,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":11020},"6":{"desc":"名人1星","grade":2,"name":"名人1星","star":1,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"7":{"desc":"名人2星","grade":2,"name":"名人2星","star":2,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"8":{"desc":"名人3星","grade":2,"name":"名人3星","star":3,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"9":{"desc":"名人4星","grade":2,"name":"名人4星","star":4,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"10":{"desc":"名人5星","grade":2,"name":"名人5星","star":5,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":11020},"11":{"desc":"精英1星","grade":3,"name":"精英1星","star":1,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"12":{"desc":"精英2星","grade":3,"name":"精英2星","star":2,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"13":{"desc":"精英3星","grade":3,"name":"精英3星","star":3,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"14":{"desc":"精英4星","grade":3,"name":"精英4星","star":4,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"15":{"desc":"精英5星","grade":3,"name":"精英5星","star":5,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":11020},"16":{"desc":"大师1星","grade":4,"name":"大师1星","star":1,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"17":{"desc":"大师2星","grade":4,"name":"大师2星","star":2,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"18":{"desc":"大师3星","grade":4,"name":"大师3星","star":3,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"19":{"desc":"大师4星","grade":4,"name":"大师4星","star":4,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"20":{"desc":"大师5星","grade":4,"name":"大师5星","star":5,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":11020},"21":{"desc":"宗师1星","grade":5,"name":"宗师1星","star":1,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"22":{"desc":"宗师2星","grade":5,"name":"宗师2星","star":2,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"23":{"desc":"宗师3星","grade":5,"name":"宗师3星","star":3,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"24":{"desc":"宗师4星","grade":5,"name":"宗师4星","star":4,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"25":{"desc":"宗师5星","grade":5,"name":"宗师5星","star":5,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":11020},"26":{"desc":"神主1星","grade":6,"name":"神主1星","star":1,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"27":{"desc":"神主2星","grade":6,"name":"神主2星","star":2,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"28":{"desc":"神主3星","grade":6,"name":"神主3星","star":3,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"29":{"desc":"神主4星","grade":6,"name":"神主4星","star":4,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":0},"30":{"desc":"神主5星","grade":6,"name":"神主5星","star":5,"tasklist":[11010,11011,11012,11013,11014,11015,11016,11017],"upgrade":11020}}{"10010":{"cup":0,"finish":86400,"level":5,"name":"争霸赛","start":1,"times":3,"week":[1,2,3,4,5,6,7]},"10020":{"cup":3000,"finish":86400,"level":5,"name":"排位赛","start":1,"times":10,"week":[1,2,3,4,5,6,7]}}{"0":{},"10030":{},"10110":{},"10120":{},"10130":{},"20050":{}}{"10001":{"count1":[],"count2":[],"count3":[],"count4":[0],"desc":"","diamond":[0,500],"gold":[20,25],"lv":1,"name":"一阶白银宝箱","showicon":"item_99","time":3,"totalcount":3},"10002":{"count1":[],"count2":[],"count3":[],"count4":[0],"desc":"","diamond":[0,500],"gold":[27,34],"lv":2,"name":"二阶白银宝箱","showicon":"item_99","time":3,"totalcount":4},"10003":{"count1":[0,20],"count2":[0,200],"count3":[],"count4":[0],"desc":"","diamond":[0,500],"gold":[34,43],"lv":3,"name":"三阶白银宝箱","showicon":"item_99","time":3,"totalcount":5},"10004":{"count1":[0,20],"count2":[0,200],"count3":[],"count4":[0],"desc":"","diamond":[0,500],"gold":[40,50],"lv":4,"name":"四阶白银宝箱","showicon":"item_99","time":3,"totalcount":6},"10005":{"count1":[0,20],"count2":[0,200],"count3":[],"count4":[0],"desc":"","diamond":[0,500],"gold":[46,58],"lv":5,"name":"五阶白银宝箱","showicon":"item_99","time":3,"totalcount":7},"10006":{"count1":[0,20],"count2":[0,200],"count3":[],"count4":[0],"desc":"","diamond":[0,500],"gold":[52,65],"lv":6,"name":"六阶白银宝箱","showicon":"item_99","time":3,"totalcount":8},"10007":{"count1":[0,20],"count2":[0,200],"count3":[],"count4":[0],"desc":"","diamond":[0,500],"gold":[58,73],"lv":7,"name":"七阶白银宝箱","showicon":"item_99","time":3,"totalcount":9},"10008":{"count1":[0,20],"count2":[0,200],"count3":[],"count4":[0],"desc":"","diamond":[0,500],"gold":[76,95],"lv":8,"name":"八阶白银宝箱","showicon":"item_99","time":3,"totalcount":11},"10009":{"count1":[0,20],"count2":[0,200],"count3":[],"count4":[0],"desc":"","diamond":[0,500],"gold":[101,120],"lv":9,"name":"九阶白银宝箱","showicon":"item_99","time":3,"totalcount":13},"10101":{"count1":[],"count2":[],"count3":[],"count4":[0],"desc":"","diamond":[0,500],"gold":[20,25],"lv":1,"name":"一阶白银宝箱","showicon":"item_99","time":0,"totalcount":3},"10102":{"count1":[],"count2":[],"count3":[],"count4":[0],"desc":"","diamond":[0,500],"gold":[27,34],"lv":2,"name":"二阶白银宝箱","showicon":"item_99","time":0,"totalcount":4},"10103":{"count1":[0,20],"count2":[0,200],"count3":[],"count4":[0],"desc":"","diamond":[0,500],"gold":[34,43],"lv":3,"name":"三阶白银宝箱","showicon":"item_99","time":0,"totalcount":5},"10104":{"count1":[0,20],"count2":[0,200],"count3":[],"count4":[0],"desc":"","diamond":[0,500],"gold":[40,50],"lv":4,"name":"四阶白银宝箱","showicon":"item_99","time":0,"totalcount":6},"10105":{"count1":[0,20],"count2":[0,200],"count3":[],"count4":[0],"desc":"","diamond":[0,500],"gold":[46,58],"lv":5,"name":"五阶白银宝箱","showicon":"item_99","time":0,"totalcount":7},"10106":{"count1":[0,20],"count2":[0,200],"count3":[],"count4":[0],"desc":"","diamond":[0,500],"gold":[52,65],"lv":6,"name":"六阶白银宝箱","showicon":"item_99","time":0,"totalcount":8},"10107":{"count1":[0,20],"count2":[0,200],"count3":[],"count4":[0],"desc":"","diamond":[0,500],"gold":[58,73],"lv":7,"name":"七阶白银宝箱","showicon":"item_99","time":0,"totalcount":9},"10108":{"count1":[0,20],"count2":[0,200],"count3":[],"count4":[0],"desc":"","diamond":[0,500],"gold":[76,95],"lv":8,"name":"八阶白银宝箱","showicon":"item_99","time":0,"totalcount":11},"10109":{"count1":[0,20],"count2":[0,200],"count3":[],"count4":[0],"desc":"","diamond":[0,500],"gold":[101,120],"lv":9,"name":"九阶白银宝箱","showicon":"item_99","time":0,"totalcount":13},"10201":{"count1":[],"count2":[],"count3":[1,1],"count4":[0],"desc":"","diamond":[0,500],"gold":[70,80],"lv":1,"name":"一阶黄金宝箱","showicon":"item_99","time":8,"totalcount":10},"10202":{"count1":[],"count2":[],"count3":[1,2],"count4":[0],"desc":"","diamond":[0,500],"gold":[95,108],"lv":2,"name":"二阶黄金宝箱","showicon":"item_99","time":8,"totalcount":14},"10203":{"count1":[0,200],"count2":[0,2000],"count3":[1,2],"count4":[0],"desc":"","diamond":[0,500],"gold":[119,136],"lv":3,"name":"三阶黄金宝箱","showicon":"item_99","time":8,"totalcount":17},"10204":{"count1":[0,200],"count2":[0,2000],"count3":[2,2],"count4":[1],"desc":"","diamond":[0,500],"gold":[140,160],"lv":4,"name":"四阶黄金宝箱","showicon":"item_99","time":8,"totalcount":20},"10205":{"count1":[0,200],"count2":[0,2000],"count3":[2,3],"count4":[1],"desc":"","diamond":[0,500],"gold":[161,184],"lv":5,"name":"五阶黄金宝箱","showicon":"item_99","time":8,"totalcount":23},"10206":{"count1":[0,200],"count2":[0,2000],"count3":[2,4],"count4":[1],"desc":"","diamond":[0,500],"gold":[182,208],"lv":6,"name":"六阶黄金宝箱","showicon":"item_99","time":8,"totalcount":26},"10207":{"count1":[0,200],"count2":[0,2000],"count3":[2,5],"count4":[1],"desc":"","diamond":[0,500],"gold":[203,232],"lv":7,"name":"七阶黄金宝箱","showicon":"item_99","time":8,"totalcount":29},"10208":{"count1":[0,200],"count2":[0,2000],"count3":[3,6],"count4":[1],"desc":"","diamond":[0,500],"gold":[266,304],"lv":8,"name":"八阶黄金宝箱","showicon":"item_99","time":8,"totalcount":38},"10209":{"count1":[0,200],"count2":[0,2000],"count3":[3,7],"count4":[1],"desc":"","diamond":[0,500],"gold":[311,356],"lv":9,"name":"九阶黄金宝箱","showicon":"item_99","time":8,"totalcount":49},"10301":{"count1":[],"count2":[],"count3":[1,1],"count4":[0],"desc":"","diamond":[],"gold":[700,800],"lv":1,"name":"一阶金币宝箱","showicon":"item_99","time":12,"totalcount":1},"10302":{"count1":[],"count2":[],"count3":[1,1],"count4":[0],"desc":"","diamond":[],"gold":[950,1080],"lv":2,"name":"二阶金币宝箱","showicon":"item_99","time":12,"totalcount":1},"10303":{"count1":[0,200],"count2":[0,2000],"count3":[1,1],"count4":[0],"desc":"","diamond":[],"gold":[1190,1360],"lv":3,"name":"三阶金币宝箱","showicon":"item_99","time":12,"totalcount":1},"10304":{"count1":[0,200],"count2":[0,2000],"count3":[1,1],"count4":[0],"desc":"","diamond":[],"gold":[1400,1600],"lv":4,"name":"四阶金币宝箱","showicon":"item_99","time":12,"totalcount":1},"10305":{"count1":[0,200],"count2":[0,2000],"count3":[1,1],"count4":[0],"desc":"","diamond":[],"gold":[1610,1840],"lv":5,"name":"五阶金币宝箱","showicon":"item_99","time":12,"totalcount":1},"10306":{"count1":[0,200],"count2":[0,2000],"count3":[1,1],"count4":[0],"desc":"","diamond":[],"gold":[1820,2080],"lv":6,"name":"六阶金币宝箱","showicon":"item_99","time":12,"totalcount":1},"10307":{"count1":[0,200],"count2":[0,2000],"count3":[1,1],"count4":[0],"desc":"","diamond":[],"gold":[2030,2320],"lv":7,"name":"七阶金币宝箱","showicon":"item_99","time":12,"totalcount":1},"10308":{"count1":[0,200],"count2":[0,2000],"count3":[1,1],"count4":[0],"desc":"","diamond":[],"gold":[2660,3040],"lv":8,"name":"八阶金币宝箱","showicon":"item_99","time":12,"totalcount":1},"10309":{"count1":[0,200],"count2":[0,2000],"count3":[1,1],"count4":[0],"desc":"","diamond":[],"gold":[3110,3560],"lv":9,"name":"九阶金币宝箱","showicon":"item_99","time":12,"totalcount":1},"10401":{"count1":[],"count2":[1,1],"count3":[6,8],"count4":[1],"desc":"","diamond":[0,500],"gold":[200,250],"lv":1,"name":"一阶神秘宝箱","showicon":"item_99","time":12,"totalcount":30},"10402":{"count1":[],"count2":[1,2],"count3":[8,10],"count4":[1],"desc":"","diamond":[0,500],"gold":[270,338],"lv":2,"name":"二阶神秘宝箱","showicon":"item_99","time":12,"totalcount":41},"10403":{"count1":[0,200],"count2":[1,3],"count3":[10,12,1],"count4":[1],"desc":"","diamond":[0,500],"gold":[340,425],"lv":3,"name":"三阶神秘宝箱","showicon":"item_99","time":12,"totalcount":51},"10404":{"count1":[0,200],"count2":[2,3],"count3":[12,15,1],"count4":[2],"desc":"","diamond":[0,500],"gold":[400,500],"lv":4,"name":"四阶神秘宝箱","showicon":"item_99","time":12,"totalcount":60},"10405":{"count1":[0,200],"count2":[2,4],"count3":[13,16,1],"count4":[2],"desc":"","diamond":[0,500],"gold":[460,575],"lv":5,"name":"五阶神秘宝箱","showicon":"item_99","time":12,"totalcount":69},"10406":{"count1":[0,200],"count2":[2,5],"count3":[15,18,1],"count4":[2],"desc":"","diamond":[0,500],"gold":[520,650],"lv":6,"name":"六阶神秘宝箱","showicon":"item_99","time":12,"totalcount":78},"10407":{"count1":[0,200],"count2":[2,6],"count3":[17,22,1],"count4":[2],"desc":"","diamond":[0,500],"gold":[580,725],"lv":7,"name":"七阶神秘宝箱","showicon":"item_99","time":12,"totalcount":87},"10408":{"count1":[0,200],"count2":[3,6],"count3":[22,30,1],"count4":[2],"desc":"","diamond":[0,500],"gold":[760,950],"lv":8,"name":"八阶神秘宝箱","showicon":"item_99","time":12,"totalcount":114},"10409":{"count1":[0,200],"count2":[3,7],"count3":[33,45,1],"count4":[2],"desc":"","diamond":[0,500],"gold":[986,1185],"lv":9,"name":"九阶神秘宝箱","showicon":"item_99","time":12,"totalcount":130},"10501":{"count1":[],"count2":[3,3],"count3":[],"count4":[0],"desc":"","diamond":[],"gold":[],"lv":1,"name":"一阶史诗宝箱","showicon":"item_99","time":12,"totalcount":3},"10502":{"count1":[],"count2":[5,5],"count3":[],"count4":[0],"desc":"","diamond":[],"gold":[],"lv":2,"name":"二阶史诗宝箱","showicon":"item_99","time":12,"totalcount":5},"10503":{"count1":[],"count2":[7,7],"count3":[],"count4":[0],"desc":"","diamond":[],"gold":[],"lv":3,"name":"三阶史诗宝箱","showicon":"item_99","time":12,"totalcount":7},"10504":{"count1":[],"count2":[9,9],"count3":[],"count4":[0],"desc":"","diamond":[],"gold":[],"lv":4,"name":"四阶史诗宝箱","showicon":"item_99","time":12,"totalcount":9},"10505":{"count1":[],"count2":[11,11],"count3":[],"count4":[0],"desc":"","diamond":[],"gold":[],"lv":5,"name":"五阶史诗宝箱","showicon":"item_99","time":12,"totalcount":11},"10506":{"count1":[],"count2":[13,13],"count3":[],"count4":[0],"desc":"","diamond":[],"gold":[],"lv":6,"name":"六阶史诗宝箱","showicon":"item_99","time":12,"totalcount":13},"10507":{"count1":[],"count2":[15,15],"count3":[],"count4":[0],"desc":"","diamond":[],"gold":[],"lv":7,"name":"七阶史诗宝箱","showicon":"item_99","time":12,"totalcount":15},"10508":{"count1":[],"count2":[17,17],"count3":[],"count4":[0],"desc":"","diamond":[],"gold":[],"lv":8,"name":"八阶史诗宝箱","showicon":"item_99","time":12,"totalcount":17},"10509":{"count1":[],"count2":[20,20],"count3":[],"count4":[0],"desc":"","diamond":[],"gold":[],"lv":9,"name":"九阶史诗宝箱","showicon":"item_99","time":12,"totalcount":20},"10601":{"count1":[],"count2":[6,8],"count3":[36,48,1],"count4":[2],"desc":"","diamond":[0,500],"gold":[1200,1500],"lv":1,"name":"一阶神秘宝藏","showicon":"item_99","time":24,"totalcount":180},"10602":{"count1":[],"count2":[8,12],"count3":[48,60,1],"count4":[2],"desc":"","diamond":[0,500],"gold":[1620,2025],"lv":2,"name":"二阶神秘宝藏","showicon":"item_99","time":24,"totalcount":243},"10603":{"count1":[1,1],"count2":[10,15,1],"count3":[61,85,1],"count4":[2],"desc":"","diamond":[0,500],"gold":[2040,2550],"lv":3,"name":"三阶神秘宝藏","showicon":"item_99","time":24,"totalcount":306},"10604":{"count1":[1,1],"count2":[12,18,1],"count3":[72,105,1],"count4":[2],"desc":"","diamond":[0,500],"gold":[2400,3000],"lv":4,"name":"四阶神秘宝藏","showicon":"item_99","time":24,"totalcount":360},"10605":{"count1":[1,1],"count2":[13,19,1],"count3":[82,125,1],"count4":[2],"desc":"","diamond":[0,500],"gold":[2760,3450],"lv":5,"name":"五阶神秘宝藏","showicon":"item_99","time":24,"totalcount":414},"10606":{"count1":[1,1],"count2":[15,23,1],"count3":[93,150,1],"count4":[2],"desc":"","diamond":[0,500],"gold":[3120,3900],"lv":6,"name":"六阶神秘宝藏","showicon":"item_99","time":24,"totalcount":468},"10607":{"count1":[1,1],"count2":[17,26,1],"count3":[105,200,1],"count4":[2],"desc":"","diamond":[0,500],"gold":[3480,4350],"lv":7,"name":"七阶神秘宝藏","showicon":"item_99","time":24,"totalcount":522},"10608":{"count1":[1,1],"count2":[22,33,1],"count3":[136,250,1],"count4":[2],"desc":"","diamond":[0,500],"gold":[4560,5700],"lv":8,"name":"八阶神秘宝藏","showicon":"item_99","time":24,"totalcount":684},"10609":{"count1":[1,1],"count2":[25,37,1],"count3":[176,300,1],"count4":[2],"desc":"","diamond":[0,500],"gold":[5660,7000],"lv":9,"name":"九阶神秘宝藏","showicon":"item_99","time":24,"totalcount":790},"10701":{"count1":[],"count2":[6,6],"count3":[],"count4":[0],"desc":"","diamond":[],"gold":[],"lv":1,"name":"一阶传奇宝箱","showicon":"item_99","time":24,"totalcount":6},"10702":{"count1":[],"count2":[10,10],"count3":[],"count4":[0],"desc":"","diamond":[],"gold":[],"lv":2,"name":"二阶传奇宝箱","showicon":"item_99","time":24,"totalcount":10},"10703":{"count1":[1,1],"count2":[],"count3":[],"count4":[0],"desc":"","diamond":[],"gold":[],"lv":3,"name":"三阶传奇宝箱","showicon":"item_99","time":24,"totalcount":1},"10704":{"count1":[1,1],"count2":[],"count3":[],"count4":[0],"desc":"","diamond":[],"gold":[],"lv":4,"name":"四阶传奇宝箱","showicon":"item_99","time":24,"totalcount":1},"10705":{"count1":[1,1],"count2":[],"count3":[],"count4":[0],"desc":"","diamond":[],"gold":[],"lv":5,"name":"五阶传奇宝箱","showicon":"item_99","time":24,"totalcount":1},"10706":{"count1":[1,1],"count2":[],"count3":[],"count4":[0],"desc":"","diamond":[],"gold":[],"lv":6,"name":"六阶传奇宝箱","showicon":"item_99","time":24,"totalcount":1},"10707":{"count1":[1,1],"count2":[],"count3":[],"count4":[0],"desc":"","diamond":[],"gold":[],"lv":7,"name":"七阶传奇宝箱","showicon":"item_99","time":24,"totalcount":1},"10708":{"count1":[1,1],"count2":[],"count3":[],"count4":[0],"desc":"","diamond":[],"gold":[],"lv":8,"name":"八阶传奇宝箱","showicon":"item_99","time":24,"totalcount":1},"10709":{"count1":[1,1],"count2":[],"count3":[],"count4":[0],"desc":"","diamond":[],"gold":[],"lv":9,"name":"九阶传奇宝箱","showicon":"item_99","time":24,"totalcount":1}}{"102":{"att":0,"attackspeed":0,"breaktype":[0],"cd":1000,"count":1,"crit":0,"cureadd":0,"def":0,"desc":"不可移动不可攻击不可被锁定","hidetype":[],"hp":0,"hurtadd":0,"maxlayer":1,"move":[0],"movedir":0,"movespeed":0,"movespeed2":[],"name":"准备中","permanent":0,"power":0,"protect":0,"show":0,"suck":0,"time":1000,"type":[1,2,3]},"103":{"att":0,"attackspeed":0,"breaktype":[0],"cd":1000,"count":1,"crit":0,"cureadd":0,"def":0,"desc":"不可移动不可攻击","hidetype":[],"hp":0,"hurtadd":0,"maxlayer":1,"move":[0],"movedir":0,"movespeed":0,"movespeed2":[],"name":"部署中","permanent":0,"power":0,"protect":0,"show":0,"suck":0,"time":1000,"type":[1,2]},"110":{"att":0,"attackspeed":0,"breaktype":[0],"cd":1000000,"count":1,"crit":0,"cureadd":0,"def":0,"desc":"不可移动不可攻击不可被锁定","hidetype":[],"hp":0,"hurtadd":0,"maxlayer":1,"move":[0],"movedir":0,"movespeed":0,"movespeed2":[],"name":"死亡后灵魂状态","permanent":0,"power":0,"protect":0,"show":0,"suck":0,"time":1000000,"type":[1,2,3]},"9001":{"att":0,"attackspeed":0,"breaktype":[0],"cd":1000000,"count":1,"crit":0,"cureadd":0,"def":0,"desc":"只用来做表现用","hidetype":[0],"hp":0,"hurtadd":0,"maxlayer":1,"move":[0],"movedir":0,"movespeed":0,"movespeed2":[0],"name":"防御塔燃烧","permanent":0,"power":0,"protect":0,"show":9001,"suck":0,"time":1000000,"type":[0]},"10030":{"att":0,"attackspeed":0,"breaktype":[2],"cd":1000000,"count":1,"crit":0,"cureadd":0,"def":0,"desc":"皇子冲锋buff","hidetype":[0],"hp":0,"hurtadd":0,"maxlayer":1,"move":[0],"movedir":0,"movespeed":100,"movespeed2":[0],"name":"皇子冲锋buff","permanent":0,"power":0,"protect":0,"show":0,"suck":0,"time":1000000,"type":[0]},"10110":{"att":0,"attackspeed":0,"breaktype":[0],"cd":1000000,"count":1,"crit":0,"cureadd":0,"def":0,"desc":"伪装","hidetype":[3],"hp":0,"hurtadd":0,"maxlayer":1,"move":[0],"movedir":0,"movespeed":0,"movespeed2":[0],"name":"特洛伊木马","permanent":0,"power":0,"protect":0,"show":0,"suck":0,"time":1000000,"type":[0]},"10250":{"att":0,"attackspeed":-30,"breaktype":[0],"cd":1000,"count":1,"crit":0,"cureadd":0,"def":0,"desc":"冰法减速buff","hidetype":[0],"hp":0,"hurtadd":0,"maxlayer":1,"move":[0],"movedir":0,"movespeed":-30,"movespeed2":[0],"name":"冰法减速buff","permanent":0,"power":0,"protect":0,"show":0,"suck":0,"time":2500,"type":[6]},"10270":{"att":0,"attackspeed":0,"breaktype":[0],"cd":1000000,"count":1,"crit":0,"cureadd":0,"def":0,"desc":"猴子嘲讽buff","hidetype":[0],"hp":0,"hurtadd":0,"maxlayer":1,"move":[0],"movedir":0,"movespeed":0,"movespeed2":[0],"name":"猴子嘲讽buff","permanent":0,"power":0,"protect":0,"show":0,"suck":0,"time":1000000,"type":[11]},"30010":{"att":0,"attackspeed":0,"breaktype":[0],"cd":1000,"count":1,"crit":0,"cureadd":0,"def":0,"desc":"击退目标","hidetype":[0],"hp":0,"hurtadd":0,"maxlayer":1,"move":[40,-40],"movedir":2,"movespeed":0,"movespeed2":[0],"name":"烈焰冲击击退","permanent":0,"power":3,"protect":0,"show":0,"suck":0,"time":1000,"type":[1,2]},"30030":{"att":0,"attackspeed":0,"breaktype":[0],"cd":1000,"count":1,"crit":0,"cureadd":0,"def":0,"desc":"击退目标","hidetype":[0],"hp":0,"hurtadd":0,"maxlayer":1,"move":[40,-40],"movedir":2,"movespeed":0,"movespeed2":[0],"name":"海浪击退","permanent":0,"power":10,"protect":0,"show":0,"suck":0,"time":1000,"type":[1,2]},"30040":{"att":0,"attackspeed":0,"breaktype":[0],"cd":1000,"count":1,"crit":0,"cureadd":0,"def":0,"desc":"击退目标","hidetype":[0],"hp":0,"hurtadd":0,"maxlayer":1,"move":[40,-40],"movedir":2,"movespeed":0,"movespeed2":[0],"name":"星陨术击退","permanent":0,"power":10,"protect":0,"show":0,"suck":0,"time":1000,"type":[1,2]},"30050":{"att":0,"attackspeed":30,"breaktype":[0],"cd":1000000,"count":1,"crit":0,"cureadd":0,"def":0,"desc":"增加攻速和移速","hidetype":[],"hp":0,"hurtadd":0,"maxlayer":1,"move":[0],"movedir":0,"movespeed":0,"movespeed2":[0],"name":"鼓舞","permanent":0,"power":0,"protect":0,"show":30011,"suck":0,"time":1000000,"type":[0]},"30060":{"att":0,"attackspeed":0,"breaktype":[0],"cd":1000,"count":1,"crit":0,"cureadd":0,"def":0,"desc":"表演预留","hidetype":[],"hp":0,"hurtadd":0,"maxlayer":1,"move":[0],"movedir":0,"movespeed":0,"movespeed2":[0],"name":"燃烧油","permanent":0,"power":0,"protect":0,"show":30011,"suck":0,"time":1000,"type":[0]},"30070":{"att":0,"attackspeed":-30,"breaktype":[0],"cd":2500,"count":1,"crit":0,"cureadd":0,"def":0,"desc":"减速","hidetype":[],"hp":0,"hurtadd":0,"maxlayer":1,"move":[],"movedir":0,"movespeed":-30,"movespeed2":[],"name":"冰晶术","permanent":0,"power":0,"protect":0,"show":0,"suck":0,"time":2500,"type":[0]},"30080":{"att":0,"attackspeed":0,"breaktype":[0],"cd":4000,"count":1,"crit":0,"cureadd":0,"def":0,"desc":"变鸡","hidetype":[],"hp":0,"hurtadd":0,"maxlayer":1,"move":[],"movedir":0,"movespeed":0,"movespeed2":[],"name":"变鸡术","permanent":0,"power":0,"protect":0,"show":0,"suck":0,"time":4000,"type":[1,2]},"30090":{"att":0,"attackspeed":0,"breaktype":[0],"cd":1000000,"count":1,"crit":0,"cureadd":0,"def":0,"desc":"增加移速","hidetype":[],"hp":0,"hurtadd":0,"maxlayer":1,"move":[0],"movedir":0,"movespeed":30,"movespeed2":[0],"name":"神行术","permanent":0,"power":0,"protect":0,"show":30011,"suck":0,"time":1000000,"type":[0]}}{"0":{},"30090":{}}{"1":{"hero":0,"icon":"icon_kpsx_09","name":"生命","postfix":"","prefix":""},"2":{"hero":0,"icon":"icon_kpsx_05","name":"攻击速度","postfix":"秒","prefix":""},"3":{"hero":0,"icon":"icon_kpsx_08","name":"射程","postfix":"","prefix":""},"4":{"hero":0,"icon":"icon_kpsx_02","name":"伤害","postfix":"","prefix":""},"5":{"hero":0,"icon":"icon_kpsx_06","name":"移动速度","postfix":"","prefix":""},"6":{"hero":0,"icon":"icon_kpsx_07","name":"目标","postfix":"","prefix":""},"7":{"hero":0,"icon":"icon_kpsx_04","name":"死亡附加伤害","postfix":"","prefix":""},"8":{"hero":0,"icon":"icon_kpsx_03","name":"范围伤害","postfix":"","prefix":""},"9":{"hero":0,"icon":"icon_kpsx_14","name":"数量","postfix":"","prefix":""},"10":{"hero":0,"icon":"icon_kpsx_01","name":"对建筑伤害","postfix":"","prefix":""},"11":{"hero":0,"icon":"icon_kpsx_13","name":"范围","postfix":"","prefix":""},"12":{"hero":0,"icon":"icon_kpsx_16","name":"眩晕持续时间","postfix":"秒","prefix":""},"13":{"hero":0,"icon":"icon_kpsx_16","name":"减速持续时间","postfix":"秒","prefix":""},"14":{"hero":0,"icon":"icon_kpsx_11","name":"持续时间","postfix":"秒","prefix":""},"15":{"hero":0,"icon":"icon_kpsx_11","name":"加速持续时间","postfix":"秒","prefix":""},"16":{"hero":0,"icon":"icon_kpsx_17","name":"提速","postfix":"","prefix":""},"17":{"hero":0,"icon":"icon_kpsx_01","name":"待定","postfix":"","prefix":""},"18":{"hero":0,"icon":"icon_kpsx_10","name":"护盾生命值","postfix":"","prefix":""},"19":{"hero":0,"icon":"icon_kpsx_12","name":"部署时间","postfix":"秒","prefix":""},"20":{"hero":0,"icon":"icon_kpsx_18","name":"冲锋伤害","postfix":"","prefix":""},"21":{"hero":0,"icon":"icon_kpsx_11","name":"召唤速度","postfix":"秒","prefix":""},"22":{"hero":0,"icon":"icon_kpsx_02","name":"登场伤害","postfix":"","prefix":""},"23":{"hero":0,"icon":"icon_kpsx_09","name":"水晶生命","postfix":"","prefix":""},"51":{"hero":20050,"icon":"icon_kpsx_15","name":"战士等级","postfix":"","prefix":""},"52":{"hero":0,"icon":"icon_kpsx_14","name":"战士数量","postfix":"","prefix":""},"53":{"hero":20040,"icon":"icon_kpsx_15","name":"召唤士兵等级","postfix":"","prefix":""}}{"1":{"cardlevel":3,"cup":300,"map":1001},"2":{"cardlevel":5,"cup":600,"map":1002},"3":{"cardlevel":7,"cup":900,"map":1003},"4":{"cardlevel":9,"cup":1200,"map":1004},"5":{"cardlevel":10,"cup":1500,"map":1005},"6":{"cardlevel":11,"cup":1800,"map":1006},"7":{"cardlevel":12,"cup":100000,"map":1007}}{"1001":{"condition":[],"desc":"任务积分奖励1级","items":[[10001,1]],"max":1,"min":1},"1002":{"condition":[],"desc":"任务积分奖励2级","items":[[10001,1]],"max":2,"min":2},"1003":{"condition":[],"desc":"任务积分奖励3级","items":[[10001,1]],"max":3,"min":3},"1004":{"condition":[],"desc":"任务积分奖励4级","items":[[10001,1]],"max":4,"min":4},"1005":{"condition":[],"desc":"任务积分奖励5级","items":[[10001,1]],"max":5,"min":5},"1006":{"condition":[],"desc":"任务积分奖励6级","items":[[10001,1]],"max":6,"min":6},"1007":{"condition":[],"desc":"任务积分奖励7级","items":[[10001,1]],"max":7,"min":7},"1008":{"condition":[],"desc":"任务积分奖励8级","items":[[10001,1]],"max":8,"min":8},"1009":{"condition":[],"desc":"任务积分奖励9级","items":[[10001,1]],"max":9,"min":9},"1010":{"condition":[],"desc":"任务积分奖励10级","items":[[10001,1]],"max":10,"min":10},"1011":{"condition":[],"desc":"任务积分奖励11级","items":[[10001,1]],"max":11,"min":11},"1012":{"condition":[],"desc":"任务积分奖励12级","items":[[10001,1]],"max":12,"min":12},"1013":{"condition":[],"desc":"任务积分奖励13级","items":[[10001,1]],"max":13,"min":13},"1014":{"condition":[],"desc":"任务积分奖励14级","items":[[10001,1]],"max":14,"min":14},"1015":{"condition":[],"desc":"任务积分奖励15级","items":[[10001,1]],"max":15,"min":15},"1201":{"condition":[],"desc":"","items":[[2,100],[3,10]],"max":1,"min":1},"1202":{"condition":[],"desc":"","items":[[2,100],[3,10]],"max":2,"min":2},"1203":{"condition":[],"desc":"","items":[[2,100],[3,10]],"max":3,"min":3},"1204":{"condition":[],"desc":"","items":[[2,100],[3,10]],"max":4,"min":4},"1205":{"condition":[],"desc":"","items":[[2,100],[3,10]],"max":5,"min":5},"1206":{"condition":[],"desc":"","items":[[2,100],[3,10]],"max":6,"min":6},"1207":{"condition":[],"desc":"","items":[[2,100],[3,10]],"max":7,"min":7},"1208":{"condition":[],"desc":"","items":[[2,100],[3,10]],"max":8,"min":8},"1209":{"condition":[],"desc":"","items":[[2,100],[3,10]],"max":9,"min":9},"1210":{"condition":[],"desc":"","items":[[2,100],[3,10]],"max":10,"min":10},"1211":{"condition":[],"desc":"","items":[[2,100],[3,10]],"max":11,"min":11},"1212":{"condition":[],"desc":"","items":[[2,100],[3,10]],"max":12,"min":12},"1213":{"condition":[],"desc":"","items":[[2,100],[3,10]],"max":13,"min":13},"1214":{"condition":[],"desc":"","items":[[2,100],[3,10]],"max":14,"min":14},"1215":{"condition":[],"desc":"","items":[[2,100],[3,10]],"max":15,"min":15},"1301":{"condition":[],"desc":"","items":[[2,100]],"max":1,"min":1},"1302":{"condition":[],"desc":"","items":[[2,100]],"max":2,"min":2},"1303":{"condition":[],"desc":"","items":[[2,100]],"max":3,"min":3},"1304":{"condition":[],"desc":"","items":[[2,100]],"max":4,"min":4},"1305":{"condition":[],"desc":"","items":[[2,100]],"max":5,"min":5},"1306":{"condition":[],"desc":"","items":[[2,100]],"max":6,"min":6},"1307":{"condition":[],"desc":"","items":[[2,100]],"max":7,"min":7},"1308":{"condition":[],"desc":"","items":[[2,100]],"max":8,"min":8},"1309":{"condition":[],"desc":"","items":[[2,100]],"max":9,"min":9},"1310":{"condition":[],"desc":"","items":[[2,100]],"max":10,"min":10},"1311":{"condition":[],"desc":"","items":[[2,100]],"max":11,"min":11},"1312":{"condition":[],"desc":"","items":[[2,100]],"max":12,"min":12},"1313":{"condition":[],"desc":"","items":[[2,100]],"max":13,"min":13},"1314":{"condition":[],"desc":"","items":[[2,100]],"max":14,"min":14},"1315":{"condition":[],"desc":"","items":[[2,100]],"max":15,"min":15},"1401":{"condition":[3,3000],"desc":"4000-4249","items":[[10001,1]],"max":4249,"min":4000},"1402":{"condition":[3,3000],"desc":"4250-4499","items":[[10002,1]],"max":4499,"min":4250},"1403":{"condition":[3,3000],"desc":"4500-4749","items":[[10003,1]],"max":4749,"min":4500},"1404":{"condition":[3,3000],"desc":"4750-4999","items":[[10004,1]],"max":4999,"min":4750},"1405":{"condition":[3,3000],"desc":"5000-5249","items":[[10005,1]],"max":5249,"min":5000},"1406":{"condition":[3,3000],"desc":"5250-5499","items":[[10006,1]],"max":5499,"min":5250},"1407":{"condition":[3,3000],"desc":"5500-5749","items":[[10007,1]],"max":5749,"min":5500},"1408":{"condition":[3,3000],"desc":"5750-5999","items":[[10008,1]],"max":5999,"min":5750},"1409":{"condition":[3,3000],"desc":"6000以上","items":[[10009,1]],"max":999999,"min":6000},"1501":{"condition":[3,3000],"desc":"4000-4249","items":[[10001,1]],"max":4249,"min":4000},"1502":{"condition":[3,3000],"desc":"4250-4499","items":[[10002,1]],"max":4499,"min":4250},"1503":{"condition":[3,3000],"desc":"4500-4749","items":[[10003,1]],"max":4749,"min":4500},"1504":{"condition":[3,3000],"desc":"4750-4999","items":[[10004,1]],"max":4999,"min":4750},"1505":{"condition":[3,3000],"desc":"5000-5249","items":[[10005,1]],"max":5249,"min":5000},"1506":{"condition":[3,3000],"desc":"5250-5499","items":[[10006,1]],"max":5499,"min":5250},"1507":{"condition":[3,3000],"desc":"5500-5749","items":[[10007,1]],"max":5749,"min":5500},"1508":{"condition":[3,3000],"desc":"5750-5999","items":[[10008,1]],"max":5999,"min":5750},"1509":{"condition":[3,3000],"desc":"6000以上","items":[[10009,1]],"max":999999,"min":6000},"2001":{"condition":[3,3000],"desc":"赛事第1名奖励","items":[[2,100],[3,5],[10001,1]],"max":1,"min":1},"2002":{"condition":[3,3000],"desc":"赛事第2名奖励","items":[[2,100],[3,5],[10001,2]],"max":2,"min":2},"2003":{"condition":[3,3000],"desc":"赛事第3名奖励","items":[[2,100],[3,5],[10001,3]],"max":3,"min":3},"2004":{"condition":[3,3000],"desc":"赛事第4-10名奖励","items":[[2,100],[3,5],[10001,4]],"max":10,"min":4},"2005":{"condition":[3,3000],"desc":"赛事第11-50名奖励","items":[[2,100],[3,5],[10001,5]],"max":50,"min":11},"2006":{"condition":[3,3000],"desc":"赛事第51-100名奖励","items":[[2,100],[3,5],[10001,6]],"max":100,"min":51},"2007":{"condition":[3,3000],"desc":"赛事第101-500名奖励","items":[[2,100],[3,5],[10001,7]],"max":500,"min":101},"2008":{"condition":[3,3000],"desc":"赛事第501-1000名奖励","items":[[2,100],[3,5],[10001,8]],"max":1000,"min":501},"2009":{"condition":[3,3000],"desc":"赛事第1001名以后奖励","items":[[2,100],[3,5],[10001,9]],"max":999999,"min":1001},"3001":{"condition":[3,3000],"desc":"赛事第1名奖励","items":[[2,100],[3,5],[10001,1]],"max":1,"min":1},"3002":{"condition":[3,3000],"desc":"赛事第2名奖励","items":[[2,100],[3,5],[10001,2]],"max":2,"min":2},"3003":{"condition":[3,3000],"desc":"赛事第3名奖励","items":[[2,100],[3,5],[10001,3]],"max":3,"min":3},"3004":{"condition":[3,3000],"desc":"赛事第4-10名奖励","items":[[2,100],[3,5],[10001,4]],"max":10,"min":4},"3005":{"condition":[3,3000],"desc":"赛事第11-50名奖励","items":[[2,100],[3,5],[10001,5]],"max":50,"min":11},"3006":{"condition":[3,3000],"desc":"赛事第51-100名奖励","items":[[2,100],[3,5],[10001,6]],"max":100,"min":51},"3007":{"condition":[3,3000],"desc":"赛事第101-500名奖励","items":[[2,100],[3,5],[10001,7]],"max":500,"min":101},"3008":{"condition":[3,3000],"desc":"赛事第501-1000名奖励","items":[[2,100],[3,5],[10001,8]],"max":1000,"min":501},"3009":{"condition":[3,3000],"desc":"赛事第1001名以后奖励","items":[[2,100],[3,5],[10001,9]],"max":999999,"min":1001}}{"1001":{"aniname":"stand","clipname":"Arrow01","filename":"Arrow01","loop":0,"name":"弓箭1","time":0,"type":1},"1002":{"aniname":"stand","clipname":"Arrow02","filename":"Arrow02","loop":0,"name":"弓箭2","time":0,"type":1},"1003":{"aniname":"stand","clipname":"arrow_basic","filename":"effect_common","loop":0,"name":"弓箭3","time":0,"type":1},"1011":{"aniname":"stand","clipname":"","filename":"","loop":1,"name":"警戒叹号","time":0,"type":2},"1101":{"aniname":"stand","clipname":"die","filename":"effect_common","loop":1,"name":"死亡特效","time":0,"type":1},"1102":{"aniname":"stand","clipname":"deploy01","filename":"effect_common","loop":0,"name":"部署特效1","time":0,"type":1},"1103":{"aniname":"stand","clipname":"deploy02","filename":"effect_common","loop":0,"name":"部署特效2","time":0,"type":1},"1104":{"aniname":"stand","clipname":"deploy03","filename":"effect_common","loop":0,"name":"部署特效3","time":0,"type":1},"2001":{"aniname":"2001","clipname":"effect_home01","filename":"effect_home01","loop":1,"name":"匹配中蓝","time":0,"type":1},"2002":{"aniname":"2002","clipname":"effect_home01","filename":"effect_home01","loop":1,"name":"匹配中红","time":0,"type":1},"9001":{"aniname":"9001","clipname":"effect_war01","filename":"effect_war01","loop":1,"name":"防御塔燃烧","time":0,"type":1},"9002":{"aniname":"9002","clipname":"effect_war01","filename":"effect_war01","loop":1,"name":"部署特效-圆圈","time":0,"type":1},"9003":{"aniname":"9003","clipname":"effect_war01","filename":"effect_war01","loop":0,"name":"部署特效-烟雾","time":0,"type":1},"9004":{"aniname":"9004","clipname":"effect_war01","filename":"effect_war01","loop":0,"name":"部署特效-时钟","time":0,"type":1},"9005":{"aniname":"9005","clipname":"effect_war01","filename":"effect_war01","loop":0,"name":"死亡特效","time":0,"type":1},"9010":{"aniname":"9010","clipname":"effect_war01","filename":"effect_war01","loop":0,"name":"通用弓箭","time":0,"type":1},"9501":{"aniname":"9501","clipname":"effect_war50","filename":"effect_war50","loop":0,"name":"双倍法力","time":0,"type":2},"9502":{"aniname":"9502","clipname":"effect_war50","filename":"effect_war50","loop":0,"name":"决胜时刻","time":0,"type":2},"9503":{"aniname":"9503","clipname":"effect_war50","filename":"effect_war50","loop":1,"name":"警戒叹号","time":0,"type":2},"10051":{"aniname":"10051","clipname":"effect_war02","filename":"effect_war02","loop":1,"name":"01枪子弹飞行","time":0,"type":1},"10141":{"aniname":"10141","clipname":"effect_war02","filename":"effect_war02","loop":1,"name":"01石头飞行","time":0,"type":1},"10142":{"aniname":"10142","clipname":"effect_war02","filename":"effect_war02","loop":0,"name":"02石头爆炸","time":0,"type":1},"10251":{"aniname":"10251","clipname":"effect_war02","filename":"effect_war02","loop":1,"name":"01蓝法球飞行","time":0,"type":1},"10252":{"aniname":"10252","clipname":"effect_war02","filename":"effect_war02","loop":0,"name":"02蓝法球爆炸","time":0,"type":1},"30010":{"aniname":"stand","clipname":"effect_30010","filename":"effect_30010","loop":1,"name":"狂暴法术特效","time":0,"type":2},"99011":{"aniname":"99011","clipname":"effect_war02","filename":"effect_war02","loop":1,"name":"99010火球飞行","time":0,"type":1},"99012":{"aniname":"99012","clipname":"effect_war02","filename":"effect_war02","loop":0,"name":"99010火球爆炸","time":0,"type":1},"99021":{"aniname":"99021","clipname":"effect_war02","filename":"effect_war02","loop":1,"name":"99020火球飞行","time":0,"type":1},"99022":{"aniname":"99022","clipname":"effect_war02","filename":"effect_war02","loop":0,"name":"99020火球爆炸","time":0,"type":1}}{"1001":{"icon":"emoji_01"},"1002":{"icon":"emoji_02"},"1003":{"icon":"emoji_03"},"2001":{"icon":"emoji_04"},"2002":{"icon":"emoji_05"},"2003":{"icon":"emoji_06"}}{"1001":{"icon":"icon_jz_hui_01","iconbg":""},"1002":{"icon":"icon_jz_hui_02","iconbg":""},"1003":{"icon":"icon_jz_hui_03","iconbg":""},"2001":{"icon":"","iconbg":"icon_jz_huidi_01"},"2002":{"icon":"","iconbg":"icon_jz_huidi_02"},"2003":{"icon":"","iconbg":"icon_jz_huidi_03"}}{"10010":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3275,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"5费巨人","normalskill":[10010],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,3275],[4,211],["2","1.5"],["6","建筑与器械"],["5","慢"],["3","近战"]],"upcost":[[10010,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3275,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"5费巨人","normalskill":[10010],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,3286],[4,213],["2","1.5"],["6","建筑与器械"],["5","慢"],["3","近战"]],"upcost":[[10010,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3275,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"5费巨人","normalskill":[10010],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,3386],[4,215],["2","1.5"],["6","建筑与器械"],["5","慢"],["3","近战"]],"upcost":[[10010,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3275,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"5费巨人","normalskill":[10010],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,3486],[4,217],["2","1.5"],["6","建筑与器械"],["5","慢"],["3","近战"]],"upcost":[[10010,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3275,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"5费巨人","normalskill":[10010],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,3586],[4,219],["2","1.5"],["6","建筑与器械"],["5","慢"],["3","近战"]],"upcost":[[10010,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3275,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"5费巨人","normalskill":[10010],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,3686],[4,221],["2","1.5"],["6","建筑与器械"],["5","慢"],["3","近战"]],"upcost":[[10010,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3275,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"5费巨人","normalskill":[10010],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,3886],[4,223],["2","1.5"],["6","建筑与器械"],["5","慢"],["3","近战"]],"upcost":[[10010,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3275,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"5费巨人","normalskill":[10010],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,3996],[4,225],["2","1.5"],["6","建筑与器械"],["5","慢"],["3","近战"]],"upcost":[[10010,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3275,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"5费巨人","normalskill":[10010],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,4222],[4,227],["2","1.5"],["6","建筑与器械"],["5","慢"],["3","近战"]],"upcost":[],"upexp":0},"camp":0,"classlv":1,"clipname":10010,"cost":5,"desc":"手脚并不灵活，但是皮糙肉厚。","effectrely":[],"herotype":1,"landtype":1,"mass":5,"name":"猪八戒","puttype":1,"quality":1,"resrely":[],"scale":1},"10020":{"0":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":3,"lifetime":0,"mainhero":[[20010,0,-20,0],[20010,0,20,100]],"movespeed":0,"name1":"2费自爆炸弹","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,275],[4,325],["6","建筑与器械"],["5","极快"],["3","近战"],[9,2]],"upcost":[[10020,10],[2,50]],"upexp":5},"1":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":3,"lifetime":0,"mainhero":[[20010,0,-20,0],[20010,0,20,100]],"movespeed":0,"name1":"2费自爆炸弹","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,275],[4,325],["6","建筑与器械"],["5","极快"],["3","近战"],[9,2]],"upcost":[[10020,10],[2,50]],"upexp":10},"2":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":3,"lifetime":0,"mainhero":[[20010,0,-20,0],[20010,0,20,100]],"movespeed":0,"name1":"2费自爆炸弹","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,275],[4,325],["6","建筑与器械"],["5","极快"],["3","近战"],[9,2]],"upcost":[[10020,10],[2,50]],"upexp":20},"3":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":3,"lifetime":0,"mainhero":[[20010,0,-20,0],[20010,0,20,100]],"movespeed":0,"name1":"2费自爆炸弹","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,275],[4,325],["6","建筑与器械"],["5","极快"],["3","近战"],[9,2]],"upcost":[[10020,10],[2,50]],"upexp":40},"4":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":3,"lifetime":0,"mainhero":[[20010,0,-20,0],[20010,0,20,100]],"movespeed":0,"name1":"2费自爆炸弹","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,275],[4,325],["6","建筑与器械"],["5","极快"],["3","近战"],[9,2]],"upcost":[[10020,10],[2,50]],"upexp":80},"5":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":3,"lifetime":0,"mainhero":[[20010,0,-20,0],[20010,0,20,100]],"movespeed":0,"name1":"2费自爆炸弹","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,275],[4,325],["6","建筑与器械"],["5","极快"],["3","近战"],[9,2]],"upcost":[[10020,10],[2,50]],"upexp":160},"6":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":3,"lifetime":0,"mainhero":[[20010,0,-20,0],[20010,0,20,100]],"movespeed":0,"name1":"2费自爆炸弹","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,275],[4,325],["6","建筑与器械"],["5","极快"],["3","近战"],[9,2]],"upcost":[[10020,10],[2,50]],"upexp":320},"7":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":3,"lifetime":0,"mainhero":[[20010,0,-20,0],[20010,0,20,100]],"movespeed":0,"name1":"2费自爆炸弹","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,275],[4,325],["6","建筑与器械"],["5","极快"],["3","近战"],[9,2]],"upcost":[[10020,10],[2,50]],"upexp":640},"8":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":3,"lifetime":0,"mainhero":[[20010,0,-20,0],[20010,0,20,100]],"movespeed":0,"name1":"2费自爆炸弹","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,275],[4,325],["6","建筑与器械"],["5","极快"],["3","近战"],[9,2]],"upcost":[],"upexp":0},"camp":3,"classlv":1,"clipname":10020,"cost":2,"desc":"2只视死如归的黑暗精灵，只有轰倒建筑时他们才能高兴起来！","effectrely":[],"herotype":1,"landtype":1,"mass":0,"name":"黑暗精灵","puttype":1,"quality":2,"resrely":[],"scale":1},"10030":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":2000,"hp":1615,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费皇子","normalskill":[10030,10032],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1615],[4,325],[20,651],["2","1.4"],["6","地面目标"],["5","中等"],["3","近战"]],"upcost":[[10030,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":2000,"hp":1615,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费皇子","normalskill":[10030,10032],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1755],[4,327],[20,651],["2","1.4"],["6","地面目标"],["5","中等"],["3","近战"]],"upcost":[[10030,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":2000,"hp":1615,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费皇子","normalskill":[10030,10032],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1885],[4,329],[20,651],["2","1.4"],["6","地面目标"],["5","中等"],["3","近战"]],"upcost":[[10030,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":2000,"hp":1615,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费皇子","normalskill":[10030,10032],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1925],[4,331],[20,651],["2","1.4"],["6","地面目标"],["5","中等"],["3","近战"]],"upcost":[[10030,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":2000,"hp":1615,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费皇子","normalskill":[10030,10032],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,2015],[4,333],[20,651],["2","1.4"],["6","地面目标"],["5","中等"],["3","近战"]],"upcost":[[10030,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":2000,"hp":1615,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费皇子","normalskill":[10030,10032],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,2215],[4,335],[20,651],["2","1.4"],["6","地面目标"],["5","中等"],["3","近战"]],"upcost":[[10030,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":2000,"hp":1615,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费皇子","normalskill":[10030,10032],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,2315],[4,337],[20,651],["2","1.4"],["6","地面目标"],["5","中等"],["3","近战"]],"upcost":[[10030,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":2000,"hp":1615,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费皇子","normalskill":[10030,10032],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,2615],[4,339],[20,651],["2","1.4"],["6","地面目标"],["5","中等"],["3","近战"]],"upcost":[[10030,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":2000,"hp":1615,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费皇子","normalskill":[10030,10032],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,3005],[4,341],[20,651],["2","1.4"],["6","地面目标"],["5","中等"],["3","近战"]],"upcost":[],"upexp":0},"camp":0,"classlv":1,"clipname":50020,"cost":5,"desc":"她从不惧怕任何敌人，冲锋陷阵。","effectrely":[],"herotype":1,"landtype":1,"mass":5,"name":"雅典娜","puttype":1,"quality":2,"resrely":[],"scale":1},"10040":{"0":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":1,"lifetime":0,"mainhero":[[20020,0,0,0],[20020,-30,-30,100],[20020,-30,30,200]],"movespeed":0,"name1":"2费哥布林投矛手","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,110],[4,67],["2","1.7"],["6","空中和地面"],["5","极快"],[3,5],[9,3]],"upcost":[[10040,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":1,"lifetime":0,"mainhero":[[20020,0,0,0],[20020,-30,-30,100],[20020,-30,30,200]],"movespeed":0,"name1":"2费哥布林投矛手","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,121],[4,67],["2","1.7"],["6","空中和地面"],["5","极快"],[3,5],[9,3]],"upcost":[[10040,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":1,"lifetime":0,"mainhero":[[20020,0,0,0],[20020,-30,-30,100],[20020,-30,30,200]],"movespeed":0,"name1":"2费哥布林投矛手","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,132],[4,67],["2","1.7"],["6","空中和地面"],["5","极快"],[3,5],[9,3]],"upcost":[[10040,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":1,"lifetime":0,"mainhero":[[20020,0,0,0],[20020,-30,-30,100],[20020,-30,30,200]],"movespeed":0,"name1":"2费哥布林投矛手","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,143],[4,67],["2","1.7"],["6","空中和地面"],["5","极快"],[3,5],[9,3]],"upcost":[[10040,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":1,"lifetime":0,"mainhero":[[20020,0,0,0],[20020,-30,-30,100],[20020,-30,30,200]],"movespeed":0,"name1":"2费哥布林投矛手","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,154],[4,67],["2","1.7"],["6","空中和地面"],["5","极快"],[3,5],[9,3]],"upcost":[[10040,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":1,"lifetime":0,"mainhero":[[20020,0,0,0],[20020,-30,-30,100],[20020,-30,30,200]],"movespeed":0,"name1":"2费哥布林投矛手","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,166],[4,67],["2","1.7"],["6","空中和地面"],["5","极快"],[3,5],[9,3]],"upcost":[[10040,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":1,"lifetime":0,"mainhero":[[20020,0,0,0],[20020,-30,-30,100],[20020,-30,30,200]],"movespeed":0,"name1":"2费哥布林投矛手","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,177],[4,67],["2","1.7"],["6","空中和地面"],["5","极快"],[3,5],[9,3]],"upcost":[[10040,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":1,"lifetime":0,"mainhero":[[20020,0,0,0],[20020,-30,-30,100],[20020,-30,30,200]],"movespeed":0,"name1":"2费哥布林投矛手","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,188],[4,67],["2","1.7"],["6","空中和地面"],["5","极快"],[3,5],[9,3]],"upcost":[[10040,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":1,"lifetime":0,"mainhero":[[20020,0,0,0],[20020,-30,-30,100],[20020,-30,30,200]],"movespeed":0,"name1":"2费哥布林投矛手","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,199],[4,67],["2","1.7"],["6","空中和地面"],["5","极快"],[3,5],[9,3]],"upcost":[],"upexp":0},"camp":0,"classlv":1,"clipname":50030,"cost":2,"desc":"弓箭手佣兵特价，雇一送二。","effectrely":[],"herotype":1,"landtype":1,"mass":0,"name":"弓箭手","puttype":1,"quality":0,"resrely":[],"scale":1},"10050":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":598,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费火枪手","normalskill":[10050],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,598],[4,181],["2","1.1"],["6","空中和地面"],["5","中等"],[3,6]],"upcost":[[10050,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":598,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费火枪手","normalskill":[10050],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,610],[4,182],["2","1.1"],["6","空中和地面"],["5","中等"],[3,6]],"upcost":[[10050,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":598,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费火枪手","normalskill":[10050],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,630],[4,183],["2","1.1"],["6","空中和地面"],["5","中等"],[3,6]],"upcost":[[10050,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":598,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费火枪手","normalskill":[10050],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,650],[4,184],["2","1.1"],["6","空中和地面"],["5","中等"],[3,6]],"upcost":[[10050,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":598,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费火枪手","normalskill":[10050],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,670],[4,185],["2","1.1"],["6","空中和地面"],["5","中等"],[3,6]],"upcost":[[10050,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":598,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费火枪手","normalskill":[10050],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,690],[4,186],["2","1.1"],["6","空中和地面"],["5","中等"],[3,6]],"upcost":[[10050,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":598,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费火枪手","normalskill":[10050],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,710],[4,187],["2","1.1"],["6","空中和地面"],["5","中等"],[3,6]],"upcost":[[10050,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":598,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费火枪手","normalskill":[10050],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,730],[4,188],["2","1.1"],["6","空中和地面"],["5","中等"],[3,6]],"upcost":[[10050,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":598,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费火枪手","normalskill":[10050],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,750],[4,189],["2","1.1"],["6","空中和地面"],["5","中等"],[3,6]],"upcost":[],"upexp":0},"camp":0,"classlv":1,"clipname":50030,"cost":4,"desc":"天空中曾经出现10个太阳，后羿射落了9个。证明了地球不是圆的。","effectrely":[10051],"herotype":1,"landtype":1,"mass":1,"name":"后羿","puttype":1,"quality":1,"resrely":[],"scale":1},"10060":{"0":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":1,"lifetime":0,"mainhero":[[20030,0,0,0],[20030,-30,-30,100],[20030,-30,30,200]],"movespeed":0,"name1":"3费小苍蝇","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,190],[4,84],[2,1],["6","空中和地面"],["5","快"],["3","近战"],[9,3]],"upcost":[[10060,10],[2,50]],"upexp":5},"1":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":1,"lifetime":0,"mainhero":[[20030,0,0,0],[20030,-30,-30,100],[20030,-30,30,200]],"movespeed":0,"name1":"3费小苍蝇","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,190],[4,84],[2,1],["6","空中和地面"],["5","快"],["3","近战"],[9,3]],"upcost":[[10060,10],[2,50]],"upexp":10},"2":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":1,"lifetime":0,"mainhero":[[20030,0,0,0],[20030,-30,-30,100],[20030,-30,30,200]],"movespeed":0,"name1":"3费小苍蝇","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,190],[4,84],[2,1],["6","空中和地面"],["5","快"],["3","近战"],[9,3]],"upcost":[[10060,10],[2,50]],"upexp":20},"3":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":1,"lifetime":0,"mainhero":[[20030,0,0,0],[20030,-30,-30,100],[20030,-30,30,200]],"movespeed":0,"name1":"3费小苍蝇","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,190],[4,84],[2,1],["6","空中和地面"],["5","快"],["3","近战"],[9,3]],"upcost":[[10060,10],[2,50]],"upexp":40},"4":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":1,"lifetime":0,"mainhero":[[20030,0,0,0],[20030,-30,-30,100],[20030,-30,30,200]],"movespeed":0,"name1":"3费小苍蝇","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,190],[4,84],[2,1],["6","空中和地面"],["5","快"],["3","近战"],[9,3]],"upcost":[[10060,10],[2,50]],"upexp":80},"5":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":1,"lifetime":0,"mainhero":[[20030,0,0,0],[20030,-30,-30,100],[20030,-30,30,200]],"movespeed":0,"name1":"3费小苍蝇","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,190],[4,84],[2,1],["6","空中和地面"],["5","快"],["3","近战"],[9,3]],"upcost":[[10060,10],[2,50]],"upexp":160},"6":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":1,"lifetime":0,"mainhero":[[20030,0,0,0],[20030,-30,-30,100],[20030,-30,30,200]],"movespeed":0,"name1":"3费小苍蝇","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,190],[4,84],[2,1],["6","空中和地面"],["5","快"],["3","近战"],[9,3]],"upcost":[[10060,10],[2,50]],"upexp":320},"7":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":1,"lifetime":0,"mainhero":[[20030,0,0,0],[20030,-30,-30,100],[20030,-30,30,200]],"movespeed":0,"name1":"3费小苍蝇","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,190],[4,84],[2,1],["6","空中和地面"],["5","快"],["3","近战"],[9,3]],"upcost":[[10060,10],[2,50]],"upexp":640},"8":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":1,"lifetime":0,"mainhero":[[20030,0,0,0],[20030,-30,-30,100],[20030,-30,30,200]],"movespeed":0,"name1":"3费小苍蝇","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,190],[4,84],[2,1],["6","空中和地面"],["5","快"],["3","近战"],[9,3]],"upcost":[],"upexp":0},"camp":0,"classlv":1,"clipname":50060,"cost":3,"desc":"3只可爱的小精灵，飞在空中避开大部分攻击。","effectrely":[],"herotype":1,"landtype":2,"mass":0,"name":"光明精灵","puttype":2,"quality":0,"resrely":[],"scale":1},"10070":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1382,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费骑士","normalskill":[10070],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1382],[4,167],["2","1.2"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10070,10],[2,50]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1382,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费骑士","normalskill":[10070],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1552],[4,168],["2","1.2"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10070,10],[2,50]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1382,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费骑士","normalskill":[10070],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1662],[4,169],["2","1.2"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10070,10],[2,50]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1382,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费骑士","normalskill":[10070],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1772],[4,170],["2","1.2"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10070,10],[2,50]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1382,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费骑士","normalskill":[10070],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1882],[4,171],["2","1.2"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10070,10],[2,50]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1382,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费骑士","normalskill":[10070],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1982],[4,172],["2","1.2"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10070,10],[2,50]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1382,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费骑士","normalskill":[10070],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,2002],[4,173],["2","1.2"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10070,10],[2,50]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1382,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费骑士","normalskill":[10070],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,2102],[4,174],["2","1.2"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10070,10],[2,50]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1382,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费骑士","normalskill":[10070],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,2382],[4,175],["2","1.2"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[],"upexp":0},"camp":0,"classlv":1,"clipname":50010,"cost":3,"desc":"亚瑟因为力气很大成为了王。","effectrely":[],"herotype":1,"landtype":1,"mass":1,"name":"亚瑟","puttype":1,"quality":0,"resrely":[],"scale":1},"10080":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[1],"deploytime":1000,"hp":1408,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":94,"name1":"4费野猪骑士","normalskill":[10080],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1408],[4,264],["2","1.6"],["6","建筑与器械"],["5","极快"],["3","近战"]],"upcost":[[10080,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[1],"deploytime":1000,"hp":1408,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":94,"name1":"4费野猪骑士","normalskill":[10080],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1508],[4,266],["2","1.6"],["6","建筑与器械"],["5","极快"],["3","近战"]],"upcost":[[10080,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[1],"deploytime":1000,"hp":1408,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":94,"name1":"4费野猪骑士","normalskill":[10080],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1608],[4,268],["2","1.6"],["6","建筑与器械"],["5","极快"],["3","近战"]],"upcost":[[10080,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[1],"deploytime":1000,"hp":1408,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":94,"name1":"4费野猪骑士","normalskill":[10080],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1708],[4,270],["2","1.6"],["6","建筑与器械"],["5","极快"],["3","近战"]],"upcost":[[10080,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[1],"deploytime":1000,"hp":1408,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":94,"name1":"4费野猪骑士","normalskill":[10080],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1808],[4,272],["2","1.6"],["6","建筑与器械"],["5","极快"],["3","近战"]],"upcost":[[10080,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[1],"deploytime":1000,"hp":1408,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":94,"name1":"4费野猪骑士","normalskill":[10080],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1908],[4,274],["2","1.6"],["6","建筑与器械"],["5","极快"],["3","近战"]],"upcost":[[10080,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[1],"deploytime":1000,"hp":1408,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":94,"name1":"4费野猪骑士","normalskill":[10080],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,2008],[4,276],["2","1.6"],["6","建筑与器械"],["5","极快"],["3","近战"]],"upcost":[[10080,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[1],"deploytime":1000,"hp":1408,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":94,"name1":"4费野猪骑士","normalskill":[10080],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,2108],[4,278],["2","1.6"],["6","建筑与器械"],["5","极快"],["3","近战"]],"upcost":[[10080,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[1],"deploytime":1000,"hp":1408,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":94,"name1":"4费野猪骑士","normalskill":[10080],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,2208],[4,280],["2","1.6"],["6","建筑与器械"],["5","极快"],["3","近战"]],"upcost":[],"upexp":0},"camp":1,"classlv":2,"clipname":50010,"cost":4,"desc":"悟空会冲向任何器械和建筑。很难追上他。","effectrely":[],"herotype":1,"landtype":1,"mass":1,"name":"悟空","puttype":1,"quality":1,"resrely":[],"scale":1},"10090":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1024,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费龙宝","normalskill":[10090],"postype":0,"preview":[1],"pskill":[],"range":25,"shield":0,"showattr":[[1,1024],[8,133],["2","1.5"],["6","空中和地面"],["5","快"],["3","3.5"]],"upcost":[[10090,10],[2,50]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1024,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费龙宝","normalskill":[10090],"postype":0,"preview":[1],"pskill":[],"range":25,"shield":0,"showattr":[[1,1024],[8,133],["2","1.5"],["6","空中和地面"],["5","快"],["3","3.5"]],"upcost":[[10090,10],[2,50]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1024,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费龙宝","normalskill":[10090],"postype":0,"preview":[1],"pskill":[],"range":25,"shield":0,"showattr":[[1,1024],[8,133],["2","1.5"],["6","空中和地面"],["5","快"],["3","3.5"]],"upcost":[[10090,10],[2,50]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1024,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费龙宝","normalskill":[10090],"postype":0,"preview":[1],"pskill":[],"range":25,"shield":0,"showattr":[[1,1024],[8,133],["2","1.5"],["6","空中和地面"],["5","快"],["3","3.5"]],"upcost":[[10090,10],[2,50]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1024,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费龙宝","normalskill":[10090],"postype":0,"preview":[1],"pskill":[],"range":25,"shield":0,"showattr":[[1,1024],[8,133],["2","1.5"],["6","空中和地面"],["5","快"],["3","3.5"]],"upcost":[[10090,10],[2,50]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1024,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费龙宝","normalskill":[10090],"postype":0,"preview":[1],"pskill":[],"range":25,"shield":0,"showattr":[[1,1024],[8,133],["2","1.5"],["6","空中和地面"],["5","快"],["3","3.5"]],"upcost":[[10090,10],[2,50]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1024,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费龙宝","normalskill":[10090],"postype":0,"preview":[1],"pskill":[],"range":25,"shield":0,"showattr":[[1,1024],[8,133],["2","1.5"],["6","空中和地面"],["5","快"],["3","3.5"]],"upcost":[[10090,10],[2,50]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1024,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费龙宝","normalskill":[10090],"postype":0,"preview":[1],"pskill":[],"range":25,"shield":0,"showattr":[[1,1024],[8,133],["2","1.5"],["6","空中和地面"],["5","快"],["3","3.5"]],"upcost":[[10090,10],[2,50]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1024,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费龙宝","normalskill":[10090],"postype":0,"preview":[1],"pskill":[],"range":25,"shield":0,"showattr":[[1,1024],[8,133],["2","1.5"],["6","空中和地面"],["5","快"],["3","3.5"]],"upcost":[],"upexp":0},"camp":0,"classlv":1,"clipname":50050,"cost":4,"desc":"朱雀可以从空中打击大片敌军。","effectrely":[],"herotype":1,"landtype":2,"mass":1,"name":"朱雀","puttype":2,"quality":2,"resrely":[],"scale":1},"10100":{"0":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":3,"lifetime":0,"mainhero":[[20040,0,0,0],[20040,-30,-30,100],[20040,-30,30,200]],"movespeed":0,"name1":"1费小骷髅","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,67],[4,67],[2,1],["6","地面"],["5","快"],["3","近战"],[9,3]],"upcost":[[10100,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":3,"lifetime":0,"mainhero":[[20040,0,0,0],[20040,-30,-30,100],[20040,-30,30,200]],"movespeed":0,"name1":"1费小骷髅","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,68],[4,68],[2,1],["6","地面"],["5","快"],["3","近战"],[9,3]],"upcost":[[10100,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":3,"lifetime":0,"mainhero":[[20040,0,0,0],[20040,-30,-30,100],[20040,-30,30,200]],"movespeed":0,"name1":"1费小骷髅","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,69],[4,69],[2,1],["6","地面"],["5","快"],["3","近战"],[9,3]],"upcost":[[10100,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":3,"lifetime":0,"mainhero":[[20040,0,0,0],[20040,-30,-30,100],[20040,-30,30,200]],"movespeed":0,"name1":"1费小骷髅","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,70],[4,70],[2,1],["6","地面"],["5","快"],["3","近战"],[9,3]],"upcost":[[10100,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":3,"lifetime":0,"mainhero":[[20040,0,0,0],[20040,-30,-30,100],[20040,-30,30,200]],"movespeed":0,"name1":"1费小骷髅","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,71],[4,71],[2,1],["6","地面"],["5","快"],["3","近战"],[9,3]],"upcost":[[10100,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":3,"lifetime":0,"mainhero":[[20040,0,0,0],[20040,-30,-30,100],[20040,-30,30,200]],"movespeed":0,"name1":"1费小骷髅","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,72],[4,72],[2,1],["6","地面"],["5","快"],["3","近战"],[9,3]],"upcost":[[10100,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":3,"lifetime":0,"mainhero":[[20040,0,0,0],[20040,-30,-30,100],[20040,-30,30,200]],"movespeed":0,"name1":"1费小骷髅","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,73],[4,73],[2,1],["6","地面"],["5","快"],["3","近战"],[9,3]],"upcost":[[10100,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":3,"lifetime":0,"mainhero":[[20040,0,0,0],[20040,-30,-30,100],[20040,-30,30,200]],"movespeed":0,"name1":"1费小骷髅","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,74],[4,74],[2,1],["6","地面"],["5","快"],["3","近战"],[9,3]],"upcost":[[10100,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":3,"lifetime":0,"mainhero":[[20040,0,0,0],[20040,-30,-30,100],[20040,-30,30,200]],"movespeed":0,"name1":"1费小骷髅","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,75],[4,75],[2,1],["6","地面"],["5","快"],["3","近战"],[9,3]],"upcost":[],"upexp":0},"camp":0,"classlv":2,"clipname":50020,"cost":1,"desc":"无畏的猴子士兵，他们极少独自行动。","effectrely":[],"herotype":1,"landtype":1,"mass":0,"name":"猴子","puttype":1,"quality":0,"resrely":[],"scale":1},"10110":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":756,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费野蛮人攻城锤","normalskill":[10110],"postype":0,"preview":[1],"pskill":[10112],"range":30,"shield":0,"showattr":[[1,756],["6","建筑与器械"],["5","中等"],["3","近战"],[51,1],[52,4]],"upcost":[[10110,10],[2,50]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":756,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费野蛮人攻城锤","normalskill":[10110],"postype":0,"preview":[1],"pskill":[10112],"range":30,"shield":0,"showattr":[[1,756],["6","建筑与器械"],["5","中等"],["3","近战"],[51,1],[52,4]],"upcost":[[10110,10],[2,50]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":756,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费野蛮人攻城锤","normalskill":[10110],"postype":0,"preview":[1],"pskill":[10112],"range":30,"shield":0,"showattr":[[1,756],["6","建筑与器械"],["5","中等"],["3","近战"],[51,1],[52,4]],"upcost":[[10110,10],[2,50]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":756,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费野蛮人攻城锤","normalskill":[10110],"postype":0,"preview":[1],"pskill":[10112],"range":30,"shield":0,"showattr":[[1,756],["6","建筑与器械"],["5","中等"],["3","近战"],[51,1],[52,4]],"upcost":[[10110,10],[2,50]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":756,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费野蛮人攻城锤","normalskill":[10110],"postype":0,"preview":[1],"pskill":[10112],"range":30,"shield":0,"showattr":[[1,756],["6","建筑与器械"],["5","中等"],["3","近战"],[51,1],[52,4]],"upcost":[[10110,10],[2,50]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":756,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费野蛮人攻城锤","normalskill":[10110],"postype":0,"preview":[1],"pskill":[10112],"range":30,"shield":0,"showattr":[[1,756],["6","建筑与器械"],["5","中等"],["3","近战"],[51,1],[52,4]],"upcost":[[10110,10],[2,50]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":756,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费野蛮人攻城锤","normalskill":[10110],"postype":0,"preview":[1],"pskill":[10112],"range":30,"shield":0,"showattr":[[1,756],["6","建筑与器械"],["5","中等"],["3","近战"],[51,1],[52,4]],"upcost":[[10110,10],[2,50]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":756,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费野蛮人攻城锤","normalskill":[10110],"postype":0,"preview":[1],"pskill":[10112],"range":30,"shield":0,"showattr":[[1,756],["6","建筑与器械"],["5","中等"],["3","近战"],[51,1],[52,4]],"upcost":[[10110,10],[2,50]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":756,"initlv":2,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费野蛮人攻城锤","normalskill":[10110],"postype":0,"preview":[1],"pskill":[10112],"range":30,"shield":0,"showattr":[[1,756],["6","建筑与器械"],["5","中等"],["3","近战"],[51,1],[52,4]],"upcost":[],"upexp":0},"camp":2,"classlv":1,"clipname":50070,"cost":5,"desc":"这只木马看起来人畜无害，领主不会攻击它。其实里面藏着4位希腊战士。","effectrely":[],"herotype":1,"landtype":1,"mass":1,"name":"特洛伊木马","puttype":1,"quality":1,"resrely":[],"scale":1},"10120":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":696,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费女巫","normalskill":[10120],"postype":0,"preview":[1],"pskill":[10122],"range":20,"shield":0,"showattr":[[1,696],[4,220],["2","1.7"],["6","空中和地面"],["5","中等"],[3,5],[21,7],[53,1]],"upcost":[[10120,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":696,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费女巫","normalskill":[10120],"postype":0,"preview":[1],"pskill":[10122],"range":20,"shield":0,"showattr":[[1,710],[4,222],["2","1.7"],["6","空中和地面"],["5","中等"],[3,5],[21,7],[53,2]],"upcost":[[10120,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":696,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费女巫","normalskill":[10120],"postype":0,"preview":[1],"pskill":[10122],"range":20,"shield":0,"showattr":[[1,720],[4,224],["2","1.7"],["6","空中和地面"],["5","中等"],[3,5],[21,7],[53,3]],"upcost":[[10120,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":696,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费女巫","normalskill":[10120],"postype":0,"preview":[1],"pskill":[10122],"range":20,"shield":0,"showattr":[[1,730],[4,226],["2","1.7"],["6","空中和地面"],["5","中等"],[3,5],[21,7],[53,4]],"upcost":[[10120,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":696,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费女巫","normalskill":[10120],"postype":0,"preview":[1],"pskill":[10122],"range":20,"shield":0,"showattr":[[1,740],[4,228],["2","1.7"],["6","空中和地面"],["5","中等"],[3,5],[21,7],[53,5]],"upcost":[[10120,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":696,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费女巫","normalskill":[10120],"postype":0,"preview":[1],"pskill":[10122],"range":20,"shield":0,"showattr":[[1,750],[4,230],["2","1.7"],["6","空中和地面"],["5","中等"],[3,5],[21,7],[53,6]],"upcost":[[10120,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":696,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费女巫","normalskill":[10120],"postype":0,"preview":[1],"pskill":[10122],"range":20,"shield":0,"showattr":[[1,760],[4,232],["2","1.7"],["6","空中和地面"],["5","中等"],[3,5],[21,7],[53,7]],"upcost":[[10120,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":696,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费女巫","normalskill":[10120],"postype":0,"preview":[1],"pskill":[10122],"range":20,"shield":0,"showattr":[[1,770],[4,234],["2","1.7"],["6","空中和地面"],["5","中等"],[3,5],[21,7],[53,8]],"upcost":[[10120,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":696,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费女巫","normalskill":[10120],"postype":0,"preview":[1],"pskill":[10122],"range":20,"shield":0,"showattr":[[1,780],[4,236],["2","1.7"],["6","空中和地面"],["5","中等"],[3,5],[21,7],[53,9]],"upcost":[],"upexp":0},"camp":0,"classlv":2,"clipname":10120,"cost":5,"desc":"她觉得猴子可爱，因此养了一窝猴子。","effectrely":[],"herotype":1,"landtype":1,"mass":1,"name":"白骨精","puttype":1,"quality":2,"resrely":[2004009],"scale":1},"10130":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":2000,"hp":1030,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费黑皇子","normalskill":[10130,10132],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":199,"showattr":[[1,1030],[18,199],[8,206],[20,412],["2","1.3"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10130,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":2000,"hp":1030,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费黑皇子","normalskill":[10130,10132],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":199,"showattr":[[1,1040],[18,201],[8,206],[20,412],["2","1.3"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10130,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":2000,"hp":1030,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费黑皇子","normalskill":[10130,10132],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":199,"showattr":[[1,1050],[18,203],[8,206],[20,412],["2","1.3"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10130,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":2000,"hp":1030,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费黑皇子","normalskill":[10130,10132],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":199,"showattr":[[1,1060],[18,205],[8,206],[20,412],["2","1.3"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10130,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":2000,"hp":1030,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费黑皇子","normalskill":[10130,10132],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":199,"showattr":[[1,1070],[18,207],[8,206],[20,412],["2","1.3"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10130,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":2000,"hp":1030,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费黑皇子","normalskill":[10130,10132],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":199,"showattr":[[1,1080],[18,209],[8,206],[20,412],["2","1.3"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10130,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":2000,"hp":1030,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费黑皇子","normalskill":[10130,10132],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":199,"showattr":[[1,1090],[18,211],[8,206],[20,412],["2","1.3"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10130,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":2000,"hp":1030,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费黑皇子","normalskill":[10130,10132],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":199,"showattr":[[1,1100],[18,213],[8,206],[20,412],["2","1.3"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10130,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":2000,"hp":1030,"initlv":3,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费黑皇子","normalskill":[10130,10132],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":199,"showattr":[[1,1110],[18,215],[8,206],[20,412],["2","1.3"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[],"upexp":0},"camp":0,"classlv":2,"clipname":50010,"cost":4,"desc":"女武神在短暂的准备后，会突然加速冲向敌人！","effectrely":[],"herotype":1,"landtype":1,"mass":5,"name":"女武神","puttype":1,"quality":2,"resrely":[],"scale":1},"10140":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1219,"initlv":5,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费迫击炮","normalskill":[10140],"postype":0,"preview":[1],"pskill":[],"range":30,"shield":0,"showattr":[[1,1219],[8,220],[2,5],["6","地面"],["5","慢"],["3","11.5"],["19","3.5"]],"upcost":[[10140,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1219,"initlv":5,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费迫击炮","normalskill":[10140],"postype":0,"preview":[1],"pskill":[],"range":30,"shield":0,"showattr":[[1,1229],[8,222],[2,5],["6","地面"],["5","慢"],["3","11.5"],["19","3.5"]],"upcost":[[10140,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1219,"initlv":5,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费迫击炮","normalskill":[10140],"postype":0,"preview":[1],"pskill":[],"range":30,"shield":0,"showattr":[[1,1239],[8,224],[2,5],["6","地面"],["5","慢"],["3","11.5"],["19","3.5"]],"upcost":[[10140,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1219,"initlv":5,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费迫击炮","normalskill":[10140],"postype":0,"preview":[1],"pskill":[],"range":30,"shield":0,"showattr":[[1,1249],[8,226],[2,5],["6","地面"],["5","慢"],["3","11.5"],["19","3.5"]],"upcost":[[10140,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1219,"initlv":5,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费迫击炮","normalskill":[10140],"postype":0,"preview":[1],"pskill":[],"range":30,"shield":0,"showattr":[[1,1259],[8,228],[2,5],["6","地面"],["5","慢"],["3","11.5"],["19","3.5"]],"upcost":[[10140,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1219,"initlv":5,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费迫击炮","normalskill":[10140],"postype":0,"preview":[1],"pskill":[],"range":30,"shield":0,"showattr":[[1,1269],[8,230],[2,5],["6","地面"],["5","慢"],["3","11.5"],["19","3.5"]],"upcost":[[10140,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1219,"initlv":5,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费迫击炮","normalskill":[10140],"postype":0,"preview":[1],"pskill":[],"range":30,"shield":0,"showattr":[[1,1279],[8,232],[2,5],["6","地面"],["5","慢"],["3","11.5"],["19","3.5"]],"upcost":[[10140,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1219,"initlv":5,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费迫击炮","normalskill":[10140],"postype":0,"preview":[1],"pskill":[],"range":30,"shield":0,"showattr":[[1,1289],[8,234],[2,5],["6","地面"],["5","慢"],["3","11.5"],["19","3.5"]],"upcost":[[10140,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1219,"initlv":5,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费迫击炮","normalskill":[10140],"postype":0,"preview":[1],"pskill":[],"range":30,"shield":0,"showattr":[[1,1299],[8,236],[2,5],["6","地面"],["5","慢"],["3","11.5"],["19","3.5"]],"upcost":[],"upexp":0},"camp":0,"classlv":3,"clipname":10140,"cost":4,"desc":"临时组装的投石车，有点不牢固的感觉","effectrely":[10141,10142],"herotype":2,"landtype":1,"mass":1,"name":"投石车","puttype":1,"quality":0,"resrely":[],"scale":1},"10150":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1060,"initlv":5,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费狂暴樵夫","normalskill":[10150],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1060],[4,200],["2","0.8"],["6","地面"],["5","极快"],["3","近战"]],"upcost":[[10150,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1060,"initlv":5,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费狂暴樵夫","normalskill":[10150],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1160],[4,202],["2","0.8"],["6","地面"],["5","极快"],["3","近战"]],"upcost":[[10150,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1060,"initlv":5,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费狂暴樵夫","normalskill":[10150],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1260],[4,204],["2","0.8"],["6","地面"],["5","极快"],["3","近战"]],"upcost":[[10150,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1060,"initlv":5,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费狂暴樵夫","normalskill":[10150],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1360],[4,206],["2","0.8"],["6","地面"],["5","极快"],["3","近战"]],"upcost":[[10150,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1060,"initlv":5,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费狂暴樵夫","normalskill":[10150],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1400],[4,208],["2","0.8"],["6","地面"],["5","极快"],["3","近战"]],"upcost":[[10150,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1060,"initlv":5,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费狂暴樵夫","normalskill":[10150],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1560],[4,210],["2","0.8"],["6","地面"],["5","极快"],["3","近战"]],"upcost":[[10150,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1060,"initlv":5,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费狂暴樵夫","normalskill":[10150],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1660],[4,212],["2","0.8"],["6","地面"],["5","极快"],["3","近战"]],"upcost":[[10150,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1060,"initlv":5,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费狂暴樵夫","normalskill":[10150],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1760],[4,214],["2","0.8"],["6","地面"],["5","极快"],["3","近战"]],"upcost":[[10150,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1060,"initlv":5,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费狂暴樵夫","normalskill":[10150],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1860],[4,216],["2","0.8"],["6","地面"],["5","极快"],["3","近战"]],"upcost":[],"upexp":0},"camp":0,"classlv":3,"clipname":50010,"cost":4,"desc":"无情的砍翻任何挡路的敌人！","effectrely":[],"herotype":1,"landtype":1,"mass":1,"name":"维京海盗","puttype":1,"quality":1,"resrely":[],"scale":1},"10160":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1000,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"3费矿工","normalskill":[10160],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1000],[4,160],[10,64],["2","1.2"],["6","地面"],["5","快"],["3","近战"]],"upcost":[[10160,10],[2,50]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1000,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"3费矿工","normalskill":[10160],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1000],[4,160],[10,64],["2","1.2"],["6","地面"],["5","快"],["3","近战"]],"upcost":[[10160,10],[2,50]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1000,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"3费矿工","normalskill":[10160],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1000],[4,160],[10,64],["2","1.2"],["6","地面"],["5","快"],["3","近战"]],"upcost":[[10160,10],[2,50]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1000,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"3费矿工","normalskill":[10160],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1000],[4,160],[10,64],["2","1.2"],["6","地面"],["5","快"],["3","近战"]],"upcost":[[10160,10],[2,50]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1000,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"3费矿工","normalskill":[10160],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1000],[4,160],[10,64],["2","1.2"],["6","地面"],["5","快"],["3","近战"]],"upcost":[[10160,10],[2,50]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1000,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"3费矿工","normalskill":[10160],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1000],[4,160],[10,64],["2","1.2"],["6","地面"],["5","快"],["3","近战"]],"upcost":[[10160,10],[2,50]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1000,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"3费矿工","normalskill":[10160],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1000],[4,160],[10,64],["2","1.2"],["6","地面"],["5","快"],["3","近战"]],"upcost":[[10160,10],[2,50]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1000,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"3费矿工","normalskill":[10160],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1000],[4,160],[10,64],["2","1.2"],["6","地面"],["5","快"],["3","近战"]],"upcost":[[10160,10],[2,50]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1000,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"3费矿工","normalskill":[10160],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1000],[4,160],[10,64],["2","1.2"],["6","地面"],["5","快"],["3","近战"]],"upcost":[],"upexp":0},"camp":1,"classlv":3,"clipname":50010,"cost":3,"desc":"哪吒脚踏风火轮，可以直接飞往地图的任何地方。小心！他可是无证飞行！","effectrely":[],"herotype":1,"landtype":1,"mass":1,"name":"哪吒","puttype":3,"quality":3,"resrely":[],"scale":1},"10170":{"0":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":7,"lifetime":0,"mainhero":[[20050,30,0,0],[20050,0,-30,100],[20050,0,30,100],[20050,-60,-30,200],[20050,-60,30,200]],"movespeed":0,"name1":"5费野蛮人2典韦","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,555],[4,159],["2","1.4"],["6","地面"],["5","中等"],["3","近战"],[9,5]],"upcost":[[10170,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":7,"lifetime":0,"mainhero":[[20050,30,0,0],[20050,0,-30,100],[20050,0,30,100],[20050,-60,-30,200],[20050,-60,30,200]],"movespeed":0,"name1":"5费野蛮人2典韦","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,565],[4,160],["2","1.4"],["6","地面"],["5","中等"],["3","近战"],[9,5]],"upcost":[[10170,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":7,"lifetime":0,"mainhero":[[20050,30,0,0],[20050,0,-30,100],[20050,0,30,100],[20050,-60,-30,200],[20050,-60,30,200]],"movespeed":0,"name1":"5费野蛮人2典韦","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,575],[4,161],["2","1.4"],["6","地面"],["5","中等"],["3","近战"],[9,5]],"upcost":[[10170,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":7,"lifetime":0,"mainhero":[[20050,30,0,0],[20050,0,-30,100],[20050,0,30,100],[20050,-60,-30,200],[20050,-60,30,200]],"movespeed":0,"name1":"5费野蛮人2典韦","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,585],[4,162],["2","1.4"],["6","地面"],["5","中等"],["3","近战"],[9,5]],"upcost":[[10170,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":7,"lifetime":0,"mainhero":[[20050,30,0,0],[20050,0,-30,100],[20050,0,30,100],[20050,-60,-30,200],[20050,-60,30,200]],"movespeed":0,"name1":"5费野蛮人2典韦","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,595],[4,163],["2","1.4"],["6","地面"],["5","中等"],["3","近战"],[9,5]],"upcost":[[10170,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":7,"lifetime":0,"mainhero":[[20050,30,0,0],[20050,0,-30,100],[20050,0,30,100],[20050,-60,-30,200],[20050,-60,30,200]],"movespeed":0,"name1":"5费野蛮人2典韦","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,605],[4,164],["2","1.4"],["6","地面"],["5","中等"],["3","近战"],[9,5]],"upcost":[[10170,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":7,"lifetime":0,"mainhero":[[20050,30,0,0],[20050,0,-30,100],[20050,0,30,100],[20050,-60,-30,200],[20050,-60,30,200]],"movespeed":0,"name1":"5费野蛮人2典韦","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,615],[4,165],["2","1.4"],["6","地面"],["5","中等"],["3","近战"],[9,5]],"upcost":[[10170,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":7,"lifetime":0,"mainhero":[[20050,30,0,0],[20050,0,-30,100],[20050,0,30,100],[20050,-60,-30,200],[20050,-60,30,200]],"movespeed":0,"name1":"5费野蛮人2典韦","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,625],[4,166],["2","1.4"],["6","地面"],["5","中等"],["3","近战"],[9,5]],"upcost":[[10170,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":7,"lifetime":0,"mainhero":[[20050,30,0,0],[20050,0,-30,100],[20050,0,30,100],[20050,-60,-30,200],[20050,-60,30,200]],"movespeed":0,"name1":"5费野蛮人2典韦","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,635],[4,167],["2","1.4"],["6","地面"],["5","中等"],["3","近战"],[9,5]],"upcost":[],"upexp":0},"camp":0,"classlv":4,"clipname":50020,"cost":5,"desc":"他们训练有数，身披盔甲，非常可靠。","effectrely":[],"herotype":1,"landtype":1,"mass":0,"name":"希腊战士","puttype":1,"quality":0,"resrely":[],"scale":1},"10180":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":2793,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"6费骷髅巨人","normalskill":[10180],"postype":0,"preview":[1],"pskill":[10182],"range":35,"shield":0,"showattr":[[1,2793],[7,957],["6","建筑与器械"],["5","中等"],["3","近战"]],"upcost":[[10180,10],[2,50]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":2793,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"6费骷髅巨人","normalskill":[10180],"postype":0,"preview":[1],"pskill":[10182],"range":35,"shield":0,"showattr":[[1,2793],[7,957],["6","建筑与器械"],["5","中等"],["3","近战"]],"upcost":[[10180,10],[2,50]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":2793,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"6费骷髅巨人","normalskill":[10180],"postype":0,"preview":[1],"pskill":[10182],"range":35,"shield":0,"showattr":[[1,2793],[7,957],["6","建筑与器械"],["5","中等"],["3","近战"]],"upcost":[[10180,10],[2,50]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":2793,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"6费骷髅巨人","normalskill":[10180],"postype":0,"preview":[1],"pskill":[10182],"range":35,"shield":0,"showattr":[[1,2793],[7,957],["6","建筑与器械"],["5","中等"],["3","近战"]],"upcost":[[10180,10],[2,50]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":2793,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"6费骷髅巨人","normalskill":[10180],"postype":0,"preview":[1],"pskill":[10182],"range":35,"shield":0,"showattr":[[1,2793],[7,957],["6","建筑与器械"],["5","中等"],["3","近战"]],"upcost":[[10180,10],[2,50]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":2793,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"6费骷髅巨人","normalskill":[10180],"postype":0,"preview":[1],"pskill":[10182],"range":35,"shield":0,"showattr":[[1,2793],[7,957],["6","建筑与器械"],["5","中等"],["3","近战"]],"upcost":[[10180,10],[2,50]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":2793,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"6费骷髅巨人","normalskill":[10180],"postype":0,"preview":[1],"pskill":[10182],"range":35,"shield":0,"showattr":[[1,2793],[7,957],["6","建筑与器械"],["5","中等"],["3","近战"]],"upcost":[[10180,10],[2,50]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":2793,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"6费骷髅巨人","normalskill":[10180],"postype":0,"preview":[1],"pskill":[10182],"range":35,"shield":0,"showattr":[[1,2793],[7,957],["6","建筑与器械"],["5","中等"],["3","近战"]],"upcost":[[10180,10],[2,50]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":2793,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"6费骷髅巨人","normalskill":[10180],"postype":0,"preview":[1],"pskill":[10182],"range":35,"shield":0,"showattr":[[1,2793],[7,957],["6","建筑与器械"],["5","中等"],["3","近战"]],"upcost":[],"upexp":0},"camp":0,"classlv":4,"clipname":50010,"cost":6,"desc":"熔岩巨人有颗热情的心脏，在它死后会造成热情的爆炸。","effectrely":[],"herotype":1,"landtype":1,"mass":5,"name":"熔岩巨人","puttype":1,"quality":2,"resrely":[],"scale":1},"10190":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":3000,"hp":1200,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"6费电磁炮车","normalskill":[10190],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1260],[4,802],[2,4],["6","地面"],["5","慢"],["3","11.5"]],"upcost":[[10190,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":3000,"hp":1200,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"6费电磁炮车","normalskill":[10190],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1360],[4,804],[2,4],["6","地面"],["5","慢"],["3","11.5"]],"upcost":[[10190,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":3000,"hp":1200,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"6费电磁炮车","normalskill":[10190],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1460],[4,806],[2,4],["6","地面"],["5","慢"],["3","11.5"]],"upcost":[[10190,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":3000,"hp":1200,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"6费电磁炮车","normalskill":[10190],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1560],[4,808],[2,4],["6","地面"],["5","慢"],["3","11.5"]],"upcost":[[10190,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":3000,"hp":1200,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"6费电磁炮车","normalskill":[10190],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1660],[4,810],[2,4],["6","地面"],["5","慢"],["3","11.5"]],"upcost":[[10190,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":3000,"hp":1200,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"6费电磁炮车","normalskill":[10190],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1760],[4,812],[2,4],["6","地面"],["5","慢"],["3","11.5"]],"upcost":[[10190,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":3000,"hp":1200,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"6费电磁炮车","normalskill":[10190],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1860],[4,814],[2,4],["6","地面"],["5","慢"],["3","11.5"]],"upcost":[[10190,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":3000,"hp":1200,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"6费电磁炮车","normalskill":[10190],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1960],[4,816],[2,4],["6","地面"],["5","慢"],["3","11.5"]],"upcost":[[10190,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":3000,"hp":1200,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"6费电磁炮车","normalskill":[10190],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,2060],[4,818],[2,4],["6","地面"],["5","慢"],["3","11.5"]],"upcost":[],"upexp":0},"camp":3,"classlv":5,"clipname":10190,"cost":6,"desc":"坚固的重弩车,不可对空。到底是谁说可以射下巨龙的？","effectrely":[],"herotype":2,"landtype":1,"mass":5,"name":"弩车","puttype":1,"quality":3,"resrely":[],"scale":1},"10200":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3300,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"7费超级骑士","normalskill":[10200],"postype":0,"preview":[1],"pskill":[10202],"range":35,"shield":0,"showattr":[[1,3300],[8,222],[22,444],["2","1.7"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10200,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3300,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"7费超级骑士","normalskill":[10200],"postype":0,"preview":[1],"pskill":[10202],"range":35,"shield":0,"showattr":[[1,3310],[8,226],[22,444],["2","1.7"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10200,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3300,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"7费超级骑士","normalskill":[10200],"postype":0,"preview":[1],"pskill":[10202],"range":35,"shield":0,"showattr":[[1,3320],[8,230],[22,444],["2","1.7"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10200,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3300,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"7费超级骑士","normalskill":[10200],"postype":0,"preview":[1],"pskill":[10202],"range":35,"shield":0,"showattr":[[1,3330],[8,234],[22,444],["2","1.7"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10200,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3300,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"7费超级骑士","normalskill":[10200],"postype":0,"preview":[1],"pskill":[10202],"range":35,"shield":0,"showattr":[[1,3340],[8,238],[22,444],["2","1.7"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10200,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3300,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"7费超级骑士","normalskill":[10200],"postype":0,"preview":[1],"pskill":[10202],"range":35,"shield":0,"showattr":[[1,3350],[8,242],[22,444],["2","1.7"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10200,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3300,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"7费超级骑士","normalskill":[10200],"postype":0,"preview":[1],"pskill":[10202],"range":35,"shield":0,"showattr":[[1,3360],[8,246],[22,444],["2","1.7"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10200,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3300,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"7费超级骑士","normalskill":[10200],"postype":0,"preview":[1],"pskill":[10202],"range":35,"shield":0,"showattr":[[1,3370],[8,250],[22,444],["2","1.7"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10200,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3300,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"7费超级骑士","normalskill":[10200],"postype":0,"preview":[1],"pskill":[10202],"range":35,"shield":0,"showattr":[[1,3380],[8,254],[22,444],["2","1.7"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[],"upexp":0},"camp":0,"classlv":5,"clipname":50010,"cost":7,"desc":"雷神登场时会重击周围，他会造成巨量范围伤害。最好离他远点！","effectrely":[],"herotype":1,"landtype":1,"mass":5,"name":"雷神","puttype":1,"quality":1,"resrely":[],"scale":1},"10210":{"0":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":7,"lifetime":0,"mainhero":[[20060,0,0,0],[20060,-30,-30,100],[20060,-30,30,200]],"movespeed":0,"name1":"2费哥布林","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,167],[4,99],["2","1.1"],["6","地面"],["5","极快"],["3","近战"],[9,3]],"upcost":[[10210,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":7,"lifetime":0,"mainhero":[[20060,0,0,0],[20060,-30,-30,100],[20060,-30,30,200]],"movespeed":0,"name1":"2费哥布林","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,177],[4,99],["2","1.1"],["6","地面"],["5","极快"],["3","近战"],[9,3]],"upcost":[[10210,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":7,"lifetime":0,"mainhero":[[20060,0,0,0],[20060,-30,-30,100],[20060,-30,30,200]],"movespeed":0,"name1":"2费哥布林","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,187],[4,99],["2","1.1"],["6","地面"],["5","极快"],["3","近战"],[9,3]],"upcost":[[10210,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":7,"lifetime":0,"mainhero":[[20060,0,0,0],[20060,-30,-30,100],[20060,-30,30,200]],"movespeed":0,"name1":"2费哥布林","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,197],[4,99],["2","1.1"],["6","地面"],["5","极快"],["3","近战"],[9,3]],"upcost":[[10210,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":7,"lifetime":0,"mainhero":[[20060,0,0,0],[20060,-30,-30,100],[20060,-30,30,200]],"movespeed":0,"name1":"2费哥布林","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,207],[4,99],["2","1.1"],["6","地面"],["5","极快"],["3","近战"],[9,3]],"upcost":[[10210,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":7,"lifetime":0,"mainhero":[[20060,0,0,0],[20060,-30,-30,100],[20060,-30,30,200]],"movespeed":0,"name1":"2费哥布林","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,217],[4,99],["2","1.1"],["6","地面"],["5","极快"],["3","近战"],[9,3]],"upcost":[[10210,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":7,"lifetime":0,"mainhero":[[20060,0,0,0],[20060,-30,-30,100],[20060,-30,30,200]],"movespeed":0,"name1":"2费哥布林","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,227],[4,99],["2","1.1"],["6","地面"],["5","极快"],["3","近战"],[9,3]],"upcost":[[10210,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":7,"lifetime":0,"mainhero":[[20060,0,0,0],[20060,-30,-30,100],[20060,-30,30,200]],"movespeed":0,"name1":"2费哥布林","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,237],[4,99],["2","1.1"],["6","地面"],["5","极快"],["3","近战"],[9,3]],"upcost":[[10210,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":0,"childhero":[],"collidetype":[],"deploytime":1000,"hp":0,"initlv":7,"lifetime":0,"mainhero":[[20060,0,0,0],[20060,-30,-30,100],[20060,-30,30,200]],"movespeed":0,"name1":"2费哥布林","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":0,"shield":0,"showattr":[[1,247],[4,99],["2","1.1"],["6","地面"],["5","极快"],["3","近战"],[9,3]],"upcost":[],"upexp":0},"camp":0,"classlv":4,"clipname":50020,"cost":2,"desc":"三个近战的侏儒，身形矮小，行动迅捷。","effectrely":[],"herotype":1,"landtype":1,"mass":0,"name":"刺客小队","puttype":1,"quality":0,"resrely":[],"scale":1},"10220":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":2544,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"6费皇家巨人","normalskill":[10220],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,2544],[4,254],["2","1.7"],["6","建筑或器械"],["5","慢"],[3,5]],"upcost":[[10220,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":2544,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"6费皇家巨人","normalskill":[10220],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,2554],[4,256],["2","1.7"],["6","建筑或器械"],["5","慢"],[3,5]],"upcost":[[10220,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":2544,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"6费皇家巨人","normalskill":[10220],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,2564],[4,258],["2","1.7"],["6","建筑或器械"],["5","慢"],[3,5]],"upcost":[[10220,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":2544,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"6费皇家巨人","normalskill":[10220],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,2574],[4,260],["2","1.7"],["6","建筑或器械"],["5","慢"],[3,5]],"upcost":[[10220,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":2544,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"6费皇家巨人","normalskill":[10220],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,2584],[4,262],["2","1.7"],["6","建筑或器械"],["5","慢"],[3,5]],"upcost":[[10220,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":2544,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"6费皇家巨人","normalskill":[10220],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,2594],[4,264],["2","1.7"],["6","建筑或器械"],["5","慢"],[3,5]],"upcost":[[10220,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":2544,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"6费皇家巨人","normalskill":[10220],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,2604],[4,266],["2","1.7"],["6","建筑或器械"],["5","慢"],[3,5]],"upcost":[[10220,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":2544,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"6费皇家巨人","normalskill":[10220],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,2614],[4,268],["2","1.7"],["6","建筑或器械"],["5","慢"],[3,5]],"upcost":[[10220,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":2544,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"6费皇家巨人","normalskill":[10220],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,2624],[4,270],["2","1.7"],["6","建筑或器械"],["5","慢"],[3,5]],"upcost":[],"upexp":0},"camp":1,"classlv":6,"clipname":50070,"cost":6,"desc":"他到底哪里找来这么多石头？","effectrely":[],"herotype":1,"landtype":1,"mass":5,"name":"巨猿","puttype":1,"quality":0,"resrely":[],"scale":1},"10230":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":598,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费法师","normalskill":[10230],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,598],[8,234],["2","1.4"],["6","空中和地面"],["5","中等"],["3","5.5"]],"upcost":[[10230,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":598,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费法师","normalskill":[10230],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,608],[8,235],["2","1.4"],["6","空中和地面"],["5","中等"],["3","5.5"]],"upcost":[[10230,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":598,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费法师","normalskill":[10230],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,618],[8,236],["2","1.4"],["6","空中和地面"],["5","中等"],["3","5.5"]],"upcost":[[10230,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":598,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费法师","normalskill":[10230],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,628],[8,237],["2","1.4"],["6","空中和地面"],["5","中等"],["3","5.5"]],"upcost":[[10230,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":598,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费法师","normalskill":[10230],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,638],[8,238],["2","1.4"],["6","空中和地面"],["5","中等"],["3","5.5"]],"upcost":[[10230,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":598,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费法师","normalskill":[10230],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,648],[8,239],["2","1.4"],["6","空中和地面"],["5","中等"],["3","5.5"]],"upcost":[[10230,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":598,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费法师","normalskill":[10230],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,658],[8,240],["2","1.4"],["6","空中和地面"],["5","中等"],["3","5.5"]],"upcost":[[10230,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":598,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费法师","normalskill":[10230],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,668],[8,241],["2","1.4"],["6","空中和地面"],["5","中等"],["3","5.5"]],"upcost":[[10230,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":598,"initlv":7,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费法师","normalskill":[10230],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,678],[8,242],["2","1.4"],["6","空中和地面"],["5","中等"],["3","5.5"]],"upcost":[],"upexp":0},"camp":0,"classlv":4,"clipname":50030,"cost":5,"desc":"擅长奥秘与法术，能击败大群敌人。","effectrely":[],"herotype":1,"landtype":1,"mass":1,"name":"女巫","puttype":1,"quality":1,"resrely":[],"scale":1},"10240":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1396,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"5费气球","normalskill":[10240],"postype":0,"preview":[1],"pskill":[],"range":25,"shield":0,"showattr":[[1,1396],[4,798],[2,3],["6","建筑或器械"],["5","中等"],["3","近战"]],"upcost":[[10240,10],[2,50]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1396,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"5费气球","normalskill":[10240],"postype":0,"preview":[1],"pskill":[],"range":25,"shield":0,"showattr":[[1,1396],[4,798],[2,3],["6","建筑或器械"],["5","中等"],["3","近战"]],"upcost":[[10240,10],[2,50]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1396,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"5费气球","normalskill":[10240],"postype":0,"preview":[1],"pskill":[],"range":25,"shield":0,"showattr":[[1,1396],[4,798],[2,3],["6","建筑或器械"],["5","中等"],["3","近战"]],"upcost":[[10240,10],[2,50]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1396,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"5费气球","normalskill":[10240],"postype":0,"preview":[1],"pskill":[],"range":25,"shield":0,"showattr":[[1,1396],[4,798],[2,3],["6","建筑或器械"],["5","中等"],["3","近战"]],"upcost":[[10240,10],[2,50]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1396,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"5费气球","normalskill":[10240],"postype":0,"preview":[1],"pskill":[],"range":25,"shield":0,"showattr":[[1,1396],[4,798],[2,3],["6","建筑或器械"],["5","中等"],["3","近战"]],"upcost":[[10240,10],[2,50]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1396,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"5费气球","normalskill":[10240],"postype":0,"preview":[1],"pskill":[],"range":25,"shield":0,"showattr":[[1,1396],[4,798],[2,3],["6","建筑或器械"],["5","中等"],["3","近战"]],"upcost":[[10240,10],[2,50]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1396,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"5费气球","normalskill":[10240],"postype":0,"preview":[1],"pskill":[],"range":25,"shield":0,"showattr":[[1,1396],[4,798],[2,3],["6","建筑或器械"],["5","中等"],["3","近战"]],"upcost":[[10240,10],[2,50]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1396,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"5费气球","normalskill":[10240],"postype":0,"preview":[1],"pskill":[],"range":25,"shield":0,"showattr":[[1,1396],[4,798],[2,3],["6","建筑或器械"],["5","中等"],["3","近战"]],"upcost":[[10240,10],[2,50]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1396,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"5费气球","normalskill":[10240],"postype":0,"preview":[1],"pskill":[],"range":25,"shield":0,"showattr":[[1,1396],[4,798],[2,3],["6","建筑或器械"],["5","中等"],["3","近战"]],"upcost":[],"upexp":0},"camp":3,"classlv":6,"clipname":50040,"cost":5,"desc":"侏儒发明了蒸汽技术和炸弹技术，并把他们都应用在蒸汽飞艇上","effectrely":[],"herotype":2,"landtype":2,"mass":1,"name":"蒸汽飞艇","puttype":2,"quality":2,"resrely":[],"scale":1},"10250":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":590,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费冰法","normalskill":[10250],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,590],[8,75],["2","1.7"],["6","空中和地面"],["5","中等"],["3","5.5"],["13","2.5"]],"upcost":[[10250,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":590,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费冰法","normalskill":[10250],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,591],[8,76],["2","1.7"],["6","空中和地面"],["5","中等"],["3","5.5"],["13","2.5"]],"upcost":[[10250,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":590,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费冰法","normalskill":[10250],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,592],[8,77],["2","1.7"],["6","空中和地面"],["5","中等"],["3","5.5"],["13","2.5"]],"upcost":[[10250,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":590,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费冰法","normalskill":[10250],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,593],[8,78],["2","1.7"],["6","空中和地面"],["5","中等"],["3","5.5"],["13","2.5"]],"upcost":[[10250,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":590,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费冰法","normalskill":[10250],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,594],[8,79],["2","1.7"],["6","空中和地面"],["5","中等"],["3","5.5"],["13","2.5"]],"upcost":[[10250,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":590,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费冰法","normalskill":[10250],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,595],[8,80],["2","1.7"],["6","空中和地面"],["5","中等"],["3","5.5"],["13","2.5"]],"upcost":[[10250,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":590,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费冰法","normalskill":[10250],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,596],[8,81],["2","1.7"],["6","空中和地面"],["5","中等"],["3","5.5"],["13","2.5"]],"upcost":[[10250,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":590,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费冰法","normalskill":[10250],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,597],[8,82],["2","1.7"],["6","空中和地面"],["5","中等"],["3","5.5"],["13","2.5"]],"upcost":[[10250,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":590,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费冰法","normalskill":[10250],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,598],[8,83],["2","1.7"],["6","空中和地面"],["5","中等"],["3","5.5"],["13","2.5"]],"upcost":[],"upexp":0},"camp":0,"classlv":5,"clipname":50030,"cost":3,"desc":"每个人看见冰雪公主时都会说“哇，真酷！”","effectrely":[10251,10252],"herotype":1,"landtype":1,"mass":1,"name":"冰雪公主","puttype":1,"quality":3,"resrely":[],"scale":1},"10260":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":742,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费加农炮","normalskill":[10260],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,742],[4,167],[2,1],["6","地面"],["5","中等"],[3,5]],"upcost":[[10260,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":742,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费加农炮","normalskill":[10260],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,743],[4,168],[2,1],["6","地面"],["5","中等"],[3,5]],"upcost":[[10260,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":742,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费加农炮","normalskill":[10260],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,744],[4,169],[2,1],["6","地面"],["5","中等"],[3,5]],"upcost":[[10260,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":742,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费加农炮","normalskill":[10260],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,745],[4,170],[2,1],["6","地面"],["5","中等"],[3,5]],"upcost":[[10260,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":742,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费加农炮","normalskill":[10260],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,746],[4,171],[2,1],["6","地面"],["5","中等"],[3,5]],"upcost":[[10260,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":742,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费加农炮","normalskill":[10260],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,747],[4,172],[2,1],["6","地面"],["5","中等"],[3,5]],"upcost":[[10260,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":742,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费加农炮","normalskill":[10260],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,748],[4,173],[2,1],["6","地面"],["5","中等"],[3,5]],"upcost":[[10260,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":742,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费加农炮","normalskill":[10260],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,749],[4,174],[2,1],["6","地面"],["5","中等"],[3,5]],"upcost":[[10260,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":742,"initlv":9,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"3费加农炮","normalskill":[10260],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,750],[4,175],[2,1],["6","地面"],["5","中等"],[3,5]],"upcost":[],"upexp":0},"camp":0,"classlv":5,"clipname":50030,"cost":3,"desc":"他可以有效惹怒对手！不过很浪费食物，请勿模仿。","effectrely":[10251,10252],"herotype":1,"landtype":1,"mass":1,"name":"斯巴达农夫","puttype":1,"quality":0,"resrely":[],"scale":1},"10270":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":954,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费特斯拉电磁塔","normalskill":[10270],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,954],[4,95],["2","0.6"],["6","空中和地面"],["5","中等"],["3","5.5"]],"upcost":[[10270,10],[2,50]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":954,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费特斯拉电磁塔","normalskill":[10270],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,954],[4,95],["2","0.6"],["6","空中和地面"],["5","中等"],["3","5.5"]],"upcost":[[10270,10],[2,50]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":954,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费特斯拉电磁塔","normalskill":[10270],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,954],[4,95],["2","0.6"],["6","空中和地面"],["5","中等"],["3","5.5"]],"upcost":[[10270,10],[2,50]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":954,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费特斯拉电磁塔","normalskill":[10270],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,954],[4,95],["2","0.6"],["6","空中和地面"],["5","中等"],["3","5.5"]],"upcost":[[10270,10],[2,50]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":954,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费特斯拉电磁塔","normalskill":[10270],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,954],[4,95],["2","0.6"],["6","空中和地面"],["5","中等"],["3","5.5"]],"upcost":[[10270,10],[2,50]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":954,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费特斯拉电磁塔","normalskill":[10270],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,954],[4,95],["2","0.6"],["6","空中和地面"],["5","中等"],["3","5.5"]],"upcost":[[10270,10],[2,50]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":954,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费特斯拉电磁塔","normalskill":[10270],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,954],[4,95],["2","0.6"],["6","空中和地面"],["5","中等"],["3","5.5"]],"upcost":[[10270,10],[2,50]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":954,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费特斯拉电磁塔","normalskill":[10270],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,954],[4,95],["2","0.6"],["6","空中和地面"],["5","中等"],["3","5.5"]],"upcost":[[10270,10],[2,50]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":954,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"4费特斯拉电磁塔","normalskill":[10270],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,954],[4,95],["2","0.6"],["6","空中和地面"],["5","中等"],["3","5.5"]],"upcost":[],"upexp":0},"camp":0,"classlv":7,"clipname":50030,"cost":4,"desc":"他不一定能打败对手，但一定能气死对手。","effectrely":[],"herotype":1,"landtype":1,"mass":1,"name":"吵闹的猴子","puttype":1,"quality":0,"resrely":[],"scale":1},"10280":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":3000,"hp":4256,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"8费石头人","normalskill":[10280],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,4256],[4,259],["2","2.5"],["6","建筑与器械"],["5","慢"],["3","近战"],[19,3]],"upcost":[[10280,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":3000,"hp":4256,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"8费石头人","normalskill":[10280],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,4356],[4,260],["2","2.5"],["6","建筑与器械"],["5","慢"],["3","近战"],[19,3]],"upcost":[[10280,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":3000,"hp":4256,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"8费石头人","normalskill":[10280],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,4456],[4,261],["2","2.5"],["6","建筑与器械"],["5","慢"],["3","近战"],[19,3]],"upcost":[[10280,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":3000,"hp":4256,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"8费石头人","normalskill":[10280],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,4556],[4,262],["2","2.5"],["6","建筑与器械"],["5","慢"],["3","近战"],[19,3]],"upcost":[[10280,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":3000,"hp":4256,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"8费石头人","normalskill":[10280],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,4656],[4,263],["2","2.5"],["6","建筑与器械"],["5","慢"],["3","近战"],[19,3]],"upcost":[[10280,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":3000,"hp":4256,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"8费石头人","normalskill":[10280],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,4756],[4,264],["2","2.5"],["6","建筑与器械"],["5","慢"],["3","近战"],[19,3]],"upcost":[[10280,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":3000,"hp":4256,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"8费石头人","normalskill":[10280],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,4856],[4,265],["2","2.5"],["6","建筑与器械"],["5","慢"],["3","近战"],[19,3]],"upcost":[[10280,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":3000,"hp":4256,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"8费石头人","normalskill":[10280],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,4956],[4,266],["2","2.5"],["6","建筑与器械"],["5","慢"],["3","近战"],[19,3]],"upcost":[[10280,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":3000,"hp":4256,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"8费石头人","normalskill":[10280],"postype":0,"preview":[1],"pskill":[],"range":35,"shield":0,"showattr":[[1,5056],[4,267],["2","2.5"],["6","建筑与器械"],["5","慢"],["3","近战"],[19,3]],"upcost":[],"upexp":0},"camp":2,"classlv":6,"clipname":50070,"cost":8,"desc":"泰坦缓慢又坚硬，几乎没有任何攻击能有效对抗泰坦。","effectrely":[],"herotype":1,"landtype":1,"mass":5,"name":"泰坦","puttype":1,"quality":2,"resrely":[],"scale":1},"10290":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3125,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"7费大皮卡","normalskill":[10290],"postype":0,"preview":[1],"pskill":[],"range":30,"shield":0,"showattr":[[1,3125],[4,678],["2","1.8"],["6","地面"],["5","慢"],["3","近战"]],"upcost":[[10290,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3125,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"7费大皮卡","normalskill":[10290],"postype":0,"preview":[1],"pskill":[],"range":30,"shield":0,"showattr":[[1,3225],[4,688],["2","1.8"],["6","地面"],["5","慢"],["3","近战"]],"upcost":[[10290,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3125,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"7费大皮卡","normalskill":[10290],"postype":0,"preview":[1],"pskill":[],"range":30,"shield":0,"showattr":[[1,3325],[4,698],["2","1.8"],["6","地面"],["5","慢"],["3","近战"]],"upcost":[[10290,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3125,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"7费大皮卡","normalskill":[10290],"postype":0,"preview":[1],"pskill":[],"range":30,"shield":0,"showattr":[[1,3425],[4,708],["2","1.8"],["6","地面"],["5","慢"],["3","近战"]],"upcost":[[10290,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3125,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"7费大皮卡","normalskill":[10290],"postype":0,"preview":[1],"pskill":[],"range":30,"shield":0,"showattr":[[1,3525],[4,718],["2","1.8"],["6","地面"],["5","慢"],["3","近战"]],"upcost":[[10290,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3125,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"7费大皮卡","normalskill":[10290],"postype":0,"preview":[1],"pskill":[],"range":30,"shield":0,"showattr":[[1,3625],[4,728],["2","1.8"],["6","地面"],["5","慢"],["3","近战"]],"upcost":[[10290,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3125,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"7费大皮卡","normalskill":[10290],"postype":0,"preview":[1],"pskill":[],"range":30,"shield":0,"showattr":[[1,3725],[4,738],["2","1.8"],["6","地面"],["5","慢"],["3","近战"]],"upcost":[[10290,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3125,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"7费大皮卡","normalskill":[10290],"postype":0,"preview":[1],"pskill":[],"range":30,"shield":0,"showattr":[[1,3825],[4,748],["2","1.8"],["6","地面"],["5","慢"],["3","近战"]],"upcost":[[10290,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":3125,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"7费大皮卡","normalskill":[10290],"postype":0,"preview":[1],"pskill":[],"range":30,"shield":0,"showattr":[[1,3925],[4,758],["2","1.8"],["6","地面"],["5","慢"],["3","近战"]],"upcost":[],"upexp":0},"camp":2,"classlv":7,"clipname":50070,"cost":7,"desc":"国王身披重甲，佩戴重剑。动作有点缓慢。","effectrely":[],"herotype":1,"landtype":1,"mass":5,"name":"国王","puttype":1,"quality":2,"resrely":[],"scale":1},"10300":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1654,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费武神","normalskill":[10300],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1654],[8,221],["2","1.5"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10300,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1654,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费武神","normalskill":[10300],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1664],[8,223],["2","1.5"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10300,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1654,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费武神","normalskill":[10300],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1674],[8,225],["2","1.5"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10300,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1654,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费武神","normalskill":[10300],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1684],[8,227],["2","1.5"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10300,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1654,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费武神","normalskill":[10300],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1694],[8,229],["2","1.5"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10300,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1654,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费武神","normalskill":[10300],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1704],[8,231],["2","1.5"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10300,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1654,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费武神","normalskill":[10300],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1714],[8,233],["2","1.5"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10300,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1654,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费武神","normalskill":[10300],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1724],[8,235],["2","1.5"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[[10300,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":1654,"initlv":13,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"4费武神","normalskill":[10300],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1734],[8,237],["2","1.5"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[],"upexp":0},"camp":0,"classlv":7,"clipname":50010,"cost":4,"desc":"会用他锋利的武器，范围攻击前方敌人。","effectrely":[],"herotype":1,"landtype":1,"mass":1,"name":"巨狼","puttype":1,"quality":1,"resrely":[],"scale":1},"10310":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":994,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"2费冰人","normalskill":[10310],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,994],[4,70],[2,2],["6","地面"],["5","慢"],["3","近战"]],"upcost":[[10310,5],[2,100]],"upexp":5},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":994,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"2费冰人","normalskill":[10310],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,1994],[4,70],[2,2],["6","地面"],["5","慢"],["3","近战"]],"upcost":[[10310,10],[2,150]],"upexp":10},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":994,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"2费冰人","normalskill":[10310],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,2994],[4,70],[2,2],["6","地面"],["5","慢"],["3","近战"]],"upcost":[[10310,15],[2,200]],"upexp":20},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":994,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"2费冰人","normalskill":[10310],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,3994],[4,70],[2,2],["6","地面"],["5","慢"],["3","近战"]],"upcost":[[10310,20],[2,250]],"upexp":40},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":994,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"2费冰人","normalskill":[10310],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,4994],[4,70],[2,2],["6","地面"],["5","慢"],["3","近战"]],"upcost":[[10310,25],[2,300]],"upexp":80},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":994,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"2费冰人","normalskill":[10310],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,5994],[4,70],[2,2],["6","地面"],["5","慢"],["3","近战"]],"upcost":[[10310,30],[2,350]],"upexp":160},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":994,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"2费冰人","normalskill":[10310],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,6994],[4,70],[2,2],["6","地面"],["5","慢"],["3","近战"]],"upcost":[[10310,35],[2,400]],"upexp":320},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":994,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"2费冰人","normalskill":[10310],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,7994],[4,70],[2,2],["6","地面"],["5","慢"],["3","近战"]],"upcost":[[10310,40],[2,450]],"upexp":640},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":994,"initlv":11,"lifetime":0,"mainhero":[],"movespeed":30,"name1":"2费冰人","normalskill":[10310],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,8994],[4,70],[2,2],["6","地面"],["5","慢"],["3","近战"]],"upcost":[],"upexp":0},"camp":0,"classlv":6,"clipname":50020,"cost":2,"desc":"他只是过来打酱油的。","effectrely":[],"herotype":1,"landtype":1,"mass":1,"name":"沙和尚","puttype":1,"quality":1,"resrely":[],"scale":1},"19020":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":1820,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[],"postype":0,"preview":[1],"pskill":[],"range":45,"shield":0,"showattr":[],"upcost":[],"upexp":0},"camp":0,"classlv":0,"clipname":19020,"cost":2,"desc":"","effectrely":[],"herotype":3,"landtype":1,"mass":100,"name":"水晶","puttype":0,"quality":0,"resrely":[],"scale":1},"20010":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":275,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":94,"name1":"2费自爆炸弹","normalskill":[20010],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":275,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":94,"name1":"2费自爆炸弹","normalskill":[20010],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":275,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":94,"name1":"2费自爆炸弹","normalskill":[20010],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":275,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":94,"name1":"2费自爆炸弹","normalskill":[20010],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":275,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":94,"name1":"2费自爆炸弹","normalskill":[20010],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":275,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":94,"name1":"2费自爆炸弹","normalskill":[20010],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":275,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":94,"name1":"2费自爆炸弹","normalskill":[20010],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":275,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":94,"name1":"2费自爆炸弹","normalskill":[20010],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":275,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":94,"name1":"2费自爆炸弹","normalskill":[20010],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"camp":0,"classlv":0,"clipname":50020,"cost":2,"desc":"","effectrely":[30010],"herotype":1,"landtype":1,"mass":1,"name":"黑暗精灵","puttype":1,"quality":0,"resrely":[],"scale":1},"20020":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":110,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"2费哥布林投矛手","normalskill":[20020],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":110,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"2费哥布林投矛手","normalskill":[20020],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":110,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"2费哥布林投矛手","normalskill":[20020],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":110,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"2费哥布林投矛手","normalskill":[20020],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":110,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"2费哥布林投矛手","normalskill":[20020],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":110,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"2费哥布林投矛手","normalskill":[20020],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":110,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"2费哥布林投矛手","normalskill":[20020],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":110,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"2费哥布林投矛手","normalskill":[20020],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":110,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"2费哥布林投矛手","normalskill":[20020],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"camp":0,"classlv":0,"clipname":50030,"cost":2,"desc":"","effectrely":[10051],"herotype":1,"landtype":1,"mass":1,"name":"枪手","puttype":1,"quality":0,"resrely":[],"scale":1},"20030":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":190,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"3费小苍蝇","normalskill":[20030],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":190,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"3费小苍蝇","normalskill":[20030],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":190,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"3费小苍蝇","normalskill":[20030],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":190,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"3费小苍蝇","normalskill":[20030],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":190,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"3费小苍蝇","normalskill":[20030],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":190,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"3费小苍蝇","normalskill":[20030],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":190,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"3费小苍蝇","normalskill":[20030],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":190,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"3费小苍蝇","normalskill":[20030],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":190,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":66,"name1":"3费小苍蝇","normalskill":[20030],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"camp":0,"classlv":0,"clipname":50060,"cost":3,"desc":"","effectrely":[],"herotype":1,"landtype":2,"mass":1,"name":"光明精灵","puttype":2,"quality":0,"resrely":[],"scale":1},"20040":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":67,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"1费小骷髅","normalskill":[20040],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,67],[4,67],[2,1],["6","地面"],["5","快"],["3","近战"]],"upcost":[],"upexp":0},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":67,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"1费小骷髅","normalskill":[20040],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,68],[4,68],[2,1],["6","地面"],["5","快"],["3","近战"]],"upcost":[],"upexp":0},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":67,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"1费小骷髅","normalskill":[20040],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,69],[4,69],[2,1],["6","地面"],["5","快"],["3","近战"]],"upcost":[],"upexp":0},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":67,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"1费小骷髅","normalskill":[20040],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,70],[4,70],[2,1],["6","地面"],["5","快"],["3","近战"]],"upcost":[],"upexp":0},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":67,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"1费小骷髅","normalskill":[20040],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,71],[4,71],[2,1],["6","地面"],["5","快"],["3","近战"]],"upcost":[],"upexp":0},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":67,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"1费小骷髅","normalskill":[20040],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,72],[4,72],[2,1],["6","地面"],["5","快"],["3","近战"]],"upcost":[],"upexp":0},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":67,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"1费小骷髅","normalskill":[20040],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,73],[4,73],[2,1],["6","地面"],["5","快"],["3","近战"]],"upcost":[],"upexp":0},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":67,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"1费小骷髅","normalskill":[20040],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,74],[4,74],[2,1],["6","地面"],["5","快"],["3","近战"]],"upcost":[],"upexp":0},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":67,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"1费小骷髅","normalskill":[20040],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,75],[4,75],[2,1],["6","地面"],["5","快"],["3","近战"]],"upcost":[],"upexp":0},"camp":0,"classlv":0,"clipname":50020,"cost":1,"desc":"","effectrely":[],"herotype":1,"landtype":1,"mass":1,"name":"猴子","puttype":1,"quality":0,"resrely":[],"scale":1},"20050":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":555,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费野蛮人","normalskill":[20050],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,555],[4,159],["2","1.4"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[],"upexp":0},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":555,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费野蛮人","normalskill":[20050],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,555],[4,159],["2","1.4"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[],"upexp":0},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":555,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费野蛮人","normalskill":[20050],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,555],[4,159],["2","1.4"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[],"upexp":0},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":555,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费野蛮人","normalskill":[20050],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,555],[4,159],["2","1.4"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[],"upexp":0},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":555,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费野蛮人","normalskill":[20050],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,555],[4,159],["2","1.4"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[],"upexp":0},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":555,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费野蛮人","normalskill":[20050],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,555],[4,159],["2","1.4"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[],"upexp":0},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":555,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费野蛮人","normalskill":[20050],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,555],[4,159],["2","1.4"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[],"upexp":0},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":555,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费野蛮人","normalskill":[20050],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,555],[4,159],["2","1.4"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[],"upexp":0},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":555,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":47,"name1":"5费野蛮人","normalskill":[20050],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[[1,555],[4,159],["2","1.4"],["6","地面"],["5","中等"],["3","近战"]],"upcost":[],"upexp":0},"camp":0,"classlv":0,"clipname":50020,"cost":5,"desc":"","effectrely":[],"herotype":1,"landtype":1,"mass":1,"name":"希腊战士","puttype":1,"quality":0,"resrely":[],"scale":1},"20060":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":167,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":93,"name1":"2费哥布林","normalskill":[20060],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":167,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":93,"name1":"2费哥布林","normalskill":[20060],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":167,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":93,"name1":"2费哥布林","normalskill":[20060],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":167,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":93,"name1":"2费哥布林","normalskill":[20060],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":167,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":93,"name1":"2费哥布林","normalskill":[20060],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":167,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":93,"name1":"2费哥布林","normalskill":[20060],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":167,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":93,"name1":"2费哥布林","normalskill":[20060],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":167,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":93,"name1":"2费哥布林","normalskill":[20060],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":1000,"hp":167,"initlv":1,"lifetime":0,"mainhero":[],"movespeed":93,"name1":"2费哥布林","normalskill":[20060],"postype":0,"preview":[1],"pskill":[],"range":20,"shield":0,"showattr":[],"upcost":[],"upexp":0},"camp":0,"classlv":0,"clipname":50020,"cost":2,"desc":"","effectrely":[],"herotype":1,"landtype":1,"mass":1,"name":"刺客小队","puttype":1,"quality":0,"resrely":[],"scale":1},"99010":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":2534,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99010],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,2534],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":2787,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99010],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,2787],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":3065,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99010],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,3065],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":3371,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99010],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,3371],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":3708,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99010],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,3708],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":4078,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99010],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,4078],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":4485,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99010],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,4485],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":4933,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99010],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,4933],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":5426,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99010],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,5426],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"camp":1,"classlv":0,"clipname":99040,"cost":0,"desc":"一位睿智的军师，同时还是个优雅的君子。","effectrely":[99011,99012],"herotype":3,"landtype":1,"mass":100,"name":"诸葛亮","puttype":0,"quality":0,"resrely":[],"scale":1},"99020":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":2534,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99020],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,2534],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":2787,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99020],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,2787],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":3065,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99020],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,3065],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":3371,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99020],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,3371],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":3708,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99020],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,3708],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":4078,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99020],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,4078],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":4485,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99020],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,4485],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":4933,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99020],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,4933],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":5426,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99020],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,5426],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"camp":2,"classlv":0,"clipname":99040,"cost":0,"desc":"别被丹妮美丽的外观迷惑了，打起仗来，她可是毫不留情。","effectrely":[99021,99022],"herotype":3,"landtype":1,"mass":100,"name":"丹妮","puttype":0,"quality":0,"resrely":[],"scale":1},"99030":{"0":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":2534,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99020],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,2534],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"1":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":2787,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99020],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,2787],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"2":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":3065,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99020],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,3065],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"3":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":3371,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99020],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,3371],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"4":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":3708,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99020],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,3708],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"5":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":4078,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99020],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,4078],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"6":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":4485,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99020],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,4485],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"7":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":4933,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99020],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,4933],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"8":{"activeskill":[],"attackspeed":500,"childhero":[],"collidetype":[],"deploytime":0,"hp":5426,"initlv":0,"lifetime":0,"mainhero":[],"movespeed":0,"name1":"","normalskill":[99020],"postype":0,"preview":[1],"pskill":[],"range":60,"shield":0,"showattr":[[1,5426],[23,1820],["2","1.5"],[4,150]],"upcost":[],"upexp":0},"camp":3,"classlv":0,"clipname":99040,"cost":0,"desc":"据说白胡子是因为太爱吃海鲜才当海盗的。他非常乐于助人，很喜欢与大家分享他煮的美味煎鱼！","effectrely":[99021,99022],"herotype":3,"landtype":1,"mass":100,"name":"白胡子","puttype":0,"quality":0,"resrely":[],"scale":1}}{"10010":{"skill1":10011,"skill2":10012},"10020":{"skill1":10021,"skill2":10022},"10030":{"skill1":10031,"skill2":10032},"10040":{"skill1":10041,"skill2":10042},"10050":{"skill1":10051,"skill2":10052},"10060":{"skill1":10061,"skill2":10062},"10070":{"skill1":10061,"skill2":10062},"10080":{"skill1":10061,"skill2":10062}}{"10010":{"godlevel":1,"group":[1,3,5],"level":1,"quality":1},"10030":{"godlevel":1,"group":[1,2,3,4,5,6],"level":1,"quality":1},"10040":{"godlevel":1,"group":[1,2,3,4,5,6],"level":1,"quality":1},"10050":{"godlevel":1,"group":[1,2,3,4,5,6],"level":1,"quality":1},"10080":{"godlevel":1,"group":[2,4,6],"level":1,"quality":1},"10100":{"godlevel":1,"group":[1,2,3,4,5,6],"level":1,"quality":1},"10120":{"godlevel":1,"group":[1,2,3,4,5,6],"level":1,"quality":1},"10140":{"godlevel":1,"group":[2,4,6],"level":1,"quality":1},"10170":{"godlevel":1,"group":[1,2,3,4,5,6],"level":1,"quality":1},"10220":{"godlevel":1,"group":[1,3,5],"level":1,"quality":1},"99010":{"godlevel":1,"group":[1,5],"level":1,"quality":1},"99020":{"godlevel":1,"group":[2,4],"level":1,"quality":1},"99030":{"godlevel":1,"group":[3,6],"level":1,"quality":1}}{"1":{"action":[],"batch":0,"desc":"经验","name":"经验","sellprice":0,"type":0},"2":{"action":[],"batch":0,"desc":"金币","name":"金币","sellprice":0,"type":0},"3":{"action":[],"batch":0,"desc":"钻石","name":"钻石","sellprice":0,"type":0},"4":{"action":[],"batch":0,"desc":"奖杯","name":"奖杯","sellprice":0,"type":0},"5":{"action":[],"batch":0,"desc":"等级","name":"等级","sellprice":0,"type":0},"6":{"action":[],"batch":0,"desc":"任务积分","name":"任务积分","sellprice":0,"type":0},"7":{"action":[],"batch":0,"desc":"等级阶","name":"等级阶","sellprice":0,"type":0},"8":{"action":[],"batch":0,"desc":"家族积分","name":"家族积分","sellprice":0,"type":0},"100":{"action":[],"batch":0,"desc":"人民币","name":"人民币","sellprice":0,"type":0},"20010":{"action":[100,20010],"batch":0,"desc":"任务积分宝箱","name":"任务积分宝箱","sellprice":0,"type":2},"20110":{"action":[100,20110],"batch":0,"desc":"8阶王者宝箱","name":"8阶王者宝箱","sellprice":0,"type":2},"20111":{"action":[100,20111],"batch":0,"desc":"8阶幸运宝箱","name":"8阶幸运宝箱","sellprice":0,"type":2},"21010":{"action":[],"batch":0,"desc":"雪人封印","name":"雪人封印","sellprice":0,"type":2},"21011":{"action":[],"batch":0,"desc":"圣诞老人封印","name":"圣诞老人封印","sellprice":0,"type":2},"21210":{"action":[],"batch":0,"desc":"愤怒表情","name":"愤怒表情","sellprice":0,"type":2},"21211":{"action":[],"batch":0,"desc":"委屈表情","name":"委屈表情","sellprice":0,"type":2},"21610":{"action":[],"batch":0,"desc":"永恒之恋头像","name":"永恒之恋头像","sellprice":0,"type":0},"21611":{"action":[],"batch":0,"desc":"星恒传说头像","name":"星恒传说头像","sellprice":0,"type":0},"21710":{"action":[],"batch":0,"desc":"永恒之恋聊天框","name":"永恒之恋聊天框","sellprice":0,"type":0},"21711":{"action":[],"batch":0,"desc":"星恒传说聊天框","name":"星恒传说聊天框","sellprice":0,"type":0},"23010":{"action":[3,80],"batch":0,"desc":"80钻石","name":"80钻石","sellprice":0,"type":2},"23011":{"action":[3,500],"batch":0,"desc":"500钻石","name":"500钻石","sellprice":0,"type":2},"23012":{"action":[3,1200],"batch":0,"desc":"1200钻石","name":"1200钻石","sellprice":0,"type":0},"23013":{"action":[3,2500],"batch":0,"desc":"2500钻石","name":"2500钻石","sellprice":0,"type":0},"23014":{"action":[3,6500],"batch":0,"desc":"6500钻石","name":"6500钻石","sellprice":0,"type":0},"23015":{"action":[3,14000],"batch":0,"desc":"14000钻石","name":"14000钻石","sellprice":0,"type":0},"23110":{"action":[2,1000],"batch":0,"desc":"1000金币","name":"1000金币","sellprice":0,"type":2},"23111":{"action":[2,5000],"batch":0,"desc":"5000金币","name":"5000金币","sellprice":0,"type":2},"23112":{"action":[2,10000],"batch":0,"desc":"10000金币","name":"10000金币","sellprice":0,"type":0},"23113":{"action":[2,20000],"batch":0,"desc":"20000金币","name":"20000金币","sellprice":0,"type":0},"23114":{"action":[2,50000],"batch":0,"desc":"50000金币","name":"50000金币","sellprice":0,"type":0},"23115":{"action":[2,100000],"batch":0,"desc":"100000金币","name":"100000金币","sellprice":0,"type":0},"24010":{"action":[2,500],"batch":0,"desc":"500金币","name":"500金币","sellprice":0,"type":2},"24011":{"action":[100,24011],"batch":0,"desc":"史诗英雄礼包","name":"史诗英雄礼包","sellprice":0,"type":2},"24012":{"action":[100,24012],"batch":0,"desc":"传奇英雄卡包","name":"传奇英雄卡包","sellprice":0,"type":2},"25010":{"action":[100,25010],"batch":0,"desc":"8阶竞技宝箱","name":"8阶竞技宝箱","sellprice":0,"type":2},"25310":{"action":[100,25310],"batch":0,"desc":"战斗宝箱","name":"赛事第1名宝箱","sellprice":0,"type":2},"25311":{"action":[100,25311],"batch":0,"desc":"战斗宝箱","name":"赛事第2名宝箱","sellprice":0,"type":2},"25312":{"action":[100,25312],"batch":0,"desc":"战斗宝箱","name":"赛事第3名宝箱","sellprice":0,"type":2},"25313":{"action":[100,25313],"batch":0,"desc":"战斗宝箱","name":"赛事第4-10名宝箱","sellprice":0,"type":2},"25314":{"action":[100,25314],"batch":0,"desc":"战斗宝箱","name":"赛事第11-50名宝箱","sellprice":0,"type":2},"25315":{"action":[100,25315],"batch":0,"desc":"战斗宝箱","name":"赛事第51-100名宝箱","sellprice":0,"type":2},"25316":{"action":[100,25316],"batch":0,"desc":"战斗宝箱","name":"赛事第101-500名宝箱","sellprice":0,"type":2},"25317":{"action":[100,25317],"batch":0,"desc":"战斗宝箱","name":"赛事第501-1000名宝箱","sellprice":0,"type":2},"25318":{"action":[100,25318],"batch":0,"desc":"战斗宝箱","name":"赛事第1001名以后宝箱","sellprice":0,"type":2}}{"9901001":{"icon":99010,"name":"领主99010"},"9902001":{"icon":99020,"name":"领主99020"},"9903001":{"icon":99030,"name":"领主99030"},"9904001":{"icon":99040,"name":"领主99040"}}﻿{"101":[[0,"ShowHPBar","Att"],[0,"End"]],"102":[[1100,"End"]],"104":[[0,"SetAlpha","Att",0],[0,"CreateEffectOnMap",9005,"Att",0,-35,"","die",2],[0,"SetEffectTime","die",1.2],[1200,"DestroyEffect","die"],[0,"End"]],"9001":[[0,"CreateEffectOnMap",9001,"Att",0,20,"","burn",2],[90000,"End"]],"10010":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[500,"VitHurt","Vit"]],"20010":[[0,"FaceTo","Att","OneVit"],[200,"CreateEffectOnMap",30010,"OneVit",0,0,"","key1",1],[400,"End"]],"10030":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[500,"VitHurt","Vit"]],"10031":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[1000,"VitHurt","Vit"]],"10032":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[1000,"VitHurt","Vit"]],"20020":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att",2,1],[0,"WaitLogicCMD","vit"],[0,"CreateEffectOnMap",10051,"Att",0,0,"attackPoint","gongjian",1],[0,"CurveMove","gongjian","Vit",300,0,0,50,11],[0,"WaitMoveOver","gongjian"],[0,"DestroyEffect","gongjian"],[0,"VitHurt","Vit"]],"10050":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att",2,1],[0,"WaitLogicCMD","vit"],[0,"CreateEffectOnMap",10051,"Att",0,0,"attackPoint","gongjian",1],[0,"CurveMove","gongjian","Vit",0,0,0,50,11],[0,"WaitMoveOver","gongjian"],[0,"DestroyEffect","gongjian"],[0,"VitHurt","Vit"]],"20030":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att",2,1],[0,"WaitLogicCMD","vit"],[0,"CreateEffectOnMap",9010,"Att",0,0,"attackPoint","gongjian",1],[0,"CurveMove","gongjian","Vit",150,0,0,50,11],[0,"WaitMoveOver","gongjian"],[0,"DestroyEffect","gongjian"],[0,"VitHurt","Vit"]],"10070":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[400,"VitHurt","Vit"]],"10080":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[500,"VitHurt","Vit"]],"10090":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att",2,1],[0,"WaitLogicCMD","vit"],[0,"CreateEffectOnMap",9010,"Att",0,0,"attackPoint","gongjian",1],[0,"CurveMove","gongjian","Vit",0,0,0,50,11],[0,"WaitMoveOver","gongjian"],[0,"DestroyEffect","gongjian"],[0,"VitHurt","Vit"]],"20040":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[400,"VitHurt","Vit"]],"10110":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[400,"VitHurt","Vit"]],"10120":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att",2,1],[0,"WaitLogicCMD","vit"],[0,"CreateEffectOnMap",9010,"Att",0,0,"attackPoint","gongjian",1],[0,"CurveMove","gongjian","Vit",0,0,0,50,12],[0,"WaitMoveOver","gongjian"],[0,"DestroyEffect","gongjian"],[0,"VitHurt","Vit"]],"10130":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[500,"VitHurt","Vit"]],"10131":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[1000,"VitHurt","Vit"]],"10132":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[1000,"VitHurt","Vit"]],"10140":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att",2,1],[0,"WaitLogicCMD","vit"],[0,"CreateEffectOnMap",10141,"Att",0,0,"attackPoint","gongjian",1],[0,"CurveMove","gongjian","Vit",0,0,0,50,21],[0,"WaitMoveOver","gongjian"],[0,"DestroyEffect","gongjian"],[0,"CreateEffectOnMap",10142,"OneVit",0,0,"vitPoint","shouji",1],[0,"VitHurt","Vit"],[500,"End"]],"10150":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[300,"VitHurt","Vit"]],"10160":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[500,"VitHurt","Vit"]],"20050":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[300,"VitHurt","Vit"]],"10180":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[500,"VitHurt","Vit"]],"10190":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att",2,1],[0,"WaitLogicCMD","vit"],[0,"CreateEffectOnMap",9010,"Att",0,0,"attackPoint","gongjian",1],[0,"CurveMove","gongjian","Vit",0,0,0,50,21],[0,"WaitMoveOver","gongjian"],[0,"DestroyEffect","gongjian"],[0,"VitHurt","Vit"]],"10200":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[700,"VitHurt","Vit"]],"20060":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[400,"VitHurt","Vit"]],"10230":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att",2,1],[0,"WaitLogicCMD","vit"],[0,"CreateEffectOnMap",9010,"Att",0,0,"attackPoint","gongjian",1],[0,"CurveMove","gongjian","Vit",0,0,0,50,11],[0,"WaitMoveOver","gongjian"],[0,"DestroyEffect","gongjian"],[0,"VitHurt","Vit"]],"10240":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att",2,1],[0,"WaitLogicCMD","vit"],[0,"CreateEffectOnMap",0,"Att",0,0,"","",1],[0,"VitHurt","Vit"]],"10250":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att",2,1],[0,"WaitLogicCMD","vit"],[0,"CreateEffectOnMap",10251,"Att",0,0,"attackPoint","gongjian",1],[0,"CurveMove","gongjian","Vit",0,0,0,50,11],[0,"WaitMoveOver","gongjian"],[0,"DestroyEffect","gongjian"],[0,"CreateEffectOnMap",10252,"OneVit",0,0,"vitPoint","shouji",1],[500,"VitHurt","Vit"]],"10260":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att",2,1],[0,"WaitLogicCMD","vit"],[0,"CreateEffectOnMap",10251,"Att",0,0,"attackPoint","gongjian",1],[0,"CurveMove","gongjian","Vit",0,0,0,50,11],[0,"WaitMoveOver","gongjian"],[0,"DestroyEffect","gongjian"],[0,"CreateEffectOnMap",10252,"OneVit",0,0,"vitPoint","shouji",1],[0,"VitHurt","Vit"],[500,"End"]],"10270":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att",2,1],[0,"WaitLogicCMD","vit"],[0,"CreateEffectOnMap",9010,"Att",0,0,"attackPoint","gongjian",1],[0,"CurveMove","gongjian","Vit",0,0,0,50,11],[0,"WaitMoveOver","gongjian"],[0,"DestroyEffect","gongjian"],[0,"VitHurt","Vit"]],"10280":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[1000,"VitHurt","Vit"]],"10290":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[600,"VitHurt","Vit"]],"10300":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[500,"VitHurt","Vit"]],"10310":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att","2"],[600,"VitHurt","Vit"]],"10021":[[100,"SetAnimState","Att",3],[900,"VitHurt","Vit"]],"10022":[],"10990":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att",2,1],[0,"VitHurt","Vit"]],"1099001":[[0,"CreateEffectOnMap",9010,"StartPos",0,0,"","gongjian",1],[0,"StraightMove","gongjian","EndPos",300,0,0,0,21],[0,"VitHurt","Vit"],[0,"WhileBegin",1,1],[0,"DestroyEffect","gongjian"],[0,"WhileEnd"],[1000,"DestroyEffect","gongjian"]],"10041":[[100,"SetAnimState","Att",3]],"10042":[],"10051":[[100,"SetAnimState","Att",3]],"10052":[],"10061":[[100,"SetAnimState","Att",3],[1000,"VitHurt","Vit"],[500,"VitHurt","Vit"],[1000,"VitHurt","Vit"],[1000,"VitHurt","Vit"],[1000,"VitHurt","Vit"],[1000,"VitHurt","Vit"]],"10062":[],"10066":[[0,"FaceTo","Att","OneVit"],[0,"SetAnimState","Att",2],[0,"WaitLogicCMD","vit"],[0,"CreateEffectOnMap",1001,"Att",0,0,"","gongjian",1],[0,"CurveMove","gongjian","Vit",300,0,0,50,12],[0,"WaitMoveOver","gongjian"],[0,"DestroyEffect","gongjian"],[0,"VitHurt","Vit"]],"99010":[[0,"FaceTo","Att","OneVit"],[200,"SetAnimState","Att",2],[0,"WaitLogicCMD","vit"],[0,"CreateEffectOnMap",99011,"Att",0,0,"attackPoint","gongjian",1],[0,"CurveMove","gongjian","Vit",0,0,0,50,11],[0,"WaitMoveOver","gongjian"],[0,"DestroyEffect","gongjian"],[0,"CreateEffectOnMap",99012,"OneVit",0,0,"vitPoint","shouji",1],[0,"VitHurt","Vit"],[500,"End"]],"30010":[[0,"CreateEffectOnMap",30010,"StartPos",0,0,"","key1",1],[6000,"End"]],"30011":[[6000,"End"]],"30020":[[0,"CreateEffectOnMap",9010,"StartPos",0,0,"","key1",1],[0,"CurveMove","key1","EndPos",300,0,0,50,21],[0,"WaitMoveOver","key1"],[1000,"End"]],"10220":[[0,"FaceTo","Att","Vit"],[0,"SetAnimState","Att",2],[0,"WaitLogicCMD","vit"],[0,"CreateEffectOnMap",9010,"Att",0,0,"","gongjian",1],[0,"StraightMove","gongjian","Att",0.0,0,0,0,11],[0,"WaitMoveOver","gongjian"],[0,"DestroyEffect","gongjian"],[0,"VitHurt","Vit"]],"99020":[[0,"FaceTo","Att","OneVit"],[200,"SetAnimState","Att",2],[0,"WaitLogicCMD","vit"],[0,"CreateEffectOnMap",99021,"Att",0,0,"attackPoint","gongjian",1],[0,"CurveMove","gongjian","Vit",0,0,0,50,11],[0,"WaitMoveOver","gongjian"],[0,"DestroyEffect","gongjian"],[0,"CreateEffectOnMap",99022,"OneVit",0,0,"vitPoint","shouji",1],[0,"VitHurt","Vit"],[500,"End"]],"10202":[[0,"ShakeScreen",100,8,8,0,50,1],[3000,"End"]]}{"10":[[6,2],[6,3],[6,4],[7,2],[7,3],[7,4],[8,2],[8,3],[8,4]],"11":[[2,6],[2,7],[2,8],[2,9],[3,6],[3,7],[3,8],[3,9],[4,6],[4,7],[4,8],[4,9],[5,6],[5,7],[5,8],[5,9]],"12":[[6,11],[6,12],[6,13],[7,11],[7,12],[7,13],[8,11],[8,12],[8,13]],"20":[[27,2],[27,3],[27,4],[28,2],[28,3],[28,4],[29,2],[29,3],[29,4]],"21":[[30,6],[30,7],[30,8],[30,9],[31,6],[31,7],[31,8],[31,9],[32,6],[32,7],[32,8],[32,9],[33,6],[33,7],[33,8],[33,9]],"22":[[27,11],[27,12],[27,13],[28,11],[28,12],[28,13],[29,11],[29,12],[29,13]],"100":[[16,0],[16,1],[16,5],[16,6],[16,7],[16,8],[16,9],[16,10],[16,14],[16,15],[17,0],[17,1],[17,5],[17,6],[17,7],[17,8],[17,9],[17,10],[17,14],[17,15],[18,0],[18,1],[18,5],[18,6],[18,7],[18,8],[18,9],[18,10],[18,14],[18,15],[19,0],[19,1],[19,5],[19,6],[19,7],[19,8],[19,9],[19,10],[19,14],[19,15]]}﻿{"hero_10010":{"idleLabel":"idle","dieLabel":"dead","attackLabel":"fighting"},"hero_10020":{"idleLabel":"idle","dieLabel":"dead","attackLabel":"shootUp"},"hero_10040":{"idleLabel":"idle","dieLabel":"dead","attackLabel":"fighting"}}{"0":{"angle":[[0,0],[45,1],[90,2],[135,3],[180,4]],"attackpoint":[],"enemycolor":"red","name":"默认","offset":[0,0],"vitpoint":[]},"10050":{"angle":[[0,0],[45,1],[90,2],[135,3],[180,4]],"attackpoint":[[6,-67],[32,-56],[50,-28],[32,10],[-9,15]],"enemycolor":"red","name":10050.0,"offset":[0,0],"vitpoint":[]},"10140":{"angle":[[0,0],[45,1],[90,2],[135,3],[180,4]],"attackpoint":[[-3,-59],[-7,-59],[-4,-62],[-2,-61],[2,-61]],"enemycolor":"red","name":10140.0,"offset":[0,0],"vitpoint":[]},"10190":{"angle":[[0,0],[45,1],[90,2],[135,3],[180,4]],"attackpoint":[[-1,-46],[10,-43],[27,-22],[18,1],[0,4]],"enemycolor":"red","name":10190.0,"offset":[0,0],"vitpoint":[]},"10250":{"angle":[[0,0],[45,1],[90,2],[135,3],[180,4]],"attackpoint":[[14,-75],[26,-71],[26,-54],[13,-52],[-7,-53]],"enemycolor":"red","name":10250.0,"offset":[0,0],"vitpoint":[]},"10260":{"angle":[[0,0],[45,1],[90,2],[135,3],[180,4]],"attackpoint":[[5,-93],[55,-67],[81,-6],[48,32],[-10,46]],"enemycolor":"red","name":10260.0,"offset":[0,0],"vitpoint":[]},"20020":{"angle":[[0,0],[45,1],[90,2],[135,3],[180,4]],"attackpoint":[[1,-91],[29,-83],[55,-44],[39,-12],[-1,2]],"enemycolor":"red","name":20020.0,"offset":[0,0],"vitpoint":[]},"50040":{"angle":[[0,0],[45,0],[90,0],[135,0],[180,0]],"attackpoint":[],"enemycolor":"red","name":"气球","offset":[0,0],"vitpoint":[]},"99010":{"angle":[[0,0],[45,1],[90,2],[135,3],[180,4]],"attackpoint":[[-3,-155],[67,-138],[121,-44],[84,25],[3,59]],"enemycolor":"red","name":99010.0,"offset":[0,0],"vitpoint":[]},"99020":{"angle":[[0,0],[45,1],[90,2],[135,3],[180,4]],"attackpoint":[[-11,-95],[16,-93],[44,-64],[34,-38],[9,-22]],"enemycolor":"red","name":99020.0,"offset":[0,0],"vitpoint":[]},"2000010":{"angle":[[0,0],[35,1],[60,2],[80,3],[90,4],[125,5],[150,6],[165,7],[180,8]],"attackpoint":[],"enemycolor":"","name":"野蛮人","offset":[10,-30],"vitpoint":[]},"2000020":{"angle":[[0,0],[35,1],[60,2],[80,3],[90,4],[125,5],[150,6],[165,7],[180,8]],"attackpoint":[],"enemycolor":"","name":"弓箭手","offset":[10,-30],"vitpoint":[]}}{"1":{"exp":10},"2":{"exp":50},"3":{"exp":100},"4":{"exp":300},"5":{"exp":1000},"6":{"exp":2000},"7":{"exp":5000},"8":{"exp":10000}}{"hero_new":{"parent":["main_bottom_hero"]},"friend_invite":{"parent":["friend_bottom_friend","main_bottom_friend"]},"friend_left_item":{"parent":["main_bottom_friend"]},"main_bottom_ranking":{},"main_bottom_kazu":{},"main_bottom_jundui":{"parent":[]},"jundui_jundui":{"parent":["main_bottom_jundui"]},"jundui_lingzhu":{"parent":["main_bottom_jundui"]},"jundui_hero_new":{"parent":["jundui_jundui"]},"lingzhu_hero_new":{"parent":["jundui_lingzhu"]},"kapai_upgrade":{"parent":["jundui_jundui"]},"main_bottom_family":{},"main_bottom_friend":{},"main_bottom_lingshi":{},"main_bottom_pack":{},"main_bottom_shop":{},"main_top_mail":{},"mail_info":{"parent":["main_top_mail"]}}{"10010":{"0":{"chance":100,"count":100,"itemid":2},"1":{"chance":100,"count":200,"itemid":1}},"12010":{"0":{"chance":100,"count":1,"itemid":10001}},"12011":{"0":{"chance":100,"count":1,"itemid":10002}},"12012":{"0":{"chance":100,"count":1,"itemid":10003}},"12013":{"0":{"chance":100,"count":1,"itemid":10004}},"12014":{"0":{"chance":100,"count":1,"itemid":10005}}}{"10001":{"hero":[[10010,1],[10030,1],[10040,1],[10050,1],[10170,1],[10080,1],[10100,1],[10120,1],[99010,1]],"name":"茅景福"},"10002":{"hero":[[10130,1],[10140,1],[10150,1],[10170,1],[10190,1],[10200,1],[10210,1],[10220,1],[99020,1]],"name":"春雪"},"10003":{"hero":[[10010,1],[10030,1],[10040,1],[10050,1],[10170,1],[10080,1],[10100,1],[10120,1],[99010,1]],"name":"禹天曼"},"10004":{"hero":[[10130,1],[10140,1],[10150,1],[10170,1],[10190,1],[10200,1],[10210,1],[10220,1],[99020,1]],"name":"可向松"},"10005":{"hero":[[10010,1],[10030,1],[10040,1],[10050,1],[10170,1],[10080,1],[10100,1],[10120,1],[99010,1]],"name":"星"},"10006":{"hero":[[10130,1],[10140,1],[10150,1],[10170,1],[10190,1],[10200,1],[10210,1],[10220,1],[99020,1]],"name":"汉鸿晖"},"10007":{"hero":[[10010,1],[10030,1],[10040,1],[10050,1],[10170,1],[10080,1],[10100,1],[10120,1],[99010,1]],"name":"泥韵磬"},"10008":{"hero":[[10130,1],[10140,1],[10150,1],[10170,1],[10190,1],[10200,1],[10210,1],[10220,1],[99020,1]],"name":"满啦"},"10009":{"hero":[[10010,1],[10030,1],[10040,1],[10050,1],[10170,1],[10080,1],[10100,1],[10120,1],[99010,1]],"name":"行冷菱"},"10010":{"hero":[[10130,1],[10140,1],[10150,1],[10170,1],[10190,1],[10200,1],[10210,1],[10220,1],[99020,1]],"name":"涵"}}﻿[{"filename":"run_ts","name":"默认"},{"filename":"deploy_ts","name":"英雄部署"}]{"list":[{"ip":"192.168.19.28","port":"8000","name":"孙凯测试服"},{"ip":"192.168.19.27","port":"8000","name":"内网测试服"},{"ip":"127.0.0.1","port":"8000","name":"本地测试服"}]}{"20110":{"begin":"","costtype":3,"count":1,"desc":"8阶王者宝箱","end":"","item":20110,"limitcount":0,"limitgrade":0,"limittype":5,"name":"8阶王者宝箱","price":100,"saledesc":90,"saleprice":90,"shoptype":11,"showicon":"","type":3},"20111":{"begin":"","costtype":2,"count":1,"desc":"8阶幸运宝箱","end":"","item":20111,"limitcount":0,"limitgrade":0,"limittype":5,"name":"8阶幸运宝箱","price":100,"saledesc":90,"saleprice":90,"shoptype":11,"showicon":"","type":3},"20210":{"begin":"","costtype":3,"count":100,"desc":"雅典娜碎片","end":"","item":10010,"limitcount":1,"limitgrade":1,"limittype":5,"name":"胖子","price":0,"saledesc":0,"saleprice":0,"shoptype":12,"showicon":"","type":2},"20211":{"begin":"","costtype":3,"count":100,"desc":"宙斯碎片","end":"","item":10120,"limitcount":1,"limitgrade":2,"limittype":5,"name":"妖精","price":200,"saledesc":56,"saleprice":100,"shoptype":12,"showicon":"","type":2},"20212":{"begin":"","costtype":3,"count":100,"desc":"描述1","end":"","item":10030,"limitcount":1,"limitgrade":3,"limittype":5,"name":"陷阵营","price":200,"saledesc":11,"saleprice":150,"shoptype":12,"showicon":"","type":2},"20213":{"begin":"","costtype":3,"count":100,"desc":"描述2","end":"","item":10040,"limitcount":1,"limitgrade":4,"limittype":5,"name":"枪手","price":200,"saledesc":23,"saleprice":150,"shoptype":12,"showicon":"","type":2},"20214":{"begin":"","costtype":3,"count":100,"desc":"描述3","end":"","item":10050,"limitcount":1,"limitgrade":5,"limittype":5,"name":"弩兵","price":200,"saledesc":66,"saleprice":150,"shoptype":12,"showicon":"","type":2},"20215":{"begin":"","costtype":3,"count":100,"desc":"描述4","end":"","item":10100,"limitcount":1,"limitgrade":6,"limittype":5,"name":"士兵","price":200,"saledesc":34,"saleprice":150,"shoptype":12,"showicon":"","type":2},"20216":{"begin":"","costtype":3,"count":100,"desc":"描述5","end":"","item":10080,"limitcount":1,"limitgrade":7,"limittype":5,"name":"勇士","price":200,"saledesc":99,"saleprice":100,"shoptype":12,"showicon":"","type":2},"20217":{"begin":"","costtype":3,"count":100,"desc":"描述6","end":"","item":10130,"limitcount":1,"limitgrade":8,"limittype":5,"name":"武神","price":200,"saledesc":98,"saleprice":100,"shoptype":12,"showicon":"","type":2},"20218":{"begin":"","costtype":3,"count":100,"desc":"描述7","end":"","item":10140,"limitcount":1,"limitgrade":9,"limittype":5,"name":"投石车","price":200,"saledesc":90,"saleprice":100,"shoptype":12,"showicon":"","type":2},"20219":{"begin":"","costtype":3,"count":100,"desc":"描述8","end":"","item":10150,"limitcount":1,"limitgrade":1,"limittype":5,"name":"蛮族战士","price":200,"saledesc":80,"saleprice":100,"shoptype":12,"showicon":"","type":2},"20220":{"begin":"","costtype":3,"count":100,"desc":"描述9","end":"","item":10170,"limitcount":1,"limitgrade":2,"limittype":5,"name":"战士小队","price":200,"saledesc":70,"saleprice":100,"shoptype":12,"showicon":"","type":2},"20221":{"begin":"","costtype":3,"count":100,"desc":"描述10","end":"","item":10190,"limitcount":1,"limitgrade":3,"limittype":5,"name":"弩车","price":200,"saledesc":60,"saleprice":100,"shoptype":12,"showicon":"","type":2},"20222":{"begin":"","costtype":3,"count":100,"desc":"描述11","end":"","item":10200,"limitcount":1,"limitgrade":4,"limittype":5,"name":"雷神","price":200,"saledesc":50,"saleprice":100,"shoptype":12,"showicon":"","type":2},"20223":{"begin":"","costtype":3,"count":100,"desc":"描述12","end":"","item":10210,"limitcount":1,"limitgrade":5,"limittype":5,"name":"刺客小队","price":200,"saledesc":40,"saleprice":100,"shoptype":12,"showicon":"","type":2},"20224":{"begin":"","costtype":3,"count":100,"desc":"描述13","end":"","item":10220,"limitcount":1,"limitgrade":6,"limittype":5,"name":"法师","price":200,"saledesc":30,"saleprice":100,"shoptype":12,"showicon":"","type":2},"20225":{"begin":"","costtype":3,"count":100,"desc":"描述14","end":"","item":10230,"limitcount":1,"limitgrade":7,"limittype":5,"name":"巫术师","price":200,"saledesc":20,"saleprice":100,"shoptype":12,"showicon":"","type":2},"20226":{"begin":"","costtype":3,"count":100,"desc":"描述15","end":"","item":10250,"limitcount":1,"limitgrade":8,"limittype":5,"name":"药剂师","price":200,"saledesc":10,"saleprice":100,"shoptype":12,"showicon":"","type":2},"20227":{"begin":"","costtype":3,"count":100,"desc":"描述16","end":"","item":10260,"limitcount":1,"limitgrade":9,"limittype":5,"name":"咒术师","price":200,"saledesc":94,"saleprice":100,"shoptype":12,"showicon":"","type":2},"20228":{"begin":"","costtype":3,"count":100,"desc":"描述17","end":"","item":10280,"limitcount":1,"limitgrade":1,"limittype":5,"name":"泰坦","price":200,"saledesc":74,"saleprice":100,"shoptype":12,"showicon":"","type":2},"20229":{"begin":"","costtype":3,"count":100,"desc":"描述18","end":"","item":10290,"limitcount":1,"limitgrade":2,"limittype":5,"name":"国王","price":200,"saledesc":42,"saleprice":100,"shoptype":12,"showicon":"","type":2},"20230":{"begin":"","costtype":3,"count":100,"desc":"描述19","end":"","item":10300,"limitcount":1,"limitgrade":3,"limittype":5,"name":"巨狼","price":200,"saledesc":0,"saleprice":100,"shoptype":12,"showicon":"","type":2},"20231":{"begin":"","costtype":3,"count":100,"desc":"描述20","end":"","item":10310,"limitcount":1,"limitgrade":4,"limittype":5,"name":"和尚","price":200,"saledesc":0,"saleprice":100,"shoptype":12,"showicon":"","type":2},"21010":{"begin":"","costtype":3,"count":1,"desc":"雪人封印宝箱","end":"","item":21010,"limitcount":0,"limitgrade":0,"limittype":5,"name":"雪人封印宝箱","price":100,"saledesc":0,"saleprice":100,"shoptype":13,"showicon":"","type":3},"21011":{"begin":"","costtype":3,"count":1,"desc":"圣诞老人封印宝箱","end":"","item":21011,"limitcount":0,"limitgrade":0,"limittype":5,"name":"圣诞老人封印宝箱","price":100,"saledesc":0,"saleprice":100,"shoptype":13,"showicon":"","type":3},"21210":{"begin":"","costtype":3,"count":1,"desc":"愤怒表情宝箱","end":"","item":21210,"limitcount":0,"limitgrade":0,"limittype":5,"name":"愤怒表情宝箱","price":100,"saledesc":0,"saleprice":100,"shoptype":13,"showicon":"","type":3},"21211":{"begin":"","costtype":3,"count":1,"desc":"委屈表情宝箱","end":"","item":21211,"limitcount":0,"limitgrade":0,"limittype":5,"name":"委屈表情宝箱","price":100,"saledesc":0,"saleprice":100,"shoptype":13,"showicon":"","type":3},"21610":{"begin":"","costtype":3,"count":1,"desc":"永恒之恋头像宝箱","end":"","item":21610,"limitcount":0,"limitgrade":0,"limittype":5,"name":"永恒之恋头像宝箱","price":100,"saledesc":0,"saleprice":100,"shoptype":13,"showicon":"","type":3},"21611":{"begin":"","costtype":3,"count":1,"desc":"星恒传说头像宝箱","end":"","item":21611,"limitcount":0,"limitgrade":0,"limittype":5,"name":"星恒传说头像宝箱","price":100,"saledesc":0,"saleprice":100,"shoptype":13,"showicon":"","type":3},"21710":{"begin":"","costtype":3,"count":1,"desc":"永恒之恋聊天框宝箱","end":"","item":21710,"limitcount":0,"limitgrade":0,"limittype":5,"name":"永恒之恋聊天框宝箱","price":100,"saledesc":0,"saleprice":100,"shoptype":13,"showicon":"","type":3},"21711":{"begin":"","costtype":3,"count":1,"desc":"星恒传说聊天框宝箱","end":"","item":21711,"limitcount":0,"limitgrade":0,"limittype":5,"name":"星恒传说聊天框宝箱","price":100,"saledesc":0,"saleprice":100,"shoptype":13,"showicon":"","type":3},"23010":{"begin":"","costtype":0,"count":80,"desc":"80钻石","end":"","item":3,"limitcount":100,"limitgrade":0,"limittype":1,"name":"80钻石","price":0,"saledesc":0,"saleprice":800,"shoptype":15,"showicon":"icon_zs_01","type":1},"23011":{"begin":"","costtype":0,"count":500,"desc":"500钻石","end":"","item":3,"limitcount":50,"limitgrade":0,"limittype":1,"name":"500钻石","price":0,"saledesc":0,"saleprice":600,"shoptype":15,"showicon":"icon_zs_02","type":1},"23012":{"begin":"","costtype":0,"count":1200,"desc":"1200钻石","end":"","item":3,"limitcount":10,"limitgrade":0,"limittype":1,"name":"1200钻石","price":0,"saledesc":0,"saleprice":400,"shoptype":15,"showicon":"icon_zs_03","type":1},"23013":{"begin":"","costtype":0,"count":2500,"desc":"2500钻石","end":"","item":3,"limitcount":100,"limitgrade":0,"limittype":1,"name":"2500钻石","price":0,"saledesc":0,"saleprice":250,"shoptype":15,"showicon":"icon_zs_04","type":1},"23014":{"begin":"","costtype":0,"count":6500,"desc":"6500钻石","end":"","item":3,"limitcount":100,"limitgrade":0,"limittype":1,"name":"6500钻石","price":0,"saledesc":0,"saleprice":200,"shoptype":15,"showicon":"icon_zs_05","type":1},"23015":{"begin":"","costtype":0,"count":14000,"desc":"14000钻石","end":"","item":3,"limitcount":100,"limitgrade":0,"limittype":1,"name":"14000钻石","price":0,"saledesc":0,"saleprice":100,"shoptype":15,"showicon":"icon_zs_06","type":1},"23110":{"begin":"","costtype":3,"count":1000,"desc":"1000金币","end":"","item":2,"limitcount":100,"limitgrade":0,"limittype":1,"name":"1000金币","price":0,"saledesc":0,"saleprice":1000,"shoptype":16,"showicon":"icon_jb_01","type":1},"23111":{"begin":"","costtype":3,"count":5000,"desc":"5000金币","end":"","item":2,"limitcount":20,"limitgrade":0,"limittype":1,"name":"5000金币","price":0,"saledesc":0,"saleprice":1500,"shoptype":16,"showicon":"icon_jb_02","type":1},"23112":{"begin":"","costtype":3,"count":10000,"desc":"10000金币","end":"","item":2,"limitcount":50,"limitgrade":0,"limittype":1,"name":"10000金币","price":0,"saledesc":0,"saleprice":200,"shoptype":16,"showicon":"icon_jb_03","type":1},"23113":{"begin":"","costtype":3,"count":20000,"desc":"20000金币","end":"","item":2,"limitcount":30,"limitgrade":0,"limittype":1,"name":"20000金币","price":0,"saledesc":0,"saleprice":500,"shoptype":16,"showicon":"icon_jb_04","type":1},"23114":{"begin":"","costtype":3,"count":50000,"desc":"50000金币","end":"","item":2,"limitcount":80,"limitgrade":0,"limittype":1,"name":"50000金币","price":0,"saledesc":0,"saleprice":200,"shoptype":16,"showicon":"icon_jb_05","type":1},"23115":{"begin":"","costtype":3,"count":100000,"desc":"100000金币","end":"","item":2,"limitcount":70,"limitgrade":0,"limittype":1,"name":"100000金币","price":0,"saledesc":0,"saleprice":100,"shoptype":16,"showicon":"icon_jb_06","type":1},"24010":{"begin":"","costtype":8,"count":1,"desc":"500金币","end":"","item":2,"limitcount":2,"limitgrade":0,"limittype":1,"name":"500金币","price":100,"saledesc":0,"saleprice":100,"shoptype":31,"showicon":"","type":1},"24011":{"begin":"","costtype":8,"count":1,"desc":"史诗英雄礼包","end":"","item":24011,"limitcount":10,"limitgrade":0,"limittype":2,"name":"史诗英雄礼包","price":100,"saledesc":0,"saleprice":100,"shoptype":31,"showicon":"","type":3},"24012":{"begin":"2019c01c01","costtype":8,"count":1,"desc":"传奇英雄卡包","end":"2019c12c01","item":24012,"limitcount":1000,"limitgrade":0,"limittype":3,"name":"传奇英雄卡包","price":100,"saledesc":0,"saleprice":100,"shoptype":31,"showicon":"","type":3},"24013":{"begin":"2019c01c02","costtype":8,"count":1,"desc":"传奇英雄卡包","end":"2019c12c02","item":24013,"limitcount":3,"limitgrade":0,"limittype":4,"name":"传奇英雄卡包","price":100,"saledesc":0,"saleprice":100,"shoptype":31,"showicon":"","type":3}}{"10010":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1500,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[2,3],"landtype":[1],"logicflowid":10010,"magicid":10010,"name1":"5费巨人","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"猪八戒"},"10030":{"0":{"addheroid":0,"atkdis":65,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1400,"cdsource":10030,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1],"logicflowid":10030,"magicid":10030,"name1":"5费皇子","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"雅典娜"},"10032":{"0":{"addheroid":0,"atkdis":65,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1400,"cdsource":10030,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1],"logicflowid":10032,"magicid":10032,"name1":"5费皇子","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"雅典娜"},"10050":{"0":{"addheroid":0,"atkdis":180,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1100,"cdsource":0,"enemytype":0,"flyspeed":900,"herotype":[1,2,3],"landtype":[1,2],"logicflowid":10050,"magicid":10050,"name1":"4费火枪手","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":195},"name":"后羿"},"10070":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1200,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1],"logicflowid":10070,"magicid":10070,"name1":"3费骑士","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"亚瑟王"},"10080":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1600,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[2,3],"landtype":[1],"logicflowid":10080,"magicid":10080,"name1":"4费野猪骑士","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"孙悟空"},"10090":{"0":{"addheroid":0,"atkdis":120,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1500,"cdsource":0,"enemytype":0,"flyspeed":600,"herotype":[1,2,3],"landtype":[1,2],"logicflowid":10090,"magicid":10090,"name1":"4费龙宝","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":165},"name":"朱雀"},"10110":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":0,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[2,3],"landtype":[1],"logicflowid":10110,"magicid":10110,"name1":"4费野蛮人攻城锤","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"特洛伊木马"},"10112":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":0,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[2,3],"landtype":[1],"logicflowid":10112,"magicid":10112,"name1":"4费野蛮人攻城锤","targetcount":1,"targetsorttype":1,"triggertype":[["1.0"]],"warndis":120},"name":"特洛伊木马召唤"},"10120":{"0":{"addheroid":0,"atkdis":150,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1700,"cdsource":0,"enemytype":0,"flyspeed":600,"herotype":[1,2,3],"landtype":[1,2],"logicflowid":10120,"magicid":10120,"name1":"5费女巫","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":165},"name":"白骨精"},"10122":{"0":{"addheroid":0,"atkdis":150,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":0,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[5],"landtype":[1,2],"logicflowid":10122,"magicid":10122,"name1":"5费女巫","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":165},"name":"白骨精召唤"},"10130":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1300,"cdsource":10130,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1],"logicflowid":10130,"magicid":10130,"name1":"4费黑皇子","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"女武神"},"10132":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1300,"cdsource":10130,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1],"logicflowid":10132,"magicid":10132,"name1":"4费黑皇子","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"女武神"},"10140":{"0":{"addheroid":0,"atkdis":270,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":5000,"cdsource":0,"enemytype":0,"flyspeed":200,"herotype":[2,3],"landtype":[1],"logicflowid":10140,"magicid":10140,"name1":"4费迫击炮","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":285},"name":"投石车"},"10150":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":800,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1],"logicflowid":10150,"magicid":10150,"name1":"4费狂暴樵夫","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"维京海盗"},"10160":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1200,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1],"logicflowid":10160,"magicid":10160,"name1":"3费矿工","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"哪吒"},"10180":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":0,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[2,3],"landtype":[1],"logicflowid":10180,"magicid":10180,"name1":"6费骷髅巨人","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"熔岩巨人"},"10182":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":0,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1],"logicflowid":10182,"magicid":10182,"name1":"6费骷髅巨人亡语","targetcount":99,"targetsorttype":1,"triggertype":[["1.0"]],"warndis":120},"name":"熔岩巨人"},"10190":{"0":{"addheroid":0,"atkdis":270,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":4000,"cdsource":0,"enemytype":0,"flyspeed":1200,"herotype":[1,2,3],"landtype":[1],"logicflowid":10190,"magicid":10190,"name1":"6费电磁炮车","targetcount":99,"targetsorttype":3,"triggertype":[["0.0"]],"warndis":285},"name":"弩车"},"10200":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1700,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1],"logicflowid":10200,"magicid":10200,"name1":"7费超级骑士","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"雷神"},"10202":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1700,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1],"logicflowid":10202,"magicid":10202,"name1":"7费超级骑士","targetcount":99,"targetsorttype":1,"triggertype":[["4.0"]],"warndis":120},"name":"雷神"},"10220":{"0":{"addheroid":0,"atkdis":150,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1700,"cdsource":0,"enemytype":0,"flyspeed":900,"herotype":[2,3],"landtype":[1],"logicflowid":10220,"magicid":10220,"name1":"6费皇家巨人","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":165},"name":"巨猿"},"10230":{"0":{"addheroid":0,"atkdis":150,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1400,"cdsource":0,"enemytype":0,"flyspeed":600,"herotype":[1,2,3],"landtype":[1,2],"logicflowid":10230,"magicid":10230,"name1":"5费法师","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":165},"name":"女巫"},"10240":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":3000,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[2,3],"landtype":[1],"logicflowid":10240,"magicid":10240,"name1":"5费气球","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"蒸汽飞艇"},"10250":{"0":{"addheroid":0,"atkdis":150,"attackcurrent":1,"breaktype":[0],"buffid":10250,"cd":1700,"cdsource":0,"enemytype":0,"flyspeed":600,"herotype":[1,2,3],"landtype":[1,2],"logicflowid":10250,"magicid":10250,"name1":"3费冰法","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":165},"name":"冰雪公主"},"10260":{"0":{"addheroid":0,"atkdis":150,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1500,"cdsource":0,"enemytype":0,"flyspeed":900,"herotype":[1,2,3],"landtype":[1],"logicflowid":10260,"magicid":10260,"name1":"3费加农炮","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":165},"name":"斯巴达农夫"},"10270":{"0":{"addheroid":0,"atkdis":150,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":800,"cdsource":0,"enemytype":0,"flyspeed":1200,"herotype":[1,2,3],"landtype":[1,2],"logicflowid":10270,"magicid":10270,"name1":"4费特斯拉电磁塔","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":165},"name":"吵闹的猴子"},"10280":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":2500,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[2,3],"landtype":[1],"logicflowid":10280,"magicid":10280,"name1":"8费石头人","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"泰坦"},"10290":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1800,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1],"logicflowid":10290,"magicid":10290,"name1":"7费大皮卡","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"斯巴达国王"},"10300":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1500,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1],"logicflowid":10300,"magicid":10300,"name1":"4费武神","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"巨狼"},"10310":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":2000,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[2,3],"landtype":[1],"logicflowid":10310,"magicid":10310,"name1":"2费冰人","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"沙和尚"},"20010":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":0,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[2,3],"landtype":[1,2],"logicflowid":20010,"magicid":20010,"name1":"2费自爆炸弹","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"黑暗精灵"},"20020":{"0":{"addheroid":0,"atkdis":150,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1700,"cdsource":0,"enemytype":0,"flyspeed":900,"herotype":[1,2,3],"landtype":[1,2],"logicflowid":20020,"magicid":20020,"name1":"2费哥布林投矛手","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":165},"name":"弓箭手"},"20030":{"0":{"addheroid":0,"atkdis":90,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1000,"cdsource":0,"enemytype":0,"flyspeed":900,"herotype":[1,2,3],"landtype":[1,2],"logicflowid":20030,"magicid":20030,"name1":"3费小苍蝇","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":140},"name":"光明精灵"},"20040":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1000,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1],"logicflowid":20040,"magicid":20040,"name1":"1费小骷髅","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"猴子士兵"},"20050":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1400,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1],"logicflowid":20050,"magicid":20050,"name1":"5费野蛮人","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"希腊战士"},"20060":{"0":{"addheroid":0,"atkdis":35,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":1100,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1],"logicflowid":20060,"magicid":20060,"name1":"2费哥布林","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":120},"name":"刺客小队"},"30010":{"0":{"addheroid":0,"atkdis":0,"attackcurrent":0,"breaktype":[0],"buffid":30010,"cd":0,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1,2],"logicflowid":30010,"magicid":30010,"name1":"","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":0},"name":"烈焰冲击"},"30020":{"0":{"addheroid":0,"atkdis":0,"attackcurrent":0,"breaktype":[0],"buffid":30020,"cd":0,"cdsource":0,"enemytype":0,"flyspeed":900,"herotype":[1,2,3],"landtype":[1,2],"logicflowid":30020,"magicid":30020,"name1":"","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":0},"name":"箭雨"},"30030":{"0":{"addheroid":0,"atkdis":0,"attackcurrent":0,"breaktype":[0],"buffid":30030,"cd":0,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1],"logicflowid":30030,"magicid":30030,"name1":"","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":0},"name":"海浪"},"30040":{"0":{"addheroid":0,"atkdis":0,"attackcurrent":0,"breaktype":[0],"buffid":30040,"cd":0,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1,2],"logicflowid":30040,"magicid":30040,"name1":"","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":0},"name":"星陨术"},"30050":{"0":{"addheroid":0,"atkdis":0,"attackcurrent":0,"breaktype":[0],"buffid":30050,"cd":0,"cdsource":0,"enemytype":1,"flyspeed":0,"herotype":[1,2],"landtype":[1,2],"logicflowid":30050,"magicid":30050,"name1":"","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":0},"name":"鼓舞"},"30060":{"0":{"addheroid":0,"atkdis":0,"attackcurrent":0,"breaktype":[0],"buffid":30060,"cd":0,"cdsource":0,"enemytype":0,"flyspeed":1200,"herotype":[1,2,3],"landtype":[1,2],"logicflowid":30060,"magicid":30060,"name1":"","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":0},"name":"燃烧油"},"30070":{"0":{"addheroid":0,"atkdis":0,"attackcurrent":0,"breaktype":[0],"buffid":30070,"cd":0,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[1,2,3],"landtype":[1,2],"logicflowid":30070,"magicid":30070,"name1":"","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":0},"name":"冰晶术"},"30080":{"0":{"addheroid":0,"atkdis":0,"attackcurrent":0,"breaktype":[0],"buffid":30080,"cd":0,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[1,2],"landtype":[1,2],"logicflowid":30080,"magicid":30080,"name1":"","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":0},"name":"变鸡术"},"30090":{"0":{"addheroid":0,"atkdis":0,"attackcurrent":0,"breaktype":[0],"buffid":30090,"cd":0,"cdsource":0,"enemytype":1,"flyspeed":0,"herotype":[1,2],"landtype":[1,2],"logicflowid":30090,"magicid":30090,"name1":"","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":0},"name":"神行术"},"30100":{"0":{"addheroid":0,"atkdis":0,"attackcurrent":0,"breaktype":[0],"buffid":0,"cd":0,"cdsource":0,"enemytype":0,"flyspeed":0,"herotype":[],"landtype":[],"logicflowid":30100,"magicid":30100,"name1":"","targetcount":99,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":0},"name":"伏击"},"99010":{"0":{"addheroid":0,"atkdis":999,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":800,"cdsource":0,"enemytype":0,"flyspeed":900,"herotype":[1,2],"landtype":[1,2],"logicflowid":99010,"magicid":99010,"name1":"","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":999},"name":"神主普攻"},"99020":{"0":{"addheroid":0,"atkdis":999,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":800,"cdsource":0,"enemytype":0,"flyspeed":900,"herotype":[1,2],"landtype":[1,2],"logicflowid":99010,"magicid":99010,"name1":"","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":999},"name":"神主普攻"},"99030":{"0":{"addheroid":0,"atkdis":999,"attackcurrent":1,"breaktype":[0],"buffid":0,"cd":800,"cdsource":0,"enemytype":0,"flyspeed":900,"herotype":[1,2],"landtype":[1,2],"logicflowid":99010,"magicid":99010,"name1":"","targetcount":1,"targetsorttype":1,"triggertype":[["0.0"]],"warndis":999},"name":"神主普攻"}}{"101":[["0","ShowHPBar","Att"]],"102":[["0","SetAlpha","Att",0.5],["0","WaitServer"],["0","SetHeroInCache","Att","bushu"],["0","SetPos","Att","Att",0,-100,2],["0","SetAlpha","Att",1],["0","TweenMove","bushu","Att",0,100,200,1,2]],"10010":[["0","FaceTo","Att","OneVit"],["400","SetAnimState","Att",2],["600","VitHurt","Vit"]],"10011":[["100","SetAnimState","Att",2],["900","VitHurt","Vit"]],"10012":[],"10021":[["100","SetAnimState","Att",2],["900","VitHurt","Vit"]],"10022":[],"10031":[["100","SetAnimState","Att",2],["900","VitHurt","Vit"]],"10032":[],"10041":[["100","SetAnimState","Att",2]],"10042":[],"10051":[["100","SetAnimState","Att",2]],"10052":[],"10061":[["100","SetAnimState","Att",2],["1000","VitHurt","Vit"],["500","VitHurt","Vit"],["1000","VitHurt","Vit"],["1000","VitHurt","Vit"],["1000","VitHurt","Vit"],["1000","VitHurt","Vit"]],"10062":[],"10020":[["0","FaceTo","Att","OneVit"],["400","SetAnimState","Att",2],["500","CreateEffectOnMap",1001,"Att",0,0,"gongjian"],["0","CurveMove","gongjian","Vit",1000,0,0,0],["1100","DestroyEffect","gongjian"],["0","VitHurt","Vit"]],"19010":[["0","FaceTo","Att","OneVit"],["400","SetAnimState","Att",2],["500","CreateEffectOnMap",1001,"Att",0,0,"gongjian"],["0","CurveMove","gongjian","Vit",1000,0,0,0],["1100","DestroyEffect","gongjian"],["0","VitHurt","Vit"]],"19020":[["0","FaceTo","Att","OneVit"],["400","SetAnimState","Att",2],["500","CreateEffectOnMap",1001,"Att",0,0,"gongjian"],["0","CurveMove","gongjian","Vit",1000,0,0,0],["1100","DestroyEffect","gongjian"],["0","VitHurt","Vit"]]}{"30010":{"0":{"initlv":2,"lifetime":0,"preview":[3,30010],"range":[1,75],"showattr":[["14","7.5"],["16","35%"],[11,5]],"skill":[30010],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"1":{"initlv":2,"lifetime":0,"preview":[3,30010],"range":[1,75],"showattr":[["14","7.5"],["16","35%"],[11,5]],"skill":[30010],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"2":{"initlv":2,"lifetime":0,"preview":[3,30010],"range":[1,75],"showattr":[["14","7.5"],["16","35%"],[11,5]],"skill":[30010],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"3":{"initlv":2,"lifetime":0,"preview":[3,30010],"range":[1,75],"showattr":[["14","7.5"],["16","35%"],[11,5]],"skill":[30010],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"4":{"initlv":2,"lifetime":0,"preview":[3,30010],"range":[1,75],"showattr":[["14","7.5"],["16","35%"],[11,5]],"skill":[30010],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"5":{"initlv":2,"lifetime":0,"preview":[3,30010],"range":[1,75],"showattr":[["14","7.5"],["16","35%"],[11,5]],"skill":[30010],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"6":{"initlv":2,"lifetime":0,"preview":[3,30010],"range":[1,75],"showattr":[["14","7.5"],["16","35%"],[11,5]],"skill":[30010],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"7":{"initlv":2,"lifetime":0,"preview":[3,30010],"range":[1,75],"showattr":[["14","7.5"],["16","35%"],[11,5]],"skill":[30010],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"8":{"initlv":2,"lifetime":0,"preview":[3,30010],"range":[1,75],"showattr":[["14","7.5"],["16","35%"],[11,5]],"skill":[30010],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"camp":0,"classlv":1,"clipname":30010,"cost":4,"desc":"烈焰冲击","effectrely":[30010],"name":"烈焰冲击","puttype":4,"quality":1,"resrely":[]},"30020":{"0":{"initlv":1,"lifetime":0,"preview":[3,30010],"range":[1,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30020],"startpos":1,"upcost":[[10010,10],[2,50]],"upexp":1},"1":{"initlv":1,"lifetime":0,"preview":[3,30010],"range":[1,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30020],"startpos":1,"upcost":[[10010,10],[2,50]],"upexp":1},"2":{"initlv":1,"lifetime":0,"preview":[3,30010],"range":[1,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30020],"startpos":1,"upcost":[[10010,10],[2,50]],"upexp":1},"3":{"initlv":1,"lifetime":0,"preview":[3,30010],"range":[1,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30020],"startpos":1,"upcost":[[10010,10],[2,50]],"upexp":1},"4":{"initlv":1,"lifetime":0,"preview":[3,30010],"range":[1,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30020],"startpos":1,"upcost":[[10010,10],[2,50]],"upexp":1},"5":{"initlv":1,"lifetime":0,"preview":[3,30010],"range":[1,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30020],"startpos":1,"upcost":[[10010,10],[2,50]],"upexp":1},"6":{"initlv":1,"lifetime":0,"preview":[3,30010],"range":[1,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30020],"startpos":1,"upcost":[[10010,10],[2,50]],"upexp":1},"7":{"initlv":1,"lifetime":0,"preview":[3,30010],"range":[1,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30020],"startpos":1,"upcost":[[10010,10],[2,50]],"upexp":1},"8":{"initlv":1,"lifetime":0,"preview":[3,30010],"range":[1,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30020],"startpos":1,"upcost":[[10010,10],[2,50]],"upexp":1},"camp":0,"classlv":1,"clipname":30010,"cost":3,"desc":"箭雨","effectrely":[30010],"name":"箭雨","puttype":4,"quality":0,"resrely":[]},"30030":{"0":{"initlv":3,"lifetime":0,"preview":[3,30010],"range":[2,300,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30030],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"1":{"initlv":3,"lifetime":0,"preview":[3,30010],"range":[2,300,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30030],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"2":{"initlv":3,"lifetime":0,"preview":[3,30010],"range":[2,300,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30030],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"3":{"initlv":3,"lifetime":0,"preview":[3,30010],"range":[2,300,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30030],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"4":{"initlv":3,"lifetime":0,"preview":[3,30010],"range":[2,300,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30030],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"5":{"initlv":3,"lifetime":0,"preview":[3,30010],"range":[2,300,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30030],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"6":{"initlv":3,"lifetime":0,"preview":[3,30010],"range":[2,300,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30030],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"7":{"initlv":3,"lifetime":0,"preview":[3,30010],"range":[2,300,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30030],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"8":{"initlv":3,"lifetime":0,"preview":[3,30010],"range":[2,300,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30030],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"camp":0,"classlv":2,"clipname":30010,"cost":2,"desc":"海浪","effectrely":[30010],"name":"海浪","puttype":2,"quality":0,"resrely":[]},"30040":{"0":{"initlv":3,"lifetime":0,"preview":[3,30010],"range":[1,60],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30040],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"1":{"initlv":3,"lifetime":0,"preview":[3,30010],"range":[1,60],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30040],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"2":{"initlv":3,"lifetime":0,"preview":[3,30010],"range":[1,60],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30040],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"3":{"initlv":3,"lifetime":0,"preview":[3,30010],"range":[1,60],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30040],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"4":{"initlv":3,"lifetime":0,"preview":[3,30010],"range":[1,60],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30040],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"5":{"initlv":3,"lifetime":0,"preview":[3,30010],"range":[1,60],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30040],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"6":{"initlv":3,"lifetime":0,"preview":[3,30010],"range":[1,60],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30040],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"7":{"initlv":3,"lifetime":0,"preview":[3,30010],"range":[1,60],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30040],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"8":{"initlv":3,"lifetime":0,"preview":[3,30010],"range":[1,60],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30040],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"camp":0,"classlv":2,"clipname":30010,"cost":6,"desc":"星陨术","effectrely":[30010],"name":"星陨术","puttype":4,"quality":1,"resrely":[]},"30050":{"0":{"initlv":5,"lifetime":7,"preview":[3,30010],"range":[1,150],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30050],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"1":{"initlv":5,"lifetime":7,"preview":[3,30010],"range":[1,150],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30050],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"2":{"initlv":5,"lifetime":7,"preview":[3,30010],"range":[1,150],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30050],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"3":{"initlv":5,"lifetime":7,"preview":[3,30010],"range":[1,150],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30050],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"4":{"initlv":5,"lifetime":7,"preview":[3,30010],"range":[1,150],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30050],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"5":{"initlv":5,"lifetime":7,"preview":[3,30010],"range":[1,150],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30050],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"6":{"initlv":5,"lifetime":7,"preview":[3,30010],"range":[1,150],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30050],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"7":{"initlv":5,"lifetime":7,"preview":[3,30010],"range":[1,150],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30050],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"8":{"initlv":5,"lifetime":7,"preview":[3,30010],"range":[1,150],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30050],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"camp":0,"classlv":3,"clipname":30010,"cost":2,"desc":"鼓舞","effectrely":[30010],"name":"鼓舞","puttype":4,"quality":2,"resrely":[]},"30060":{"0":{"initlv":5,"lifetime":8,"preview":[3,30010],"range":[1,105],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30060],"startpos":1,"upcost":[[10010,10],[2,50]],"upexp":1},"1":{"initlv":5,"lifetime":8,"preview":[3,30010],"range":[1,105],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30060],"startpos":1,"upcost":[[10010,10],[2,50]],"upexp":1},"2":{"initlv":5,"lifetime":8,"preview":[3,30010],"range":[1,105],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30060],"startpos":1,"upcost":[[10010,10],[2,50]],"upexp":1},"3":{"initlv":5,"lifetime":8,"preview":[3,30010],"range":[1,105],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30060],"startpos":1,"upcost":[[10010,10],[2,50]],"upexp":1},"4":{"initlv":5,"lifetime":8,"preview":[3,30010],"range":[1,105],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30060],"startpos":1,"upcost":[[10010,10],[2,50]],"upexp":1},"5":{"initlv":5,"lifetime":8,"preview":[3,30010],"range":[1,105],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30060],"startpos":1,"upcost":[[10010,10],[2,50]],"upexp":1},"6":{"initlv":5,"lifetime":8,"preview":[3,30010],"range":[1,105],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30060],"startpos":1,"upcost":[[10010,10],[2,50]],"upexp":1},"7":{"initlv":5,"lifetime":8,"preview":[3,30010],"range":[1,105],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30060],"startpos":1,"upcost":[[10010,10],[2,50]],"upexp":1},"8":{"initlv":5,"lifetime":8,"preview":[3,30010],"range":[1,105],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30060],"startpos":1,"upcost":[[10010,10],[2,50]],"upexp":1},"camp":0,"classlv":3,"clipname":30010,"cost":4,"desc":"燃烧油","effectrely":[30010],"name":"燃烧油","puttype":4,"quality":1,"resrely":[]},"30070":{"0":{"initlv":7,"lifetime":0,"preview":[3,30010],"range":[1,75],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30070],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"1":{"initlv":7,"lifetime":0,"preview":[3,30010],"range":[1,75],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30070],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"2":{"initlv":7,"lifetime":0,"preview":[3,30010],"range":[1,75],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30070],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"3":{"initlv":7,"lifetime":0,"preview":[3,30010],"range":[1,75],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30070],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"4":{"initlv":7,"lifetime":0,"preview":[3,30010],"range":[1,75],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30070],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"5":{"initlv":7,"lifetime":0,"preview":[3,30010],"range":[1,75],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30070],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"6":{"initlv":7,"lifetime":0,"preview":[3,30010],"range":[1,75],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30070],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"7":{"initlv":7,"lifetime":0,"preview":[3,30010],"range":[1,75],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30070],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"8":{"initlv":7,"lifetime":0,"preview":[3,30010],"range":[1,75],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30070],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"camp":0,"classlv":4,"clipname":30010,"cost":2,"desc":"冰晶","effectrely":[30010],"name":"冰晶","puttype":4,"quality":0,"resrely":[]},"30080":{"0":{"initlv":7,"lifetime":4,"preview":[3,30010],"range":[1,90],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30080],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"1":{"initlv":7,"lifetime":4,"preview":[3,30010],"range":[1,90],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30080],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"2":{"initlv":7,"lifetime":4,"preview":[3,30010],"range":[1,90],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30080],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"3":{"initlv":7,"lifetime":4,"preview":[3,30010],"range":[1,90],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30080],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"4":{"initlv":7,"lifetime":4,"preview":[3,30010],"range":[1,90],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30080],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"5":{"initlv":7,"lifetime":4,"preview":[3,30010],"range":[1,90],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30080],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"6":{"initlv":7,"lifetime":4,"preview":[3,30010],"range":[1,90],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30080],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"7":{"initlv":7,"lifetime":4,"preview":[3,30010],"range":[1,90],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30080],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"8":{"initlv":7,"lifetime":4,"preview":[3,30010],"range":[1,90],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30080],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"camp":0,"classlv":4,"clipname":30010,"cost":4,"desc":"变鸡术","effectrely":[30010],"name":"变鸡术","puttype":4,"quality":3,"resrely":[]},"30090":{"0":{"initlv":9,"lifetime":7,"preview":[3,30010],"range":[1,150],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30090],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"1":{"initlv":9,"lifetime":7,"preview":[3,30010],"range":[1,150],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30090],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"2":{"initlv":9,"lifetime":7,"preview":[3,30010],"range":[1,150],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30090],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"3":{"initlv":9,"lifetime":7,"preview":[3,30010],"range":[1,150],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30090],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"4":{"initlv":9,"lifetime":7,"preview":[3,30010],"range":[1,150],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30090],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"5":{"initlv":9,"lifetime":7,"preview":[3,30010],"range":[1,150],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30090],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"6":{"initlv":9,"lifetime":7,"preview":[3,30010],"range":[1,150],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30090],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"7":{"initlv":9,"lifetime":7,"preview":[3,30010],"range":[1,150],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30090],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"8":{"initlv":9,"lifetime":7,"preview":[3,30010],"range":[1,150],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30090],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"camp":0,"classlv":5,"clipname":30010,"cost":2,"desc":"加速","effectrely":[30010],"name":"加速","puttype":4,"quality":2,"resrely":[]},"30100":{"0":{"initlv":11,"lifetime":10,"preview":[3,30010],"range":[1,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30100],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"1":{"initlv":11,"lifetime":10,"preview":[3,30010],"range":[1,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30100],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"2":{"initlv":11,"lifetime":10,"preview":[3,30010],"range":[1,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30100],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"3":{"initlv":11,"lifetime":10,"preview":[3,30010],"range":[1,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30100],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"4":{"initlv":11,"lifetime":10,"preview":[3,30010],"range":[1,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30100],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"5":{"initlv":11,"lifetime":10,"preview":[3,30010],"range":[1,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30100],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"6":{"initlv":11,"lifetime":10,"preview":[3,30010],"range":[1,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30100],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"7":{"initlv":11,"lifetime":10,"preview":[3,30010],"range":[1,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30100],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"8":{"initlv":11,"lifetime":10,"preview":[3,30010],"range":[1,120],"showattr":[[8,159],[10,56],["13","2.5"],["11","2.5"]],"skill":[30100],"startpos":0,"upcost":[[10010,10],[2,50]],"upexp":1},"camp":0,"classlv":6,"clipname":30010,"cost":6,"desc":"伏兵","effectrely":[30010],"name":"伏兵","puttype":4,"quality":3,"resrely":[20060]}}{"10010":{"condition":1,"count":1000,"desc":"累计获得1000金币","event":1,"level":3,"name":"收集金币","reward":10010},"10011":{"condition":2,"count":5,"desc":"累计参加1V1竞技获胜5场","event":2,"level":3,"name":"1V1竞技","reward":10010},"10012":{"condition":2,"count":15,"desc":"累计参加1V1竞技15场","event":2,"level":3,"name":"1V1竞技","reward":10010},"10013":{"condition":2,"count":5,"desc":"累计参加1V1竞技三星获胜5场","event":3,"level":3,"name":"1V1竞技","reward":10010},"10014":{"condition":3,"count":5,"desc":"累计参加2V2竞技获胜5场","event":4,"level":5,"name":"2V2竞技","reward":10010},"10015":{"condition":3,"count":5,"desc":"累计参加2V2竞技15场","event":4,"level":5,"name":"2V2竞技","reward":10010},"10016":{"condition":3,"count":5,"desc":"累计参加2V2竞技三星获胜5场","event":5,"level":5,"name":"2V2竞技","reward":10010},"10017":{"condition":4,"count":10,"desc":"累计获得10张稀有英雄卡牌","event":6,"level":3,"name":"收集卡牌","reward":10010},"10018":{"condition":4,"count":20,"desc":"累计获得20张稀有英雄卡牌","event":6,"level":3,"name":"收集卡牌","reward":10010},"10019":{"condition":5,"count":5,"desc":"累计获得5张传奇英雄卡牌","event":7,"level":3,"name":"收集卡牌","reward":10010},"10020":{"condition":5,"count":10,"desc":"累计获得10张传奇英雄卡牌","event":7,"level":3,"name":"收集卡牌","reward":10010},"11010":{"condition":1,"count":1000,"desc":"累计获得1000金币","event":1,"level":3,"name":"收集金币","reward":10010},"11011":{"condition":2,"count":5,"desc":"累计参加1V1竞技获胜5场","event":2,"level":3,"name":"1V1竞技","reward":10010},"11012":{"condition":2,"count":15,"desc":"累计参加1V1竞技15场","event":2,"level":3,"name":"1V1竞技","reward":10010},"11013":{"condition":2,"count":5,"desc":"累计参加1V1竞技三星获胜5场","event":3,"level":3,"name":"1V1竞技","reward":10010},"11014":{"condition":3,"count":5,"desc":"累计参加2V2竞技获胜5场","event":4,"level":5,"name":"2V2竞技","reward":10010},"11015":{"condition":3,"count":5,"desc":"累计参加2V2竞技15场","event":4,"level":5,"name":"2V2竞技","reward":10010},"11016":{"condition":3,"count":5,"desc":"累计参加2V2竞技三星获胜5场","event":5,"level":5,"name":"2V2竞技","reward":10010},"11017":{"condition":4,"count":10,"desc":"累计获得10张稀有英雄卡牌","event":6,"level":3,"name":"收集卡牌","reward":10010},"11018":{"condition":4,"count":20,"desc":"累计获得20张稀有英雄卡牌","event":6,"level":3,"name":"收集卡牌","reward":10010},"11019":{"condition":5,"count":5,"desc":"累计获得5张传奇英雄卡牌","event":7,"level":3,"name":"收集卡牌","reward":10010},"11020":{"condition":5,"count":10,"desc":"累计获得10张传奇英雄卡牌","event":7,"level":3,"name":"收集卡牌","reward":10010},"12010":{"condition":1,"count":1000,"desc":"累计获得1000金币","event":1,"level":3,"name":"收集金币","reward":12010},"12011":{"condition":2,"count":5,"desc":"累计参加1V1竞技获胜5场","event":2,"level":3,"name":"1V1竞技","reward":12011},"12012":{"condition":2,"count":15,"desc":"累计参加1V1竞技15场","event":2,"level":3,"name":"1V1竞技","reward":12012},"12013":{"condition":2,"count":5,"desc":"累计参加1V1竞技三星获胜5场","event":3,"level":3,"name":"1V1竞技","reward":12013},"12014":{"condition":3,"count":5,"desc":"累计参加2V2竞技获胜5场","event":4,"level":5,"name":"2V2竞技","reward":12014}}{"1008":{"name":"陆小凤","sex":"男nan","主键名":1008,"age":25},"1009":{"name":"叫我新哥大人","sex":"男nan","主键名":1009,"age":26},"1001":{"name":"叫我新哥大人","数组键名1":["1","2","3","3","5","6"],"sex":"男nan","主键名":1001,"age":18},"1002":{"name":"陆小凤","数组键名1":["1","2","3","3","5","6"],"sex":"男nan","主键名":1002,"age":19},"1003":{"name":"叫我新哥大人","数组键名1":["1","2","3","3","5","6"],"sex":"男nan","主键名":1003,"age":20},"1004":{"name":"陆小凤","数组键名1":["1","2","3","3","5","6"],"sex":"男nan","主键名":1004,"age":21},"1005":{"name":"叫我新哥大人","数组键名1":["1","2","3","3","5","6"],"sex":"男nan","主键名":1005,"age":22},"1006":{"name":"陆小凤","sex":"男nan","主键名":1006,"age":23},"1007":{"name":"叫我新哥大人","sex":"男nan","主键名":1007,"age":24}}{"1":{"banggong":100,"begin":"","end":"","index":10011,"limitcount":2,"limittype":1,"money":100},"2":{"banggong":1000,"begin":"","end":"","index":10012,"limitcount":10,"limittype":2,"money":1000},"3":{"banggong":100,"begin":"2019c01c01","end":"2019c12c01","index":10013,"limitcount":1000,"limittype":3,"money":100},"4":{"banggong":100,"begin":"2019c01c02","end":"2019c12c02","index":10014,"limitcount":3,"limittype":4,"money":100}}{"1":{"hero":[10010]},"2":{"hero":[10020]},"3":{"hero":[10030]},"4":{"hero":[10040]},"5":{"hero":[10050]},"6":{"hero":[10060]},"7":{"hero":[10070]},"8":{"hero":[10080]},"9":{"hero":[10090]}}{"1":{"costgold":50,"costka":5,"exp":5,"totalcost":1},"2":{"costgold":100,"costka":10,"exp":10,"totalcost":1},"3":{"costgold":150,"costka":15,"exp":20,"totalcost":1},"4":{"costgold":200,"costka":20,"exp":40,"totalcost":1},"5":{"costgold":250,"costka":25,"exp":80,"totalcost":1},"6":{"costgold":300,"costka":30,"exp":160,"totalcost":1},"7":{"costgold":350,"costka":35,"exp":320,"totalcost":1},"8":{"costgold":400,"costka":40,"exp":640,"totalcost":1},"9":{"costgold":0,"costka":0,"exp":0,"totalcost":0},"1001":{"costgold":50,"costka":5,"exp":5,"totalcost":1},"1002":{"costgold":100,"costka":10,"exp":10,"totalcost":1},"1003":{"costgold":150,"costka":15,"exp":20,"totalcost":1},"1004":{"costgold":200,"costka":20,"exp":40,"totalcost":1},"1005":{"costgold":250,"costka":25,"exp":80,"totalcost":1},"1006":{"costgold":300,"costka":30,"exp":160,"totalcost":1},"1007":{"costgold":350,"costka":35,"exp":320,"totalcost":1},"1008":{"costgold":400,"costka":40,"exp":640,"totalcost":1},"1009":{"costgold":0,"costka":0,"exp":0,"totalcost":0},"2001":{"costgold":50,"costka":5,"exp":5,"totalcost":1},"2002":{"costgold":100,"costka":10,"exp":10,"totalcost":1},"2003":{"costgold":150,"costka":15,"exp":20,"totalcost":1},"2004":{"costgold":200,"costka":20,"exp":40,"totalcost":1},"2005":{"costgold":250,"costka":25,"exp":80,"totalcost":1},"2006":{"costgold":300,"costka":30,"exp":160,"totalcost":1},"2007":{"costgold":350,"costka":35,"exp":320,"totalcost":1},"2008":{"costgold":400,"costka":40,"exp":640,"totalcost":1},"2009":{"costgold":0,"costka":0,"exp":0,"totalcost":0},"3001":{"costgold":50,"costka":5,"exp":5,"totalcost":1},"3002":{"costgold":100,"costka":10,"exp":10,"totalcost":1},"3003":{"costgold":150,"costka":15,"exp":20,"totalcost":1},"3004":{"costgold":200,"costka":20,"exp":40,"totalcost":1},"3005":{"costgold":250,"costka":25,"exp":80,"totalcost":1},"3006":{"costgold":300,"costka":30,"exp":160,"totalcost":1},"3007":{"costgold":350,"costka":35,"exp":320,"totalcost":1},"3008":{"costgold":400,"costka":40,"exp":640,"totalcost":1},"3009":{"costgold":0,"costka":0,"exp":0,"totalcost":0}}{"0":{"color":15335424,"name":"测试数值","size":16,"text":""},"111":{"color":15395583,"name":"普攻不暴击伤害","size":16,"text":""},"112":{"color":6618980,"name":"普攻不暴击治疗","size":16,"text":""},"121":{"color":15395583,"name":"普攻暴击伤害","size":20,"text":""},"122":{"color":0,"name":"普攻暴击治疗","size":0,"text":""},"131":{"color":15395583,"name":"普攻免疫伤害","size":16,"text":"免疫"},"132":{"color":15395583,"name":"普攻免疫治疗","size":16,"text":"免疫"},"211":{"color":16776960,"name":"大招不暴击伤害","size":16,"text":""},"212":{"color":6618980,"name":"大招不暴击治疗","size":16,"text":""},"221":{"color":0,"name":"大招暴击伤害","size":0,"text":""},"222":{"color":0,"name":"大招暴击治疗","size":0,"text":""},"231":{"color":15395583,"name":"大招免疫伤害","size":16,"text":"免疫"},"232":{"color":15395583,"name":"大招免疫治疗","size":16,"text":"免疫"},"311":{"color":16776960,"name":"被动不暴击伤害","size":16,"text":""},"312":{"color":6618980,"name":"被动不暴击治疗","size":16,"text":""},"321":{"color":0,"name":"被动暴击伤害","size":0,"text":""},"322":{"color":0,"name":"被动暴击治疗","size":0,"text":""},"331":{"color":15395583,"name":"被动免疫伤害","size":16,"text":"免疫"},"332":{"color":15395583,"name":"被动免疫治疗","size":16,"text":"免疫"},"411":{"color":15395583,"name":"buff不暴击伤害","size":16,"text":""},"412":{"color":6618980,"name":"buff不暴击治疗","size":16,"text":""},"421":{"color":0,"name":"buff暴击伤害","size":0,"text":""},"422":{"color":0,"name":"buff暴击治疗","size":0,"text":""},"431":{"color":15395583,"name":"buff免疫伤害","size":16,"text":"免疫"},"432":{"color":15395583,"name":"buff免疫治疗","size":16,"text":"免疫"}}
	</div></div>
</body></html>